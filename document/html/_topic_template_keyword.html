<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>source: The template and typename keywords in C++</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">source
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="搜索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_topic_template_keyword.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">The template and typename keywords in C++</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>There are two uses for the <code>template</code> and <code>typename</code> keywords in C++. One of them is fairly well known amongst programmers: to define templates. The other use is more obscure: to specify that an expression refers to a template function or a type. This regularly trips up programmers that use the Eigen library, often leading to error messages from the compiler that are difficult to understand, such as "expected expression" or "no match for operator&lt;".</p>
<p>\eigenAutoToc</p>
<h1><a class="anchor" id="TopicTemplateKeywordToDefineTemplates"></a>
Using the template and typename keywords to define templates</h1>
<p>The <code>template</code> and <code>typename</code> keywords are routinely used to define templates. This is not the topic of this page as we assume that the reader is aware of this (otherwise consult a C++ book). The following example should illustrate this use of the <code>template</code> keyword.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keywordtype">bool</span> isPositive(<a class="code hl_define" href="test__overwrite__node_8cpp.html#a0acb682b8260ab1c60b918599864e2e5">T</a> <a class="code hl_variable" href="offscreen_8c.html#a5fd331c99e778f04762be6d8173eb4d2">x</a>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_variable" href="offscreen_8c.html#a5fd331c99e778f04762be6d8173eb4d2">x</a> &gt; 0;</div>
<div class="line">}</div>
<div class="ttc" id="aoffscreen_8c_html_a5fd331c99e778f04762be6d8173eb4d2"><div class="ttname"><a href="offscreen_8c.html#a5fd331c99e778f04762be6d8173eb4d2">x</a></div><div class="ttdeci">float x</div><div class="ttdef"><b>定义</b> offscreen.c:41</div></div>
<div class="ttc" id="atest__overwrite__node_8cpp_html_a0acb682b8260ab1c60b918599864e2e5"><div class="ttname"><a href="test__overwrite__node_8cpp.html#a0acb682b8260ab1c60b918599864e2e5">T</a></div><div class="ttdeci">#define T</div><div class="ttdef"><b>定义</b> test_overwrite_node.cpp:29</div></div>
</div><!-- fragment --><p>We could just as well have written <code>template &lt;class T&gt;</code>; the keywords <code>typename</code> and <code>class</code> have the same meaning in this context.</p>
<h1><a class="anchor" id="TopicTemplateKeywordExample"></a>
An example showing the second use of the template keyword</h1>
<p>Let us illustrate the second use of the <code>template</code> keyword with an example. Suppose we want to write a function which copies all entries in the upper triangular part of a matrix into another matrix, while keeping the lower triangular part unchanged. <a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> straightforward implementation would be as follows:</p>
<table class="example">
<tr>
<th>Example:</th><th>Output: </th></tr>
<tr>
<td><div class="fragment"></div><!-- fragment -->  </td><td><pre class="fragment"></pre> </td></tr>
</table>
<p>That works fine, but it is not very flexible. First, it only works with dynamic-size matrices of single-precision floats; the function <code><a class="el" href="_template_keyword__flexible_8cpp.html#a8338f814c8f5ed448ea1bbec9a18ca14">copyUpperTriangularPart()</a></code> does not accept static-size matrices or matrices with double-precision numbers. Second, if you use an expression such as <code>mat.topLeftCorner(3,3)</code> as the parameter <code>src</code>, then this is copied into a temporary variable of type MatrixXf; this copy can be avoided.</p>
<p>As explained in <a class="el" href="_topic_function_taking_eigen_types.html">Writing Functions Taking Eigen Types as Parameters</a>, both issues can be resolved by making <code><a class="el" href="_template_keyword__flexible_8cpp.html#a8338f814c8f5ed448ea1bbec9a18ca14">copyUpperTriangularPart()</a></code> accept any object of type <a class="el" href="class_eigen_1_1_matrix_base.html" title="Base class for all dense matrices, vectors, and expressions">MatrixBase</a>. This leads to the following code:</p>
<table class="example">
<tr>
<th>Example:</th><th>Output: </th></tr>
<tr>
<td><div class="fragment"></div><!-- fragment -->  </td><td><pre class="fragment"></pre> </td></tr>
</table>
<p>The one line in the body of the function <code><a class="el" href="_template_keyword__flexible_8cpp.html#a8338f814c8f5ed448ea1bbec9a18ca14">copyUpperTriangularPart()</a></code> shows the second, more obscure use of the <code>template</code> keyword in C++. Even though it may look strange, the <code>template</code> keywords are necessary according to the standard. Without it, the compiler may reject the code with an error message like "no match
for operator&lt;".</p>
<h1><a class="anchor" id="TopicTemplateKeywordExplanation"></a>
Explanation</h1>
<p>The reason that the <code>template</code> keyword is necessary in the last example has to do with the rules for how templates are supposed to be compiled in C++. The compiler has to check the code for correct syntax at the point where the template is defined, without knowing the actual value of the template arguments (<code>Derived1</code> and <code>Derived2</code> in the example). That means that the compiler cannot know that <code>dst.triangularView</code> is a member template and that the following &lt; symbol is part of the delimiter for the template parameter. Another possibility would be that <code>dst.triangularView</code> is a member variable with the &lt; symbol refering to the <code>operator&lt;()</code> function. In fact, the compiler should choose the second possibility, according to the standard. If <code>dst.triangularView</code> is a member template (as in our case), the programmer should specify this explicitly with the <code>template</code> keyword and write <code>dst.template triangularView</code>.</p>
<p>The precise rules are rather complicated, but ignoring some subtleties we can summarize them as follows:</p><ul>
<li><a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> <em>dependent name</em> is name that depends (directly or indirectly) on a template parameter. In the example, <code>dst</code> is a dependent name because it is of type <code><a class="el" href="class_eigen_1_1_matrix_base.html" title="Base class for all dense matrices, vectors, and expressions">MatrixBase</a>&lt;Derived1&gt;</code> which depends on the template parameter <code>Derived1</code>.</li>
<li>If the code contains either one of the constructs <code>xxx.yyy</code> or <code>xxx-&gt;yyy</code> and <code>xxx</code> is a dependent name and <code>yyy</code> refers to a member template, then the <code>template</code> keyword must be used before <code>yyy</code>, leading to <code>xxx.template yyy</code> or <code>xxx-&gt;template yyy</code>.</li>
<li>If the code contains the construct <code>xxx::yyy</code> and <code>xxx</code> is a dependent name and <code>yyy</code> refers to a member typedef, then the <code>typename</code> keyword must be used before the whole construct, leading to <code>typename xxx::yyy</code>.</li>
</ul>
<p>As an example where the <code>typename</code> keyword is required, consider the following code in <a class="el" href="group___tutorial_sparse.html">TutorialSparse</a> for iterating over the non-zero entries of a sparse matrix type:</p>
<div class="fragment"><div class="line">SparseMatrixType <a class="code hl_variable" href="_tutorial___advanced_initialization___comma_temporary_8cpp.html#a5d2ded7a4c8830608d7b218f5f27c0a0">mat</a>(<a class="code hl_variable" href="_tutorial__commainit__02_8cpp.html#a061459acc9e078fa4699e0e349887215">rows</a>,<a class="code hl_variable" href="_tutorial__commainit__02_8cpp.html#a4407a60bc4387adae24cee658711f2d9">cols</a>);</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;<a class="code hl_variable" href="_tutorial___advanced_initialization___comma_temporary_8cpp.html#a5d2ded7a4c8830608d7b218f5f27c0a0">mat</a>.outerSize(); ++k)</div>
<div class="line">  <span class="keywordflow">for</span> (SparseMatrixType::InnerIterator it(<a class="code hl_variable" href="_tutorial___advanced_initialization___comma_temporary_8cpp.html#a5d2ded7a4c8830608d7b218f5f27c0a0">mat</a>,k); it; ++it)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">/* ... */</span></div>
<div class="line">  }</div>
<div class="ttc" id="a_tutorial___advanced_initialization___comma_temporary_8cpp_html_a5d2ded7a4c8830608d7b218f5f27c0a0"><div class="ttname"><a href="_tutorial___advanced_initialization___comma_temporary_8cpp.html#a5d2ded7a4c8830608d7b218f5f27c0a0">mat</a></div><div class="ttdeci">MatrixXf mat</div><div class="ttdef"><b>定义</b> Tutorial_AdvancedInitialization_CommaTemporary.cpp:1</div></div>
<div class="ttc" id="a_tutorial__commainit__02_8cpp_html_a061459acc9e078fa4699e0e349887215"><div class="ttname"><a href="_tutorial__commainit__02_8cpp.html#a061459acc9e078fa4699e0e349887215">rows</a></div><div class="ttdeci">int rows</div><div class="ttdef"><b>定义</b> Tutorial_commainit_02.cpp:1</div></div>
<div class="ttc" id="a_tutorial__commainit__02_8cpp_html_a4407a60bc4387adae24cee658711f2d9"><div class="ttname"><a href="_tutorial__commainit__02_8cpp.html#a4407a60bc4387adae24cee658711f2d9">cols</a></div><div class="ttdeci">int cols</div><div class="ttdef"><b>定义</b> Tutorial_commainit_02.cpp:1</div></div>
</div><!-- fragment --><p>If <code>SparseMatrixType</code> depends on a template parameter, then the <code>typename</code> keyword is required:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keywordtype">void</span> iterateOverSparseMatrix(<span class="keyword">const</span> <a class="code hl_class" href="class_sparse_matrix.html">SparseMatrix&lt;T&gt;</a>&amp; <a class="code hl_variable" href="_tutorial___advanced_initialization___comma_temporary_8cpp.html#a5d2ded7a4c8830608d7b218f5f27c0a0">mat</a>;</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;<a class="code hl_variable" href="_i_o_format_8cpp.html#ade6f22163da3c189aade978b48a8bb74">m1</a>.outerSize(); ++k)</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">typename</span> <a class="code hl_typedef" href="class_sparse_matrix.html#a1168c7b63fd56e170ad40ddec972cb42">SparseMatrix&lt;T&gt;::InnerIterator</a> it(<a class="code hl_variable" href="_tutorial___advanced_initialization___comma_temporary_8cpp.html#a5d2ded7a4c8830608d7b218f5f27c0a0">mat</a>,k); it; ++it)</div>
<div class="line">    {</div>
<div class="line">      <span class="comment">/* ... */</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="a_i_o_format_8cpp_html_ade6f22163da3c189aade978b48a8bb74"><div class="ttname"><a href="_i_o_format_8cpp.html#ade6f22163da3c189aade978b48a8bb74">m1</a></div><div class="ttdeci">Matrix3d m1</div><div class="ttdef"><b>定义</b> IOFormat.cpp:2</div></div>
<div class="ttc" id="aclass_sparse_matrix_html"><div class="ttname"><a href="class_sparse_matrix.html">SparseMatrix</a></div><div class="ttdoc">A versatible sparse matrix representation</div><div class="ttdef"><b>定义</b> SparseMatrix.h:98</div></div>
<div class="ttc" id="aclass_sparse_matrix_html_a1168c7b63fd56e170ad40ddec972cb42"><div class="ttname"><a href="class_sparse_matrix.html#a1168c7b63fd56e170ad40ddec972cb42">SparseMatrix::InnerIterator</a></div><div class="ttdeci">Base::InnerIterator InnerIterator</div><div class="ttdef"><b>定义</b> SparseMatrix.h:112</div></div>
</div><!-- fragment --><h1><a class="anchor" id="TopicTemplateKeywordResources"></a>
Resources for further reading</h1>
<p>For more information and a fuller explanation of this topic, the reader may consult the following sources:</p><ul>
<li>The book "C++ Template Metaprogramming" by David Abrahams and Aleksey Gurtovoy contains a very good explanation in Appendix <a class="el" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a> ("The typename and template Keywords") which formed the basis for this page.</li>
<li><a href="http://pages.cs.wisc.edu/~driscoll/typename.html">http://pages.cs.wisc.edu/~driscoll/typename.html</a></li>
<li><a href="http://www.parashift.com/c++-faq-lite/templates.html#faq-35.18">http://www.parashift.com/c++-faq-lite/templates.html#faq-35.18</a></li>
<li><a href="http://www.comeaucomputing.com/techtalk/templates/#templateprefix">http://www.comeaucomputing.com/techtalk/templates/#templateprefix</a></li>
<li><a href="http://www.comeaucomputing.com/techtalk/templates/#typename">http://www.comeaucomputing.com/techtalk/templates/#typename</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
