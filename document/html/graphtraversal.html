<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>source: Graph Traversal</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">source
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="搜索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('graphtraversal.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Graph Traversal</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>目录</h3>
<ul>
  <li class="level1">
    <a href="#GraphTraversalProblemFormulation">Problem Formulation</a>
  </li>
  <li class="level1">
    <a href="#GraphTraversalGraphRepresentation">Graph Representation</a>
  </li>
  <li class="level1">
    <a href="#GraphTraversalStaticTraversal">Static Traversal</a>
  </li>
  <li class="level1">
    <a href="#GraphTraversalDynamicTraversal">Dynamic Traversal</a>
  </li>
</ul>
</div>
<div class="textblock"><p>We study the graph traversal problem by visiting each vertex in parallel following their edge dependencies. Traversing a graph is a fundamental building block of many graph applications especially for large-scale graph analytics.</p>
<h1><a class="anchor" id="GraphTraversalProblemFormulation"></a>
Problem Formulation</h1>
<p>Given a directed acyclic graph (DAG), i.e., a graph that has no cycles, we would like to traverse each vertex in order without breaking dependency constraints defined by edges. The following figure shows a graph of six vertices and seven edges. Each vertex represents a particular task and each edge represents a task dependency between two tasks.</p>
<p>Traversing the above graph in parallel, the maximum parallelism we can acquire is three. When Task1 finishes, we can run Task2, Task3, and Task4 in parallel.</p>
<h1><a class="anchor" id="GraphTraversalGraphRepresentation"></a>
Graph Representation</h1>
<p>We define the data structure of our graph. The graph is represented by an array of nodes of the following structure:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code hl_struct" href="class_node.html">Node</a> {</div>
<div class="line">  std::string <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>;</div>
<div class="line">  <span class="keywordtype">size_t</span> idx;                          <span class="comment">// index of the node in a array</span></div>
<div class="line">  <span class="keywordtype">bool</span> visited {<span class="keyword">false</span>};</div>
<div class="line"> </div>
<div class="line">  std::atomic&lt;size_t&gt; dependents {0};  <span class="comment">// number of incoming edges</span></div>
<div class="line">  std::vector&lt;Node*&gt; successors;       <span class="comment">// number of outgoing edges</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">void</span> precede(<a class="code hl_struct" href="class_node.html">Node</a>&amp; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>) {</div>
<div class="line">    successors.emplace_back(&amp;<a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>);</div>
<div class="line">    <a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>.dependents ++;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="ttc" id="a_bi_c_g_s_t_a_b__simple_8cpp_html_a5150192f625f4d7970d61169b9567f39"><div class="ttname"><a href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a></div><div class="ttdeci">int n</div><div class="ttdef"><b>定义</b> BiCGSTAB_simple.cpp:1</div></div>
<div class="ttc" id="aclass_node_html"><div class="ttname"><a href="class_node.html">Node</a></div><div class="ttdef"><b>定义</b> levelgraph.hpp:22</div></div>
<div class="ttc" id="aimgui__impl__opengl3__loader_8h_html_aab18cfce5ee7c6881ae04f18be70d94a"><div class="ttname"><a href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a></div><div class="ttdeci">const GLchar * name</div><div class="ttdef"><b>定义</b> imgui_impl_opengl3_loader.h:312</div></div>
</div><!-- fragment --><p>Based on the data structure, we randomly generate a DAG using ordered edges.</p>
<div class="fragment"><div class="line">std::unique_ptr&lt;Node[]&gt; <a class="code hl_function" href="test__traversals_8cpp.html#a0bf9df55f04d479e4d1359a01a54e312">make_dag</a>(<span class="keywordtype">size_t</span> num_nodes, <span class="keywordtype">size_t</span> max_degree) {</div>
<div class="line">  </div>
<div class="line">  std::unique_ptr&lt;Node[]&gt; <a class="code hl_variable" href="external_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp.html#a6a5c3f7e9d33dd3ab656f0191f83aa79">nodes</a>(<span class="keyword">new</span> <a class="code hl_struct" href="class_node.html">Node</a>[num_nodes]);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Make sure nodes are in clean state</span></div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;num_nodes; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line">    <a class="code hl_variable" href="external_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp.html#a6a5c3f7e9d33dd3ab656f0191f83aa79">nodes</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>].idx = <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line">    <a class="code hl_variable" href="external_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp.html#a6a5c3f7e9d33dd3ab656f0191f83aa79">nodes</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>].name = std::to_string(<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create a DAG by randomly insert ordered edges</span></div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;num_nodes; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line">    <span class="keywordtype">size_t</span> degree {0};</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>=<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>+1; <a class="code hl_variable" href="tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>&lt;num_nodes &amp;&amp; degree &lt; max_degree; <a class="code hl_variable" href="tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>++) {</div>
<div class="line">      <span class="keywordflow">if</span>(std::rand() % 2 == 1) {</div>
<div class="line">        <a class="code hl_variable" href="external_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp.html#a6a5c3f7e9d33dd3ab656f0191f83aa79">nodes</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>].precede(<a class="code hl_variable" href="external_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp.html#a6a5c3f7e9d33dd3ab656f0191f83aa79">nodes</a>[<a class="code hl_variable" href="tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>]);</div>
<div class="line">        degree ++;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_variable" href="external_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp.html#a6a5c3f7e9d33dd3ab656f0191f83aa79">nodes</a>;</div>
<div class="line">}</div>
<div class="ttc" id="a_bi_c_g_s_t_a_b__step__by__step_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>定义</b> BiCGSTAB_step_by_step.cpp:9</div></div>
<div class="ttc" id="aexternal_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp_html_a6a5c3f7e9d33dd3ab656f0191f83aa79"><div class="ttname"><a href="external_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp.html#a6a5c3f7e9d33dd3ab656f0191f83aa79">nodes</a></div><div class="ttdeci">static unsigned nodes</div><div class="ttdef"><b>定义</b> main.cpp:36</div></div>
<div class="ttc" id="atest__traversals_8cpp_html_a0bf9df55f04d479e4d1359a01a54e312"><div class="ttname"><a href="test__traversals_8cpp.html#a0bf9df55f04d479e4d1359a01a54e312">make_dag</a></div><div class="ttdeci">std::unique_ptr&lt; Node[]&gt; make_dag(size_t num_nodes, size_t max_degree)</div><div class="ttdef"><b>定义</b> test_traversals.cpp:27</div></div>
<div class="ttc" id="atut__arithmetic__redux__minmax_8cpp_html_a39513f0f8d942bf9ef17b2e87ac6d34e"><div class="ttname"><a href="tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a></div><div class="ttdeci">std::ptrdiff_t j</div><div class="ttdef"><b>定义</b> tut_arithmetic_redux_minmax.cpp:2</div></div>
</div><!-- fragment --><p>The function, <code>make_dag</code>, accepts two arguments, <code>num_nodes</code> and <code>max_degree</code>, to restrict the number of nodes in the graph and the maximum number of outgoing edges of every node.</p>
<h1><a class="anchor" id="GraphTraversalStaticTraversal"></a>
Static Traversal</h1>
<p>We create a taskflow to traverse the graph using static tasks (see <a class="el" href="_static_tasking.html">Static Tasking</a>). Each task does nothing but marks <code>visited</code> to <code>true</code> and subtracts <code>dependents</code> from one, both of which are used for validation after the graph is traversed. In practice, this computation may be replaced with a heavy function.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"><a class="code hl_class" href="classtf_1_1_executor.html">tf::Executor</a> <a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>;</div>
<div class="line"> </div>
<div class="line">std::unique_ptr&lt;Node[]&gt; <a class="code hl_variable" href="external_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp.html#a6a5c3f7e9d33dd3ab656f0191f83aa79">nodes</a> = <a class="code hl_function" href="test__traversals_8cpp.html#a0bf9df55f04d479e4d1359a01a54e312">make_dag</a>(100000, 4);</div>
<div class="line">std::vector&lt;tf::Task&gt; tasks;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// create the traversal task for each node</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;num_nodes; ++<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line">  <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([<a class="code hl_variable" href="_cwise__arg_8cpp.html#a49bb5a0db288a22a099643d44c5abbd6">v</a>=&amp;(<a class="code hl_variable" href="external_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp.html#a6a5c3f7e9d33dd3ab656f0191f83aa79">nodes</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>])](){</div>
<div class="line">    <a class="code hl_variable" href="_cwise__arg_8cpp.html#a49bb5a0db288a22a099643d44c5abbd6">v</a>-&gt;visited = <span class="keyword">true</span>;</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>=0; <a class="code hl_variable" href="tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>&lt;<a class="code hl_variable" href="_cwise__arg_8cpp.html#a49bb5a0db288a22a099643d44c5abbd6">v</a>-&gt;successors.size(); ++<a class="code hl_variable" href="tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>) {</div>
<div class="line">      <a class="code hl_variable" href="_cwise__arg_8cpp.html#a49bb5a0db288a22a099643d44c5abbd6">v</a>-&gt;successors[<a class="code hl_variable" href="tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>]-&gt;dependents.fetch_sub(1);</div>
<div class="line">    }</div>
<div class="line">  }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<a class="code hl_variable" href="external_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp.html#a6a5c3f7e9d33dd3ab656f0191f83aa79">nodes</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>);</div>
<div class="line"> </div>
<div class="line">  tasks.push_back(<a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// create the dependency between nodes on top of the graph structure</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;num_nodes; ++<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>=0; <a class="code hl_variable" href="tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>&lt;<a class="code hl_variable" href="external_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp.html#a6a5c3f7e9d33dd3ab656f0191f83aa79">nodes</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>].successors.size(); ++<a class="code hl_variable" href="tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>) {</div>
<div class="line">    tasks[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>].precede(tasks[<a class="code hl_variable" href="external_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp.html#a6a5c3f7e9d33dd3ab656f0191f83aa79">nodes</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>].successors[<a class="code hl_variable" href="tut__arithmetic__redux__minmax_8cpp.html#a39513f0f8d942bf9ef17b2e87ac6d34e">j</a>]-&gt;idx]);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.<a class="code hl_function" href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">run</a>(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).wait();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// after the graph is traversed, all nodes must be visited with no dependents</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;num_nodes; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line">  assert(<a class="code hl_variable" href="external_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp.html#a6a5c3f7e9d33dd3ab656f0191f83aa79">nodes</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>].visited);</div>
<div class="line">  assert(<a class="code hl_variable" href="external_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp.html#a6a5c3f7e9d33dd3ab656f0191f83aa79">nodes</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>].dependents == 0);</div>
<div class="line">}</div>
<div class="ttc" id="a_cwise__arg_8cpp_html_a49bb5a0db288a22a099643d44c5abbd6"><div class="ttname"><a href="_cwise__arg_8cpp.html#a49bb5a0db288a22a099643d44c5abbd6">v</a></div><div class="ttdeci">ArrayXcf v</div><div class="ttdef"><b>定义</b> Cwise_arg.cpp:1</div></div>
<div class="ttc" id="aclasstf_1_1_executor_html"><div class="ttname"><a href="classtf_1_1_executor.html">tf::Executor</a></div><div class="ttdoc">class to create an executor for running a taskflow graph</div><div class="ttdef"><b>定义</b> executor-dl.hpp:51</div></div>
<div class="ttc" id="aclasstf_1_1_executor_html_a519777f5783981d534e9e53b99712069"><div class="ttname"><a href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">tf::Executor::run</a></div><div class="ttdeci">tf::Future&lt; void &gt; run(Taskflow &amp;taskflow)</div><div class="ttdoc">runs a taskflow once</div><div class="ttdef"><b>定义</b> executor-dl.hpp:2067</div></div>
<div class="ttc" id="aclasstf_1_1_task_html"><div class="ttname"><a href="classtf_1_1_task.html">tf::Task</a></div><div class="ttdoc">class to create a task handle over a node in a taskflow graph</div><div class="ttdef"><b>定义</b> task.hpp:150</div></div>
<div class="ttc" id="aclasstf_1_1_taskflow_html"><div class="ttname"><a href="classtf_1_1_taskflow.html">tf::Taskflow</a></div><div class="ttdoc">class to create a taskflow object</div><div class="ttdef"><b>定义</b> taskflow.hpp:67</div></div>
<div class="ttc" id="apoisson_8hpp_html_aa56fe360bb0ae38e0082f49e394ff825"><div class="ttname"><a href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a></div><div class="ttdeci">void taskflow(int nx, int ny, double dx, double dy, double *f, int itold, int itnew, double *u, double *unew, int block_size, unsigned num_threads)</div><div class="ttdef"><b>定义</b> taskflow.cpp:6</div></div>
<div class="ttc" id="atest__partitioner__whitebox_8h_html_a5c4cf3d37a4eee22275de22cb9619863"><div class="ttname"><a href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a></div><div class="ttdeci">#define task</div><div class="ttdef"><b>定义</b> test_partitioner_whitebox.h:76</div></div>
<div class="ttc" id="athread__pool_8cpp_html_a543e564a8407bbeac15cb2d929fec755"><div class="ttname"><a href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a></div><div class="ttdeci">tf::Executor executor</div><div class="ttdef"><b>定义</b> thread_pool.cpp:6</div></div>
</div><!-- fragment --><p>The code above has two parts to construct the parallel graph traversal. First, it iterates each node and constructs a traversal task for that node. Second, it iterates each outgoing edge of a node and creates a dependency between the node and the other end (successor) of that edge. The resulting taskflow structure is topologically equivalent to the given graph.</p>
<p>With task parallelism, we flow computation naturally with the graph structure. The runtime autonomously distributes tasks across processor cores to obtain maximum task parallelism. You do not need to worry about details of scheduling.</p>
<h1><a class="anchor" id="GraphTraversalDynamicTraversal"></a>
Dynamic Traversal</h1>
<p>We can traverse the graph dynamically using <a class="el" href="classtf_1_1_subflow.html" title="class to construct a subflow graph from the execution of a dynamic task">tf::Subflow</a> (see <a class="el" href="_subflow_tasking.html">Subflow Tasking</a>). We start from the source nodes of zero incoming edges and recursively spawn subflows whenever the dependency of a node is meet. Since we are creating tasks from the execution context of another task, we need to store the task callable in advance.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"><a class="code hl_class" href="classtf_1_1_executor.html">tf::Executor</a> <a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// task callable of traversing a node using subflow</span></div>
<div class="line">std::function&lt;<a class="code hl_variable" href="ittnotify__static_8h.html#a61af67d9d838a9497ca5b188dabc1aa0">void</a>(<a class="code hl_struct" href="class_node.html">Node</a>*, <a class="code hl_class" href="classtf_1_1_subflow.html">tf::Subflow</a>&amp;)&gt; traverse;</div>
<div class="line"> </div>
<div class="line">traverse = [&amp;] (<a class="code hl_struct" href="class_node.html">Node</a>* <a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>, <a class="code hl_class" href="classtf_1_1_subflow.html">tf::Subflow</a>&amp; subflow) {</div>
<div class="line">  assert(!<a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>-&gt;visited);</div>
<div class="line">  <a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>-&gt;visited = <span class="keyword">true</span>;</div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>-&gt;successors.size(); <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>-&gt;successors[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;dependents.fetch_sub(1) == 1) {</div>
<div class="line">      subflow.emplace([<a class="code hl_variable" href="main-override_8cpp.html#a1384e7608274313a9433fa573868557b">s</a>=<a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>-&gt;successors[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>], &amp;traverse](<a class="code hl_class" href="classtf_1_1_subflow.html">tf::Subflow</a> &amp;subflow){ </div>
<div class="line">        traverse(s, subflow); </div>
<div class="line">      }).name(<a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>-&gt;name);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// create a graph</span></div>
<div class="line">std::unique_ptr&lt;Node[]&gt; <a class="code hl_variable" href="external_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp.html#a6a5c3f7e9d33dd3ab656f0191f83aa79">nodes</a> = <a class="code hl_function" href="test__traversals_8cpp.html#a0bf9df55f04d479e4d1359a01a54e312">make_dag</a>(100000, 4);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// find the source nodes (no incoming edges)</span></div>
<div class="line">std::vector&lt;Node*&gt; <a class="code hl_variable" href="shortpath_8cpp.html#a8648ffe7342bea77e2698690589da3c1">src</a>;</div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;num_nodes; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line">  <span class="keywordflow">if</span>(<a class="code hl_variable" href="external_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp.html#a6a5c3f7e9d33dd3ab656f0191f83aa79">nodes</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>].dependents == 0) { </div>
<div class="line">    <a class="code hl_variable" href="shortpath_8cpp.html#a8648ffe7342bea77e2698690589da3c1">src</a>.emplace_back(&amp;(<a class="code hl_variable" href="external_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp.html#a6a5c3f7e9d33dd3ab656f0191f83aa79">nodes</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]));</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// create only tasks for source nodes</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code hl_variable" href="shortpath_8cpp.html#a8648ffe7342bea77e2698690589da3c1">src</a>.size(); <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line">  <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([<a class="code hl_variable" href="main-override_8cpp.html#a1384e7608274313a9433fa573868557b">s</a>=<a class="code hl_variable" href="shortpath_8cpp.html#a8648ffe7342bea77e2698690589da3c1">src</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>], &amp;traverse](tf::Subflow&amp; subflow){ </div>
<div class="line">    traverse(<a class="code hl_variable" href="main-override_8cpp.html#a1384e7608274313a9433fa573868557b">s</a>, subflow); </div>
<div class="line">  }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<a class="code hl_variable" href="external_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp.html#a6a5c3f7e9d33dd3ab656f0191f83aa79">nodes</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.<a class="code hl_function" href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">run</a>(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).wait();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// after the graph is traversed, all nodes must be visited with no dependents</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;num_nodes; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line">  assert(<a class="code hl_variable" href="external_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp.html#a6a5c3f7e9d33dd3ab656f0191f83aa79">nodes</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>].visited);</div>
<div class="line">  assert(<a class="code hl_variable" href="external_2taskflow_23rd-party_2tbb_2examples_2parallel__do_2parallel__preorder_2main_8cpp.html#a6a5c3f7e9d33dd3ab656f0191f83aa79">nodes</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>].dependents == 0);</div>
<div class="line">}</div>
<div class="ttc" id="aclasstf_1_1_subflow_html"><div class="ttname"><a href="classtf_1_1_subflow.html">tf::Subflow</a></div><div class="ttdoc">class to construct a subflow graph from the execution of a dynamic task</div><div class="ttdef"><b>定义</b> flow_builder.hpp:1409</div></div>
<div class="ttc" id="aittnotify__static_8h_html_a61af67d9d838a9497ca5b188dabc1aa0"><div class="ttname"><a href="ittnotify__static_8h.html#a61af67d9d838a9497ca5b188dabc1aa0">void</a></div><div class="ttdeci">void</div><div class="ttdef"><b>定义</b> ittnotify_static.h:91</div></div>
<div class="ttc" id="amain-override_8cpp_html_a1384e7608274313a9433fa573868557b"><div class="ttname"><a href="main-override_8cpp.html#a1384e7608274313a9433fa573868557b">s</a></div><div class="ttdeci">static Static s</div><div class="ttdef"><b>定义</b> main-override.cpp:135</div></div>
<div class="ttc" id="ashortpath_8cpp_html_a8648ffe7342bea77e2698690589da3c1"><div class="ttname"><a href="shortpath_8cpp.html#a8648ffe7342bea77e2698690589da3c1">src</a></div><div class="ttdeci">size_t src</div><div class="ttdef"><b>定义</b> shortpath.cpp:81</div></div>
</div><!-- fragment --><p><a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> partial graph is shown as follows:</p>
<p>In general, the dynamic version of graph traversal is slower than the static version due to the overhead incurred by spawning subflows. However, it may be useful for the situation where the graph structure is unknown at once but being partially explored during the traversal. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
