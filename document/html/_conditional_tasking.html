<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>source: Conditional Tasking</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">source
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="搜索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_conditional_tasking.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Conditional Tasking</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>目录</h3>
<ul>
  <li class="level1">
    <a href="#CreateAConditionTask">Create a Condition Task</a>
  </li>
  <li class="level1">
    <a href="#TaskSchedulingPolicy">Understand our Task-level Scheduling</a>
    <ul>
      <li class="level2">
        <a href="#TaskLevelSchedulingExample">Example</a>
      </li>
    </ul>
  </li>
  <li class="level1">
    <a href="#AvoidCommonPitfalls">Avoid Common Pitfalls</a>
  </li>
  <li class="level1">
    <a href="#ImplementControlFlowGraphs">Implement Control-flow Graphs</a>
    <ul>
      <li class="level2">
        <a href="#ImplementIfElseControlFlow">Implement If-Else Control Flow</a>
      </li>
      <li class="level2">
        <a href="#ImplementSwitchControlFlow">Implement Switch Control Flow</a>
      </li>
      <li class="level2">
        <a href="#ImplementDoWhileLoopControlFlow">Implement Do-While-Loop Control Flow</a>
      </li>
      <li class="level2">
        <a href="#ImplementWhileLoopControlFlow">Implement While-Loop Control Flow</a>
      </li>
    </ul>
  </li>
  <li class="level1">
    <a href="#CreateAMultiConditionTask">Create a Multi-condition Task</a>
  </li>
</ul>
</div>
<div class="textblock"><p>Parallel workloads often require making control-flow decisions across dependent tasks. Taskflow supports a very efficient interface of conditional tasking for users to implement general control flow such as dynamic flow, cycles and conditionals that are otherwise difficult to do with existing frameworks.</p>
<h1><a class="anchor" id="CreateAConditionTask"></a>
Create a Condition Task</h1>
<p><a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> condition task evaluates a set of instructions and returns an integer index of the next successor task to execute. The index is defined with respect to the order of its successor construction. The following example creates an if-else block using a single condition task.</p>
<div class="fragment"><div class="line"> 1: <a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"> 2:</div>
<div class="line"> 3: <span class="keyword">auto</span> [<a class="code hl_struct" href="structinit.html">init</a>, cond, yes, no] = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace(</div>
<div class="line"> 4:  [] () { },</div>
<div class="line"> 5:  [] () { <span class="keywordflow">return</span> 0; },</div>
<div class="line"> 6:  [] () { std::cout &lt;&lt; <span class="stringliteral">&quot;yes\n&quot;</span>; },</div>
<div class="line"> 7:  [] () { std::cout &lt;&lt; <span class="stringliteral">&quot;no\n&quot;</span>; }</div>
<div class="line"> 8: );</div>
<div class="line"> 9:</div>
<div class="line">10: cond.succeed(<a class="code hl_function" href="boing_8c.html#a2858154e2009b0e6e616f313177762bc">init</a>)</div>
<div class="line">11:     .precede(yes, no);  <span class="comment">// executes yes if cond returns 0</span></div>
<div class="line">12:                         <span class="comment">// executes no  if cond returns 1</span></div>
<div class="ttc" id="aboing_8c_html_a2858154e2009b0e6e616f313177762bc"><div class="ttname"><a href="boing_8c.html#a2858154e2009b0e6e616f313177762bc">init</a></div><div class="ttdeci">void init(void)</div><div class="ttdef"><b>定义</b> boing.c:182</div></div>
<div class="ttc" id="aclasstf_1_1_taskflow_html"><div class="ttname"><a href="classtf_1_1_taskflow.html">tf::Taskflow</a></div><div class="ttdoc">class to create a taskflow object</div><div class="ttdef"><b>定义</b> taskflow.hpp:67</div></div>
<div class="ttc" id="apoisson_8hpp_html_aa56fe360bb0ae38e0082f49e394ff825"><div class="ttname"><a href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a></div><div class="ttdeci">void taskflow(int nx, int ny, double dx, double dy, double *f, int itold, int itnew, double *u, double *unew, int block_size, unsigned num_threads)</div><div class="ttdef"><b>定义</b> taskflow.cpp:6</div></div>
<div class="ttc" id="astructinit_html"><div class="ttname"><a href="structinit.html">init</a></div><div class="ttdef"><b>定义</b> TutorialInplaceLU.cpp:2</div></div>
</div><!-- fragment --><p>Line 5 creates a condition task <code>cond</code> and line 11 creates two dependencies from <code>cond</code> to two other tasks, <code>yes</code> and <code>no</code>. With this order, when <code>cond</code> returns 0, the execution moves on to task <code>yes</code>. When <code>cond</code> returns 1, the execution moves on to task <code>no</code>.</p>
<dl class="section attention"><dt>注意</dt><dd>It is your responsibility to ensure the return of a condition task goes to a correct successor task. If the return falls beyond the range of the successors, the executor will not schedule any tasks.</dd></dl>
<p>Condition task can go cyclic to describe <em>iterative</em> control flow. The example below implements a simple yet commonly used feedback loop through a condition task (line 7-10) that returns a random binary value. If the return value from <code>cond</code> is <code>0</code>, it loops back to itself, or otherwise to <code>stop</code>.</p>
<div class="fragment"><div class="line"> 1: <a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"> 2: </div>
<div class="line"> 3: <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_struct" href="structinit.html">init</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;init&quot;</span>);</div>
<div class="line"> 4: <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> stop = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;stop&quot;</span>);</div>
<div class="line"> 5:</div>
<div class="line"> 6: <span class="comment">// creates a condition task that returns 0 or 1</span></div>
<div class="line"> 7: <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> cond = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){</div>
<div class="line"> 8:   std::cout &lt;&lt; <span class="stringliteral">&quot;flipping a coin\n&quot;</span>;</div>
<div class="line"> 9:   <span class="keywordflow">return</span> std::rand() % 2;</div>
<div class="line">10: }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;cond&quot;</span>);</div>
<div class="line">11:</div>
<div class="line">12: <span class="comment">// creates a feedback loop {0: cond, 1: stop}</span></div>
<div class="line">13: <a class="code hl_function" href="boing_8c.html#a2858154e2009b0e6e616f313177762bc">init</a>.precede(cond);</div>
<div class="line">14: cond.<a class="code hl_function" href="classtf_1_1_task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(cond, stop);  <span class="comment">// returns 0 to &#39;cond&#39; or 1 to &#39;stop&#39;</span></div>
<div class="line">15:</div>
<div class="line">16: <a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.<a class="code hl_function" href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">run</a>(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).wait();</div>
<div class="ttc" id="aclasstf_1_1_executor_html_a519777f5783981d534e9e53b99712069"><div class="ttname"><a href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">tf::Executor::run</a></div><div class="ttdeci">tf::Future&lt; void &gt; run(Taskflow &amp;taskflow)</div><div class="ttdoc">runs a taskflow once</div><div class="ttdef"><b>定义</b> executor-dl.hpp:2067</div></div>
<div class="ttc" id="aclasstf_1_1_task_html"><div class="ttname"><a href="classtf_1_1_task.html">tf::Task</a></div><div class="ttdoc">class to create a task handle over a node in a taskflow graph</div><div class="ttdef"><b>定义</b> task.hpp:150</div></div>
<div class="ttc" id="aclasstf_1_1_task_html_a8c78c453295a553c1c016e4062da8588"><div class="ttname"><a href="classtf_1_1_task.html#a8c78c453295a553c1c016e4062da8588">tf::Task::precede</a></div><div class="ttdeci">Task &amp; precede(Ts &amp;&amp;... tasks)</div><div class="ttdoc">adds precedence links from this to other tasks</div><div class="ttdef"><b>定义</b> task.hpp:394</div></div>
<div class="ttc" id="aimgui__impl__opengl3__loader_8h_html_aab18cfce5ee7c6881ae04f18be70d94a"><div class="ttname"><a href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a></div><div class="ttdeci">const GLchar * name</div><div class="ttdef"><b>定义</b> imgui_impl_opengl3_loader.h:312</div></div>
<div class="ttc" id="athread__pool_8cpp_html_a543e564a8407bbeac15cb2d929fec755"><div class="ttname"><a href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a></div><div class="ttdeci">tf::Executor executor</div><div class="ttdef"><b>定义</b> thread_pool.cpp:6</div></div>
</div><!-- fragment --><p><a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> taskflow of complex control flow often just takes a few lines of code to implement, and different control flow blocks may run in parallel. The code below creates another taskflow with three condition tasks.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;A&quot;</span>);</div>
<div class="line"><a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;B&quot;</span>);</div>
<div class="line"><a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;C&quot;</span>);</div>
<div class="line">tf::Task <a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;D&quot;</span>);</div>
<div class="line">tf::Task <a class="code hl_define" href="sandbox_2strassen_2omp_8cpp.html#a4bfa035cad7c3258704669810cd5de5d">E</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;E&quot;</span>);</div>
<div class="line">tf::Task <a class="code hl_variable" href="test__flow__graph_8cpp.html#a1c83625ec20fd09ecaf0e5b37c75f6f8">F</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;F&quot;</span>);</div>
<div class="line">tf::Task <a class="code hl_variable" href="_jacobi__make_givens_8cpp.html#ad2c49539791450cfceedabc09452d977">G</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;G&quot;</span>);</div>
<div class="line">tf::Task <a class="code hl_variable" href="gnuplot__common__settings_8hh.html#a1312167399d185be316962d53af87c87">H</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;H&quot;</span>);</div>
<div class="line">tf::Task I = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;I&quot;</span>);</div>
<div class="line">tf::Task K = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;K&quot;</span>);</div>
<div class="line">tf::Task <a class="code hl_variable" href="_l_l_t__example_8cpp.html#a2913877890361a28ee108aafe462ee93">L</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;L&quot;</span>);</div>
<div class="line">tf::Task <a class="code hl_define" href="test__overwrite__node_8cpp.html#a52037c938e3c1b126c6277da5ca689d0">M</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;M&quot;</span>);</div>
<div class="line">tf::Task cond_1 = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){ <span class="keywordflow">return</span> std::rand()%2; }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;cond_1&quot;</span>);</div>
<div class="line">tf::Task cond_2 = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){ <span class="keywordflow">return</span> std::rand()%2; }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;cond_2&quot;</span>);</div>
<div class="line">tf::Task cond_3 = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){ <span class="keywordflow">return</span> std::rand()%2; }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;cond_3&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>.precede(<a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>, <a class="code hl_variable" href="test__flow__graph_8cpp.html#a1c83625ec20fd09ecaf0e5b37c75f6f8">F</a>);</div>
<div class="line"><a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>.precede(<a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>);</div>
<div class="line"><a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>.precede(<a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a>);</div>
<div class="line"><a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a>.precede(cond_1);</div>
<div class="line"><a class="code hl_define" href="sandbox_2strassen_2omp_8cpp.html#a4bfa035cad7c3258704669810cd5de5d">E</a>.precede(K);</div>
<div class="line"><a class="code hl_variable" href="test__flow__graph_8cpp.html#a1c83625ec20fd09ecaf0e5b37c75f6f8">F</a>.precede(cond_2);</div>
<div class="line"><a class="code hl_variable" href="gnuplot__common__settings_8hh.html#a1312167399d185be316962d53af87c87">H</a>.precede(I);</div>
<div class="line">I.<a class="code hl_function" href="classtf_1_1_task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(cond_3);</div>
<div class="line"><a class="code hl_variable" href="_l_l_t__example_8cpp.html#a2913877890361a28ee108aafe462ee93">L</a>.<a class="code hl_function" href="classtf_1_1_task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(<a class="code hl_define" href="test__overwrite__node_8cpp.html#a52037c938e3c1b126c6277da5ca689d0">M</a>);</div>
<div class="line"> </div>
<div class="line">cond_1.<a class="code hl_function" href="classtf_1_1_task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(<a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>, <a class="code hl_define" href="sandbox_2strassen_2omp_8cpp.html#a4bfa035cad7c3258704669810cd5de5d">E</a>);       <span class="comment">// return 0 to &#39;B&#39; or 1 to &#39;E&#39;</span></div>
<div class="line">cond_2.<a class="code hl_function" href="classtf_1_1_task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(<a class="code hl_variable" href="_jacobi__make_givens_8cpp.html#ad2c49539791450cfceedabc09452d977">G</a>, <a class="code hl_variable" href="gnuplot__common__settings_8hh.html#a1312167399d185be316962d53af87c87">H</a>);       <span class="comment">// return 0 to &#39;G&#39; or 1 to &#39;H&#39;</span></div>
<div class="line">cond_3.<a class="code hl_function" href="classtf_1_1_task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(cond_3, <a class="code hl_variable" href="_l_l_t__example_8cpp.html#a2913877890361a28ee108aafe462ee93">L</a>);  <span class="comment">// return 0 to &#39;cond_3&#39; or 1 to &#39;L&#39;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.<a class="code hl_function" href="classtf_1_1_task.html#a3318a49ff9d0a01cd1e8ee675251e3b7">dump</a>(std::cout);</div>
<div class="ttc" id="a_eigen_solver___eigen_solver___matrix_type_8cpp_html_a925331f9b6e4844293d36a8df2256d38"><div class="ttname"><a href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a></div><div class="ttdeci">MatrixXcd D</div><div class="ttdef"><b>定义</b> EigenSolver_EigenSolver_MatrixType.cpp:14</div></div>
<div class="ttc" id="a_jacobi__make_givens_8cpp_html_ad2c49539791450cfceedabc09452d977"><div class="ttname"><a href="_jacobi__make_givens_8cpp.html#ad2c49539791450cfceedabc09452d977">G</a></div><div class="ttdeci">JacobiRotation&lt; float &gt; G</div><div class="ttdef"><b>定义</b> Jacobi_makeGivens.cpp:2</div></div>
<div class="ttc" id="a_l_l_t__example_8cpp_html_a2913877890361a28ee108aafe462ee93"><div class="ttname"><a href="_l_l_t__example_8cpp.html#a2913877890361a28ee108aafe462ee93">L</a></div><div class="ttdeci">MatrixXd L</div><div class="ttdef"><b>定义</b> LLT_example.cpp:6</div></div>
<div class="ttc" id="abench__gemm_8cpp_html_a37a83060ac796961b44991c836f083f7"><div class="ttname"><a href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a></div><div class="ttdeci">Matrix&lt; SCALARB, Dynamic, Dynamic &gt; B</div><div class="ttdef"><b>定义</b> bench_gemm.cpp:36</div></div>
<div class="ttc" id="abench__gemm_8cpp_html_addc86e8508f14411ec98f521c520f875"><div class="ttname"><a href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a></div><div class="ttdeci">Matrix&lt; SCALARA, Dynamic, Dynamic &gt; A</div><div class="ttdef"><b>定义</b> bench_gemm.cpp:35</div></div>
<div class="ttc" id="aclasstf_1_1_task_html_a3318a49ff9d0a01cd1e8ee675251e3b7"><div class="ttname"><a href="classtf_1_1_task.html#a3318a49ff9d0a01cd1e8ee675251e3b7">tf::Task::dump</a></div><div class="ttdeci">void dump(std::ostream &amp;ostream) const</div><div class="ttdoc">dumps the task through an output stream</div><div class="ttdef"><b>定义</b> task.hpp:581</div></div>
<div class="ttc" id="agnuplot__common__settings_8hh_html_a1312167399d185be316962d53af87c87"><div class="ttname"><a href="gnuplot__common__settings_8hh.html#a1312167399d185be316962d53af87c87">H</a></div><div class="ttdeci">set noclip points set clip one set noclip two set bar set border lt lw set xdata set ydata set zdata set x2data set y2data set boxwidth set dummy y set format x g set format y g set format x2 g set format y2 g set format z g set angles radians set nogrid set key title set key left top Right noreverse box linetype linewidth samplen spacing width set nolabel set noarrow set nologscale set logscale x set set pointsize set encoding default set nopolar set noparametric set set set set surface set nocontour set clabel set mapping cartesian set nohidden3d set cntrparam order set cntrparam linear set cntrparam levels auto set cntrparam points set size set set xzeroaxis lt lw set x2zeroaxis lt lw set yzeroaxis lt lw set y2zeroaxis lt lw set tics in set ticslevel set tics set mxtics default set mytics default set mx2tics default set my2tics default set xtics border mirror norotate autofreq set ytics border mirror norotate autofreq set ztics border nomirror norotate autofreq set nox2tics set noy2tics set timestamp bottom norotate set rrange[*:*] noreverse nowriteback set trange[*:*] noreverse nowriteback set urange[*:*] noreverse nowriteback set vrange[*:*] noreverse nowriteback set xlabel matrix size set x2label set timefmt d m y n H</div><div class="ttdef"><b>定义</b> gnuplot_common_settings.hh:74</div></div>
<div class="ttc" id="asandbox_2strassen_2omp_8cpp_html_a4bfa035cad7c3258704669810cd5de5d"><div class="ttname"><a href="sandbox_2strassen_2omp_8cpp.html#a4bfa035cad7c3258704669810cd5de5d">E</a></div><div class="ttdeci">#define E(Matrix)</div></div>
<div class="ttc" id="atest__buffer__node_8cpp_html_ac4cf4b2ab929bd23951a8676eeac086b"><div class="ttname"><a href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a></div><div class="ttdeci">#define C</div><div class="ttdef"><b>定义</b> test_buffer_node.cpp:28</div></div>
<div class="ttc" id="atest__flow__graph_8cpp_html_a1c83625ec20fd09ecaf0e5b37c75f6f8"><div class="ttname"><a href="test__flow__graph_8cpp.html#a1c83625ec20fd09ecaf0e5b37c75f6f8">F</a></div><div class="ttdeci">const int F</div><div class="ttdef"><b>定义</b> test_flow_graph.cpp:60</div></div>
<div class="ttc" id="atest__overwrite__node_8cpp_html_a52037c938e3c1b126c6277da5ca689d0"><div class="ttname"><a href="test__overwrite__node_8cpp.html#a52037c938e3c1b126c6277da5ca689d0">M</a></div><div class="ttdeci">#define M</div><div class="ttdef"><b>定义</b> test_overwrite_node.cpp:30</div></div>
</div><!-- fragment --><p>The above code creates three condition tasks: (1) a condition task <code>cond_1</code> that loops back to <code><a class="el" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a></code> on returning <code>0</code>, or proceeds to <code>E</code> on returning <code>1</code>, (2) a condition task <code>cond_2</code> that goes to <code><a class="el" href="struct_g.html">G</a></code> on returning <code>0</code>, or <code>H</code> on returning <code>1</code>, (3) a condition task <code>cond_3</code> that loops back to itself on returning <code>0</code>, or proceeds to <code>L</code> on returning <code>1</code> </p>
<p>You can use condition tasks to create cycles as long as the graph does not introduce task race during execution. However, cycles are not allowed in non-condition tasks.</p>
<dl class="section attention"><dt>注意</dt><dd><a class="el" href="struct_conditional.html">Conditional</a> tasking lets you make in-task control-flow decisions to enable <em>end-to-end</em> parallelism, instead of resorting to client-side partition or synchronizing your task graph at the decision points of control flow.</dd></dl>
<h1><a class="anchor" id="TaskSchedulingPolicy"></a>
Understand our Task-level Scheduling</h1>
<p>In order to understand how an executor schedules condition tasks, we define two dependency types, <em>strong dependency</em> and <em>weak dependency</em>. <a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> strong dependency is a preceding link from a non-condition task to another task. <a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> weak dependency is a preceding link from a condition task to another task. The number of dependencies of a task is the sum of strong dependency and weak dependency. The table below lists the strong dependency and weak dependency numbers of each task in the previous example.</p>
<div align="center"> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">task   </th><th class="markdownTableHeadCenter">strong dependency   </th><th class="markdownTableHeadCenter">weak dependency   </th><th class="markdownTableHeadNone">dependencies    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>   </td><td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyNone">0    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><a class="el" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>   </td><td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyNone">2    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">C   </td><td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyNone">1    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">D   </td><td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyNone">1    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">E   </td><td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyNone">1    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">F   </td><td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyNone">1    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><a class="el" href="struct_g.html">G</a>   </td><td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyNone">1    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">H   </td><td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyNone">1    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">I   </td><td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyNone">1    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">K   </td><td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyNone">1    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">L   </td><td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyNone">1    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">M   </td><td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyNone">1    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">cond_1   </td><td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyNone">1    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">cond_2   </td><td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyNone">1    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">cond_3   </td><td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyCenter">1   </td><td class="markdownTableBodyNone">2   </td></tr>
</table>
</div><p>You can query the number of strong dependencies, the number of weak dependencies, and the number of dependencies of a task.</p>
<div class="fragment"><div class="line">1: <a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line">2: </div>
<div class="line">3: <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){});</div>
<div class="line">4: </div>
<div class="line">5: <span class="comment">// ... add more tasks and preceding links</span></div>
<div class="line">6:</div>
<div class="line">7: std::cout &lt;&lt; <a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a>.num_predecessors() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line">8: std::cout &lt;&lt; <a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a>.num_strong_dependencies() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>; </div>
<div class="line">9: std::cout &lt;&lt; <a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a>.num_weak_dependencies() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="ttc" id="atest__partitioner__whitebox_8h_html_a5c4cf3d37a4eee22275de22cb9619863"><div class="ttname"><a href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a></div><div class="ttdeci">#define task</div><div class="ttdef"><b>定义</b> test_partitioner_whitebox.h:76</div></div>
</div><!-- fragment --><p>When you submit a task to an executor, the scheduler starts with tasks of <em>zero dependencies</em> (both zero strong and weak dependencies) and continues to execute successive tasks whenever their <em>strong dependencies</em> are met. However, the scheduler skips this rule when executing a condition task and jumps directly to its successors indexed by the return value.</p>
<p>Each task has an <em>atomic</em> join counter to keep track of strong dependencies that are met at runtime. When a task completes, the join counter is restored to the task's strong dependency number in the graph, such that the subsequent execution can reuse the counter again.</p>
<h2><a class="anchor" id="TaskLevelSchedulingExample"></a>
Example</h2>
<p>Let's take a look at an example to understand how task-level scheduling works. Suppose we have the following taskflow of one condition task <code>cond</code> that forms a loop to itself on returning <code>0</code> and moves on to <code>stop</code> on returning <code>1</code>:</p>
<p>The scheduler starts with <code>init</code> task because it has no dependencies (both strong and weak dependencies). Then, the scheduler moves on to the condition task <code>cond</code>. If <code>cond</code> returns <code>0</code>, the scheduler enqueues <code>cond</code> and runs it again. If <code>cond</code> returns <code>1</code>, the scheduler enqueues <code>stop</code> and then moves on.</p>
<h1><a class="anchor" id="AvoidCommonPitfalls"></a>
Avoid Common Pitfalls</h1>
<p>Condition tasks are handy in creating dynamic and cyclic control flows, but they are also easy to make mistakes. It is your responsibility to ensure a taskflow is properly conditioned. Top things to avoid include <em>no source tasks</em> to start with and <em>task race</em>. The figure below shows common pitfalls and their remedies.</p>
<p>In the <code>error1</code> scenario, there is no source task for the scheduler to start with, and the simplest fix is to add a task <code>S</code> that has no dependencies. In the <code>error2</code> scenario, <code>D</code> might be scheduled twice by <code>E</code> through the strong dependency and <code>C</code> through the weak dependency (on returning <code>1</code>). To fix this problem, you can add an auxiliary task <code>D-aux</code> to break the mixed use of strong dependency and weak dependency. In the risky scenario, task <code>X</code> may be raced by <code>M</code> and <code>P</code> if <code>M</code> returns <code>0</code> and P returns <code>1</code>.</p>
<dl class="section attention"><dt>注意</dt><dd>It is your responsibility to ensure a written taskflow graph is properly conditioned. We suggest that you <a class="el" href="#TaskSchedulingPolicy">Understand our Task-level Scheduling</a> and infer if task race exists in the execution of your graph.</dd></dl>
<h1><a class="anchor" id="ImplementControlFlowGraphs"></a>
Implement Control-flow Graphs</h1>
<h2><a class="anchor" id="ImplementIfElseControlFlow"></a>
Implement If-Else Control Flow</h2>
<p>You can use conditional tasking to implement if-else control flow. The following example creates a nested if-else control flow diagram that executes three condition tasks to check the range of <code>i</code>.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// create three condition tasks for nested control flow</span></div>
<div class="line"><span class="keyword">auto</span> initi = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;](){ <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=3; }); </div>
<div class="line"><span class="keyword">auto</span> cond1 = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;](){ <span class="keywordflow">return</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&gt;1 ? 1 : 0; }); </div>
<div class="line"><span class="keyword">auto</span> cond2 = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;](){ <span class="keywordflow">return</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&gt;2 ? 1 : 0; }); </div>
<div class="line"><span class="keyword">auto</span> cond3 = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;](){ <span class="keywordflow">return</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&gt;3 ? 1 : 0; }); </div>
<div class="line"><span class="keyword">auto</span> equl1 = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;](){ std::cout &lt;&lt; <span class="stringliteral">&quot;i=1\n&quot;</span>; }); </div>
<div class="line"><span class="keyword">auto</span> equl2 = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;](){ std::cout &lt;&lt; <span class="stringliteral">&quot;i=2\n&quot;</span>; }); </div>
<div class="line"><span class="keyword">auto</span> equl3 = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;](){ std::cout &lt;&lt; <span class="stringliteral">&quot;i=3\n&quot;</span>; }); </div>
<div class="line"><span class="keyword">auto</span> grtr3 = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;](){ std::cout &lt;&lt; <span class="stringliteral">&quot;i&gt;3\n&quot;</span>; }); </div>
<div class="line"> </div>
<div class="line">initi.precede(cond1);</div>
<div class="line">cond1.precede(equl1, cond2);  <span class="comment">// goes to cond2 if i&gt;1</span></div>
<div class="line">cond2.precede(equl2, cond3);  <span class="comment">// goes to cond3 if i&gt;2</span></div>
<div class="line">cond3.precede(equl3, grtr3);  <span class="comment">// goes to grtr3 if i&gt;3</span></div>
<div class="ttc" id="a_bi_c_g_s_t_a_b__step__by__step_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>定义</b> BiCGSTAB_step_by_step.cpp:9</div></div>
</div><!-- fragment --><h2><a class="anchor" id="ImplementSwitchControlFlow"></a>
Implement Switch Control Flow</h2>
<p>You can use conditional tasking to implement <em>switch</em> control flow. The following example creates a switch control flow diagram that executes one of the three cases at random using four condition tasks.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> [source, swcond, case1, case2, case3, target] = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace(</div>
<div class="line">  [](){ std::cout &lt;&lt; <span class="stringliteral">&quot;source\n&quot;</span>; },</div>
<div class="line">  [](){ std::cout &lt;&lt; <span class="stringliteral">&quot;switch\n&quot;</span>; <span class="keywordflow">return</span> rand()%3; },</div>
<div class="line">  [](){ std::cout &lt;&lt; <span class="stringliteral">&quot;case 1\n&quot;</span>; <span class="keywordflow">return</span> 0; },</div>
<div class="line">  [](){ std::cout &lt;&lt; <span class="stringliteral">&quot;case 2\n&quot;</span>; <span class="keywordflow">return</span> 0; },</div>
<div class="line">  [](){ std::cout &lt;&lt; <span class="stringliteral">&quot;case 3\n&quot;</span>; <span class="keywordflow">return</span> 0; },</div>
<div class="line">  [](){ std::cout &lt;&lt; <span class="stringliteral">&quot;target\n&quot;</span>; }</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line">source.precede(swcond);</div>
<div class="line">swcond.precede(case1, case2, case3);</div>
<div class="line">target.succeed(case1, case2, case3);</div>
</div><!-- fragment --><p>Assuming <code>swcond</code> returns 1, the program outputs:</p>
<div class="fragment"><div class="line">{.shell-session} </div>
<div class="line">source</div>
<div class="line"><span class="keywordflow">switch</span></div>
<div class="line"><span class="keywordflow">case</span> 2</div>
<div class="line">target</div>
</div><!-- fragment --><p>Keep in mind, both switch and case tasks must be described as condition tasks. The following implementation is a common mistake in which case tasks are not described as condition tasks.</p>
<div class="fragment"><div class="line"><span class="comment">// wrong implementation of switch control flow using only one condition task</span></div>
<div class="line"><a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> [source, swcond, case1, case2, case3, target] = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace(</div>
<div class="line">  [](){ std::cout &lt;&lt; <span class="stringliteral">&quot;source\n&quot;</span>; },</div>
<div class="line">  [](){ std::cout &lt;&lt; <span class="stringliteral">&quot;switch\n&quot;</span>; <span class="keywordflow">return</span> rand()%3; },</div>
<div class="line">  [](){ std::cout &lt;&lt; <span class="stringliteral">&quot;case 1\n&quot;</span>; },</div>
<div class="line">  [](){ std::cout &lt;&lt; <span class="stringliteral">&quot;case 2\n&quot;</span>; },</div>
<div class="line">  [](){ std::cout &lt;&lt; <span class="stringliteral">&quot;case 3\n&quot;</span>; },</div>
<div class="line">  [](){ std::cout &lt;&lt; <span class="stringliteral">&quot;target\n&quot;</span>; }  <span class="comment">// target has three strong dependencies</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line">source.precede(swcond);</div>
<div class="line">swcond.precede(case1, case2, case3);</div>
<div class="line">target.succeed(case1, case2, case3);</div>
</div><!-- fragment --><p>In this faulty implementation, task <code>target</code> has three strong dependencies but only one of them will be met. This is because <code>swcond</code> is a condition task, and only one case task will be executed depending on the return of <code>swcond</code>.</p>
<h2><a class="anchor" id="ImplementDoWhileLoopControlFlow"></a>
Implement Do-While-Loop Control Flow</h2>
<p>You can use conditional tasking to implement <em>do-while-loop</em> control flow. The following example creates a do-while-loop control flow diagram that repeatedly increments variable <code>i</code> five times using one condition task.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> [<a class="code hl_struct" href="structinit.html">init</a>, body, cond, <a class="code hl_variable" href="cpq__pdes_8cpp.html#a1d39aac66e12dae50a24cd7a9100ef33">done</a>] = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace(</div>
<div class="line">  [&amp;](){ std::cout &lt;&lt; <span class="stringliteral">&quot;i=0\n&quot;</span>; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; },</div>
<div class="line">  [&amp;](){ std::cout &lt;&lt; <span class="stringliteral">&quot;i++ =&gt; i=&quot;</span>; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++; },</div>
<div class="line">  [&amp;](){ std::cout &lt;&lt; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>; <span class="keywordflow">return</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;5 ? 0 : 1; },</div>
<div class="line">  [&amp;](){ std::cout &lt;&lt; <span class="stringliteral">&quot;done\n&quot;</span>; }</div>
<div class="line">);  </div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="boing_8c.html#a2858154e2009b0e6e616f313177762bc">init</a>.precede(body);</div>
<div class="line">body.precede(cond);</div>
<div class="line">cond.precede(body, <a class="code hl_variable" href="cpq__pdes_8cpp.html#a1d39aac66e12dae50a24cd7a9100ef33">done</a>);</div>
<div class="ttc" id="acpq__pdes_8cpp_html_a1d39aac66e12dae50a24cd7a9100ef33"><div class="ttname"><a href="cpq__pdes_8cpp.html#a1d39aac66e12dae50a24cd7a9100ef33">done</a></div><div class="ttdeci">bool done</div><div class="ttdef"><b>定义</b> cpq_pdes.cpp:47</div></div>
</div><!-- fragment --><p>The program outputs:</p>
<div class="fragment"><div class="line">{.shell-session} </div>
<div class="line"><a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0</div>
<div class="line"><a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++ =&gt; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=1</div>
<div class="line"><a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++ =&gt; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=2</div>
<div class="line"><a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++ =&gt; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=3</div>
<div class="line"><a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++ =&gt; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=4</div>
<div class="line"><a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++ =&gt; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=5</div>
<div class="line"><a class="code hl_variable" href="cpq__pdes_8cpp.html#a1d39aac66e12dae50a24cd7a9100ef33">done</a></div>
</div><!-- fragment --><h2><a class="anchor" id="ImplementWhileLoopControlFlow"></a>
Implement While-Loop Control Flow</h2>
<p>You can use conditional tasking to implement <em>while-loop</em> control flow. The following example creates a while-loop control flow diagram that repeatedly increments variable <code>i</code> five times using two condition task.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> [<a class="code hl_struct" href="structinit.html">init</a>, cond, body, back, <a class="code hl_variable" href="cpq__pdes_8cpp.html#a1d39aac66e12dae50a24cd7a9100ef33">done</a>] = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace(</div>
<div class="line">  [&amp;](){ std::cout &lt;&lt; <span class="stringliteral">&quot;i=0\n&quot;</span>; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; },</div>
<div class="line">  [&amp;](){ std::cout &lt;&lt; <span class="stringliteral">&quot;while i&lt;5\n&quot;</span>; <span class="keywordflow">return</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 5 ? 0 : 1; },</div>
<div class="line">  [&amp;](){ std::cout &lt;&lt; <span class="stringliteral">&quot;i++=&quot;</span> &lt;&lt; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++ &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>; },</div>
<div class="line">  [&amp;](){ std::cout &lt;&lt; <span class="stringliteral">&quot;back\n&quot;</span>; <span class="keywordflow">return</span> 0; },</div>
<div class="line">  [&amp;](){ std::cout &lt;&lt; <span class="stringliteral">&quot;done\n&quot;</span>; }</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="boing_8c.html#a2858154e2009b0e6e616f313177762bc">init</a>.precede(cond);</div>
<div class="line">cond.precede(body, <a class="code hl_variable" href="cpq__pdes_8cpp.html#a1d39aac66e12dae50a24cd7a9100ef33">done</a>);</div>
<div class="line">body.precede(back);</div>
<div class="line">back.precede(cond);</div>
</div><!-- fragment --><p>The program outputs:</p>
<div class="fragment"><div class="line">{.shell-session} </div>
<div class="line"><a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0</div>
<div class="line"><span class="keywordflow">while</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;5</div>
<div class="line"><a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++=0</div>
<div class="line">back</div>
<div class="line"><span class="keywordflow">while</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;5</div>
<div class="line"><a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++=1</div>
<div class="line">back</div>
<div class="line"><span class="keywordflow">while</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;5</div>
<div class="line"><a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++=2</div>
<div class="line">back</div>
<div class="line"><span class="keywordflow">while</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;5</div>
<div class="line"><a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++=3</div>
<div class="line">back</div>
<div class="line"><span class="keywordflow">while</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;5</div>
<div class="line"><a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++=4</div>
<div class="line">back</div>
<div class="line"><span class="keywordflow">while</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;5</div>
<div class="line"><a class="code hl_variable" href="cpq__pdes_8cpp.html#a1d39aac66e12dae50a24cd7a9100ef33">done</a></div>
</div><!-- fragment --><p>Notice that, when you implement a while-loop block, you cannot direct a dependency from the body task to the loop condition task. Doing so will introduce a strong dependency between the body task and the loop condition task, and the loop condition task will never be executed. The following code shows a common faulty implementation of while-loop control flow.</p>
<div class="fragment"><div class="line"><span class="comment">// wrong implementation of while-loop using only one condition task</span></div>
<div class="line"><a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> [<a class="code hl_struct" href="structinit.html">init</a>, cond, body, <a class="code hl_variable" href="cpq__pdes_8cpp.html#a1d39aac66e12dae50a24cd7a9100ef33">done</a>] = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace(</div>
<div class="line">  [&amp;](){ std::cout &lt;&lt; <span class="stringliteral">&quot;i=0\n&quot;</span>; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; },</div>
<div class="line">  [&amp;](){ std::cout &lt;&lt; <span class="stringliteral">&quot;while i&lt;5\n&quot;</span>; <span class="keywordflow">return</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; 5 ? 0 : 1; },</div>
<div class="line">  [&amp;](){ std::cout &lt;&lt; <span class="stringliteral">&quot;i++=&quot;</span> &lt;&lt; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++ &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>; },</div>
<div class="line">  [&amp;](){ std::cout &lt;&lt; <span class="stringliteral">&quot;done\n&quot;</span>; }</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="boing_8c.html#a2858154e2009b0e6e616f313177762bc">init</a>.precede(cond);</div>
<div class="line">cond.precede(body, <a class="code hl_variable" href="cpq__pdes_8cpp.html#a1d39aac66e12dae50a24cd7a9100ef33">done</a>);</div>
<div class="line">body.precede(cond);</div>
</div><!-- fragment --><p>In the taskflow diagram above, the scheduler starts with <code>init</code> and then decrements the strong dependency of the loop condition task, <code>while i&lt;5</code>. After this, there remains one strong dependency, i.e., introduced by the loop body task, <code>i++</code>. However, task <code>i++</code> will not be executed until the loop condition task returns <code>0</code>, causing a deadlock.</p>
<h1><a class="anchor" id="CreateAMultiConditionTask"></a>
Create a Multi-condition Task</h1>
<p><a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> <em>multi-condition task</em> is a generalized version of conditional tasking. In some cases, applications need to jump to multiple branches from a parent task. This can be done by creating a <em>multi-condition task</em> which allows a task to select one or more successor tasks to execute. Similar to a condition task, a multi-condition task returns a vector of integer indices that indicate the successors to execute when the multi-condition task completes. The index is defined with respect to the order of successors preceded by a multi-condition task. For example, the following code creates a multi-condition task, <code><a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a></code>, that informs the scheduler to run on its two successors, <code><a class="el" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a></code> and <code>D</code>.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1_executor.html">tf::Executor</a> <a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>;</div>
<div class="line"><a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;]() -&gt; <a class="code hl_class" href="classtf_1_1_small_vector.html">tf::SmallVector&lt;int&gt;</a> { </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;A\n&quot;</span>; </div>
<div class="line">  <span class="keywordflow">return</span> {0, 2};</div>
<div class="line">}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;A&quot;</span>);</div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;](){ std::cout &lt;&lt; <span class="stringliteral">&quot;B\n&quot;</span>; }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;B&quot;</span>);</div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;](){ std::cout &lt;&lt; <span class="stringliteral">&quot;C\n&quot;</span>; }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;C&quot;</span>);</div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;](){ std::cout &lt;&lt; <span class="stringliteral">&quot;D\n&quot;</span>; }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;D&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>.precede(<a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>, <a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a>);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.<a class="code hl_function" href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">run</a>(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).wait();</div>
<div class="ttc" id="aclasstf_1_1_executor_html"><div class="ttname"><a href="classtf_1_1_executor.html">tf::Executor</a></div><div class="ttdoc">class to create an executor for running a taskflow graph</div><div class="ttdef"><b>定义</b> executor-dl.hpp:51</div></div>
<div class="ttc" id="aclasstf_1_1_small_vector_html"><div class="ttname"><a href="classtf_1_1_small_vector.html">tf::SmallVector</a></div><div class="ttdoc">class to define a vector optimized for small array</div><div class="ttdef"><b>定义</b> small_vector.hpp:927</div></div>
</div><!-- fragment --><dl class="section attention"><dt>注意</dt><dd>The return type of a multi-condition task is <a class="el" href="classtf_1_1_small_vector.html" title="class to define a vector optimized for small array">tf::SmallVector</a>, which provides C++ vector-style functionalities but comes with small buffer optimization.</dd></dl>
<p>One important application of conditional tasking is implementing <em>iterative control flow</em>. You can use multi-condition tasks to create multiple loops that run concurrently. The following code creates a sequential chain of four loops in which each loop increments a counter variable ten times. When the program completes, the value of the counter variable is <code>40</code>.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1_executor.html">tf::Executor</a> <a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>;</div>
<div class="line"><a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line">std::atomic&lt;int&gt; <a class="code hl_variable" href="events_8c.html#ac6c464b0a83a481fee26175f6229c5cc">counter</a>{0};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_define" href="sugar_8h.html#a8093cf142de43413a3649101cf95152c">loop</a> = [&amp;, <a class="code hl_variable" href="bench_vec_add_8cpp.html#a41689956983587b085f9da3e48f31d99">c</a> = <a class="code hl_define" href="sugar_8h.html#ae4f82344f573c70aa1066a2394bba345">int</a>(0)]() <span class="keyword">mutable</span> -&gt; <a class="code hl_class" href="classtf_1_1_small_vector.html">tf::SmallVector&lt;int&gt;</a> {</div>
<div class="line">  <a class="code hl_variable" href="events_8c.html#ac6c464b0a83a481fee26175f6229c5cc">counter</a>.fetch_add(1, std::memory_order_relaxed);</div>
<div class="line">  <span class="keywordflow">return</span> {++<a class="code hl_variable" href="bench_vec_add_8cpp.html#a41689956983587b085f9da3e48f31d99">c</a> &lt; 10 ? 0 : 1};</div>
<div class="line">};</div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_function" href="boing_8c.html#a2858154e2009b0e6e616f313177762bc">init</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;init&quot;</span>);</div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace(<a class="code hl_define" href="sugar_8h.html#a8093cf142de43413a3649101cf95152c">loop</a>).name(<span class="stringliteral">&quot;A&quot;</span>);</div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace(<a class="code hl_define" href="sugar_8h.html#a8093cf142de43413a3649101cf95152c">loop</a>).name(<span class="stringliteral">&quot;B&quot;</span>);</div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace(<a class="code hl_define" href="sugar_8h.html#a8093cf142de43413a3649101cf95152c">loop</a>).name(<span class="stringliteral">&quot;C&quot;</span>);</div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace(<a class="code hl_define" href="sugar_8h.html#a8093cf142de43413a3649101cf95152c">loop</a>).name(<span class="stringliteral">&quot;D&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="boing_8c.html#a2858154e2009b0e6e616f313177762bc">init</a>.precede(<a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>);</div>
<div class="line"><a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>.precede(<a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>, <a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>);</div>
<div class="line"><a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>.precede(<a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>, <a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>);</div>
<div class="line"><a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>.precede(<a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a>);</div>
<div class="line"><a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a>.precede(<a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a>);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.<a class="code hl_function" href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">run</a>(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).wait();  <span class="comment">// counter == 40</span></div>
<div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.dump(std::cout);</div>
<div class="line"> </div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;counter == &quot;</span> &lt;&lt; <a class="code hl_variable" href="events_8c.html#ac6c464b0a83a481fee26175f6229c5cc">counter</a> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="ttc" id="abench_vec_add_8cpp_html_a41689956983587b085f9da3e48f31d99"><div class="ttname"><a href="bench_vec_add_8cpp.html#a41689956983587b085f9da3e48f31d99">c</a></div><div class="ttdeci">Scalar Scalar * c</div><div class="ttdef"><b>定义</b> benchVecAdd.cpp:17</div></div>
<div class="ttc" id="aevents_8c_html_ac6c464b0a83a481fee26175f6229c5cc"><div class="ttname"><a href="events_8c.html#ac6c464b0a83a481fee26175f6229c5cc">counter</a></div><div class="ttdeci">static unsigned int counter</div><div class="ttdef"><b>定义</b> events.c:48</div></div>
<div class="ttc" id="asugar_8h_html_a8093cf142de43413a3649101cf95152c"><div class="ttname"><a href="sugar_8h.html#a8093cf142de43413a3649101cf95152c">loop</a></div><div class="ttdeci">#define loop</div><div class="ttdef"><b>定义</b> sugar.h:115</div></div>
<div class="ttc" id="asugar_8h_html_ae4f82344f573c70aa1066a2394bba345"><div class="ttname"><a href="sugar_8h.html#ae4f82344f573c70aa1066a2394bba345">int</a></div><div class="ttdeci">#define int</div><div class="ttdef"><b>定义</b> sugar.h:37</div></div>
</div><!-- fragment --><dl class="section attention"><dt>注意</dt><dd>It is your responsibility to ensure the return of a multi-condition task goes to a correct successor task. If a returned index falls outside the successor range of a multi-condition task, the scheduler will skip that index without doing anything. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
