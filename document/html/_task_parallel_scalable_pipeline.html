<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>source: Task-parallel Scalable Pipeline</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">source
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="搜索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_task_parallel_scalable_pipeline.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Task-parallel Scalable Pipeline</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>目录</h3>
<ul>
  <li class="level1">
    <a href="#IncludeTheScalablePipelineHeader">Include the Header</a>
  </li>
  <li class="level1">
    <a href="#CreateAScalablePipelineModuleTask">Create a Scalable Pipeline Module Task</a>
  </li>
  <li class="level1">
    <a href="#ResetAPlaceholderScalablePipeline">Reset a Placeholder Scalable Pipeline</a>
  </li>
  <li class="level1">
    <a href="#ScalablePipelineUseOtherIteratorTypes">Use Other Iterator Types</a>
  </li>
  <li class="level1">
    <a href="#ParallelScalablePipelineLearnMore">Learn More about Taskflow Pipeline</a>
  </li>
</ul>
</div>
<div class="textblock"><p>Unlike <a class="el" href="classtf_1_1_pipeline.html" title="class to create a pipeline scheduling framework">tf::Pipeline</a> (see <a class="el" href="_task_parallel_pipeline.html">Task-parallel Pipeline</a>) that instantiates all pipes at the construction time, Taskflow provides a scalable alternative called <a class="el" href="classtf_1_1_scalable_pipeline.html" title="class to create a scalable pipeline object">tf::ScalablePipeline</a> to allow variable assignments of pipes using range iterators. <a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> scalable pipeline is thus more flexible for applications to create a pipeline scheduling framework whose pipeline structure depends on runtime variables.</p>
<h1><a class="anchor" id="IncludeTheScalablePipelineHeader"></a>
Include the Header</h1>
<p>You need to include the header file, <code>taskflow/algorithm/pipeline.hpp</code>, for creating a scalable pipeline scheduling framework.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="taskflow_2algorithm_2pipeline_8hpp.html">taskflow/algorithm/pipeline.hpp</a>&gt;</span></div>
<div class="ttc" id="ataskflow_2algorithm_2pipeline_8hpp_html"><div class="ttname"><a href="taskflow_2algorithm_2pipeline_8hpp.html">pipeline.hpp</a></div><div class="ttdoc">pipeline include file</div></div>
</div><!-- fragment --><h1><a class="anchor" id="CreateAScalablePipelineModuleTask"></a>
Create a Scalable Pipeline Module Task</h1>
<p>Similar to <a class="el" href="classtf_1_1_pipeline.html" title="class to create a pipeline scheduling framework">tf::Pipeline</a>, <a class="el" href="classtf_1_1_scalable_pipeline.html" title="class to create a scalable pipeline object">tf::ScalablePipeline</a> is a composable graph object to implement a <em>pipeline scheduling framework</em> in a taskflow. The key difference between <a class="el" href="classtf_1_1_pipeline.html" title="class to create a pipeline scheduling framework">tf::Pipeline</a> and <a class="el" href="classtf_1_1_scalable_pipeline.html" title="class to create a scalable pipeline object">tf::ScalablePipeline</a> is that a scalable pipeline can accept <em>variable</em> assignments of pipes rather than instantiating all pipes at construction or programming time. Users define a linear range of pipes, each of the same callable type, and apply that range to construct a scalable pipeline. Between successive runs, users can reset the pipeline to a different range of pipes. The following code creates a scalable pipeline that uses four parallel lines to schedule tokens through three serial pipes in the given vector, then resetting that pipeline to a new range of five serial pipes:</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>(<span class="stringliteral">&quot;pipeline&quot;</span>);</div>
<div class="line"><a class="code hl_class" href="classtf_1_1_executor.html">tf::Executor</a> <a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> num_lines = 4;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// create data storage</span></div>
<div class="line">std::array&lt;int, num_lines&gt; <a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// define the pipe callable</span></div>
<div class="line"><span class="keyword">auto</span> pipe_callable = [&amp;<a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a>] (<a class="code hl_class" href="classtf_1_1_pipeflow.html">tf::Pipeflow</a>&amp; pf) <span class="keyword">mutable</span> {</div>
<div class="line">  <span class="keywordflow">switch</span>(pf.pipe()) {</div>
<div class="line">    <span class="comment">// first stage generates only 5 scheduling tokens and saves the </span></div>
<div class="line">    <span class="comment">// token number into the buffer.</span></div>
<div class="line">    <span class="keywordflow">case</span> 0: {</div>
<div class="line">      <span class="keywordflow">if</span>(pf.token() == 5) {</div>
<div class="line">        pf.stop();</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> {</div>
<div class="line">        <a class="code hl_function" href="printf_8h.html#aee3ed3a831f25f07e7be3919fff2203a">printf</a>(<span class="stringliteral">&quot;stage 1: input token = %zu\n&quot;</span>, pf.token());</div>
<div class="line">        <a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a>[pf.line()] = pf.token();</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// other stages propagate the previous result to this pipe and</span></div>
<div class="line">    <span class="comment">// increment it by one</span></div>
<div class="line">    <span class="keywordflow">default</span>: {</div>
<div class="line">      <a class="code hl_function" href="printf_8h.html#aee3ed3a831f25f07e7be3919fff2203a">printf</a>(</div>
<div class="line">        <span class="stringliteral">&quot;stage %zu: input buffer[%zu] = %d\n&quot;</span>, pf.pipe(), pf.line(), <a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a>[pf.line()]</div>
<div class="line">      );</div>
<div class="line">      <a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a>[pf.line()] = <a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a>[pf.line()] + 1;</div>
<div class="line">    } </div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// create a vector of three pipes</span></div>
<div class="line">std::vector&lt; tf::Pipe&lt;std::function&lt;<a class="code hl_variable" href="ittnotify__static_8h.html#a61af67d9d838a9497ca5b188dabc1aa0">void</a>(tf::Pipeflow&amp;)&gt;&gt; &gt; pipes;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;3; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line">  pipes.emplace_back(<a class="code hl_enumvalue" href="namespacetf.html#abb7a11e41fd457f69e7ff45d4c769564a7b804a28d6154ab8007287532037f1d0">tf::PipeType::SERIAL</a>, pipe_callable);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// create a pipeline of four parallel lines based on the given vector of pipes</span></div>
<div class="line">tf::ScalablePipeline pl(num_lines, pipes.begin(), pipes.end());</div>
<div class="line"> </div>
<div class="line"><span class="comment">// build the pipeline graph using composition</span></div>
<div class="line">tf::Task <a class="code hl_function" href="boing_8c.html#a2858154e2009b0e6e616f313177762bc">init</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){ std::cout &lt;&lt; <span class="stringliteral">&quot;ready\n&quot;</span>; })</div>
<div class="line">                        .<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;starting pipeline&quot;</span>);</div>
<div class="line">tf::Task <a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.composed_of(pl)</div>
<div class="line">                        .name(<span class="stringliteral">&quot;pipeline&quot;</span>);</div>
<div class="line">tf::Task stop = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([](){ std::cout &lt;&lt; <span class="stringliteral">&quot;stopped\n&quot;</span>; })</div>
<div class="line">                        .<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;pipeline stopped&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// create task dependency</span></div>
<div class="line"><a class="code hl_function" href="boing_8c.html#a2858154e2009b0e6e616f313177762bc">init</a>.precede(<a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a>);</div>
<div class="line"><a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a>.precede(stop);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// dump the pipeline graph structure (with composition)</span></div>
<div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.dump(std::cout);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// run the pipeline</span></div>
<div class="line"><a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.<a class="code hl_function" href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">run</a>(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).wait();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// reset the pipeline to a new range of five pipes and starts from</span></div>
<div class="line"><span class="comment">// the initial state (i.e., token counts from zero)</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;2; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line">  pipes.emplace_back(<a class="code hl_enumvalue" href="namespacetf.html#abb7a11e41fd457f69e7ff45d4c769564a7b804a28d6154ab8007287532037f1d0">tf::PipeType::SERIAL</a>, pipe_callable);</div>
<div class="line">}</div>
<div class="line">pl.reset(pipes.begin(), pipes.end());</div>
<div class="line"> </div>
<div class="line"><a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.<a class="code hl_function" href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">run</a>(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).wait();</div>
<div class="ttc" id="a_bi_c_g_s_t_a_b__step__by__step_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>定义</b> BiCGSTAB_step_by_step.cpp:9</div></div>
<div class="ttc" id="aboing_8c_html_a2858154e2009b0e6e616f313177762bc"><div class="ttname"><a href="boing_8c.html#a2858154e2009b0e6e616f313177762bc">init</a></div><div class="ttdeci">void init(void)</div><div class="ttdef"><b>定义</b> boing.c:182</div></div>
<div class="ttc" id="aclasstf_1_1_executor_html"><div class="ttname"><a href="classtf_1_1_executor.html">tf::Executor</a></div><div class="ttdoc">class to create an executor for running a taskflow graph</div><div class="ttdef"><b>定义</b> executor-dl.hpp:51</div></div>
<div class="ttc" id="aclasstf_1_1_executor_html_a519777f5783981d534e9e53b99712069"><div class="ttname"><a href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">tf::Executor::run</a></div><div class="ttdeci">tf::Future&lt; void &gt; run(Taskflow &amp;taskflow)</div><div class="ttdoc">runs a taskflow once</div><div class="ttdef"><b>定义</b> executor-dl.hpp:2067</div></div>
<div class="ttc" id="aclasstf_1_1_pipeflow_html"><div class="ttname"><a href="classtf_1_1_pipeflow.html">tf::Pipeflow</a></div><div class="ttdoc">class to create a pipeflow object used by the pipe callable</div><div class="ttdef"><b>定义</b> pipeline.hpp:102</div></div>
<div class="ttc" id="aclasstf_1_1_taskflow_html"><div class="ttname"><a href="classtf_1_1_taskflow.html">tf::Taskflow</a></div><div class="ttdoc">class to create a taskflow object</div><div class="ttdef"><b>定义</b> taskflow.hpp:67</div></div>
<div class="ttc" id="aimgui__impl__opengl3__loader_8h_html_aab18cfce5ee7c6881ae04f18be70d94a"><div class="ttname"><a href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a></div><div class="ttdeci">const GLchar * name</div><div class="ttdef"><b>定义</b> imgui_impl_opengl3_loader.h:312</div></div>
<div class="ttc" id="aittnotify__static_8h_html_a61af67d9d838a9497ca5b188dabc1aa0"><div class="ttname"><a href="ittnotify__static_8h.html#a61af67d9d838a9497ca5b188dabc1aa0">void</a></div><div class="ttdeci">void</div><div class="ttdef"><b>定义</b> ittnotify_static.h:91</div></div>
<div class="ttc" id="anamespacetf_html_abb7a11e41fd457f69e7ff45d4c769564a7b804a28d6154ab8007287532037f1d0"><div class="ttname"><a href="namespacetf.html#abb7a11e41fd457f69e7ff45d4c769564a7b804a28d6154ab8007287532037f1d0">tf::PipeType::SERIAL</a></div><div class="ttdeci">@ SERIAL</div><div class="ttdoc">serial type</div><div class="ttdef"><b>定义</b> pipeline.hpp:201</div></div>
<div class="ttc" id="apoisson_8hpp_html_aa56fe360bb0ae38e0082f49e394ff825"><div class="ttname"><a href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a></div><div class="ttdeci">void taskflow(int nx, int ny, double dx, double dy, double *f, int itold, int itnew, double *u, double *unew, int block_size, unsigned num_threads)</div><div class="ttdef"><b>定义</b> taskflow.cpp:6</div></div>
<div class="ttc" id="aprintf_8h_html_aee3ed3a831f25f07e7be3919fff2203a"><div class="ttname"><a href="printf_8h.html#aee3ed3a831f25f07e7be3919fff2203a">printf</a></div><div class="ttdeci">auto printf(string_view fmt, const T &amp;... args) -&gt; int</div><div class="ttdef"><b>定义</b> printf.h:621</div></div>
<div class="ttc" id="asugar_8h_html_aaadc06b5dac8070de2c8677210967bdb"><div class="ttname"><a href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a></div><div class="ttdeci">#define buffer</div><div class="ttdef"><b>定义</b> sugar.h:84</div></div>
<div class="ttc" id="atest__partitioner__whitebox_8h_html_a5c4cf3d37a4eee22275de22cb9619863"><div class="ttname"><a href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a></div><div class="ttdeci">#define task</div><div class="ttdef"><b>定义</b> test_partitioner_whitebox.h:76</div></div>
<div class="ttc" id="athread__pool_8cpp_html_a543e564a8407bbeac15cb2d929fec755"><div class="ttname"><a href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a></div><div class="ttdeci">tf::Executor executor</div><div class="ttdef"><b>定义</b> thread_pool.cpp:6</div></div>
</div><!-- fragment --><p>The program defines a uniform pipe type of <code>tf::Pipe&lt;std::function&lt;void(tf::Pipeflow&amp;)&gt;&gt;</code> and keep all pipes in a vector that is amenable to change. Then, it constructs a scalable pipeline using two range iterators, <code>[first, last)</code>, that point to the beginning and the end of the pipe vector, resulting in a pipeline of three serial stages:</p>
<p>Then, the program appends another two pipes into the vector and resets the pipeline to the new range of two additional pipes, resulting in a pipeline of five serial stages:</p>
<p>When resetting a scalable pipeline to a new range, it will start from the initial state as if it has just been constructed, i.e., the token number counts from zero.</p>
<dl class="section attention"><dt>注意</dt><dd>Unlike <a class="el" href="classtf_1_1_pipeline.html" title="class to create a pipeline scheduling framework">tf::Pipeline</a> that keeps the given pipes in a std::tuple object, <a class="el" href="classtf_1_1_scalable_pipeline.html" title="class to create a scalable pipeline object">tf::ScalablePipeline</a> does not own the given pipe but maintains a vector of iterators to each pipe in the given range. It is your responsibility to keep those pipe objects alive during the execution of the pipeline task.</dd></dl>
<h1><a class="anchor" id="ResetAPlaceholderScalablePipeline"></a>
Reset a Placeholder Scalable Pipeline</h1>
<p>It is possible to create a scalable pipeline as a placeholder using the constructor <a class="el" href="classtf_1_1_scalable_pipeline.html" title="class to create a scalable pipeline object">tf::ScalablePipeline(size_t num_lines)</a> and reset it to another range later in the application. The following code creates a task to emplace a range of pipes and reset the pipeline to that range, before running the pipeline task:</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1_executor.html">tf::Executor</a> <a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>;</div>
<div class="line"><a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">size_t</span> num_pipes = 10;</div>
<div class="line"><span class="keywordtype">size_t</span> num_lines = 10;</div>
<div class="line"> </div>
<div class="line">std::vector&lt;<a class="code hl_class" href="classtf_1_1_pipe.html">tf::Pipe</a>&lt;std::function&lt;<a class="code hl_variable" href="ittnotify__static_8h.html#a61af67d9d838a9497ca5b188dabc1aa0">void</a>(<a class="code hl_class" href="classtf_1_1_pipeflow.html">tf::Pipeflow</a>&amp;)&gt;&gt;&gt; pipes;</div>
<div class="line"><a class="code hl_class" href="classtf_1_1_scalable_pipeline.html">tf::ScalablePipeline</a>&lt;<span class="keyword">typename</span> <span class="keyword">decltype</span>(pipes)::iterator&gt; spl(num_lines); </div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_struct" href="structinit.html">init</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;](){</div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;num_pipes; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line">    pipes.emplace_back(<a class="code hl_enumvalue" href="namespacetf.html#abb7a11e41fd457f69e7ff45d4c769564a7b804a28d6154ab8007287532037f1d0">tf::PipeType::SERIAL</a>, [&amp;](<a class="code hl_class" href="classtf_1_1_pipeflow.html">tf::Pipeflow</a>&amp; pf) { </div>
<div class="line">      <span class="keywordflow">if</span>(pf.<a class="code hl_function" href="classtf_1_1_pipeflow.html#a4914c1f381a3016e98285b019cf60d6d">pipe</a>() == 0 &amp;&amp; pf.<a class="code hl_function" href="classtf_1_1_pipeflow.html#a295e5d884665c076f4ef5d78139f7c51">token</a>() == 1024) {</div>
<div class="line">        pf.<a class="code hl_function" href="classtf_1_1_pipeflow.html#a830b7f204cb87fff17e8d424918d9453">stop</a>();</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">      }</div>
<div class="line">    });</div>
<div class="line">  }</div>
<div class="line">  spl.reset(pipes.begin(), pipes.end());</div>
<div class="line">}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;init&quot;</span>);</div>
<div class="line"> </div>
<div class="line">tf::Task pipeline = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.composed_of(spl).name(<span class="stringliteral">&quot;pipeline&quot;</span>);</div>
<div class="line">pipeline.<a class="code hl_function" href="classtf_1_1_task.html#a331b1b726555072e7c7d10941257f664">succeed</a>(<a class="code hl_function" href="boing_8c.html#a2858154e2009b0e6e616f313177762bc">init</a>);</div>
<div class="line"><a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.<a class="code hl_function" href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">run</a>(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).wait();  </div>
<div class="ttc" id="aclasstf_1_1_pipe_html"><div class="ttname"><a href="classtf_1_1_pipe.html">tf::Pipe</a></div><div class="ttdoc">class to create a pipe object for a pipeline stage</div><div class="ttdef"><b>定义</b> pipeline.hpp:228</div></div>
<div class="ttc" id="aclasstf_1_1_pipeflow_html_a295e5d884665c076f4ef5d78139f7c51"><div class="ttname"><a href="classtf_1_1_pipeflow.html#a295e5d884665c076f4ef5d78139f7c51">tf::Pipeflow::token</a></div><div class="ttdeci">size_t token() const</div><div class="ttdoc">queries the token identifier</div><div class="ttdef"><b>定义</b> pipeline.hpp:137</div></div>
<div class="ttc" id="aclasstf_1_1_pipeflow_html_a4914c1f381a3016e98285b019cf60d6d"><div class="ttname"><a href="classtf_1_1_pipeflow.html#a4914c1f381a3016e98285b019cf60d6d">tf::Pipeflow::pipe</a></div><div class="ttdeci">size_t pipe() const</div><div class="ttdoc">queries the pipe identifier of the present token</div><div class="ttdef"><b>定义</b> pipeline.hpp:130</div></div>
<div class="ttc" id="aclasstf_1_1_pipeflow_html_a830b7f204cb87fff17e8d424918d9453"><div class="ttname"><a href="classtf_1_1_pipeflow.html#a830b7f204cb87fff17e8d424918d9453">tf::Pipeflow::stop</a></div><div class="ttdeci">void stop()</div><div class="ttdoc">stops the pipeline scheduling</div><div class="ttdef"><b>定义</b> pipeline.hpp:147</div></div>
<div class="ttc" id="aclasstf_1_1_scalable_pipeline_html"><div class="ttname"><a href="classtf_1_1_scalable_pipeline.html">tf::ScalablePipeline</a></div><div class="ttdoc">class to create a scalable pipeline object</div><div class="ttdef"><b>定义</b> pipeline.hpp:1072</div></div>
<div class="ttc" id="aclasstf_1_1_task_html"><div class="ttname"><a href="classtf_1_1_task.html">tf::Task</a></div><div class="ttdoc">class to create a task handle over a node in a taskflow graph</div><div class="ttdef"><b>定义</b> task.hpp:150</div></div>
<div class="ttc" id="aclasstf_1_1_task_html_a331b1b726555072e7c7d10941257f664"><div class="ttname"><a href="classtf_1_1_task.html#a331b1b726555072e7c7d10941257f664">tf::Task::succeed</a></div><div class="ttdeci">Task &amp; succeed(Ts &amp;&amp;... tasks)</div><div class="ttdoc">adds precedence links from other tasks to this</div><div class="ttdef"><b>定义</b> task.hpp:402</div></div>
<div class="ttc" id="astructinit_html"><div class="ttname"><a href="structinit.html">init</a></div><div class="ttdef"><b>定义</b> TutorialInplaceLU.cpp:2</div></div>
</div><!-- fragment --><p>The task graph of this program is shown below:</p>
<dl class="section attention"><dt>注意</dt><dd>It is your responsibility to ensure a scalable pipeline has a valid structure before running it. <a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> valid pipeline must have at least one parallel line and one pipe, where the first pipe is a serial type.</dd></dl>
<p>Similarly, you can create an empty scalable pipeline using the default constructor <a class="el" href="classtf_1_1_scalable_pipeline.html" title="class to create a scalable pipeline object">tf::ScalablePipeline()</a> and reset it later in your program.</p>
<div class="fragment"><div class="line">std::vector&lt;<a class="code hl_class" href="classtf_1_1_pipe.html">tf::Pipe</a>&lt;std::function&lt;<a class="code hl_variable" href="ittnotify__static_8h.html#a61af67d9d838a9497ca5b188dabc1aa0">void</a>(<a class="code hl_class" href="classtf_1_1_pipeflow.html">tf::Pipeflow</a>&amp;)&gt;&gt;&gt; pipes;</div>
<div class="line"><a class="code hl_class" href="classtf_1_1_scalable_pipeline.html">tf::ScalablePipeline</a>&lt;<span class="keyword">typename</span> <span class="keyword">decltype</span>(pipes)::iterator&gt; spl; </div>
<div class="line"><span class="comment">// create pipes ...</span></div>
<div class="line">spl.<a class="code hl_function" href="classtf_1_1_scalable_pipeline.html#a940a8de7b53ac5cbd59c55091d88c88f">reset</a>(num_lines, pipes.begin(), pipes.end());</div>
<div class="ttc" id="aclasstf_1_1_scalable_pipeline_html_a940a8de7b53ac5cbd59c55091d88c88f"><div class="ttname"><a href="classtf_1_1_scalable_pipeline.html#a940a8de7b53ac5cbd59c55091d88c88f">tf::ScalablePipeline::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdoc">resets the pipeline</div><div class="ttdef"><b>定义</b> pipeline.hpp:1473</div></div>
</div><!-- fragment --><h1><a class="anchor" id="ScalablePipelineUseOtherIteratorTypes"></a>
Use Other Iterator Types</h1>
<p>When assigning a range to a scalable pipeline, the pipeline fetches all pipe iterators in that range to an internal vector. This organization allows invoking a pipe callable to be a random accessible operation, regardless of the pipe container type. Taskflow does not have much restriction on the iterator type, as long as these pipes can be iterated in a sequential order using the postfix increment operator, <code>++</code>.</p>
<div class="fragment"><div class="line"><span class="comment">// use vector to store pipes</span></div>
<div class="line">std::vector&lt;<a class="code hl_class" href="classtf_1_1_pipe.html">tf::Pipe</a>&lt;std::function&lt;<a class="code hl_variable" href="ittnotify__static_8h.html#a61af67d9d838a9497ca5b188dabc1aa0">void</a>(<a class="code hl_class" href="classtf_1_1_pipeflow.html">tf::Pipeflow</a>&amp;)&gt;&gt;&gt; <a class="code hl_define" href="ppc__define_8c.html#add93f942eb3d18a8f8e108404869156f">vector</a>;</div>
<div class="line"><a class="code hl_class" href="classtf_1_1_scalable_pipeline.html">tf::ScalablePipeline</a> spl1(num_lines, <a class="code hl_define" href="ppc__define_8c.html#add93f942eb3d18a8f8e108404869156f">vector</a>.begin(), <a class="code hl_define" href="ppc__define_8c.html#add93f942eb3d18a8f8e108404869156f">vector</a>.end());</div>
<div class="line"> </div>
<div class="line"><span class="comment">// use list to store pipes</span></div>
<div class="line">std::list&lt;<a class="code hl_class" href="classtf_1_1_pipe.html">tf::Pipe</a>&lt;std::function&lt;<a class="code hl_variable" href="ittnotify__static_8h.html#a61af67d9d838a9497ca5b188dabc1aa0">void</a>(<a class="code hl_class" href="classtf_1_1_pipeflow.html">tf::Pipeflow</a>&amp;)&gt;&gt;&gt; list;</div>
<div class="line"><a class="code hl_class" href="classtf_1_1_scalable_pipeline.html">tf::ScalablePipeline</a> spl2(num_lines, list.begin(), list.end());</div>
<div class="ttc" id="appc__define_8c_html_add93f942eb3d18a8f8e108404869156f"><div class="ttname"><a href="ppc__define_8c.html#add93f942eb3d18a8f8e108404869156f">vector</a></div><div class="ttdeci">#define vector</div><div class="ttdef"><b>定义</b> ppc_define.c:42</div></div>
</div><!-- fragment --><h1><a class="anchor" id="ParallelScalablePipelineLearnMore"></a>
Learn More about Taskflow Pipeline</h1>
<p>Visit the following pages to learn more about pipeline:</p>
<ul>
<li><a class="el" href="_task_parallel_pipeline.html">Task-parallel Pipeline</a></li>
<li><a class="el" href="_data_parallel_pipeline.html">Data-parallel Pipeline</a></li>
<li><a class="el" href="_text_processing_pipeline.html">Text Processing Pipeline</a></li>
<li><a class="el" href="_graph_processing_pipeline.html">Graph Processing Pipeline</a></li>
<li><a class="el" href="_taskflow_processing_pipeline.html">Taskflow Processing Pipeline</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
