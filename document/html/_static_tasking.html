<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>source: Static Tasking</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">source
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="搜索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_static_tasking.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Static Tasking</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>目录</h3>
<ul>
  <li class="level1">
    <a href="#CreateATaskDependencyGraph">Create a Task Dependency Graph</a>
  </li>
  <li class="level1">
    <a href="#VisualizeATaskDependencyGraph">Visualize a Task Dependency Graph</a>
  </li>
  <li class="level1">
    <a href="#ModifyTaskAttributes">Modify Task Attributes</a>
  </li>
  <li class="level1">
    <a href="#TraverseAdjacentTasks">Traverse Adjacent Tasks</a>
  </li>
  <li class="level1">
    <a href="#AttachUserDataToATask">Attach User Data to a Task</a>
  </li>
  <li class="level1">
    <a href="#UnderstandTheLifetimeOfATask">Understand the Lifetime of a Task</a>
  </li>
  <li class="level1">
    <a href="#MoveATaskflow">Move a Taskflow</a>
  </li>
</ul>
</div>
<div class="textblock"><p>This chapter demonstrates how to create a static task dependency graph. <a class="el" href="class_static.html">Static</a> tasking captures the static parallel structure of a decomposition and is defined only by the program itself. It has a flat task hierarchy and cannot spawn new tasks from a running dependency graph.</p>
<h1><a class="anchor" id="CreateATaskDependencyGraph"></a>
Create a Task Dependency Graph</h1>
<p><a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> task in Taskflow is a <em>callable</em> object for which the operation @std_invoke is applicable. It can be either a functor, a lambda expression, a bind expression, or a class objects with <code>operator()</code> overloaded. All tasks are created from <a class="el" href="classtf_1_1_taskflow.html" title="class to create a taskflow object">tf::Taskflow</a>, the class that manages a task dependency graph. Taskflow provides two methods, <a class="el" href="classtf_1_1_flow_builder.html#acab0b4ac82260f47fdb36a3244ee3aaf" title="creates a placeholder task">tf::Taskflow::placeholder</a> and <a class="el" href="classtf_1_1_flow_builder.html#a60d7a666cab71ecfa3010b2efb0d6b57" title="creates a static task">tf::Taskflow::emplace</a> to create a task.</p>
<div class="fragment"><div class="line">1: <a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line">2: <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.placeholder();</div>
<div class="line">3: <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([] () { std::cout &lt;&lt; <span class="stringliteral">&quot;task B\n&quot;</span>; });</div>
<div class="line">4:</div>
<div class="line">5: <span class="keyword">auto</span> [<a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a>, <a class="code hl_define" href="sandbox_2strassen_2omp_8cpp.html#a4bfa035cad7c3258704669810cd5de5d">E</a>, <a class="code hl_variable" href="test__flow__graph_8cpp.html#a1c83625ec20fd09ecaf0e5b37c75f6f8">F</a>] = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace(</div>
<div class="line">6:   [](){ std::cout &lt;&lt; <span class="stringliteral">&quot;Task A\n&quot;</span>; },</div>
<div class="line">7:   [](){ std::cout &lt;&lt; <span class="stringliteral">&quot;Task B\n&quot;</span>; },</div>
<div class="line">8:   [](){ std::cout &lt;&lt; <span class="stringliteral">&quot;Task C\n&quot;</span>; }</div>
<div class="line">9: );</div>
<div class="ttc" id="a_eigen_solver___eigen_solver___matrix_type_8cpp_html_a925331f9b6e4844293d36a8df2256d38"><div class="ttname"><a href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a></div><div class="ttdeci">MatrixXcd D</div><div class="ttdef"><b>定义</b> EigenSolver_EigenSolver_MatrixType.cpp:14</div></div>
<div class="ttc" id="abench__gemm_8cpp_html_a37a83060ac796961b44991c836f083f7"><div class="ttname"><a href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a></div><div class="ttdeci">Matrix&lt; SCALARB, Dynamic, Dynamic &gt; B</div><div class="ttdef"><b>定义</b> bench_gemm.cpp:36</div></div>
<div class="ttc" id="abench__gemm_8cpp_html_addc86e8508f14411ec98f521c520f875"><div class="ttname"><a href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a></div><div class="ttdeci">Matrix&lt; SCALARA, Dynamic, Dynamic &gt; A</div><div class="ttdef"><b>定义</b> bench_gemm.cpp:35</div></div>
<div class="ttc" id="aclasstf_1_1_task_html"><div class="ttname"><a href="classtf_1_1_task.html">tf::Task</a></div><div class="ttdoc">class to create a task handle over a node in a taskflow graph</div><div class="ttdef"><b>定义</b> task.hpp:150</div></div>
<div class="ttc" id="aclasstf_1_1_taskflow_html"><div class="ttname"><a href="classtf_1_1_taskflow.html">tf::Taskflow</a></div><div class="ttdoc">class to create a taskflow object</div><div class="ttdef"><b>定义</b> taskflow.hpp:67</div></div>
<div class="ttc" id="apoisson_8hpp_html_aa56fe360bb0ae38e0082f49e394ff825"><div class="ttname"><a href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a></div><div class="ttdeci">void taskflow(int nx, int ny, double dx, double dy, double *f, int itold, int itnew, double *u, double *unew, int block_size, unsigned num_threads)</div><div class="ttdef"><b>定义</b> taskflow.cpp:6</div></div>
<div class="ttc" id="asandbox_2strassen_2omp_8cpp_html_a4bfa035cad7c3258704669810cd5de5d"><div class="ttname"><a href="sandbox_2strassen_2omp_8cpp.html#a4bfa035cad7c3258704669810cd5de5d">E</a></div><div class="ttdeci">#define E(Matrix)</div></div>
<div class="ttc" id="atest__flow__graph_8cpp_html_a1c83625ec20fd09ecaf0e5b37c75f6f8"><div class="ttname"><a href="test__flow__graph_8cpp.html#a1c83625ec20fd09ecaf0e5b37c75f6f8">F</a></div><div class="ttdeci">const int F</div><div class="ttdef"><b>定义</b> test_flow_graph.cpp:60</div></div>
</div><!-- fragment --><p>Debrief: </p><ul>
<li>Line 1 creates a taskflow object, or a <em>graph</em> </li>
<li>Line 2 creates a placeholder task without work (i.e., callable) </li>
<li>Line 3 creates a task from a given callable object and returns a task handle </li>
<li>Lines 5-9 create three tasks in one call using C++ structured binding coupled with std::tuple</li>
</ul>
<p>Each time you create a task, the taskflow object creates a node in the task graph and returns a task handle of type <a class="el" href="classtf_1_1_task.html" title="class to create a task handle over a node in a taskflow graph">tf::Task</a>. <a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> task handle is a lightweight object that wraps up a particular node in a graph and provides a set of methods for you to assign different attributes to the task such as adding dependencies, naming, and assigning a new work.</p>
<div class="fragment"><div class="line"> 1: <a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"> 2: <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([] () { std::cout &lt;&lt; <span class="stringliteral">&quot;create a task A\n&quot;</span>; });</div>
<div class="line"> 3: <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([] () { std::cout &lt;&lt; <span class="stringliteral">&quot;create a task B\n&quot;</span>; });</div>
<div class="line"> 4:</div>
<div class="line"> 5: <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>.name(<span class="stringliteral">&quot;TaskA&quot;</span>);</div>
<div class="line"> 6: <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>.work([] () { std::cout &lt;&lt; <span class="stringliteral">&quot;reassign A to a new callable\n&quot;</span>; });</div>
<div class="line"> 7: <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>.precede(<a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>);</div>
<div class="line"> 8:</div>
<div class="line"> 9: std::cout &lt;&lt; <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>.name() &lt;&lt; std::endl;            <span class="comment">// TaskA</span></div>
<div class="line">10: std::cout &lt;&lt; <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>.num_successors() &lt;&lt; std::endl;  <span class="comment">// 1</span></div>
<div class="line">11: std::cout &lt;&lt; <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>.num_predecessors() &lt;&lt; std::endl;  <span class="comment">// 0</span></div>
<div class="line">12: </div>
<div class="line">13: std::cout &lt;&lt; <a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>.num_successors() &lt;&lt; std::endl;  <span class="comment">// 0</span></div>
<div class="line">14: std::cout &lt;&lt; <a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>.num_predecessors() &lt;&lt; std::endl;  <span class="comment">// 1</span></div>
</div><!-- fragment --><p>Debrief: </p><ul>
<li>Line 1 creates a taskflow object </li>
<li>Lines 2-3 create two tasks <a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> and <a class="el" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a> </li>
<li>Lines 5-6 assign a name and a work to task <a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>, and add a precedence link to task <a class="el" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a> </li>
<li>Line 7 adds a dependency link from <a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> to <a class="el" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a> </li>
<li>Lines 9-14 dump the task attributes</li>
</ul>
<p>Taskflow uses general-purpose polymorphic function wrapper, std::function, to store and invoke a callable in a task. You need to follow its contract to create a task. For example, the callable to construct a task must be copyable, and thus the code below won't compile:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([<a class="code hl_variable" href="yyjson_8h.html#a26c622783fa717b24fe0bbd3e060f74a">ptr</a>=std::make_unique&lt;int&gt;(1)](){</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;captured unique pointer is not copyable&quot;</span>;</div>
<div class="line">});</div>
<div class="ttc" id="ayyjson_8h_html_a26c622783fa717b24fe0bbd3e060f74a"><div class="ttname"><a href="yyjson_8h.html#a26c622783fa717b24fe0bbd3e060f74a">ptr</a></div><div class="ttdeci">const char * ptr</div><div class="ttdef"><b>定义</b> yyjson.h:7639</div></div>
</div><!-- fragment --><h1><a class="anchor" id="VisualizeATaskDependencyGraph"></a>
Visualize a Task Dependency Graph</h1>
<p>You can dump a taskflow to a DOT format and visualize the graph using free online tools such as <a href="https://dreampuf.github.io/GraphvizOnline/">GraphvizOnline</a> and <a href="http://www.webgraphviz.com/">WebGraphviz</a>.</p>
<div class="fragment"><div class="line"> 1: #include &lt;<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>/<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.hpp&gt;</div>
<div class="line"> 2:</div>
<div class="line"> 3: <span class="keywordtype">int</span> <a class="code hl_function" href="main-override-static_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div>
<div class="line"> 4: </div>
<div class="line"> 5:   <a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"> 6:</div>
<div class="line"> 7:   <span class="comment">// create a task dependency graph</span></div>
<div class="line"> 8:   <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([] () { std::cout &lt;&lt; <span class="stringliteral">&quot;Task A\n&quot;</span>; });</div>
<div class="line"> 9:   <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([] () { std::cout &lt;&lt; <span class="stringliteral">&quot;Task B\n&quot;</span>; });</div>
<div class="line">10:   <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([] () { std::cout &lt;&lt; <span class="stringliteral">&quot;Task C\n&quot;</span>; });</div>
<div class="line">11:   tf::Task <a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([] () { std::cout &lt;&lt; <span class="stringliteral">&quot;Task D\n&quot;</span>; });</div>
<div class="line">12:</div>
<div class="line">13:   <span class="comment">// add dependency links</span></div>
<div class="line">14:   <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>.precede(<a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>); </div>
<div class="line">15:   <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>.precede(<a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>);</div>
<div class="line">16:   <a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>.precede(<a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a>);</div>
<div class="line">17:   <a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>.precede(<a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a>);</div>
<div class="line">18:</div>
<div class="line">19:   <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.dump(std::cout);</div>
<div class="line">20: }</div>
<div class="ttc" id="amain-override-static_8c_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="main-override-static_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>定义</b> main-override-static.c:32</div></div>
<div class="ttc" id="atest__buffer__node_8cpp_html_ac4cf4b2ab929bd23951a8676eeac086b"><div class="ttname"><a href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a></div><div class="ttdeci">#define C</div><div class="ttdef"><b>定义</b> test_buffer_node.cpp:28</div></div>
</div><!-- fragment --><p>Debrief: </p><ul>
<li>Line 5 creates a taskflow object </li>
<li>Lines 8-11 create four tasks </li>
<li>Lines 14-17 add four task dependencies </li>
<li>Line 19 dumps the taskflow in the DOT format through standard output</li>
</ul>
<h1><a class="anchor" id="ModifyTaskAttributes"></a>
Modify Task Attributes</h1>
<p>This example demonstrates how to modify a task's attributes using methods defined in the task handler.</p>
<div class="fragment"><div class="line"> 1: #include &lt;<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>/<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.hpp&gt;</div>
<div class="line"> 2:</div>
<div class="line"> 3: <span class="keywordtype">int</span> <a class="code hl_function" href="main-override-static_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div>
<div class="line"> 4:</div>
<div class="line"> 5:   <a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"> 6:</div>
<div class="line"> 7:   std::vector&lt;tf::Task&gt; tasks = { </div>
<div class="line"> 8:     <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.placeholder(),         <span class="comment">// create a task with no work</span></div>
<div class="line"> 9:     <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.placeholder()          <span class="comment">// create a task with no work</span></div>
<div class="line">10:   };</div>
<div class="line">11:</div>
<div class="line">12:   tasks[0].name(<span class="stringliteral">&quot;This is Task 0&quot;</span>);</div>
<div class="line">13:   tasks[1].name(<span class="stringliteral">&quot;This is Task 1&quot;</span>);</div>
<div class="line">14:   tasks[0].precede(tasks[1]);</div>
<div class="line">15:</div>
<div class="line">16:   <span class="keywordflow">for</span>(<span class="keyword">auto</span> <a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a> : tasks) {          <span class="comment">// print out each task&#39;s attributes</span></div>
<div class="line">17:     std::cout &lt;&lt; <a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a>.name() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span></div>
<div class="line">18:               &lt;&lt; <span class="stringliteral">&quot;num_predecessors=&quot;</span> &lt;&lt; <a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a>.num_predecessors() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line">19:               &lt;&lt; <span class="stringliteral">&quot;num_successors=&quot;</span> &lt;&lt; <a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a>.num_successors() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line">20:   }</div>
<div class="line">21:</div>
<div class="line">22:   <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.dump(std::cout);         <span class="comment">// dump the taskflow graph</span></div>
<div class="line">23:</div>
<div class="line">24:   tasks[0].work([](){ std::cout &lt;&lt; <span class="stringliteral">&quot;got a new work!\n&quot;</span>; });</div>
<div class="line">25:   tasks[1].work([](){ std::cout &lt;&lt; <span class="stringliteral">&quot;got a new work!\n&quot;</span>; });</div>
<div class="line">26:</div>
<div class="line">27:   <span class="keywordflow">return</span> 0;</div>
<div class="line">28: }</div>
<div class="ttc" id="atest__partitioner__whitebox_8h_html_a5c4cf3d37a4eee22275de22cb9619863"><div class="ttname"><a href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a></div><div class="ttdeci">#define task</div><div class="ttdef"><b>定义</b> test_partitioner_whitebox.h:76</div></div>
</div><!-- fragment --><p>The output of this program looks like the following:</p>
<div class="fragment"><div class="line">This is Task 0: num_predecessors=0, num_successors=1</div>
<div class="line">This is Task 1: num_predecessors=1, num_successors=0</div>
<div class="line">digraph Taskflow {</div>
<div class="line">&quot;This is Task 1&quot;;</div>
<div class="line">&quot;This is Task 0&quot;;</div>
<div class="line">&quot;This is Task 0&quot; -&gt; &quot;This is Task 1&quot;;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Debrief: </p><ul>
<li>Line 5 creates a taskflow object </li>
<li>Lines 7-10 create two placeholder tasks with no works and stores the corresponding task handles in a vector </li>
<li>Lines 12-13 name the two tasks with human-readable strings </li>
<li>Line 14 adds a dependency link from the first task to the second task </li>
<li>Lines 16-20 print out the name of each task, the number of predecessors, and the number of successors </li>
<li>Line 22 dumps the task dependency graph to a @GraphVizOnline format (dot) </li>
<li>Lines 24-25 assign a new target to each task</li>
</ul>
<p>You can change the name and work of a task at anytime before running the graph. The later assignment overwrites the previous values.</p>
<h1><a class="anchor" id="TraverseAdjacentTasks"></a>
Traverse Adjacent Tasks</h1>
<p>You can iterate the successor list and the predecessor list of a task by using <a class="el" href="classtf_1_1_task.html#aff13a503d4a3c994eb08cb6f22e1b427" title="applies an visitor callable to each successor of the task">tf::Task::for_each_successor</a> and <a class="el" href="classtf_1_1_task.html#a31d8069d4c0b10b55e68d260c4d28c1f" title="applies an visitor callable to each dependents of the task">tf::Task::for_each_predecessor</a>, respectively. Each method takes a lambda and applies it to a successor or a predecessor being traversed.</p>
<div class="fragment"><div class="line"><span class="comment">// traverse all successors of my_task</span></div>
<div class="line">my_task.for_each_successor([<a class="code hl_variable" href="main-override_8cpp.html#a1384e7608274313a9433fa573868557b">s</a>=0] (<a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> successor) <span class="keyword">mutable</span> {</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;successor &quot;</span> &lt;&lt; <a class="code hl_variable" href="main-override_8cpp.html#a1384e7608274313a9433fa573868557b">s</a>++ &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line"><span class="comment">// traverse all predecessors of my_task</span></div>
<div class="line">my_task.for_each_predecessor([<a class="code hl_variable" href="ittnotify__static_8h.html#a5f135fd1e66a03efd5275434478e0d97">d</a>=0] (<a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_variable" href="shortpath_8cpp.html#affcfa30b5f2b329189366a08dd6607cc">predecessor</a>) <span class="keyword">mutable</span> {</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;predecessor &quot;</span> &lt;&lt; <a class="code hl_variable" href="ittnotify__static_8h.html#a5f135fd1e66a03efd5275434478e0d97">d</a>++ &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line">});</div>
<div class="ttc" id="aittnotify__static_8h_html_a5f135fd1e66a03efd5275434478e0d97"><div class="ttname"><a href="ittnotify__static_8h.html#a5f135fd1e66a03efd5275434478e0d97">d</a></div><div class="ttdeci">void const char const char int ITT_FORMAT __itt_group_sync x void const char ITT_FORMAT __itt_group_sync s void ITT_FORMAT __itt_group_sync p void ITT_FORMAT p void ITT_FORMAT p no args __itt_suppress_mode_t unsigned int void size_t ITT_FORMAT d</div><div class="ttdef"><b>定义</b> ittnotify_static.h:109</div></div>
<div class="ttc" id="amain-override_8cpp_html_a1384e7608274313a9433fa573868557b"><div class="ttname"><a href="main-override_8cpp.html#a1384e7608274313a9433fa573868557b">s</a></div><div class="ttdeci">static Static s</div><div class="ttdef"><b>定义</b> main-override.cpp:135</div></div>
<div class="ttc" id="ashortpath_8cpp_html_affcfa30b5f2b329189366a08dd6607cc"><div class="ttname"><a href="shortpath_8cpp.html#affcfa30b5f2b329189366a08dd6607cc">predecessor</a></div><div class="ttdeci">vector&lt; vertex_id &gt; predecessor</div><div class="ttdef"><b>定义</b> shortpath.cpp:90</div></div>
</div><!-- fragment --><h1><a class="anchor" id="AttachUserDataToATask"></a>
Attach User Data to a Task</h1>
<p>You can attach custom data to a task using <a class="el" href="classtf_1_1_task.html#afd82ab6d6518d1142a72c4d2c97ff114" title="assigns pointer to user data">tf::Task::data(void*)</a> and access it using <a class="el" href="classtf_1_1_task.html#afd82ab6d6518d1142a72c4d2c97ff114" title="assigns pointer to user data">tf::Task::data()</a>. Each node in a taskflow is associated with a C-styled data pointer (i.e., <code>void*</code>) you can use to point to user data and access it in the body of a task callable. The following example attaches an integer to a task and accesses that integer through capturing the data in the callable.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> my_data = 5;</div>
<div class="line"><a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.placeholder();</div>
<div class="line"><a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a>.data(&amp;my_data)</div>
<div class="line">    .work([<a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a>](){</div>
<div class="line">      <span class="keywordtype">int</span> my_date = *<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span>*<span class="keyword">&gt;</span>(<a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a>.data());</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;my_data: &quot;</span> &lt;&lt; my_data; </div>
<div class="line">    });</div>
</div><!-- fragment --><p>Notice that you need to create a placeholder task first before assigning it a work callable. Only this way can you capture that task in the lambda and access its attached data in the lambda body.</p>
<dl class="section attention"><dt>注意</dt><dd>It is your responsibility to ensure that the attached data stay alive during the execution of its task.</dd></dl>
<h1><a class="anchor" id="UnderstandTheLifetimeOfATask"></a>
Understand the Lifetime of a Task</h1>
<p><a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> task lives with its graph and belongs to only a graph at a time, and is not destroyed until the graph gets cleaned up. The lifetime of a task refers to the user-given callable object, including captured values. As long as the graph is alive, all the associated tasks exist.</p>
<dl class="section attention"><dt>注意</dt><dd>It is your responsibility to keep tasks and graph alive during their execution.</dd></dl>
<h1><a class="anchor" id="MoveATaskflow"></a>
Move a Taskflow</h1>
<p>You can construct or assign a taskflow from a <em>moved</em> taskflow. Moving a taskflow to another will result in transferring the underlying graph data structures from one to the other.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> taskflow1, taskflow3;</div>
<div class="line"> </div>
<div class="line">taskflow1.<a class="code hl_function" href="classtf_1_1_flow_builder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([](){});</div>
<div class="line"> </div>
<div class="line"><span class="comment">// move-construct taskflow2 from taskflow1</span></div>
<div class="line"><a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> taskflow2(std::move(taskflow1));</div>
<div class="line">assert(taskflow2.num_tasks() == 1 &amp;&amp; taskflow1.<a class="code hl_function" href="classtf_1_1_taskflow.html#af4f03bca084deb5c2228ac8936d33649">num_tasks</a>() == 0);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// move-assign taskflow3 to taskflow2</span></div>
<div class="line">taskflow3 = std::move(taskflow2);</div>
<div class="line">assert(taskflow3.<a class="code hl_function" href="classtf_1_1_taskflow.html#af4f03bca084deb5c2228ac8936d33649">num_tasks</a>() == 1 &amp;&amp; taskflow2.num_tasks() == 0);</div>
<div class="ttc" id="aclasstf_1_1_flow_builder_html_a60d7a666cab71ecfa3010b2efb0d6b57"><div class="ttname"><a href="classtf_1_1_flow_builder.html#a60d7a666cab71ecfa3010b2efb0d6b57">tf::FlowBuilder::emplace</a></div><div class="ttdeci">Task emplace(C &amp;&amp;callable)</div><div class="ttdoc">creates a static task</div><div class="ttdef"><b>定义</b> flow_builder.hpp:1261</div></div>
<div class="ttc" id="aclasstf_1_1_taskflow_html_af4f03bca084deb5c2228ac8936d33649"><div class="ttname"><a href="classtf_1_1_taskflow.html#af4f03bca084deb5c2228ac8936d33649">tf::Taskflow::num_tasks</a></div><div class="ttdeci">size_t num_tasks() const</div><div class="ttdoc">queries the number of tasks</div><div class="ttdef"><b>定义</b> taskflow.hpp:345</div></div>
</div><!-- fragment --><p>You can only move a taskflow to another while that taskflow is not being run by an executor. Moving a running taskflow can result in undefined behavior. Please see <a class="el" href="_execute_taskflow.html#ExecuteATaskflowWithTransferredOwnership">Execute a Taskflow with Transferred Ownership</a> for more details. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
