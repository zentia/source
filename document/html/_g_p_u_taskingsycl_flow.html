<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>source: GPU Tasking (syclFlow)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">source
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="搜索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_g_p_u_taskingsycl_flow.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">GPU Tasking (syclFlow)</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>目录</h3>
<ul>
  <li class="level1">
    <a href="#GPUTaskingsyclFlowIncludeTheHeader">Include the Header</a>
  </li>
  <li class="level1">
    <a href="#Create_a_syclFlow">Create a syclFlow</a>
  </li>
  <li class="level1">
    <a href="#Compile_a_syclFlow_program">Compile a syclFlow Program</a>
  </li>
  <li class="level1">
    <a href="#CreateMemoryOperationTasks">Create Memory Operation Tasks</a>
  </li>
  <li class="level1">
    <a href="#CreateKernelTasks">Create Kernel Tasks</a>
  </li>
  <li class="level1">
    <a href="#CreateCommandGroupFunctionObjectTasks">Create Command Group Function Object Tasks</a>
  </li>
  <li class="level1">
    <a href="#OffloadAsyclFlow">Offload a syclFlow</a>
  </li>
  <li class="level1">
    <a href="#UpdateAsyclFlow">Update a syclFlow</a>
  </li>
  <li class="level1">
    <a href="#UsesyclFlowInAStandaloneEnvironment">Use syclFlow in a Standalone Environment</a>
  </li>
</ul>
</div>
<div class="textblock"><p>Taskflow supports SYCL, a general-purpose heterogeneous programming model, to program heterogeneous tasks in a single-source C++ environment. This chapter discusses how to write SYCL C++ kernel code with Taskflow based on @sycl20_spec.</p>
<h1><a class="anchor" id="GPUTaskingsyclFlowIncludeTheHeader"></a>
Include the Header</h1>
<p>You need to include the header file, <code>taskflow/sycl/syclflow.hpp</code>, for using <a class="el" href="classtf_1_1sycl_flow.html" title="class for building a SYCL task dependency graph">tf::syclFlow</a>.</p>
<h1><a class="anchor" id="Create_a_syclFlow"></a>
Create a syclFlow</h1>
<p>Taskflow introduces a task graph-based programming model, <a class="el" href="classtf_1_1sycl_flow.html" title="class for building a SYCL task dependency graph">tf::syclFlow</a>, to program SYCL tasks and their dependencies. <a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> syclFlow is a task in a taskflow and is associated with a SYCL queue to execute kernels on a SYCL device. To create a syclFlow task, emplace a callable with an argument of type <a class="el" href="classtf_1_1sycl_flow.html" title="class for building a SYCL task dependency graph">tf::syclFlow</a> and associate it with a SYCL queue. The following example (<code>saxpy.cpp</code>) implements the canonical saxpy (A·X Plus Y) task graph using <a class="el" href="classtf_1_1sycl_flow.html" title="class for building a SYCL task dependency graph">tf::syclFlow</a>.</p>
<div class="fragment"><div class="line"> 1: #include &lt;<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>/syclflow.hpp&gt;</div>
<div class="line"> 2: </div>
<div class="line"> 3: <span class="keyword">constexpr</span> <span class="keywordtype">size_t</span> <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = 1000000;</div>
<div class="line"> 4: </div>
<div class="line"> 5: <span class="keywordtype">int</span> <a class="code hl_function" href="main-override-static_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div>
<div class="line"> 6: </div>
<div class="line"> 7:   <a class="code hl_class" href="classtf_1_1_executor.html">tf::Executor</a> <a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>;</div>
<div class="line"> 8:   <a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>(<span class="stringliteral">&quot;saxpy example&quot;</span>);</div>
<div class="line"> 9:  </div>
<div class="line">10:   sycl::queue <a class="code hl_namespace" href="namespacequeue.html">queue</a>{sycl::gpu_selector{}};</div>
<div class="line">11:  </div>
<div class="line">12:   <span class="comment">// allocate shared memory that is accessible on both host and device</span></div>
<div class="line">13:   <span class="keywordtype">float</span>* <a class="code hl_define" href="icosphere_8cpp.html#a207fd5507206d307cd63f95374fcd00d">X</a> = sycl::malloc_shared&lt;float&gt;(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, queue);</div>
<div class="line">14:   <span class="keywordtype">float</span>* <a class="code hl_enumvalue" href="namespace_spine.html#a3625b0b38867d83424d7aeec9f0ce394a57cec4137b614c87cb4e24a3d003a3e0">Y</a> = sycl::malloc_shared&lt;float&gt;(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, queue);</div>
<div class="line">15:  </div>
<div class="line">16:   <span class="comment">// create a syclFlow to perform the saxpy operation</span></div>
<div class="line">17:   <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace_on([&amp;](tf::syclFlow&amp; sf){</div>
<div class="line">18:     tf::syclTask fillX = sf.<a class="code hl_function" href="classtf_1_1sycl_flow.html#a628843c986d60bea61eca8c48028159e">fill</a>(<a class="code hl_define" href="icosphere_8cpp.html#a207fd5507206d307cd63f95374fcd00d">X</a>, 1.0f, <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>).<a class="code hl_function" href="classtf_1_1sycl_task.html#a738dfa209da08d8783127a5c5654558e">name</a>(<span class="stringliteral">&quot;fillX&quot;</span>);</div>
<div class="line">19:     tf::syclTask fillY = sf.<a class="code hl_function" href="classtf_1_1sycl_flow.html#a628843c986d60bea61eca8c48028159e">fill</a>(Y, 2.0f, <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>).<a class="code hl_function" href="classtf_1_1sycl_task.html#a738dfa209da08d8783127a5c5654558e">name</a>(<span class="stringliteral">&quot;fillY&quot;</span>);</div>
<div class="line">20:     tf::syclTask <a class="code hl_function" href="bench_2btl_2libs_2_b_l_a_s_2blas_8h.html#ad53e5aed16187a6bb50b8aa5f24cca8b">saxpy</a> = sf.<a class="code hl_function" href="classtf_1_1sycl_flow.html#ae42b1da441d5696dc589ee9ee89b9deb">parallel_for</a>(sycl::range&lt;1&gt;(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>), </div>
<div class="line">21:       [=] (sycl::id&lt;1&gt; <span class="keywordtype">id</span>) {</div>
<div class="line">22:         <a class="code hl_define" href="icosphere_8cpp.html#a207fd5507206d307cd63f95374fcd00d">X</a>[<a class="code hl_typedef" href="cocoa__platform_8h.html#acf00cd75f37488e1d4ac463303ccfec4">id</a>] = 3.0f * <a class="code hl_define" href="icosphere_8cpp.html#a207fd5507206d307cd63f95374fcd00d">X</a>[<a class="code hl_typedef" href="cocoa__platform_8h.html#acf00cd75f37488e1d4ac463303ccfec4">id</a>] + <a class="code hl_enumvalue" href="namespace_spine.html#a3625b0b38867d83424d7aeec9f0ce394a57cec4137b614c87cb4e24a3d003a3e0">Y</a>[<a class="code hl_typedef" href="cocoa__platform_8h.html#acf00cd75f37488e1d4ac463303ccfec4">id</a>];</div>
<div class="line">23:       }</div>
<div class="line">24:     ).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;saxpy&quot;</span>);</div>
<div class="line">25:     <a class="code hl_function" href="bench_2btl_2libs_2_b_l_a_s_2blas_8h.html#ad53e5aed16187a6bb50b8aa5f24cca8b">saxpy</a>.<a class="code hl_function" href="classtf_1_1sycl_task.html#a05f42a7fa26997193068ce6502eabe16">succeed</a>(fillX, fillY);</div>
<div class="line">26:   }, <a class="code hl_typedef" href="namespaceluisa.html#aa1eb922874c2e5b0b13f4fc9a37747eb">queue</a>).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;syclFlow&quot;</span>);</div>
<div class="line">27:   </div>
<div class="line">28:   <a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.<a class="code hl_function" href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">run</a>(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).wait();  <span class="comment">// run the taskflow</span></div>
<div class="line">29:   <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.dump(std::cout);       <span class="comment">// dump the taskflow</span></div>
<div class="line">30:  </div>
<div class="line">31:   <span class="comment">// free the shared memory to avoid memory leak</span></div>
<div class="line">32:   sycl::free(<a class="code hl_define" href="icosphere_8cpp.html#a207fd5507206d307cd63f95374fcd00d">X</a>, queue); </div>
<div class="line">33:   sycl::free(Y, queue);           </div>
<div class="line">34: }</div>
<div class="ttc" id="abench_2btl_2libs_2_b_l_a_s_2blas_8h_html_ad53e5aed16187a6bb50b8aa5f24cca8b"><div class="ttname"><a href="bench_2btl_2libs_2_b_l_a_s_2blas_8h.html#ad53e5aed16187a6bb50b8aa5f24cca8b">saxpy</a></div><div class="ttdeci">int BLASFUNC saxpy(int *, float *, float *, int *, float *, int *)</div></div>
<div class="ttc" id="aclasstf_1_1_executor_html"><div class="ttname"><a href="classtf_1_1_executor.html">tf::Executor</a></div><div class="ttdoc">class to create an executor for running a taskflow graph</div><div class="ttdef"><b>定义</b> executor-dl.hpp:51</div></div>
<div class="ttc" id="aclasstf_1_1_executor_html_a519777f5783981d534e9e53b99712069"><div class="ttname"><a href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">tf::Executor::run</a></div><div class="ttdeci">tf::Future&lt; void &gt; run(Taskflow &amp;taskflow)</div><div class="ttdoc">runs a taskflow once</div><div class="ttdef"><b>定义</b> executor-dl.hpp:2067</div></div>
<div class="ttc" id="aclasstf_1_1_taskflow_html"><div class="ttname"><a href="classtf_1_1_taskflow.html">tf::Taskflow</a></div><div class="ttdoc">class to create a taskflow object</div><div class="ttdef"><b>定义</b> taskflow.hpp:67</div></div>
<div class="ttc" id="aclasstf_1_1sycl_flow_html_a628843c986d60bea61eca8c48028159e"><div class="ttname"><a href="classtf_1_1sycl_flow.html#a628843c986d60bea61eca8c48028159e">tf::syclFlow::fill</a></div><div class="ttdeci">syclTask fill(void *ptr, const T &amp;pattern, size_t count)</div><div class="ttdoc">creates a fill task that fills typed data with the given value</div><div class="ttdef"><b>定义</b> syclflow.hpp:467</div></div>
<div class="ttc" id="aclasstf_1_1sycl_flow_html_ae42b1da441d5696dc589ee9ee89b9deb"><div class="ttname"><a href="classtf_1_1sycl_flow.html#ae42b1da441d5696dc589ee9ee89b9deb">tf::syclFlow::parallel_for</a></div><div class="ttdeci">syclTask parallel_for(ArgsT &amp;&amp;... args)</div><div class="ttdoc">creates a kernel task</div><div class="ttdef"><b>定义</b> syclflow.hpp:500</div></div>
<div class="ttc" id="aclasstf_1_1sycl_task_html_a05f42a7fa26997193068ce6502eabe16"><div class="ttname"><a href="classtf_1_1sycl_task.html#a05f42a7fa26997193068ce6502eabe16">tf::syclTask::succeed</a></div><div class="ttdeci">syclTask &amp; succeed(Ts &amp;&amp;... tasks)</div><div class="ttdoc">adds precedence links from other tasks to this</div><div class="ttdef"><b>定义</b> sycl_task.hpp:138</div></div>
<div class="ttc" id="aclasstf_1_1sycl_task_html_a738dfa209da08d8783127a5c5654558e"><div class="ttname"><a href="classtf_1_1sycl_task.html#a738dfa209da08d8783127a5c5654558e">tf::syclTask::name</a></div><div class="ttdeci">syclTask &amp; name(const std::string &amp;name)</div><div class="ttdoc">assigns a name to the task</div><div class="ttdef"><b>定义</b> sycl_task.hpp:149</div></div>
<div class="ttc" id="acocoa__platform_8h_html_acf00cd75f37488e1d4ac463303ccfec4"><div class="ttname"><a href="cocoa__platform_8h.html#acf00cd75f37488e1d4ac463303ccfec4">id</a></div><div class="ttdeci">void * id</div><div class="ttdef"><b>定义</b> cocoa_platform.h:41</div></div>
<div class="ttc" id="aicosphere_8cpp_html_a207fd5507206d307cd63f95374fcd00d"><div class="ttname"><a href="icosphere_8cpp.html#a207fd5507206d307cd63f95374fcd00d">X</a></div><div class="ttdeci">#define X</div><div class="ttdef"><b>定义</b> icosphere.cpp:20</div></div>
<div class="ttc" id="aimgui__impl__opengl3__loader_8h_html_aab18cfce5ee7c6881ae04f18be70d94a"><div class="ttname"><a href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a></div><div class="ttdeci">const GLchar * name</div><div class="ttdef"><b>定义</b> imgui_impl_opengl3_loader.h:312</div></div>
<div class="ttc" id="amain-override-static_8c_html_a0240ac851181b84ac374872dc5434ee4"><div class="ttname"><a href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a></div><div class="ttdeci">#define N</div><div class="ttdef"><b>定义</b> main-override-static.c:141</div></div>
<div class="ttc" id="amain-override-static_8c_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="main-override-static_8c.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>定义</b> main-override-static.c:32</div></div>
<div class="ttc" id="anamespace_spine_html_a3625b0b38867d83424d7aeec9f0ce394a57cec4137b614c87cb4e24a3d003a3e0"><div class="ttname"><a href="namespace_spine.html#a3625b0b38867d83424d7aeec9f0ce394a57cec4137b614c87cb4e24a3d003a3e0">Spine.Property.Y</a></div><div class="ttdeci">@ Y</div><div class="ttdef"><b>定义</b> Animation.cs:179</div></div>
<div class="ttc" id="anamespaceluisa_html_aa1eb922874c2e5b0b13f4fc9a37747eb"><div class="ttname"><a href="namespaceluisa.html#aa1eb922874c2e5b0b13f4fc9a37747eb">luisa::queue</a></div><div class="ttdeci">eastl::queue&lt; T, Container &gt; queue</div><div class="ttdef"><b>定义</b> queue.h:16</div></div>
<div class="ttc" id="anamespacequeue_html"><div class="ttname"><a href="namespacequeue.html">queue</a></div><div class="ttdef"><b>定义</b> intrusive_queue_type.h:26</div></div>
<div class="ttc" id="apoisson_8hpp_html_aa56fe360bb0ae38e0082f49e394ff825"><div class="ttname"><a href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a></div><div class="ttdeci">void taskflow(int nx, int ny, double dx, double dy, double *f, int itold, int itnew, double *u, double *unew, int block_size, unsigned num_threads)</div><div class="ttdef"><b>定义</b> taskflow.cpp:6</div></div>
<div class="ttc" id="athread__pool_8cpp_html_a543e564a8407bbeac15cb2d929fec755"><div class="ttname"><a href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a></div><div class="ttdeci">tf::Executor executor</div><div class="ttdef"><b>定义</b> thread_pool.cpp:6</div></div>
</div><!-- fragment --><p>Debrief:</p>
<ul>
<li>Lines 7-8 create a taskflow and an executor </li>
<li>Lines 10 creates a SYCL queue on a default-selected GPU device </li>
<li>Lines 13-14 allocate shared memory that is accessible on both host and device </li>
<li>Lines 17-26 creates a syclFlow to define the saxpy task graph that contains:<ul>
<li>one fill task to fill the memory area <code>X</code> with <code>1.0f</code> </li>
<li>one fill task to fill the memory area <code>Y</code> with <code>2.0f</code> </li>
<li>one kernel task to perform the saxpy operation on the GPU </li>
</ul>
</li>
<li>Lines 28-29 executes the taskflow and dumps its graph to a DOT format </li>
<li>Lines 32-33 deallocates the shared memory to avoid memory leak</li>
</ul>
<p><a class="el" href="classtf_1_1sycl_flow.html" title="class for building a SYCL task dependency graph">tf::syclFlow</a> is a lightweight task graph-based programming layer atop SYCL. We do not expend yet another effort on simplifying kernel programming but focus on tasking SYCL operations and their dependencies. This organization lets users fully take advantage of SYCL features that are commensurate with their domain knowledge, while leaving difficult task parallelism details to Taskflow.</p>
<h1><a class="anchor" id="Compile_a_syclFlow_program"></a>
Compile a syclFlow Program</h1>
<p>Use DPC++ clang to compile a syclFlow program:</p>
<div class="fragment"><div class="line">{.shell-session} </div>
<div class="line">~$ clang++ -fsycl -fsycl-unnamed-<a class="code hl_define" href="sugar_8h.html#aa2bc5aa57d417f3226228d9058ab9f20">lambda</a> \</div>
<div class="line">           -fsycl-targets=nvptx64-nvidia-cuda \  # <span class="keywordflow">for</span> CUDA target</div>
<div class="line">           -I <a class="code hl_variable" href="ittnotify__static_8h.html#a7016119bc831a22d1a351d56128518ed">path</a>/to/<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a> -pthread -<a class="code hl_namespace" href="namespacestd.html">std</a>=<a class="code hl_variable" href="bench_vec_add_8cpp.html#a41689956983587b085f9da3e48f31d99">c</a>++17 <a class="code hl_function" href="bench_2btl_2libs_2_b_l_a_s_2blas_8h.html#ad53e5aed16187a6bb50b8aa5f24cca8b">saxpy</a>.cpp -o <a class="code hl_function" href="bench_2btl_2libs_2_b_l_a_s_2blas_8h.html#ad53e5aed16187a6bb50b8aa5f24cca8b">saxpy</a></div>
<div class="line">~$ ./<a class="code hl_function" href="bench_2btl_2libs_2_b_l_a_s_2blas_8h.html#ad53e5aed16187a6bb50b8aa5f24cca8b">saxpy</a></div>
<div class="ttc" id="abench_vec_add_8cpp_html_a41689956983587b085f9da3e48f31d99"><div class="ttname"><a href="bench_vec_add_8cpp.html#a41689956983587b085f9da3e48f31d99">c</a></div><div class="ttdeci">Scalar Scalar * c</div><div class="ttdef"><b>定义</b> benchVecAdd.cpp:17</div></div>
<div class="ttc" id="aittnotify__static_8h_html_a7016119bc831a22d1a351d56128518ed"><div class="ttname"><a href="ittnotify__static_8h.html#a7016119bc831a22d1a351d56128518ed">path</a></div><div class="ttdeci">void const char const char int ITT_FORMAT __itt_group_sync x void const char ITT_FORMAT __itt_group_sync s void ITT_FORMAT __itt_group_sync p void ITT_FORMAT p void ITT_FORMAT p no args __itt_suppress_mode_t unsigned int void size_t ITT_FORMAT d void ITT_FORMAT p void ITT_FORMAT p __itt_model_site __itt_model_site_instance ITT_FORMAT p __itt_model_task __itt_model_task_instance ITT_FORMAT p void ITT_FORMAT p void ITT_FORMAT p void size_t ITT_FORMAT d void ITT_FORMAT p const wchar_t ITT_FORMAT s const char ITT_FORMAT s const char ITT_FORMAT s const char ITT_FORMAT s no args void ITT_FORMAT p size_t ITT_FORMAT d no args const wchar_t const wchar_t ITT_FORMAT s __itt_heap_function void size_t int ITT_FORMAT d __itt_heap_function void ITT_FORMAT p __itt_heap_function void void size_t int ITT_FORMAT d no args no args unsigned int ITT_FORMAT u const __itt_domain __itt_id ITT_FORMAT lu const __itt_domain __itt_id __itt_id __itt_string_handle ITT_FORMAT p const __itt_domain __itt_id ITT_FORMAT p const __itt_domain __itt_id __itt_timestamp __itt_timestamp ITT_FORMAT lu const __itt_domain __itt_id __itt_id __itt_string_handle ITT_FORMAT p const __itt_domain ITT_FORMAT p const __itt_domain __itt_string_handle unsigned long long ITT_FORMAT lu const __itt_domain __itt_string_handle unsigned long long ITT_FORMAT lu const __itt_domain __itt_id __itt_string_handle __itt_metadata_type size_t void ITT_FORMAT p const __itt_domain __itt_id __itt_string_handle const wchar_t size_t ITT_FORMAT lu const __itt_domain __itt_id __itt_relation __itt_id ITT_FORMAT p const wchar_t int ITT_FORMAT __itt_group_mark d __itt_event ITT_FORMAT __itt_group_mark d void const wchar_t const wchar_t int ITT_FORMAT __itt_group_sync __itt_group_fsync x void const wchar_t int const wchar_t int int ITT_FORMAT __itt_group_sync __itt_group_fsync x void ITT_FORMAT __itt_group_sync __itt_group_fsync p void ITT_FORMAT __itt_group_sync __itt_group_fsync p void size_t ITT_FORMAT lu no args __itt_obj_prop_t __itt_obj_state_t ITT_FORMAT d const char ITT_FORMAT s const char ITT_FORMAT s __itt_frame ITT_FORMAT p __itt_counter ITT_FORMAT p __itt_counter unsigned long long ITT_FORMAT lu __itt_counter unsigned long long ITT_FORMAT lu __itt_counter __itt_clock_domain unsigned long long void ITT_FORMAT p const wchar_t ITT_FORMAT S __itt_mark_type const wchar_t ITT_FORMAT S __itt_mark_type const char ITT_FORMAT s __itt_mark_type ITT_FORMAT d __itt_caller ITT_FORMAT p __itt_caller ITT_FORMAT p no args const __itt_domain __itt_clock_domain unsigned long long __itt_id ITT_FORMAT lu const __itt_domain __itt_clock_domain unsigned long long __itt_id __itt_id void ITT_FORMAT p const __itt_domain __itt_id __itt_id __itt_string_handle ITT_FORMAT p const __itt_domain __itt_id ITT_FORMAT lu const __itt_domain __itt_clock_domain unsigned long long __itt_id __itt_string_handle __itt_scope ITT_FORMAT d const __itt_domain __itt_scope __itt_string_handle const char size_t ITT_FORMAT lu const __itt_domain __itt_clock_domain unsigned long long __itt_relation __itt_id ITT_FORMAT lu __itt_track_group __itt_string_handle __itt_track_group_type ITT_FORMAT d __itt_track ITT_FORMAT p void int const int int const char int ITT_FORMAT d void void const char * path</div><div class="ttdef"><b>定义</b> ittnotify_static.h:346</div></div>
<div class="ttc" id="anamespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div><div class="ttdoc">Extensions to the C++ standard library.</div><div class="ttdef"><b>定义</b> array.h:631</div></div>
<div class="ttc" id="asugar_8h_html_aa2bc5aa57d417f3226228d9058ab9f20"><div class="ttname"><a href="sugar_8h.html#aa2bc5aa57d417f3226228d9058ab9f20">lambda</a></div><div class="ttdeci">#define lambda(...)</div><div class="ttdef"><b>定义</b> sugar.h:96</div></div>
</div><!-- fragment --><p>Please visit the page <a class="el" href="_compile_taskflow_with_s_y_c_l.html">Compile Taskflow with SYCL</a> for more details.</p>
<h1><a class="anchor" id="CreateMemoryOperationTasks"></a>
Create Memory Operation Tasks</h1>
<p><a class="el" href="classtf_1_1sycl_flow.html" title="class for building a SYCL task dependency graph">tf::syclFlow</a> provides a set of methods for creating tasks to perform common memory operations, such as copy, set, and fill, on memory area pointed to by <em>unified shared memory</em> (USM) pointers. The following example creates a syclFlow task of two copy operations and one fill operation that set the first <code>N/2</code> elements in the vector to <code>-1</code>.</p>
<div class="fragment"><div class="line">sycl::queue <a class="code hl_namespace" href="namespacequeue.html">queue</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">size_t</span> <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>  = 1000;</div>
<div class="line"><span class="keywordtype">int</span>* hvec = <span class="keyword">new</span> <span class="keywordtype">int</span>[<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>] (100);</div>
<div class="line"><span class="keywordtype">int</span>* dvec = sycl::malloc_device&lt;int&gt;(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, <a class="code hl_namespace" href="namespacequeue.html">queue</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// create a syclflow task to set the first N/2 elements to -1</span></div>
<div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace_on([&amp;](<a class="code hl_class" href="classtf_1_1sycl_flow.html">tf::syclFlow</a>&amp; syclflow){</div>
<div class="line">  <a class="code hl_class" href="classtf_1_1sycl_task.html">tf::syclTask</a> ch2d = syclflow.<a class="code hl_function" href="classtf_1_1sycl_flow.html#ac433456f3960028fb12a53018b263aee">copy</a>(dvec, hvec, <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line">  <a class="code hl_class" href="classtf_1_1sycl_task.html">tf::syclTask</a> <a class="code hl_function" href="namespacetf.html#ab79480aaf575cd33eda54141ab5afcf1">fill</a> = syclflow.<a class="code hl_function" href="classtf_1_1sycl_flow.html#a628843c986d60bea61eca8c48028159e">fill</a>(dvec, -1, <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>/2);</div>
<div class="line">  <a class="code hl_class" href="classtf_1_1sycl_task.html">tf::syclTask</a> cd2h = syclflow.<a class="code hl_function" href="classtf_1_1sycl_flow.html#ac433456f3960028fb12a53018b263aee">copy</a>(hvec, dvec, <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>); </div>
<div class="line">  <a class="code hl_function" href="namespacetf.html#ab79480aaf575cd33eda54141ab5afcf1">fill</a>.<a class="code hl_function" href="classtf_1_1sycl_task.html#a92d0dd0929b9ac4e46baf4d546497389">precede</a>(cd2h)</div>
<div class="line">      .<a class="code hl_function" href="classtf_1_1sycl_task.html#a05f42a7fa26997193068ce6502eabe16">succeed</a>(ch2d);</div>
<div class="line">}, <a class="code hl_namespace" href="namespacequeue.html">queue</a>);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.run(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).wait();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// inspect the result</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>/2; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line">  (<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> / 2) ? assert(hvec[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] == -1) : assert(hvec[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] == 100);</div>
<div class="line">}</div>
<div class="ttc" id="a_bi_c_g_s_t_a_b__step__by__step_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>定义</b> BiCGSTAB_step_by_step.cpp:9</div></div>
<div class="ttc" id="aclasstf_1_1sycl_flow_html"><div class="ttname"><a href="classtf_1_1sycl_flow.html">tf::syclFlow</a></div><div class="ttdoc">class for building a SYCL task dependency graph</div><div class="ttdef"><b>定义</b> syclflow.hpp:23</div></div>
<div class="ttc" id="aclasstf_1_1sycl_flow_html_ac433456f3960028fb12a53018b263aee"><div class="ttname"><a href="classtf_1_1sycl_flow.html#ac433456f3960028fb12a53018b263aee">tf::syclFlow::copy</a></div><div class="ttdeci">syclTask copy(T *target, const T *source, size_t count)</div><div class="ttdoc">creates a copy task that copies typed data from a source to a target memory block</div><div class="ttdef"><b>定义</b> syclflow.hpp:475</div></div>
<div class="ttc" id="aclasstf_1_1sycl_task_html"><div class="ttname"><a href="classtf_1_1sycl_task.html">tf::syclTask</a></div><div class="ttdoc">handle to a node of the internal CUDA graph</div><div class="ttdef"><b>定义</b> sycl_task.hpp:21</div></div>
<div class="ttc" id="aclasstf_1_1sycl_task_html_a92d0dd0929b9ac4e46baf4d546497389"><div class="ttname"><a href="classtf_1_1sycl_task.html#a92d0dd0929b9ac4e46baf4d546497389">tf::syclTask::precede</a></div><div class="ttdeci">syclTask &amp; precede(Ts &amp;&amp;... tasks)</div><div class="ttdoc">adds precedence links from this to other tasks</div><div class="ttdef"><b>定义</b> sycl_task.hpp:131</div></div>
<div class="ttc" id="anamespacetf_html_ab79480aaf575cd33eda54141ab5afcf1"><div class="ttname"><a href="namespacetf.html#ab79480aaf575cd33eda54141ab5afcf1">tf::fill</a></div><div class="ttdeci">__device__ void fill(T(&amp;x)[count], T val)</div><div class="ttdef"><b>定义</b> cuda_meta.hpp:51</div></div>
</div><!-- fragment --><p>Both <a class="el" href="classtf_1_1sycl_flow.html#ac433456f3960028fb12a53018b263aee" title="creates a copy task that copies typed data from a source to a target memory block">tf::syclFlow::copy</a> and <a class="el" href="classtf_1_1sycl_flow.html#a628843c986d60bea61eca8c48028159e" title="creates a fill task that fills typed data with the given value">tf::syclFlow::fill</a> operate on <code>typed</code> data. You can use <a class="el" href="classtf_1_1sycl_flow.html#ac1e1eb858d9271ed61ff4fe00f135e92" title="creates a memcpy task that copies untyped data in bytes">tf::syclFlow::memcpy</a> and <a class="el" href="classtf_1_1sycl_flow.html#a54b7497c0f4763bb4f8604f6c5654a5f" title="creates a memset task that fills untyped data with a byte value">tf::syclFlow::memset</a> to operate on <code>untyped</code> data (i.e., array of bytes).</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace_on([&amp;](<a class="code hl_class" href="classtf_1_1sycl_flow.html">tf::syclFlow</a>&amp; syclflow){</div>
<div class="line">  <a class="code hl_class" href="classtf_1_1sycl_task.html">tf::syclTask</a> ch2d = syclflow.<a class="code hl_function" href="classtf_1_1sycl_flow.html#ac1e1eb858d9271ed61ff4fe00f135e92">memcpy</a>(dvec, hvec, <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line">  <a class="code hl_class" href="classtf_1_1sycl_task.html">tf::syclTask</a> mset = syclflow.<a class="code hl_function" href="classtf_1_1sycl_flow.html#a54b7497c0f4763bb4f8604f6c5654a5f">memset</a>(dvec, -1, <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>/2*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line">  <a class="code hl_class" href="classtf_1_1sycl_task.html">tf::syclTask</a> cd2h = syclflow.<a class="code hl_function" href="classtf_1_1sycl_flow.html#ac1e1eb858d9271ed61ff4fe00f135e92">memcpy</a>(hvec, dvec, <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)); </div>
<div class="line">  <a class="code hl_function" href="namespacetf.html#ab79480aaf575cd33eda54141ab5afcf1">fill</a>.<a class="code hl_function" href="classtf_1_1sycl_task.html#a92d0dd0929b9ac4e46baf4d546497389">precede</a>(cd2h)</div>
<div class="line">      .<a class="code hl_function" href="classtf_1_1sycl_task.html#a05f42a7fa26997193068ce6502eabe16">succeed</a>(ch2d);</div>
<div class="line">}, <a class="code hl_namespace" href="namespacequeue.html">queue</a>);</div>
<div class="ttc" id="aclasstf_1_1sycl_flow_html_a54b7497c0f4763bb4f8604f6c5654a5f"><div class="ttname"><a href="classtf_1_1sycl_flow.html#a54b7497c0f4763bb4f8604f6c5654a5f">tf::syclFlow::memset</a></div><div class="ttdeci">syclTask memset(void *ptr, int value, size_t bytes)</div><div class="ttdoc">creates a memset task that fills untyped data with a byte value</div><div class="ttdef"><b>定义</b> syclflow.hpp:461</div></div>
<div class="ttc" id="aclasstf_1_1sycl_flow_html_ac1e1eb858d9271ed61ff4fe00f135e92"><div class="ttname"><a href="classtf_1_1sycl_flow.html#ac1e1eb858d9271ed61ff4fe00f135e92">tf::syclFlow::memcpy</a></div><div class="ttdeci">syclTask memcpy(void *tgt, const void *src, size_t bytes)</div><div class="ttdoc">creates a memcpy task that copies untyped data in bytes</div><div class="ttdef"><b>定义</b> syclflow.hpp:456</div></div>
</div><!-- fragment --><h1><a class="anchor" id="CreateKernelTasks"></a>
Create Kernel Tasks</h1>
<p>SYCL allows a simple execution model in which a kernel is invoked over an N-dimensional index space defined by <code>sycl::range&lt;N&gt;</code>, where <code>N</code> is one, two or three. Each work item in such a kernel executes independently across a set of partitioned work groups. <a class="el" href="classtf_1_1sycl_flow.html#ae42b1da441d5696dc589ee9ee89b9deb" title="creates a kernel task">tf::syclFlow::parallel_for</a> defines several variants to create a kernel task. The following variant pairs up a <code>sycl::range</code> and a <code>sycl::id</code> to set each element in <code>data</code> to <code>1.0f</code> when it is not necessary to query the global range of the index space being executed across.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1sycl_task.html">tf::syclTask</a> <a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a> = syclflow.<a class="code hl_function" href="classtf_1_1sycl_flow.html#ae42b1da441d5696dc589ee9ee89b9deb">parallel_for</a>(</div>
<div class="line">  sycl::range&lt;1&gt;(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>), [<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>](sycl::id&lt;1&gt; <span class="keywordtype">id</span>){ <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>[<a class="code hl_typedef" href="cocoa__platform_8h.html#acf00cd75f37488e1d4ac463303ccfec4">id</a>] = 1.0f; }</div>
<div class="line">);</div>
<div class="ttc" id="aimgui__impl__opengl3__loader_8h_html_a02796e583e939f923a255e43d2c3b177"><div class="ttname"><a href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a></div><div class="ttdeci">GLint * data</div><div class="ttdef"><b>定义</b> imgui_impl_opengl3_loader.h:199</div></div>
<div class="ttc" id="atest__partitioner__whitebox_8h_html_a5c4cf3d37a4eee22275de22cb9619863"><div class="ttname"><a href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a></div><div class="ttdeci">#define task</div><div class="ttdef"><b>定义</b> test_partitioner_whitebox.h:76</div></div>
</div><!-- fragment --><p>As the same example, the following variant enables low-level functionality of work items and work groups using <code>sycl::nd_range</code> and <code>sycl::nd_item</code>. This becomes valuable when an execution requires groups of work items that communicate and synchronize.</p>
<div class="fragment"><div class="line"><span class="comment">// partition the N-element range to N/M work groups each of M work items</span></div>
<div class="line"><a class="code hl_class" href="classtf_1_1sycl_task.html">tf::syclTask</a> <a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a> = syclflow.<a class="code hl_function" href="classtf_1_1sycl_flow.html#ae42b1da441d5696dc589ee9ee89b9deb">parallel_for</a>(</div>
<div class="line">  sycl::nd_range&lt;1&gt;{sycl::range&lt;1&gt;(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>), sycl::range&lt;1&gt;(<a class="code hl_define" href="test__overwrite__node_8cpp.html#a52037c938e3c1b126c6277da5ca689d0">M</a>)},</div>
<div class="line">  [<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>](sycl::nd_item&lt;1&gt; item){</div>
<div class="line">    <span class="keyword">auto</span> <span class="keywordtype">id</span> = item.get_global_linear_id();</div>
<div class="line">    <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>[<a class="code hl_typedef" href="cocoa__platform_8h.html#acf00cd75f37488e1d4ac463303ccfec4">id</a>] = 1.0f;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// query detailed work group information</span></div>
<div class="line">    <span class="comment">// item.get_group_linear_id();</span></div>
<div class="line">    <span class="comment">// item.get_local_linear_id();</span></div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">  }</div>
<div class="line">);</div>
<div class="ttc" id="atest__overwrite__node_8cpp_html_a52037c938e3c1b126c6277da5ca689d0"><div class="ttname"><a href="test__overwrite__node_8cpp.html#a52037c938e3c1b126c6277da5ca689d0">M</a></div><div class="ttdeci">#define M</div><div class="ttdef"><b>定义</b> test_overwrite_node.cpp:30</div></div>
</div><!-- fragment --><p>All the kernel methods defined in the SYCL queue are applicable for <a class="el" href="classtf_1_1sycl_flow.html#ae42b1da441d5696dc589ee9ee89b9deb" title="creates a kernel task">tf::syclFlow::parallel_for</a>.</p>
<h1><a class="anchor" id="CreateCommandGroupFunctionObjectTasks"></a>
Create Command Group Function Object Tasks</h1>
<p>SYCL provides a way to encapsulate a device-side operation and all its data and event dependencies in a single <em>command group function object</em>. The function object accepts an argument of command group <em>handler</em> constructed by the SYCL runtime. Command group handler is the heart of SYCL programming as it defines pretty much all kernel-related methods, including submission, execution, and synchronization. You can directly create a SYCL task from a command group function object using <a class="el" href="classtf_1_1sycl_flow.html#a20b79581d27eaed2812ffb14dc821a64" title="creates a task that launches the given command group function object">tf::syclFlow::on</a>.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1sycl_task.html">tf::syclTask</a> <a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a> = syclflow.<a class="code hl_function" href="classtf_1_1sycl_flow.html#a20b79581d27eaed2812ffb14dc821a64">on</a>(</div>
<div class="line">  [=] (sycl::handler&amp; handler) {</div>
<div class="line">    handler.require(accessor);</div>
<div class="line">    handler.single_task([=](){  <span class="comment">// place a single-threaded kernel function</span></div>
<div class="line">      <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>[0] = 1;</div>
<div class="line">    );</div>
<div class="line">  }</div>
<div class="line">);</div>
<div class="ttc" id="aclasstf_1_1sycl_flow_html_a20b79581d27eaed2812ffb14dc821a64"><div class="ttname"><a href="classtf_1_1sycl_flow.html#a20b79581d27eaed2812ffb14dc821a64">tf::syclFlow::on</a></div><div class="ttdeci">syclTask on(F &amp;&amp;func)</div><div class="ttdoc">creates a task that launches the given command group function object</div><div class="ttdef"><b>定义</b> syclflow.hpp:483</div></div>
</div><!-- fragment --><h1><a class="anchor" id="OffloadAsyclFlow"></a>
Offload a syclFlow</h1>
<p>By default, the executor offloads and executes the syclFlow once. When a syclFlow is being executed, its task graph will be materialized by the Taskflow runtime and submitted to its associated SYCL queue in a topological order of task dependencies defined in that graph. You can explicitly execute a syclFlow using different offload methods:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace_on([](<a class="code hl_class" href="classtf_1_1sycl_flow.html">tf::syclFlow</a>&amp; sf) {</div>
<div class="line">  <span class="comment">// ... create SYCL tasks</span></div>
<div class="line">  sf.offload();      <span class="comment">// offload the syclFlow and run it once</span></div>
<div class="line">  sf.offload_n(10);  <span class="comment">// offload the syclFlow and run it 10 times</span></div>
<div class="line">  sf.offload_until([repeat=5] () <span class="keyword">mutable</span> { <span class="keywordflow">return</span> repeat-- == 0; })  <span class="comment">// five times</span></div>
<div class="line">}, <a class="code hl_typedef" href="namespaceluisa.html#aa1eb922874c2e5b0b13f4fc9a37747eb">queue</a>);</div>
</div><!-- fragment --><p>After you offload a syclFlow, it is considered executed, and the executor will <em>not</em> run an offloaded syclFlow after leaving the syclFlow task callable. On the other hand, if a syclFlow is not offloaded, the executor runs it once. For example, the following two versions represent the same execution logic.</p>
<div class="fragment"><div class="line"><span class="comment">// version 1: explicitly offload a syclFlow once</span></div>
<div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace_on([](<a class="code hl_class" href="classtf_1_1sycl_flow.html">tf::syclFlow</a>&amp; sf) {</div>
<div class="line">  sf.single_task([](){});</div>
<div class="line">  sf.offload();</div>
<div class="line">}, <a class="code hl_typedef" href="namespaceluisa.html#aa1eb922874c2e5b0b13f4fc9a37747eb">queue</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// version 2 (same as version 1): executor offloads the syclFlow once</span></div>
<div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace_on([](tf::syclFlow&amp; sf) {</div>
<div class="line">  sf.<a class="code hl_function" href="classtf_1_1sycl_flow.html#a05ff6f331b6cf48e21ae7f0d6aea9094">single_task</a>([](){});</div>
<div class="line">}, <a class="code hl_typedef" href="namespaceluisa.html#aa1eb922874c2e5b0b13f4fc9a37747eb">queue</a>);</div>
<div class="ttc" id="aclasstf_1_1sycl_flow_html_a05ff6f331b6cf48e21ae7f0d6aea9094"><div class="ttname"><a href="classtf_1_1sycl_flow.html#a05ff6f331b6cf48e21ae7f0d6aea9094">tf::syclFlow::single_task</a></div><div class="ttdeci">syclTask single_task(F &amp;&amp;func)</div><div class="ttdoc">invokes a SYCL kernel function using only one thread</div><div class="ttdef"><b>定义</b> syclflow.hpp:492</div></div>
</div><!-- fragment --><h1><a class="anchor" id="UpdateAsyclFlow"></a>
Update a syclFlow</h1>
<p>You can update a SYCL task from an offloaded syclFlow and <em>rebind</em> it to another task type. For example, you can rebind a memory operation task to a parallel-for kernel task from an offloaded syclFlow and vice versa.</p>
<div class="fragment"><div class="line"><span class="keywordtype">size_t</span> <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = 10000;</div>
<div class="line">sycl::queue <a class="code hl_namespace" href="namespacequeue.html">queue</a>;</div>
<div class="line"><span class="keywordtype">int</span>* <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a> = sycl::malloc_shared&lt;int&gt;(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, <a class="code hl_namespace" href="namespacequeue.html">queue</a>);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace_on([&amp;](<a class="code hl_class" href="classtf_1_1sycl_flow.html">tf::syclFlow</a>&amp; syclflow){</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// create a task to set each element to -1 </span></div>
<div class="line">  <a class="code hl_class" href="classtf_1_1sycl_task.html">tf::syclTask</a> <a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a> = syclflow.<a class="code hl_function" href="classtf_1_1sycl_flow.html#a628843c986d60bea61eca8c48028159e">fill</a>(<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>, -1, <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line">  syclflow.<a class="code hl_function" href="classtf_1_1sycl_flow.html#a2928c2edc466dd625741080c147de4ef">offload</a>();</div>
<div class="line"> </div>
<div class="line">  std::for_each(<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>, <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>+<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, [](<span class="keywordtype">int</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>){ assert(<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] == -1); });</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// rebind the task to a parallel-for kernel task setting each element to 100</span></div>
<div class="line">  syclflow.rebind_parallel_for(<a class="code hl_define" href="test__partitioner__whitebox_8h.html#a5c4cf3d37a4eee22275de22cb9619863">task</a>, sycl::range&lt;1&gt;(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>), [](sycl::id&lt;1&gt; <span class="keywordtype">id</span>){</div>
<div class="line">    <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>[<a class="code hl_typedef" href="cocoa__platform_8h.html#acf00cd75f37488e1d4ac463303ccfec4">id</a>] = 100;</div>
<div class="line">  });</div>
<div class="line">  syclflow.<a class="code hl_function" href="classtf_1_1sycl_flow.html#a2928c2edc466dd625741080c147de4ef">offload</a>();</div>
<div class="line"> </div>
<div class="line">  std::for_each(<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>, <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>+<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, [<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>](<span class="keywordtype">int</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>){ assert(<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] == 100); });</div>
<div class="line">}, <a class="code hl_typedef" href="namespaceluisa.html#aa1eb922874c2e5b0b13f4fc9a37747eb">queue</a>);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.<a class="code hl_function" href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">run</a>(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).wait();</div>
<div class="ttc" id="aclasstf_1_1sycl_flow_html_a2928c2edc466dd625741080c147de4ef"><div class="ttname"><a href="classtf_1_1sycl_flow.html#a2928c2edc466dd625741080c147de4ef">tf::syclFlow::offload</a></div><div class="ttdeci">void offload()</div><div class="ttdoc">offloads the syclFlow and executes it once</div><div class="ttdef"><b>定义</b> syclflow.hpp:574</div></div>
</div><!-- fragment --><p>Each method of task creation in <a class="el" href="classtf_1_1sycl_flow.html" title="class for building a SYCL task dependency graph">tf::syclFlow</a> has a corresponding method of rebinding a task to that task type (e.g., <a class="el" href="classtf_1_1sycl_flow.html#a20b79581d27eaed2812ffb14dc821a64" title="creates a task that launches the given command group function object">tf::syclFlow::on</a> and tf::syclFlow::rebind_on, <a class="el" href="classtf_1_1sycl_flow.html#ae42b1da441d5696dc589ee9ee89b9deb" title="creates a kernel task">tf::syclFlow::parallel_for</a> and <a class="el" href="classtf_1_1sycl_flow.html#ae42b1da441d5696dc589ee9ee89b9deb" title="creates a kernel task">tf::syclFlow::parallel_for</a>).</p>
<h1><a class="anchor" id="UsesyclFlowInAStandaloneEnvironment"></a>
Use syclFlow in a Standalone Environment</h1>
<p>You can use <a class="el" href="classtf_1_1sycl_flow.html" title="class for building a SYCL task dependency graph">tf::syclFlow</a> in a standalone environment without going through <a class="el" href="classtf_1_1_taskflow.html" title="class to create a taskflow object">tf::Taskflow</a> and offloads it to a SYCL device from the caller thread. All the tasking methods we have discussed so far apply to the standalone use.</p>
<div class="fragment"><div class="line">sycl::queue <a class="code hl_namespace" href="namespacequeue.html">queue</a>;       </div>
<div class="line"><a class="code hl_class" href="classtf_1_1sycl_flow.html">tf::syclFlow</a> sf(<a class="code hl_namespace" href="namespacequeue.html">queue</a>);  <span class="comment">// create a standalone syclFlow</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="classtf_1_1sycl_task.html">tf::syclTask</a> h2d_x = sf.copy(dx, hx.data(), <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>).<a class="code hl_function" href="classtf_1_1sycl_task.html#a738dfa209da08d8783127a5c5654558e">name</a>(<span class="stringliteral">&quot;h2d_x&quot;</span>);</div>
<div class="line"><a class="code hl_class" href="classtf_1_1sycl_task.html">tf::syclTask</a> h2d_y = sf.copy(dy, hy.data(), <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>).<a class="code hl_function" href="classtf_1_1sycl_task.html#a738dfa209da08d8783127a5c5654558e">name</a>(<span class="stringliteral">&quot;h2d_y&quot;</span>);</div>
<div class="line"><a class="code hl_class" href="classtf_1_1sycl_task.html">tf::syclTask</a> d2h_x = sf.copy(hx.data(), dx, <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>).<a class="code hl_function" href="classtf_1_1sycl_task.html#a738dfa209da08d8783127a5c5654558e">name</a>(<span class="stringliteral">&quot;d2h_x&quot;</span>);</div>
<div class="line"><a class="code hl_class" href="classtf_1_1sycl_task.html">tf::syclTask</a> d2h_y = sf.copy(hy.data(), dy, <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>).<a class="code hl_function" href="classtf_1_1sycl_task.html#a738dfa209da08d8783127a5c5654558e">name</a>(<span class="stringliteral">&quot;d2h_y&quot;</span>);</div>
<div class="line"><a class="code hl_class" href="classtf_1_1sycl_task.html">tf::syclTask</a> <a class="code hl_function" href="bench_2btl_2libs_2_b_l_a_s_2blas_8h.html#ad53e5aed16187a6bb50b8aa5f24cca8b">saxpy</a> = sf.parallel_for(</div>
<div class="line">  sycl::range&lt;1&gt;(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>), [=] (sycl::id&lt;1&gt; <span class="keywordtype">id</span>) {</div>
<div class="line">    dx[<a class="code hl_typedef" href="cocoa__platform_8h.html#acf00cd75f37488e1d4ac463303ccfec4">id</a>] = 2.0f * dx[<a class="code hl_typedef" href="cocoa__platform_8h.html#acf00cd75f37488e1d4ac463303ccfec4">id</a>] + dy[<a class="code hl_typedef" href="cocoa__platform_8h.html#acf00cd75f37488e1d4ac463303ccfec4">id</a>];</div>
<div class="line">  }</div>
<div class="line">).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;saxpy&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="bench_2btl_2libs_2_b_l_a_s_2blas_8h.html#ad53e5aed16187a6bb50b8aa5f24cca8b">saxpy</a>.succeed(h2d_x, h2d_y)   <span class="comment">// kernel runs after  host-to-device copy</span></div>
<div class="line">     .precede(d2h_x, d2h_y);  <span class="comment">// kernel runs before device-to-host copy</span></div>
<div class="line"> </div>
<div class="line">sf.offload();  <span class="comment">// offload and run the standalone syclFlow once</span></div>
</div><!-- fragment --><dl class="section note"><dt>注解</dt><dd>In the standalone mode, a written syclFlow will not be executed untile you explicitly call an offload method, as there is neither a taskflow nor an executor. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
