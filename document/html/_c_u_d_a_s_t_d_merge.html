<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>source: Parallel Merge</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">source
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="搜索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_c_u_d_a_s_t_d_merge.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Parallel Merge</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>目录</h3>
<ul>
  <li class="level1">
    <a href="#CUDASTDMergeIncludeTheHeader">Include the Header</a>
  </li>
  <li class="level1">
    <a href="#CUDASTDMergeItems">Merge Two Sorted Ranges of Items</a>
  </li>
  <li class="level1">
    <a href="#CUDASTDMergeKeyValueItems">Merge Two Sorted Ranges of Key-Value Items</a>
  </li>
</ul>
</div>
<div class="textblock"><p>Taskflow provides standalone template methods for merging two sorted ranges of items into a sorted range of items.</p>
<h1><a class="anchor" id="CUDASTDMergeIncludeTheHeader"></a>
Include the Header</h1>
<p>You need to include the header file, <code>taskflow/cuda/algorithm/merge.hpp</code>, for using the parallel-merge algorithm.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="merge_8hpp.html">taskflow/cuda/algorithm/merge.hpp</a>&gt;</span></div>
<div class="ttc" id="amerge_8hpp_html"><div class="ttname"><a href="merge_8hpp.html">merge.hpp</a></div><div class="ttdoc">CUDA merge algorithm include file</div></div>
</div><!-- fragment --><h1><a class="anchor" id="CUDASTDMergeItems"></a>
Merge Two Sorted Ranges of Items</h1>
<p><a class="el" href="namespacetf.html#a37ec481149c2f01669353033d75ed72a" title="performs asynchronous key-only merge over a range of keys">tf::cuda_merge</a> merges two sorted ranges of items into a sorted range. The following code merges two sorted arrays <code>input_1</code> and <code>input_2</code>, each of 1000 items, into a sorted array <code>output</code> of 2000 items.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = 1000;</div>
<div class="line"><span class="keywordtype">int</span>* input_1 = <a class="code hl_function" href="namespacetf.html#ad289846c38e3f122e1315d906243fc8b">tf::cuda_malloc_shared&lt;int&gt;</a>(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);    <span class="comment">// input vector 1</span></div>
<div class="line"><span class="keywordtype">int</span>* input_2 = <a class="code hl_function" href="namespacetf.html#ad289846c38e3f122e1315d906243fc8b">tf::cuda_malloc_shared&lt;int&gt;</a>(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);    <span class="comment">// input vector 2</span></div>
<div class="line"><span class="keywordtype">int</span>* <a class="code hl_variable" href="benchmarks_2scan_2scan_8hpp.html#a8390452002ecc7a0dadc5ae0dccc9b6c">output</a>  = <a class="code hl_function" href="namespacetf.html#ad289846c38e3f122e1315d906243fc8b">tf::cuda_malloc_shared&lt;int&gt;</a>(2*<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);  <span class="comment">// output vector</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// initializes the data</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line">  input_1[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = rand()%100;</div>
<div class="line">  input_2[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = rand()%100;</div>
<div class="line">}</div>
<div class="line">std::sort(input_1, input1 + <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line">std::sort(input_2, input2 + <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// create an execution policy</span></div>
<div class="line"><a class="code hl_typedef" href="namespacetf.html#af19c9b301dc0b0fe2a51a960fa427e83">tf::cudaStream</a> stream;</div>
<div class="line"><a class="code hl_typedef" href="namespacetf.html#a0c8e4b43b5822445e2316659bbd44245">tf::cudaDefaultExecutionPolicy</a> policy(stream);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// queries the required buffer size to merge two N-element sorted vectors</span></div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_struct" href="structbytes.html">bytes</a>  = policy.merge_bufsz(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a> = <a class="code hl_function" href="namespacetf.html#a2548e58af071bf1dbbbc945c84f237c9">tf::cuda_malloc_device&lt;std::byte&gt;</a>(<a class="code hl_struct" href="structbytes.html">bytes</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// merge input_1 and input_2 to output</span></div>
<div class="line"><a class="code hl_function" href="namespacetf.html#a37ec481149c2f01669353033d75ed72a">tf::cuda_merge</a>(policy, </div>
<div class="line">  input_1, input_1 + <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, input_2, input_2 + <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, <a class="code hl_variable" href="benchmarks_2scan_2scan_8hpp.html#a8390452002ecc7a0dadc5ae0dccc9b6c">output</a>, </div>
<div class="line">  []__device__ (<span class="keywordtype">int</span> <a class="code hl_variable" href="_cwise__product_8cpp.html#ad2cbe4616e813eb9af81732dca777b24">a</a>, <span class="keywordtype">int</span> <a class="code hl_variable" href="offscreen_8c.html#a846c9667e34d56c560bb7f0ac6e173f6">b</a>) { <span class="keywordflow">return</span> <a class="code hl_variable" href="_cwise__product_8cpp.html#ad2cbe4616e813eb9af81732dca777b24">a</a> &lt; <a class="code hl_variable" href="offscreen_8c.html#a846c9667e34d56c560bb7f0ac6e173f6">b</a>; },  <span class="comment">// comparator</span></div>
<div class="line">  <a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// synchronizes the execution and verifies the result</span></div>
<div class="line">stream.<a class="code hl_function" href="classtf_1_1cuda_stream_base.html#a08857ff2874cd5378e578822e2e96dd0">synchronize</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// verify the result</span></div>
<div class="line">assert(std::is_sorted(<a class="code hl_variable" href="benchmarks_2scan_2scan_8hpp.html#a8390452002ecc7a0dadc5ae0dccc9b6c">output</a>, <a class="code hl_variable" href="benchmarks_2scan_2scan_8hpp.html#a8390452002ecc7a0dadc5ae0dccc9b6c">output</a> + 2*<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>));</div>
<div class="line"> </div>
<div class="line"><span class="comment">// delete the buffer</span></div>
<div class="line">cudaFree(input1);</div>
<div class="line">cudaFree(input2);</div>
<div class="line">cudaFree(<a class="code hl_variable" href="benchmarks_2scan_2scan_8hpp.html#a8390452002ecc7a0dadc5ae0dccc9b6c">output</a>);</div>
<div class="line">cudaFree(<a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a>);</div>
<div class="ttc" id="a_bi_c_g_s_t_a_b__step__by__step_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>定义</b> BiCGSTAB_step_by_step.cpp:9</div></div>
<div class="ttc" id="a_cwise__product_8cpp_html_ad2cbe4616e813eb9af81732dca777b24"><div class="ttname"><a href="_cwise__product_8cpp.html#ad2cbe4616e813eb9af81732dca777b24">a</a></div><div class="ttdeci">Array33i a</div><div class="ttdef"><b>定义</b> Cwise_product.cpp:1</div></div>
<div class="ttc" id="abenchmarks_2scan_2scan_8hpp_html_a8390452002ecc7a0dadc5ae0dccc9b6c"><div class="ttname"><a href="benchmarks_2scan_2scan_8hpp.html#a8390452002ecc7a0dadc5ae0dccc9b6c">output</a></div><div class="ttdeci">std::vector&lt; int &gt; output</div><div class="ttdef"><b>定义</b> scan.hpp:15</div></div>
<div class="ttc" id="aclasstf_1_1cuda_stream_base_html_a08857ff2874cd5378e578822e2e96dd0"><div class="ttname"><a href="classtf_1_1cuda_stream_base.html#a08857ff2874cd5378e578822e2e96dd0">tf::cudaStreamBase::synchronize</a></div><div class="ttdeci">void synchronize() const</div><div class="ttdoc">synchronizes the associated stream</div><div class="ttdef"><b>定义</b> cuda_stream.hpp:212</div></div>
<div class="ttc" id="amain-override-static_8c_html_a0240ac851181b84ac374872dc5434ee4"><div class="ttname"><a href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a></div><div class="ttdeci">#define N</div><div class="ttdef"><b>定义</b> main-override-static.c:141</div></div>
<div class="ttc" id="anamespacetf_html_a0c8e4b43b5822445e2316659bbd44245"><div class="ttname"><a href="namespacetf.html#a0c8e4b43b5822445e2316659bbd44245">tf::cudaDefaultExecutionPolicy</a></div><div class="ttdeci">cudaExecutionPolicy&lt; 512, 7 &gt; cudaDefaultExecutionPolicy</div><div class="ttdoc">default execution policy</div><div class="ttdef"><b>定义</b> cuda_execution_policy.hpp:150</div></div>
<div class="ttc" id="anamespacetf_html_a2548e58af071bf1dbbbc945c84f237c9"><div class="ttname"><a href="namespacetf.html#a2548e58af071bf1dbbbc945c84f237c9">tf::cuda_malloc_device</a></div><div class="ttdeci">T * cuda_malloc_device(size_t N, int d)</div><div class="ttdoc">allocates memory on the given device for holding N elements of type T</div><div class="ttdef"><b>定义</b> cuda_memory.hpp:48</div></div>
<div class="ttc" id="anamespacetf_html_a37ec481149c2f01669353033d75ed72a"><div class="ttname"><a href="namespacetf.html#a37ec481149c2f01669353033d75ed72a">tf::cuda_merge</a></div><div class="ttdeci">void cuda_merge(P &amp;&amp;p, a_keys_it a_keys_first, a_keys_it a_keys_last, b_keys_it b_keys_first, b_keys_it b_keys_last, c_keys_it c_keys_first, C comp, void *buf)</div><div class="ttdoc">performs asynchronous key-only merge over a range of keys</div><div class="ttdef"><b>定义</b> merge.hpp:567</div></div>
<div class="ttc" id="anamespacetf_html_ad289846c38e3f122e1315d906243fc8b"><div class="ttname"><a href="namespacetf.html#ad289846c38e3f122e1315d906243fc8b">tf::cuda_malloc_shared</a></div><div class="ttdeci">T * cuda_malloc_shared(size_t N)</div><div class="ttdoc">allocates shared memory for holding N elements of type T</div><div class="ttdef"><b>定义</b> cuda_memory.hpp:81</div></div>
<div class="ttc" id="anamespacetf_html_af19c9b301dc0b0fe2a51a960fa427e83"><div class="ttname"><a href="namespacetf.html#af19c9b301dc0b0fe2a51a960fa427e83">tf::cudaStream</a></div><div class="ttdeci">cudaStreamBase&lt; cudaStreamCreator, cudaStreamDeleter &gt; cudaStream</div><div class="ttdoc">default smart pointer type to manage a cudaStream_t object with unique ownership</div><div class="ttdef"><b>定义</b> cuda_stream.hpp:299</div></div>
<div class="ttc" id="aoffscreen_8c_html_a846c9667e34d56c560bb7f0ac6e173f6"><div class="ttname"><a href="offscreen_8c.html#a846c9667e34d56c560bb7f0ac6e173f6">b</a></div><div class="ttdeci">float b</div><div class="ttdef"><b>定义</b> offscreen.c:42</div></div>
<div class="ttc" id="astructbytes_html"><div class="ttname"><a href="structbytes.html">bytes</a></div><div class="ttdef"><b>定义</b> format.h:3864</div></div>
<div class="ttc" id="asugar_8h_html_aaadc06b5dac8070de2c8677210967bdb"><div class="ttname"><a href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a></div><div class="ttdeci">#define buffer</div><div class="ttdef"><b>定义</b> sugar.h:84</div></div>
</div><!-- fragment --><p>The merge algorithm runs <em>asynchronously</em> through the stream specified in the execution policy. You need to synchronize the stream to obtain correct results. Since the GPU merge algorithm may require extra buffer to store the temporary results, you need to provide a buffer of size at least larger or equal to the value returned from <code><a class="el" href="classtf_1_1cuda_execution_policy.html#a1febbe549d9cbe4502a5b66167ab9553">tf::cudaDefaultExecutionPolicy::merge_bufsz</a></code>. The buffer size depends only on the two input vector sizes.</p>
<dl class="section attention"><dt>注意</dt><dd>You must keep the buffer alive before the merge call completes.</dd></dl>
<h1><a class="anchor" id="CUDASTDMergeKeyValueItems"></a>
Merge Two Sorted Ranges of Key-Value Items</h1>
<p><a class="el" href="namespacetf.html#aa84d4c68d2cbe9f6efc4a1eb1a115458" title="performs asynchronous key-value merge over a range of keys and values">tf::cuda_merge_by_key</a> performs key-value merge over two sorted ranges in a similar way to <a class="el" href="namespacetf.html#a37ec481149c2f01669353033d75ed72a" title="performs asynchronous key-only merge over a range of keys">tf::cuda_merge</a>; additionally, it copies elements from the two ranges of values associated with the two input keys, respectively. The following code performs key-value merge over <code>a</code> and <code>b:</code> </p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = 2;</div>
<div class="line"><span class="keywordtype">int</span>* a_keys = <a class="code hl_function" href="namespacetf.html#ad289846c38e3f122e1315d906243fc8b">tf::cuda_malloc_shared&lt;int&gt;</a>(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line"><span class="keywordtype">int</span>* a_vals = <a class="code hl_function" href="namespacetf.html#ad289846c38e3f122e1315d906243fc8b">tf::cuda_malloc_shared&lt;int&gt;</a>(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line"><span class="keywordtype">int</span>* b_keys = <a class="code hl_function" href="namespacetf.html#ad289846c38e3f122e1315d906243fc8b">tf::cuda_malloc_shared&lt;int&gt;</a>(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line"><span class="keywordtype">int</span>* b_vals = <a class="code hl_function" href="namespacetf.html#ad289846c38e3f122e1315d906243fc8b">tf::cuda_malloc_shared&lt;int&gt;</a>(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line"><span class="keywordtype">int</span>* c_keys = <a class="code hl_function" href="namespacetf.html#ad289846c38e3f122e1315d906243fc8b">tf::cuda_malloc_shared&lt;int&gt;</a>(2*<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line"><span class="keywordtype">int</span>* c_vals = <a class="code hl_function" href="namespacetf.html#ad289846c38e3f122e1315d906243fc8b">tf::cuda_malloc_shared&lt;int&gt;</a>(2*<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// initializes the data</span></div>
<div class="line">a_keys[0] = 8, a_keys[1] = 1;</div>
<div class="line">a_vals[0] = 1, a_vals[1] = 2;</div>
<div class="line">b_keys[0] = 3, b_keys[1] = 7;</div>
<div class="line">b_vals[0] = 3, b_vals[1] = 4;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// create an execution policy</span></div>
<div class="line"><a class="code hl_typedef" href="namespacetf.html#af19c9b301dc0b0fe2a51a960fa427e83">tf::cudaStream</a> stream;</div>
<div class="line"><a class="code hl_typedef" href="namespacetf.html#a0c8e4b43b5822445e2316659bbd44245">tf::cudaDefaultExecutionPolicy</a> policy(stream);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// queries the required buffer size to merge two N-element sorted vectors by keys</span></div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_struct" href="structbytes.html">bytes</a>  = policy.merge_bufsz(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a> = <a class="code hl_function" href="namespacetf.html#a2548e58af071bf1dbbbc945c84f237c9">tf::cuda_malloc_device&lt;std::byte&gt;</a>(<a class="code hl_struct" href="structbytes.html">bytes</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// merge keys and values of a and b to c</span></div>
<div class="line"><a class="code hl_function" href="namespacetf.html#aa84d4c68d2cbe9f6efc4a1eb1a115458">tf::cuda_merge_by_key</a>(</div>
<div class="line">  policy, </div>
<div class="line">  a_keys, a_keys+<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, a_vals,</div>
<div class="line">  b_keys, b_keys+<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, b_vals,</div>
<div class="line">  c_keys, c_vals,</div>
<div class="line">  []__device__ (<span class="keywordtype">int</span> <a class="code hl_variable" href="_cwise__product_8cpp.html#ad2cbe4616e813eb9af81732dca777b24">a</a>, <span class="keywordtype">int</span> <a class="code hl_variable" href="offscreen_8c.html#a846c9667e34d56c560bb7f0ac6e173f6">b</a>) { <span class="keywordflow">return</span> <a class="code hl_variable" href="_cwise__product_8cpp.html#ad2cbe4616e813eb9af81732dca777b24">a</a> &lt; <a class="code hl_variable" href="offscreen_8c.html#a846c9667e34d56c560bb7f0ac6e173f6">b</a>; },  <span class="comment">// comparator</span></div>
<div class="line">  <a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// wait for the merge to complete</span></div>
<div class="line">stream.<a class="code hl_function" href="classtf_1_1cuda_stream_base.html#a08857ff2874cd5378e578822e2e96dd0">synchronize</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// now, c_keys = {1, 3, 7, 8}</span></div>
<div class="line"><span class="comment">// now, c_vals = {2, 3, 4, 1}</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// delete the device memory</span></div>
<div class="line">cudaFree(<a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a>);</div>
<div class="line">cudaFree(a_keys);</div>
<div class="line">cudaFree(b_keys);</div>
<div class="line">cudaFree(c_keys);</div>
<div class="line">cudaFree(a_vals);</div>
<div class="line">cudaFree(b_vals);</div>
<div class="line">cudaFree(c_vals);</div>
<div class="ttc" id="anamespacetf_html_aa84d4c68d2cbe9f6efc4a1eb1a115458"><div class="ttname"><a href="namespacetf.html#aa84d4c68d2cbe9f6efc4a1eb1a115458">tf::cuda_merge_by_key</a></div><div class="ttdeci">void cuda_merge_by_key(P &amp;&amp;p, a_keys_it a_keys_first, a_keys_it a_keys_last, a_vals_it a_vals_first, b_keys_it b_keys_first, b_keys_it b_keys_last, b_vals_it b_vals_first, c_keys_it c_keys_first, c_vals_it c_vals_first, C comp, void *buf)</div><div class="ttdoc">performs asynchronous key-value merge over a range of keys and values</div><div class="ttdef"><b>定义</b> merge.hpp:515</div></div>
</div><!-- fragment --><p>Since the GPU merge algorithm may require extra buffer to store the temporary results, you need to provide a buffer of size at least larger or equal to the value returned from <code><a class="el" href="classtf_1_1cuda_execution_policy.html#a1febbe549d9cbe4502a5b66167ab9553">tf::cudaDefaultExecutionPolicy::merge_bufsz</a></code>. The buffer size depends only on the two input vector sizes. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
