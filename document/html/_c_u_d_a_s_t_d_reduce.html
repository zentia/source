<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>source: Parallel Reduction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">source
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="搜索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_c_u_d_a_s_t_d_reduce.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Parallel Reduction</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>目录</h3>
<ul>
  <li class="level1">
    <a href="#CUDASTDParallelReductionIncludeTheHeader">Include the Header</a>
  </li>
  <li class="level1">
    <a href="#CUDASTDReduceItemsWithAnInitialValue">Reduce a Range of Items with an Initial Value</a>
  </li>
  <li class="level1">
    <a href="#CUDASTDReduceItemsWithoutAnInitialValue">Reduce a Range of Items without an Initial Value</a>
  </li>
  <li class="level1">
    <a href="#CUDASTDReduceTransformedItemsWithAnInitialValue">Reduce a Range of Transformed Items with an Initial Value</a>
  </li>
  <li class="level1">
    <a href="#CUDASTDReduceTransformedItemsWithoutAnInitialValue">Reduce a Range of Transformed Items without an Initial Value</a>
  </li>
</ul>
</div>
<div class="textblock"><p>Taskflow provides standard template methods for reducing a range of items on a CUDA GPU.</p>
<h1><a class="anchor" id="CUDASTDParallelReductionIncludeTheHeader"></a>
Include the Header</h1>
<p>You need to include the header file, <code>taskflow/cuda/algorithm/reduce.hpp</code>, for using the parallel-reduction algorithm.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="taskflow_2cuda_2algorithm_2reduce_8hpp.html">taskflow/cuda/algorithm/reduce.hpp</a>&gt;</span></div>
<div class="ttc" id="ataskflow_2cuda_2algorithm_2reduce_8hpp_html"><div class="ttname"><a href="taskflow_2cuda_2algorithm_2reduce_8hpp.html">reduce.hpp</a></div><div class="ttdoc">cuda reduce algorithms include file</div></div>
</div><!-- fragment --><h1><a class="anchor" id="CUDASTDReduceItemsWithAnInitialValue"></a>
Reduce a Range of Items with an Initial Value</h1>
<p><a class="el" href="namespacetf.html#a8a872d2a0ac73a676713cb5be5aa688c" title="performs asynchronous parallel reduction over a range of items">tf::cuda_reduce</a> performs a parallel reduction over a range of elements specified by <code>[first, last)</code> using the binary operator <code>bop</code> and stores the reduced result in <code>result</code>. It represents the parallel execution of the following reduction loop on a GPU:</p>
<div class="fragment"><div class="line"><span class="keywordflow">while</span> (first != last) {</div>
<div class="line">  *<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aa7f56a70231ed8bc64f97aa7c37fcb19">result</a> = bop(*<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aa7f56a70231ed8bc64f97aa7c37fcb19">result</a>, *first++);</div>
<div class="line">}</div>
<div class="ttc" id="aimgui__impl__opengl3__loader_8h_html_aa7f56a70231ed8bc64f97aa7c37fcb19"><div class="ttname"><a href="imgui__impl__opengl3__loader_8h.html#aa7f56a70231ed8bc64f97aa7c37fcb19">result</a></div><div class="ttdeci">GLuint GLuint64EXT * result</div><div class="ttdef"><b>定义</b> imgui_impl_opengl3_loader.h:446</div></div>
</div><!-- fragment --><p>The variable <code>result</code> participates in the reduction loop and must be initialized with an initial value. The following code performs a parallel reduction to sum all the numbers in the given range with an initial value <code>1000</code>:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = 1000000;</div>
<div class="line"><span class="keywordtype">int</span>* <a class="code hl_variable" href="_partial_redux__count_8cpp.html#acbe60897559b79afc28b79b0687b5f29">res</a> = <a class="code hl_function" href="namespacetf.html#ad289846c38e3f122e1315d906243fc8b">tf::cuda_malloc_shared&lt;int&gt;</a>(1);  <span class="comment">// result</span></div>
<div class="line"><span class="keywordtype">int</span>* <a class="code hl_variable" href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a> = <a class="code hl_function" href="namespacetf.html#ad289846c38e3f122e1315d906243fc8b">tf::cuda_malloc_shared&lt;int&gt;</a>(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);  <span class="comment">// vector</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// initializes the data</span></div>
<div class="line">*<a class="code hl_variable" href="_partial_redux__count_8cpp.html#acbe60897559b79afc28b79b0687b5f29">res</a> = 1000;</div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) </div>
<div class="line">  <a class="code hl_variable" href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line">} </div>
<div class="line"> </div>
<div class="line"><span class="comment">// create an execution policy</span></div>
<div class="line"><a class="code hl_typedef" href="namespacetf.html#af19c9b301dc0b0fe2a51a960fa427e83">tf::cudaStream</a> stream;</div>
<div class="line"><a class="code hl_typedef" href="namespacetf.html#a0c8e4b43b5822445e2316659bbd44245">tf::cudaDefaultExecutionPolicy</a> policy(stream);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// queries the required buffer size to reduce N elements using the given policy</span></div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_struct" href="structbytes.html">bytes</a>  = policy.reduce_bufsz&lt;<span class="keywordtype">int</span>&gt;(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a> = <a class="code hl_function" href="namespacetf.html#a2548e58af071bf1dbbbc945c84f237c9">tf::cuda_malloc_device&lt;std::byte&gt;</a>(<a class="code hl_struct" href="structbytes.html">bytes</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// *res = 1000 + (0 + 1 + 2 + 3 + 4 + ... + N-1)</span></div>
<div class="line"><a class="code hl_function" href="namespacetf.html#a8a872d2a0ac73a676713cb5be5aa688c">tf::cuda_reduce</a>(policy,</div>
<div class="line">  <a class="code hl_variable" href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a>, <a class="code hl_variable" href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a> + <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, <a class="code hl_variable" href="_partial_redux__count_8cpp.html#acbe60897559b79afc28b79b0687b5f29">res</a>, [] __device__ (<span class="keywordtype">int</span> <a class="code hl_variable" href="_cwise__product_8cpp.html#ad2cbe4616e813eb9af81732dca777b24">a</a>, <span class="keywordtype">int</span> <a class="code hl_variable" href="offscreen_8c.html#a846c9667e34d56c560bb7f0ac6e173f6">b</a>) { <span class="keywordflow">return</span> <a class="code hl_variable" href="_cwise__product_8cpp.html#ad2cbe4616e813eb9af81732dca777b24">a</a> + <a class="code hl_variable" href="offscreen_8c.html#a846c9667e34d56c560bb7f0ac6e173f6">b</a>; }, <a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// synchronize the execution</span></div>
<div class="line">stream.<a class="code hl_function" href="classtf_1_1cuda_stream_base.html#a08857ff2874cd5378e578822e2e96dd0">synchronize</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// delete the memory</span></div>
<div class="line">cudaFree(<a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a>);</div>
<div class="line">cudaFree(<a class="code hl_variable" href="_partial_redux__count_8cpp.html#acbe60897559b79afc28b79b0687b5f29">res</a>);</div>
<div class="line">cudaFree(<a class="code hl_variable" href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a>);</div>
<div class="ttc" id="a_bi_c_g_s_t_a_b__step__by__step_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>定义</b> BiCGSTAB_step_by_step.cpp:9</div></div>
<div class="ttc" id="a_cwise__product_8cpp_html_ad2cbe4616e813eb9af81732dca777b24"><div class="ttname"><a href="_cwise__product_8cpp.html#ad2cbe4616e813eb9af81732dca777b24">a</a></div><div class="ttdeci">Array33i a</div><div class="ttdef"><b>定义</b> Cwise_product.cpp:1</div></div>
<div class="ttc" id="a_partial_redux__count_8cpp_html_acbe60897559b79afc28b79b0687b5f29"><div class="ttname"><a href="_partial_redux__count_8cpp.html#acbe60897559b79afc28b79b0687b5f29">res</a></div><div class="ttdeci">cout&lt;&lt; &quot;Here is the matrix m:&quot;&lt;&lt; endl&lt;&lt; m&lt;&lt; endl;Matrix&lt; ptrdiff_t, 3, 1 &gt; res</div><div class="ttdef"><b>定义</b> PartialRedux_count.cpp:3</div></div>
<div class="ttc" id="abenchmarks_2for__each_2for__each_8hpp_html_ad86cbaae2e3f21959301250e9f7c2701"><div class="ttname"><a href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a></div><div class="ttdeci">std::vector&lt; double &gt; vec</div><div class="ttdef"><b>定义</b> for_each.hpp:14</div></div>
<div class="ttc" id="aclasstf_1_1cuda_stream_base_html_a08857ff2874cd5378e578822e2e96dd0"><div class="ttname"><a href="classtf_1_1cuda_stream_base.html#a08857ff2874cd5378e578822e2e96dd0">tf::cudaStreamBase::synchronize</a></div><div class="ttdeci">void synchronize() const</div><div class="ttdoc">synchronizes the associated stream</div><div class="ttdef"><b>定义</b> cuda_stream.hpp:212</div></div>
<div class="ttc" id="amain-override-static_8c_html_a0240ac851181b84ac374872dc5434ee4"><div class="ttname"><a href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a></div><div class="ttdeci">#define N</div><div class="ttdef"><b>定义</b> main-override-static.c:141</div></div>
<div class="ttc" id="anamespacetf_html_a0c8e4b43b5822445e2316659bbd44245"><div class="ttname"><a href="namespacetf.html#a0c8e4b43b5822445e2316659bbd44245">tf::cudaDefaultExecutionPolicy</a></div><div class="ttdeci">cudaExecutionPolicy&lt; 512, 7 &gt; cudaDefaultExecutionPolicy</div><div class="ttdoc">default execution policy</div><div class="ttdef"><b>定义</b> cuda_execution_policy.hpp:150</div></div>
<div class="ttc" id="anamespacetf_html_a2548e58af071bf1dbbbc945c84f237c9"><div class="ttname"><a href="namespacetf.html#a2548e58af071bf1dbbbc945c84f237c9">tf::cuda_malloc_device</a></div><div class="ttdeci">T * cuda_malloc_device(size_t N, int d)</div><div class="ttdoc">allocates memory on the given device for holding N elements of type T</div><div class="ttdef"><b>定义</b> cuda_memory.hpp:48</div></div>
<div class="ttc" id="anamespacetf_html_a8a872d2a0ac73a676713cb5be5aa688c"><div class="ttname"><a href="namespacetf.html#a8a872d2a0ac73a676713cb5be5aa688c">tf::cuda_reduce</a></div><div class="ttdeci">void cuda_reduce(P &amp;&amp;p, I first, I last, T *res, O op, void *buf)</div><div class="ttdoc">performs asynchronous parallel reduction over a range of items</div><div class="ttdef"><b>定义</b> reduce.hpp:253</div></div>
<div class="ttc" id="anamespacetf_html_ad289846c38e3f122e1315d906243fc8b"><div class="ttname"><a href="namespacetf.html#ad289846c38e3f122e1315d906243fc8b">tf::cuda_malloc_shared</a></div><div class="ttdeci">T * cuda_malloc_shared(size_t N)</div><div class="ttdoc">allocates shared memory for holding N elements of type T</div><div class="ttdef"><b>定义</b> cuda_memory.hpp:81</div></div>
<div class="ttc" id="anamespacetf_html_af19c9b301dc0b0fe2a51a960fa427e83"><div class="ttname"><a href="namespacetf.html#af19c9b301dc0b0fe2a51a960fa427e83">tf::cudaStream</a></div><div class="ttdeci">cudaStreamBase&lt; cudaStreamCreator, cudaStreamDeleter &gt; cudaStream</div><div class="ttdoc">default smart pointer type to manage a cudaStream_t object with unique ownership</div><div class="ttdef"><b>定义</b> cuda_stream.hpp:299</div></div>
<div class="ttc" id="aoffscreen_8c_html_a846c9667e34d56c560bb7f0ac6e173f6"><div class="ttname"><a href="offscreen_8c.html#a846c9667e34d56c560bb7f0ac6e173f6">b</a></div><div class="ttdeci">float b</div><div class="ttdef"><b>定义</b> offscreen.c:42</div></div>
<div class="ttc" id="astructbytes_html"><div class="ttname"><a href="structbytes.html">bytes</a></div><div class="ttdef"><b>定义</b> format.h:3864</div></div>
<div class="ttc" id="asugar_8h_html_aaadc06b5dac8070de2c8677210967bdb"><div class="ttname"><a href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a></div><div class="ttdeci">#define buffer</div><div class="ttdef"><b>定义</b> sugar.h:84</div></div>
</div><!-- fragment --><p>The reduce algorithm runs <em>asynchronously</em> through the stream specified in the execution policy. You need to synchronize the stream to obtain correct results. Since the GPU reduction algorithm may require extra buffer to store the temporary results, you need to provide a buffer of size at least larger or equal to the value returned from <code><a class="el" href="classtf_1_1cuda_execution_policy.html#a446cee95bb839ee180052059e2ad7fd6">tf::cudaDefaultExecutionPolicy::reduce_bufsz</a></code>.</p>
<dl class="section attention"><dt>注意</dt><dd>You must keep the buffer alive before the reduction completes.</dd></dl>
<h1><a class="anchor" id="CUDASTDReduceItemsWithoutAnInitialValue"></a>
Reduce a Range of Items without an Initial Value</h1>
<p><a class="el" href="namespacetf.html#a492e8410db032a0273a99dd905486161" title="performs asynchronous parallel reduction over a range of items without an initial value">tf::cuda_uninitialized_reduce</a> performs a parallel reduction over a range of items without an initial value. This method represents a parallel execution of the following reduction loop on a GPU:</p>
<div class="fragment"><div class="line">*<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aa7f56a70231ed8bc64f97aa7c37fcb19">result</a> = *first++;  <span class="comment">// no initial values to participate in the reduction loop</span></div>
<div class="line"><span class="keywordflow">while</span> (first != last) {</div>
<div class="line">  *<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aa7f56a70231ed8bc64f97aa7c37fcb19">result</a> = bop(*<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aa7f56a70231ed8bc64f97aa7c37fcb19">result</a>, *first++);</div>
<div class="line">}</div>
</div><!-- fragment --><p>The variable <code>result</code> is directly assigned the reduced value without any initial value participating in the reduction loop. The following code performs a parallel reduction to sum all the numbers in the given range without any initial value:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = 1000000;</div>
<div class="line"><span class="keywordtype">int</span>* <a class="code hl_variable" href="_partial_redux__count_8cpp.html#acbe60897559b79afc28b79b0687b5f29">res</a> = <a class="code hl_function" href="namespacetf.html#ad289846c38e3f122e1315d906243fc8b">tf::cuda_malloc_shared&lt;int&gt;</a>(1);  <span class="comment">// result</span></div>
<div class="line"><span class="keywordtype">int</span>* <a class="code hl_variable" href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a> = <a class="code hl_function" href="namespacetf.html#ad289846c38e3f122e1315d906243fc8b">tf::cuda_malloc_shared&lt;int&gt;</a>(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);  <span class="comment">// vector</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// initializes the data</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) </div>
<div class="line">  <a class="code hl_variable" href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line">} </div>
<div class="line"> </div>
<div class="line"><span class="comment">// create an execution policy</span></div>
<div class="line"><a class="code hl_typedef" href="namespacetf.html#af19c9b301dc0b0fe2a51a960fa427e83">tf::cudaStream</a> stream;</div>
<div class="line"><a class="code hl_typedef" href="namespacetf.html#a0c8e4b43b5822445e2316659bbd44245">tf::cudaDefaultExecutionPolicy</a> policy(stream);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// queries the required buffer size to reduce N elements using the given policy</span></div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_struct" href="structbytes.html">bytes</a>  = policy.reduce_bufsz&lt;<span class="keywordtype">int</span>&gt;(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a> = <a class="code hl_function" href="namespacetf.html#a2548e58af071bf1dbbbc945c84f237c9">tf::cuda_malloc_device&lt;std::byte&gt;</a>(<a class="code hl_struct" href="structbytes.html">bytes</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// *res = 0 + 1 + 2 + 3 + 4 + ... + N-1</span></div>
<div class="line"><a class="code hl_function" href="namespacetf.html#a492e8410db032a0273a99dd905486161">tf::cuda_uninitialized_reduce</a>(policy,</div>
<div class="line">  <a class="code hl_variable" href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a>, <a class="code hl_variable" href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a> + <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, <a class="code hl_variable" href="_partial_redux__count_8cpp.html#acbe60897559b79afc28b79b0687b5f29">res</a>, [] __device__ (<span class="keywordtype">int</span> <a class="code hl_variable" href="_cwise__product_8cpp.html#ad2cbe4616e813eb9af81732dca777b24">a</a>, <span class="keywordtype">int</span> <a class="code hl_variable" href="offscreen_8c.html#a846c9667e34d56c560bb7f0ac6e173f6">b</a>) { <span class="keywordflow">return</span> <a class="code hl_variable" href="_cwise__product_8cpp.html#ad2cbe4616e813eb9af81732dca777b24">a</a> + <a class="code hl_variable" href="offscreen_8c.html#a846c9667e34d56c560bb7f0ac6e173f6">b</a>; }, <a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// synchronize the execution</span></div>
<div class="line">stream.<a class="code hl_function" href="classtf_1_1cuda_stream_base.html#a08857ff2874cd5378e578822e2e96dd0">synchronize</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// delete the buffer</span></div>
<div class="line">cudaFree(<a class="code hl_variable" href="_partial_redux__count_8cpp.html#acbe60897559b79afc28b79b0687b5f29">res</a>);</div>
<div class="line">cudaFree(<a class="code hl_variable" href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a>);</div>
<div class="line">cudaFree(<a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a>);</div>
<div class="ttc" id="anamespacetf_html_a492e8410db032a0273a99dd905486161"><div class="ttname"><a href="namespacetf.html#a492e8410db032a0273a99dd905486161">tf::cuda_uninitialized_reduce</a></div><div class="ttdeci">void cuda_uninitialized_reduce(P &amp;&amp;p, I first, I last, T *res, O op, void *buf)</div><div class="ttdoc">performs asynchronous parallel reduction over a range of items without an initial value</div><div class="ttdef"><b>定义</b> reduce.hpp:294</div></div>
</div><!-- fragment --><h1><a class="anchor" id="CUDASTDReduceTransformedItemsWithAnInitialValue"></a>
Reduce a Range of Transformed Items with an Initial Value</h1>
<p><a class="el" href="namespacetf.html#a4463d06240d608bc31d8b3546a851e4e" title="performs asynchronous parallel reduction over a range of transformed items without an initial value">tf::cuda_transform_reduce</a> performs a parallel reduction over a range of <em>transformed</em> elements specified by <code>[first, last)</code> using a binary reduce operator <code>bop</code> and a unary transform operator <code>uop</code>. It represents the parallel execution of the following reduction loop on a GPU:</p>
<div class="fragment"><div class="line"><span class="keywordflow">while</span> (first != last) {</div>
<div class="line">  *<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aa7f56a70231ed8bc64f97aa7c37fcb19">result</a> = bop(*<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aa7f56a70231ed8bc64f97aa7c37fcb19">result</a>, uop(*first++));</div>
<div class="line">}</div>
</div><!-- fragment --><p>The variable <code>result</code> participates in the reduction loop and must be initialized with an initial value. The following code performs a parallel reduction to sum all the transformed numbers multiplied by <code>10</code> in the given range with an initial value <code>1000</code>:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = 1000000;</div>
<div class="line"><span class="keywordtype">int</span>* <a class="code hl_variable" href="_partial_redux__count_8cpp.html#acbe60897559b79afc28b79b0687b5f29">res</a> = <a class="code hl_function" href="namespacetf.html#ad289846c38e3f122e1315d906243fc8b">tf::cuda_malloc_shared&lt;int&gt;</a>(1);  <span class="comment">// result</span></div>
<div class="line"><span class="keywordtype">int</span>* <a class="code hl_variable" href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a> = <a class="code hl_function" href="namespacetf.html#ad289846c38e3f122e1315d906243fc8b">tf::cuda_malloc_shared&lt;int&gt;</a>(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);  <span class="comment">// vector</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// initializes the data</span></div>
<div class="line">*<a class="code hl_variable" href="_partial_redux__count_8cpp.html#acbe60897559b79afc28b79b0687b5f29">res</a> = 1000;</div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line">  <a class="code hl_variable" href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line">} </div>
<div class="line"> </div>
<div class="line"><span class="comment">// create an execution policy</span></div>
<div class="line"><a class="code hl_typedef" href="namespacetf.html#af19c9b301dc0b0fe2a51a960fa427e83">tf::cudaStream</a> stream;</div>
<div class="line"><a class="code hl_typedef" href="namespacetf.html#a0c8e4b43b5822445e2316659bbd44245">tf::cudaDefaultExecutionPolicy</a> policy(stream);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// queries the required buffer size to reduce N elements using the given policy</span></div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_struct" href="structbytes.html">bytes</a>  = policy.reduce_bufsz&lt;<span class="keywordtype">int</span>&gt;(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a> = <a class="code hl_function" href="namespacetf.html#a2548e58af071bf1dbbbc945c84f237c9">tf::cuda_malloc_device&lt;std::byte&gt;</a>(<a class="code hl_struct" href="structbytes.html">bytes</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// *res = 1000 + (0*10 + 1*10 + 2*10 + 3*10 + 4*10 + ... + (N-1)*10)</span></div>
<div class="line"><a class="code hl_function" href="namespacetf.html#a4463d06240d608bc31d8b3546a851e4e">tf::cuda_transform_reduce</a>(policy,</div>
<div class="line">  <a class="code hl_variable" href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a>, <a class="code hl_variable" href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a> + <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, <a class="code hl_variable" href="_partial_redux__count_8cpp.html#acbe60897559b79afc28b79b0687b5f29">res</a>, </div>
<div class="line">  [] __device__ (<span class="keywordtype">int</span> <a class="code hl_variable" href="_cwise__product_8cpp.html#ad2cbe4616e813eb9af81732dca777b24">a</a>, <span class="keywordtype">int</span> <a class="code hl_variable" href="offscreen_8c.html#a846c9667e34d56c560bb7f0ac6e173f6">b</a>) { <span class="keywordflow">return</span> <a class="code hl_variable" href="_cwise__product_8cpp.html#ad2cbe4616e813eb9af81732dca777b24">a</a> + <a class="code hl_variable" href="offscreen_8c.html#a846c9667e34d56c560bb7f0ac6e173f6">b</a>; },</div>
<div class="line">  [] __device__ (<span class="keywordtype">int</span> <a class="code hl_variable" href="_cwise__product_8cpp.html#ad2cbe4616e813eb9af81732dca777b24">a</a>) { <span class="keywordflow">return</span> <a class="code hl_variable" href="_cwise__product_8cpp.html#ad2cbe4616e813eb9af81732dca777b24">a</a>*10; },</div>
<div class="line">  <a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// synchronize the execution</span></div>
<div class="line">stream.<a class="code hl_function" href="classtf_1_1cuda_stream_base.html#a08857ff2874cd5378e578822e2e96dd0">synchronize</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// delete the buffer</span></div>
<div class="line">cudaFree(<a class="code hl_variable" href="_partial_redux__count_8cpp.html#acbe60897559b79afc28b79b0687b5f29">res</a>);</div>
<div class="line">cudaFree(<a class="code hl_variable" href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a>);</div>
<div class="line">cudaFree(<a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a>);</div>
<div class="ttc" id="anamespacetf_html_a4463d06240d608bc31d8b3546a851e4e"><div class="ttname"><a href="namespacetf.html#a4463d06240d608bc31d8b3546a851e4e">tf::cuda_transform_reduce</a></div><div class="ttdeci">void cuda_transform_reduce(P &amp;&amp;p, I first, I last, T *res, O bop, U uop, void *buf)</div><div class="ttdoc">performs asynchronous parallel reduction over a range of transformed items without an initial value</div><div class="ttdef"><b>定义</b> reduce.hpp:335</div></div>
</div><!-- fragment --><h1><a class="anchor" id="CUDASTDReduceTransformedItemsWithoutAnInitialValue"></a>
Reduce a Range of Transformed Items without an Initial Value</h1>
<p>tf::cuda_transform_uninitialized_reduce performs a parallel reduction over a range of transformed items without an initial value. This method represents a parallel execution of the following reduction loop on a GPU:</p>
<div class="fragment"><div class="line">*<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aa7f56a70231ed8bc64f97aa7c37fcb19">result</a> = *first++;  <span class="comment">// no initial values to participate in the reduction loop</span></div>
<div class="line"><span class="keywordflow">while</span> (first != last) {</div>
<div class="line">  *<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aa7f56a70231ed8bc64f97aa7c37fcb19">result</a> = bop(*<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aa7f56a70231ed8bc64f97aa7c37fcb19">result</a>, uop(*first++));</div>
<div class="line">}</div>
</div><!-- fragment --><p>The variable <code>result</code> is directly assigned the reduced value without any initial value participating in the reduction loop. The following code performs a parallel reduction to sum all the transformed numbers multiplied by <code>10</code> in the given range without any initial value:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = 1000000;</div>
<div class="line"><span class="keywordtype">int</span>* <a class="code hl_variable" href="_partial_redux__count_8cpp.html#acbe60897559b79afc28b79b0687b5f29">res</a> = <a class="code hl_function" href="namespacetf.html#ad289846c38e3f122e1315d906243fc8b">tf::cuda_malloc_shared&lt;int&gt;</a>(1);  <span class="comment">// result</span></div>
<div class="line"><span class="keywordtype">int</span>* <a class="code hl_variable" href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a> = <a class="code hl_function" href="namespacetf.html#ad289846c38e3f122e1315d906243fc8b">tf::cuda_malloc_shared&lt;int&gt;</a>(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);  <span class="comment">// vector</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// initializes the data</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line">  <a class="code hl_variable" href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line">} </div>
<div class="line"> </div>
<div class="line"><span class="comment">// create an execution policy</span></div>
<div class="line"><a class="code hl_typedef" href="namespacetf.html#af19c9b301dc0b0fe2a51a960fa427e83">tf::cudaStream</a> stream;</div>
<div class="line"><a class="code hl_typedef" href="namespacetf.html#a0c8e4b43b5822445e2316659bbd44245">tf::cudaDefaultExecutionPolicy</a> policy(stream);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// queries the required buffer size to reduce N elements using the given policy</span></div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_struct" href="structbytes.html">bytes</a>  = policy.reduce_bufsz&lt;<span class="keywordtype">int</span>&gt;(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line"><span class="keyword">auto</span> <a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a> = <a class="code hl_function" href="namespacetf.html#a2548e58af071bf1dbbbc945c84f237c9">tf::cuda_malloc_device&lt;std::byte&gt;</a>(<a class="code hl_struct" href="structbytes.html">bytes</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// *res = 0*10 + 1*10 + 2*10 + 3*10 + 4*10 + ... + (N-1)*10</span></div>
<div class="line"><a class="code hl_function" href="namespacetf.html#a492e8410db032a0273a99dd905486161">tf::cuda_uninitialized_reduce</a>(policy,</div>
<div class="line">  <a class="code hl_variable" href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a>, <a class="code hl_variable" href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a> + <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, <a class="code hl_variable" href="_partial_redux__count_8cpp.html#acbe60897559b79afc28b79b0687b5f29">res</a>, </div>
<div class="line">  [] __device__ (<span class="keywordtype">int</span> <a class="code hl_variable" href="_cwise__product_8cpp.html#ad2cbe4616e813eb9af81732dca777b24">a</a>, <span class="keywordtype">int</span> <a class="code hl_variable" href="offscreen_8c.html#a846c9667e34d56c560bb7f0ac6e173f6">b</a>) { <span class="keywordflow">return</span> <a class="code hl_variable" href="_cwise__product_8cpp.html#ad2cbe4616e813eb9af81732dca777b24">a</a> + <a class="code hl_variable" href="offscreen_8c.html#a846c9667e34d56c560bb7f0ac6e173f6">b</a>; },</div>
<div class="line">  [] __device__ (<span class="keywordtype">int</span> <a class="code hl_variable" href="_cwise__product_8cpp.html#ad2cbe4616e813eb9af81732dca777b24">a</a>) { <span class="keywordflow">return</span> <a class="code hl_variable" href="_cwise__product_8cpp.html#ad2cbe4616e813eb9af81732dca777b24">a</a>*10; },</div>
<div class="line">  <a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// synchronize the execution</span></div>
<div class="line">stream.<a class="code hl_function" href="classtf_1_1cuda_stream_base.html#a08857ff2874cd5378e578822e2e96dd0">synchronize</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// delete the data</span></div>
<div class="line">cudaFree(<a class="code hl_variable" href="_partial_redux__count_8cpp.html#acbe60897559b79afc28b79b0687b5f29">res</a>);</div>
<div class="line">cudaFree(<a class="code hl_variable" href="benchmarks_2for__each_2for__each_8hpp.html#ad86cbaae2e3f21959301250e9f7c2701">vec</a>);</div>
<div class="line">cudaFree(<a class="code hl_define" href="sugar_8h.html#aaadc06b5dac8070de2c8677210967bdb">buffer</a>);</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
