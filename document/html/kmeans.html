<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>source: k-means Clustering</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">source
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="搜索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('kmeans.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">k-means Clustering</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>目录</h3>
<ul>
  <li class="level1">
    <a href="#KMeansProblemFormulation">Problem Formulation</a>
  </li>
  <li class="level1">
    <a href="#ParallelKMeansUsingCPUs">Parallel k-means using CPUs</a>
  </li>
  <li class="level1">
    <a href="#KMeansBenchmarking">Benchmarking</a>
  </li>
</ul>
</div>
<div class="textblock"><p>We study a fundamental clustering problem in unsupervised learning, <em>k-means clustering</em>. We will begin by discussing the problem formulation and then learn how to write a parallel k-means algorithm.</p>
<h1><a class="anchor" id="KMeansProblemFormulation"></a>
Problem Formulation</h1>
<p>k-means clustering uses <em>centroids</em>, k different randomly-initiated points in the data, and assigns every data point to the nearest centroid. After every point has been assigned, the centroid is moved to the average of all of the points assigned to it. We describe the k-means algorithm in the following steps:</p>
<ul>
<li>
Step 1: initialize k random centroids </li>
<li>
Step 2: for every data point, find the nearest centroid (L2 distance or other measurements) and assign the point to it </li>
<li>
Step 3: for every centroid, move the centroid to the average of the points assigned to that centroid </li>
<li>
Step 4: go to Step 2 until converged (no more changes in the last few iterations) or maximum iterations reached </li>
</ul>
<p>The algorithm is illustrated as follows:</p>
<div class="image">
<img src="images/kmeans_1.png" alt=""/>
</div>
<p><a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> sequential implementation of k-means is described as follows:</p>
<div class="fragment"><div class="line"><span class="comment">// sequential implementation of k-means on a CPU</span></div>
<div class="line"><span class="comment">// N: number of points</span></div>
<div class="line"><span class="comment">// K: number of clusters</span></div>
<div class="line"><span class="comment">// M: number of iterations</span></div>
<div class="line"><span class="comment">// px/py: 2D point vector </span></div>
<div class="line"><span class="keywordtype">void</span> kmeans_seq(</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, <span class="keywordtype">int</span> K, <span class="keywordtype">int</span> <a class="code hl_define" href="test__overwrite__node_8cpp.html#a52037c938e3c1b126c6277da5ca689d0">M</a>, <span class="keyword">const</span> std::vector&lt;float&gt;&amp; <a class="code hl_variable" href="level1__cplx__impl_8h.html#aa422b67a42f6a655b79abc04b8c0ad49">px</a>, <span class="keyword">const</span> std::vector&lt;float&gt;&amp; <a class="code hl_variable" href="level1__cplx__impl_8h.html#abecb3a9c27c34b3023649d5e329c235b">py</a></div>
<div class="line">) {</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;int&gt; <a class="code hl_variable" href="bench_vec_add_8cpp.html#a41689956983587b085f9da3e48f31d99">c</a>(K);</div>
<div class="line">  std::vector&lt;float&gt; sx(K), sy(K), mx(K), my(K);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// initial centroids</span></div>
<div class="line">  std::copy_n(<a class="code hl_variable" href="level1__cplx__impl_8h.html#aa422b67a42f6a655b79abc04b8c0ad49">px</a>.begin(), K, mx.begin());</div>
<div class="line">  std::copy_n(<a class="code hl_variable" href="level1__cplx__impl_8h.html#abecb3a9c27c34b3023649d5e329c235b">py</a>.begin(), K, my.begin());</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// k-means iteration</span></div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code hl_variable" href="_angle_axis__mimic__euler_8cpp.html#ab3cd915d758008bd19d0f2428fbb354a">m</a>=0; <a class="code hl_variable" href="_angle_axis__mimic__euler_8cpp.html#ab3cd915d758008bd19d0f2428fbb354a">m</a>&lt;<a class="code hl_define" href="test__overwrite__node_8cpp.html#a52037c938e3c1b126c6277da5ca689d0">M</a>; <a class="code hl_variable" href="_angle_axis__mimic__euler_8cpp.html#ab3cd915d758008bd19d0f2428fbb354a">m</a>++) {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// clear the storage</span></div>
<div class="line">    std::fill_n(sx.begin(), K, 0.0f);</div>
<div class="line">    std::fill_n(sy.begin(), K, 0.0f);</div>
<div class="line">    std::fill_n(<a class="code hl_variable" href="bench_vec_add_8cpp.html#a41689956983587b085f9da3e48f31d99">c</a>.begin(), K, 0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// find the best k (cluster id) for each point</span></div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>; ++<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line">      <span class="keywordtype">float</span> <a class="code hl_variable" href="offscreen_8c.html#a5fd331c99e778f04762be6d8173eb4d2">x</a> = <a class="code hl_variable" href="level1__cplx__impl_8h.html#aa422b67a42f6a655b79abc04b8c0ad49">px</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line">      <span class="keywordtype">float</span> <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a5e247fc24ceb70d83f6ad59149b8910a">y</a> = <a class="code hl_variable" href="level1__cplx__impl_8h.html#abecb3a9c27c34b3023649d5e329c235b">py</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line">      <span class="keywordtype">float</span> best_d = std::numeric_limits&lt;float&gt;::max();</div>
<div class="line">      <span class="keywordtype">int</span> best_k = 0;</div>
<div class="line">      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; K; ++k) {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_variable" href="ittnotify__static_8h.html#a5f135fd1e66a03efd5275434478e0d97">d</a> = L2(<a class="code hl_variable" href="offscreen_8c.html#a5fd331c99e778f04762be6d8173eb4d2">x</a>, <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a5e247fc24ceb70d83f6ad59149b8910a">y</a>, mx[k], my[k]);</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_variable" href="ittnotify__static_8h.html#a5f135fd1e66a03efd5275434478e0d97">d</a> &lt; best_d) {</div>
<div class="line">          best_d = <a class="code hl_variable" href="ittnotify__static_8h.html#a5f135fd1e66a03efd5275434478e0d97">d</a>;</div>
<div class="line">          best_k = k;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">      sx[best_k] += <a class="code hl_variable" href="offscreen_8c.html#a5fd331c99e778f04762be6d8173eb4d2">x</a>;</div>
<div class="line">      sy[best_k] += <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a5e247fc24ceb70d83f6ad59149b8910a">y</a>;</div>
<div class="line">      <a class="code hl_variable" href="bench_vec_add_8cpp.html#a41689956983587b085f9da3e48f31d99">c</a> [best_k] += 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// update the centroid</span></div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt;K; k++) {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a78e23769680a273f948d4bd3e946fcae">count</a> = <a class="code hl_define" href="datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(1, <a class="code hl_variable" href="bench_vec_add_8cpp.html#a41689956983587b085f9da3e48f31d99">c</a>[k]);  <span class="comment">// turn 0/0 to 0/1</span></div>
<div class="line">      mx[k] = sx[k] / <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a78e23769680a273f948d4bd3e946fcae">count</a>;</div>
<div class="line">      my[k] = sy[k] / <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a78e23769680a273f948d4bd3e946fcae">count</a>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// print the k centroids found</span></div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt;K; ++k) {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;centroid &quot;</span> &lt;&lt; k &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; std::setw(10) &lt;&lt; mx[k] &lt;&lt; <span class="charliteral">&#39; &#39;</span></div>
<div class="line">                                          &lt;&lt; std::setw(10) &lt;&lt; my[k] &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="a_angle_axis__mimic__euler_8cpp_html_ab3cd915d758008bd19d0f2428fbb354a"><div class="ttname"><a href="_angle_axis__mimic__euler_8cpp.html#ab3cd915d758008bd19d0f2428fbb354a">m</a></div><div class="ttdeci">Matrix3f m</div><div class="ttdef"><b>定义</b> AngleAxis_mimic_euler.cpp:1</div></div>
<div class="ttc" id="a_bi_c_g_s_t_a_b__step__by__step_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>定义</b> BiCGSTAB_step_by_step.cpp:9</div></div>
<div class="ttc" id="abench_vec_add_8cpp_html_a41689956983587b085f9da3e48f31d99"><div class="ttname"><a href="bench_vec_add_8cpp.html#a41689956983587b085f9da3e48f31d99">c</a></div><div class="ttdeci">Scalar Scalar * c</div><div class="ttdef"><b>定义</b> benchVecAdd.cpp:17</div></div>
<div class="ttc" id="adatatypes_8h_html_affe776513b24d84b39af8ab0930fef7f"><div class="ttname"><a href="datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a></div><div class="ttdeci">#define max(a, b)</div><div class="ttdef"><b>定义</b> datatypes.h:20</div></div>
<div class="ttc" id="aimgui__impl__opengl3__loader_8h_html_a5e247fc24ceb70d83f6ad59149b8910a"><div class="ttname"><a href="imgui__impl__opengl3__loader_8h.html#a5e247fc24ceb70d83f6ad59149b8910a">y</a></div><div class="ttdeci">GLint y</div><div class="ttdef"><b>定义</b> imgui_impl_opengl3_loader.h:188</div></div>
<div class="ttc" id="aimgui__impl__opengl3__loader_8h_html_a78e23769680a273f948d4bd3e946fcae"><div class="ttname"><a href="imgui__impl__opengl3__loader_8h.html#a78e23769680a273f948d4bd3e946fcae">count</a></div><div class="ttdeci">GLsizei count</div><div class="ttdef"><b>定义</b> imgui_impl_opengl3_loader.h:226</div></div>
<div class="ttc" id="aittnotify__static_8h_html_a5f135fd1e66a03efd5275434478e0d97"><div class="ttname"><a href="ittnotify__static_8h.html#a5f135fd1e66a03efd5275434478e0d97">d</a></div><div class="ttdeci">void const char const char int ITT_FORMAT __itt_group_sync x void const char ITT_FORMAT __itt_group_sync s void ITT_FORMAT __itt_group_sync p void ITT_FORMAT p void ITT_FORMAT p no args __itt_suppress_mode_t unsigned int void size_t ITT_FORMAT d</div><div class="ttdef"><b>定义</b> ittnotify_static.h:109</div></div>
<div class="ttc" id="alevel1__cplx__impl_8h_html_aa422b67a42f6a655b79abc04b8c0ad49"><div class="ttname"><a href="level1__cplx__impl_8h.html#aa422b67a42f6a655b79abc04b8c0ad49">px</a></div><div class="ttdeci">RealScalar RealScalar * px</div><div class="ttdef"><b>定义</b> level1_cplx_impl.h:28</div></div>
<div class="ttc" id="alevel1__cplx__impl_8h_html_abecb3a9c27c34b3023649d5e329c235b"><div class="ttname"><a href="level1__cplx__impl_8h.html#abecb3a9c27c34b3023649d5e329c235b">py</a></div><div class="ttdeci">int RealScalar int RealScalar * py</div><div class="ttdef"><b>定义</b> level1_cplx_impl.h:97</div></div>
<div class="ttc" id="amain-override-static_8c_html_a0240ac851181b84ac374872dc5434ee4"><div class="ttname"><a href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a></div><div class="ttdeci">#define N</div><div class="ttdef"><b>定义</b> main-override-static.c:141</div></div>
<div class="ttc" id="aoffscreen_8c_html_a5fd331c99e778f04762be6d8173eb4d2"><div class="ttname"><a href="offscreen_8c.html#a5fd331c99e778f04762be6d8173eb4d2">x</a></div><div class="ttdeci">float x</div><div class="ttdef"><b>定义</b> offscreen.c:41</div></div>
<div class="ttc" id="atest__overwrite__node_8cpp_html_a52037c938e3c1b126c6277da5ca689d0"><div class="ttname"><a href="test__overwrite__node_8cpp.html#a52037c938e3c1b126c6277da5ca689d0">M</a></div><div class="ttdeci">#define M</div><div class="ttdef"><b>定义</b> test_overwrite_node.cpp:30</div></div>
</div><!-- fragment --><h1><a class="anchor" id="ParallelKMeansUsingCPUs"></a>
Parallel k-means using CPUs</h1>
<p>The second step of k-means algorithm, <em>assigning every point to the nearest centroid</em>, is highly parallelizable across individual points. We can create a <em>parallel-for</em> task to run parallel iterations.</p>
<div class="fragment"><div class="line">std::vector&lt;int&gt; best_ks(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);  <span class="comment">// nearest centroid of each point</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">unsigned</span> <a class="code hl_namespace" href="namespace_p.html">P</a> = 12;  <span class="comment">// 12 partitioned tasks</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// update cluster</span></div>
<div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.for_each_index(0, <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, 1, [&amp;](<span class="keywordtype">int</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>){</div>
<div class="line">  <span class="keywordtype">float</span> <a class="code hl_variable" href="offscreen_8c.html#a5fd331c99e778f04762be6d8173eb4d2">x</a> = <a class="code hl_variable" href="level1__cplx__impl_8h.html#aa422b67a42f6a655b79abc04b8c0ad49">px</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line">  <span class="keywordtype">float</span> <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a5e247fc24ceb70d83f6ad59149b8910a">y</a> = <a class="code hl_variable" href="level1__cplx__impl_8h.html#abecb3a9c27c34b3023649d5e329c235b">py</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line">  <span class="keywordtype">float</span> best_d = std::numeric_limits&lt;float&gt;::max();</div>
<div class="line">  <span class="keywordtype">int</span> best_k = 0;</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; K; ++k) {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_variable" href="ittnotify__static_8h.html#a5f135fd1e66a03efd5275434478e0d97">d</a> = L2(<a class="code hl_variable" href="offscreen_8c.html#a5fd331c99e778f04762be6d8173eb4d2">x</a>, <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a5e247fc24ceb70d83f6ad59149b8910a">y</a>, mx[k], my[k]);</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="ittnotify__static_8h.html#a5f135fd1e66a03efd5275434478e0d97">d</a> &lt; best_d) {</div>
<div class="line">      best_d = <a class="code hl_variable" href="ittnotify__static_8h.html#a5f135fd1e66a03efd5275434478e0d97">d</a>;</div>
<div class="line">      best_k = k;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  best_ks[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = best_k;</div>
<div class="line">});</div>
<div class="ttc" id="anamespace_p_html"><div class="ttname"><a href="namespace_p.html">P</a></div><div class="ttdef"><b>定义</b> one_bit_adder.h:20</div></div>
<div class="ttc" id="apoisson_8hpp_html_aa56fe360bb0ae38e0082f49e394ff825"><div class="ttname"><a href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a></div><div class="ttdeci">void taskflow(int nx, int ny, double dx, double dy, double *f, int itold, int itnew, double *u, double *unew, int block_size, unsigned num_threads)</div><div class="ttdef"><b>定义</b> taskflow.cpp:6</div></div>
</div><!-- fragment --><p>The third step of moving every centroid to the average of points is also parallelizable across individual centroids. However, since k is typically not large, one task of doing this update is sufficient.</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;](){</div>
<div class="line">  <span class="comment">// sum of points</span></div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line">    sx[best_ks[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]] += <a class="code hl_variable" href="level1__cplx__impl_8h.html#aa422b67a42f6a655b79abc04b8c0ad49">px</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line">    sy[best_ks[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]] += <a class="code hl_variable" href="level1__cplx__impl_8h.html#abecb3a9c27c34b3023649d5e329c235b">py</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line">    <a class="code hl_variable" href="bench_vec_add_8cpp.html#a41689956983587b085f9da3e48f31d99">c</a> [best_ks[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]] += 1;</div>
<div class="line">  }</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// average of points</span></div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt;K; ++k) {</div>
<div class="line">    <span class="keyword">auto</span> <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a78e23769680a273f948d4bd3e946fcae">count</a> = <a class="code hl_define" href="datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(1, <a class="code hl_variable" href="bench_vec_add_8cpp.html#a41689956983587b085f9da3e48f31d99">c</a>[k]);  <span class="comment">// turn 0/0 to 0/1</span></div>
<div class="line">    mx[k] = sx[k] / <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a78e23769680a273f948d4bd3e946fcae">count</a>;</div>
<div class="line">    my[k] = sy[k] / <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a78e23769680a273f948d4bd3e946fcae">count</a>;</div>
<div class="line">  }</div>
<div class="line">});</div>
</div><!-- fragment --><p>To describe <code>M</code> iterations, we create a condition task that loops the second step of the algorithm by <code>M</code> times. The return value of zero goes to the first successor which we will connect to the task of the second step later; otherwise, k-means completes.</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([<a class="code hl_variable" href="_angle_axis__mimic__euler_8cpp.html#ab3cd915d758008bd19d0f2428fbb354a">m</a>=0, <a class="code hl_define" href="test__overwrite__node_8cpp.html#a52037c938e3c1b126c6277da5ca689d0">M</a>]() <span class="keyword">mutable</span> {</div>
<div class="line">  <span class="keywordflow">return</span> (<a class="code hl_variable" href="_angle_axis__mimic__euler_8cpp.html#ab3cd915d758008bd19d0f2428fbb354a">m</a>++ &lt; <a class="code hl_define" href="test__overwrite__node_8cpp.html#a52037c938e3c1b126c6277da5ca689d0">M</a>) ? 0 : 1;</div>
<div class="line">});</div>
</div><!-- fragment --><p>The entire code of CPU-parallel k-means is shown below. Here we use an additional storage, <code>best_ks</code>, to record the nearest centroid of a point at an iteration.</p>
<div class="fragment"><div class="line"><span class="comment">// N: number of points</span></div>
<div class="line"><span class="comment">// K: number of clusters</span></div>
<div class="line"><span class="comment">// M: number of iterations</span></div>
<div class="line"><span class="comment">// px/py: 2D point vector </span></div>
<div class="line"><span class="keywordtype">void</span> kmeans_par(</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, <span class="keywordtype">int</span> K, <span class="keywordtype">int</span> <a class="code hl_define" href="test__overwrite__node_8cpp.html#a52037c938e3c1b126c6277da5ca689d0">M</a>, cconst std::vector&lt;float&gt;&amp; <a class="code hl_variable" href="level1__cplx__impl_8h.html#aa422b67a42f6a655b79abc04b8c0ad49">px</a>, <span class="keyword">const</span> std::vector&lt;float&gt;&amp; <a class="code hl_variable" href="level1__cplx__impl_8h.html#abecb3a9c27c34b3023649d5e329c235b">py</a></div>
<div class="line">) {</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">unsigned</span> <a class="code hl_namespace" href="namespace_p.html">P</a> = 12;  <span class="comment">// 12 partitions of the parallel-for graph</span></div>
<div class="line"> </div>
<div class="line">  <a class="code hl_class" href="classtf_1_1_executor.html">tf::Executor</a> <a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>;</div>
<div class="line">  <a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>(<span class="stringliteral">&quot;K-Means&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  std::vector&lt;int&gt; <a class="code hl_variable" href="bench_vec_add_8cpp.html#a41689956983587b085f9da3e48f31d99">c</a>(K), best_ks(<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);</div>
<div class="line">  std::vector&lt;float&gt; sx(K), sy(K), mx(K), my(K);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// initial centroids</span></div>
<div class="line">  <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_struct" href="structinit.html">init</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;](){</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;K; ++<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div>
<div class="line">      mx[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code hl_variable" href="level1__cplx__impl_8h.html#aa422b67a42f6a655b79abc04b8c0ad49">px</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line">      my[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code hl_variable" href="level1__cplx__impl_8h.html#abecb3a9c27c34b3023649d5e329c235b">py</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line">    }</div>
<div class="line">  }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;init&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// clear the storage</span></div>
<div class="line">  <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> clean_up = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;](){</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt;K; ++k) {</div>
<div class="line">      sx[k] = 0.0f;</div>
<div class="line">      sy[k] = 0.0f;</div>
<div class="line">      <a class="code hl_variable" href="bench_vec_add_8cpp.html#a41689956983587b085f9da3e48f31d99">c</a> [k] = 0;</div>
<div class="line">    }</div>
<div class="line">  }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;clean_up&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// update cluster</span></div>
<div class="line">  tf::Task pf = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.for_each_index(0, <a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, 1, [&amp;](<span class="keywordtype">int</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>){</div>
<div class="line">    <span class="keywordtype">float</span> <a class="code hl_variable" href="offscreen_8c.html#a5fd331c99e778f04762be6d8173eb4d2">x</a> = <a class="code hl_variable" href="level1__cplx__impl_8h.html#aa422b67a42f6a655b79abc04b8c0ad49">px</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line">    <span class="keywordtype">float</span> <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a5e247fc24ceb70d83f6ad59149b8910a">y</a> = <a class="code hl_variable" href="level1__cplx__impl_8h.html#abecb3a9c27c34b3023649d5e329c235b">py</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line">    <span class="keywordtype">float</span> best_d = std::numeric_limits&lt;float&gt;::max();</div>
<div class="line">    <span class="keywordtype">int</span> best_k = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; K; ++k) {</div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code hl_variable" href="ittnotify__static_8h.html#a5f135fd1e66a03efd5275434478e0d97">d</a> = L2(<a class="code hl_variable" href="offscreen_8c.html#a5fd331c99e778f04762be6d8173eb4d2">x</a>, <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a5e247fc24ceb70d83f6ad59149b8910a">y</a>, mx[k], my[k]);</div>
<div class="line">      <span class="keywordflow">if</span> (<a class="code hl_variable" href="ittnotify__static_8h.html#a5f135fd1e66a03efd5275434478e0d97">d</a> &lt; best_d) {</div>
<div class="line">        best_d = <a class="code hl_variable" href="ittnotify__static_8h.html#a5f135fd1e66a03efd5275434478e0d97">d</a>;</div>
<div class="line">        best_k = k;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    best_ks[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = best_k;</div>
<div class="line">  }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;parallel-for&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  tf::Task update_cluster = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;](){</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;<a class="code hl_define" href="main-override-static_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line">      sx[best_ks[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]] += <a class="code hl_variable" href="level1__cplx__impl_8h.html#aa422b67a42f6a655b79abc04b8c0ad49">px</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line">      sy[best_ks[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]] += <a class="code hl_variable" href="level1__cplx__impl_8h.html#abecb3a9c27c34b3023649d5e329c235b">py</a>[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line">      <a class="code hl_variable" href="bench_vec_add_8cpp.html#a41689956983587b085f9da3e48f31d99">c</a> [best_ks[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]] += 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt;K; ++k) {</div>
<div class="line">      <span class="keyword">auto</span> <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a78e23769680a273f948d4bd3e946fcae">count</a> = <a class="code hl_define" href="datatypes_8h.html#affe776513b24d84b39af8ab0930fef7f">max</a>(1, <a class="code hl_variable" href="bench_vec_add_8cpp.html#a41689956983587b085f9da3e48f31d99">c</a>[k]);  <span class="comment">// turn 0/0 to 0/1</span></div>
<div class="line">      mx[k] = sx[k] / <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a78e23769680a273f948d4bd3e946fcae">count</a>;</div>
<div class="line">      my[k] = sy[k] / <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a78e23769680a273f948d4bd3e946fcae">count</a>;</div>
<div class="line">    }</div>
<div class="line">  }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;update_cluster&quot;</span>);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// convergence check</span></div>
<div class="line">  tf::Task condition = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([<a class="code hl_variable" href="_angle_axis__mimic__euler_8cpp.html#ab3cd915d758008bd19d0f2428fbb354a">m</a>=0, <a class="code hl_define" href="test__overwrite__node_8cpp.html#a52037c938e3c1b126c6277da5ca689d0">M</a>]() <span class="keyword">mutable</span> {</div>
<div class="line">    <span class="keywordflow">return</span> (<a class="code hl_variable" href="_angle_axis__mimic__euler_8cpp.html#ab3cd915d758008bd19d0f2428fbb354a">m</a>++ &lt; <a class="code hl_define" href="test__overwrite__node_8cpp.html#a52037c938e3c1b126c6277da5ca689d0">M</a>) ? 0 : 1;</div>
<div class="line">  }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;converged?&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_function" href="boing_8c.html#a2858154e2009b0e6e616f313177762bc">init</a>.precede(clean_up);</div>
<div class="line"> </div>
<div class="line">  clean_up.<a class="code hl_function" href="classtf_1_1_task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(pf);</div>
<div class="line">  pf.<a class="code hl_function" href="classtf_1_1_task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(update_cluster);</div>
<div class="line"> </div>
<div class="line">  condition.<a class="code hl_function" href="classtf_1_1_task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(clean_up)</div>
<div class="line">           .<a class="code hl_function" href="classtf_1_1_task.html#a331b1b726555072e7c7d10941257f664">succeed</a>(update_cluster);</div>
<div class="line"> </div>
<div class="line">  <a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.<a class="code hl_function" href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">run</a>(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).wait();</div>
<div class="line">}</div>
<div class="ttc" id="aboing_8c_html_a2858154e2009b0e6e616f313177762bc"><div class="ttname"><a href="boing_8c.html#a2858154e2009b0e6e616f313177762bc">init</a></div><div class="ttdeci">void init(void)</div><div class="ttdef"><b>定义</b> boing.c:182</div></div>
<div class="ttc" id="aclasstf_1_1_executor_html"><div class="ttname"><a href="classtf_1_1_executor.html">tf::Executor</a></div><div class="ttdoc">class to create an executor for running a taskflow graph</div><div class="ttdef"><b>定义</b> executor-dl.hpp:51</div></div>
<div class="ttc" id="aclasstf_1_1_executor_html_a519777f5783981d534e9e53b99712069"><div class="ttname"><a href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">tf::Executor::run</a></div><div class="ttdeci">tf::Future&lt; void &gt; run(Taskflow &amp;taskflow)</div><div class="ttdoc">runs a taskflow once</div><div class="ttdef"><b>定义</b> executor-dl.hpp:2067</div></div>
<div class="ttc" id="aclasstf_1_1_task_html"><div class="ttname"><a href="classtf_1_1_task.html">tf::Task</a></div><div class="ttdoc">class to create a task handle over a node in a taskflow graph</div><div class="ttdef"><b>定义</b> task.hpp:150</div></div>
<div class="ttc" id="aclasstf_1_1_task_html_a331b1b726555072e7c7d10941257f664"><div class="ttname"><a href="classtf_1_1_task.html#a331b1b726555072e7c7d10941257f664">tf::Task::succeed</a></div><div class="ttdeci">Task &amp; succeed(Ts &amp;&amp;... tasks)</div><div class="ttdoc">adds precedence links from other tasks to this</div><div class="ttdef"><b>定义</b> task.hpp:402</div></div>
<div class="ttc" id="aclasstf_1_1_task_html_a8c78c453295a553c1c016e4062da8588"><div class="ttname"><a href="classtf_1_1_task.html#a8c78c453295a553c1c016e4062da8588">tf::Task::precede</a></div><div class="ttdeci">Task &amp; precede(Ts &amp;&amp;... tasks)</div><div class="ttdoc">adds precedence links from this to other tasks</div><div class="ttdef"><b>定义</b> task.hpp:394</div></div>
<div class="ttc" id="aclasstf_1_1_taskflow_html"><div class="ttname"><a href="classtf_1_1_taskflow.html">tf::Taskflow</a></div><div class="ttdoc">class to create a taskflow object</div><div class="ttdef"><b>定义</b> taskflow.hpp:67</div></div>
<div class="ttc" id="aimgui__impl__opengl3__loader_8h_html_aab18cfce5ee7c6881ae04f18be70d94a"><div class="ttname"><a href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a></div><div class="ttdeci">const GLchar * name</div><div class="ttdef"><b>定义</b> imgui_impl_opengl3_loader.h:312</div></div>
<div class="ttc" id="astructinit_html"><div class="ttname"><a href="structinit.html">init</a></div><div class="ttdef"><b>定义</b> TutorialInplaceLU.cpp:2</div></div>
<div class="ttc" id="athread__pool_8cpp_html_a543e564a8407bbeac15cb2d929fec755"><div class="ttname"><a href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a></div><div class="ttdeci">tf::Executor executor</div><div class="ttdef"><b>定义</b> thread_pool.cpp:6</div></div>
</div><!-- fragment --><p>The taskflow consists of two parts, a <code>clean_up</code> task and a parallel-for graph. The former cleans up the storage <code>sx</code>, <code>sy</code>, and <code>c</code> that are used to average points for new centroids, and the later parallelizes the searching for nearest centroids across individual points using 12 tasks (may vary depending on the machine). If the iteration count is smaller than <code>M</code>, the condition task returns 0 to let the execution path go back to <code>clean_up</code>. Otherwise, it returns 1 to stop (i.e., no successor tasks at index 1). The taskflow graph is illustrated below:</p>
<p>The scheduler starts with <code>init</code>, moves on to <code>clean_up</code>, and then enters the parallel-for task <code>parallel-for</code> that spawns a subflow of 12 workers to perform parallel iterations. When <code>parallel-for</code> completes, it updates the cluster centroids and checks if they have converged through a condition task. If not, the condition task informs the scheduler to go back to <code>clean_up</code> and then <code>parallel-for</code>; otherwise, it returns a nominal index to stop the scheduler.</p>
<h1><a class="anchor" id="KMeansBenchmarking"></a>
Benchmarking</h1>
<p>Based on the discussion above, we compare the runtime of computing various k-means problem sizes between a sequential CPU and parallel CPUs on a machine of 12 Intel i7-8700 CPUs at 3.2 GHz.</p>
<div align="center"> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">N   </th><th class="markdownTableHeadCenter">K   </th><th class="markdownTableHeadCenter">M   </th><th class="markdownTableHeadCenter">CPU Sequential   </th><th class="markdownTableHeadCenter">CPU Parallel    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">10   </td><td class="markdownTableBodyCenter">5   </td><td class="markdownTableBodyCenter">10   </td><td class="markdownTableBodyCenter">0.14 ms   </td><td class="markdownTableBodyCenter">77 ms    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">100   </td><td class="markdownTableBodyCenter">10   </td><td class="markdownTableBodyCenter">100   </td><td class="markdownTableBodyCenter">0.56 ms   </td><td class="markdownTableBodyCenter">86 ms    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">1000   </td><td class="markdownTableBodyCenter">10   </td><td class="markdownTableBodyCenter">1000   </td><td class="markdownTableBodyCenter">10 ms   </td><td class="markdownTableBodyCenter">98 ms    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">10000   </td><td class="markdownTableBodyCenter">10   </td><td class="markdownTableBodyCenter">10000   </td><td class="markdownTableBodyCenter">1006 ms   </td><td class="markdownTableBodyCenter">713 ms    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">100000   </td><td class="markdownTableBodyCenter">10   </td><td class="markdownTableBodyCenter">100000   </td><td class="markdownTableBodyCenter">102483 ms   </td><td class="markdownTableBodyCenter">49966 ms   </td></tr>
</table>
</div><p>When the number of points is larger than 10K, the parallel CPU implementation starts to outperform the sequential CPU implementation. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
