<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>source: Partitioning Algorithm</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">source
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="搜索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_partitioning_algorithm.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Partitioning Algorithm</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>目录</h3>
<ul>
  <li class="level1">
    <a href="#DefineAPartitionerForParallelAlgorithms">Define a Partitioner for Parallel Algorithms</a>
  </li>
  <li class="level1">
    <a href="#DefineAStaticPartitioner">Define a Static Partitioner</a>
  </li>
  <li class="level1">
    <a href="#DefineADynamicPartitioner">Define a Dynamic Partitioner</a>
  </li>
  <li class="level1">
    <a href="#DefineAGuidedPartitioner">Define a Guided Partitioner</a>
  </li>
  <li class="level1">
    <a href="#DefineAClosureWrapperForAPartitioner">Define a Closure Wrapper for a Partitioner</a>
  </li>
</ul>
</div>
<div class="textblock"><p><a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> partitioning algorithm allows applications to optimize parallel algorithms using different scheduling methods, such as static partitioning, dynamic partitioning, and guided partitioning.</p>
<h1><a class="anchor" id="DefineAPartitionerForParallelAlgorithms"></a>
Define a Partitioner for Parallel Algorithms</h1>
<p><a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> partitioner defines how to partition and distribute iterations to different workers when running parallel algorithms in Taskflow, such as <a class="el" href="classtf_1_1_flow_builder.html#aae3edfa278baa75b08414e083c14c836" title="constructs an STL-styled parallel-for task">tf::Taskflow::for_each</a> and <a class="el" href="classtf_1_1_flow_builder.html#a97be7ceef6fa4276e3b074c10c13b826" title="constructs a parallel-transform task">tf::Taskflow::transform</a>. The following example shows how to create parallel-iteration tasks with different execution policies:</p>
<div class="fragment"><div class="line">std::vector&lt;int&gt; <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a> = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// create different partitioners</span></div>
<div class="line"><a class="code hl_class" href="classtf_1_1_guided_partitioner.html">tf::GuidedPartitioner</a> guided_partitioner;</div>
<div class="line"><a class="code hl_class" href="classtf_1_1_static_partitioner.html">tf::StaticPartitioner</a> static_partitioner;</div>
<div class="line"><a class="code hl_class" href="classtf_1_1_random_partitioner.html">tf::RandomPartitioner</a> random_partitioner;</div>
<div class="line"><a class="code hl_class" href="classtf_1_1_dynamic_partitioner.html">tf::DynamicPartitioner</a> dynamic_partitioner;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// create four parallel-iteration tasks from the four execution policies</span></div>
<div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.for_each(<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>.begin(), <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>.end(), [](<span class="keywordtype">int</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>){}, guided_partitioner);</div>
<div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.for_each(<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>.begin(), <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>.end(), [](<span class="keywordtype">int</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>){}, static_partitioner);</div>
<div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.for_each(<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>.begin(), <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>.end(), [](<span class="keywordtype">int</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>){}, random_partitioner);</div>
<div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.for_each(<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>.begin(), <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a>.end(), [](<span class="keywordtype">int</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>){}, dynamic_partitioner);</div>
<div class="ttc" id="a_bi_c_g_s_t_a_b__step__by__step_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>定义</b> BiCGSTAB_step_by_step.cpp:9</div></div>
<div class="ttc" id="aclasstf_1_1_dynamic_partitioner_html"><div class="ttname"><a href="classtf_1_1_dynamic_partitioner.html">tf::DynamicPartitioner</a></div><div class="ttdoc">class to construct a dynamic partitioner for scheduling parallel algorithms</div><div class="ttdef"><b>定义</b> partitioner.hpp:436</div></div>
<div class="ttc" id="aclasstf_1_1_guided_partitioner_html"><div class="ttname"><a href="classtf_1_1_guided_partitioner.html">tf::GuidedPartitioner</a></div><div class="ttdoc">class to construct a guided partitioner for scheduling parallel algorithms</div><div class="ttdef"><b>定义</b> partitioner.hpp:259</div></div>
<div class="ttc" id="aclasstf_1_1_random_partitioner_html"><div class="ttname"><a href="classtf_1_1_random_partitioner.html">tf::RandomPartitioner</a></div><div class="ttdoc">class to construct a random partitioner for scheduling parallel algorithms</div><div class="ttdef"><b>定义</b> partitioner.hpp:682</div></div>
<div class="ttc" id="aclasstf_1_1_static_partitioner_html"><div class="ttname"><a href="classtf_1_1_static_partitioner.html">tf::StaticPartitioner</a></div><div class="ttdoc">class to construct a static partitioner for scheduling parallel algorithms</div><div class="ttdef"><b>定义</b> partitioner.hpp:560</div></div>
<div class="ttc" id="aimgui__impl__opengl3__loader_8h_html_a02796e583e939f923a255e43d2c3b177"><div class="ttname"><a href="imgui__impl__opengl3__loader_8h.html#a02796e583e939f923a255e43d2c3b177">data</a></div><div class="ttdeci">GLint * data</div><div class="ttdef"><b>定义</b> imgui_impl_opengl3_loader.h:199</div></div>
<div class="ttc" id="apoisson_8hpp_html_aa56fe360bb0ae38e0082f49e394ff825"><div class="ttname"><a href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a></div><div class="ttdeci">void taskflow(int nx, int ny, double dx, double dy, double *f, int itold, int itnew, double *u, double *unew, int block_size, unsigned num_threads)</div><div class="ttdef"><b>定义</b> taskflow.cpp:6</div></div>
</div><!-- fragment --><p>Each partitioner has a specific algorithm to partition iterations into a set of <em>chunks</em> and distribute chunks to workers. <a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> chunk is the basic unit of work that will be run by a worker during the execution of parallel iterations. The following figure illustrates the scheduling diagram for three major partitioners, <a class="el" href="classtf_1_1_static_partitioner.html" title="class to construct a static partitioner for scheduling parallel algorithms">tf::StaticPartitioner</a>, <a class="el" href="classtf_1_1_dynamic_partitioner.html" title="class to construct a dynamic partitioner for scheduling parallel algorithms">tf::DynamicPartitioner</a>, and <a class="el" href="classtf_1_1_guided_partitioner.html" title="class to construct a guided partitioner for scheduling parallel algorithms">tf::GuidedPartitioner</a>:</p>
<div class="image">
<img src="images/parallel_for_partition_algorithms.png" alt=""/>
</div>
<p>Depending on applications, partitioning algorithms can impact the performance a lot. For example, if a parallel-iteration workload contains a regular work unit per iteration, <a class="el" href="classtf_1_1_static_partitioner.html" title="class to construct a static partitioner for scheduling parallel algorithms">tf::StaticPartitioner</a> may deliver the best performance. On the other hand, if the work unit per iteration is irregular and unbalanced, <a class="el" href="classtf_1_1_guided_partitioner.html" title="class to construct a guided partitioner for scheduling parallel algorithms">tf::GuidedPartitioner</a> or <a class="el" href="classtf_1_1_dynamic_partitioner.html" title="class to construct a dynamic partitioner for scheduling parallel algorithms">tf::DynamicPartitioner</a> can outperform <a class="el" href="classtf_1_1_static_partitioner.html" title="class to construct a static partitioner for scheduling parallel algorithms">tf::StaticPartitioner</a>.</p>
<dl class="section attention"><dt>注意</dt><dd>By default, all parallel algorithms in Taskflow use <a class="el" href="namespacetf.html#ace2c5adcd5039483eebb6dbdbb6f33e3" title="default partitioner set to tf::GuidedPartitioner">tf::DefaultPartitioner</a>, which is based on guided scheduling via <a class="el" href="classtf_1_1_guided_partitioner.html" title="class to construct a guided partitioner for scheduling parallel algorithms">tf::GuidedPartitioner</a>.</dd></dl>
<h1><a class="anchor" id="DefineAStaticPartitioner"></a>
Define a Static Partitioner</h1>
<p><a class="el" href="class_static.html">Static</a> partitioner splits iterations into <code>iter_size/chunk_size</code> chunks and distribute chunks to workers in order. If no chunk size is given (<code>chunk_size</code> is 0), Taskflow will partition iterations into chunks that are approximately equal in size. The following code creates a static partitioner with chunk size equal to 100:</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1_static_partitioner.html">tf::StaticPartitioner</a> static_partitioner(100);</div>
</div><!-- fragment --><h1><a class="anchor" id="DefineADynamicPartitioner"></a>
Define a Dynamic Partitioner</h1>
<p>Dynamic partitioner splits iterations into <code>iter_size/chunk_size</code> chunks and distribute chunks to workers without any specific order. If no chunk size is given (<code>chunk_size</code> is 0), Taskflow will use 1 for the minimum size of a partition. The following code creates a dynamic partitioner with chunk size equal to 2:</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1_dynamic_partitioner.html">tf::DynamicPartitioner</a> dynamic_partitioner(2);</div>
</div><!-- fragment --><h1><a class="anchor" id="DefineAGuidedPartitioner"></a>
Define a Guided Partitioner</h1>
<p>Guided partitioner dynamically decides the chunk size. The size of a chunk is proportional to the number of unassigned iterations divided by the number of the threads, and the size will gradually decrease to the specified chunk size (default 1). The last chunk may be smaller than the specified chunk size. If no chunk size is given (<code>chunk_size</code> is 0), Taskflow will use 1 for the minimum size of a partition. The following code creates a guided partitioner with chunk size equal to 10:</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1_guided_partitioner.html">tf::GuidedPartitioner</a> guided_partitioner(10);</div>
</div><!-- fragment --><p>In most situations, guided partitioner can achieve decent performance due to adaptive parallelism, especially for those with irregular and unbalanced workload per iteration. As a result, guided partitioner is used as the default partitioner for our parallel algorithms.</p>
<h1><a class="anchor" id="DefineAClosureWrapperForAPartitioner"></a>
Define a Closure Wrapper for a Partitioner</h1>
<p>In addition to partition size, applications can specify a <em>closure wrapper</em> for a partitioner. <a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> closure wrapper allows the application to wrapper a partitioned task, i.e., closure, with a custom function object that performs additional tasks. For example:</p>
<div class="fragment"><div class="line">std::atomic&lt;int&gt; <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a78e23769680a273f948d4bd3e946fcae">count</a> = 0;</div>
<div class="line"><a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.for_each_index(0, 100, 1, </div>
<div class="line">  [](){                 </div>
<div class="line">    <a class="code hl_function" href="printf_8h.html#aee3ed3a831f25f07e7be3919fff2203a">printf</a>(<span class="stringliteral">&quot;%d\n&quot;</span>, <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>); </div>
<div class="line">  },</div>
<div class="line">  <a class="code hl_class" href="classtf_1_1_static_partitioner.html">tf::StaticPartitioner</a>(0, [](<span class="keyword">auto</span>&amp;&amp; closure){</div>
<div class="line">    <span class="comment">// do something before invoking the partitioned task</span></div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// invoke the partitioned task</span></div>
<div class="line">    closure();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// do something else after invoking the partitioned task</span></div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">  }</div>
<div class="line">);</div>
<div class="line"><a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.run(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).wait();</div>
<div class="ttc" id="aclasstf_1_1_taskflow_html"><div class="ttname"><a href="classtf_1_1_taskflow.html">tf::Taskflow</a></div><div class="ttdoc">class to create a taskflow object</div><div class="ttdef"><b>定义</b> taskflow.hpp:67</div></div>
<div class="ttc" id="aimgui__impl__opengl3__loader_8h_html_a78e23769680a273f948d4bd3e946fcae"><div class="ttname"><a href="imgui__impl__opengl3__loader_8h.html#a78e23769680a273f948d4bd3e946fcae">count</a></div><div class="ttdeci">GLsizei count</div><div class="ttdef"><b>定义</b> imgui_impl_opengl3_loader.h:226</div></div>
<div class="ttc" id="aprintf_8h_html_aee3ed3a831f25f07e7be3919fff2203a"><div class="ttname"><a href="printf_8h.html#aee3ed3a831f25f07e7be3919fff2203a">printf</a></div><div class="ttdeci">auto printf(string_view fmt, const T &amp;... args) -&gt; int</div><div class="ttdef"><b>定义</b> printf.h:621</div></div>
<div class="ttc" id="athread__pool_8cpp_html_a543e564a8407bbeac15cb2d929fec755"><div class="ttname"><a href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a></div><div class="ttdeci">tf::Executor executor</div><div class="ttdef"><b>定义</b> thread_pool.cpp:6</div></div>
</div><!-- fragment --><p>Each partitioner uses a default closure wrapper (<a class="el" href="structtf_1_1_default_closure_wrapper.html" title="default closure wrapper that simply runs the given closure as is">tf::DefaultClosureWrapper</a>) that does nothing but simply invokes the given closure to perform the ordinary partitioned task.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>DefaultClosureWrapper {</div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> C&gt;</div>
<div class="line">  <span class="keywordtype">void</span> operator()(<a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>&amp;&amp; closure)<span class="keyword"> const </span>{ std::forward&lt;C&gt;(closure)(); }</div>
<div class="line">};</div>
<div class="ttc" id="atest__buffer__node_8cpp_html_ac4cf4b2ab929bd23951a8676eeac086b"><div class="ttname"><a href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a></div><div class="ttdeci">#define C</div><div class="ttdef"><b>定义</b> test_buffer_node.cpp:28</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
