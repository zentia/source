<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>source: Using the library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">source
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="搜索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('using.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Using the library</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h3><a class="anchor" id="autotoc_md21"></a>
Build</h3>
<p>The preferred usage is including <code>&lt;<a class="el" href="mimalloc_8h.html">mimalloc.h</a>&gt;</code>, linking with the shared- or static library, and using the <code>mi_malloc</code> API exclusively for allocation. For example, </p><div class="fragment"><div class="line">gcc -o myprogram -lmimalloc myfile.c</div>
</div><!-- fragment --><p>mimalloc uses only safe OS calls (<code>mmap</code> and <code>VirtualAlloc</code>) and can co-exist with other allocators linked to the same program. If you use <code>cmake</code>, you can simply use: </p><div class="fragment"><div class="line">find_package(mimalloc 2.1 REQUIRED)</div>
</div><!-- fragment --><p> in your <code>CMakeLists.txt</code> to find a locally installed mimalloc. Then use either: </p><div class="fragment"><div class="line">target_link_libraries(myapp PUBLIC mimalloc)</div>
</div><!-- fragment --><p> to link with the shared (dynamic) library, or: </p><div class="fragment"><div class="line">target_link_libraries(myapp PUBLIC mimalloc-<span class="keyword">static</span>)</div>
</div><!-- fragment --><p> to link with the static library. See <code>test\CMakeLists.txt</code> for an example.</p>
<h3><a class="anchor" id="autotoc_md22"></a>
C++</h3>
<p>For best performance in C++ programs, it is also recommended to override the global <code>new</code> and <code>delete</code> operators. For convenience, mimalloc provides <a href="https://github.com/microsoft/mimalloc/blob/master/include/mimalloc-new-delete.h"><code>mimalloc-new-delete.h</code></a> which does this for you &ndash; just include it in a single(!) source file in your project.</p>
<p>In C++, mimalloc also provides the <code><a class="el" href="structmi__stl__allocator.html">mi_stl_allocator</a></code> struct which implements the <code>std::allocator</code> interface. For example: </p><div class="fragment"><div class="line">std::vector&lt;some_struct, mi_stl_allocator&lt;some_struct&gt;&gt; vec;</div>
<div class="line">vec.push_back(<a class="code hl_struct" href="structsome__struct.html">some_struct</a>());</div>
<div class="ttc" id="astructsome__struct_html"><div class="ttname"><a href="structsome__struct.html">some_struct</a></div><div class="ttdef"><b>定义</b> main-override.cpp:145</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md23"></a>
Statistics</h3>
<p>You can pass environment variables to print verbose messages (<code>MIMALLOC_VERBOSE=1</code>) and statistics (<code>MIMALLOC_SHOW_STATS=1</code>) (in the debug version): </p><div class="fragment"><div class="line">&gt; env MIMALLOC_SHOW_STATS=1 ./cfrac 175451865205073170563711388363</div>
<div class="line"> </div>
<div class="line">175451865205073170563711388363 = 374456281610909315237213 * 468551</div>
<div class="line"> </div>
<div class="line">heap stats:     peak      total      freed       unit</div>
<div class="line">normal   2:    16.4 kb    17.5 mb    17.5 mb      16 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>   <a class="code hl_variable" href="testhelper_8h.html#a047ea0d874e6802b9b6d08f6b50248e5">ok</a></div>
<div class="line">normal   3:    16.3 kb    15.2 mb    15.2 mb      24 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>   <a class="code hl_variable" href="testhelper_8h.html#a047ea0d874e6802b9b6d08f6b50248e5">ok</a></div>
<div class="line">normal   4:      64 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>      4.6 kb     4.6 kb      32 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>   <a class="code hl_variable" href="testhelper_8h.html#a047ea0d874e6802b9b6d08f6b50248e5">ok</a></div>
<div class="line">normal   5:      80 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>    118.4 kb   118.4 kb      40 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>   <a class="code hl_variable" href="testhelper_8h.html#a047ea0d874e6802b9b6d08f6b50248e5">ok</a></div>
<div class="line">normal   6:      48 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>       48 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>       48 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>       48 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>   <a class="code hl_variable" href="testhelper_8h.html#a047ea0d874e6802b9b6d08f6b50248e5">ok</a></div>
<div class="line">normal  17:     960 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>      960 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>      960 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>      320 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>   <a class="code hl_variable" href="testhelper_8h.html#a047ea0d874e6802b9b6d08f6b50248e5">ok</a></div>
<div class="line"> </div>
<div class="line">heap stats:     peak      total      freed       unit</div>
<div class="line">    normal:    33.9 kb    32.8 mb    32.8 mb       1 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>   <a class="code hl_variable" href="testhelper_8h.html#a047ea0d874e6802b9b6d08f6b50248e5">ok</a></div>
<div class="line">      huge:       0 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>        0 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>        0 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>        1 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>   <a class="code hl_variable" href="testhelper_8h.html#a047ea0d874e6802b9b6d08f6b50248e5">ok</a></div>
<div class="line">     total:    33.9 kb    32.8 mb    32.8 mb       1 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>   <a class="code hl_variable" href="testhelper_8h.html#a047ea0d874e6802b9b6d08f6b50248e5">ok</a></div>
<div class="line"><a class="code hl_define" href="mimalloc-override_8h.html#a99aa8fd9f4831e1b0fa9e1cdcde3e249">malloc</a> requested:         32.8 mb</div>
<div class="line"> </div>
<div class="line"> committed:    58.2 kb    58.2 kb    58.2 kb       1 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>   <a class="code hl_variable" href="testhelper_8h.html#a047ea0d874e6802b9b6d08f6b50248e5">ok</a></div>
<div class="line">  reserved:     2.0 mb     2.0 mb     2.0 mb       1 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>   <a class="code hl_variable" href="testhelper_8h.html#a047ea0d874e6802b9b6d08f6b50248e5">ok</a></div>
<div class="line">     reset:       0 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>        0 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>        0 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>        1 <a class="code hl_variable" href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a>   <a class="code hl_variable" href="testhelper_8h.html#a047ea0d874e6802b9b6d08f6b50248e5">ok</a></div>
<div class="line">  segments:       1          1          1</div>
<div class="line">-abandoned:       0</div>
<div class="line">     pages:       6          6          6</div>
<div class="line">-abandoned:       0</div>
<div class="line">     mmaps:       3</div>
<div class="line"> mmap fast:       0</div>
<div class="line"> mmap slow:       1</div>
<div class="line">   threads:       0</div>
<div class="line">   elapsed:     2.022<a class="code hl_variable" href="main-override_8cpp.html#a1384e7608274313a9433fa573868557b">s</a></div>
<div class="line">   process: user: 1.781<a class="code hl_variable" href="main-override_8cpp.html#a1384e7608274313a9433fa573868557b">s</a>, system: 0.016<a class="code hl_variable" href="main-override_8cpp.html#a1384e7608274313a9433fa573868557b">s</a>, faults: 756, reclaims: 0, rss: 2.7 mb</div>
<div class="ttc" id="amain-override_8cpp_html_a1384e7608274313a9433fa573868557b"><div class="ttname"><a href="main-override_8cpp.html#a1384e7608274313a9433fa573868557b">s</a></div><div class="ttdeci">static Static s</div><div class="ttdef"><b>定义</b> main-override.cpp:135</div></div>
<div class="ttc" id="amimalloc-override_8h_html_a99aa8fd9f4831e1b0fa9e1cdcde3e249"><div class="ttname"><a href="mimalloc-override_8h.html#a99aa8fd9f4831e1b0fa9e1cdcde3e249">malloc</a></div><div class="ttdeci">#define malloc(n)</div><div class="ttdef"><b>定义</b> mimalloc-override.h:21</div></div>
<div class="ttc" id="aoffscreen_8c_html_a83fc1af92e29717b4513d121b0c72c7d"><div class="ttname"><a href="offscreen_8c.html#a83fc1af92e29717b4513d121b0c72c7d">b</a></div><div class="ttdeci">float b</div><div class="ttdef"><b>定义</b> offscreen.c:42</div></div>
<div class="ttc" id="atesthelper_8h_html_a047ea0d874e6802b9b6d08f6b50248e5"><div class="ttname"><a href="testhelper_8h.html#a047ea0d874e6802b9b6d08f6b50248e5">ok</a></div><div class="ttdeci">static int ok</div><div class="ttdef"><b>定义</b> testhelper.h:17</div></div>
</div><!-- fragment --><p>The above model of using the <code>mi_</code> prefixed API is not always possible though in existing programs that already use the standard malloc interface, and another option is to override the standard malloc interface completely and redirect all calls to the <em>mimalloc</em> library instead.</p>
<p>See <a class="el" href="overrides.html">Overriding Malloc</a> for more info. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
