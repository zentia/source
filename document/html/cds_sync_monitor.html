<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>source: Synchronization monitor</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">source
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="搜索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('cds_sync_monitor.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Synchronization monitor</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> <a href="http://en.wikipedia.org/wiki/Monitor_%28synchronization%29">monitor</a> is synchronization construction that allows threads to have both mutual exclusion and the ability to wait (block) for a certain condition to become true. Some blocking data structure algoritms like the trees require per-node locking. For huge trees containing millions of nodes it can be very inefficient to inject the lock object into each node. Moreover, some operating systems may not support the millions of system objects like mutexes per user process. The monitor strategy is intended to solve that problem. When the node should be locked, the monitor is called to allocate appropriate lock object for the node if needed, and to lock the node. The monitor strategy can significantly reduce the number of system objects required for data structure.</p>
<p><b>Implemetations</b></p>
<p><code class="param">libcds</code> contains several monitor implementations:</p><ul>
<li><code class="param"><a class="el" href="classcds_1_1sync_1_1injecting__monitor.html" title="Monitor that injects the lock into each node">sync::injecting_monitor</a></code> injects the lock object into each node. That mock monitor is designed for user-space locking primitive like <a class="el" href="classcds_1_1sync_1_1spin__lock.html">spin-lock</a>.</li>
<li><code class="param"><a class="el" href="classcds_1_1sync_1_1pool__monitor.html" title="Monitor that allocates node&#39;s lock when needed">sync::pool_monitor</a></code> is the monitor that allocates a lock object for a node from the pool when needed. When the node is unlocked the lock assigned to it is given back to the pool if no thread references to that node.</li>
</ul>
<p><b>How to use</b></p>
<p>If you use a container from <code class="param">libcds</code> that requires a monitor, you should just specify required monitor type in container's traits. Usually, the monitor is specified by <code class="param">traits::sync_monitor</code> typedef, or by <code class="param"><a class="el" href="structcds_1_1opt_1_1sync__monitor.html" title="[type-option] Monitor type setter">cds::opt::sync_monitor</a></code> option for container's <code class="param">make_traits</code> metafunction.</p>
<p>If you're developing a new container algorithm, you should know internal monitor interface: </p><div class="fragment"><div class="line"><span class="keyword">class </span>Monitor {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// Monitor&#39;s injection into the Node class</span></div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Node&gt;</div>
<div class="line">    <span class="keyword">struct </span>node_injection: <span class="keyword">public</span> <a class="code hl_struct" href="class_node.html">Node</a></div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Monitor data injecting into container&#39;s node</span></div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">    };</div>
<div class="line">    <span class="comment">// Locks the node</span></div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Node&gt;</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_variable" href="ittnotify__static_8h.html#a46e8be2e3aadb2f6ee62e762a36b9243">lock</a>( <a class="code hl_struct" href="class_node.html">Node</a>&amp; node );</div>
<div class="line">    <span class="comment">// Unlocks the node</span></div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Node&gt;</div>
<div class="line">    <span class="keywordtype">void</span> unlock( <a class="code hl_struct" href="class_node.html">Node</a>&amp; node );</div>
<div class="line">    <span class="comment">// Scoped lock applyes RAII to Monitor</span></div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Node&gt;</div>
<div class="line">    <span class="keyword">using </span>scoped_lock = monitor_scoped_lock&lt; pool_monitor, Node &gt;;</div>
<div class="line">};</div>
<div class="ttc" id="aclass_node_html"><div class="ttname"><a href="class_node.html">Node</a></div><div class="ttdef"><b>定义</b> levelgraph.hpp:22</div></div>
<div class="ttc" id="aittnotify__static_8h_html_a46e8be2e3aadb2f6ee62e762a36b9243"><div class="ttname"><a href="ittnotify__static_8h.html#a46e8be2e3aadb2f6ee62e762a36b9243">lock</a></div><div class="ttdeci">void const char const char int ITT_FORMAT __itt_group_sync x void const char ITT_FORMAT __itt_group_sync s void ITT_FORMAT __itt_group_sync p void ITT_FORMAT p void ITT_FORMAT p no args __itt_suppress_mode_t unsigned int void size_t ITT_FORMAT d void ITT_FORMAT p void ITT_FORMAT p __itt_model_site __itt_model_site_instance ITT_FORMAT p __itt_model_task __itt_model_task_instance ITT_FORMAT p void * lock</div><div class="ttdef"><b>定义</b> ittnotify_static.h:121</div></div>
</div><!-- fragment --><p> Monitor's data must be injected into container's node as <code class="param">m_SyncMonitorInjection</code> data member: </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> SyncMonitor&gt;</div>
<div class="line"><span class="keyword">struct </span>my_node</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">    <span class="keyword">typename</span> SyncMonitor::node_injection m_SyncMonitorInjection;</div>
<div class="line">};</div>
</div><!-- fragment --><p> The monitor must be a member of your container: </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> GC, <span class="keyword">typename</span> T, <span class="keyword">typename</span> Traits&gt;</div>
<div class="line"><span class="keyword">class </span>my_container {</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span> Traits::sync_monitor   sync_monitor;</div>
<div class="line">    <span class="keyword">typedef</span> my_node&lt;sync_monitor&gt; node_type;</div>
<div class="line">    sync_monitor m_Monitor;</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line">};</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
