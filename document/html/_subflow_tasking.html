<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>source: Subflow Tasking</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">source
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="搜索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_subflow_tasking.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Subflow Tasking</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>目录</h3>
<ul>
  <li class="level1">
    <a href="#CreateASubflow">Create a Subflow</a>
  </li>
  <li class="level1">
    <a href="#JoinASubflow">Join a Subflow</a>
  </li>
  <li class="level1">
    <a href="#DetachASubflow">Detach a Subflow</a>
  </li>
  <li class="level1">
    <a href="#CreateANestedSubflow">Create a Nested Subflow</a>
  </li>
</ul>
</div>
<div class="textblock"><p>It is very common for a parallel program to spawn task dependency graphs at runtime. In Taskflow, we call this <em>subflow tasking</em>.</p>
<h1><a class="anchor" id="CreateASubflow"></a>
Create a Subflow</h1>
<p>Subflow tasks are those created during the execution of a graph. These tasks are spawned from a parent task and are grouped together to a <em>subflow</em> dependency graph. To create a subflow, emplace a callable that takes an argument of type <a class="el" href="classtf_1_1_subflow.html" title="class to construct a subflow graph from the execution of a dynamic task">tf::Subflow</a>. <a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> <a class="el" href="classtf_1_1_subflow.html" title="class to construct a subflow graph from the execution of a dynamic task">tf::Subflow</a> object will be created and forwarded to the execution context of the task. All methods you find in <a class="el" href="classtf_1_1_taskflow.html" title="class to create a taskflow object">tf::Taskflow</a> are applicable for <a class="el" href="classtf_1_1_subflow.html" title="class to construct a subflow graph from the execution of a dynamic task">tf::Subflow</a>.</p>
<div class="fragment"><div class="line"> 1: <a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"> 2: <a class="code hl_class" href="classtf_1_1_executor.html">tf::Executor</a> <a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>;</div>
<div class="line"> 3:</div>
<div class="line"> 4: <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([] () {}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;A&quot;</span>);  <span class="comment">// static task A</span></div>
<div class="line"> 5: <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([] () {}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;C&quot;</span>);  <span class="comment">// static task C</span></div>
<div class="line"> 6: <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([] () {}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;D&quot;</span>);  <span class="comment">// static task D</span></div>
<div class="line"> 7:</div>
<div class="line"> 8: tf::Task <a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([] (tf::Subflow&amp; subflow) { </div>
<div class="line"> 9:   tf::Task <a class="code hl_variable" href="namespace_p.html#a104e30e1fb815af59069cc4567cb35ee">B1</a> = subflow.<a class="code hl_function" href="classtf_1_1_flow_builder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([] () {}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;B1&quot;</span>);  <span class="comment">// subflow task B1</span></div>
<div class="line">10:   tf::Task <a class="code hl_variable" href="namespace_p.html#a58c370cdedae1bcbf19bcdc9d7a8d583">B2</a> = subflow.<a class="code hl_function" href="classtf_1_1_flow_builder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([] () {}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;B2&quot;</span>);  <span class="comment">// subflow task B2</span></div>
<div class="line">11:   tf::Task <a class="code hl_variable" href="namespace_p.html#ab399e249b5a6d9c560c81efee6ab527a">B3</a> = subflow.<a class="code hl_function" href="classtf_1_1_flow_builder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([] () {}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;B3&quot;</span>);  <span class="comment">// subflow task B3</span></div>
<div class="line">12:   <a class="code hl_variable" href="namespace_p.html#a104e30e1fb815af59069cc4567cb35ee">B1</a>.precede(B3);  <span class="comment">// B1 runs before B3</span></div>
<div class="line">13:   <a class="code hl_variable" href="namespace_p.html#a58c370cdedae1bcbf19bcdc9d7a8d583">B2</a>.precede(B3);  <span class="comment">// B2 runs before B3</span></div>
<div class="line">14: }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;B&quot;</span>);</div>
<div class="line">15:</div>
<div class="line">16: <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>.precede(<a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>);  <span class="comment">// B runs after A</span></div>
<div class="line">17: <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>.precede(<a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>);  <span class="comment">// C runs after A</span></div>
<div class="line">18: <a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>.precede(<a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a>);  <span class="comment">// D runs after B</span></div>
<div class="line">19: <a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>.precede(<a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a>);  <span class="comment">// D runs after C</span></div>
<div class="line">20:</div>
<div class="line">21: <a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.<a class="code hl_function" href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">run</a>(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).get();  <span class="comment">// execute the graph to spawn the subflow</span></div>
<div class="line">22: <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.dump(std::cout);      <span class="comment">// dump the taskflow to a DOT format</span></div>
<div class="ttc" id="a_eigen_solver___eigen_solver___matrix_type_8cpp_html_a925331f9b6e4844293d36a8df2256d38"><div class="ttname"><a href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a></div><div class="ttdeci">MatrixXcd D</div><div class="ttdef"><b>定义</b> EigenSolver_EigenSolver_MatrixType.cpp:14</div></div>
<div class="ttc" id="abench__gemm_8cpp_html_a37a83060ac796961b44991c836f083f7"><div class="ttname"><a href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a></div><div class="ttdeci">Matrix&lt; SCALARB, Dynamic, Dynamic &gt; B</div><div class="ttdef"><b>定义</b> bench_gemm.cpp:36</div></div>
<div class="ttc" id="abench__gemm_8cpp_html_addc86e8508f14411ec98f521c520f875"><div class="ttname"><a href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a></div><div class="ttdeci">Matrix&lt; SCALARA, Dynamic, Dynamic &gt; A</div><div class="ttdef"><b>定义</b> bench_gemm.cpp:35</div></div>
<div class="ttc" id="aclasstf_1_1_executor_html"><div class="ttname"><a href="classtf_1_1_executor.html">tf::Executor</a></div><div class="ttdoc">class to create an executor for running a taskflow graph</div><div class="ttdef"><b>定义</b> executor-dl.hpp:51</div></div>
<div class="ttc" id="aclasstf_1_1_executor_html_a519777f5783981d534e9e53b99712069"><div class="ttname"><a href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">tf::Executor::run</a></div><div class="ttdeci">tf::Future&lt; void &gt; run(Taskflow &amp;taskflow)</div><div class="ttdoc">runs a taskflow once</div><div class="ttdef"><b>定义</b> executor-dl.hpp:2067</div></div>
<div class="ttc" id="aclasstf_1_1_flow_builder_html_a60d7a666cab71ecfa3010b2efb0d6b57"><div class="ttname"><a href="classtf_1_1_flow_builder.html#a60d7a666cab71ecfa3010b2efb0d6b57">tf::FlowBuilder::emplace</a></div><div class="ttdeci">Task emplace(C &amp;&amp;callable)</div><div class="ttdoc">creates a static task</div><div class="ttdef"><b>定义</b> flow_builder.hpp:1261</div></div>
<div class="ttc" id="aclasstf_1_1_task_html"><div class="ttname"><a href="classtf_1_1_task.html">tf::Task</a></div><div class="ttdoc">class to create a task handle over a node in a taskflow graph</div><div class="ttdef"><b>定义</b> task.hpp:150</div></div>
<div class="ttc" id="aclasstf_1_1_taskflow_html"><div class="ttname"><a href="classtf_1_1_taskflow.html">tf::Taskflow</a></div><div class="ttdoc">class to create a taskflow object</div><div class="ttdef"><b>定义</b> taskflow.hpp:67</div></div>
<div class="ttc" id="aimgui__impl__opengl3__loader_8h_html_aab18cfce5ee7c6881ae04f18be70d94a"><div class="ttname"><a href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a></div><div class="ttdeci">const GLchar * name</div><div class="ttdef"><b>定义</b> imgui_impl_opengl3_loader.h:312</div></div>
<div class="ttc" id="anamespace_p_html_a104e30e1fb815af59069cc4567cb35ee"><div class="ttname"><a href="namespace_p.html#a104e30e1fb815af59069cc4567cb35ee">P::B1</a></div><div class="ttdeci">const int B1</div><div class="ttdef"><b>定义</b> one_bit_adder.h:26</div></div>
<div class="ttc" id="anamespace_p_html_a58c370cdedae1bcbf19bcdc9d7a8d583"><div class="ttname"><a href="namespace_p.html#a58c370cdedae1bcbf19bcdc9d7a8d583">P::B2</a></div><div class="ttdeci">const int B2</div><div class="ttdef"><b>定义</b> one_bit_adder.h:28</div></div>
<div class="ttc" id="anamespace_p_html_ab399e249b5a6d9c560c81efee6ab527a"><div class="ttname"><a href="namespace_p.html#ab399e249b5a6d9c560c81efee6ab527a">P::B3</a></div><div class="ttdeci">const int B3</div><div class="ttdef"><b>定义</b> one_bit_adder.h:30</div></div>
<div class="ttc" id="apoisson_8hpp_html_aa56fe360bb0ae38e0082f49e394ff825"><div class="ttname"><a href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a></div><div class="ttdeci">void taskflow(int nx, int ny, double dx, double dy, double *f, int itold, int itnew, double *u, double *unew, int block_size, unsigned num_threads)</div><div class="ttdef"><b>定义</b> taskflow.cpp:6</div></div>
<div class="ttc" id="atest__buffer__node_8cpp_html_ac4cf4b2ab929bd23951a8676eeac086b"><div class="ttname"><a href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a></div><div class="ttdeci">#define C</div><div class="ttdef"><b>定义</b> test_buffer_node.cpp:28</div></div>
<div class="ttc" id="athread__pool_8cpp_html_a543e564a8407bbeac15cb2d929fec755"><div class="ttname"><a href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a></div><div class="ttdeci">tf::Executor executor</div><div class="ttdef"><b>定义</b> thread_pool.cpp:6</div></div>
</div><!-- fragment --><p>Debrief: </p><ul>
<li>Lines 1-2 create a taskflow and an executor </li>
<li>Lines 4-6 create three tasks, <a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>, C, and D </li>
<li>Lines 8-14 create a task <a class="el" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a> that spawns a task dependency graph of three tasks B1, B2, and B3 </li>
<li>Lines 16-19 add dependencies among <a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>, <a class="el" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>, C, and D </li>
<li>Line 21 submits the graph to an executor and waits until it finishes </li>
<li>Line 22 dumps the entire task dependency graph</li>
</ul>
<p>Lines 8-14 are the main block to enable subflow tasking at task <a class="el" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>. The runtime will create a <a class="el" href="classtf_1_1_subflow.html" title="class to construct a subflow graph from the execution of a dynamic task">tf::Subflow</a> passing it to task <a class="el" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>, and spawn a dependency graph as described by the associated callable. This new subflow graph will be added to the topology of its parent task <a class="el" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>. Due to the property of subflow tasking, we cannot dump its structure before execution. We will need to run the graph first to spawn the graph and then call <a class="el" href="classtf_1_1_taskflow.html#ac433018262e44b12c4cc9f0c4748d758" title="dumps the taskflow to a DOT format through a std::ostream target">tf::Taskflow::dump</a>.</p>
<h1><a class="anchor" id="JoinASubflow"></a>
Join a Subflow</h1>
<p>By default, a subflow joins its parent task when the program leaves its execution context. All nodes of zero outgoing edges in the subflow precede its parent task. You can explicitly join a subflow within its execution context to carry out recursive patterns. <a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> famous implementation is fibonacci recursion.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="test__scalable__pipelines_8cpp.html#a28d67ed972e7388aae4da7bffe20d7b2">spawn</a>(<span class="keywordtype">int</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>, <a class="code hl_class" href="classtf_1_1_subflow.html">tf::Subflow</a>&amp; sbf) {</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a> &lt; 2) <span class="keywordflow">return</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>;</div>
<div class="line">  <span class="keywordtype">int</span> res1, res2;</div>
<div class="line">  sbf.<a class="code hl_function" href="classtf_1_1_flow_builder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([&amp;res1, <a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>] (<a class="code hl_class" href="classtf_1_1_subflow.html">tf::Subflow</a>&amp; sbf) { res1 = <a class="code hl_function" href="test__scalable__pipelines_8cpp.html#a28d67ed972e7388aae4da7bffe20d7b2">spawn</a>(<a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a> - 1, sbf); } );</div>
<div class="line">  sbf.<a class="code hl_function" href="classtf_1_1_flow_builder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([&amp;res2, <a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>] (<a class="code hl_class" href="classtf_1_1_subflow.html">tf::Subflow</a>&amp; sbf) { res2 = <a class="code hl_function" href="test__scalable__pipelines_8cpp.html#a28d67ed972e7388aae4da7bffe20d7b2">spawn</a>(<a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a> - 2, sbf); } );</div>
<div class="line">  sbf.<a class="code hl_function" href="classtf_1_1_subflow.html#a59fcac1323e70d920088dd37bd0be245">join</a>();    <span class="comment">// join to materialize the subflow immediately</span></div>
<div class="line">  <span class="keywordflow">return</span> res1 + res2;</div>
<div class="line">}</div>
<div class="line">  </div>
<div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;<a class="code hl_variable" href="_partial_redux__count_8cpp.html#acbe60897559b79afc28b79b0687b5f29">res</a>] (tf::Subflow&amp; sbf) { </div>
<div class="line">  <a class="code hl_variable" href="_partial_redux__count_8cpp.html#acbe60897559b79afc28b79b0687b5f29">res</a> = <a class="code hl_function" href="test__scalable__pipelines_8cpp.html#a28d67ed972e7388aae4da7bffe20d7b2">spawn</a>(5, sbf);  </div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line"><a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.<a class="code hl_function" href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">run</a>(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).wait();</div>
<div class="ttc" id="a_bi_c_g_s_t_a_b__simple_8cpp_html_a5150192f625f4d7970d61169b9567f39"><div class="ttname"><a href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a></div><div class="ttdeci">int n</div><div class="ttdef"><b>定义</b> BiCGSTAB_simple.cpp:1</div></div>
<div class="ttc" id="a_partial_redux__count_8cpp_html_acbe60897559b79afc28b79b0687b5f29"><div class="ttname"><a href="_partial_redux__count_8cpp.html#acbe60897559b79afc28b79b0687b5f29">res</a></div><div class="ttdeci">cout&lt;&lt; &quot;Here is the matrix m:&quot;&lt;&lt; endl&lt;&lt; m&lt;&lt; endl;Matrix&lt; ptrdiff_t, 3, 1 &gt; res</div><div class="ttdef"><b>定义</b> PartialRedux_count.cpp:3</div></div>
<div class="ttc" id="aclasstf_1_1_subflow_html"><div class="ttname"><a href="classtf_1_1_subflow.html">tf::Subflow</a></div><div class="ttdoc">class to construct a subflow graph from the execution of a dynamic task</div><div class="ttdef"><b>定义</b> flow_builder.hpp:1409</div></div>
<div class="ttc" id="aclasstf_1_1_subflow_html_a59fcac1323e70d920088dd37bd0be245"><div class="ttname"><a href="classtf_1_1_subflow.html#a59fcac1323e70d920088dd37bd0be245">tf::Subflow::join</a></div><div class="ttdeci">void join()</div><div class="ttdoc">enables the subflow to join its parent task</div><div class="ttdef"><b>定义</b> executor-dl.hpp:2352</div></div>
<div class="ttc" id="atest__scalable__pipelines_8cpp_html_a28d67ed972e7388aae4da7bffe20d7b2"><div class="ttname"><a href="test__scalable__pipelines_8cpp.html#a28d67ed972e7388aae4da7bffe20d7b2">spawn</a></div><div class="ttdeci">void spawn(tf::Subflow &amp;sf, size_t L, size_t NUM_PIPES, size_t NUM_RECURS, size_t maxN, size_t r, std::vector&lt; std::vector&lt; int &gt; &gt; &amp;buffer, std::vector&lt; std::vector&lt; int &gt; &gt; &amp;source, std::vector&lt; std::vector&lt; tf::Pipe&lt;&gt; &gt; &gt; &amp;pipes, std::vector&lt; tf::ScalablePipeline&lt; typename std::vector&lt; tf::Pipe&lt;&gt; &gt;::iterator &gt; &gt; &amp;spls, size_t &amp;counter)</div><div class="ttdef"><b>定义</b> test_scalable_pipelines.cpp:1127</div></div>
</div><!-- fragment --><p>The code above computes the fifth fibonacci number using recursive subflow. Calling <a class="el" href="classtf_1_1_subflow.html#a59fcac1323e70d920088dd37bd0be245" title="enables the subflow to join its parent task">tf::Subflow::join</a> <em>immediately</em> materializes the subflow by executing all associated tasks to recursively compute fibonacci numbers. The taskflow graph is shown below:</p>
<p>Our implementation to join subflows is <em>recursive</em> in order to preserve the thread context in each subflow task. Having a deep recursion of subflows may cause stack overflow.</p>
<h1><a class="anchor" id="DetachASubflow"></a>
Detach a Subflow</h1>
<p>In contract to joined subflow, you can detach a subflow from its parent task, allowing its execution to flow independently.</p>
<div class="fragment"><div class="line"> 1: <a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"> 2:</div>
<div class="line"> 3: <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([] () {}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;A&quot;</span>);  <span class="comment">// static task A</span></div>
<div class="line"> 4: <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([] () {}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;C&quot;</span>);  <span class="comment">// static task C</span></div>
<div class="line"> 5: <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([] () {}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;D&quot;</span>);  <span class="comment">// static task D</span></div>
<div class="line"> 6:</div>
<div class="line"> 7: tf::Task <a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([] (tf::Subflow&amp; subflow) { </div>
<div class="line"> 8:   tf::Task <a class="code hl_variable" href="namespace_p.html#a104e30e1fb815af59069cc4567cb35ee">B1</a> = subflow.<a class="code hl_function" href="classtf_1_1_flow_builder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([] () {}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;B1&quot;</span>);  <span class="comment">// static task B1</span></div>
<div class="line"> 9:   tf::Task <a class="code hl_variable" href="namespace_p.html#a58c370cdedae1bcbf19bcdc9d7a8d583">B2</a> = subflow.<a class="code hl_function" href="classtf_1_1_flow_builder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([] () {}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;B2&quot;</span>);  <span class="comment">// static task B2</span></div>
<div class="line">10:   tf::Task <a class="code hl_variable" href="namespace_p.html#ab399e249b5a6d9c560c81efee6ab527a">B3</a> = subflow.<a class="code hl_function" href="classtf_1_1_flow_builder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([] () {}).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;B3&quot;</span>);  <span class="comment">// static task B3</span></div>
<div class="line">11:   <a class="code hl_variable" href="namespace_p.html#a104e30e1fb815af59069cc4567cb35ee">B1</a>.precede(B3);    <span class="comment">// B1 runs before B3</span></div>
<div class="line">12:   <a class="code hl_variable" href="namespace_p.html#a58c370cdedae1bcbf19bcdc9d7a8d583">B2</a>.precede(B3);    <span class="comment">// B2 runs before B3</span></div>
<div class="line">13:   subflow.<a class="code hl_function" href="classtf_1_1_subflow.html#acfdedc7e9676126e9a38ecf7b5a37864">detach</a>();  <span class="comment">// detach this subflow</span></div>
<div class="line">14: }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;B&quot;</span>);</div>
<div class="line">15:</div>
<div class="line">16: <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>.precede(<a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>);  <span class="comment">// B runs after A</span></div>
<div class="line">17: <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>.precede(<a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>);  <span class="comment">// C runs after A</span></div>
<div class="line">18: <a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>.precede(<a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a>);  <span class="comment">// D runs after B</span></div>
<div class="line">19: <a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>.precede(<a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a>);  <span class="comment">// D runs after C</span></div>
<div class="line">20:</div>
<div class="line">21: tf::Executor <a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>;</div>
<div class="line">22: <a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.<a class="code hl_function" href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">run</a>(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).wait();       <span class="comment">// execute the graph to spawn the subflow</span></div>
<div class="line">22: <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.dump(std::cout);            <span class="comment">// dump the taskflow to DOT format</span></div>
<div class="ttc" id="aclasstf_1_1_subflow_html_acfdedc7e9676126e9a38ecf7b5a37864"><div class="ttname"><a href="classtf_1_1_subflow.html#acfdedc7e9676126e9a38ecf7b5a37864">tf::Subflow::detach</a></div><div class="ttdeci">void detach()</div><div class="ttdoc">enables the subflow to detach from its parent task</div><div class="ttdef"><b>定义</b> executor-dl.hpp:2369</div></div>
</div><!-- fragment --><p>The figure below demonstrates a detached subflow based on the previous example. <a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> detached subflow will eventually join the topology of its parent task.</p>
<p>Detached subflow becomes an independent graph attached to the top-most taskflow. Running a taskflow multiple times will accumulate all detached tasks in the graph. For example, running the above taskflow 5 times results in a total of 19 tasks.</p>
<div class="fragment"><div class="line"><a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.run_n(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>, 5).wait();</div>
<div class="line">assert(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.num_tasks() == 19);</div>
<div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.dump(std::cout);</div>
</div><!-- fragment --><p>The dumped graph is shown as follows:</p>
<h1><a class="anchor" id="CreateANestedSubflow"></a>
Create a Nested Subflow</h1>
<p><a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> subflow can be nested or recursive. You can create another subflow from the execution of a subflow and so on.</p>
<div class="fragment"><div class="line"> 1: <a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"> 2:</div>
<div class="line"> 3: <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([] (<a class="code hl_class" href="classtf_1_1_subflow.html">tf::Subflow</a>&amp; sbf){</div>
<div class="line"> 4:   std::cout &lt;&lt; <span class="stringliteral">&quot;A spawns A1 &amp; subflow A2\n&quot;</span>;</div>
<div class="line"> 5:   <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> A1 = sbf.<a class="code hl_function" href="classtf_1_1_flow_builder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([] () {</div>
<div class="line"> 6:     std::cout &lt;&lt; <span class="stringliteral">&quot;subtask A1\n&quot;</span>;</div>
<div class="line"> 7:   }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;A1&quot;</span>);</div>
<div class="line"> 8:</div>
<div class="line"> 9:   <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> A2 = sbf.<a class="code hl_function" href="classtf_1_1_flow_builder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([] (<a class="code hl_class" href="classtf_1_1_subflow.html">tf::Subflow</a>&amp; sbf2){</div>
<div class="line">10:     std::cout &lt;&lt; <span class="stringliteral">&quot;A2 spawns A2_1 &amp; A2_2\n&quot;</span>;</div>
<div class="line">11:     <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> A2_1 = sbf2.<a class="code hl_function" href="classtf_1_1_flow_builder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([] () {</div>
<div class="line">12:       std::cout &lt;&lt; <span class="stringliteral">&quot;subtask A2_1\n&quot;</span>;</div>
<div class="line">13:     }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;A2_1&quot;</span>);</div>
<div class="line">14:     <a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> A2_2 = sbf2.<a class="code hl_function" href="classtf_1_1_flow_builder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([] () {</div>
<div class="line">15:       std::cout &lt;&lt; <span class="stringliteral">&quot;subtask A2_2\n&quot;</span>;</div>
<div class="line">16:     }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;A2_2&quot;</span>);</div>
<div class="line">17:     A2_1.<a class="code hl_function" href="classtf_1_1_task.html#a8c78c453295a553c1c016e4062da8588">precede</a>(A2_2);</div>
<div class="line">18:   }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;A2&quot;</span>);</div>
<div class="line">19:   <a class="code hl_variable" href="namespace_p.html#ad8e5e0856b9136906a0cfc4a369e77ee">A1</a>.precede(A2);</div>
<div class="line">20: }).<a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#aab18cfce5ee7c6881ae04f18be70d94a">name</a>(<span class="stringliteral">&quot;A&quot;</span>);</div>
<div class="line">21:</div>
<div class="line">22: <span class="comment">// execute the graph to spawn the subflow</span></div>
<div class="line">23: tf::Executor().run(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).get();</div>
<div class="line">24: <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.dump(std::cout);</div>
<div class="ttc" id="aclasstf_1_1_task_html_a8c78c453295a553c1c016e4062da8588"><div class="ttname"><a href="classtf_1_1_task.html#a8c78c453295a553c1c016e4062da8588">tf::Task::precede</a></div><div class="ttdeci">Task &amp; precede(Ts &amp;&amp;... tasks)</div><div class="ttdoc">adds precedence links from this to other tasks</div><div class="ttdef"><b>定义</b> task.hpp:394</div></div>
<div class="ttc" id="anamespace_p_html_ad8e5e0856b9136906a0cfc4a369e77ee"><div class="ttname"><a href="namespace_p.html#ad8e5e0856b9136906a0cfc4a369e77ee">P::A1</a></div><div class="ttdeci">const int A1</div><div class="ttdef"><b>定义</b> one_bit_adder.h:25</div></div>
</div><!-- fragment --><p>Debrief: </p><ul>
<li>Line 1 creates a taskflow object </li>
<li>Lines 3-20 create a task to spawn a subflow of two tasks A1 and A2 </li>
<li>Lines 9-18 spawn another subflow of two tasks A2_1 and A2_2 out of its parent task A2 </li>
<li>Lines 23-24 runs the graph asynchronously and dump its structure when it finishes</li>
</ul>
<p>Similarly, you can detach a nested subflow from its parent subflow. <a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> detached subflow will run independently and eventually join the topology of its parent subflow. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
