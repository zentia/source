<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>source: C Arrays and inheritance</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">source
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="搜索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_external_2reflect-cpp_2docs_2c__arrays__and__inheritance.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">C Arrays and inheritance</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md528"></a></p>
<p>reflect-cpp supports fixed-size C arrays and some forms of inheritance, but only as an opt-in.</p>
<p>We have made this design decision, because checking for C arrays and inheritance requires a disproportionate amount of compile time and we believe it is more important to reduce compile time than to support things out-of-the-box that most people won't need anyway. Since there are good alternatives for both of these problems, it is recommended to avoid using C arrays or inheritance altogether.</p>
<p>Note that C arrays are not the same thing as <code>std::array</code>. <code>std::array</code> is always supported and is the recommended alternative.</p>
<p>If you want support for these, you will have to pass the flag <code>-D REFLECT_CPP_C_ARRAYS_OR_INHERITANCE</code> during compilation.</p>
<h1><a class="anchor" id="autotoc_md529"></a>
C arrays</h1>
<p>Suppose you have a struct like this:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Person{</div>
<div class="line">    std::string first_name;  </div>
<div class="line">    std::string last_name; </div>
<div class="line">    <span class="keywordtype">int</span>[5] post_code;</div>
<div class="line">};</div>
</div><!-- fragment --><p>In this example, <code>post_code</code> is a C array. The best way to handle this is to simply replace the C array with <code>std::array</code>, like this:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Person{</div>
<div class="line">    std::string first_name;  </div>
<div class="line">    std::string last_name; </div>
<div class="line">    std::array&lt;int, 5&gt; post_code;</div>
<div class="line">};</div>
</div><!-- fragment --><p>However, in some cases, using C arrays is unavoidable. For instance <code>bson_oid_t</code> contains a C array under-the-hood, so if you want to parse a <code>bson_oid_t</code> you will have no choice but to pass the flag mentioned above.</p>
<h1><a class="anchor" id="autotoc_md530"></a>
Inheritance</h1>
<p>reflect-cpp supports some form of inheritance. Because we use structured bindings to retrieve the fields of a struct, there are limitations on what we can do when it comes to inheritance:</p>
<p><em>Every non-static data member of E must be a direct member of E or the same base class of E.</em> (<a href="https://en.cppreference.com/w/cpp/language/structured_binding">https://en.cppreference.com/w/cpp/language/structured_binding</a>)</p>
<p>In other words, all of the fields must be inside the same struct.</p>
<p>So, this is fine:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code hl_class" href="class_base.html">Base</a> {</div>
<div class="line"> <span class="keywordtype">int</span> <a class="code hl_variable" href="offscreen_8c.html#a5fd331c99e778f04762be6d8173eb4d2">x</a>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Derived : <a class="code hl_class" href="class_base.html">Base</a> {};</div>
<div class="ttc" id="aclass_base_html"><div class="ttname"><a href="class_base.html">Base</a></div><div class="ttdef"><b>定义</b> test_thread.h:45</div></div>
<div class="ttc" id="aoffscreen_8c_html_a5fd331c99e778f04762be6d8173eb4d2"><div class="ttname"><a href="offscreen_8c.html#a5fd331c99e778f04762be6d8173eb4d2">x</a></div><div class="ttdeci">float x</div><div class="ttdef"><b>定义</b> offscreen.c:41</div></div>
</div><!-- fragment --><p>This is fine as well:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code hl_class" href="class_base.html">Base</a> {};</div>
<div class="line"><span class="keyword">struct </span>Derived : <a class="code hl_class" href="class_base.html">Base</a> {</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code hl_variable" href="offscreen_8c.html#a5fd331c99e778f04762be6d8173eb4d2">x</a>;</div>
<div class="line">};</div>
</div><!-- fragment --><p>But this is not fine, because the fields are spread out over more than one struct:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code hl_class" href="class_base.html">Base</a> {</div>
<div class="line">   <span class="keywordtype">int</span> <a class="code hl_variable" href="offscreen_8c.html#a5fd331c99e778f04762be6d8173eb4d2">x</a>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Derived : <a class="code hl_class" href="class_base.html">Base</a> {</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a5e247fc24ceb70d83f6ad59149b8910a">y</a>;</div>
<div class="line">};</div>
<div class="ttc" id="aimgui__impl__opengl3__loader_8h_html_a5e247fc24ceb70d83f6ad59149b8910a"><div class="ttname"><a href="imgui__impl__opengl3__loader_8h.html#a5e247fc24ceb70d83f6ad59149b8910a">y</a></div><div class="ttdeci">GLint y</div><div class="ttdef"><b>定义</b> imgui_impl_opengl3_loader.h:188</div></div>
</div><!-- fragment --><p>The recommended alternative is to simply use <code><a class="el" href="structrfl_1_1_flatten.html" title="Used to embed another struct into the generated output.">rfl::Flatten</a></code>, which has no such limitation:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code hl_class" href="class_base.html">Base</a> {</div>
<div class="line">   <span class="keywordtype">int</span> <a class="code hl_variable" href="offscreen_8c.html#a5fd331c99e778f04762be6d8173eb4d2">x</a>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>Derived {</div>
<div class="line">  <a class="code hl_struct" href="structrfl_1_1_flatten.html">rfl::Flatten&lt;Base&gt;</a> base; </div>
<div class="line">  <span class="keywordtype">int</span> <a class="code hl_typedef" href="imgui__impl__opengl3__loader_8h.html#a5e247fc24ceb70d83f6ad59149b8910a">y</a>;</div>
<div class="line">};</div>
<div class="ttc" id="astructrfl_1_1_flatten_html"><div class="ttname"><a href="structrfl_1_1_flatten.html">rfl::Flatten</a></div><div class="ttdoc">Used to embed another struct into the generated output.</div><div class="ttdef"><b>定义</b> Flatten.hpp:14</div></div>
</div><!-- fragment --><p>Please refer to the section on <code><a class="el" href="structrfl_1_1_flatten.html" title="Used to embed another struct into the generated output.">rfl::Flatten</a></code> in this documentation for more information.</p>
<p>If for any reason you want to use inheritance patterns like the ones described above, you will make have to make sure that all of the fields are inside the same struct and also you will also have to pass the compile time flag mentioned above. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
