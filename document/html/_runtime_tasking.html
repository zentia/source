<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>source: Interact with the Runtime</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">source
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="搜索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_runtime_tasking.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Interact with the Runtime</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>目录</h3>
<ul>
  <li class="level1">
    <a href="#CreateARuntimeTask">Create a Runtime Object</a>
  </li>
  <li class="level1">
    <a href="#AcquireTheRunningExecutor">Acquire the Running Executor</a>
  </li>
  <li class="level1">
    <a href="#RuntimeTaskingRunATaskGraphSynchronously">Run a Task Graph Synchronously</a>
  </li>
  <li class="level1">
    <a href="#LearnMoreAboutRuntime">Learn More About Runtime</a>
  </li>
</ul>
</div>
<div class="textblock"><p>Taskflow allows you to interact with the scheduling runtime by taking a <em>runtime object</em> as an argument of a task. This is mostly useful for designing specialized parallel algorithms extended from the existing facility of Taskflow.</p>
<h1><a class="anchor" id="CreateARuntimeTask"></a>
Create a Runtime Object</h1>
<p>Taskflow allows a static task and a condition task to take a referenced <a class="el" href="classtf_1_1_runtime.html" title="class to include a runtime object in a task">tf::Runtime</a> object that provides a set of methods to interact with the scheduling runtime. The following example creates a static task that leverages <a class="el" href="classtf_1_1_runtime.html" title="class to include a runtime object in a task">tf::Runtime</a> to explicitly schedule a conditioned task which would never run under the normal scheduling circumstance:</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1_task.html">tf::Task</a> <a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>, <a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>, <a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a>;</div>
<div class="line">std::tie(<a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>, <a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>, <a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a>) = <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace(</div>
<div class="line">  [] () { <span class="keywordflow">return</span> 0; },</div>
<div class="line">  [&amp;<a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>] (<a class="code hl_class" href="classtf_1_1_runtime.html">tf::Runtime</a>&amp; rt) {  <span class="comment">// C must be captured by reference</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;B\n&quot;</span>; </div>
<div class="line">    rt.schedule(<a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>);</div>
<div class="line">  },</div>
<div class="line">  [] () { std::cout &lt;&lt; <span class="stringliteral">&quot;C\n&quot;</span>; },</div>
<div class="line">  [] () { std::cout &lt;&lt; <span class="stringliteral">&quot;D\n&quot;</span>; }</div>
<div class="line">);</div>
<div class="line"><a class="code hl_typedef" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a>.precede(<a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>, <a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a>, <a class="code hl_variable" href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a>);</div>
<div class="line"><a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.<a class="code hl_function" href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">run</a>(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).wait();</div>
<div class="ttc" id="a_eigen_solver___eigen_solver___matrix_type_8cpp_html_a925331f9b6e4844293d36a8df2256d38"><div class="ttname"><a href="_eigen_solver___eigen_solver___matrix_type_8cpp.html#a925331f9b6e4844293d36a8df2256d38">D</a></div><div class="ttdeci">MatrixXcd D</div><div class="ttdef"><b>定义</b> EigenSolver_EigenSolver_MatrixType.cpp:14</div></div>
<div class="ttc" id="abench__gemm_8cpp_html_a37a83060ac796961b44991c836f083f7"><div class="ttname"><a href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a></div><div class="ttdeci">Matrix&lt; SCALARB, Dynamic, Dynamic &gt; B</div><div class="ttdef"><b>定义</b> bench_gemm.cpp:36</div></div>
<div class="ttc" id="abench__gemm_8cpp_html_addc86e8508f14411ec98f521c520f875"><div class="ttname"><a href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a></div><div class="ttdeci">Matrix&lt; SCALARA, Dynamic, Dynamic &gt; A</div><div class="ttdef"><b>定义</b> bench_gemm.cpp:35</div></div>
<div class="ttc" id="aclasstf_1_1_executor_html_a519777f5783981d534e9e53b99712069"><div class="ttname"><a href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">tf::Executor::run</a></div><div class="ttdeci">tf::Future&lt; void &gt; run(Taskflow &amp;taskflow)</div><div class="ttdoc">runs a taskflow once</div><div class="ttdef"><b>定义</b> executor-dl.hpp:2067</div></div>
<div class="ttc" id="aclasstf_1_1_runtime_html"><div class="ttname"><a href="classtf_1_1_runtime.html">tf::Runtime</a></div><div class="ttdoc">class to include a runtime object in a task</div><div class="ttdef"><b>定义</b> runtime.hpp:35</div></div>
<div class="ttc" id="aclasstf_1_1_task_html"><div class="ttname"><a href="classtf_1_1_task.html">tf::Task</a></div><div class="ttdoc">class to create a task handle over a node in a taskflow graph</div><div class="ttdef"><b>定义</b> task.hpp:150</div></div>
<div class="ttc" id="apoisson_8hpp_html_aa56fe360bb0ae38e0082f49e394ff825"><div class="ttname"><a href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a></div><div class="ttdeci">void taskflow(int nx, int ny, double dx, double dy, double *f, int itold, int itnew, double *u, double *unew, int block_size, unsigned num_threads)</div><div class="ttdef"><b>定义</b> taskflow.cpp:6</div></div>
<div class="ttc" id="atest__buffer__node_8cpp_html_ac4cf4b2ab929bd23951a8676eeac086b"><div class="ttname"><a href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a></div><div class="ttdeci">#define C</div><div class="ttdef"><b>定义</b> test_buffer_node.cpp:28</div></div>
<div class="ttc" id="athread__pool_8cpp_html_a543e564a8407bbeac15cb2d929fec755"><div class="ttname"><a href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a></div><div class="ttdeci">tf::Executor executor</div><div class="ttdef"><b>定义</b> thread_pool.cpp:6</div></div>
</div><!-- fragment --><p>When the condition task <code><a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a></code> completes and returns <code>0</code>, the scheduler moves on to task <code><a class="el" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a></code>. Under the normal circumstance, tasks <code>C</code> and <code>D</code> will not run because their conditional dependencies never happen. This can be broken by forcefully scheduling <code>C</code> or/and <code>D</code> via a runtime object of a task that resides in the same graph. Here, task <code><a class="el" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a></code> call <a class="el" href="classtf_1_1_runtime.html#aa7e72cc0f298475195b252c8f1793343" title="schedules an active task immediately to the worker&#39;s queue">tf::Runtime::schedule</a> to forcefully run task <code>C</code> even though the weak dependency between <code><a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a></code> and <code>C</code> will never happen based on the graph structure itself. As a result, we will see both <code><a class="el" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a></code> and <code>C</code> in the output:</p>
<div class="fragment"><div class="line">{.shell-session} </div>
<div class="line"><a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a>    # <a class="code hl_typedef" href="bench__gemm_8cpp.html#a37a83060ac796961b44991c836f083f7">B</a> leverages <a class="code hl_variable" href="_cwise__product_8cpp.html#ad2cbe4616e813eb9af81732dca777b24">a</a> <a class="code hl_function" href="runtime_2spdlog_2include_2spdlog_2fmt_2bundled_2base_8h.html#a8c5f2060819744fc66f8fbce25a480be">runtime</a> <span class="keywordtype">object</span> to schedule <a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a> out of its dependency constraint</div>
<div class="line"><a class="code hl_define" href="test__buffer__node_8cpp.html#ac4cf4b2ab929bd23951a8676eeac086b">C</a></div>
<div class="ttc" id="a_cwise__product_8cpp_html_ad2cbe4616e813eb9af81732dca777b24"><div class="ttname"><a href="_cwise__product_8cpp.html#ad2cbe4616e813eb9af81732dca777b24">a</a></div><div class="ttdeci">Array33i a</div><div class="ttdef"><b>定义</b> Cwise_product.cpp:1</div></div>
<div class="ttc" id="aruntime_2spdlog_2include_2spdlog_2fmt_2bundled_2base_8h_html_a8c5f2060819744fc66f8fbce25a480be"><div class="ttname"><a href="runtime_2spdlog_2include_2spdlog_2fmt_2bundled_2base_8h.html#a8c5f2060819744fc66f8fbce25a480be">runtime</a></div><div class="ttdeci">auto runtime(string_view s) -&gt; runtime_format_string&lt;&gt;</div><div class="ttdef"><b>定义</b> base.h:2684</div></div>
</div><!-- fragment --><dl class="section attention"><dt>注意</dt><dd>You should only schedule an <em>active</em> task from a runtime object. An active task is a task in a running taskflow. The task may or may not be running, and scheduling that task will immediately put it into the task queue of the worker that is running the runtime object.</dd></dl>
<h1><a class="anchor" id="AcquireTheRunningExecutor"></a>
Acquire the Running Executor</h1>
<p>You can acquire the reference to the running executor using <a class="el" href="classtf_1_1_runtime.html#a4ee48a82df1f9758a999d18e6015cec4" title="obtains the running executor">tf::Runtime::executor()</a>. The executor associated with a runtime object is the executor that runs the parent task of that runtime object.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1_executor.html">tf::Executor</a> <a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>;</div>
<div class="line"><a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;](<a class="code hl_class" href="classtf_1_1_runtime.html">tf::Runtime</a>&amp; rt){</div>
<div class="line">  assert(&amp;(rt.<a class="code hl_function" href="classtf_1_1_runtime.html#a4ee48a82df1f9758a999d18e6015cec4">executor</a>()) == &amp;<a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>);</div>
<div class="line">});</div>
<div class="line"><a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.run(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).wait();</div>
<div class="ttc" id="aclasstf_1_1_executor_html"><div class="ttname"><a href="classtf_1_1_executor.html">tf::Executor</a></div><div class="ttdoc">class to create an executor for running a taskflow graph</div><div class="ttdef"><b>定义</b> executor-dl.hpp:51</div></div>
<div class="ttc" id="aclasstf_1_1_runtime_html_a4ee48a82df1f9758a999d18e6015cec4"><div class="ttname"><a href="classtf_1_1_runtime.html#a4ee48a82df1f9758a999d18e6015cec4">tf::Runtime::executor</a></div><div class="ttdeci">Executor &amp; executor()</div><div class="ttdoc">obtains the running executor</div><div class="ttdef"><b>定义</b> runtime.hpp:329</div></div>
<div class="ttc" id="aclasstf_1_1_taskflow_html"><div class="ttname"><a href="classtf_1_1_taskflow.html">tf::Taskflow</a></div><div class="ttdoc">class to create a taskflow object</div><div class="ttdef"><b>定义</b> taskflow.hpp:67</div></div>
</div><!-- fragment --><h1><a class="anchor" id="RuntimeTaskingRunATaskGraphSynchronously"></a>
Run a Task Graph Synchronously</h1>
<p><a class="el" href="bench__gemm_8cpp.html#addc86e8508f14411ec98f521c520f875">A</a> runtime object can spawn and run a task graph synchronously using <a class="el" href="classtf_1_1_runtime.html#a1c772e90614302024cfa52fa86d75cac" title="co-runs the given target and waits until it completes">tf::Runtime::corun</a>. This model allows you to leverage dynamic tasking to execute a parallel workload within a runtime object. You can create a task graph yourself and execute it through a runtime object. This organization avoids repetitive creation of a subflow with the same topology, such as running a runtime object repetitively. The following code performs the same execution logic as the above example but using the given task graph to avoid repetitive creations of a subflow:</p>
<div class="fragment"><div class="line"><span class="comment">// create a custom graph</span></div>
<div class="line"><a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> graph;</div>
<div class="line">graph.<a class="code hl_function" href="classtf_1_1_flow_builder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([](){ std::cout &lt;&lt; <span class="stringliteral">&quot;independent task 1\n&quot;</span>; });</div>
<div class="line">graph.<a class="code hl_function" href="classtf_1_1_flow_builder.html#a60d7a666cab71ecfa3010b2efb0d6b57">emplace</a>([](){ std::cout &lt;&lt; <span class="stringliteral">&quot;independent task 2\n&quot;</span>; });</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;](<a class="code hl_class" href="classtf_1_1_runtime.html">tf::Runtime</a>&amp; rt){ </div>
<div class="line">  <span class="comment">// this worker coruns the graph through its work-stealing loop</span></div>
<div class="line">  rt.<a class="code hl_function" href="classtf_1_1_runtime.html#a1c772e90614302024cfa52fa86d75cac">corun</a>(graph);</div>
<div class="line">});</div>
<div class="line"><a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.<a class="code hl_function" href="classtf_1_1_executor.html#a6d0617eebc9421f1ba1f82ce6dd02c00">run_n</a>(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>, 10000);</div>
<div class="ttc" id="aclasstf_1_1_executor_html_a6d0617eebc9421f1ba1f82ce6dd02c00"><div class="ttname"><a href="classtf_1_1_executor.html#a6d0617eebc9421f1ba1f82ce6dd02c00">tf::Executor::run_n</a></div><div class="ttdeci">tf::Future&lt; void &gt; run_n(Taskflow &amp;taskflow, size_t N)</div><div class="ttdoc">runs a taskflow for N times</div><div class="ttdef"><b>定义</b> executor-dl.hpp:2089</div></div>
<div class="ttc" id="aclasstf_1_1_flow_builder_html_a60d7a666cab71ecfa3010b2efb0d6b57"><div class="ttname"><a href="classtf_1_1_flow_builder.html#a60d7a666cab71ecfa3010b2efb0d6b57">tf::FlowBuilder::emplace</a></div><div class="ttdeci">Task emplace(C &amp;&amp;callable)</div><div class="ttdoc">creates a static task</div><div class="ttdef"><b>定义</b> flow_builder.hpp:1261</div></div>
<div class="ttc" id="aclasstf_1_1_runtime_html_a1c772e90614302024cfa52fa86d75cac"><div class="ttname"><a href="classtf_1_1_runtime.html#a1c772e90614302024cfa52fa86d75cac">tf::Runtime::corun</a></div><div class="ttdeci">void corun(T &amp;&amp;target)</div><div class="ttdoc">co-runs the given target and waits until it completes</div><div class="ttdef"><b>定义</b> executor-dl.hpp:2403</div></div>
</div><!-- fragment --><p>Although <a class="el" href="classtf_1_1_runtime.html#a1c772e90614302024cfa52fa86d75cac" title="co-runs the given target and waits until it completes">tf::Runtime::corun</a> blocks until the operation completes, the caller thread (worker) is not preempted (e.g., sleep or holding any lock). Instead, the caller thread joins the work-stealing loop of the executor and leaves whenever the spawned task graph completes. This is different from waiting for a submitted taskflow using tf::Future&lt;T&gt;::wait which blocks the caller thread until the submitted taskflow completes. When multiple submitted taskflows are being waited, their executions can potentially lead to deadlock. For example, the code below creates a taskflow of 1000 tasks with each task running a taskflow of 500 tasks in a blocking fashion:</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1_executor.html">tf::Executor</a> <a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>(2);</div>
<div class="line"><a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line">std::array&lt;tf::Taskflow, 1000&gt; others;</div>
<div class="line"> </div>
<div class="line">std::atomic&lt;size_t&gt; <a class="code hl_variable" href="events_8c.html#ac6c464b0a83a481fee26175f6229c5cc">counter</a>{0};</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>&lt;1000; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>++) {</div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;500; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line">    others[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>].emplace([&amp;](){ <a class="code hl_variable" href="events_8c.html#ac6c464b0a83a481fee26175f6229c5cc">counter</a>++; });</div>
<div class="line">  }</div>
<div class="line">  <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;<a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>, &amp;tf=others[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>]](){</div>
<div class="line">    <span class="comment">// blocking the worker can introduce deadlock where</span></div>
<div class="line">    <span class="comment">// all workers are waiting for their taskflows to finish</span></div>
<div class="line">    <a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.<a class="code hl_function" href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">run</a>(tf).wait();</div>
<div class="line">  });</div>
<div class="line">}</div>
<div class="line"><a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.<a class="code hl_function" href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">run</a>(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).wait();</div>
<div class="ttc" id="a_bi_c_g_s_t_a_b__simple_8cpp_html_a5150192f625f4d7970d61169b9567f39"><div class="ttname"><a href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a></div><div class="ttdeci">int n</div><div class="ttdef"><b>定义</b> BiCGSTAB_simple.cpp:1</div></div>
<div class="ttc" id="a_bi_c_g_s_t_a_b__step__by__step_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>定义</b> BiCGSTAB_step_by_step.cpp:9</div></div>
<div class="ttc" id="aevents_8c_html_ac6c464b0a83a481fee26175f6229c5cc"><div class="ttname"><a href="events_8c.html#ac6c464b0a83a481fee26175f6229c5cc">counter</a></div><div class="ttdeci">static unsigned int counter</div><div class="ttdef"><b>定义</b> events.c:48</div></div>
</div><!-- fragment --><p>Using <a class="el" href="classtf_1_1_runtime.html#a1c772e90614302024cfa52fa86d75cac" title="co-runs the given target and waits until it completes">tf::Runtime::corun</a> allows each worker to corun these taskflows through its work-stealing loop, thus avoiding deadlock problem caused by blocking wait.</p>
<div class="fragment"><div class="line"><a class="code hl_class" href="classtf_1_1_executor.html">tf::Executor</a> <a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>(2);</div>
<div class="line"><a class="code hl_class" href="classtf_1_1_taskflow.html">tf::Taskflow</a> <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>;</div>
<div class="line">std::array&lt;tf::Taskflow, 1000&gt; others;</div>
<div class="line"> </div>
<div class="line">std::atomic&lt;size_t&gt; <a class="code hl_variable" href="events_8c.html#ac6c464b0a83a481fee26175f6229c5cc">counter</a>{0};</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>&lt;1000; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>++) {</div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;500; <a class="code hl_variable" href="_bi_c_g_s_t_a_b__step__by__step_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line">    others[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>].emplace([&amp;](){ <a class="code hl_variable" href="events_8c.html#ac6c464b0a83a481fee26175f6229c5cc">counter</a>++; });</div>
<div class="line">  }</div>
<div class="line">  <a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>.emplace([&amp;tf=others[<a class="code hl_variable" href="_bi_c_g_s_t_a_b__simple_8cpp.html#a5150192f625f4d7970d61169b9567f39">n</a>]](tf::Runtime&amp; rt){</div>
<div class="line">    <span class="comment">// the caller worker will not block but corun these</span></div>
<div class="line">    <span class="comment">// taskflows through its work-stealing loop</span></div>
<div class="line">    rt.<a class="code hl_function" href="classtf_1_1_runtime.html#a1c772e90614302024cfa52fa86d75cac">corun</a>(tf);</div>
<div class="line">  });</div>
<div class="line">}</div>
<div class="line"><a class="code hl_variable" href="thread__pool_8cpp.html#a543e564a8407bbeac15cb2d929fec755">executor</a>.<a class="code hl_function" href="classtf_1_1_executor.html#a519777f5783981d534e9e53b99712069">run</a>(<a class="code hl_function" href="poisson_8hpp.html#aa56fe360bb0ae38e0082f49e394ff825">taskflow</a>).wait();</div>
</div><!-- fragment --><h1><a class="anchor" id="LearnMoreAboutRuntime"></a>
Learn More About Runtime</h1>
<p>Please visit the following pages to learn more about <a class="el" href="classtf_1_1_runtime.html" title="class to include a runtime object in a task">tf::Runtime</a>:</p>
<ul>
<li><a class="el" href="_async_tasking.html#LaunchAsynchronousTasksFromARuntime">Launch Asynchronous Tasks from a Runtime</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
