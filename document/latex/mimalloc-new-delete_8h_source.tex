\doxysection{mimalloc-\/new-\/delete.h}
\hypertarget{mimalloc-new-delete_8h_source}{}\label{mimalloc-new-delete_8h_source}\index{runtime/EASTL/packages/mimalloc/include/mimalloc-\/new-\/delete.h@{runtime/EASTL/packages/mimalloc/include/mimalloc-\/new-\/delete.h}}
\mbox{\hyperlink{mimalloc-new-delete_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00002\ \textcolor{comment}{Copyright\ (c)\ 2018-\/2020\ Microsoft\ Research,\ Daan\ Leijen}}
\DoxyCodeLine{00003\ \textcolor{comment}{This\ is\ free\ software;\ you\ can\ redistribute\ it\ and/or\ modify\ it\ under\ the}}
\DoxyCodeLine{00004\ \textcolor{comment}{terms\ of\ the\ MIT\ license.\ A\ copy\ of\ the\ license\ can\ be\ found\ in\ the\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{"{}LICENSE"{}\ at\ the\ root\ of\ this\ distribution.}}
\DoxyCodeLine{00006\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#ifndef\ MIMALLOC\_NEW\_DELETE\_H}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#define\ MIMALLOC\_NEW\_DELETE\_H}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ This\ header\ provides\ convenient\ overrides\ for\ the\ new\ and}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ delete\ operations\ in\ C++.}}
\DoxyCodeLine{00014\ \textcolor{comment}{//}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ This\ header\ should\ be\ included\ in\ only\ one\ source\ file!}}
\DoxyCodeLine{00016\ \textcolor{comment}{//}}
\DoxyCodeLine{00017\ \textcolor{comment}{//\ On\ Windows,\ or\ when\ linking\ dynamically\ with\ mimalloc,\ these}}
\DoxyCodeLine{00018\ \textcolor{comment}{//\ can\ be\ more\ performant\ than\ the\ standard\ new-\/delete\ operations.}}
\DoxyCodeLine{00019\ \textcolor{comment}{//\ See\ <https://en.cppreference.com/w/cpp/memory/new/operator\_new>}}
\DoxyCodeLine{00020\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#if\ defined(\_\_cplusplus)}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\ \ \#include\ <new>}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\ \ \#include\ <\mbox{\hyperlink{mimalloc_8h}{mimalloc.h}}>}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\ \ \#if\ defined(\_MSC\_VER)\ \&\&\ defined(\_Ret\_notnull\_)\ \&\&\ defined(\_Post\_writable\_byte\_size\_)}}
\DoxyCodeLine{00026\ \ \ \textcolor{comment}{//\ stay\ consistent\ with\ VCRT\ definitions}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\ \ \#define\ mi\_decl\_new(n)\ \ \ \ \ \ \ \ \ \ mi\_decl\_nodiscard\ mi\_decl\_restrict\ \_Ret\_notnull\_\ \_Post\_writable\_byte\_size\_(n)}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\ \ \#define\ mi\_decl\_new\_nothrow(n)\ \ mi\_decl\_nodiscard\ mi\_decl\_restrict\ \_Ret\_maybenull\_\ \_Success\_(return\ !=\ NULL)\ \_Post\_writable\_byte\_size\_(n)}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\ \ \#define\ mi\_decl\_new(n)\ \ \ \ \ \ \ \ \ \ mi\_decl\_nodiscard\ mi\_decl\_restrict}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\ \ \#define\ mi\_decl\_new\_nothrow(n)\ \ mi\_decl\_nodiscard\ mi\_decl\_restrict}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \ \ \textcolor{keywordtype}{void}\ \textcolor{keyword}{operator}\ \textcolor{keyword}{delete}(\textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \textcolor{keyword}{noexcept}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \mbox{\hyperlink{group__malloc_gaf2c7b89c327d1f60f59e68b9ea644d95}{mi\_free}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});\ \};}
\DoxyCodeLine{00035\ \ \ \textcolor{keywordtype}{void}\ \textcolor{keyword}{operator}\ \textcolor{keyword}{delete}[](\textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \textcolor{keyword}{noexcept}\ \ \ \ \ \ \ \ \ \ \ \ \{\ \mbox{\hyperlink{group__malloc_gaf2c7b89c327d1f60f59e68b9ea644d95}{mi\_free}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});\ \};}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \textcolor{keywordtype}{void}\ \textcolor{keyword}{operator}\ \textcolor{keyword}{delete}\ \ (\textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ \textcolor{keyword}{const}\ std::nothrow\_t\&)\ \textcolor{keyword}{noexcept}\ \{\ \mbox{\hyperlink{group__malloc_gaf2c7b89c327d1f60f59e68b9ea644d95}{mi\_free}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});\ \}}
\DoxyCodeLine{00038\ \ \ \textcolor{keywordtype}{void}\ \textcolor{keyword}{operator}\ \textcolor{keyword}{delete}[](\textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ \textcolor{keyword}{const}\ std::nothrow\_t\&)\ \textcolor{keyword}{noexcept}\ \{\ \mbox{\hyperlink{group__malloc_gaf2c7b89c327d1f60f59e68b9ea644d95}{mi\_free}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});\ \}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ mi\_decl\_new(n)\ \textcolor{keywordtype}{void}*\ \textcolor{keyword}{operator}\ \textcolor{keyword}{new}(std::size\_t\ n)\ \textcolor{keyword}{noexcept}(\textcolor{keyword}{false})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{group__cpp_ga633d96e3bc7011f960df9f3b2731fc6a}{mi\_new}}(n);\ \}}
\DoxyCodeLine{00041\ \ \ mi\_decl\_new(n)\ \textcolor{keywordtype}{void}*\ \textcolor{keyword}{operator}\ \textcolor{keyword}{new}[](std::size\_t\ n)\ \textcolor{keyword}{noexcept}(\textcolor{keyword}{false})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{group__cpp_ga633d96e3bc7011f960df9f3b2731fc6a}{mi\_new}}(n);\ \}}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ mi\_decl\_new\_nothrow(n)\ \textcolor{keywordtype}{void}*\ \textcolor{keyword}{operator}\ \textcolor{keyword}{new}\ \ (std::size\_t\ n,\ \textcolor{keyword}{const}\ std::nothrow\_t\&\ tag)\ \textcolor{keyword}{noexcept}\ \{\ (\mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}})(tag);\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{group__cpp_ga5cb4f120d1f7296074256215aa9a9e54}{mi\_new\_nothrow}}(n);\ \}}
\DoxyCodeLine{00044\ \ \ mi\_decl\_new\_nothrow(n)\ \textcolor{keywordtype}{void}*\ \textcolor{keyword}{operator}\ \textcolor{keyword}{new}[](std::size\_t\ n,\ \textcolor{keyword}{const}\ std::nothrow\_t\&\ tag)\ \textcolor{keyword}{noexcept}\ \{\ (\mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}})(tag);\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{group__cpp_ga5cb4f120d1f7296074256215aa9a9e54}{mi\_new\_nothrow}}(n);\ \}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \textcolor{preprocessor}{\ \ \#if\ (\_\_cplusplus\ >=\ 201402L\ ||\ \_MSC\_VER\ >=\ 1916)}}
\DoxyCodeLine{00047\ \ \ \textcolor{keywordtype}{void}\ \textcolor{keyword}{operator}\ \textcolor{keyword}{delete}\ \ (\textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ std::size\_t\ n)\ \textcolor{keyword}{noexcept}\ \{\ \mbox{\hyperlink{group__posix_gae01389eedab8d67341ff52e2aad80ebb}{mi\_free\_size}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},n);\ \};}
\DoxyCodeLine{00048\ \ \ \textcolor{keywordtype}{void}\ \textcolor{keyword}{operator}\ \textcolor{keyword}{delete}[](\textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ std::size\_t\ n)\ \textcolor{keyword}{noexcept}\ \{\ \mbox{\hyperlink{group__posix_gae01389eedab8d67341ff52e2aad80ebb}{mi\_free\_size}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},n);\ \};}
\DoxyCodeLine{00049\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \textcolor{preprocessor}{\ \ \#if\ (\_\_cplusplus\ >\ 201402L\ ||\ defined(\_\_cpp\_aligned\_new))}}
\DoxyCodeLine{00052\ \ \ \textcolor{keywordtype}{void}\ \textcolor{keyword}{operator}\ \textcolor{keyword}{delete}\ \ (\textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ std::align\_val\_t\ al)\ \textcolor{keyword}{noexcept}\ \{\ \mbox{\hyperlink{group__posix_ga0d28d5cf61e6bfbb18c63092939fe5c9}{mi\_free\_aligned}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(al));\ \}}
\DoxyCodeLine{00053\ \ \ \textcolor{keywordtype}{void}\ \textcolor{keyword}{operator}\ \textcolor{keyword}{delete}[](\textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ std::align\_val\_t\ al)\ \textcolor{keyword}{noexcept}\ \{\ \mbox{\hyperlink{group__posix_ga0d28d5cf61e6bfbb18c63092939fe5c9}{mi\_free\_aligned}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(al));\ \}}
\DoxyCodeLine{00054\ \ \ \textcolor{keywordtype}{void}\ \textcolor{keyword}{operator}\ \textcolor{keyword}{delete}\ \ (\textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ std::size\_t\ n,\ std::align\_val\_t\ al)\ \textcolor{keyword}{noexcept}\ \{\ \mbox{\hyperlink{group__posix_ga72e9d7ffb5fe94d69bc722c8506e27bc}{mi\_free\_size\_aligned}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ n,\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(al));\ \};}
\DoxyCodeLine{00055\ \ \ \textcolor{keywordtype}{void}\ \textcolor{keyword}{operator}\ \textcolor{keyword}{delete}[](\textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ std::size\_t\ n,\ std::align\_val\_t\ al)\ \textcolor{keyword}{noexcept}\ \{\ \mbox{\hyperlink{group__posix_ga72e9d7ffb5fe94d69bc722c8506e27bc}{mi\_free\_size\_aligned}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ n,\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(al));\ \};}
\DoxyCodeLine{00056\ \ \ \textcolor{keywordtype}{void}\ \textcolor{keyword}{operator}\ \textcolor{keyword}{delete}\ \ (\textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ std::align\_val\_t\ al,\ \textcolor{keyword}{const}\ std::nothrow\_t\&)\ \textcolor{keyword}{noexcept}\ \{\ \mbox{\hyperlink{group__posix_ga0d28d5cf61e6bfbb18c63092939fe5c9}{mi\_free\_aligned}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(al));\ \}}
\DoxyCodeLine{00057\ \ \ \textcolor{keywordtype}{void}\ \textcolor{keyword}{operator}\ \textcolor{keyword}{delete}[](\textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ std::align\_val\_t\ al,\ \textcolor{keyword}{const}\ std::nothrow\_t\&)\ \textcolor{keyword}{noexcept}\ \{\ \mbox{\hyperlink{group__posix_ga0d28d5cf61e6bfbb18c63092939fe5c9}{mi\_free\_aligned}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(al));\ \}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \textcolor{keywordtype}{void}*\ \textcolor{keyword}{operator}\ \textcolor{keyword}{new}\ \ (std::size\_t\ n,\ std::align\_val\_t\ al)\ \textcolor{keyword}{noexcept}(\textcolor{keyword}{false})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{group__cpp_ga79c54da0b4b4ce9fcc11d2f6ef6675f8}{mi\_new\_aligned}}(n,\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(al));\ \}}
\DoxyCodeLine{00060\ \ \ \textcolor{keywordtype}{void}*\ \textcolor{keyword}{operator}\ \textcolor{keyword}{new}[](std::size\_t\ n,\ std::align\_val\_t\ al)\ \textcolor{keyword}{noexcept}(\textcolor{keyword}{false})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{group__cpp_ga79c54da0b4b4ce9fcc11d2f6ef6675f8}{mi\_new\_aligned}}(n,\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(al));\ \}}
\DoxyCodeLine{00061\ \ \ \textcolor{keywordtype}{void}*\ \textcolor{keyword}{operator}\ \textcolor{keyword}{new}\ \ (std::size\_t\ n,\ std::align\_val\_t\ al,\ \textcolor{keyword}{const}\ std::nothrow\_t\&)\ \textcolor{keyword}{noexcept}\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{group__cpp_ga92ae00b6dd64406c7e64557711ec04b7}{mi\_new\_aligned\_nothrow}}(n,\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(al));\ \}}
\DoxyCodeLine{00062\ \ \ \textcolor{keywordtype}{void}*\ \textcolor{keyword}{operator}\ \textcolor{keyword}{new}[](std::size\_t\ n,\ std::align\_val\_t\ al,\ \textcolor{keyword}{const}\ std::nothrow\_t\&)\ \textcolor{keyword}{noexcept}\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{group__cpp_ga92ae00b6dd64406c7e64557711ec04b7}{mi\_new\_aligned\_nothrow}}(n,\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(al));\ \}}
\DoxyCodeLine{00063\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00064\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ MIMALLOC\_NEW\_DELETE\_H}}

\end{DoxyCode}
