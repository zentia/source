\doxysection{semaphore.\+h}
\hypertarget{semaphore_8h_source}{}\label{semaphore_8h_source}\index{external/taskflow/3rd-\/party/tbb/src/tbb/semaphore.h@{external/taskflow/3rd-\/party/tbb/src/tbb/semaphore.h}}
\mbox{\hyperlink{semaphore_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ \ \ \ Copyright\ (c)\ 2005-\/2020\ Intel\ Corporation}}
\DoxyCodeLine{00003\ \textcolor{comment}{}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ \ \ \ Licensed\ under\ the\ Apache\ License,\ Version\ 2.0\ (the\ "{}License"{});}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ \ \ \ you\ may\ not\ use\ this\ file\ except\ in\ compliance\ with\ the\ License.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ \ \ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00007\ \textcolor{comment}{}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ \ \ \ \ \ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00009\ \textcolor{comment}{}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ \ \ \ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,\ software}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ \ \ \ distributed\ under\ the\ License\ is\ distributed\ on\ an\ "{}AS\ IS"{}\ BASIS,}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ \ \ \ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY\ KIND,\ either\ express\ or\ implied.}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ \ \ \ See\ the\ License\ for\ the\ specific\ language\ governing\ permissions\ and}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ \ \ \ limitations\ under\ the\ License.}}
\DoxyCodeLine{00015\ \textcolor{comment}{*/}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#ifndef\ \_\_TBB\_tbb\_semaphore\_H}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#define\ \_\_TBB\_tbb\_semaphore\_H}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{external_2taskflow_23rd-party_2tbb_2include_2tbb_2atomic_8h}{tbb/atomic.h}}>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tbb__stddef_8h}{tbb/tbb\_stddef.h}}"{}}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#if\ \_WIN32||\_WIN64}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{windows__api_8h}{tbb/machine/windows\_api.h}}"{}}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#elif\ \_\_APPLE\_\_}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ <mach/semaphore.h>}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ <mach/task.h>}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ <mach/mach\_init.h>}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ <mach/error.h>}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{semaphore_8h}{semaphore.h}}>}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#ifdef\ TBB\_USE\_DEBUG}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ <errno.h>}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\_WIN32||\_WIN64*/}\textcolor{preprocessor}{}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetbb}{tbb}}\ \{}
\DoxyCodeLine{00040\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetbb_1_1internal}{internal}}\ \{}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\#if\ \_WIN32||\_WIN64}}
\DoxyCodeLine{00044\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{namespace_c_l_i_1_1detail_aba10771e3ff645fe1305be4cae517573ac1fabfea54ec6011e694f211f3ffebf3}{LONG}}\ \mbox{\hyperlink{namespacetbb_1_1internal_aebd76633afd75c0d56b4fb69ee8dfb06}{sem\_count\_t}};}
\DoxyCodeLine{00046\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1semaphore}{semaphore}}\ :\ no\_copy\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ max\_semaphore\_cnt\ =\ MAXLONG;}
\DoxyCodeLine{00048\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00050\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a05c4701a0cf9c6f4e2c35a4be1582706}{semaphore}}(\textcolor{keywordtype}{size\_t}\ start\_cnt\_\ =\ 0)\ \{\mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_ad8d750793df6145134e9cb399c5d746d}{init\_semaphore}}(start\_cnt\_);\}}
\DoxyCodeLine{00052\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a4bb4af6dc2e1fc0d01ec2c78e4d58cc3}{\string~semaphore}}()\ \{CloseHandle(\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a804b254b5ab5bcb4bcca8c8e5e14d228}{sem}}\ );\}}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_aa48d61f1792cffc3d2ea15506078e7c0}{P}}()\ \{WaitForSingleObjectEx(\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a804b254b5ab5bcb4bcca8c8e5e14d228}{sem}},\ INFINITE,\ \mbox{\hyperlink{tinycthread_8c_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}}\ );\}}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_ab9d71af0a85d60e19f351be973a983a4}{V}}()\ \{ReleaseSemaphore(\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a804b254b5ab5bcb4bcca8c8e5e14d228}{sem}},\ 1,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );\}}
\DoxyCodeLine{00057\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00058\ \ \ \ \ HANDLE\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a804b254b5ab5bcb4bcca8c8e5e14d228}{sem}};}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_ad8d750793df6145134e9cb399c5d746d}{init\_semaphore}}(\textcolor{keywordtype}{size\_t}\ start\_cnt\_)\ \{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a804b254b5ab5bcb4bcca8c8e5e14d228}{sem}}\ =\ CreateSemaphoreEx(\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \mbox{\hyperlink{namespace_c_l_i_1_1detail_aba10771e3ff645fe1305be4cae517573ac1fabfea54ec6011e694f211f3ffebf3}{LONG}}(start\_cnt\_),\ max\_semaphore\_cnt,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ 0,\ SEMAPHORE\_ALL\_ACCESS\ );}
\DoxyCodeLine{00061\ \ \ \ \ \}}
\DoxyCodeLine{00062\ \};}
\DoxyCodeLine{00063\ \textcolor{preprocessor}{\#elif\ \_\_APPLE\_\_}}
\DoxyCodeLine{00065\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1semaphore}{semaphore}}\ :\ no\_copy\ \{}
\DoxyCodeLine{00066\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00068\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a05c4701a0cf9c6f4e2c35a4be1582706}{semaphore}}(\textcolor{keywordtype}{int}\ start\_cnt\_\ =\ 0)\ :\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a804b254b5ab5bcb4bcca8c8e5e14d228}{sem}}(start\_cnt\_)\ \{\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_ad8d750793df6145134e9cb399c5d746d}{init\_semaphore}}(start\_cnt\_);\ \}}
\DoxyCodeLine{00070\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a4bb4af6dc2e1fc0d01ec2c78e4d58cc3}{\string~semaphore}}()\ \{}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ kern\_return\_t\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}\ =\ semaphore\_destroy(\ mach\_task\_self(),\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a804b254b5ab5bcb4bcca8c8e5e14d228}{sem}}\ );}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a643ae54febb34aa0f2543aa5385a606f}{\_\_TBB\_ASSERT\_EX}}(\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}==err\_none,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00073\ \ \ \ \ \}}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_aa48d61f1792cffc3d2ea15506078e7c0}{P}}()\ \{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}};}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}\ =\ semaphore\_wait(\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a804b254b5ab5bcb4bcca8c8e5e14d228}{sem}}\ );}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}(\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}==KERN\_ABORTED\ );}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}==KERN\_SUCCESS,\ \textcolor{stringliteral}{"{}semaphore\_wait()\ failed"{}}\ );}
\DoxyCodeLine{00081\ \ \ \ \ \}}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_ab9d71af0a85d60e19f351be973a983a4}{V}}()\ \{\ semaphore\_signal(\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a804b254b5ab5bcb4bcca8c8e5e14d228}{sem}}\ );\ \}}
\DoxyCodeLine{00084\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00085\ \ \ \ \ semaphore\_t\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a804b254b5ab5bcb4bcca8c8e5e14d228}{sem}};}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_ad8d750793df6145134e9cb399c5d746d}{init\_semaphore}}(\textcolor{keywordtype}{int}\ start\_cnt\_)\ \{}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ kern\_return\_t\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}\ =\ semaphore\_create(\ mach\_task\_self(),\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a804b254b5ab5bcb4bcca8c8e5e14d228}{sem}},\ SYNC\_POLICY\_FIFO,\ start\_cnt\_\ );}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a643ae54febb34aa0f2543aa5385a606f}{\_\_TBB\_ASSERT\_EX}}(\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}==err\_none,\ \textcolor{stringliteral}{"{}failed\ to\ create\ a\ semaphore"{}}\ );}
\DoxyCodeLine{00089\ \ \ \ \ \}}
\DoxyCodeLine{00090\ \};}
\DoxyCodeLine{00091\ \textcolor{preprocessor}{\#else\ }\textcolor{comment}{/*\ Linux/Unix\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00092\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{eabase_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{namespacetbb_1_1internal_aebd76633afd75c0d56b4fb69ee8dfb06}{sem\_count\_t}};}
\DoxyCodeLine{00094\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classsemaphore_a05c4701a0cf9c6f4e2c35a4be1582706}{semaphore}}\ :\ no\_copy\ \{}
\DoxyCodeLine{00095\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00097\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a05c4701a0cf9c6f4e2c35a4be1582706}{semaphore}}(\textcolor{keywordtype}{int}\ start\_cnt\_\ =\ 0\ )\ \{\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_ad8d750793df6145134e9cb399c5d746d}{init\_semaphore}}(\ start\_cnt\_\ );\ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00100\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a4bb4af6dc2e1fc0d01ec2c78e4d58cc3}{\string~semaphore}}()\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}\ =\ sem\_destroy(\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a804b254b5ab5bcb4bcca8c8e5e14d228}{sem}}\ );}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a643ae54febb34aa0f2543aa5385a606f}{\_\_TBB\_ASSERT\_EX}}(\ !\mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00103\ \ \ \ \ \}}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_aa48d61f1792cffc3d2ea15506078e7c0}{P}}()\ \{}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ sem\_wait(\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a804b254b5ab5bcb4bcca8c8e5e14d228}{sem}}\ )!=0\ )}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ errno==EINTR,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00108\ \ \ \ \ \}}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_ab9d71af0a85d60e19f351be973a983a4}{V}}()\ \{\ sem\_post(\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a804b254b5ab5bcb4bcca8c8e5e14d228}{sem}}\ );\ \}}
\DoxyCodeLine{00111\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00112\ \ \ \ \ sem\_t\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a804b254b5ab5bcb4bcca8c8e5e14d228}{sem}};}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_ad8d750793df6145134e9cb399c5d746d}{init\_semaphore}}(\textcolor{keywordtype}{int}\ start\_cnt\_)\ \{}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}\ =\ sem\_init(\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1semaphore_a804b254b5ab5bcb4bcca8c8e5e14d228}{sem}},\ \textcolor{comment}{/*shared\ among\ threads*/}\ 0,\ start\_cnt\_\ );}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a643ae54febb34aa0f2543aa5385a606f}{\_\_TBB\_ASSERT\_EX}}(\ !\mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00116\ \ \ \ \ \}}
\DoxyCodeLine{00117\ \};}
\DoxyCodeLine{00118\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_WIN32||\_WIN64\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00122\ \textcolor{preprocessor}{\#if\ \_WIN32||\_WIN64}}
\DoxyCodeLine{00123\ \textcolor{preprocessor}{\#if\ !\_\_TBB\_USE\_SRWLOCK}}
\DoxyCodeLine{00125\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore}{binary\_semaphore}}\ :\ no\_copy\ \{}
\DoxyCodeLine{00126\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00128\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a0e81169e37cd223e39e1552268a539ca}{binary\_semaphore}}()\ \{\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}}\ =\ CreateEventEx(\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ 0,\ EVENT\_ALL\_ACCESS\ );\ \ \}}
\DoxyCodeLine{00130\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_ab064e1788cd6a4e15145efe2b2df3f13}{\string~binary\_semaphore}}()\ \{\ CloseHandle(\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}}\ );\ \}}
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_af2248191c45e9442d39805db03cdbb34}{P}}()\ \{\ WaitForSingleObjectEx(\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}},\ INFINITE,\ \mbox{\hyperlink{tinycthread_8c_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}}\ );\ \}}
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a737af267999b3cdf979b1ec26ae71516}{V}}()\ \{\ SetEvent(\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}}\ );\ \}}
\DoxyCodeLine{00135\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00136\ \ \ \ \ HANDLE\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}};}
\DoxyCodeLine{00137\ \};}
\DoxyCodeLine{00138\ \textcolor{preprocessor}{\#else\ }\textcolor{comment}{/*\ \_\_TBB\_USE\_SRWLOCK\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \textcolor{keyword}{union\ }srwl\_or\_handle\ \{}
\DoxyCodeLine{00141\ \ \ \ \ SRWLOCK\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}};}
\DoxyCodeLine{00142\ \ \ \ \ HANDLE\ \ \mbox{\hyperlink{ittnotify__static_8h_ae68700d2ebda197674e2fdd0f916f00c}{h}};}
\DoxyCodeLine{00143\ \};}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00146\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore}{binary\_semaphore}}\ :\ no\_copy\ \{}
\DoxyCodeLine{00147\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00149\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a0e81169e37cd223e39e1552268a539ca}{binary\_semaphore}}();}
\DoxyCodeLine{00151\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_ab064e1788cd6a4e15145efe2b2df3f13}{\string~binary\_semaphore}}();}
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_af2248191c45e9442d39805db03cdbb34}{P}}();}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a737af267999b3cdf979b1ec26ae71516}{V}}();}
\DoxyCodeLine{00156\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00157\ \ \ \ \ srwl\_or\_handle\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}};}
\DoxyCodeLine{00158\ \};}
\DoxyCodeLine{00159\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ !\_\_TBB\_USE\_SRWLOCK\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00160\ \textcolor{preprocessor}{\#elif\ \_\_APPLE\_\_}}
\DoxyCodeLine{00162\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore}{binary\_semaphore}}\ :\ no\_copy\ \{}
\DoxyCodeLine{00163\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00165\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a0e81169e37cd223e39e1552268a539ca}{binary\_semaphore}}()\ :\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}}(0)\ \{}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ kern\_return\_t\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}\ =\ semaphore\_create(\ mach\_task\_self(),\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}},\ SYNC\_POLICY\_FIFO,\ 0\ );}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a643ae54febb34aa0f2543aa5385a606f}{\_\_TBB\_ASSERT\_EX}}(\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}==err\_none,\ \textcolor{stringliteral}{"{}failed\ to\ create\ a\ semaphore"{}}\ );}
\DoxyCodeLine{00168\ \ \ \ \ \}}
\DoxyCodeLine{00170\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_ab064e1788cd6a4e15145efe2b2df3f13}{\string~binary\_semaphore}}()\ \{}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ kern\_return\_t\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}\ =\ semaphore\_destroy(\ mach\_task\_self(),\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}}\ );}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a643ae54febb34aa0f2543aa5385a606f}{\_\_TBB\_ASSERT\_EX}}(\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}==err\_none,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00173\ \ \ \ \ \}}
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_af2248191c45e9442d39805db03cdbb34}{P}}()\ \{}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}};}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}\ =\ semaphore\_wait(\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}}\ );}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}(\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}==KERN\_ABORTED\ );}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}==KERN\_SUCCESS,\ \textcolor{stringliteral}{"{}semaphore\_wait()\ failed"{}}\ );}
\DoxyCodeLine{00181\ \ \ \ \ \}}
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a737af267999b3cdf979b1ec26ae71516}{V}}()\ \{\ semaphore\_signal(\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}}\ );\ \}}
\DoxyCodeLine{00184\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00185\ \ \ \ \ semaphore\_t\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}};}
\DoxyCodeLine{00186\ \};}
\DoxyCodeLine{00187\ \textcolor{preprocessor}{\#else\ }\textcolor{comment}{/*\ Linux/Unix\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \textcolor{preprocessor}{\#if\ \_\_TBB\_USE\_FUTEX}}
\DoxyCodeLine{00190\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore}{binary\_semaphore}}\ :\ no\_copy\ \{}
\DoxyCodeLine{00191\ \textcolor{comment}{//\ The\ implementation\ is\ equivalent\ to\ the\ "{}Mutex,\ Take\ 3"{}\ one}}
\DoxyCodeLine{00192\ \textcolor{comment}{//\ in\ the\ paper\ "{}Futexes\ Are\ Tricky"{}\ by\ Ulrich\ Drepper}}
\DoxyCodeLine{00193\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00195\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a0e81169e37cd223e39e1552268a539ca}{binary\_semaphore}}()\ \{\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}}\ =\ 1;\ \}}
\DoxyCodeLine{00197\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_ab064e1788cd6a4e15145efe2b2df3f13}{\string~binary\_semaphore}}()\ \{\}}
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_af2248191c45e9442d39805db03cdbb34}{P}}()\ \{}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}};}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ (\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}}.compare\_and\_swap(\ 1,\ 0\ ))!=0\ )\ \{}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}!=2\ )}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}}.fetch\_and\_store(\ 2\ );}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}!=0\ )\ \{\ \textcolor{comment}{//\ This\ loop\ deals\ with\ spurious\ wakeup}}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ futex\_wait(\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}},\ 2\ );}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}}.fetch\_and\_store(\ 2\ );}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00209\ \ \ \ \ \}}
\DoxyCodeLine{00211\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a737af267999b3cdf979b1ec26ae71516}{V}}()\ \{}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}}>=1,\ \textcolor{stringliteral}{"{}multiple\ V()'s\ in\ a\ row?"{}}\ );}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}}.fetch\_and\_store(\ 0\ )==2\ )}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ futex\_wakeup\_one(\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}}\ );}
\DoxyCodeLine{00215\ \ \ \ \ \}}
\DoxyCodeLine{00216\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00217\ \ \ \ \ \mbox{\hyperlink{sugar_8h_a48f1c51623545bd4f58fbab2fa6091d0}{atomic<int>}}\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}};\ \textcolor{comment}{//\ 0\ -\/\ open;\ 1\ -\/\ closed,\ no\ waits;\ 2\ -\/\ closed,\ possible\ waits}}
\DoxyCodeLine{00218\ \};}
\DoxyCodeLine{00219\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00220\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{eabase_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{namespacetbb_1_1internal_aebd76633afd75c0d56b4fb69ee8dfb06}{sem\_count\_t}};}
\DoxyCodeLine{00222\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a0e81169e37cd223e39e1552268a539ca}{binary\_semaphore}}\ :\ no\_copy\ \{}
\DoxyCodeLine{00223\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00225\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a0e81169e37cd223e39e1552268a539ca}{binary\_semaphore}}()\ \{}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}\ =\ sem\_init(\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}},\ \textcolor{comment}{/*shared\ among\ threads*/}\ 0,\ 0\ );}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a643ae54febb34aa0f2543aa5385a606f}{\_\_TBB\_ASSERT\_EX}}(\ !\mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00228\ \ \ \ \ \}}
\DoxyCodeLine{00230\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_ab064e1788cd6a4e15145efe2b2df3f13}{\string~binary\_semaphore}}()\ \{}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}\ =\ sem\_destroy(\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}}\ );}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a643ae54febb34aa0f2543aa5385a606f}{\_\_TBB\_ASSERT\_EX}}(\ !\mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00233\ \ \ \ \ \}}
\DoxyCodeLine{00235\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_af2248191c45e9442d39805db03cdbb34}{P}}()\ \{}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ sem\_wait(\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}}\ )!=0\ )}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ errno==EINTR,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00238\ \ \ \ \ \}}
\DoxyCodeLine{00240\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a737af267999b3cdf979b1ec26ae71516}{V}}()\ \{\ sem\_post(\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}}\ );\ \}}
\DoxyCodeLine{00241\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00242\ \ \ \ \ sem\_t\ \mbox{\hyperlink{classtbb_1_1internal_1_1binary__semaphore_a2be50e14ae4ed34a61efdb867aacfdf6}{my\_sem}};}
\DoxyCodeLine{00243\ \};}
\DoxyCodeLine{00244\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_USE\_FUTEX\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00245\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_WIN32||\_WIN64\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ \}\ \textcolor{comment}{//\ namespace\ internal}}
\DoxyCodeLine{00248\ \}\ \textcolor{comment}{//\ namespace\ tbb}}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00250\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_tbb\_semaphore\_H\ */}\textcolor{preprocessor}{}}

\end{DoxyCode}
