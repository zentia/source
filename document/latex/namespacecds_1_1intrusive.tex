\doxysection{cds\+::intrusive 命名空间参考}
\hypertarget{namespacecds_1_1intrusive}{}\label{namespacecds_1_1intrusive}\index{cds::intrusive@{cds::intrusive}}


Intrusive containers  


\doxysubsubsection*{命名空间}
\begin{DoxyCompactItemize}
\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1basket__queue}{basket\+\_\+queue}}
\begin{DoxyCompactList}\small\item\em \doxylink{classcds_1_1intrusive_1_1_basket_queue}{Basket\+Queue} -\/related definitions \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1cuckoo}{cuckoo}}
\begin{DoxyCompactList}\small\item\em Cuckoo\+Set-\/related definitions \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1ellen__bintree}{ellen\+\_\+bintree}}
\begin{DoxyCompactList}\small\item\em \doxylink{classcds_1_1intrusive_1_1_ellen_bin_tree}{Ellen\+Bin\+Tree} related declarations \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1fcqueue}{fcqueue}}
\begin{DoxyCompactList}\small\item\em {\ttfamily \doxylink{classcds_1_1intrusive_1_1_f_c_queue}{FCQueue}} related definitions \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1fcstack}{fcstack}}
\begin{DoxyCompactList}\small\item\em \doxylink{classcds_1_1intrusive_1_1_f_c_stack}{FCStack} related definitions \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1feldman__hashset}{feldman\+\_\+hashset}}
\begin{DoxyCompactList}\small\item\em \doxylink{classcds_1_1intrusive_1_1_feldman_hash_set}{Feldman\+Hash\+Set} related definitions \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1iterable__list}{iterable\+\_\+list}}
\begin{DoxyCompactList}\small\item\em {\ttfamily \doxylink{classcds_1_1intrusive_1_1_iterable_list}{Iterable\+List}} ordered list related definitions \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1lazy__list}{lazy\+\_\+list}}
\begin{DoxyCompactList}\small\item\em \doxylink{classcds_1_1intrusive_1_1_lazy_list}{Lazy\+List} ordered list related definitions \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1michael__list}{michael\+\_\+list}}
\begin{DoxyCompactList}\small\item\em \doxylink{classcds_1_1intrusive_1_1_michael_list}{Michael\+List} ordered list related definitions \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1michael__set}{michael\+\_\+set}}
\begin{DoxyCompactList}\small\item\em \doxylink{classcds_1_1intrusive_1_1_michael_hash_set}{Michael\+Hash\+Set} related definitions \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1mspriority__queue}{mspriority\+\_\+queue}}
\begin{DoxyCompactList}\small\item\em \doxylink{classcds_1_1intrusive_1_1_m_s_priority_queue}{MSPriority\+Queue} related definitions \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1msqueue}{msqueue}}
\begin{DoxyCompactList}\small\item\em \doxylink{classcds_1_1intrusive_1_1_m_s_queue}{MSQueue} related definitions \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1opt}{opt}}
\begin{DoxyCompactList}\small\item\em Common options for intrusive containers \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1optimistic__queue}{optimistic\+\_\+queue}}
\begin{DoxyCompactList}\small\item\em {\ttfamily \doxylink{classcds_1_1intrusive_1_1_optimistic_queue}{Optimistic\+Queue}} related definitions \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1segmented__queue}{segmented\+\_\+queue}}
\begin{DoxyCompactList}\small\item\em \doxylink{classcds_1_1intrusive_1_1_segmented_queue}{Segmented\+Queue} -\/related declarations \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1single__link}{single\+\_\+link}}
\begin{DoxyCompactList}\small\item\em Definitions common for single-\/linked data structures \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1skip__list}{skip\+\_\+list}}
\begin{DoxyCompactList}\small\item\em \doxylink{classcds_1_1intrusive_1_1_skip_list_set}{Skip\+List\+Set} related definitions \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1split__list}{split\+\_\+list}}
\begin{DoxyCompactList}\small\item\em Split-\/ordered list related definitions \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1striped__set}{striped\+\_\+set}}
\begin{DoxyCompactList}\small\item\em \doxylink{classcds_1_1intrusive_1_1_striped_set}{Striped\+Set} related definitions \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1treiber__stack}{treiber\+\_\+stack}}
\begin{DoxyCompactList}\small\item\em \doxylink{classcds_1_1intrusive_1_1_treiber_stack}{Treiber\+Stack} related definitions \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacecds_1_1intrusive_1_1vyukov__queue}{vyukov\+\_\+queue}}
\begin{DoxyCompactList}\small\item\em \doxylink{classcds_1_1intrusive_1_1_vyukov_m_p_m_c_cycle_queue}{Vyukov\+MPMCCycle\+Queue} related definitions \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{类}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_basket_queue}{Basket\+Queue}}
\begin{DoxyCompactList}\small\item\em Basket lock-\/free queue (intrusive variant) \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_cached_free_list}{Cached\+Free\+List}}
\begin{DoxyCompactList}\small\item\em Cached free list \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_cuckoo_set}{Cuckoo\+Set}}
\begin{DoxyCompactList}\small\item\em Cuckoo hash set \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_ellen_bin_tree}{Ellen\+Bin\+Tree}}
\begin{DoxyCompactList}\small\item\em Ellen\textquotesingle{}s et al binary search tree \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_ellen_bin_tree_3_01cds_1_1urcu_1_1gc_3_01_r_c_u_01_4_00_01_key_00_01_t_00_01_traits_01_4}{Ellen\+Bin\+Tree$<$ cds\+::urcu\+::gc$<$ RCU $>$, Key, T, Traits $>$}}
\begin{DoxyCompactList}\small\item\em Ellen\textquotesingle{}s et al binary search tree (RCU specialization) \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_f_c_queue}{FCQueue}}
\begin{DoxyCompactList}\small\item\em Flat-\/combining intrusive queue \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_f_c_stack}{FCStack}}
\begin{DoxyCompactList}\small\item\em Flat-\/combining intrusive stack \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_feldman_hash_set}{Feldman\+Hash\+Set}}
\begin{DoxyCompactList}\small\item\em Intrusive hash set based on multi-\/level array \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_feldman_hash_set_3_01cds_1_1urcu_1_1gc_3_01_r_c_u_01_4_00_01_t_00_01_traits_01_4}{Feldman\+Hash\+Set$<$ cds\+::urcu\+::gc$<$ RCU $>$, T, Traits $>$}}
\begin{DoxyCompactList}\small\item\em Intrusive hash set based on multi-\/level array, \doxylink{namespacecds_1_1urcu_cds_urcu_desc}{RCU} specialization \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_free_list}{Free\+List}}
\begin{DoxyCompactList}\small\item\em Lock-\/free free list \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{structcds_1_1intrusive_1_1get__node__traits}{get\+\_\+node\+\_\+traits}}
\begin{DoxyCompactList}\small\item\em \doxylink{class_node}{Node} traits selector metafunction \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_iterable_list}{Iterable\+List}}
\begin{DoxyCompactList}\small\item\em Iterable lock-\/free ordered single-\/linked list \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_lazy_list}{Lazy\+List}}
\begin{DoxyCompactList}\small\item\em Lazy ordered single-\/linked list \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_lazy_list_3_01cds_1_1urcu_1_1gc_3_01_r_c_u_01_4_00_01_t_00_01_traits_01_4}{Lazy\+List$<$ cds\+::urcu\+::gc$<$ RCU $>$, T, Traits $>$}}
\begin{DoxyCompactList}\small\item\em Lazy ordered single-\/linked list (template specialization for \doxylink{namespacecds_1_1urcu_cds_urcu_desc}{RCU}) \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_lazy_list_3_01gc_1_1nogc_00_01_t_00_01_traits_01_4}{Lazy\+List$<$ gc\+::nogc, T, Traits $>$}}
\begin{DoxyCompactList}\small\item\em Lazy single-\/linked list (template specialization for {\ttfamily \doxylink{classcds_1_1gc_1_1nogc}{gc\+::nogc}}) \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_michael_hash_set}{Michael\+Hash\+Set}}
\begin{DoxyCompactList}\small\item\em Michael\textquotesingle{}s hash set \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_michael_hash_set_3_01cds_1_1gc_1_1nogc_00_01_ordered_list_00_01_traits_01_4}{Michael\+Hash\+Set$<$ cds\+::gc\+::nogc, Ordered\+List, Traits $>$}}
\begin{DoxyCompactList}\small\item\em Michael\textquotesingle{}s hash set (template specialization for \doxylink{classcds_1_1gc_1_1nogc}{gc\+::nogc}) \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_michael_hash_set_3_01cds_1_1urcu_1_1gc_3_01_r_c_u_01_4_00_01_ordered_list_00_01_traits_01_4}{Michael\+Hash\+Set$<$ cds\+::urcu\+::gc$<$ RCU $>$, Ordered\+List, Traits $>$}}
\begin{DoxyCompactList}\small\item\em Michael\textquotesingle{}s hash set, \doxylink{namespacecds_1_1urcu_cds_urcu_desc}{RCU} specialization \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_michael_list}{Michael\+List}}
\begin{DoxyCompactList}\small\item\em Michael\textquotesingle{}s lock-\/free ordered single-\/linked list \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_michael_list_3_01cds_1_1urcu_1_1gc_3_01_r_c_u_01_4_00_01_t_00_01_traits_01_4}{Michael\+List$<$ cds\+::urcu\+::gc$<$ RCU $>$, T, Traits $>$}}
\begin{DoxyCompactList}\small\item\em Michael\textquotesingle{}s lock-\/free ordered single-\/linked list (template specialization for \doxylink{namespacecds_1_1urcu_cds_urcu_desc}{RCU}) \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_michael_list_3_01gc_1_1nogc_00_01_t_00_01_traits_01_4}{Michael\+List$<$ gc\+::nogc, T, Traits $>$}}
\begin{DoxyCompactList}\small\item\em Michael\textquotesingle{}s lock-\/free ordered single-\/linked list (template specialization for \doxylink{classcds_1_1gc_1_1nogc}{gc\+::nogc}) \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_moir_queue}{Moir\+Queue}}
\begin{DoxyCompactList}\small\item\em \doxylink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A} variation of Michael \& Scott\textquotesingle{}s lock-\/free queue (intrusive variant) \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_m_s_priority_queue}{MSPriority\+Queue}}
\begin{DoxyCompactList}\small\item\em Michael \& Scott array-\/based lock-\/based concurrent priority queue heap \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_m_s_queue}{MSQueue}}
\begin{DoxyCompactList}\small\item\em Michael \& Scott\textquotesingle{}s intrusive lock-\/free queue \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{structcds_1_1intrusive_1_1node__traits}{node\+\_\+traits}}
\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_optimistic_queue}{Optimistic\+Queue}}
\begin{DoxyCompactList}\small\item\em Optimistic intruive lock-\/free queue \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_segmented_queue}{Segmented\+Queue}}
\begin{DoxyCompactList}\small\item\em Segmented queue \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_skip_list_set}{Skip\+List\+Set}}
\begin{DoxyCompactList}\small\item\em Lock-\/free skip-\/list set \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_skip_list_set_3_01cds_1_1gc_1_1nogc_00_01_t_00_01_traits_01_4}{Skip\+List\+Set$<$ cds\+::gc\+::nogc, T, Traits $>$}}
\begin{DoxyCompactList}\small\item\em Lock-\/free skip-\/list set (template specialization for \doxylink{classcds_1_1gc_1_1nogc}{gc\+::nogc}) \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_skip_list_set_3_01cds_1_1urcu_1_1gc_3_01_r_c_u_01_4_00_01_t_00_01_traits_01_4}{Skip\+List\+Set$<$ cds\+::urcu\+::gc$<$ RCU $>$, T, Traits $>$}}
\begin{DoxyCompactList}\small\item\em Lock-\/free skip-\/list set (template specialization for \doxylink{namespacecds_1_1urcu_cds_urcu_desc}{RCU}) \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_split_list_set}{Split\+List\+Set}}
\begin{DoxyCompactList}\small\item\em Split-\/ordered list \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_split_list_set_3_01cds_1_1gc_1_1nogc_00_01_ordered_list_00_01_traits_01_4}{Split\+List\+Set$<$ cds\+::gc\+::nogc, Ordered\+List, Traits $>$}}
\begin{DoxyCompactList}\small\item\em Split-\/ordered list (template specialization for \doxylink{classcds_1_1gc_1_1nogc}{gc\+::nogc}) \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_split_list_set_3_01cds_1_1urcu_1_1gc_3_01_r_c_u_01_4_00_01_ordered_list_00_01_traits_01_4}{Split\+List\+Set$<$ cds\+::urcu\+::gc$<$ RCU $>$, Ordered\+List, Traits $>$}}
\begin{DoxyCompactList}\small\item\em Split-\/ordered list RCU specialization \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_striped_set}{Striped\+Set}}
\begin{DoxyCompactList}\small\item\em Striped hash set \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_tagged_free_list}{Tagged\+Free\+List}}
\begin{DoxyCompactList}\small\item\em Lock-\/free free list based on tagged pointers (required double-\/width CAS) \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_treiber_stack}{Treiber\+Stack}}
\begin{DoxyCompactList}\small\item\em Treiber intrusive stack \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1intrusive_1_1_vyukov_m_p_m_c_cycle_queue}{Vyukov\+MPMCCycle\+Queue}}
\begin{DoxyCompactList}\small\item\em Vyukov\textquotesingle{}s MPMC bounded queue \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{详细描述}
Intrusive containers 

The namespace {\ttfamily \doxylink{namespacecds_1_1intrusive}{cds\+::intrusive}} contains intrusive lock-\/free containers. The idea comes from {\ttfamily boost\+::intrusive} library, see \href{http://boost.org/doc/}{\texttt{ http\+://boost.\+org/doc/}} as a good introduction to intrusive approach. The intrusive containers of libcds library is developed as close to {\ttfamily boost\+::intrusive} 

In terms of lock-\/free approach, the main advantage of intrusive containers is that no memory allocation is performed to maintain container elements. However, additional requirements are imposed for types and values that can be stored in intrusive container. See the container documentation for details.

\label{namespacecds_1_1intrusive_cds_intrusive_hook_tag}%
\Hypertarget{namespacecds_1_1intrusive_cds_intrusive_hook_tag}%
\begin{DoxyParagraph}{Tags}
Many hooks and nodes for intrusive containers contain template argument {\ttfamily Tag}. This argument serves as a tag, so you can derive from more than one container\textquotesingle{}s node and hence put an object in multiple intrusive containers at the same time. An incomplete type can serve as a tag. If you specify two hooks, you must specify a different tag for each one. Example\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{struct\ }tag1;}
\DoxyCodeLine{\mbox{\hyperlink{namespacecds_1_1intrusive_1_1treiber__stack_a85584c428a6759dd94a1f337a5c7d2b4}{cds::intrusive::treiber\_stack::node<\ cds::gc::HP,\ tag<tag1>}}\ >}

\end{DoxyCode}
 If no tag is specified the default {\ttfamily \doxylink{structcds_1_1opt_1_1none}{cds\+::opt\+::none}} will be used.
\end{DoxyParagraph}
\label{namespacecds_1_1intrusive_cds_intrusive_item_creating}%
\Hypertarget{namespacecds_1_1intrusive_cds_intrusive_item_creating}%
\begin{DoxyParagraph}{Inserting items}
Many intrusive and non-\/intrusive (standard-\/like) containers in the library have the member functions that take a functor argument to initialize the inserted item after it has been successfully inserted, for example\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Q,\ \textcolor{keyword}{typename}\ Func>}
\DoxyCodeLine{\textcolor{keywordtype}{bool}\ \mbox{\hyperlink{_sparse_matrix__coeffs_8cpp_ab35a6a022462a2c6584f51173eb05af6}{insert}}(\ \mbox{\hyperlink{_householder_q_r__householder_q_8cpp_a7e56035a736d269ad670f312496a0846}{Q}}\&\ \mbox{\hyperlink{ittnotify__static_8h_aeeaf6235e69da2907f537f67e598fc9d}{key}},\ Func\ \mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}}\ );}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Q,\ \textcolor{keyword}{typename}\ Func>}
\DoxyCodeLine{std::pair<bool,\ bool>\ update(\ \mbox{\hyperlink{_householder_q_r__householder_q_8cpp_a7e56035a736d269ad670f312496a0846}{Q}}\&\ \mbox{\hyperlink{ittnotify__static_8h_aeeaf6235e69da2907f537f67e598fc9d}{key}},\ Func\ \mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}},\ \textcolor{keywordtype}{bool}\ bAllowInsert\ =\ \textcolor{keyword}{true}\ );}

\end{DoxyCode}
 The first member function calls {\ttfamily f} functor iif a new item has been inserted. The functor takes two parameter\+: a reference to inserted item and {\ttfamily key}.
\end{DoxyParagraph}
The second member function, {\ttfamily update()}, allows to insert a new item to the container if {\ttfamily key} is not found, or to find the item with {\ttfamily key} and to perform some action with it. The {\ttfamily f} signature is\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}}(\ \textcolor{keywordtype}{bool}\ bNew,\ item\_type\&\ item,\ \mbox{\hyperlink{_householder_q_r__householder_q_8cpp_a7e56035a736d269ad670f312496a0846}{Q}}\&\ \mbox{\hyperlink{ittnotify__static_8h_aeeaf6235e69da2907f537f67e598fc9d}{key}}\ );}

\end{DoxyCode}
 where {\ttfamily b\+New} is a flag to indicate whether {\ttfamily item} is a new created node or not.

Such functions should be used with caution in multi-\/threaded environment since they can cause races. The library does not synchronize access to container\textquotesingle{}s items, so many threads can access to one item simultaneously. For example, for {\ttfamily insert} member function the following race is possible\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ Suppose,\ Foo\ is\ a\ complex\ structure\ with\ int\ key\ field}}
\DoxyCodeLine{SomeContainer<Foo>\ \mbox{\hyperlink{som__graph_8cpp_ae900b2add8deca663438fb20de69acce}{q}};}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{struct_thread}{Thread}}\ 1\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_thread}{Thread}}\ 2}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{som__graph_8cpp_ae900b2add8deca663438fb20de69acce}{q}}.insert(\ \mbox{\hyperlink{namespace_foo}{Foo}}(5),\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{som__graph_8cpp_ae900b2add8deca663438fb20de69acce}{q}}.find(\ 5,\ [](\ \mbox{\hyperlink{namespace_foo}{Foo}}\&\ item\ )\ \{}
\DoxyCodeLine{\ \ \ \ [](\ Foo\&\ item\ )\{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ access\ to\ item\ fields}}
\DoxyCodeLine{\ \ \ \ \ \ \ \textcolor{comment}{//\ complex\ initialization\ \ \ \ \ \ \ \ \ \ \ \ \ ...}}
\DoxyCodeLine{\ \ \ \ \ \ \ item.f1\ =\ ...;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\ \ \ \ \ \ \ ...}
\DoxyCodeLine{\ \ \ \ \});}

\end{DoxyCode}
 Execute sequence\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{struct_find}{Find}}\ 5\ in\ the\ \mbox{\hyperlink{namespacecds_1_1container}{container}}.}
\DoxyCodeLine{Key\ 5\ is\ not\ found}
\DoxyCodeLine{Create\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ \textcolor{keyword}{new}\ item\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_find}{Find}}\ \mbox{\hyperlink{ittnotify__static_8h_aeeaf6235e69da2907f537f67e598fc9d}{key}}\ 5}
\DoxyCodeLine{\ \ \ \ with\ calling\ \mbox{\hyperlink{namespace_foo}{Foo}}(5)\ ctor}
\DoxyCodeLine{\mbox{\hyperlink{struct_insert}{Insert}}\ the\ new\ item}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ The\ \mbox{\hyperlink{ittnotify__static_8h_aeeaf6235e69da2907f537f67e598fc9d}{key}}\ 5\ is\ found\ -\/}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ call\ the\ functor\ \ \ \ \ (!)}
\DoxyCodeLine{Perform\ \mbox{\hyperlink{structcomplex}{complex}}}
\DoxyCodeLine{\ \ \ initialization\ -\/}
\DoxyCodeLine{\ \ \ call\ the\ functor}

\end{DoxyCode}
 (!)\+: \doxylink{struct_thread}{Thread} 2 found the key and call its functor on incomplete initialized item. Simultaneous access to the item also is possible. In this case \doxylink{struct_thread}{Thread} 1 is initializing the item, thread 2 is reading (or writing) the item\textquotesingle{}s fields. In any case, \doxylink{struct_thread}{Thread} 2 can read uninitialized or incomplete initialized fields.

{\ttfamily update()} member function race. Suppose, thread 1 and thread 2 perform the following code\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{som__graph_8cpp_ae900b2add8deca663438fb20de69acce}{q}}.update(\ 5,\ [](\ \textcolor{keywordtype}{bool}\ bNew,\ \mbox{\hyperlink{namespace_foo}{Foo}}\&\ item,\ \textcolor{keywordtype}{int}\ \ \mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}}\ )}
\DoxyCodeLine{\ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \textcolor{comment}{//\ bNew:\ true\ if\ the\ new\ element\ has\ been\ created}}
\DoxyCodeLine{\ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ false\ otherwise}}
\DoxyCodeLine{\ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ bNew\ )\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ initialize\ item}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ item.f1=...;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \textcolor{comment}{//...}}
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ do\ some\ work}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !item.f1\ )}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ item.f1\ =\ ...;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//...}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \textcolor{comment}{//...}}
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \}}
\DoxyCodeLine{);}

\end{DoxyCode}
 Execute sequence\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{struct_thread}{Thread}}\ 1\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_thread}{Thread}}\ 2}
\DoxyCodeLine{\mbox{\hyperlink{ittnotify__static_8h_aeeaf6235e69da2907f537f67e598fc9d}{key}}\ 5\ not\ found}
\DoxyCodeLine{\mbox{\hyperlink{_sparse_matrix__coeffs_8cpp_ab35a6a022462a2c6584f51173eb05af6}{insert}}\ \textcolor{keyword}{new}\ item\ \mbox{\hyperlink{namespace_foo}{Foo}}(5)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_find}{Find}}\ 5}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Key\ 5\ found}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ call\ the\ functor\ with}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bNew\ =\ \mbox{\hyperlink{yyjson_8h_a65e9886d74aaee76545e83dd09011727}{false}}\ \ \ \ \ \ \ \ (!)}
\DoxyCodeLine{call\ the\ functor\ with}
\DoxyCodeLine{\ \ \ bNew\ =\ \mbox{\hyperlink{yyjson_8h_a41f9c5fb8b08eb5dc3edce4dcb37fee7}{true}}}

\end{DoxyCode}
 (!)\+: \doxylink{struct_thread}{Thread} 2 executes its functor on incomplete initialized item.

To protect your code from such races you can use some item-\/level synchronization, for example\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{struct\ }\mbox{\hyperlink{namespace_foo}{Foo}}\ \{}
\DoxyCodeLine{\ \ \ spinlock\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}};\ \ \ \ \ \ \ \textcolor{comment}{//\ item-\/level\ lock}}
\DoxyCodeLine{\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{_open_g_l_view_8m_a3fc86b118a59fbc63f6be3c1293300ff}{initialized}}\ =\ \textcolor{keyword}{false};\ \ \ \ \textcolor{comment}{//\ initialization\ flag}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ other\ fields}}
\DoxyCodeLine{\ \ \ \textcolor{comment}{//\ ....}}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{som__graph_8cpp_ae900b2add8deca663438fb20de69acce}{q}}.update(\ 5,\ [](\ \textcolor{keywordtype}{bool}\ bNew,\ \mbox{\hyperlink{namespace_foo}{Foo}}\&\ item,\ \textcolor{keywordtype}{int}\ \ \mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}}\ )}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Lock\ access\ to\ the\ item}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ std::unique\_lock(\ item.lock\ );}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !item.initialized\ )\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ initialize\ item}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ item.f1=...;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//...}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ item.initialized\ =\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ mark\ the\ item\ as\ initialized}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ do\ some\ work}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !item.f1\ )}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ item.f1\ =\ ...;}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//...}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//...}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{);}

\end{DoxyCode}
 If the item-\/level synchronization is not suitable, you should not use any inserting member function with post-\/insert functor argument.

\label{namespacecds_1_1intrusive_cds_intrusive_item_destroying}%
\Hypertarget{namespacecds_1_1intrusive_cds_intrusive_item_destroying}%
\begin{DoxyParagraph}{Destroying items}

\end{DoxyParagraph}
It should be very careful when destroying an item removed from intrusive container. In other threads the references to popped item may exists some time after removing. To destroy the removed item in thread-\/safe manner you should call static function {\ttfamily retire} of garbage collector you use, for example\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{struct\ }destroyer\ \ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{void}\ operator\ ()(\ \mbox{\hyperlink{structmy__type}{my\_type}}\ *\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ )}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}};}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{typedef}\ \mbox{\hyperlink{classcds_1_1intrusive_1_1_treiber_stack}{cds::intrusive::TreiberStack<\ cds::gc::HP,\ my\_type,\ cds::opt::disposer<\ destroyer\ >}}\ >\ \mbox{\hyperlink{namespacestack}{stack}};}
\DoxyCodeLine{\mbox{\hyperlink{namespacestack}{stack}}\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ ....}}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{structmy__type}{my\_type}}\ *\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}.pop();}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ )\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ It\ is\ wrong}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ delete\ p;}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ It\ is\ correct}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{namespacecds_1_1gc}{cds::gc}}:HP::retire<\ destroyer\ >(\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ );}
\DoxyCodeLine{\}}

\end{DoxyCode}
 The situation becomes even more complicated when you want store items in different intrusive containers. In this case the best way is using reference counting\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{struct\ }\mbox{\hyperlink{structmy__type}{my\_type}}\ \{}
\DoxyCodeLine{\ \ \ \ ...}
\DoxyCodeLine{\ \ \ \ std::atomic<unsigned\ int>\ nRefCount;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{time__split__node_8cpp_ac7d42ca9867b385e4bd85e57929bd9be}{my\_type}}()}
\DoxyCodeLine{\ \ \ \ \ \ \ \ :\ nRefCount(0)}
\DoxyCodeLine{\ \ \ \ \{\}}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{struct\ }destroyer\ \ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{void}\ operator\ ()(\ \mbox{\hyperlink{structmy__type}{my\_type}}\ *\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ )}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ -\/-\/\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}-\/>nRefCount\ ==\ 0\ )}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ \ \ \ ;\ \ \ \textcolor{comment}{//\ delete\ only\ after\ no\ reference\ pointing\ to\ p}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{typedef}\ cds::intrusive::TreiberStack<\ cds::gc::HP,\ my\_type,\ cds::opt::disposer<\ destroyer\ >\ >\ \mbox{\hyperlink{namespaceluisa_aac116168b3a7f5580f82d7da42bd1c42}{stack}};}
\DoxyCodeLine{\textcolor{keyword}{typedef}\ cds::intrusive::MSQueue<\ cds::gc::HP,\ my\_type,\ cds::opt::disposer<\ destroyer\ >\ >\ \mbox{\hyperlink{namespaceluisa_aa1eb922874c2e5b0b13f4fc9a37747eb}{queue}};}
\DoxyCodeLine{\mbox{\hyperlink{namespaceluisa_aac116168b3a7f5580f82d7da42bd1c42}{stack}}\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}};}
\DoxyCodeLine{\mbox{\hyperlink{namespaceluisa_aa1eb922874c2e5b0b13f4fc9a37747eb}{queue}}\ \mbox{\hyperlink{som__graph_8cpp_ae900b2add8deca663438fb20de69acce}{q}};}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{time__split__node_8cpp_ac7d42ca9867b385e4bd85e57929bd9be}{my\_type}}\ *\ \mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}}\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{time__split__node_8cpp_ac7d42ca9867b385e4bd85e57929bd9be}{my\_type}}();}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}}.nRefCount++\ \ \ ;\ \textcolor{comment}{//\ increment\ counter\ before\ pushing\ the\ item\ to\ the\ stack}}
\DoxyCodeLine{\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}.push(\mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}});}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}}.nRefCount++\ \ \ ;\ \textcolor{comment}{//\ increment\ counter\ before\ pushing\ the\ item\ to\ the\ queue}}
\DoxyCodeLine{\mbox{\hyperlink{som__graph_8cpp_ae900b2add8deca663438fb20de69acce}{q}}.push(\mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ ....}}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{time__split__node_8cpp_ac7d42ca9867b385e4bd85e57929bd9be}{my\_type}}\ *\ \mbox{\hyperlink{level1__cplx__impl_8h_a6280e894a2fd5ef320bda62ca65dcb3f}{ps}}\ =\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}.pop();}
\DoxyCodeLine{\textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{level1__cplx__impl_8h_a6280e894a2fd5ef320bda62ca65dcb3f}{ps}}\ )\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ It\ is\ wrong}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ delete\ ps;}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ It\ is\ correct}}
\DoxyCodeLine{\ \ \ \ cds::gc:HP::retire<\ destroyer\ >(\ \mbox{\hyperlink{level1__cplx__impl_8h_a6280e894a2fd5ef320bda62ca65dcb3f}{ps}}\ );}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{time__split__node_8cpp_ac7d42ca9867b385e4bd85e57929bd9be}{my\_type}}\ *\ pq\ =\ \mbox{\hyperlink{som__graph_8cpp_ae900b2add8deca663438fb20de69acce}{q}}.pop();}
\DoxyCodeLine{\textcolor{keywordflow}{if}\ (\ pq\ )\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ It\ is\ wrong}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ delete\ pq;}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ It\ is\ correct}}
\DoxyCodeLine{\ \ \ \ cds::gc:HP::retire<\ destroyer\ >(\ pq\ );}
\DoxyCodeLine{\}}

\end{DoxyCode}
 Violation of these rules may lead to a crash.

\begin{DoxyParagraph}{Intrusive containers and Hazard Pointer-\/like garbage collectors}

\end{DoxyParagraph}
If you develop your intrusive container based on {\bfseries{libcds}} library framework, you should take in the account the following. The main idea of garbage collectors (GC) based on Hazard Pointer schema is protecting a shared pointer by publishing it as a "{}hazard"{} i.\+e. as a pointer that is changing at the current time and cannot be deleted at this moment. In intrusive container paradigm, the pointer to a node of the container and the pointer to a item stored in the container are not equal in the general case. However, any pointer to node should be castable to appropriate pointer to container\textquotesingle{}s item. In general, any item can be placed to two or more intrusive containers simultaneously, and each of those container holds an unique pointer to its node that refers to the same item. When we protect a pointer, we want to protect an {\bfseries{item}} pointer that is the invariant for any container stored that item. In your intrusive container, instead of protecting by GC\textquotesingle{}s guard a pointer to node you should cast it to the pointer to item and then protect that item pointer. Otherwise an unpredictable result may occur. 