\doxysection{raster\+\_\+func.\+h}
\hypertarget{raster__func_8h_source}{}\label{raster__func_8h_source}\index{runtime/dsl/raster/raster\_func.h@{runtime/dsl/raster/raster\_func.h}}
\mbox{\hyperlink{raster__func_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#include\ <luisa/dsl/func.h>}}
\DoxyCodeLine{00003\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceluisa_1_1compute}{luisa::compute}}\ \{}
\DoxyCodeLine{00005\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00006\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classluisa_1_1compute_1_1_raster_stage_kernel}{RasterStageKernel}}\ \{}
\DoxyCodeLine{00007\ \ \ \ \ \textcolor{keyword}{static\_assert}(\mbox{\hyperlink{namespaceluisa_a8c7f286c84142da9a0aca4e38c58ce59}{always\_false\_v<T>}});}
\DoxyCodeLine{00008\ \};}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00011\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structluisa_1_1compute_1_1is__callable}{is\_callable}}<\mbox{\hyperlink{classluisa_1_1compute_1_1_raster_stage_kernel}{RasterStageKernel}}<T>>\ :\ std::true\_type\ \{\};}
\DoxyCodeLine{00013\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Ret,\ \textcolor{keyword}{typename}...\ Args>}
\DoxyCodeLine{00014\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classluisa_1_1compute_1_1_raster_stage_kernel_3_01_ret_07_args_8_8_8_08_4_a9cd625ba23164c25ac2accb454032a8b}{RasterStageKernel}}<Ret(Args...)>\ \{}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \ \ \ \ \textcolor{keyword}{static\_assert}(}
\DoxyCodeLine{00017\ \ \ \ \ \ \ \ \ std::negation\_v<std::disjunction<}
\DoxyCodeLine{00018\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceluisa_1_1compute_a69d17058a48672238761312efa8b0cc0}{is\_buffer\_or\_view<Ret>}},}
\DoxyCodeLine{00019\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceluisa_1_1compute_a82d9145ca7320434770104a12f5a8419}{is\_image\_or\_view<Ret>}},}
\DoxyCodeLine{00020\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceluisa_1_1compute_afc7651bc29bcd511771dcc53c37d5a1a}{is\_volume\_or\_view<Ret>}}>>,}
\DoxyCodeLine{00021\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Callables\ may\ not\ return\ buffers,\ "{}}}
\DoxyCodeLine{00022\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}images\ or\ volumes\ (or\ their\ views)."{}});}
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{keyword}{static\_assert}(std::negation\_v<std::disjunction<std::is\_pointer<Args>...>>);}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00026\ \ \ \ \ luisa::shared\_ptr<const\ detail::FunctionBuilder>\ \mbox{\hyperlink{classluisa_1_1compute_1_1_raster_stage_kernel_3_01_ret_07_args_8_8_8_08_4_a8bdd1d60b168d9d77915debe1fa7db86}{\_builder}};}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Def>}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \textcolor{keyword}{requires}\ std::negation\_v<is\_callable<std::remove\_cvref\_t<Def>>>\ \&\&}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::negation\_v<is\_kernel<std::remove\_cvref\_t<Def>>>}
\DoxyCodeLine{00039\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_raster_stage_kernel_3_01_ret_07_args_8_8_8_08_4_a9cd625ba23164c25ac2accb454032a8b}{RasterStageKernel}}(Def\ \&\&f)\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_assert}(std::is\_invocable\_r\_v<void,\ Def,\ detail::prototype\_to\_creation\_t<Args>...>);}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_raster_stage_kernel_3_01_ret_07_args_8_8_8_08_4_a8bdd1d60b168d9d77915debe1fa7db86}{\_builder}}\ =\ \mbox{\hyperlink{classluisa_1_1compute_1_1detail_1_1_function_builder_a9c491a146c2682c4c8cfebc85d6f9b34}{detail::FunctionBuilder::define\_raster\_stage}}([\&f]\ \{}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ create\ =\ []<\textcolor{keywordtype}{size\_t}...\ i>(\textcolor{keyword}{auto}\ \&\&\mbox{\hyperlink{namespaceluisa_1_1compute_1_1dsl_ac6894281f79600b83c401fbf77ec3727}{def}},\ std::index\_sequence<i...>)\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }arg\_tuple\ =\ std::tuple<Args...>;}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }var\_tuple\ =\ std::tuple<Var<std::remove\_cvref\_t<Args>>...>;}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }tag\_tuple\ =\ std::tuple<detail::prototype\_to\_creation\_tag\_t<Args>...>;}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ args\ =\ \mbox{\hyperlink{namespaceluisa_1_1compute_1_1detail_a5ac01663551dfa751b156546a539e1ea}{detail::create\_argument\_definitions<var\_tuple,\ tag\_tuple>}}(std::tuple<>\{\});}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_assert}(std::tuple\_size\_v<\textcolor{keyword}{decltype}(args)>\ ==\ \textcolor{keyword}{sizeof}...(Args));}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespaceluisa_afecc703e5abfd2fcd6f342e3e345249e}{luisa::invoke}}(std::forward<\textcolor{keyword}{decltype}(\mbox{\hyperlink{namespaceluisa_1_1compute_1_1dsl_ac6894281f79600b83c401fbf77ec3727}{def}})>(\mbox{\hyperlink{namespaceluisa_1_1compute_1_1dsl_ac6894281f79600b83c401fbf77ec3727}{def}}),}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{namespaceluisa_1_1compute_1_1detail_a460bd96da28f8999ccdd555d34b2bd09}{detail::prototype\_to\_creation\_t}}<}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::tuple\_element\_t<i,\ arg\_tuple>\textcolor{keyword}{>}\ \&\&>(std::get<i>(args))...);}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::is\_same\_v<Ret,\ void>)\ \{}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ create(std::forward<Def>(f),\ std::index\_sequence\_for<Args...>\{\});}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1detail_1_1_function_builder_a4590ef89abb9497192eb36510caf0384}{detail::FunctionBuilder::current}}()-\/>return\_(\textcolor{keyword}{nullptr});\textcolor{comment}{//\ to\ check\ if\ any\ previous\ \$return\ called\ with\ non-\/void\ types}}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ ret\ =\ \mbox{\hyperlink{namespaceluisa_1_1compute_1_1dsl_ac6894281f79600b83c401fbf77ec3727}{def<Ret>}}(create(std::forward<Def>(f),\ std::index\_sequence\_for<Args...>\{\}));}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1detail_1_1_function_builder_a4590ef89abb9497192eb36510caf0384}{detail::FunctionBuilder::current}}()-\/>return\_(ret.expression());}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{00060\ \ \ \ \ \}}
\DoxyCodeLine{00062\ \ \ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_raster_stage_kernel_3_01_ret_07_args_8_8_8_08_4_a86bd9e4157cf7285f0cf405793c6c1c3}{function}}()\ const\ noexcept\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_function}{Function}}\{\mbox{\hyperlink{classluisa_1_1compute_1_1_raster_stage_kernel_3_01_ret_07_args_8_8_8_08_4_a8bdd1d60b168d9d77915debe1fa7db86}{\_builder}}.get()\};\ \}}
\DoxyCodeLine{00063\ \ \ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ \textcolor{keyword}{const}\ \&\mbox{\hyperlink{classluisa_1_1compute_1_1_raster_stage_kernel_3_01_ret_07_args_8_8_8_08_4_ae4910e7ed035b4abefac6677c0072d7d}{function\_builder}}()\ const\ \&\ noexcept\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_raster_stage_kernel_3_01_ret_07_args_8_8_8_08_4_a8bdd1d60b168d9d77915debe1fa7db86}{\_builder}};\ \}}
\DoxyCodeLine{00064\ \ \ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ \&\&\mbox{\hyperlink{classluisa_1_1compute_1_1_raster_stage_kernel_3_01_ret_07_args_8_8_8_08_4_aaa07a22bfd984b7fbaf6423cb25a46cf}{function\_builder}}()\ \&\&\ \textcolor{keyword}{noexcept}\ \{\ \textcolor{keywordflow}{return}\ std::move(\mbox{\hyperlink{classluisa_1_1compute_1_1_raster_stage_kernel_3_01_ret_07_args_8_8_8_08_4_a8bdd1d60b168d9d77915debe1fa7db86}{\_builder}});\ \}}
\DoxyCodeLine{00065\ \};}
\DoxyCodeLine{00066\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacedetail}{detail}}\ \{}
\DoxyCodeLine{00067\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00068\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structluisa_1_1compute_1_1detail_1_1dsl__function}{dsl\_function}}<\mbox{\hyperlink{classluisa_1_1compute_1_1_raster_stage_kernel}{RasterStageKernel}}<T>>\ \{}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structluisa_1_1compute_1_1detail_1_1dsl__function_3_01_raster_stage_kernel_3_01_t_01_4_01_4_aa03aca81c354818f41cd66ba35df2e60}{type}}\ =\ T;}
\DoxyCodeLine{00070\ \};}
\DoxyCodeLine{00071\ \}\textcolor{comment}{//\ namespace\ detail}}
\DoxyCodeLine{00072\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00073\ \mbox{\hyperlink{classluisa_1_1compute_1_1_raster_stage_kernel}{RasterStageKernel}}(T\ \&\&)\ -\/>\ \mbox{\hyperlink{classluisa_1_1compute_1_1_raster_stage_kernel}{RasterStageKernel<detail::dsl\_function\_t<std::remove\_cvref\_t<T>}}>>;}
\DoxyCodeLine{00074\ \}\textcolor{comment}{//\ namespace\ luisa::compute}}

\end{DoxyCode}
