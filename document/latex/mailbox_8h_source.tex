\doxysection{mailbox.\+h}
\hypertarget{mailbox_8h_source}{}\label{mailbox_8h_source}\index{external/taskflow/3rd-\/party/tbb/src/tbb/mailbox.h@{external/taskflow/3rd-\/party/tbb/src/tbb/mailbox.h}}
\mbox{\hyperlink{mailbox_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ \ \ \ Copyright\ (c)\ 2005-\/2020\ Intel\ Corporation}}
\DoxyCodeLine{00003\ \textcolor{comment}{}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ \ \ \ Licensed\ under\ the\ Apache\ License,\ Version\ 2.0\ (the\ "{}License"{});}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ \ \ \ you\ may\ not\ use\ this\ file\ except\ in\ compliance\ with\ the\ License.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ \ \ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00007\ \textcolor{comment}{}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ \ \ \ \ \ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00009\ \textcolor{comment}{}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ \ \ \ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,\ software}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ \ \ \ distributed\ under\ the\ License\ is\ distributed\ on\ an\ "{}AS\ IS"{}\ BASIS,}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ \ \ \ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY\ KIND,\ either\ express\ or\ implied.}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ \ \ \ See\ the\ License\ for\ the\ specific\ language\ governing\ permissions\ and}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ \ \ \ limitations\ under\ the\ License.}}
\DoxyCodeLine{00015\ \textcolor{comment}{*/}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#ifndef\ \_TBB\_mailbox\_H}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#define\ \_TBB\_mailbox\_H}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tbb__stddef_8h}{tbb/tbb\_stddef.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cache__aligned__allocator_8h}{tbb/cache\_aligned\_allocator.h}}"{}}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{scheduler__common_8h}{scheduler\_common.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{external_2taskflow_23rd-party_2tbb_2include_2tbb_2atomic_8h}{tbb/atomic.h}}"{}}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetbb}{tbb}}\ \{}
\DoxyCodeLine{00027\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetbb_1_1internal}{internal}}\ \{}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy}{task\_proxy}}\ :\ \textcolor{keyword}{public}\ task\ \{}
\DoxyCodeLine{00030\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ intptr\_t\ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a6339e879ab7b6576df404a749f603c51}{pool\_bit}}\ =\ 1<<0;}
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ intptr\_t\ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a7b7339255177d3817844a39271e20484}{mailbox\_bit}}\ =\ 1<<1;}
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ intptr\_t\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_af6bc227aa29feead34c16e8012d634e0}{location\_mask}}\ =\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a6339e879ab7b6576df404a749f603c51}{pool\_bit}}\ |\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a7b7339255177d3817844a39271e20484}{mailbox\_bit}};}
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{comment}{/*\ All\ but\ two\ low-\/order\ bits\ represent\ a\ (task*).}}
\DoxyCodeLine{00034\ \textcolor{comment}{\ \ \ \ \ \ \ Two\ low-\/order\ bits\ mean:}}
\DoxyCodeLine{00035\ \textcolor{comment}{\ \ \ \ \ \ \ 1\ =\ proxy\ is/was/will\ be\ in\ task\ pool}}
\DoxyCodeLine{00036\ \textcolor{comment}{\ \ \ \ \ \ \ 2\ =\ proxy\ is/was/will\ be\ in\ mailbox\ */}}
\DoxyCodeLine{00037\ \ \ \ \ intptr\_t\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_abedfdfcd6048685cf9aa032ca2380adf}{task\_and\_tag}};}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00040\ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy}{task\_proxy}}\ *\_\_TBB\_atomic\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_aff8d45ec3c435258ec855186b978dd00}{next\_in\_mailbox}};}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00043\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__outbox}{mail\_outbox}}*\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a32d3a7685efa9cf073409277295091a8}{outbox}};}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a364254f54e3817ee490eab693b9ee916}{is\_shared}}\ (\ intptr\_t\ tat\ )\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (tat\ \&\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_af6bc227aa29feead34c16e8012d634e0}{location\_mask}})\ ==\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_af6bc227aa29feead34c16e8012d634e0}{location\_mask}};}
\DoxyCodeLine{00048\ \ \ \ \ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keyword}{static}\ task*\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a82adc9bcd803435a2edfc7b29e510e36}{task\_ptr}}\ (\ intptr\_t\ tat\ )\ \{}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (task*)(tat\ \&\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_af6bc227aa29feead34c16e8012d634e0}{\string~location\_mask}});}
\DoxyCodeLine{00053\ \ \ \ \ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keywordtype}{int}ptr\_t\ from\_bit>}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keyword}{inline}\ task*\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a40da3f9c1cf3a45264946dac05f7b9b6}{extract\_task}}\ ()\ \{}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ prefix().extra\_state\ ==\ \mbox{\hyperlink{namespacetbb_1_1internal_a5fb219223e38c8bbcc47d7c943f48e54a2b1c67cc200577a0b07649fdb00bec49}{es\_task\_proxy}},\ \textcolor{stringliteral}{"{}Normal\ task\ misinterpreted\ as\ a\ proxy?"{}}\ );}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ intptr\_t\ tat\ =\ \_\_TBB\_load\_with\_acquire(\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_abedfdfcd6048685cf9aa032ca2380adf}{task\_and\_tag}});}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ tat\ ==\ from\_bit\ ||\ (\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a364254f54e3817ee490eab693b9ee916}{is\_shared}}(tat)\ \&\&\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a82adc9bcd803435a2edfc7b29e510e36}{task\_ptr}}(tat)),}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Proxy's\ tag\ cannot\ specify\ both\ locations\ if\ the\ proxy\ "{}}}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}was\ retrieved\ from\ one\ of\ its\ original\ locations"{}}\ );}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ tat\ !=\ from\_bit\ )\ \{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ intptr\_t\ cleaner\_bit\ =\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_af6bc227aa29feead34c16e8012d634e0}{location\_mask}}\ \&\ \string~from\_bit;}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Attempt\ to\ transition\ the\ proxy\ to\ the\ "{}empty"{}\ state\ with}}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ cleaner\_bit\ specifying\ entity\ responsible\ for\ its\ eventual\ freeing.}}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Explicit\ cast\ to\ void*\ is\ to\ work\ around\ a\ seeming\ ICC\ 11.1\ bug.}}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{namespacetbb_1_1internal_a958f482f9d5f3476ca70610af5336040}{as\_atomic}}(\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_abedfdfcd6048685cf9aa032ca2380adf}{task\_and\_tag}}).compare\_and\_swap(cleaner\_bit,\ tat)\ ==\ tat\ )\ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Successfully\ grabbed\ the\ task,\ and\ left\ new\ owner\ with\ the\ job\ of\ freeing\ the\ proxy}}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a82adc9bcd803435a2edfc7b29e510e36}{task\_ptr}}(tat);}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Proxied\ task\ has\ already\ been\ claimed\ from\ another\ proxy\ location.}}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_abedfdfcd6048685cf9aa032ca2380adf}{task\_and\_tag}}\ ==\ from\_bit,\ \textcolor{stringliteral}{"{}Empty\ proxy\ cannot\ contain\ non-\/zero\ task\ pointer"{}}\ );}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00076\ \ \ \ \ \}}
\DoxyCodeLine{00077\ \};\ \textcolor{comment}{//\ struct\ task\_proxy}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00080\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1unpadded__mail__outbox}{unpadded\_mail\_outbox}}\ \{}
\DoxyCodeLine{00081\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy}{task\_proxy}}*\_\_TBB\_atomic\ \mbox{\hyperlink{classtbb_1_1internal_1_1unpadded__mail__outbox_a5400264b86ed06e7988ce05676502649}{proxy\_ptr}};}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00085\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1unpadded__mail__outbox_a5400264b86ed06e7988ce05676502649}{proxy\_ptr}}\ \mbox{\hyperlink{classtbb_1_1internal_1_1unpadded__mail__outbox_a3ee26b23db3bff135fad3aa2aaa07c59}{my\_first}};}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00088\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1unpadded__mail__outbox_a5400264b86ed06e7988ce05676502649}{proxy\_ptr}}*\ \_\_TBB\_atomic\ \mbox{\hyperlink{classtbb_1_1internal_1_1unpadded__mail__outbox_a812639a0cd3bff371afd51922d80ed7b}{my\_last}};}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00091\ \ \ \ \ tbb::atomic<int>\ \mbox{\hyperlink{classtbb_1_1internal_1_1unpadded__mail__outbox_a6f120e831d64e059cbe1f41afbab5750}{my\_task\_count}};}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtbb_1_1internal_1_1unpadded__mail__outbox_ae34c49eefcf28e324fc0467202186686}{my\_is\_idle}};}
\DoxyCodeLine{00095\ \};}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1mail__outbox}{mail\_outbox}}\ :\ padded<unpadded\_mail\_outbox>\ \{}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__outbox_ad04210e34d85ca42d104c4723cea32fb}{mailbox\_task\_limit}}\ =\ 32;}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy}{task\_proxy}}*\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__outbox_ad8bfb335200daefe2176704ff1081d65}{internal\_pop}}(\ \mbox{\hyperlink{scheduler__common_8h_a63e9a35b6d2bfbfb21b3199dc03acc6d}{\_\_TBB\_ISOLATION\_EXPR}}(isolation\_tag\ isolation)\ )\ \{}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy}{task\_proxy}}*\ curr\ =\ \_\_TBB\_load\_relaxed(\ my\_first\ );}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !curr\ )}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy}{task\_proxy}}\ **prev\_ptr\ =\ \&my\_first;}
\DoxyCodeLine{00107\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_ISOLATION}}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ isolation\ !=\ no\_isolation\ )\ \{}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\ curr-\/>prefix().isolation\ !=\ isolation\ )\ \{}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ prev\_ptr\ =\ \&curr-\/>\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_aff8d45ec3c435258ec855186b978dd00}{next\_in\_mailbox}};}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ curr\ =\ curr-\/>\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_aff8d45ec3c435258ec855186b978dd00}{next\_in\_mailbox}};}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !curr\ )}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00116\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_ISOLATION\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{gcc__generic_8h_a739e3f9cf251b0c785e86fba7c8f8c7c}{\_\_TBB\_control\_consistency\_helper}}();\ \textcolor{comment}{//\ on\ my\_first}}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ There\ is\ a\ first\ item\ in\ the\ mailbox.\ \ See\ if\ there\ is\ a\ second.}}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy}{task\_proxy}}*\ \mbox{\hyperlink{second___n_o_n_e_8f_ae9f971a8b343bd2fcb85c3b16da97f10}{second}}\ =\ curr-\/>\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_aff8d45ec3c435258ec855186b978dd00}{next\_in\_mailbox}}\ )\ \{}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ There\ are\ at\ least\ two\ items,\ so\ first\ item\ can\ be\ popped\ easily.}}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \ \ \ \ *prev\_ptr\ =\ \mbox{\hyperlink{second___n_o_n_e_8f_ae9f971a8b343bd2fcb85c3b16da97f10}{second}};}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ There\ is\ only\ one\ item.\ \ Some\ care\ is\ required\ to\ pop\ it.}}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ *prev\_ptr\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{namespacetbb_1_1internal_a958f482f9d5f3476ca70610af5336040}{as\_atomic}}(\ my\_last\ ).compare\_and\_swap(\ prev\_ptr,\ \&curr-\/>\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_aff8d45ec3c435258ec855186b978dd00}{next\_in\_mailbox}}\ )\ ==\ \&curr-\/>\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_aff8d45ec3c435258ec855186b978dd00}{next\_in\_mailbox}}\ )\ \{}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Successfully\ transitioned\ mailbox\ from\ having\ one\ item\ to\ having\ none.}}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !curr-\/>\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_aff8d45ec3c435258ec855186b978dd00}{next\_in\_mailbox}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Some\ other\ thread\ updated\ my\_last\ but\ has\ not\ filled\ in\ first-\/>next\_in\_mailbox}}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Wait\ until\ first\ item\ points\ to\ second\ item.}}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ atomic\_backoff\ backoff;}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\ !(\mbox{\hyperlink{second___n_o_n_e_8f_ae9f971a8b343bd2fcb85c3b16da97f10}{second}}\ =\ curr-\/>\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_aff8d45ec3c435258ec855186b978dd00}{next\_in\_mailbox}})\ )\ backoff.pause();}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *prev\_ptr\ =\ \mbox{\hyperlink{second___n_o_n_e_8f_ae9f971a8b343bd2fcb85c3b16da97f10}{second}};}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ -\/-\/my\_task\_count;}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ my\_task\_count\ >=\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ curr,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ curr;}
\DoxyCodeLine{00140\ \ \ \ \ \}}
\DoxyCodeLine{00141\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1mail__outbox_a0e354c091ffa6f396e6368b46f9397d6}{mail\_inbox}};}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__outbox_ae76e3bce668baf6c313d8ea0b5110c45}{push}}(\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy}{task\_proxy}}*\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ )\ \{}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (my\_task\_count\ >\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__outbox_ad04210e34d85ca42d104c4723cea32fb}{mailbox\_task\_limit}})}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ ++my\_task\_count;}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>next\_in\_mailbox\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ proxy\_ptr\ *\ \textcolor{keyword}{const}\ link\ =\ (proxy\_ptr\ *)\_\_TBB\_FetchAndStoreW(\&my\_last,(intptr\_t)\&\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>next\_in\_mailbox);}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ release\ fence\ required\ for\ the\ next\ store,\ because\ there\ are\ no\ memory\ operations}}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ between\ the\ previous\ fully\ fenced\ atomic\ operation\ and\ the\ store.}}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \_\_TBB\_store\_relaxed(*link,\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}});}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00158\ \ \ \ \ \}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__outbox_aa4b26c4528a742391d358e22d7493763}{empty}}()\ \{}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_\_TBB\_load\_relaxed(my\_first)\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00163\ \ \ \ \ \}}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__outbox_af6072a4a688633e6e754cf93f541e2cb}{construct}}()\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \textcolor{keyword}{sizeof}(*\textcolor{keyword}{this})==NFS\_MaxLineSize,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !my\_first,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !my\_last,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !my\_is\_idle,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ my\_last=\&my\_first;}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ suppress\_unused\_warning(pad);}
\DoxyCodeLine{00176\ \ \ \ \ \}}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00179\ \ \ \ \ intptr\_t\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__outbox_af2367d906b2272e9ed1ea77055782144}{drain}}()\ \{}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ intptr\_t\ k\ =\ 0;}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ fences\ here\ because\ other\ threads\ have\ already\ quit.}}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ ;\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy}{task\_proxy}}*\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ my\_first;\ ++k\ )\ \{}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ my\_first\ =\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>next\_in\_mailbox;}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_abd3fdd42ea716867fc95116354481b4e}{NFS\_Free}}((\textcolor{keywordtype}{char}*)\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ -\/\ \mbox{\hyperlink{namespacetbb_1_1internal_a0630d59441f75e740be0b003d2922df8}{task\_prefix\_reservation\_size}});}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ k;}
\DoxyCodeLine{00187\ \ \ \ \ \}}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__outbox_acaf8c50736e4d27b6755f006f1a5a38e}{recipient\_is\_idle}}()\ \{}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ my\_is\_idle;}
\DoxyCodeLine{00192\ \ \ \ \ \}}
\DoxyCodeLine{00193\ \};\ \textcolor{comment}{//\ class\ mail\_outbox}}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00196\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_a1bdd2891d8103e38dfc063e6977cfc7a}{mail\_inbox}}\ \{}
\DoxyCodeLine{00198\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__outbox}{mail\_outbox}}*\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_abd8d1e6fda38a03279abe4feece3feea}{my\_putter}};}
\DoxyCodeLine{00199\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00201\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_a1bdd2891d8103e38dfc063e6977cfc7a}{mail\_inbox}}()\ :\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_abd8d1e6fda38a03279abe4feece3feea}{my\_putter}}(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\}}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_a5db22ebed6cee417875881d6ee260231}{attach}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__outbox}{mail\_outbox}}\&\ putter\ )\ \{}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_abd8d1e6fda38a03279abe4feece3feea}{my\_putter}}\ =\ \&putter;}
\DoxyCodeLine{00206\ \ \ \ \ \}}
\DoxyCodeLine{00208\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_ab4d587f455177aec5b07e4f1ee00440a}{detach}}()\ \{}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_abd8d1e6fda38a03279abe4feece3feea}{my\_putter}},\textcolor{stringliteral}{"{}not\ attached"{}});}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_abd8d1e6fda38a03279abe4feece3feea}{my\_putter}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00211\ \ \ \ \ \}}
\DoxyCodeLine{00213\ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy}{task\_proxy}}*\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_ab293ba71502e412da78eb894b098bc01}{pop}}(\ \mbox{\hyperlink{scheduler__common_8h_a63e9a35b6d2bfbfb21b3199dc03acc6d}{\_\_TBB\_ISOLATION\_EXPR}}(\ isolation\_tag\ isolation\ )\ )\ \{}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_abd8d1e6fda38a03279abe4feece3feea}{my\_putter}}-\/>internal\_pop(\ \mbox{\hyperlink{scheduler__common_8h_a63e9a35b6d2bfbfb21b3199dc03acc6d}{\_\_TBB\_ISOLATION\_EXPR}}(\ isolation\ )\ );}
\DoxyCodeLine{00215\ \ \ \ \ \}}
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_a74cbcc24b9babea092c0c96d77c8512d}{empty}}()\ \{}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_abd8d1e6fda38a03279abe4feece3feea}{my\_putter}}-\/>empty();}
\DoxyCodeLine{00219\ \ \ \ \ \}}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_a08539a9bfc808963dfe6ab756bfd2d2d}{set\_is\_idle}}(\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_abe8e049f756b5ba547bda825af81b645}{value}}\ )\ \{}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_abd8d1e6fda38a03279abe4feece3feea}{my\_putter}}\ )\ \{}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_abd8d1e6fda38a03279abe4feece3feea}{my\_putter}}-\/>my\_is\_idle\ ||\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_abe8e049f756b5ba547bda825af81b645}{value}},\ \textcolor{stringliteral}{"{}attempt\ to\ redundantly\ mark\ mailbox\ as\ not\ idle"{}}\ );}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_abd8d1e6fda38a03279abe4feece3feea}{my\_putter}}-\/>my\_is\_idle\ =\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_abe8e049f756b5ba547bda825af81b645}{value}};}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00227\ \ \ \ \ \}}
\DoxyCodeLine{00229\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_aa5e2c3869c472aa0a05709fc0562bf83}{is\_idle\_state}}\ (\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_abe8e049f756b5ba547bda825af81b645}{value}}\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ !\mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_abd8d1e6fda38a03279abe4feece3feea}{my\_putter}}\ ||\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_abd8d1e6fda38a03279abe4feece3feea}{my\_putter}}-\/>my\_is\_idle\ ==\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_abe8e049f756b5ba547bda825af81b645}{value}};}
\DoxyCodeLine{00231\ \ \ \ \ \}}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \textcolor{preprocessor}{\#if\ DO\_ITT\_NOTIFY}}
\DoxyCodeLine{00235\ \ \ \ \ \textcolor{keywordtype}{void}*\ outbox()\textcolor{keyword}{\ const\ }\{\textcolor{keywordflow}{return}\ \mbox{\hyperlink{classtbb_1_1internal_1_1mail__inbox_abd8d1e6fda38a03279abe4feece3feea}{my\_putter}};\}}
\DoxyCodeLine{00236\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ DO\_ITT\_NOTIFY\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00237\ \};\ \textcolor{comment}{//\ class\ mail\_inbox}}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \}\ \textcolor{comment}{//\ namespace\ internal}}
\DoxyCodeLine{00240\ \}\ \textcolor{comment}{//\ namespace\ tbb}}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_TBB\_mailbox\_H\ */}\textcolor{preprocessor}{}}

\end{DoxyCode}
