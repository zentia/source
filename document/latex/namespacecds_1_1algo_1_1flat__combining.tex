\doxysection{cds\+::algo\+::flat\+\_\+combining 命名空间参考}
\hypertarget{namespacecds_1_1algo_1_1flat__combining}{}\label{namespacecds_1_1algo_1_1flat__combining}\index{cds::algo::flat\_combining@{cds::algo::flat\_combining}}


Flat combining  


\doxysubsubsection*{命名空间}
\begin{DoxyCompactItemize}
\item 
namespace \mbox{\hyperlink{namespacecds_1_1algo_1_1flat__combining_1_1wait__strategy}{wait\+\_\+strategy}}
\begin{DoxyCompactList}\small\item\em Wait strategies for {\ttfamily \doxylink{namespacecds_1_1algo_1_1flat__combining}{flat\+\_\+combining}} technique \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{类}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structcds_1_1algo_1_1flat__combining_1_1empty__stat}{empty\+\_\+stat}}
\begin{DoxyCompactList}\small\item\em Flat combining dummy internal statistics \end{DoxyCompactList}\item 
class \mbox{\hyperlink{classcds_1_1algo_1_1flat__combining_1_1kernel}{kernel}}
\begin{DoxyCompactList}\small\item\em The kernel of flat combining \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{structcds_1_1algo_1_1flat__combining_1_1make__traits}{make\+\_\+traits}}
\begin{DoxyCompactList}\small\item\em Metafunction converting option list to traits \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{structcds_1_1algo_1_1flat__combining_1_1publication__record}{publication\+\_\+record}}
\begin{DoxyCompactList}\small\item\em Record of publication list \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{structcds_1_1algo_1_1flat__combining_1_1stat}{stat}}
\begin{DoxyCompactList}\small\item\em Flat combining internal statistics \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{structcds_1_1algo_1_1flat__combining_1_1traits}{traits}}
\begin{DoxyCompactList}\small\item\em \doxylink{ir__common_8h_a1ac75f8fee198af783521627f1fecfbc}{Type} traits of \doxylink{classcds_1_1algo_1_1flat__combining_1_1kernel}{kernel} class \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{枚举}
\begin{DoxyCompactItemize}
\item 
enum \mbox{\hyperlink{namespacecds_1_1algo_1_1flat__combining_a31e4c17b353f2cab92b34d79a37a12a0}{request\+\_\+value}} \{ \mbox{\hyperlink{namespacecds_1_1algo_1_1flat__combining_a31e4c17b353f2cab92b34d79a37a12a0a050462e27eb65c3ca981b2609af319f1}{req\+\_\+\+Empty\+Record}}
, \mbox{\hyperlink{namespacecds_1_1algo_1_1flat__combining_a31e4c17b353f2cab92b34d79a37a12a0acc4350b0fb18cbd1b94e4879fcc9b655}{req\+\_\+\+Response}}
, \mbox{\hyperlink{namespacecds_1_1algo_1_1flat__combining_a31e4c17b353f2cab92b34d79a37a12a0ae0863b6d1beee7e247871637e285fc95}{req\+\_\+\+Operation}}
 \}
\begin{DoxyCompactList}\small\item\em Special values of {\ttfamily publication\+\_\+record\+::n\+Request} \end{DoxyCompactList}\item 
enum \mbox{\hyperlink{namespacecds_1_1algo_1_1flat__combining_a551f49e9d311e395a72a90798295f499}{record\+\_\+state}} \{ \mbox{\hyperlink{namespacecds_1_1algo_1_1flat__combining_a551f49e9d311e395a72a90798295f499a2d24be2b807c915aa68e80a090a8a5de}{inactive}}
, \mbox{\hyperlink{namespacecds_1_1algo_1_1flat__combining_a551f49e9d311e395a72a90798295f499a40ab14630f2d297efa2f6b97783f2c5d}{active}}
, \mbox{\hyperlink{namespacecds_1_1algo_1_1flat__combining_a551f49e9d311e395a72a90798295f499ac21d0f05db7d58c8d35bdd5f81a73536}{removed}}
 \}
\begin{DoxyCompactList}\small\item\em {\ttfamily publication\+\_\+record} state \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{详细描述}
Flat combining 

\label{namespacecds_1_1algo_1_1flat__combining_cds_flat_combining_description}%
\Hypertarget{namespacecds_1_1algo_1_1flat__combining_cds_flat_combining_description}%
Flat combining (FC) technique is invented by Hendler, Incze, Shavit and Tzafrir in their paper \mbox{[}2010\mbox{]} {\itshape "{}\+Flat Combining and the Synchronization-\/\+Parallelism Tradeoff"{}}. The technique converts a sequential data structure to its concurrent implementation. \doxylink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A} few structures are added to the sequential implementation\+: a {\itshape global lock}, a {\itshape count} of the number of combining passes, and a pointer to the {\itshape head} of a {\itshape publication list}. The publication list is a list of thread-\/local records of a size proportional to the number of threads that are concurrently accessing the shared object.

Each thread {\ttfamily t} accessing the structure to perform an invocation of some method {\ttfamily \doxylink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f()}} on the shared object executes the following sequence of steps\+: 
\begin{DoxyEnumerate}
\item Write the invocation opcode and parameters (if any) of the method {\ttfamily \doxylink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f()}} to be applied sequentially to the shared object in the {\itshape request} field of your thread local publication record (there is no need to use a load-\/store memory barrier). The {\itshape request} field will later be used to receive the response. If your thread local publication record is marked as active continue to step 2, otherwise continue to step 5. 
\item \doxylink{struct_check}{Check} if the global lock is taken. If so (another thread is an active combiner), spin on the {\itshape request} field waiting for a response to the invocation (one can add a yield at this point to allow other threads on the same core to run). Once in a while while spinning check if the lock is still taken and that your record is active (you may use any of {\ttfamily \doxylink{namespacecds_1_1algo_1_1flat__combining_1_1wait__strategy}{wait\+\_\+strategy}} instead of spinning). If your record is inactive proceed to step 5. Once the response is available, reset the request field to null and return the response. 
\item If the lock is not taken, attempt to acquire it and become a combiner. If you fail, return to spinning in step 2. 
\item Otherwise, you hold the lock and are a combiner. 
\begin{DoxyItemize}
\item Increment the combining pass count by one. 
\item Execute a {\ttfamily fc\+\_\+apply()} by traversing the publication list from the head, combining all non-\/null method call invocations, setting the {\itshape age} of each of these records to the current {\itshape count}, applying the combined method calls to the structure D, and returning responses to all the invocations. This traversal is guaranteed to be wait-\/free. 
\item If the {\itshape count} is such that a cleanup needs to be performed, traverse the publication list from the {\itshape head}. Starting from the second item (we always leave the item pointed to by the head in the list), remove from the publication list all records whose {\itshape age} is much smaller than the current {\itshape count}. This is done by removing the node and marking it as inactive. 
\item Release the lock. 
\end{DoxyItemize}
\item If you have no thread local publication record allocate one, marked as active. If you already have one marked as inactive, mark it as active. Execute a store-\/load memory barrier. Proceed to insert the record into the list with a successful CAS to the {\itshape head}. Then proceed to step 1. 
\end{DoxyEnumerate}

As the test results show, the flat combining technique is suitable for non-\/intrusive containers like stack, queue, deque. For intrusive concurrent containers the flat combining demonstrates less impressive results.

\doxylink{group__cds__flat__combining__container}{List of FC-\/based containers} in libcds.

\doxylink{group__cds__flat__combining__intrusive}{List of intrusive FC-\/based containers} in libcds. 

\doxysubsection{枚举类型说明}
\Hypertarget{namespacecds_1_1algo_1_1flat__combining_a551f49e9d311e395a72a90798295f499}\index{cds::algo::flat\_combining@{cds::algo::flat\_combining}!record\_state@{record\_state}}
\index{record\_state@{record\_state}!cds::algo::flat\_combining@{cds::algo::flat\_combining}}
\doxysubsubsection{\texorpdfstring{record\_state}{record\_state}}
{\footnotesize\ttfamily \label{namespacecds_1_1algo_1_1flat__combining_a551f49e9d311e395a72a90798295f499} 
enum \mbox{\hyperlink{namespacecds_1_1algo_1_1flat__combining_a551f49e9d311e395a72a90798295f499}{cds\+::algo\+::flat\+\_\+combining\+::record\+\_\+state}}}



{\ttfamily \doxylink{structcds_1_1algo_1_1flat__combining_1_1publication__record}{publication\+\_\+record}} state 

\begin{DoxyEnumFields}[2]{枚举值}
\raisebox{\heightof{T}}[0pt][0pt]{\index{inactive@{inactive}!cds::algo::flat\_combining@{cds::algo::flat\_combining}}\index{cds::algo::flat\_combining@{cds::algo::flat\_combining}!inactive@{inactive}}}\Hypertarget{namespacecds_1_1algo_1_1flat__combining_a551f49e9d311e395a72a90798295f499a2d24be2b807c915aa68e80a090a8a5de}\label{namespacecds_1_1algo_1_1flat__combining_a551f49e9d311e395a72a90798295f499a2d24be2b807c915aa68e80a090a8a5de} 
inactive&Record is inactive \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{active@{active}!cds::algo::flat\_combining@{cds::algo::flat\_combining}}\index{cds::algo::flat\_combining@{cds::algo::flat\_combining}!active@{active}}}\Hypertarget{namespacecds_1_1algo_1_1flat__combining_a551f49e9d311e395a72a90798295f499a40ab14630f2d297efa2f6b97783f2c5d}\label{namespacecds_1_1algo_1_1flat__combining_a551f49e9d311e395a72a90798295f499a40ab14630f2d297efa2f6b97783f2c5d} 
active&Record is active \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{removed@{removed}!cds::algo::flat\_combining@{cds::algo::flat\_combining}}\index{cds::algo::flat\_combining@{cds::algo::flat\_combining}!removed@{removed}}}\Hypertarget{namespacecds_1_1algo_1_1flat__combining_a551f49e9d311e395a72a90798295f499ac21d0f05db7d58c8d35bdd5f81a73536}\label{namespacecds_1_1algo_1_1flat__combining_a551f49e9d311e395a72a90798295f499ac21d0f05db7d58c8d35bdd5f81a73536} 
removed&Record should be removed \\
\hline

\end{DoxyEnumFields}
\Hypertarget{namespacecds_1_1algo_1_1flat__combining_a31e4c17b353f2cab92b34d79a37a12a0}\index{cds::algo::flat\_combining@{cds::algo::flat\_combining}!request\_value@{request\_value}}
\index{request\_value@{request\_value}!cds::algo::flat\_combining@{cds::algo::flat\_combining}}
\doxysubsubsection{\texorpdfstring{request\_value}{request\_value}}
{\footnotesize\ttfamily \label{namespacecds_1_1algo_1_1flat__combining_a31e4c17b353f2cab92b34d79a37a12a0} 
enum \mbox{\hyperlink{namespacecds_1_1algo_1_1flat__combining_a31e4c17b353f2cab92b34d79a37a12a0}{cds\+::algo\+::flat\+\_\+combining\+::request\+\_\+value}}}



Special values of {\ttfamily \doxylink{structcds_1_1algo_1_1flat__combining_1_1publication__record_ab60a5289163c835df8ed1618b8da74d0}{publication\+\_\+record\+::n\+Request}} 

\begin{DoxyEnumFields}[2]{枚举值}
\raisebox{\heightof{T}}[0pt][0pt]{\index{req\_EmptyRecord@{req\_EmptyRecord}!cds::algo::flat\_combining@{cds::algo::flat\_combining}}\index{cds::algo::flat\_combining@{cds::algo::flat\_combining}!req\_EmptyRecord@{req\_EmptyRecord}}}\Hypertarget{namespacecds_1_1algo_1_1flat__combining_a31e4c17b353f2cab92b34d79a37a12a0a050462e27eb65c3ca981b2609af319f1}\label{namespacecds_1_1algo_1_1flat__combining_a31e4c17b353f2cab92b34d79a37a12a0a050462e27eb65c3ca981b2609af319f1} 
req\+\_\+\+Empty\+Record&Publication record is empty \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{req\_Response@{req\_Response}!cds::algo::flat\_combining@{cds::algo::flat\_combining}}\index{cds::algo::flat\_combining@{cds::algo::flat\_combining}!req\_Response@{req\_Response}}}\Hypertarget{namespacecds_1_1algo_1_1flat__combining_a31e4c17b353f2cab92b34d79a37a12a0acc4350b0fb18cbd1b94e4879fcc9b655}\label{namespacecds_1_1algo_1_1flat__combining_a31e4c17b353f2cab92b34d79a37a12a0acc4350b0fb18cbd1b94e4879fcc9b655} 
req\+\_\+\+Response&Operation is done \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{req\_Operation@{req\_Operation}!cds::algo::flat\_combining@{cds::algo::flat\_combining}}\index{cds::algo::flat\_combining@{cds::algo::flat\_combining}!req\_Operation@{req\_Operation}}}\Hypertarget{namespacecds_1_1algo_1_1flat__combining_a31e4c17b353f2cab92b34d79a37a12a0ae0863b6d1beee7e247871637e285fc95}\label{namespacecds_1_1algo_1_1flat__combining_a31e4c17b353f2cab92b34d79a37a12a0ae0863b6d1beee7e247871637e285fc95} 
req\+\_\+\+Operation&First operation id for derived classes \\
\hline

\end{DoxyEnumFields}
