\doxysection{tbbmalloc\+\_\+internal.\+h}
\hypertarget{tbbmalloc__internal_8h_source}{}\label{tbbmalloc__internal_8h_source}\index{external/taskflow/3rd-\/party/tbb/src/tbbmalloc/tbbmalloc\_internal.h@{external/taskflow/3rd-\/party/tbb/src/tbbmalloc/tbbmalloc\_internal.h}}
\mbox{\hyperlink{tbbmalloc__internal_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ \ \ \ Copyright\ (c)\ 2005-\/2020\ Intel\ Corporation}}
\DoxyCodeLine{00003\ \textcolor{comment}{}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ \ \ \ Licensed\ under\ the\ Apache\ License,\ Version\ 2.0\ (the\ "{}License"{});}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ \ \ \ you\ may\ not\ use\ this\ file\ except\ in\ compliance\ with\ the\ License.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ \ \ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00007\ \textcolor{comment}{}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ \ \ \ \ \ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00009\ \textcolor{comment}{}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ \ \ \ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,\ software}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ \ \ \ distributed\ under\ the\ License\ is\ distributed\ on\ an\ "{}AS\ IS"{}\ BASIS,}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ \ \ \ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY\ KIND,\ either\ express\ or\ implied.}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ \ \ \ See\ the\ License\ for\ the\ specific\ language\ governing\ permissions\ and}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ \ \ \ limitations\ under\ the\ License.}}
\DoxyCodeLine{00015\ \textcolor{comment}{*/}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#ifndef\ \_\_TBB\_tbbmalloc\_internal\_H}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#define\ \_\_TBB\_tbbmalloc\_internal\_H}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_type_definitions_8h}{TypeDefinitions.h}}"{}}\ \textcolor{comment}{/*\ Also\ includes\ customization\ layer\ Customize.h\ */}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#if\ USE\_PTHREAD}}
\DoxyCodeLine{00024\ \ \ \ \ \textcolor{comment}{//\ Some\ pthreads\ documentation\ says\ that\ <pthreads.h>\ must\ be\ first\ header.}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\ \ \ \ \#include\ <\mbox{\hyperlink{pthread_8h}{pthread.h}}>}}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{pthread__minport__windows_8h_abd9df76622c288b7b7a8a80365b6ddd7}{pthread\_key\_t}}\ \mbox{\hyperlink{tbbmalloc__internal_8h_a426aa0379460f2cf1bf8efaaad1ec694}{tls\_key\_t}};}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#elif\ USE\_WINTHREAD}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\ \ \ \ \#include\ "{}\mbox{\hyperlink{windows__api_8h}{tbb/machine/windows\_api.h}}"{}}}
\DoxyCodeLine{00029\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{test__malloc__compliance_8cpp_ad342ac907eb044443153a22f964bf0af}{DWORD}}\ \mbox{\hyperlink{tbbmalloc__internal_8h_a426aa0379460f2cf1bf8efaaad1ec694}{tls\_key\_t}};}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\ \ \ \ \#error\ Must\ define\ USE\_PTHREAD\ or\ USE\_WINTHREAD}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{comment}{//\ TODO:\ *BSD\ also\ has\ it}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#define\ BACKEND\_HAS\_MREMAP\ \_\_linux\_\_}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#define\ CHECK\_ALLOCATION\_RANGE\ MALLOC\_DEBUG\ ||\ MALLOC\_ZONE\_OVERLOAD\_ENABLED\ ||\ MALLOC\_UNIXLIKE\_OVERLOAD\_ENABLED}}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tbb__config_8h}{tbb/tbb\_config.h}}"{}}\ \textcolor{comment}{//\ for\ \_\_TBB\_LIBSTDCPP\_EXCEPTION\_HEADERS\_BROKEN}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#if\ \_\_TBB\_LIBSTDCPP\_EXCEPTION\_HEADERS\_BROKEN}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\ \ \#define\ \_EXCEPTION\_PTR\_H\ }\textcolor{comment}{/*\ prevents\ exception\_ptr.h\ inclusion\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\ \ \#define\ \_GLIBCXX\_NESTED\_EXCEPTION\_H\ }\textcolor{comment}{/*\ prevents\ nested\_exception.h\ inclusion\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \textcolor{preprocessor}{\#include\ <stdio.h>}}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\#include\ <stdlib.h>}}
\DoxyCodeLine{00046\ \textcolor{preprocessor}{\#include\ <limits.h>}\ \textcolor{comment}{//\ for\ CHAR\_BIT}}
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{string_8h}{string.h}}>}\ \textcolor{comment}{//\ for\ memset}}
\DoxyCodeLine{00048\ \textcolor{preprocessor}{\#if\ MALLOC\_CHECK\_RECURSION}}
\DoxyCodeLine{00049\ \textcolor{preprocessor}{\#include\ <new>}\ \ \ \ \ \ \ \ \textcolor{comment}{/*\ for\ placement\ new\ */}}
\DoxyCodeLine{00050\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00051\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{scalable__allocator_8h}{tbb/scalable\_allocator.h}}"{}}}
\DoxyCodeLine{00052\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tbbmalloc__internal__api_8h}{tbbmalloc\_internal\_api.h}}"{}}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \textcolor{comment}{/*********\ Various\ compile-\/time\ options\ \ \ \ \ \ \ \ **************/}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \textcolor{preprocessor}{\#if\ !\_\_TBB\_DEFINE\_MIC\ \&\&\ \_\_TBB\_MIC\_NATIVE}}
\DoxyCodeLine{00057\ \textcolor{preprocessor}{\ \#error\ Intel(R)\ Many\ Integrated\ Core\ Compiler\ does\ not\ define\ \_\_MIC\_\_\ anymore.}}
\DoxyCodeLine{00058\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \textcolor{preprocessor}{\#define\ MALLOC\_TRACE\ 0}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \textcolor{preprocessor}{\#if\ MALLOC\_TRACE}}
\DoxyCodeLine{00063\ \textcolor{preprocessor}{\#define\ TRACEF(x)\ printf\ x}}
\DoxyCodeLine{00064\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00065\ \textcolor{preprocessor}{\#define\ TRACEF(x)\ ((void)0)}}
\DoxyCodeLine{00066\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ MALLOC\_TRACE\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \textcolor{preprocessor}{\#define\ ASSERT\_TEXT\ NULL}}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \textcolor{preprocessor}{\#define\ COLLECT\_STATISTICS\ (\ MALLOC\_DEBUG\ \&\&\ MALLOCENV\_COLLECT\_STATISTICS\ )}}
\DoxyCodeLine{00071\ \textcolor{preprocessor}{\#ifndef\ USE\_INTERNAL\_TID}}
\DoxyCodeLine{00072\ \textcolor{preprocessor}{\#define\ USE\_INTERNAL\_TID\ COLLECT\_STATISTICS\ ||\ MALLOC\_TRACE}}
\DoxyCodeLine{00073\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tbbmalloc_2statistics_8h}{Statistics.h}}"{}}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \textcolor{comment}{//\ call\ yield\ for\ whitebox\ testing,\ skip\ in\ real\ library}}
\DoxyCodeLine{00078\ \textcolor{preprocessor}{\#ifndef\ WhiteboxTestingYield}}
\DoxyCodeLine{00079\ \textcolor{preprocessor}{\#define\ WhiteboxTestingYield()\ ((void)0)}}
\DoxyCodeLine{00080\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \textcolor{comment}{/*********\ End\ compile-\/time\ options\ \ \ \ \ \ \ \ **************/}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacerml}{rml}}\ \{}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceinternal}{internal}}\ \{}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \textcolor{preprocessor}{\#if\ \_\_TBB\_MALLOC\_LOCACHE\_STAT}}
\DoxyCodeLine{00090\ \textcolor{keyword}{extern}\ intptr\_t\ mallocCalls,\ cacheHits;}
\DoxyCodeLine{00091\ \textcolor{keyword}{extern}\ intptr\_t\ memAllocKB,\ memHitKB;}
\DoxyCodeLine{00092\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00095\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00096\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacerml_1_1internal_acf3df9c7e1c2baec44e3dab2d8f1ee42}{suppress\_unused\_warning}}(\ \textcolor{keyword}{const}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\&\ )\ \{\}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \textcolor{comment}{/**********\ Various\ global\ default\ constants\ ********/}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \textcolor{comment}{/*}}
\DoxyCodeLine{00101\ \textcolor{comment}{\ *\ Default\ huge\ page\ size}}
\DoxyCodeLine{00102\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00103\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{namespacerml_1_1internal_a557ee6aae1e7bb9bd680cf2d5bc7aa7c}{HUGE\_PAGE\_SIZE}}\ =\ 2\ *\ 1024\ *\ 1024;}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \textcolor{comment}{/**********\ End\ of\ global\ default\ constatns\ *********/}}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \textcolor{comment}{/**********\ Various\ numeric\ parameters\ controlling\ allocations\ ********/}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \textcolor{comment}{/*}}
\DoxyCodeLine{00110\ \textcolor{comment}{\ *\ slabSize\ -\/\ the\ size\ of\ a\ block\ for\ allocation\ of\ small\ objects,}}
\DoxyCodeLine{00111\ \textcolor{comment}{\ *\ it\ must\ be\ larger\ than\ maxSegregatedObjectSize.}}
\DoxyCodeLine{00112\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00113\ \textcolor{keyword}{const}\ uintptr\_t\ \mbox{\hyperlink{namespacerml_1_1internal_ab92a44f5c0d4ae24554856afbba1943d}{slabSize}}\ =\ 16*1024;}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \textcolor{comment}{/*}}
\DoxyCodeLine{00116\ \textcolor{comment}{\ *\ Large\ blocks\ cache\ cleanup\ frequency.}}
\DoxyCodeLine{00117\ \textcolor{comment}{\ *\ It\ should\ be\ power\ of\ 2\ for\ the\ fast\ checking.}}
\DoxyCodeLine{00118\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00119\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacerml_1_1internal_aa1b64d1ce3c23d14639c5101213381c8}{cacheCleanupFreq}}\ =\ 256;}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \textcolor{comment}{/*}}
\DoxyCodeLine{00122\ \textcolor{comment}{\ *\ Alignment\ of\ large\ (>=\ minLargeObjectSize)\ objects.}}
\DoxyCodeLine{00123\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00124\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{namespacerml_1_1internal_aa95f01338b826313f5e137f38e282e01}{largeObjectAlignment}}\ =\ \mbox{\hyperlink{namespacerml_1_1internal_a559caa4a53713c2a95d8b28708ff1d77}{estimatedCacheLineSize}};}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \textcolor{comment}{/*}}
\DoxyCodeLine{00127\ \textcolor{comment}{\ *\ This\ number\ of\ bins\ in\ the\ TLS\ that\ leads\ to\ blocks\ that\ we\ can\ allocate\ in.}}
\DoxyCodeLine{00128\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00129\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{namespacerml_1_1internal_af9e9162c10034b03b23d5734de443213}{numBlockBinLimit}}\ =\ 31;}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \textcolor{comment}{/**********\ End\ of\ numeric\ parameters\ controlling\ allocations\ *********/}}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1_block_i}{BlockI}};}
\DoxyCodeLine{00134\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1_block}{Block}};}
\DoxyCodeLine{00135\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structrml_1_1internal_1_1_large_memory_block}{LargeMemoryBlock}};}
\DoxyCodeLine{00136\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool}{ExtMemoryPool}};}
\DoxyCodeLine{00137\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structrml_1_1internal_1_1_mem_region}{MemRegion}};}
\DoxyCodeLine{00138\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1_free_block}{FreeBlock}};}
\DoxyCodeLine{00139\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1_t_l_s_data}{TLSData}};}
\DoxyCodeLine{00140\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1_backend}{Backend}};}
\DoxyCodeLine{00141\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1_memory_pool}{MemoryPool}};}
\DoxyCodeLine{00142\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structrml_1_1internal_1_1_cache_bin_operation}{CacheBinOperation}};}
\DoxyCodeLine{00143\ \textcolor{keyword}{extern}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{namespacerml_1_1internal_ad778f7cb21fd95b85e36f2cf18d8fc60}{minLargeObjectSize}};}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \textcolor{keyword}{enum}\ \mbox{\hyperlink{namespacerml_1_1internal_ab5748e02f3b284f1b2243c4ea09b1916}{DecreaseOrIncrease}}\ \{}
\DoxyCodeLine{00146\ \ \ \ \ \mbox{\hyperlink{namespacerml_1_1internal_ab5748e02f3b284f1b2243c4ea09b1916a346632ccc9adec9e0a9cbd7c27dd82de}{decrease}},\ \mbox{\hyperlink{namespacerml_1_1internal_ab5748e02f3b284f1b2243c4ea09b1916a85d08e41cee517e4c0acd40b0c159e2d}{increase}}}
\DoxyCodeLine{00147\ \};}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1_t_l_s_key}{TLSKey}}\ \{}
\DoxyCodeLine{00150\ \ \ \ \ \mbox{\hyperlink{tbbmalloc__internal_8h_a426aa0379460f2cf1bf8efaaad1ec694}{tls\_key\_t}}\ \mbox{\hyperlink{classrml_1_1internal_1_1_t_l_s_key_a9f65839984ce3556d00450a06bfa7b48}{TLS\_pointer\_key}};}
\DoxyCodeLine{00151\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrml_1_1internal_1_1_t_l_s_key_a1f2f9f05f38781763a400ab092135758}{init}}();}
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrml_1_1internal_1_1_t_l_s_key_ac132d53d35d0536953da9c6e3bc7e5ea}{destroy}}();}
\DoxyCodeLine{00154\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_t_l_s_data}{TLSData}}*\ \mbox{\hyperlink{classrml_1_1internal_1_1_t_l_s_key_a13963112bc0570cdcd5449d4104c3d0f}{getThreadMallocTLS}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_t_l_s_key_af482c91d6b8aff61e3a45c4a41cf09c9}{setThreadMallocTLS}}(\ \mbox{\hyperlink{classrml_1_1internal_1_1_t_l_s_data}{TLSData}}\ *\ newvalue\ );}
\DoxyCodeLine{00156\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_t_l_s_data}{TLSData}}*\ \mbox{\hyperlink{classrml_1_1internal_1_1_t_l_s_key_a06d9e3bc08d87039bdcc081d3b6b10cb}{createTLS}}(\mbox{\hyperlink{classrml_1_1internal_1_1_memory_pool}{MemoryPool}}\ *memPool,\ \mbox{\hyperlink{classrml_1_1internal_1_1_backend}{Backend}}\ *backend);}
\DoxyCodeLine{00157\ \};}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Arg,\ \textcolor{keyword}{typename}\ Compare>}
\DoxyCodeLine{00160\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacerml_1_1internal_af7c2ebdeed6d0ee45dd9474b25fe5ff1}{AtomicUpdate}}(Arg\ \&location,\ Arg\ newVal,\ \textcolor{keyword}{const}\ Compare\ \&cmp)}
\DoxyCodeLine{00161\ \{}
\DoxyCodeLine{00162\ \ \ \ \ \mbox{\hyperlink{_customize_8h_a65d0dcc10d4bd982cf2171e170c01d14}{MALLOC\_STATIC\_ASSERT}}(\textcolor{keyword}{sizeof}(Arg)\ ==\ \textcolor{keyword}{sizeof}(intptr\_t),}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Type\ of\ argument\ must\ match\ AtomicCompareExchange\ type."{}});}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keywordflow}{for}\ (Arg\ old\ =\ location;\ cmp(old,\ newVal);\ )\ \{}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ Arg\ val\ =\ \mbox{\hyperlink{_synchronize_8h_a204e8f99046d12f598e460aa19ac9516}{AtomicCompareExchange}}((intptr\_t\&)location,\ (intptr\_t)newVal,\ old);}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (val\ ==\ old)}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ do\ we\ need\ backoff\ after\ unsuccessful\ CAS?}}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ old\ =\ val;}
\DoxyCodeLine{00170\ \ \ \ \ \}}
\DoxyCodeLine{00171\ \}}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \textcolor{comment}{//\ TODO:\ make\ BitMaskBasic\ more\ general}}
\DoxyCodeLine{00174\ \textcolor{comment}{//\ (currently,\ it\ fits\ BitMaskMin\ well,\ but\ not\ as\ suitable\ for\ BitMaskMax)}}
\DoxyCodeLine{00175\ \textcolor{keyword}{template}<\textcolor{keywordtype}{unsigned}\ NUM>}
\DoxyCodeLine{00176\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic}{BitMaskBasic}}\ \{}
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{main-override-static_8c_a11d818f14508b076eda0cfe98640b7ae}{SZ}}\ =\ (NUM-\/1)/(CHAR\_BIT*\textcolor{keyword}{sizeof}(uintptr\_t))+1;}
\DoxyCodeLine{00178\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_a4060ba2d9c6e2cd15d8baa13baa7598c}{WORD\_LEN}}\ =\ CHAR\_BIT*\textcolor{keyword}{sizeof}(uintptr\_t);}
\DoxyCodeLine{00179\ \ \ \ \ uintptr\_t\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_a91f944d51b6fafc0591941bc78f8072f}{mask}}[\mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_a0a1002a1c7ad6d29a11e632d1287958a}{SZ}}];}
\DoxyCodeLine{00180\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_a722a4fa1506daf7887ece1e8e495d5ff}{set}}(\textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{bool}\ val)\ \{}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_customize_8h_ab07698dd675204d120111c1300b4185c}{MALLOC\_ASSERT}}(idx<NUM,\ \mbox{\hyperlink{tbbmalloc__internal_8h_a3b823c1707df8bd6d7d8b7cdb8b6dc6d}{ASSERT\_TEXT}});}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ idx\ /\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_a4060ba2d9c6e2cd15d8baa13baa7598c}{WORD\_LEN}};}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ pos\ =\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_a4060ba2d9c6e2cd15d8baa13baa7598c}{WORD\_LEN}}\ -\/\ idx\ \%\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_a4060ba2d9c6e2cd15d8baa13baa7598c}{WORD\_LEN}}\ -\/\ 1;}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (val)}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_synchronize_8h_ad24c500728a8ab9b7052d82f53aeeba0}{AtomicOr}}(\&\mbox{\hyperlink{ittnotify__static_8h_a2dea65f740c088e6408d62d6a9500c9e}{mask}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}],\ 1ULL\ <<\ pos);}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_synchronize_8h_a17231d9f14009dbed016142bcb675388}{AtomicAnd}}(\&\mbox{\hyperlink{ittnotify__static_8h_a2dea65f740c088e6408d62d6a9500c9e}{mask}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}],\ \string~(1ULL\ <<\ pos));}
\DoxyCodeLine{00190\ \ \ \ \ \}}
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_ad119d4c8441f958f5b3cb62fccae0bdd}{getMinTrue}}(\textcolor{keywordtype}{unsigned}\ startIdx)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ idx\ =\ startIdx\ /\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_a4060ba2d9c6e2cd15d8baa13baa7598c}{WORD\_LEN}};}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ pos;}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (startIdx\ \%\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_a4060ba2d9c6e2cd15d8baa13baa7598c}{WORD\_LEN}})\ \{}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ only\ interested\ in\ part\ of\ a\ word,\ clear\ bits\ before\ startIdx}}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ pos\ =\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_a4060ba2d9c6e2cd15d8baa13baa7598c}{WORD\_LEN}}\ -\/\ startIdx\ \%\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_a4060ba2d9c6e2cd15d8baa13baa7598c}{WORD\_LEN}};}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ uintptr\_t\ actualMask\ =\ \mbox{\hyperlink{ittnotify__static_8h_a2dea65f740c088e6408d62d6a9500c9e}{mask}}[idx]\ \&\ (((uintptr\_t)1<<pos)\ -\/\ 1);}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ idx++;}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (-\/1\ !=\ (pos\ =\ \mbox{\hyperlink{_customize_8h_a796241035a56fb632a5cb9686deaa00f}{BitScanRev}}(actualMask)))}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ idx*\mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_a4060ba2d9c6e2cd15d8baa13baa7598c}{WORD\_LEN}}\ -\/\ pos\ -\/\ 1;}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (idx<\mbox{\hyperlink{main-override-static_8c_a11d818f14508b076eda0cfe98640b7ae}{SZ}})}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (-\/1\ !=\ (pos\ =\ \mbox{\hyperlink{_customize_8h_a796241035a56fb632a5cb9686deaa00f}{BitScanRev}}(\mbox{\hyperlink{ittnotify__static_8h_a2dea65f740c088e6408d62d6a9500c9e}{mask}}[idx++])))}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ idx*\mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_a4060ba2d9c6e2cd15d8baa13baa7598c}{WORD\_LEN}}\ -\/\ pos\ -\/\ 1;}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00208\ \ \ \ \ \}}
\DoxyCodeLine{00209\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00210\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_abb3861e0f501fc8a8fed2ff47c76a270}{reset}}()\ \{\ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_a0a1002a1c7ad6d29a11e632d1287958a}{SZ}};\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}++)\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_a91f944d51b6fafc0591941bc78f8072f}{mask}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]\ =\ 0;\ \}}
\DoxyCodeLine{00211\ \};}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00213\ \textcolor{keyword}{template}<\textcolor{keywordtype}{unsigned}\ NUM>}
\DoxyCodeLine{00214\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_min}{BitMaskMin}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic}{BitMaskBasic}}<NUM>\ \{}
\DoxyCodeLine{00215\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_min_aa5718330a8d423d2fdfb2bdd58960f5a}{set}}(\textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{bool}\ val)\ \{\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_a722a4fa1506daf7887ece1e8e495d5ff}{BitMaskBasic<NUM>::set}}(idx,\ val);\ \}}
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_min_a537322c9fd716144d7f89b8fc3dbaca7}{getMinTrue}}(\textcolor{keywordtype}{unsigned}\ startIdx)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_ad119d4c8441f958f5b3cb62fccae0bdd}{BitMaskBasic<NUM>::getMinTrue}}(startIdx);}
\DoxyCodeLine{00219\ \ \ \ \ \}}
\DoxyCodeLine{00220\ \};}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \textcolor{keyword}{template}<\textcolor{keywordtype}{unsigned}\ NUM>}
\DoxyCodeLine{00223\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_max}{BitMaskMax}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic}{BitMaskBasic}}<NUM>\ \{}
\DoxyCodeLine{00224\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceset}{set}}(\textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{bool}\ val)\ \{}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_a722a4fa1506daf7887ece1e8e495d5ff}{BitMaskBasic<NUM>::set}}(NUM\ -\/\ 1\ -\/\ idx,\ val);}
\DoxyCodeLine{00227\ \ \ \ \ \}}
\DoxyCodeLine{00228\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_max_a7ec6e50775def5da70d79f24d18167ed}{getMaxTrue}}(\textcolor{keywordtype}{unsigned}\ startIdx)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ \mbox{\hyperlink{classrml_1_1internal_1_1_bit_mask_basic_ad119d4c8441f958f5b3cb62fccae0bdd}{BitMaskBasic<NUM>::getMinTrue}}(NUM-\/startIdx-\/1);}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1==\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}?\ -\/1\ :\ (\mbox{\hyperlink{sugar_8h_ae4f82344f573c70aa1066a2394bba345}{int}})NUM\ -\/\ 1\ -\/\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}};}
\DoxyCodeLine{00231\ \ \ \ \ \}}
\DoxyCodeLine{00232\ \};}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \textcolor{comment}{//\ The\ part\ of\ thread-\/specific\ data\ that\ can\ be\ modified\ by\ other\ threads.}}
\DoxyCodeLine{00236\ \textcolor{comment}{//\ Such\ modifications\ must\ be\ protected\ by\ AllLocalCaches::listLock.}}
\DoxyCodeLine{00237\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structrml_1_1internal_1_1_t_l_s_remote}{TLSRemote}}\ \{}
\DoxyCodeLine{00238\ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_t_l_s_remote}{TLSRemote}}\ *\mbox{\hyperlink{structrml_1_1internal_1_1_t_l_s_remote_aa6e2f590f3cbad3968cbb62a5a23f6ee}{next}},}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *\mbox{\hyperlink{structrml_1_1internal_1_1_t_l_s_remote_a455fa204dc7e55cc6859b0b92ff0105a}{prev}};}
\DoxyCodeLine{00240\ \};}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \textcolor{comment}{//\ The\ list\ of\ all\ thread-\/local\ data;\ supporting\ cleanup\ of\ thread\ caches}}
\DoxyCodeLine{00243\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1_all_local_caches}{AllLocalCaches}}\ \{}
\DoxyCodeLine{00244\ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_t_l_s_remote}{TLSRemote}}\ \ *\mbox{\hyperlink{ittnotify__static_8h_ad492e8facf9b4113e52f1918fceb8804}{head}};}
\DoxyCodeLine{00245\ \ \ \ \ \mbox{\hyperlink{class_malloc_mutex}{MallocMutex}}\ \mbox{\hyperlink{classrml_1_1internal_1_1_all_local_caches_a60ab58e04ecf5df0107bb24d54feb645}{listLock}};\ \textcolor{comment}{//\ protects\ operations\ in\ the\ list}}
\DoxyCodeLine{00246\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00247\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_all_local_caches_ad7176ca94d2801b0d12f1d487a05c6aa}{registerThread}}(\mbox{\hyperlink{structrml_1_1internal_1_1_t_l_s_remote}{TLSRemote}}\ *tls);}
\DoxyCodeLine{00248\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_all_local_caches_a53d07e07b151b79af310ff5d40010f1d}{unregisterThread}}(\mbox{\hyperlink{structrml_1_1internal_1_1_t_l_s_remote}{TLSRemote}}\ *tls);}
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrml_1_1internal_1_1_all_local_caches_a37c9bd0c14ea906eb82f7a05928663f1}{cleanup}}(\textcolor{keywordtype}{bool}\ cleanOnlyUnused);}
\DoxyCodeLine{00250\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_all_local_caches_ae7e8856f91b8ff05b3ae0a719c20f345}{markUnused}}();}
\DoxyCodeLine{00251\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_all_local_caches_a3714379b090eb844a02f4f370167077c}{reset}}()\ \{\ \mbox{\hyperlink{classrml_1_1internal_1_1_all_local_caches_a2cc70f27db1dfa47f3e5d1ea35c78e4d}{head}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};\ \}}
\DoxyCodeLine{00252\ \};}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1_lifo_list_a71a4147a226b1f1dea6475093ef3139b}{LifoList}}\ \{}
\DoxyCodeLine{00255\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00256\ \ \ \ \ \textcolor{keyword}{inline}\ \mbox{\hyperlink{classrml_1_1internal_1_1_lifo_list_a71a4147a226b1f1dea6475093ef3139b}{LifoList}}();}
\DoxyCodeLine{00257\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_lifo_list_aa7629cbd8403ea42d5ec9a5efe9c3f91}{push}}(\mbox{\hyperlink{classrml_1_1internal_1_1_block}{Block}}\ *\mbox{\hyperlink{mimalloc_8h_af7f922b73e3acdb4a430b72f1a1334a5}{block}});}
\DoxyCodeLine{00258\ \ \ \ \ \textcolor{keyword}{inline}\ \mbox{\hyperlink{classrml_1_1internal_1_1_block}{Block}}\ *\mbox{\hyperlink{classrml_1_1internal_1_1_lifo_list_a75a913938955f0898e950401bcdeb54d}{pop}}();}
\DoxyCodeLine{00259\ \ \ \ \ \textcolor{keyword}{inline}\ \mbox{\hyperlink{classrml_1_1internal_1_1_block}{Block}}\ *\mbox{\hyperlink{classrml_1_1internal_1_1_lifo_list_a1c0e42e0d99bd02cc8f243980d500434}{grab}}();}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00262\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_block}{Block}}\ *\mbox{\hyperlink{classrml_1_1internal_1_1_lifo_list_a446bb262c2fad232bbc5f95088c19b58}{top}};}
\DoxyCodeLine{00263\ \ \ \ \ \mbox{\hyperlink{class_malloc_mutex}{MallocMutex}}\ \mbox{\hyperlink{classrml_1_1internal_1_1_lifo_list_a1cf637a3e8495bdbf71893a397eb20de}{lock}};}
\DoxyCodeLine{00264\ \};}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \textcolor{comment}{/*}}
\DoxyCodeLine{00267\ \textcolor{comment}{\ *\ When\ a\ block\ that\ is\ not\ completely\ free\ is\ returned\ for\ reuse\ by\ other\ threads}}
\DoxyCodeLine{00268\ \textcolor{comment}{\ *\ this\ is\ where\ the\ block\ goes.}}
\DoxyCodeLine{00269\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00270\ \textcolor{comment}{\ *\ LifoList\ assumes\ zero\ initialization;\ so\ below\ its\ constructors\ are\ omitted,}}
\DoxyCodeLine{00271\ \textcolor{comment}{\ *\ to\ avoid\ linking\ with\ C++\ libraries\ on\ Linux.}}
\DoxyCodeLine{00272\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1_orphaned_blocks}{OrphanedBlocks}}\ \{}
\DoxyCodeLine{00275\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_lifo_list}{LifoList}}\ \mbox{\hyperlink{classrml_1_1internal_1_1_orphaned_blocks_a6d309b76a0c4d14b79d3c2c2b5a435a3}{bins}}[\mbox{\hyperlink{namespacerml_1_1internal_af9e9162c10034b03b23d5734de443213}{numBlockBinLimit}}];}
\DoxyCodeLine{00276\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00277\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_block}{Block}}\ *\mbox{\hyperlink{classrml_1_1internal_1_1_orphaned_blocks_a3ed9f9cf98cd6c788195e57408c5ed26}{get}}(\mbox{\hyperlink{classrml_1_1internal_1_1_t_l_s_data}{TLSData}}\ *tls,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}});}
\DoxyCodeLine{00278\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_orphaned_blocks_a26c824f081a1b11ea4fe0bab06d71e66}{put}}(intptr\_t\ binTag,\ \mbox{\hyperlink{classrml_1_1internal_1_1_block}{Block}}\ *\mbox{\hyperlink{mimalloc_8h_af7f922b73e3acdb4a430b72f1a1334a5}{block}});}
\DoxyCodeLine{00279\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_orphaned_blocks_ab0e3bca882f21bd89f6f76bcd33d4640}{reset}}();}
\DoxyCodeLine{00280\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrml_1_1internal_1_1_orphaned_blocks_a1707222a0a6430ed2efe30049dfd4784}{cleanup}}(\mbox{\hyperlink{classrml_1_1internal_1_1_large_object_cache_a44285c7c096641abe34473cd745ffd8a}{Backend}}*\ backend);}
\DoxyCodeLine{00281\ \};}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ \textcolor{comment}{/*\ Large\ objects\ entities\ */}}
\DoxyCodeLine{00284\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{large__objects_8h}{large\_objects.h}}"{}}}
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00286\ \textcolor{comment}{//\ select\ index\ size\ for\ BackRefMaster\ based\ on\ word\ size:\ default\ is\ uint32\_t,}}
\DoxyCodeLine{00287\ \textcolor{comment}{//\ uint16\_t\ for\ 32-\/bit\ platforms}}
\DoxyCodeLine{00288\ \textcolor{keyword}{template}<\textcolor{keywordtype}{bool}>}
\DoxyCodeLine{00289\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structrml_1_1internal_1_1_master_index_select}{MasterIndexSelect}}\ \{}
\DoxyCodeLine{00290\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{eabase_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{structrml_1_1internal_1_1_master_index_select_a27b7fbde27fabf3afb85e8b3791e6cb1}{master\_type}};}
\DoxyCodeLine{00291\ \};}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{00294\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structrml_1_1internal_1_1_master_index_select}{MasterIndexSelect}}<\mbox{\hyperlink{yyjson_8h_a65e9886d74aaee76545e83dd09011727}{false}}>\ \{}
\DoxyCodeLine{00295\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{eabase_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{structrml_1_1internal_1_1_master_index_select_a27b7fbde27fabf3afb85e8b3791e6cb1}{master\_type}};}
\DoxyCodeLine{00296\ \};}
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00298\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1_back_ref_idx}{BackRefIdx}}\ \{\ \textcolor{comment}{//\ composite\ index\ to\ backreference\ array}}
\DoxyCodeLine{00299\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00300\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{structrml_1_1internal_1_1_master_index_select}{MasterIndexSelect}}<4\ <\ \textcolor{keyword}{sizeof}(uintptr\_t)>::master\_type\ master\_t;}
\DoxyCodeLine{00301\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00302\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ master\_t\ invalid\ =\ \string~master\_t(0);}
\DoxyCodeLine{00303\ \ \ \ \ master\_t\ master;\ \ \ \ \ \ \textcolor{comment}{//\ index\ in\ BackRefMaster}}
\DoxyCodeLine{00304\ \ \ \ \ \mbox{\hyperlink{eabase_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ largeObj:1;\ \ \textcolor{comment}{//\ is\ this\ object\ "{}large"{}?}}
\DoxyCodeLine{00305\ \ \ \ \ \mbox{\hyperlink{eabase_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ae1b92ae085ddef4b1cdca7d749339fb0}{offset}}\ \ :15;\ \textcolor{comment}{//\ offset\ from\ beginning\ of\ BackRefBlock}}
\DoxyCodeLine{00306\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00307\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_back_ref_idx}{BackRefIdx}}()\ :\ master(invalid),\ largeObj(0),\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ae1b92ae085ddef4b1cdca7d749339fb0}{offset}}(0)\ \{\}}
\DoxyCodeLine{00308\ \ \ \ \ \textcolor{keywordtype}{bool}\ isInvalid()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ master\ ==\ invalid;\ \}}
\DoxyCodeLine{00309\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespacerml_1_1internal_a730f387568a0a522e003dca4246eb393}{isLargeObject}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ largeObj;\ \}}
\DoxyCodeLine{00310\ \ \ \ \ master\_t\ getMaster()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ master;\ \}}
\DoxyCodeLine{00311\ \ \ \ \ \mbox{\hyperlink{eabase_8h_a273cf69d639a59973b6019625df33e30}{uint16\_t}}\ getOffset()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ae1b92ae085ddef4b1cdca7d749339fb0}{offset}};\ \}}
\DoxyCodeLine{00312\ }
\DoxyCodeLine{00313\ \ \ \ \ \textcolor{comment}{//\ only\ newBackRef\ can\ modify\ BackRefIdx}}
\DoxyCodeLine{00314\ \ \ \ \ \textcolor{keyword}{static}\ BackRefIdx\ newBackRef(\textcolor{keywordtype}{bool}\ largeObj);}
\DoxyCodeLine{00315\ \};}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00317\ \textcolor{comment}{//\ Block\ header\ is\ used\ during\ block\ coalescing}}
\DoxyCodeLine{00318\ \textcolor{comment}{//\ and\ must\ be\ preserved\ in\ used\ blocks.}}
\DoxyCodeLine{00319\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1_block_i}{BlockI}}\ \{}
\DoxyCodeLine{00320\ \ \ \ \ intptr\_t\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_block_i_a9e21da40c356afa2cbc1a3089d60a83d}{blockState}}[2];}
\DoxyCodeLine{00321\ \};}
\DoxyCodeLine{00322\ }
\DoxyCodeLine{00323\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structrml_1_1internal_1_1_large_memory_block}{LargeMemoryBlock}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classrml_1_1internal_1_1_block_i}{BlockI}}\ \{}
\DoxyCodeLine{00324\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_memory_pool}{MemoryPool}}\ \ \ \ \ \ \ *\mbox{\hyperlink{structrml_1_1internal_1_1_large_memory_block_ab6fa15d3ce41da0cfe36d85af326ed50}{pool}};\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ owner\ pool}}
\DoxyCodeLine{00325\ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_large_memory_block}{LargeMemoryBlock}}\ *\mbox{\hyperlink{structrml_1_1internal_1_1_large_memory_block_a556cab303968471599e3491cfcbeaeb8}{next}},\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ptrs\ in\ list\ of\ cached\ blocks}}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *\mbox{\hyperlink{structrml_1_1internal_1_1_large_memory_block_a3687b4a5f07044935f9cef3047e3c285}{prev}},}
\DoxyCodeLine{00327\ \ \ \ \ \textcolor{comment}{//\ 2-\/linked\ list\ of\ pool's\ large\ objects}}
\DoxyCodeLine{00328\ \ \ \ \ \textcolor{comment}{//\ Used\ to\ destroy\ backrefs\ on\ pool\ destroy\ (backrefs\ are\ global)}}
\DoxyCodeLine{00329\ \ \ \ \ \textcolor{comment}{//\ and\ for\ object\ releasing\ during\ pool\ reset.}}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *\mbox{\hyperlink{structrml_1_1internal_1_1_large_memory_block_a82d0961bf793ad33d0dc11b0f14be14e}{gPrev}},}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *\mbox{\hyperlink{structrml_1_1internal_1_1_large_memory_block_a2c2870cb49c99aa7e2438c4662b85b20}{gNext}};}
\DoxyCodeLine{00332\ \ \ \ \ uintptr\_t\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_large_memory_block_a19d1063456bebeb3c16b5b3b78fd6c58}{age}};\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ age\ of\ block\ while\ in\ cache}}
\DoxyCodeLine{00333\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_large_memory_block_a36dc3cf5c0acd49721481eda74838e3b}{objectSize}};\ \ \ \ \textcolor{comment}{//\ the\ size\ requested\ by\ a\ client}}
\DoxyCodeLine{00334\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_large_memory_block_aaad527f7110e4c9e9a9cfa09411bd0b7}{unalignedSize}};\ \textcolor{comment}{//\ the\ size\ requested\ from\ backend}}
\DoxyCodeLine{00335\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_back_ref_idx}{BackRefIdx}}\ \ \ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_large_memory_block_ad97a9f039a803f7f20887a0217b014de}{backRefIdx}};\ \ \ \ \textcolor{comment}{//\ cached\ here,\ used\ copy\ is\ in\ LargeObjectHdr}}
\DoxyCodeLine{00336\ \};}
\DoxyCodeLine{00337\ }
\DoxyCodeLine{00338\ \textcolor{comment}{//\ Classes\ and\ methods\ for\ backend.cpp}}
\DoxyCodeLine{00339\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{backend_8h}{backend.h}}"{}}}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00341\ \textcolor{comment}{//\ An\ TBB\ allocator\ mode\ that\ can\ be\ controlled\ by\ user}}
\DoxyCodeLine{00342\ \textcolor{comment}{//\ via\ API/environment\ variable.\ Must\ be\ placed\ in\ zero-\/initialized\ memory.}}
\DoxyCodeLine{00343\ \textcolor{comment}{//\ External\ synchronization\ assumed.}}
\DoxyCodeLine{00344\ \textcolor{comment}{//\ TODO:\ TBB\_VERSION\ support}}
\DoxyCodeLine{00345\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1_alloc_controlled_mode}{AllocControlledMode}}\ \{}
\DoxyCodeLine{00346\ \ \ \ \ intptr\_t\ \mbox{\hyperlink{classrml_1_1internal_1_1_alloc_controlled_mode_aab8ba706f38439d2a00e2e5bf55fa0f8}{val}};}
\DoxyCodeLine{00347\ \ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_alloc_controlled_mode_a7a3bbef1119d645473ced50dcc4f20cc}{setDone}};}
\DoxyCodeLine{00348\ }
\DoxyCodeLine{00349\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00350\ \ \ \ \ intptr\_t\ \mbox{\hyperlink{classrml_1_1internal_1_1_alloc_controlled_mode_a19eef5137514dc8a43088951e2f281cc}{get}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_customize_8h_ab07698dd675204d120111c1300b4185c}{MALLOC\_ASSERT}}(\mbox{\hyperlink{classrml_1_1internal_1_1_alloc_controlled_mode_a7a3bbef1119d645473ced50dcc4f20cc}{setDone}},\ \mbox{\hyperlink{tbbmalloc__internal_8h_a3b823c1707df8bd6d7d8b7cdb8b6dc6d}{ASSERT\_TEXT}});}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrml_1_1internal_1_1_alloc_controlled_mode_aab8ba706f38439d2a00e2e5bf55fa0f8}{val}};}
\DoxyCodeLine{00353\ \ \ \ \ \}}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00355\ \ \ \ \ \textcolor{comment}{//\ Note:\ set()\ can\ be\ called\ before\ init()}}
\DoxyCodeLine{00356\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_alloc_controlled_mode_a667994734f9857f4faa0f2a7fe4a6bb7}{set}}(intptr\_t\ newVal)\ \{}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_alloc_controlled_mode_aab8ba706f38439d2a00e2e5bf55fa0f8}{val}}\ =\ newVal;}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_alloc_controlled_mode_a7a3bbef1119d645473ced50dcc4f20cc}{setDone}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00359\ \ \ \ \ \}}
\DoxyCodeLine{00360\ }
\DoxyCodeLine{00361\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrml_1_1internal_1_1_alloc_controlled_mode_a701d1f727e0ebc5c71ea73fb4e274abc}{ready}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrml_1_1internal_1_1_alloc_controlled_mode_a7a3bbef1119d645473ced50dcc4f20cc}{setDone}};}
\DoxyCodeLine{00363\ \ \ \ \ \}}
\DoxyCodeLine{00364\ }
\DoxyCodeLine{00365\ \ \ \ \ \textcolor{comment}{//\ envName\ -\/\ environment\ variable\ to\ get\ controlled\ mode}}
\DoxyCodeLine{00366\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_alloc_controlled_mode_a9b4c1957bc9c6bdeb412cbb92514ebdb}{initReadEnv}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *envName,\ intptr\_t\ defaultVal)\ \{}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classrml_1_1internal_1_1_alloc_controlled_mode_a7a3bbef1119d645473ced50dcc4f20cc}{setDone}})\ \{}
\DoxyCodeLine{00368\ \textcolor{preprocessor}{\#if\ !\_\_TBB\_WIN8UI\_SUPPORT}}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ use\ strtol\ to\ get\ the\ actual\ value\ of\ the\ envirable}}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *envVal\ =\ getenv(envName);}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (envVal\ \&\&\ !strcmp(envVal,\ \textcolor{stringliteral}{"{}1"{}}))}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_alloc_controlled_mode_aab8ba706f38439d2a00e2e5bf55fa0f8}{val}}\ =\ 1;}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00374\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_alloc_controlled_mode_aab8ba706f38439d2a00e2e5bf55fa0f8}{val}}\ =\ defaultVal;}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_alloc_controlled_mode_a7a3bbef1119d645473ced50dcc4f20cc}{setDone}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00378\ \ \ \ \ \}}
\DoxyCodeLine{00379\ \};}
\DoxyCodeLine{00380\ }
\DoxyCodeLine{00381\ \textcolor{comment}{//\ Page\ type\ to\ be\ used\ inside\ MapMemory.}}
\DoxyCodeLine{00382\ \textcolor{comment}{//\ Regular\ (4KB\ aligned),\ Huge\ and\ Transparent\ Huge\ Pages\ (2MB\ aligned).}}
\DoxyCodeLine{00383\ \textcolor{keyword}{enum}\ \mbox{\hyperlink{namespacerml_1_1internal_a346d0fcd3a09bc14032eeb9ce653c4c5}{PageType}}\ \{}
\DoxyCodeLine{00384\ \ \ \ \ \mbox{\hyperlink{namespacerml_1_1internal_a346d0fcd3a09bc14032eeb9ce653c4c5acc89a3c892919bc432b7a27b7e82a832}{REGULAR}}\ =\ 0,}
\DoxyCodeLine{00385\ \ \ \ \ \mbox{\hyperlink{namespacerml_1_1internal_a346d0fcd3a09bc14032eeb9ce653c4c5a2933e1afb6dce6f22e53c9bcefc2e917}{PREALLOCATED\_HUGE\_PAGE}},}
\DoxyCodeLine{00386\ \ \ \ \ \mbox{\hyperlink{namespacerml_1_1internal_a346d0fcd3a09bc14032eeb9ce653c4c5ad26dd181d63a4fcabf35dc079e3160a4}{TRANSPARENT\_HUGE\_PAGE}}}
\DoxyCodeLine{00387\ \};}
\DoxyCodeLine{00388\ }
\DoxyCodeLine{00389\ \textcolor{comment}{//\ init()\ and\ printStatus()\ is\ called\ only\ under\ global\ initialization\ lock.}}
\DoxyCodeLine{00390\ \textcolor{comment}{//\ Race\ is\ possible\ between\ registerAllocation()\ and\ registerReleasing(),}}
\DoxyCodeLine{00391\ \textcolor{comment}{//\ harm\ is\ that\ up\ to\ single\ huge\ page\ releasing\ is\ missed\ (because\ failure}}
\DoxyCodeLine{00392\ \textcolor{comment}{//\ to\ get\ huge\ page\ is\ registered\ only\ 1st\ time),\ that\ is\ negligible.}}
\DoxyCodeLine{00393\ \textcolor{comment}{//\ setMode\ is\ also\ can\ be\ called\ concurrently.}}
\DoxyCodeLine{00394\ \textcolor{comment}{//\ Object\ must\ reside\ in\ zero-\/initialized\ memory}}
\DoxyCodeLine{00395\ \textcolor{comment}{//\ TODO:\ can\ we\ check\ for\ huge\ page\ presence\ during\ every\ 10th\ mmap()\ call}}
\DoxyCodeLine{00396\ \textcolor{comment}{//\ in\ case\ huge\ page\ is\ released\ by\ another\ process?}}
\DoxyCodeLine{00397\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status}{HugePagesStatus}}\ \{}
\DoxyCodeLine{00398\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00399\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_alloc_controlled_mode}{AllocControlledMode}}\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a566ad7bb25d4ab8e2d90151474079030}{requestedMode}};\ \textcolor{comment}{//\ changed\ only\ by\ user}}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ to\ keep\ enabled\ and\ requestedMode\ consistent}}
\DoxyCodeLine{00401\ \ \ \ \ \mbox{\hyperlink{class_malloc_mutex}{MallocMutex}}\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a9044fbd99a543478e2d9f15fae213214}{setModeLock}};}
\DoxyCodeLine{00402\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a9c1b1f6149c281be860e8654392b15a9}{pageSize}};}
\DoxyCodeLine{00403\ \ \ \ \ intptr\_t\ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_ada44029607699b8a133637c6c96af655}{needActualStatusPrint}};}
\DoxyCodeLine{00404\ }
\DoxyCodeLine{00405\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a179e755a5e2f56b6e2275f52cd2473b0}{doPrintStatus}}(\textcolor{keywordtype}{bool}\ state,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *stateName)\ \{}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Under\ macOS*\ fprintf/snprintf\ acquires\ an\ internal\ lock,\ so\ when}}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 1st\ allocation\ is\ done\ under\ the\ lock,\ we\ got\ a\ deadlock.}}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Do\ not\ use\ fprintf\ etc\ during\ initialization.}}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ fputs(\textcolor{stringliteral}{"{}TBBmalloc:\ huge\ pages\(\backslash\)t"{}},\ stderr);}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!state)}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ \ \ \ \ fputs(\textcolor{stringliteral}{"{}not\ "{}},\ stderr);}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ fputs(stateName,\ stderr);}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ fputs(\textcolor{stringliteral}{"{}\(\backslash\)n"{}},\ stderr);}
\DoxyCodeLine{00414\ \ \ \ \ \}}
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00416\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_aa229067329eae62f6b6304648eea9bca}{parseSystemMemInfo}}()\ \{}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ hpAvailable\ \ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ thpAvailable\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ hugePageSize\ =\ 0;}
\DoxyCodeLine{00420\ }
\DoxyCodeLine{00421\ \textcolor{preprocessor}{\#if\ \_\_linux\_\_}}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ huge\ pages\ existence}}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ meminfoHugePagesTotal\ =\ 0;}
\DoxyCodeLine{00424\ }
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structparse_file_item}{parseFileItem}}\ meminfoItems[]\ =\ \{}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Parse\ system\ huge\ page\ size}}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{stringliteral}{"{}Hugepagesize:\ \%llu\ kB"{}},\ hugePageSize\ \},}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ there\ are\ preallocated\ huge\ pages\ on\ the\ system}}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ https://www.kernel.org/doc/Documentation/vm/hugetlbpage.txt}}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{stringliteral}{"{}HugePages\_Total:\ \%llu"{}},\ meminfoHugePagesTotal\ \}\ \};}
\DoxyCodeLine{00431\ }
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{shared__utils_8h_ab8cae60361c5744c764303714ef7a41c}{parseFile}}<\textcolor{comment}{/*BUFF\_SIZE=*/}100>(\textcolor{stringliteral}{"{}/proc/meminfo"{}},\ meminfoItems);}
\DoxyCodeLine{00433\ }
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Double\ check\ another\ system\ information\ regarding\ preallocated}}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ huge\ pages\ if\ there\ are\ no\ information\ in\ /proc/meminfo}}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ vmHugePagesTotal\ =\ 0;}
\DoxyCodeLine{00437\ }
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structparse_file_item}{parseFileItem}}\ vmItem[]\ =\ \{\ \{\ \textcolor{stringliteral}{"{}\%llu"{}},\ vmHugePagesTotal\ \}\ \};}
\DoxyCodeLine{00439\ }
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ parse\ a\ counter\ number,\ it\ can't\ be\ huge}}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{shared__utils_8h_ab8cae60361c5744c764303714ef7a41c}{parseFile}}<\textcolor{comment}{/*BUFF\_SIZE=*/}100>(\textcolor{stringliteral}{"{}/proc/sys/vm/nr\_hugepages"{}},\ vmItem);}
\DoxyCodeLine{00442\ }
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (meminfoHugePagesTotal\ >\ 0\ ||\ vmHugePagesTotal\ >\ 0)\ \{}
\DoxyCodeLine{00444\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_customize_8h_ab07698dd675204d120111c1300b4185c}{MALLOC\_ASSERT}}(hugePageSize\ !=\ 0,\ \textcolor{stringliteral}{"{}Huge\ Page\ size\ can't\ be\ zero\ if\ we\ found\ preallocated."{}});}
\DoxyCodeLine{00445\ }
\DoxyCodeLine{00446\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Any\ non\ zero\ value\ clearly\ states\ that\ there\ are\ preallocated}}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ huge\ pages\ on\ the\ system}}
\DoxyCodeLine{00448\ \ \ \ \ \ \ \ \ \ \ \ \ hpAvailable\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00449\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00450\ }
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ there\ is\ transparent\ huge\ pages\ support\ on\ the\ system}}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ thpPresent\ =\ \textcolor{charliteral}{'n'};}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structparse_file_item}{parseFileItem}}\ thpItem[]\ =\ \{\ \{\ \textcolor{stringliteral}{"{}[alwa\%cs]\ madvise\ never\(\backslash\)n"{}},\ thpPresent\ \}\ \};}
\DoxyCodeLine{00454\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{shared__utils_8h_ab8cae60361c5744c764303714ef7a41c}{parseFile}}<\textcolor{comment}{/*BUFF\_SIZE=*/}100>(\textcolor{stringliteral}{"{}/sys/kernel/mm/transparent\_hugepage/enabled"{}},\ thpItem);}
\DoxyCodeLine{00455\ }
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (thpPresent\ ==\ \textcolor{charliteral}{'y'})\ \{}
\DoxyCodeLine{00457\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_customize_8h_ab07698dd675204d120111c1300b4185c}{MALLOC\_ASSERT}}(hugePageSize\ !=\ 0,\ \textcolor{stringliteral}{"{}Huge\ Page\ size\ can't\ be\ zero\ if\ we\ found\ thp\ existence."{}});}
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ \ \ \ \ thpAvailable\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00460\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_customize_8h_ab07698dd675204d120111c1300b4185c}{MALLOC\_ASSERT}}(!\mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a9c1b1f6149c281be860e8654392b15a9}{pageSize}},\ \textcolor{stringliteral}{"{}Huge\ page\ size\ can't\ be\ set\ twice.\ Double\ initialization."{}});}
\DoxyCodeLine{00462\ }
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Initialize\ object\ variables}}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a9c1b1f6149c281be860e8654392b15a9}{pageSize}}\ \ \ \ \ \ \ =\ hugePageSize\ *\ 1024;\ \textcolor{comment}{//\ was\ read\ in\ KB\ from\ meminfo}}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a330112daafb9b4cb0a124d26bc9a5d4f}{isHPAvailable}}\ \ =\ hpAvailable;}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a47d1b7267b8ddd40cf0fb5901963b437}{isTHPAvailable}}\ =\ thpAvailable;}
\DoxyCodeLine{00467\ \ \ \ \ \}}
\DoxyCodeLine{00468\ }
\DoxyCodeLine{00469\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00470\ }
\DoxyCodeLine{00471\ \ \ \ \ \textcolor{comment}{//\ System\ information}}
\DoxyCodeLine{00472\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a330112daafb9b4cb0a124d26bc9a5d4f}{isHPAvailable}};}
\DoxyCodeLine{00473\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a47d1b7267b8ddd40cf0fb5901963b437}{isTHPAvailable}};}
\DoxyCodeLine{00474\ }
\DoxyCodeLine{00475\ \ \ \ \ \textcolor{comment}{//\ User\ defined\ value}}
\DoxyCodeLine{00476\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a1d178e0a4f8cf85d6c1d91b902dd8c98}{isEnabled}};}
\DoxyCodeLine{00477\ }
\DoxyCodeLine{00478\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_ab5cb48d9a1d5d0b6404994005ef702fc}{init}}()\ \{}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_aa229067329eae62f6b6304648eea9bca}{parseSystemMemInfo}}();}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_malloc_mutex_1_1scoped__lock}{MallocMutex::scoped\_lock}}\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a9044fbd99a543478e2d9f15fae213214}{setModeLock}});}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a566ad7bb25d4ab8e2d90151474079030}{requestedMode}}.initReadEnv(\textcolor{stringliteral}{"{}TBB\_MALLOC\_USE\_HUGE\_PAGES"{}},\ 0);}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a1d178e0a4f8cf85d6c1d91b902dd8c98}{isEnabled}}\ =\ (\mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a330112daafb9b4cb0a124d26bc9a5d4f}{isHPAvailable}}\ ||\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a47d1b7267b8ddd40cf0fb5901963b437}{isTHPAvailable}})\ \&\&\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a566ad7bb25d4ab8e2d90151474079030}{requestedMode}}.get();}
\DoxyCodeLine{00483\ \ \ \ \ \}}
\DoxyCodeLine{00484\ }
\DoxyCodeLine{00485\ \ \ \ \ \textcolor{comment}{//\ Could\ be\ set\ from\ user\ code\ at\ any\ place.}}
\DoxyCodeLine{00486\ \ \ \ \ \textcolor{comment}{//\ If\ we\ didn't\ call\ init()\ at\ this\ place,\ isEnabled\ will\ be\ false}}
\DoxyCodeLine{00487\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a66ecd8c38340e89401f3dd7851e749b7}{setMode}}(intptr\_t\ newVal)\ \{}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_malloc_mutex_1_1scoped__lock}{MallocMutex::scoped\_lock}}\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a9044fbd99a543478e2d9f15fae213214}{setModeLock}});}
\DoxyCodeLine{00489\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a566ad7bb25d4ab8e2d90151474079030}{requestedMode}}.set(newVal);}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a1d178e0a4f8cf85d6c1d91b902dd8c98}{isEnabled}}\ =\ (\mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a330112daafb9b4cb0a124d26bc9a5d4f}{isHPAvailable}}\ ||\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a47d1b7267b8ddd40cf0fb5901963b437}{isTHPAvailable}})\ \&\&\ newVal;}
\DoxyCodeLine{00491\ \ \ \ \ \}}
\DoxyCodeLine{00492\ }
\DoxyCodeLine{00493\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_ab181c01dc45cff137d6d22fdc36f8dfa}{isRequested}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a566ad7bb25d4ab8e2d90151474079030}{requestedMode}}.ready()\ ?\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a566ad7bb25d4ab8e2d90151474079030}{requestedMode}}.get()\ :\ \textcolor{keyword}{false};}
\DoxyCodeLine{00495\ \ \ \ \ \}}
\DoxyCodeLine{00496\ }
\DoxyCodeLine{00497\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a490395753c5906d5bb0173227e0d0f92}{reset}}()\ \{}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a9c1b1f6149c281be860e8654392b15a9}{pageSize}}\ =\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_ada44029607699b8a133637c6c96af655}{needActualStatusPrint}}\ =\ 0;}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a1d178e0a4f8cf85d6c1d91b902dd8c98}{isEnabled}}\ =\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a330112daafb9b4cb0a124d26bc9a5d4f}{isHPAvailable}}\ =\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a47d1b7267b8ddd40cf0fb5901963b437}{isTHPAvailable}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00500\ \ \ \ \ \}}
\DoxyCodeLine{00501\ }
\DoxyCodeLine{00502\ \ \ \ \ \textcolor{comment}{//\ If\ memory\ mapping\ size\ is\ a\ multiple\ of\ huge\ page\ size,\ some\ OS\ kernels}}
\DoxyCodeLine{00503\ \ \ \ \ \textcolor{comment}{//\ can\ use\ huge\ pages\ transparently.\ Use\ this\ when\ huge\ pages\ are\ requested.}}
\DoxyCodeLine{00504\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a01d800d975af125766c1e0587f28e9a1}{getGranularity}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a566ad7bb25d4ab8e2d90151474079030}{requestedMode}}.ready())}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a566ad7bb25d4ab8e2d90151474079030}{requestedMode}}.get()\ ?\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a9c1b1f6149c281be860e8654392b15a9}{pageSize}}\ :\ 0;}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacerml_1_1internal_a557ee6aae1e7bb9bd680cf2d5bc7aa7c}{HUGE\_PAGE\_SIZE}};\ \textcolor{comment}{//\ the\ mode\ is\ not\ yet\ known;\ assume\ typical\ 2MB\ huge\ pages}}
\DoxyCodeLine{00509\ \ \ \ \ \}}
\DoxyCodeLine{00510\ }
\DoxyCodeLine{00511\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a706f5c4bc0c1d17d94f38306b39b365d}{printStatus}}()\ \{}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a179e755a5e2f56b6e2275f52cd2473b0}{doPrintStatus}}(\mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a566ad7bb25d4ab8e2d90151474079030}{requestedMode}}.get(),\ \textcolor{stringliteral}{"{}requested"{}});}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a566ad7bb25d4ab8e2d90151474079030}{requestedMode}}.get())\ \{\ \textcolor{comment}{//\ report\ actual\ status\ iff\ requested}}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a9c1b1f6149c281be860e8654392b15a9}{pageSize}})}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_synchronize_8h_a19886ee3899c0a2435ea9840116ea325}{FencedStore}}(\mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_ada44029607699b8a133637c6c96af655}{needActualStatusPrint}},\ 1);}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_huge_pages_status_a179e755a5e2f56b6e2275f52cd2473b0}{doPrintStatus}}(\textcolor{comment}{/*state=*/}\textcolor{keyword}{false},\ \textcolor{stringliteral}{"{}available"{}});}
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00519\ \ \ \ \ \}}
\DoxyCodeLine{00520\ \};}
\DoxyCodeLine{00521\ }
\DoxyCodeLine{00522\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1_all_large_blocks_list}{AllLargeBlocksList}}\ \{}
\DoxyCodeLine{00523\ \ \ \ \ \mbox{\hyperlink{class_malloc_mutex}{MallocMutex}}\ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_all_large_blocks_list_a13a36b90452ce9635d630bfbbd53adfa}{largeObjLock}};}
\DoxyCodeLine{00524\ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_large_memory_block}{LargeMemoryBlock}}\ *\mbox{\hyperlink{classrml_1_1internal_1_1_all_large_blocks_list_a6a9aef552076577102e7c5288e29598f}{loHead}};}
\DoxyCodeLine{00525\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00526\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_all_large_blocks_list_ae77cbb92ff95286e5251fbeb934194d3}{add}}(\mbox{\hyperlink{structrml_1_1internal_1_1_large_memory_block}{LargeMemoryBlock}}\ *lmb);}
\DoxyCodeLine{00527\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_all_large_blocks_list_a04270a862cfd9b27610a33e96d6d21fd}{remove}}(\mbox{\hyperlink{structrml_1_1internal_1_1_large_memory_block}{LargeMemoryBlock}}\ *lmb);}
\DoxyCodeLine{00528\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keywordtype}{bool}\ poolDestroy>\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1_all_large_blocks_list_a93202fa088a712fbdba4c671bab8f015}{releaseAll}}(\mbox{\hyperlink{classrml_1_1internal_1_1_backend}{Backend}}\ *backend);}
\DoxyCodeLine{00529\ \};}
\DoxyCodeLine{00530\ }
\DoxyCodeLine{00531\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool}{ExtMemoryPool}}\ \{}
\DoxyCodeLine{00532\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_backend}{Backend}}\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a86fdbadea90130b4aa51a5e1f2bb8fb3}{backend}};}
\DoxyCodeLine{00533\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_large_object_cache}{LargeObjectCache}}\ \ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a278849f2903427f0b7f96f677204b995}{loc}};}
\DoxyCodeLine{00534\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_all_local_caches}{AllLocalCaches}}\ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_abfc19fab46f65ebb79992d2950494fc3}{allLocalCaches}};}
\DoxyCodeLine{00535\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_orphaned_blocks}{OrphanedBlocks}}\ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a8fa17ab397beaf1680550ef5213d1643}{orphanedBlocks}};}
\DoxyCodeLine{00536\ }
\DoxyCodeLine{00537\ \ \ \ \ intptr\_t\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a7446458fc55a25205035be6cdb62df4b}{poolId}};}
\DoxyCodeLine{00538\ \ \ \ \ \textcolor{comment}{//\ To\ find\ all\ large\ objects.\ Used\ during\ user\ pool\ destruction,}}
\DoxyCodeLine{00539\ \ \ \ \ \textcolor{comment}{//\ to\ release\ all\ backreferences\ in\ large\ blocks\ (slab\ blocks\ do\ not\ have\ them).}}
\DoxyCodeLine{00540\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_all_large_blocks_list}{AllLargeBlocksList}}\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_abc830f0b5418124b31c8b265ca17d301}{lmbList}};}
\DoxyCodeLine{00541\ \ \ \ \ \textcolor{comment}{//\ Callbacks\ to\ be\ used\ instead\ of\ MapMemory/UnmapMemory.}}
\DoxyCodeLine{00542\ \ \ \ \ rawAllocType\ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a1d8ad0bd4a6c28ab90a9c0e96a3d1bf7}{rawAlloc}};}
\DoxyCodeLine{00543\ \ \ \ \ rawFreeType\ \ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a993c9d0e9c8a6ca40b76a51c907f662a}{rawFree}};}
\DoxyCodeLine{00544\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a29bfd6715f573c62dd721464fe92698b}{granularity}};}
\DoxyCodeLine{00545\ \ \ \ \ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a72cac70cd2102374a0ce820237c3d655}{keepAllMemory}},}
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a117b9e963f323eebb1742a3d5802fa65}{delayRegsReleasing}},}
\DoxyCodeLine{00547\ \ \ \ \ \textcolor{comment}{//\ TODO:\ implements\ fixedPool\ with\ calling\ rawFree\ on\ destruction}}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a978e0b112031bed60263674f71b7f5a5}{fixedPool}};}
\DoxyCodeLine{00549\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_t_l_s_key}{TLSKey}}\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a8b3cd2c2364c73142c7eed261fa14be3}{tlsPointerKey}};\ \ \textcolor{comment}{//\ per-\/pool\ TLS\ key}}
\DoxyCodeLine{00550\ }
\DoxyCodeLine{00551\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{boing_8c_a2858154e2009b0e6e616f313177762bc}{init}}(intptr\_t\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a7446458fc55a25205035be6cdb62df4b}{poolId}},\ rawAllocType\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a1d8ad0bd4a6c28ab90a9c0e96a3d1bf7}{rawAlloc}},\ rawFreeType\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a993c9d0e9c8a6ca40b76a51c907f662a}{rawFree}},}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a29bfd6715f573c62dd721464fe92698b}{granularity}},\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a72cac70cd2102374a0ce820237c3d655}{keepAllMemory}},\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a978e0b112031bed60263674f71b7f5a5}{fixedPool}});}
\DoxyCodeLine{00553\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_ae6fece579999c6cdabc48ea2c18baee3}{initTLS}}();}
\DoxyCodeLine{00554\ }
\DoxyCodeLine{00555\ \ \ \ \ \textcolor{comment}{//\ i.e.,\ not\ system\ default\ pool\ for\ scalable\_malloc/scalable\_free}}
\DoxyCodeLine{00556\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a6f02801fa5ba692cf62457c0a80079cc}{userPool}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a1d8ad0bd4a6c28ab90a9c0e96a3d1bf7}{rawAlloc}};\ \}}
\DoxyCodeLine{00557\ }
\DoxyCodeLine{00558\ \ \ \ \ \ \textcolor{comment}{//\ true\ if\ something\ has\ been\ released}}
\DoxyCodeLine{00559\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_ae52e603c56025cd8d5fe2f84b21ba442}{softCachesCleanup}}();}
\DoxyCodeLine{00560\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a47b9aace2f0d1d465a4aa47a489c464b}{releaseAllLocalCaches}}();}
\DoxyCodeLine{00561\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_ac31ca686fe2deb68ac82bc4ad23feeb2}{hardCachesCleanup}}();}
\DoxyCodeLine{00562\ \ \ \ \ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_affe492c8041681b5fef472d5cd2f694e}{remap}}(\textcolor{keywordtype}{void}\ *\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}},\ \textcolor{keywordtype}{size\_t}\ oldSize,\ \textcolor{keywordtype}{size\_t}\ newSize,\ \textcolor{keywordtype}{size\_t}\ alignment);}
\DoxyCodeLine{00563\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_ac968da56fa250faad510598e2328c364}{reset}}()\ \{}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a278849f2903427f0b7f96f677204b995}{loc}}.reset();}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_abfc19fab46f65ebb79992d2950494fc3}{allLocalCaches}}.reset();}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a8fa17ab397beaf1680550ef5213d1643}{orphanedBlocks}}.reset();}
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}\ =\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a8b3cd2c2364c73142c7eed261fa14be3}{tlsPointerKey}}.destroy();}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a86fdbadea90130b4aa51a5e1f2bb8fb3}{backend}}.reset();}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}};}
\DoxyCodeLine{00570\ \ \ \ \ \}}
\DoxyCodeLine{00571\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_af47a95f99b29eebecb9c9bbac02c6099}{destroy}}()\ \{}
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_customize_8h_ab07698dd675204d120111c1300b4185c}{MALLOC\_ASSERT}}(\mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_ab66c85117dac4f9bbc977fca349f9887}{isPoolValid}}(),}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Possible\ double\ pool\_destroy\ or\ heap\ corruption"{}});}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a6f02801fa5ba692cf62457c0a80079cc}{userPool}}())\ \{}
\DoxyCodeLine{00575\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a278849f2903427f0b7f96f677204b995}{loc}}.reset();}
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_abfc19fab46f65ebb79992d2950494fc3}{allLocalCaches}}.reset();}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ pthread\_key\_dtors\ must\ be\ disabled\ before\ memory\ unmapping}}
\DoxyCodeLine{00579\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ race-\/free\ solution}}
\DoxyCodeLine{00580\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}\ =\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a8b3cd2c2364c73142c7eed261fa14be3}{tlsPointerKey}}.destroy();}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a993c9d0e9c8a6ca40b76a51c907f662a}{rawFree}}\ ||\ !\mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a6f02801fa5ba692cf62457c0a80079cc}{userPool}}())}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}}\ \&=\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a86fdbadea90130b4aa51a5e1f2bb8fb3}{backend}}.destroy();}
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ pool\ is\ not\ valid\ after\ this\ point}}
\DoxyCodeLine{00584\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a29bfd6715f573c62dd721464fe92698b}{granularity}}\ =\ 0;}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{level1__impl_8h_afb8d513d0298d2695018eb494b092786}{ret}};}
\DoxyCodeLine{00586\ \ \ \ \ \}}
\DoxyCodeLine{00587\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_ae85e5ccabac6221b498dff41ef67ed24}{delayRegionsReleasing}}(\textcolor{keywordtype}{bool}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac279d5806e9bbfc8bd0c0512b9c48fc0}{mode}})\ \{\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a117b9e963f323eebb1742a3d5802fa65}{delayRegsReleasing}}\ =\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac279d5806e9bbfc8bd0c0512b9c48fc0}{mode}};\ \}}
\DoxyCodeLine{00588\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_ada00e383d439f592046706fefeab992c}{regionsAreReleaseable}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00589\ }
\DoxyCodeLine{00590\ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_large_memory_block}{LargeMemoryBlock}}\ *\mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_aacc6cf8e5c7b4e0e31b4d6e8257128e7}{mallocLargeObject}}(\mbox{\hyperlink{classrml_1_1internal_1_1_memory_pool}{MemoryPool}}\ *pool,\ \textcolor{keywordtype}{size\_t}\ allocationSize);}
\DoxyCodeLine{00591\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a5fd4af27aa9529a0f7fe2ec01a192cce}{freeLargeObject}}(\mbox{\hyperlink{structrml_1_1internal_1_1_large_memory_block}{LargeMemoryBlock}}\ *lmb);}
\DoxyCodeLine{00592\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a06321d28bde3009b25988ea85bee7748}{freeLargeObjectList}}(\mbox{\hyperlink{structrml_1_1internal_1_1_large_memory_block}{LargeMemoryBlock}}\ *\mbox{\hyperlink{ittnotify__static_8h_ad492e8facf9b4113e52f1918fceb8804}{head}});}
\DoxyCodeLine{00593\ \ \ \ \ \textcolor{comment}{//\ use\ granulatity\ as\ marker\ for\ pool\ validity}}
\DoxyCodeLine{00594\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_ab66c85117dac4f9bbc977fca349f9887}{isPoolValid}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structrml_1_1internal_1_1_ext_memory_pool_a29bfd6715f573c62dd721464fe92698b}{granularity}};\ \}}
\DoxyCodeLine{00595\ \};}
\DoxyCodeLine{00596\ }
\DoxyCodeLine{00597\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classrml_1_1internal_1_1_backend_a0d970b8baf9c882ee49d4467b88fcd3b}{Backend::inUserPool}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrml_1_1internal_1_1_backend_a3d65ee0374f4adbca30df36a9182c6a3}{extMemPool}}-\/>userPool();\ \}}
\DoxyCodeLine{00598\ }
\DoxyCodeLine{00599\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structrml_1_1internal_1_1_large_object_hdr}{LargeObjectHdr}}\ \{}
\DoxyCodeLine{00600\ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_large_memory_block}{LargeMemoryBlock}}\ *\mbox{\hyperlink{structrml_1_1internal_1_1_large_object_hdr_a2d77c3b9d9a27632c3e7b76818765cc1}{memoryBlock}};}
\DoxyCodeLine{00601\ \ \ \ \ \textcolor{comment}{/*\ Backreference\ points\ to\ LargeObjectHdr.}}
\DoxyCodeLine{00602\ \textcolor{comment}{\ \ \ \ \ \ \ Duplicated\ in\ LargeMemoryBlock\ to\ reuse\ in\ subsequent\ allocations.\ */}}
\DoxyCodeLine{00603\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_back_ref_idx}{BackRefIdx}}\ \ \ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_large_object_hdr_af702dce8b9ebd3e2d73fde65789d5dcd}{backRefIdx}};}
\DoxyCodeLine{00604\ \};}
\DoxyCodeLine{00605\ }
\DoxyCodeLine{00606\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structrml_1_1internal_1_1_free_object}{FreeObject}}\ \{}
\DoxyCodeLine{00607\ \ \ \ \ \mbox{\hyperlink{structrml_1_1internal_1_1_free_object}{FreeObject}}\ \ *\mbox{\hyperlink{structrml_1_1internal_1_1_free_object_adee876800dbeeb0dc522da323d709452}{next}};}
\DoxyCodeLine{00608\ \};}
\DoxyCodeLine{00609\ }
\DoxyCodeLine{00610\ }
\DoxyCodeLine{00611\ \textcolor{comment}{/*******\ A\ helper\ class\ to\ support\ overriding\ malloc\ with\ scalable\_malloc\ *******/}}
\DoxyCodeLine{00612\ \textcolor{preprocessor}{\#if\ MALLOC\_CHECK\_RECURSION}}
\DoxyCodeLine{00613\ }
\DoxyCodeLine{00614\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1_recursive_malloc_call_protector}{RecursiveMallocCallProtector}}\ \{}
\DoxyCodeLine{00615\ \ \ \ \ \textcolor{comment}{//\ pointer\ to\ an\ automatic\ data\ of\ holding\ thread}}
\DoxyCodeLine{00616\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \ \ \ \ \ \ *autoObjPtr;}
\DoxyCodeLine{00617\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{class_malloc_mutex}{MallocMutex}}\ rmc\_mutex;}
\DoxyCodeLine{00618\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{pthread__minport__windows_8h_ad665cf4bf4a61dd23aab712d9c5e9d81}{pthread\_t}}\ \ \ owner\_thread;}
\DoxyCodeLine{00619\ \textcolor{comment}{/*\ Under\ FreeBSD\ 8.0\ 1st\ call\ to\ any\ pthread\ function\ including\ pthread\_self}}
\DoxyCodeLine{00620\ \textcolor{comment}{\ \ \ leads\ to\ pthread\ initialization,\ that\ causes\ malloc\ calls.\ As\ 1st\ usage\ of}}
\DoxyCodeLine{00621\ \textcolor{comment}{\ \ \ RecursiveMallocCallProtector\ can\ be\ before\ pthread\ initialized,\ pthread\ calls}}
\DoxyCodeLine{00622\ \textcolor{comment}{\ \ \ can't\ be\ used\ in\ 1st\ instance\ of\ RecursiveMallocCallProtector.}}
\DoxyCodeLine{00623\ \textcolor{comment}{\ \ \ RecursiveMallocCallProtector\ is\ used\ 1st\ time\ in\ checkInitialization(),}}
\DoxyCodeLine{00624\ \textcolor{comment}{\ \ \ so\ there\ is\ a\ guarantee\ that\ on\ 2nd\ usage\ pthread\ is\ initialized.}}
\DoxyCodeLine{00625\ \textcolor{comment}{\ \ \ No\ such\ situation\ observed\ with\ other\ supported\ OSes.}}
\DoxyCodeLine{00626\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00627\ \textcolor{preprocessor}{\#if\ \_\_FreeBSD\_\_}}
\DoxyCodeLine{00628\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \ \ \ \ \ \ \ canUsePthread;}
\DoxyCodeLine{00629\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00630\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ \ canUsePthread\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00631\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00632\ \textcolor{comment}{/*}}
\DoxyCodeLine{00633\ \textcolor{comment}{\ \ The\ variable\ modified\ in\ checkInitialization,}}
\DoxyCodeLine{00634\ \textcolor{comment}{\ \ so\ can\ be\ read\ without\ memory\ barriers.}}
\DoxyCodeLine{00635\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00636\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ mallocRecursionDetected;}
\DoxyCodeLine{00637\ }
\DoxyCodeLine{00638\ \ \ \ \ \mbox{\hyperlink{class_malloc_mutex_1_1scoped__lock}{MallocMutex::scoped\_lock}}*\ lock\_acquired;}
\DoxyCodeLine{00639\ \ \ \ \ \textcolor{keywordtype}{char}\ scoped\_lock\_space[\textcolor{keyword}{sizeof}(\mbox{\hyperlink{class_malloc_mutex_1_1scoped__lock}{MallocMutex::scoped\_lock}})+1];}
\DoxyCodeLine{00640\ }
\DoxyCodeLine{00641\ \ \ \ \ \textcolor{keyword}{static}\ uintptr\_t\ absDiffPtr(\textcolor{keywordtype}{void}\ *\mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}},\ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a5e247fc24ceb70d83f6ad59149b8910a}{y}})\ \{}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \ \ uintptr\_t\ xi\ =\ (uintptr\_t)\mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}},\ yi\ =\ (uintptr\_t)\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a5e247fc24ceb70d83f6ad59149b8910a}{y}};}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ xi\ >\ yi\ ?\ xi\ -\/\ yi\ :\ yi\ -\/\ xi;}
\DoxyCodeLine{00644\ \ \ \ \ \}}
\DoxyCodeLine{00645\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00646\ }
\DoxyCodeLine{00647\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_recursive_malloc_call_protector_abc2eea6439720a370759e1c782292163}{RecursiveMallocCallProtector}}()\ :\ lock\_acquired(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \ \ lock\_acquired\ =\ \textcolor{keyword}{new}\ (scoped\_lock\_space)\ \mbox{\hyperlink{class_malloc_mutex_afcf922650b2fd9d76b7b939d8511bbd8}{MallocMutex::scoped\_lock}}(\ rmc\_mutex\ );}
\DoxyCodeLine{00649\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (canUsePthread)}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \ \ \ \ \ \ owner\_thread\ =\ \mbox{\hyperlink{pthread__minport__windows_8h_a31ffbf449d7404f9bb088564190c6bce}{pthread\_self}}();}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \ \ autoObjPtr\ =\ \&scoped\_lock\_space;}
\DoxyCodeLine{00652\ \ \ \ \ \}}
\DoxyCodeLine{00653\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_recursive_malloc_call_protector_a642881e8884cd6f6fa9cd6474b429185}{\string~RecursiveMallocCallProtector}}()\ \{}
\DoxyCodeLine{00654\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (lock\_acquired)\ \{}
\DoxyCodeLine{00655\ \ \ \ \ \ \ \ \ \ \ \ \ autoObjPtr\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00656\ \ \ \ \ \ \ \ \ \ \ \ \ lock\_acquired-\/>\mbox{\hyperlink{class_malloc_mutex_1_1scoped__lock_adf8a660ee9d1808930cdcd5e3fdc94b5}{\string~scoped\_lock}}();}
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00658\ \ \ \ \ \}}
\DoxyCodeLine{00659\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ sameThreadActive()\ \{}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!autoObjPtr)\ \textcolor{comment}{//\ fast\ path}}
\DoxyCodeLine{00661\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00662\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Some\ thread\ has\ an\ active\ recursive\ call\ protector;\ check\ if\ the\ current\ one.}}
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Exact\ pthread\_self\ based\ test}}
\DoxyCodeLine{00664\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (canUsePthread)\ \{}
\DoxyCodeLine{00665\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pthread\_equal(\ owner\_thread,\ \mbox{\hyperlink{pthread__minport__windows_8h_a31ffbf449d7404f9bb088564190c6bce}{pthread\_self}}()\ ))\ \{}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mallocRecursionDetected\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00667\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00668\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00671\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ inexact\ stack\ size\ based\ test}}
\DoxyCodeLine{00672\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedetail_a0414a8c27708e113938314ad3b0dbe4c}{uintptr\_t}}\ threadStackSz\ =\ 2*1024*1024;}
\DoxyCodeLine{00673\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespace_c_l_i_1_1detail_a01c35a876e2917ffdc1ee618e0c06619}{dummy}};}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ absDiffPtr(autoObjPtr,\ \&dummy)<threadStackSz;}
\DoxyCodeLine{00675\ \ \ \ \ \}}
\DoxyCodeLine{00676\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ noRecursion();}
\DoxyCodeLine{00677\ \textcolor{comment}{/*\ The\ function\ is\ called\ on\ 1st\ scalable\_malloc\ call\ to\ check\ if\ malloc\ calls}}
\DoxyCodeLine{00678\ \textcolor{comment}{\ \ \ scalable\_malloc\ (nested\ call\ must\ set\ mallocRecursionDetected).\ */}}
\DoxyCodeLine{00679\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ detectNaiveOverload()\ \{}
\DoxyCodeLine{00680\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{_customize_8h_a056864f8982c76f5266b022955bf6ff0}{malloc\_proxy}})\ \{}
\DoxyCodeLine{00681\ \textcolor{preprocessor}{\#if\ \_\_FreeBSD\_\_}}
\DoxyCodeLine{00682\ \textcolor{comment}{/*\ If\ !canUsePthread,\ we\ can't\ call\ pthread\_self()\ before,\ but\ now\ pthread}}
\DoxyCodeLine{00683\ \textcolor{comment}{\ \ \ is\ already\ on,\ so\ can\ do\ it.\ */}}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!canUsePthread)\ \{}
\DoxyCodeLine{00685\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ canUsePthread\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00686\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ owner\_thread\ =\ \mbox{\hyperlink{pthread__minport__windows_8h_a31ffbf449d7404f9bb088564190c6bce}{pthread\_self}}();}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00688\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00689\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mimalloc-override_8h_a9d4b5df3530d1bc733070a4669ba6ebc}{free}}(\mbox{\hyperlink{mimalloc-override_8h_a99aa8fd9f4831e1b0fa9e1cdcde3e249}{malloc}}(1));}
\DoxyCodeLine{00690\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00691\ \ \ \ \ \}}
\DoxyCodeLine{00692\ \};}
\DoxyCodeLine{00693\ }
\DoxyCodeLine{00694\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00695\ }
\DoxyCodeLine{00696\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1_recursive_malloc_call_protector_abc2eea6439720a370759e1c782292163}{RecursiveMallocCallProtector}}\ \{}
\DoxyCodeLine{00697\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00698\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_recursive_malloc_call_protector_abc2eea6439720a370759e1c782292163}{RecursiveMallocCallProtector}}()\ \{\}}
\DoxyCodeLine{00699\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1_recursive_malloc_call_protector_a642881e8884cd6f6fa9cd6474b429185}{\string~RecursiveMallocCallProtector}}()\ \{\}}
\DoxyCodeLine{00700\ \};}
\DoxyCodeLine{00701\ }
\DoxyCodeLine{00702\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{/*\ MALLOC\_CHECK\_RECURSION\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00703\ }
\DoxyCodeLine{00704\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespacerml_1_1internal_acc91531a75193a3a4541a68b4771905b}{isMallocInitializedExt}}();}
\DoxyCodeLine{00705\ }
\DoxyCodeLine{00706\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespacerml_1_1internal_a2877b2db91c23b8b7eb1d37891c40b2b}{getThreadId}}();}
\DoxyCodeLine{00707\ }
\DoxyCodeLine{00708\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespacerml_1_1internal_a35c262cb0badff1e3b2a9df6357a344a}{initBackRefMaster}}(\mbox{\hyperlink{classrml_1_1internal_1_1_backend}{Backend}}\ *backend);}
\DoxyCodeLine{00709\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacerml_1_1internal_aa12c65924c02c876057332f2f2d4df6b}{destroyBackRefMaster}}(\mbox{\hyperlink{classrml_1_1internal_1_1_backend}{Backend}}\ *backend);}
\DoxyCodeLine{00710\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacerml_1_1internal_ab8e65fb38698f5544e2b1fa3127bec85}{removeBackRef}}(\mbox{\hyperlink{classrml_1_1internal_1_1_back_ref_idx}{BackRefIdx}}\ backRefIdx);}
\DoxyCodeLine{00711\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacerml_1_1internal_aa5ddbf0f60817126c51b54ca648caf34}{setBackRef}}(\mbox{\hyperlink{classrml_1_1internal_1_1_back_ref_idx}{BackRefIdx}}\ backRefIdx,\ \textcolor{keywordtype}{void}\ *newPtr);}
\DoxyCodeLine{00712\ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{namespacerml_1_1internal_a674d3a46d675ee1887142a9118f48927}{getBackRef}}(\mbox{\hyperlink{classrml_1_1internal_1_1_back_ref_idx}{BackRefIdx}}\ backRefIdx);}
\DoxyCodeLine{00713\ }
\DoxyCodeLine{00714\ \}\ \textcolor{comment}{//\ namespace\ internal}}
\DoxyCodeLine{00715\ \}\ \textcolor{comment}{//\ namespace\ rml}}
\DoxyCodeLine{00716\ }
\DoxyCodeLine{00717\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ \_\_TBB\_tbbmalloc\_internal\_H}}

\end{DoxyCode}
