\doxysection{free.\+c}
\hypertarget{free_8c_source}{}\label{free_8c_source}\index{runtime/EASTL/packages/mimalloc/src/free.c@{runtime/EASTL/packages/mimalloc/src/free.c}}
\mbox{\hyperlink{free_8c}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00002\ \textcolor{comment}{Copyright\ (c)\ 2018-\/2024,\ Microsoft\ Research,\ Daan\ Leijen}}
\DoxyCodeLine{00003\ \textcolor{comment}{This\ is\ free\ software;\ you\ can\ redistribute\ it\ and/or\ modify\ it\ under\ the}}
\DoxyCodeLine{00004\ \textcolor{comment}{terms\ of\ the\ MIT\ license.\ A\ copy\ of\ the\ license\ can\ be\ found\ in\ the\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{"{}LICENSE"{}\ at\ the\ root\ of\ this\ distribution.}}
\DoxyCodeLine{00006\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#if\ !defined(MI\_IN\_ALLOC\_C)}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#error\ "{}this\ file\ should\ be\ included\ from\ 'alloc.c'\ (so\ aliases\ can\ work\ from\ alloc-\/override)"{}}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ add\ includes\ help\ an\ IDE}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mimalloc_8h}{mimalloc.h}}"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h}{mimalloc/internal.h}}"{}}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{prim_8h}{mimalloc/prim.h}}"{}}\ \ \ \textcolor{comment}{//\ \_mi\_prim\_thread\_id()}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{comment}{//\ forward\ declarations}}
\DoxyCodeLine{00016\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \ \ \mbox{\hyperlink{free_8c_a607d73b1962b5676b5fb0a58d0eda6d8}{mi\_check\_padding}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});}
\DoxyCodeLine{00017\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \ \ \mbox{\hyperlink{free_8c_ad23f1572e5f6b82c4c59a43fb9f0595d}{mi\_check\_is\_double\_free}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});}
\DoxyCodeLine{00018\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{free_8c_a26335e66b160c5319806a2e33f7b70e7}{mi\_page\_usable\_size\_of}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});}
\DoxyCodeLine{00019\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \ \ \mbox{\hyperlink{free_8c_a559045bfe8e993e8ee3e7aef40cf1e35}{mi\_stat\_free}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00023\ \textcolor{comment}{//\ Free}}
\DoxyCodeLine{00024\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{comment}{//\ regular\ free\ of\ a\ (thread\ local)\ block\ pointer}}
\DoxyCodeLine{00027\ \textcolor{comment}{//\ fast\ path\ written\ carefully\ to\ prevent\ spilling\ on\ the\ stack}}
\DoxyCodeLine{00028\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{free_8c_a4ea336aeb08fb4786186f6087a751d3c}{mi\_free\_block\_local}}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \textcolor{keywordtype}{bool}\ track\_stats,\ \textcolor{keywordtype}{bool}\ check\_full)}
\DoxyCodeLine{00029\ \{}
\DoxyCodeLine{00030\ \ \ \textcolor{comment}{//\ checks}}
\DoxyCodeLine{00031\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}(\mbox{\hyperlink{free_8c_ad23f1572e5f6b82c4c59a43fb9f0595d}{mi\_check\_is\_double\_free}}(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}}))\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00032\ \ \ \mbox{\hyperlink{free_8c_a607d73b1962b5676b5fb0a58d0eda6d8}{mi\_check\_padding}}(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});}
\DoxyCodeLine{00033\ \ \ \textcolor{keywordflow}{if}\ (track\_stats)\ \{\ \mbox{\hyperlink{free_8c_a559045bfe8e993e8ee3e7aef40cf1e35}{mi\_stat\_free}}(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});\ \}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\ \ \#if\ (MI\_DEBUG>0)\ \&\&\ !MI\_TRACK\_ENABLED\ \ \&\&\ !MI\_TSAN\ \&\&\ !MI\_GUARDED}}
\DoxyCodeLine{00035\ \ \ memset(\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \mbox{\hyperlink{types_8h_a9833600e75eebe5273228f5afc8727c5}{MI\_DEBUG\_FREED}},\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a6134893990c1f09da2b40092ceecc780}{mi\_page\_block\_size}}(page));}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00037\ \ \ \textcolor{keywordflow}{if}\ (track\_stats)\ \{\ \mbox{\hyperlink{track_8h_af7a8e838cb26deff135877a04188d6ff}{mi\_track\_free\_size}}(\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \mbox{\hyperlink{free_8c_a26335e66b160c5319806a2e33f7b70e7}{mi\_page\_usable\_size\_of}}(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}}));\ \}\ \textcolor{comment}{//\ faster\ then\ mi\_usable\_size\ as\ we\ already\ know\ the\ page\ and\ that\ p\ is\ unaligned}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \textcolor{comment}{//\ actual\ free:\ push\ on\ the\ local\ free\ list}}
\DoxyCodeLine{00040\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac7b440a922454c163ed1139aac9b946d}{mi\_block\_set\_next}}(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ page-\/>\mbox{\hyperlink{structmi__page__s_a9ed7774dcbd4de583d1594d698128830}{local\_free}});}
\DoxyCodeLine{00041\ \ \ page-\/>\mbox{\hyperlink{structmi__page__s_a9ed7774dcbd4de583d1594d698128830}{local\_free}}\ =\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}};}
\DoxyCodeLine{00042\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}(-\/-\/page-\/>\mbox{\hyperlink{structmi__page__s_ad1194a6cecba67ba2cf1952eb337968c}{used}}\ ==\ 0)\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a54b1e58a3b88604ea8dc4d9220f4c32c}{\_mi\_page\_retire}}(page);}
\DoxyCodeLine{00044\ \ \ \}}
\DoxyCodeLine{00045\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}(check\_full\ \&\&\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a250f4d0710309fb1cff782cd06644842}{mi\_page\_is\_in\_full}}(page))\ \{}
\DoxyCodeLine{00046\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a56fb2dd5b89d7848f041fc2f9ad189a0}{\_mi\_page\_unfull}}(page);}
\DoxyCodeLine{00047\ \ \ \}}
\DoxyCodeLine{00048\ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \textcolor{comment}{//\ Forward\ declaration\ for\ multi-\/threaded\ collect}}
\DoxyCodeLine{00051\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a0a63ad6116421ea60eb43806f8881a3b}{mi\_decl\_noinline}}\ \mbox{\hyperlink{free_8c_a95d8dc8cc63abfde145fac55e9353d24}{mi\_free\_try\_collect\_mt}}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ mt\_free)\ \mbox{\hyperlink{mimalloc_8h_a2d1ca113437044da99abaaedd0b36ed8}{mi\_attr\_noexcept}};}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \textcolor{comment}{//\ Free\ a\ block\ multi-\/threaded}}
\DoxyCodeLine{00054\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{free_8c_af5ffcf95b8bfc34e499ae3b203e72475}{mi\_free\_block\_mt}}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}})\ \mbox{\hyperlink{mimalloc_8h_a2d1ca113437044da99abaaedd0b36ed8}{mi\_attr\_noexcept}}}
\DoxyCodeLine{00055\ \{}
\DoxyCodeLine{00056\ \ \ \textcolor{comment}{//\ adjust\ stats\ (after\ padding\ check\ and\ potentially\ recursive\ \`{}mi\_free`\ above)}}
\DoxyCodeLine{00057\ \ \ \mbox{\hyperlink{free_8c_a559045bfe8e993e8ee3e7aef40cf1e35}{mi\_stat\_free}}(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});\ \ \ \ \textcolor{comment}{//\ stat\_free\ may\ access\ the\ padding}}
\DoxyCodeLine{00058\ \ \ \mbox{\hyperlink{track_8h_af7a8e838cb26deff135877a04188d6ff}{mi\_track\_free\_size}}(\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \mbox{\hyperlink{free_8c_a26335e66b160c5319806a2e33f7b70e7}{mi\_page\_usable\_size\_of}}(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}}));}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ \textcolor{comment}{//\ \_mi\_padding\_shrink(page,\ block,\ sizeof(mi\_block\_t));}}
\DoxyCodeLine{00061\ \textcolor{preprocessor}{\#if\ (MI\_DEBUG>0)\ \&\&\ !MI\_TRACK\_ENABLED\ \ \&\&\ !MI\_TSAN\ \ \ \ \ \ \ }\textcolor{comment}{//\ note:\ when\ tracking,\ cannot\ use\ mi\_usable\_size\ with\ multi-\/threading}}
\DoxyCodeLine{00062\ \ \ \textcolor{keywordtype}{size\_t}\ dbgsize\ =\ \mbox{\hyperlink{free_8c_ad4efa3dd9163181d18af0361e45dac86}{mi\_usable\_size}}(\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});}
\DoxyCodeLine{00063\ \ \ \textcolor{keywordflow}{if}\ (dbgsize\ >\ \mbox{\hyperlink{bits_8h_a2957d2f636a8bafeb4873446283d10bf}{MI\_MiB}})\ \{\ dbgsize\ =\ \mbox{\hyperlink{bits_8h_a2957d2f636a8bafeb4873446283d10bf}{MI\_MiB}};\ \}}
\DoxyCodeLine{00064\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a770dbf90c89e7e7761f2f99c0fc28115}{\_mi\_memset\_aligned}}(\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \mbox{\hyperlink{types_8h_a9833600e75eebe5273228f5afc8727c5}{MI\_DEBUG\_FREED}},\ dbgsize);}
\DoxyCodeLine{00065\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \textcolor{comment}{//\ push\ atomically\ on\ the\ page\ thread\ free\ list}}
\DoxyCodeLine{00068\ \ \ \mbox{\hyperlink{types_8h_aa9fb16bc3b4469d57c7b2747c6718b15}{mi\_thread\_free\_t}}\ tf\_new;}
\DoxyCodeLine{00069\ \ \ \mbox{\hyperlink{types_8h_aa9fb16bc3b4469d57c7b2747c6718b15}{mi\_thread\_free\_t}}\ tf\_old\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&page-\/>xthread\_free);}
\DoxyCodeLine{00070\ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00071\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac7b440a922454c163ed1139aac9b946d}{mi\_block\_set\_next}}(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a68f9b45db9fe19930366d0e473bdf791}{mi\_tf\_block}}(tf\_old));}
\DoxyCodeLine{00072\ \ \ \ \ tf\_new\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ae5ecd5e45278bd147fbe6720cba0f323}{mi\_tf\_create}}(\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \textcolor{keyword}{true}\ \textcolor{comment}{/*\ always\ use\ owned:\ try\ to\ claim\ it\ if\ the\ page\ is\ abandoned\ */});}
\DoxyCodeLine{00073\ \ \ \}\ \textcolor{keywordflow}{while}\ (!\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a04332d02087d9b0e7ad9197c34358177}{mi\_atomic\_cas\_weak\_acq\_rel}}(\&page-\/>xthread\_free,\ \&tf\_old,\ tf\_new));\ \textcolor{comment}{//\ todo:\ release\ is\ enough?}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \textcolor{comment}{//\ and\ atomically\ try\ to\ collect\ the\ page\ if\ it\ was\ abandoned}}
\DoxyCodeLine{00076\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ is\_owned\_now\ =\ !\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa501cc20d36064923e3d70c4a08879c4}{mi\_tf\_is\_owned}}(tf\_old);}
\DoxyCodeLine{00077\ \ \ \textcolor{keywordflow}{if}\ (is\_owned\_now)\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa75f964d916bd58a37861b88491c51fb}{mi\_page\_is\_abandoned}}(page));}
\DoxyCodeLine{00079\ \ \ \ \ \mbox{\hyperlink{free_8c_a95d8dc8cc63abfde145fac55e9353d24}{mi\_free\_try\_collect\_mt}}(page,\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});}
\DoxyCodeLine{00080\ \ \ \}}
\DoxyCodeLine{00081\ \}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \textcolor{comment}{//\ Adjust\ a\ block\ that\ was\ allocated\ aligned,\ to\ the\ actual\ start\ of\ the\ block\ in\ the\ page.}}
\DoxyCodeLine{00085\ \textcolor{comment}{//\ note:\ this\ can\ be\ called\ from\ \`{}mi\_free\_generic\_mt`\ where\ a\ non-\/owning\ thread\ accesses\ the}}
\DoxyCodeLine{00086\ \textcolor{comment}{//\ \`{}page\_start`\ and\ \`{}block\_size`\ fields;\ however\ these\ are\ constant\ and\ the\ page\ won't\ be}}
\DoxyCodeLine{00087\ \textcolor{comment}{//\ deallocated\ (as\ the\ block\ we\ are\ freeing\ keeps\ it\ alive)\ and\ thus\ safe\ to\ read\ concurrently.}}
\DoxyCodeLine{00088\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{free_8c_a02c896f799e571b628b2d7747ca9f771}{\_mi\_page\_ptr\_unalign}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \{}
\DoxyCodeLine{00089\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(page!=\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ \&\&\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}!=\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \textcolor{keywordtype}{size\_t}\ diff\ =\ (\mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*)\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ -\/\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a95e8b035747d340ad060f5cf0811b7e9}{mi\_page\_start}}(page);}
\DoxyCodeLine{00092\ \ \ \textcolor{keywordtype}{size\_t}\ adjust;}
\DoxyCodeLine{00093\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a7b29eabf31d4ddb28a16267045384e03}{mi\_likely}}(page-\/>\mbox{\hyperlink{structmi__page__s_a1be9844192c793c997a041ccea53e726}{block\_size\_shift}}\ !=\ 0)\ \{}
\DoxyCodeLine{00094\ \ \ \ \ adjust\ =\ diff\ \&\ (((size\_t)1\ <<\ page-\/>\mbox{\hyperlink{structmi__page__s_a1be9844192c793c997a041ccea53e726}{block\_size\_shift}})\ -\/\ 1);}
\DoxyCodeLine{00095\ \ \ \}}
\DoxyCodeLine{00096\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00097\ \ \ \ \ adjust\ =\ diff\ \%\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a6134893990c1f09da2b40092ceecc780}{mi\_page\_block\_size}}(page);}
\DoxyCodeLine{00098\ \ \ \}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*)((uintptr\_t)\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ -\/\ adjust);}
\DoxyCodeLine{00101\ \}}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \textcolor{comment}{//\ forward\ declaration\ for\ a\ MI\_GUARDED\ build}}
\DoxyCodeLine{00104\ \textcolor{preprocessor}{\#if\ MI\_GUARDED}}
\DoxyCodeLine{00105\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ mi\_block\_unguard(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});\ \textcolor{comment}{//\ forward\ declaration}}
\DoxyCodeLine{00106\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{free_8c_a9faffbac5f73a12ca8d2567027a1c43a}{mi\_block\_check\_unguard}}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \{}
\DoxyCodeLine{00107\ \ \ \textcolor{keywordflow}{if}\ (mi\_block\_ptr\_is\_guarded(\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}))\ \{\ mi\_block\_unguard(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});\ \}}
\DoxyCodeLine{00108\ \}}
\DoxyCodeLine{00109\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00110\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{free_8c_a9faffbac5f73a12ca8d2567027a1c43a}{mi\_block\_check\_unguard}}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \{}
\DoxyCodeLine{00111\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(page);\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00112\ \}}
\DoxyCodeLine{00113\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \textcolor{comment}{//\ free\ a\ local\ pointer\ \ (page\ parameter\ comes\ first\ for\ better\ codegen)}}
\DoxyCodeLine{00117\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a0a63ad6116421ea60eb43806f8881a3b}{mi\_decl\_noinline}}\ \mbox{\hyperlink{free_8c_a2e61936ec89160d051a72f0d1f95424f}{mi\_free\_generic\_local}}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \mbox{\hyperlink{mimalloc_8h_a2d1ca113437044da99abaaedd0b36ed8}{mi\_attr\_noexcept}}\ \{}
\DoxyCodeLine{00118\ \ \ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \textcolor{keyword}{const}\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}}\ =\ (\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ae0b5641b1e2fabf59c84685e08520852}{mi\_page\_has\_aligned}}(page)\ ?\ \mbox{\hyperlink{free_8c_a02c896f799e571b628b2d7747ca9f771}{\_mi\_page\_ptr\_unalign}}(page,\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ :\ (\mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*)\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00119\ \ \ \mbox{\hyperlink{free_8c_a9faffbac5f73a12ca8d2567027a1c43a}{mi\_block\_check\_unguard}}(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00120\ \ \ \mbox{\hyperlink{free_8c_a4ea336aeb08fb4786186f6087a751d3c}{mi\_free\_block\_local}}(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \textcolor{keyword}{true}\ \textcolor{comment}{/*\ track\ stats\ */},\ \textcolor{keyword}{true}\ \textcolor{comment}{/*\ check\ for\ a\ full\ page\ */});}
\DoxyCodeLine{00121\ \}}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \textcolor{comment}{//\ free\ a\ pointer\ owned\ by\ another\ thread\ (page\ parameter\ comes\ first\ for\ better\ codegen)}}
\DoxyCodeLine{00124\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a0a63ad6116421ea60eb43806f8881a3b}{mi\_decl\_noinline}}\ \mbox{\hyperlink{free_8c_acc3316883c1cf74f78cb41e5d1b46ced}{mi\_free\_generic\_mt}}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \mbox{\hyperlink{mimalloc_8h_a2d1ca113437044da99abaaedd0b36ed8}{mi\_attr\_noexcept}}\ \{}
\DoxyCodeLine{00125\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}==\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \textcolor{keywordflow}{return};\ \ \textcolor{comment}{//\ a\ NULL\ pointer\ is\ seen\ as\ abandoned\ (tid==0)\ with\ a\ full\ flag\ set}}
\DoxyCodeLine{00126\ \textcolor{preprocessor}{\ \ \#if\ !MI\_PAGE\_MAP\_FLAT}}
\DoxyCodeLine{00127\ \ \ \textcolor{keywordflow}{if}\ (page==\&\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a40799c89ba077392c3973651035476aa}{\_mi\_page\_empty}})\ \textcolor{keywordflow}{return};\ \ \textcolor{comment}{//\ an\ invalid\ pointer\ may\ lead\ to\ using\ the\ empty\ page}}
\DoxyCodeLine{00128\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00129\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}!=\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ \&\&\ page\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ \&\&\ page\ !=\ \&\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a40799c89ba077392c3973651035476aa}{\_mi\_page\_empty}});}
\DoxyCodeLine{00130\ \ \ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \textcolor{keyword}{const}\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}}\ =\ \mbox{\hyperlink{free_8c_a02c896f799e571b628b2d7747ca9f771}{\_mi\_page\_ptr\_unalign}}(page,\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});\ \textcolor{comment}{//\ don't\ check\ \`{}has\_aligned`\ flag\ to\ avoid\ a\ race\ (issue\ \#865)}}
\DoxyCodeLine{00131\ \ \ \mbox{\hyperlink{free_8c_a9faffbac5f73a12ca8d2567027a1c43a}{mi\_block\_check\_unguard}}(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00132\ \ \ \mbox{\hyperlink{free_8c_af5ffcf95b8bfc34e499ae3b203e72475}{mi\_free\_block\_mt}}(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});}
\DoxyCodeLine{00133\ \}}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \textcolor{comment}{//\ generic\ free\ (for\ runtime\ integration)}}
\DoxyCodeLine{00136\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a0a63ad6116421ea60eb43806f8881a3b}{mi\_decl\_noinline}}\ \mbox{\hyperlink{free_8c_a574af39e99e98dddb5847f7c02019208}{\_mi\_free\_generic}}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keywordtype}{bool}\ is\_local,\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \mbox{\hyperlink{mimalloc_8h_a2d1ca113437044da99abaaedd0b36ed8}{mi\_attr\_noexcept}}\ \{}
\DoxyCodeLine{00137\ \ \ \textcolor{keywordflow}{if}\ (is\_local)\ \mbox{\hyperlink{free_8c_a2e61936ec89160d051a72f0d1f95424f}{mi\_free\_generic\_local}}(page,\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \mbox{\hyperlink{free_8c_acc3316883c1cf74f78cb41e5d1b46ced}{mi\_free\_generic\_mt}}(page,\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00139\ \}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \textcolor{comment}{//\ Get\ the\ page\ belonging\ to\ a\ pointer}}
\DoxyCodeLine{00143\ \textcolor{comment}{//\ Does\ further\ checks\ in\ debug\ mode\ to\ see\ if\ this\ was\ a\ valid\ pointer.}}
\DoxyCodeLine{00144\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ \mbox{\hyperlink{free_8c_a3c325fa47ff6342dca1b913607844b93}{mi\_validate\_ptr\_page}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ msg)}
\DoxyCodeLine{00145\ \{}
\DoxyCodeLine{00146\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_abe843fae7b0161386d403d8ec7e0b6e0}{MI\_UNUSED\_RELEASE}}(msg);}
\DoxyCodeLine{00147\ \textcolor{preprocessor}{\ \ \#if\ MI\_DEBUG}}
\DoxyCodeLine{00148\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}(((uintptr\_t)\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ \&\ (\mbox{\hyperlink{bits_8h_af8a1f49c3ca95474d8fc5fdb53874026}{MI\_INTPTR\_SIZE}}\ -\/\ 1))\ !=\ 0\ \&\&\ !\mbox{\hyperlink{group__options_ga459ad98f18b3fc9275474807fe0ca188}{mi\_option\_is\_enabled}}(\mbox{\hyperlink{mimalloc_8h_acf0af9f50d2fca76b4e158d611bc930ba1eaf89bb1698f988cec27b66e546760c}{mi\_option\_guarded\_precise}}))\ \{}
\DoxyCodeLine{00149\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a2bebc073bcaac71658e57bb260c2e426}{\_mi\_error\_message}}(\mbox{\hyperlink{types_8h_a2d1678d5a7cc8ce499643f3b8957def4}{EINVAL}},\ \textcolor{stringliteral}{"{}\%s:\ invalid\ (unaligned)\ pointer:\ \%p\(\backslash\)n"{}},\ msg,\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00151\ \ \ \}}
\DoxyCodeLine{00152\ \ \ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa93d85305e51471aa1951ab818628a63}{\_mi\_safe\_ptr\_page}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00153\ \ \ \textcolor{keywordflow}{if}\ (page\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a2bebc073bcaac71658e57bb260c2e426}{\_mi\_error\_message}}(\mbox{\hyperlink{types_8h_a2d1678d5a7cc8ce499643f3b8957def4}{EINVAL}},\ \textcolor{stringliteral}{"{}\%s:\ invalid\ pointer:\ \%p\(\backslash\)n"{}},\ msg,\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00156\ \ \ \ \ \}}
\DoxyCodeLine{00157\ \textcolor{preprocessor}{\ \ \ \ \#if\ !MI\_PAGE\_MAP\_FLAT}}
\DoxyCodeLine{00158\ \ \ \ \ page\ =\ (\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*)\&\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a40799c89ba077392c3973651035476aa}{\_mi\_page\_empty}};}
\DoxyCodeLine{00159\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{00160\ \ \ \}}
\DoxyCodeLine{00161\ \ \ \textcolor{keywordflow}{return}\ page;}
\DoxyCodeLine{00162\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00163\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_acd84a462a2045538d19ecc56e6cc29f6}{\_mi\_ptr\_page}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00164\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00165\ \}}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \textcolor{comment}{//\ Free\ a\ block}}
\DoxyCodeLine{00168\ \textcolor{comment}{//\ Fast\ path\ written\ carefully\ to\ prevent\ register\ spilling\ on\ the\ stack}}
\DoxyCodeLine{00169\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{group__malloc_gaf2c7b89c327d1f60f59e68b9ea644d95}{mi\_free}}(\textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \mbox{\hyperlink{mimalloc_8h_a2d1ca113437044da99abaaedd0b36ed8}{mi\_attr\_noexcept}}}
\DoxyCodeLine{00170\ \{}
\DoxyCodeLine{00171\ \ \ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ \textcolor{keyword}{const}\ page\ =\ \mbox{\hyperlink{free_8c_a3c325fa47ff6342dca1b913607844b93}{mi\_validate\_ptr\_page}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\textcolor{stringliteral}{"{}mi\_free"{}});}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \textcolor{preprocessor}{\ \ \#if\ MI\_PAGE\_MAP\_FLAT\ \ }\textcolor{comment}{//\ if\ not\ flat,\ p==NULL\ leads\ to\ \`{}\_mi\_page\_empty`\ which\ leads\ to\ \`{}mi\_free\_generic\_mt`}}
\DoxyCodeLine{00174\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}(page==\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00175\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00176\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(page!=\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_ae3342b51ed88dd82fa3903ca1727e8a8}{mi\_threadid\_t}}\ xtid\ =\ (\mbox{\hyperlink{prim_8h_a3875c92cbb791d0a7c69bc1fd2df6804}{\_mi\_prim\_thread\_id}}()\ \string^\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_af15a53be4fb9aa00af3c25632b1b1dac}{mi\_page\_xthread\_id}}(page));}
\DoxyCodeLine{00179\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a7b29eabf31d4ddb28a16267045384e03}{mi\_likely}}(xtid\ ==\ 0)\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \`{}tid\ ==\ mi\_page\_thread\_id(page)\ \&\&\ mi\_page\_flags(page)\ ==\ 0`}}
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{comment}{//\ thread-\/local,\ aligned,\ and\ not\ a\ full\ page}}
\DoxyCodeLine{00181\ \ \ \ \ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \textcolor{keyword}{const}\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}}\ =\ (\mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*)\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}};}
\DoxyCodeLine{00182\ \ \ \ \ \mbox{\hyperlink{free_8c_a4ea336aeb08fb4786186f6087a751d3c}{mi\_free\_block\_local}}(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \textcolor{keyword}{true}\ \textcolor{comment}{/*\ track\ stats\ */},\ \textcolor{keyword}{false}\ \textcolor{comment}{/*\ no\ need\ to\ check\ if\ the\ page\ is\ full\ */});}
\DoxyCodeLine{00183\ \ \ \}}
\DoxyCodeLine{00184\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (xtid\ <=\ \mbox{\hyperlink{types_8h_ad7f6838e0ce408430e539ac2986175b8}{MI\_PAGE\_FLAG\_MASK}})\ \{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \`{}tid\ ==\ mi\_page\_thread\_id(page)\ \&\&\ mi\_page\_flags(page)\ !=\ 0`}}
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{comment}{//\ page\ is\ local,\ but\ is\ full\ or\ contains\ (inner)\ aligned\ blocks;\ use\ generic\ path}}
\DoxyCodeLine{00186\ \ \ \ \ \mbox{\hyperlink{free_8c_a2e61936ec89160d051a72f0d1f95424f}{mi\_free\_generic\_local}}(page,\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00187\ \ \ \}}
\DoxyCodeLine{00188\ \ \ \textcolor{comment}{//\ free-\/ing\ in\ a\ page\ owned\ by\ a\ heap\ in\ another\ thread,\ or\ an\ abandoned\ page\ (not\ belonging\ to\ a\ heap)}}
\DoxyCodeLine{00189\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((xtid\ \&\ \mbox{\hyperlink{types_8h_ad7f6838e0ce408430e539ac2986175b8}{MI\_PAGE\_FLAG\_MASK}})\ ==\ 0)\ \{\ \ \ \ \ \ \textcolor{comment}{//\ \`{}tid\ !=\ mi\_page\_thread\_id(page)\ \&\&\ mi\_page\_flags(page)\ ==\ 0`}}
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{comment}{//\ blocks\ are\ aligned\ (and\ not\ a\ full\ page);\ push\ on\ the\ thread\_free\ list}}
\DoxyCodeLine{00191\ \ \ \ \ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \textcolor{keyword}{const}\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}}\ =\ (\mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*)\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}};}
\DoxyCodeLine{00192\ \ \ \ \ \mbox{\hyperlink{free_8c_af5ffcf95b8bfc34e499ae3b203e72475}{mi\_free\_block\_mt}}(page,\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});}
\DoxyCodeLine{00193\ \ \ \}}
\DoxyCodeLine{00194\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{comment}{//\ page\ is\ full\ or\ contains\ (inner)\ aligned\ blocks;\ use\ generic\ multi-\/thread\ path}}
\DoxyCodeLine{00196\ \ \ \ \ \mbox{\hyperlink{free_8c_acc3316883c1cf74f78cb41e5d1b46ced}{mi\_free\_generic\_mt}}(page,\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00197\ \ \ \}}
\DoxyCodeLine{00198\ \}}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00202\ \textcolor{comment}{//\ Multi-\/threaded\ Free\ (`\_mt`)}}
\DoxyCodeLine{00203\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00204\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{free_8c_a9fa7c69a58f05892ddcb3150c4313136}{mi\_page\_unown\_from\_free}}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ mt\_free);}
\DoxyCodeLine{00205\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{free_8c_a3d2d3dc167b31300025aafd130b0a4c8}{mi\_page\_queue\_len\_is\_atmost}}(\ \mbox{\hyperlink{group__heap_ga34a47cde5a5b38c29f1aa3c5e76943c2}{mi\_heap\_t}}*\ heap,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{sugar_8h_a9766f5ceca5e25981858ec7384456072}{block\_size}},\ \textcolor{keywordtype}{size\_t}\ atmost)\ \{}
\DoxyCodeLine{00206\ \ \ \mbox{\hyperlink{types_8h_a9646624e7de8587984ec8e8cd5c5d780}{mi\_page\_queue\_t}}*\ \textcolor{keyword}{const}\ pq\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a3c9ff51031747112ac3891260143a552}{mi\_page\_queue}}(heap,\mbox{\hyperlink{sugar_8h_a9766f5ceca5e25981858ec7384456072}{block\_size}});}
\DoxyCodeLine{00207\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(pq!=\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00208\ \ \ \textcolor{keywordflow}{return}\ (pq-\/>\mbox{\hyperlink{structmi__page__queue__s_a299da47cff98a62bd197dbf283ddedac}{count}}\ <=\ atmost);}
\DoxyCodeLine{00209\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00210\ \textcolor{comment}{\ \ for(mi\_page\_t*\ p\ =\ pq-\/>first;\ p!=NULL;\ p\ =\ p-\/>next,\ atmost-\/-\/)\ \{}}
\DoxyCodeLine{00211\ \textcolor{comment}{\ \ \ \ if\ (atmost\ ==\ 0)\ \{\ return\ false;\ \}}}
\DoxyCodeLine{00212\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{00213\ \textcolor{comment}{\ \ return\ true;}}
\DoxyCodeLine{00214\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00215\ \}}
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00217\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a0a63ad6116421ea60eb43806f8881a3b}{mi\_decl\_noinline}}\ \mbox{\hyperlink{free_8c_a95d8dc8cc63abfde145fac55e9353d24}{mi\_free\_try\_collect\_mt}}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ mt\_free)\ \mbox{\hyperlink{mimalloc_8h_a2d1ca113437044da99abaaedd0b36ed8}{mi\_attr\_noexcept}}\ \{}
\DoxyCodeLine{00218\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_af56ec67c6f794de0f36d59a6390ab4c7}{mi\_page\_is\_owned}}(page));}
\DoxyCodeLine{00219\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa75f964d916bd58a37861b88491c51fb}{mi\_page\_is\_abandoned}}(page));}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \textcolor{comment}{//\ we\ own\ the\ page\ now..}}
\DoxyCodeLine{00222\ \ \ \textcolor{comment}{//\ safe\ to\ collect\ the\ thread\ atomic\ free\ list}}
\DoxyCodeLine{00223\ \ \ \textcolor{comment}{//\ use\ the\ \`{}\_partly`\ version\ to\ avoid\ atomic\ operations\ since\ we\ already\ have\ the\ \`{}mt\_free`\ pointing\ into\ the\ thread\ free\ list}}
\DoxyCodeLine{00224\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a3b5fe83ce56d2ef2de030cc40f8a1d29}{\_mi\_page\_free\_collect\_partly}}(page,\ mt\_free);}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \textcolor{preprocessor}{\ \ \#if\ MI\_DEBUG\ >\ 1}}
\DoxyCodeLine{00227\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a1b94ed5207a90334cdecba2006d91038}{mi\_page\_is\_singleton}}(page))\ \{\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_adfd6d23350810ca36986ffbc5459c93d}{mi\_page\_all\_free}}(page));\ \}}
\DoxyCodeLine{00228\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \textcolor{comment}{//\ 1.\ free\ if\ the\ page\ is\ free\ now\ \ (this\ is\ updated\ by\ \`{}\_mi\_page\_free\_collect\_partly`)}}
\DoxyCodeLine{00231\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_adfd6d23350810ca36986ffbc5459c93d}{mi\_page\_all\_free}}(page))}
\DoxyCodeLine{00232\ \ \ \{}
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{comment}{//\ first\ remove\ it\ from\ the\ abandoned\ pages\ in\ the\ arena\ (if\ mapped,\ this\ waits\ for\ any\ readers\ to\ finish)}}
\DoxyCodeLine{00234\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a1ab01c89ec9262c1ac23776c0ab3843f}{\_mi\_arenas\_page\_unabandon}}(page);}
\DoxyCodeLine{00235\ \ \ \ \ \textcolor{comment}{//\ we\ can\ free\ the\ page\ directly}}
\DoxyCodeLine{00236\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a5c704481ee56f6588f680987f4359d45}{\_mi\_arenas\_page\_free}}(page);}
\DoxyCodeLine{00237\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00238\ \ \ \}}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ \ \ \textcolor{comment}{//\ 2.\ we\ can\ try\ to\ reclaim\ the\ page\ for\ ourselves}}
\DoxyCodeLine{00241\ \ \ \textcolor{comment}{//\ note:\ \ we\ only\ reclaim\ if\ the\ page\ originated\ from\ our\ heap\ (the\ heap\ field\ is\ preserved\ on\ abandonment)}}
\DoxyCodeLine{00242\ \ \ \textcolor{comment}{//\ to\ avoid\ claiming\ arbitrary\ object\ sizes\ and\ limit\ indefinite\ expansion.\ This\ helps\ benchmarks\ like\ \`{}larson`}}
\DoxyCodeLine{00243\ \ \ \textcolor{keywordflow}{if}\ (page-\/>\mbox{\hyperlink{structmi__page__s_a35f5ba0cc587381ac8cffc3e97c27fc0}{block\_size}}\ <=\ \mbox{\hyperlink{types_8h_a27eff54c93bcddce7c482a8c6b58746d}{MI\_SMALL\_MAX\_OBJ\_SIZE}})\ \ \ \ \ \ \ \textcolor{comment}{//\ only\ for\ small\ sized\ blocks}}
\DoxyCodeLine{00244\ \ \ \{}
\DoxyCodeLine{00245\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{long}\ reclaim\_on\_free\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a1d96c2519367ba4bef4505cbd13aaec3}{\_mi\_option\_get\_fast}}(\mbox{\hyperlink{mimalloc_8h_acf0af9f50d2fca76b4e158d611bc930bac16e3f838e861338fb2357b430f6974c}{mi\_option\_page\_reclaim\_on\_free}});}
\DoxyCodeLine{00246\ \ \ \ \ \textcolor{keywordflow}{if}\ (reclaim\_on\_free\ >=\ 0)\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ and\ reclaiming\ is\ allowed}}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \textcolor{comment}{//\ get\ our\ heap\ (with\ the\ right\ tag)}}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \textcolor{comment}{//\ note:\ don't\ use\ \`{}mi\_heap\_get\_default()`\ as\ we\ may\ just\ have\ terminated\ this\ thread\ and\ we\ should}}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \textcolor{comment}{//\ not\ reinitialize\ the\ heap\ for\ this\ thread.\ (can\ happen\ due\ to\ thread-\/local\ destructors\ for\ example\ -\/-\/\ issue\ \#944)}}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \mbox{\hyperlink{group__heap_ga34a47cde5a5b38c29f1aa3c5e76943c2}{mi\_heap\_t}}*\ heap\ =\ \mbox{\hyperlink{prim_8h_a986e62564728229db3ccecbd6e97fd98}{mi\_prim\_get\_default\_heap}}();}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (heap\ !=\ page-\/>\mbox{\hyperlink{structmi__page__s_a629f6d941b563c85042782dedf1f6301}{heap}})\ \{}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a320c7d8a15c57974d3b105558a2a55e6}{mi\_heap\_is\_initialized}}(heap))\ \{}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ heap\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a0f06ce565965da587c960d80bbf488e9}{\_mi\_heap\_by\_tag}}(heap,\ page-\/>\mbox{\hyperlink{structmi__page__s_a7a497670246f95df7e1191b9dde1667c}{heap\_tag}});}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \textcolor{comment}{//\ can\ we\ reclaim\ into\ this\ heap?}}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (heap\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ \&\&\ heap-\/>\mbox{\hyperlink{structmi__heap__s_a14d0f3925d40afb54ed89983fdefb805}{allow\_page\_reclaim}})\ \{}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{long}\ reclaim\_max\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a1d96c2519367ba4bef4505cbd13aaec3}{\_mi\_option\_get\_fast}}(\mbox{\hyperlink{mimalloc_8h_acf0af9f50d2fca76b4e158d611bc930ba0ea503287dff89622a014a33127963b8}{mi\_option\_page\_reclaim\_max}});}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((heap\ ==\ page-\/>\mbox{\hyperlink{structmi__page__s_a629f6d941b563c85042782dedf1f6301}{heap}}\ \&\&\ \mbox{\hyperlink{free_8c_a3d2d3dc167b31300025aafd130b0a4c8}{mi\_page\_queue\_len\_is\_atmost}}(heap,\ page-\/>\mbox{\hyperlink{structmi__page__s_a35f5ba0cc587381ac8cffc3e97c27fc0}{block\_size}},\ reclaim\_max))\ ||\ \ \textcolor{comment}{//\ only\ reclaim\ if\ we\ were\ the\ originating\ heap,\ and\ we\ have\ at\ most\ N\ pages\ already}}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \ \ (reclaim\_on\_free\ ==\ 1\ \&\&\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ OR\ if\ the\ reclaim\ across\ heaps\ is\ allowed}}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \ \ \ \ !\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_af71c70410c182d307b6487c5cbb064bc}{mi\_page\_is\_used\_at\_frac}}(page,\ 8)\ \&\&\ \ \textcolor{comment}{//\ \ \ \ and\ the\ page\ is\ not\ too\ full}}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \ \ \ \ !heap-\/>\mbox{\hyperlink{structmi__heap__s_a2e524aeb1b30f344a4f0b70e6cf6cb3a}{tld}}-\/>\mbox{\hyperlink{structmi__tld__s_a1ba88188c587e503fb860aefd69aefd1}{is\_in\_threadpool}}\ \&\&\ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ and\ not\ part\ of\ a\ threadpool}}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a02890f29b2a92bc3631bfe0fb3e350bd}{\_mi\_arena\_memid\_is\_suitable}}(page-\/>\mbox{\hyperlink{structmi__page__s_a38337bec0f42cdba61acbf5eded5eddb}{memid}},\ heap-\/>\mbox{\hyperlink{structmi__heap__s_a4eec2cb7a91ef34810687b013d1dab77}{exclusive\_arena}}))\ \ \textcolor{comment}{//\ and\ the\ memory\ is\ suitable}}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ first\ remove\ it\ from\ the\ abandoned\ pages\ in\ the\ arena\ -\/-\/\ this\ waits\ for\ any\ readers\ to\ finish}}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a1ab01c89ec9262c1ac23776c0ab3843f}{\_mi\_arenas\_page\_unabandon}}(page);}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab24ca86854e0fd0c95e516de2fdf3b7c}{\_mi\_heap\_page\_reclaim}}(heap,\ page);}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{types_8h_af1dffe48b7fd5106aa0775775b59a173}{mi\_heap\_stat\_counter\_increase}}(heap,\ pages\_reclaim\_on\_free,\ 1);}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00273\ \ \ \ \ \}}
\DoxyCodeLine{00274\ \ \ \}}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \textcolor{comment}{//\ 3.\ if\ the\ page\ is\ unmapped,\ try\ to\ reabandon\ so\ it\ can\ possibly\ be\ mapped\ and\ found\ for\ allocations}}
\DoxyCodeLine{00277\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_af71c70410c182d307b6487c5cbb064bc}{mi\_page\_is\_used\_at\_frac}}(page,\ 8)\ \&\&\ \ \textcolor{comment}{//\ only\ reabandon\ if\ a\ full\ page\ starts\ to\ have\ enough\ blocks\ available\ to\ prevent\ immediate\ re-\/abandon\ of\ a\ full\ page}}
\DoxyCodeLine{00278\ \ \ \ \ \ \ !\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a851bf4a755b0da36a7eb750bbd837551}{mi\_page\_is\_abandoned\_mapped}}(page)\ \&\&\ page-\/>\mbox{\hyperlink{structmi__page__s_a38337bec0f42cdba61acbf5eded5eddb}{memid}}.\mbox{\hyperlink{structmi__memid__s_a6f3573b226287cf7875980e33029e0d9}{memkind}}\ ==\ \mbox{\hyperlink{types_8h_ac6c1ef0bff44bbd4da79dae9914f40faadc38b2c201eaa1c34610a21d07d642f3}{MI\_MEM\_ARENA}}\ \&\&}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a93bed98ce573509432555994540a3313}{\_mi\_arenas\_page\_try\_reabandon\_to\_mapped}}(page))}
\DoxyCodeLine{00280\ \ \ \{}
\DoxyCodeLine{00281\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00282\ \ \ \}}
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \ \ \textcolor{comment}{//\ not\ reclaimed\ or\ free'd,\ unown\ again}}
\DoxyCodeLine{00286\ \ \ \textcolor{comment}{//\ \_mi\_page\_unown(page);}}
\DoxyCodeLine{00287\ \ \ \mbox{\hyperlink{free_8c_a9fa7c69a58f05892ddcb3150c4313136}{mi\_page\_unown\_from\_free}}(page,\ mt\_free);}
\DoxyCodeLine{00288\ \}}
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \textcolor{comment}{//\ release\ ownership\ of\ a\ page.\ This\ may\ free\ the\ page\ if\ all\ (other)\ blocks\ were\ concurrently}}
\DoxyCodeLine{00292\ \textcolor{comment}{//\ freed\ in\ the\ meantime.\ Returns\ true\ if\ the\ page\ was\ freed.}}
\DoxyCodeLine{00293\ \textcolor{comment}{//\ This\ is\ a\ specialized\ version\ of\ \`{}mi\_page\_unown`\ to\ (try\ to)\ avoid\ calling\ \`{}mi\_page\_free\_collect`\ again.}}
\DoxyCodeLine{00294\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{free_8c_a9fa7c69a58f05892ddcb3150c4313136}{mi\_page\_unown\_from\_free}}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ mt\_free)\ \{}
\DoxyCodeLine{00295\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_af56ec67c6f794de0f36d59a6390ab4c7}{mi\_page\_is\_owned}}(page));}
\DoxyCodeLine{00296\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa75f964d916bd58a37861b88491c51fb}{mi\_page\_is\_abandoned}}(page));}
\DoxyCodeLine{00297\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(mt\_free\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00298\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(page-\/>\mbox{\hyperlink{structmi__page__s_ad1194a6cecba67ba2cf1952eb337968c}{used}}\ >\ 1);}
\DoxyCodeLine{00299\ \ \ \mbox{\hyperlink{types_8h_aa9fb16bc3b4469d57c7b2747c6718b15}{mi\_thread\_free\_t}}\ tf\_expect\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ae5ecd5e45278bd147fbe6720cba0f323}{mi\_tf\_create}}(mt\_free,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00300\ \ \ \mbox{\hyperlink{types_8h_aa9fb16bc3b4469d57c7b2747c6718b15}{mi\_thread\_free\_t}}\ tf\_new\ \ \ \ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ae5ecd5e45278bd147fbe6720cba0f323}{mi\_tf\_create}}(mt\_free,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00301\ \ \ \textcolor{keywordflow}{while}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}(!\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a04332d02087d9b0e7ad9197c34358177}{mi\_atomic\_cas\_weak\_acq\_rel}}(\&page-\/>xthread\_free,\ \&tf\_expect,\ tf\_new))\ \{}
\DoxyCodeLine{00302\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa501cc20d36064923e3d70c4a08879c4}{mi\_tf\_is\_owned}}(tf\_expect));}
\DoxyCodeLine{00303\ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a68f9b45db9fe19930366d0e473bdf791}{mi\_tf\_block}}(tf\_expect)\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ae2b78e1e45e4ac3db8102e9d333d2972}{\_mi\_page\_free\_collect}}(page,\textcolor{keyword}{false});\ \ \textcolor{comment}{//\ update\ used}}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_adfd6d23350810ca36986ffbc5459c93d}{mi\_page\_all\_free}}(page))\ \{\ \ \ \textcolor{comment}{//\ it\ may\ become\ free\ just\ before\ unowning\ it}}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a1ab01c89ec9262c1ac23776c0ab3843f}{\_mi\_arenas\_page\_unabandon}}(page);}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a5c704481ee56f6588f680987f4359d45}{\_mi\_arenas\_page\_free}}(page);}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00310\ \ \ \ \ \ \ tf\_expect\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&page-\/>xthread\_free);}
\DoxyCodeLine{00311\ \ \ \ \ \}}
\DoxyCodeLine{00312\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a68f9b45db9fe19930366d0e473bdf791}{mi\_tf\_block}}(tf\_expect)==\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00313\ \ \ \ \ tf\_new\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ae5ecd5e45278bd147fbe6720cba0f323}{mi\_tf\_create}}(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \textcolor{keyword}{false});}
\DoxyCodeLine{00314\ \ \ \}}
\DoxyCodeLine{00315\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00316\ \}}
\DoxyCodeLine{00317\ }
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00319\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00320\ \textcolor{comment}{//\ Usable\ size}}
\DoxyCodeLine{00321\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00322\ }
\DoxyCodeLine{00323\ \textcolor{comment}{//\ Bytes\ available\ in\ a\ block}}
\DoxyCodeLine{00324\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a0a63ad6116421ea60eb43806f8881a3b}{mi\_decl\_noinline}}\ \mbox{\hyperlink{free_8c_a85c1b5ab3965f4a581f194aa06d0cf45}{mi\_page\_usable\_aligned\_size\_of}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \mbox{\hyperlink{mimalloc_8h_a2d1ca113437044da99abaaedd0b36ed8}{mi\_attr\_noexcept}}\ \{}
\DoxyCodeLine{00325\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}}\ =\ \mbox{\hyperlink{free_8c_a02c896f799e571b628b2d7747ca9f771}{\_mi\_page\_ptr\_unalign}}(page,\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00326\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}}\ =\ \mbox{\hyperlink{free_8c_a26335e66b160c5319806a2e33f7b70e7}{mi\_page\_usable\_size\_of}}(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});}
\DoxyCodeLine{00327\ \ \ \textcolor{keyword}{const}\ ptrdiff\_t\ adjust\ =\ (\mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*)\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ -\/\ (\mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*)\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}};}
\DoxyCodeLine{00328\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(adjust\ >=\ 0\ \&\&\ (\textcolor{keywordtype}{size\_t})adjust\ <=\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}});}
\DoxyCodeLine{00329\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ aligned\_size\ =\ (\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}}\ -\/\ adjust);}
\DoxyCodeLine{00330\ \textcolor{preprocessor}{\ \ \#if\ MI\_GUARDED}}
\DoxyCodeLine{00331\ \ \ \textcolor{keywordflow}{if}\ (mi\_block\_ptr\_is\_guarded(\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}))\ \{}
\DoxyCodeLine{00332\ \ \ \ \ \textcolor{keywordflow}{return}\ aligned\_size\ -\/\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a723e4c95209d4c6282b53317473e83d5}{\_mi\_os\_page\_size}}();}
\DoxyCodeLine{00333\ \ \ \}}
\DoxyCodeLine{00334\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00335\ \ \ \textcolor{keywordflow}{return}\ aligned\_size;}
\DoxyCodeLine{00336\ \}}
\DoxyCodeLine{00337\ }
\DoxyCodeLine{00338\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{free_8c_ad2304b1ed3a49b8c20e550c060d5627d}{\_mi\_usable\_size}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ msg)\ \mbox{\hyperlink{mimalloc_8h_a2d1ca113437044da99abaaedd0b36ed8}{mi\_attr\_noexcept}}\ \{}
\DoxyCodeLine{00339\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ \textcolor{keyword}{const}\ page\ =\ \mbox{\hyperlink{free_8c_a3c325fa47ff6342dca1b913607844b93}{mi\_validate\_ptr\_page}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},msg);}
\DoxyCodeLine{00340\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}(page==\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00341\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a7b29eabf31d4ddb28a16267045384e03}{mi\_likely}}(!\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ae0b5641b1e2fabf59c84685e08520852}{mi\_page\_has\_aligned}}(page))\ \{}
\DoxyCodeLine{00342\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}}\ =\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*)\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}};}
\DoxyCodeLine{00343\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{free_8c_a26335e66b160c5319806a2e33f7b70e7}{mi\_page\_usable\_size\_of}}(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});}
\DoxyCodeLine{00344\ \ \ \}}
\DoxyCodeLine{00345\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00346\ \ \ \ \ \textcolor{comment}{//\ split\ out\ to\ separate\ routine\ for\ improved\ code\ generation}}
\DoxyCodeLine{00347\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{free_8c_a85c1b5ab3965f4a581f194aa06d0cf45}{mi\_page\_usable\_aligned\_size\_of}}(page,\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00348\ \ \ \}}
\DoxyCodeLine{00349\ \}}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ \mbox{\hyperlink{mimalloc_8h_acbaf5f4132fcfb51f0bf40e3b50f0981}{mi\_decl\_nodiscard}}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{free_8c_ad4efa3dd9163181d18af0361e45dac86}{mi\_usable\_size}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \mbox{\hyperlink{mimalloc_8h_a2d1ca113437044da99abaaedd0b36ed8}{mi\_attr\_noexcept}}\ \{}
\DoxyCodeLine{00352\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{free_8c_ad2304b1ed3a49b8c20e550c060d5627d}{\_mi\_usable\_size}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ \textcolor{stringliteral}{"{}mi\_usable\_size"{}});}
\DoxyCodeLine{00353\ \}}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00355\ }
\DoxyCodeLine{00356\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00357\ \textcolor{comment}{//\ Free\ variants}}
\DoxyCodeLine{00358\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{group__posix_gae01389eedab8d67341ff52e2aad80ebb}{mi\_free\_size}}(\textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}})\ \mbox{\hyperlink{mimalloc_8h_a2d1ca113437044da99abaaedd0b36ed8}{mi\_attr\_noexcept}}\ \{}
\DoxyCodeLine{00361\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_abe843fae7b0161386d403d8ec7e0b6e0}{MI\_UNUSED\_RELEASE}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}});}
\DoxyCodeLine{00362\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_af04c7a87bc1c69ef3e763a580f47a418}{mi\_assert}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ ||\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}}\ <=\ \mbox{\hyperlink{free_8c_ad2304b1ed3a49b8c20e550c060d5627d}{\_mi\_usable\_size}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\textcolor{stringliteral}{"{}mi\_free\_size"{}}));}
\DoxyCodeLine{00363\ \ \ \mbox{\hyperlink{group__malloc_gaf2c7b89c327d1f60f59e68b9ea644d95}{mi\_free}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00364\ \}}
\DoxyCodeLine{00365\ }
\DoxyCodeLine{00366\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{group__posix_ga72e9d7ffb5fe94d69bc722c8506e27bc}{mi\_free\_size\_aligned}}(\textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ \textcolor{keywordtype}{size\_t}\ alignment)\ \mbox{\hyperlink{mimalloc_8h_a2d1ca113437044da99abaaedd0b36ed8}{mi\_attr\_noexcept}}\ \{}
\DoxyCodeLine{00367\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_abe843fae7b0161386d403d8ec7e0b6e0}{MI\_UNUSED\_RELEASE}}(alignment);}
\DoxyCodeLine{00368\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_af04c7a87bc1c69ef3e763a580f47a418}{mi\_assert}}(((uintptr\_t)\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ \%\ alignment)\ ==\ 0);}
\DoxyCodeLine{00369\ \ \ \mbox{\hyperlink{group__posix_gae01389eedab8d67341ff52e2aad80ebb}{mi\_free\_size}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}});}
\DoxyCodeLine{00370\ \}}
\DoxyCodeLine{00371\ }
\DoxyCodeLine{00372\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{group__posix_ga0d28d5cf61e6bfbb18c63092939fe5c9}{mi\_free\_aligned}}(\textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ \textcolor{keywordtype}{size\_t}\ alignment)\ \mbox{\hyperlink{mimalloc_8h_a2d1ca113437044da99abaaedd0b36ed8}{mi\_attr\_noexcept}}\ \{}
\DoxyCodeLine{00373\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_abe843fae7b0161386d403d8ec7e0b6e0}{MI\_UNUSED\_RELEASE}}(alignment);}
\DoxyCodeLine{00374\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_af04c7a87bc1c69ef3e763a580f47a418}{mi\_assert}}(((uintptr\_t)\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ \%\ alignment)\ ==\ 0);}
\DoxyCodeLine{00375\ \ \ \mbox{\hyperlink{group__malloc_gaf2c7b89c327d1f60f59e68b9ea644d95}{mi\_free}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00376\ \}}
\DoxyCodeLine{00377\ }
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00379\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00380\ \textcolor{comment}{//\ Check\ for\ double\ free\ in\ secure\ and\ debug\ mode}}
\DoxyCodeLine{00381\ \textcolor{comment}{//\ This\ is\ somewhat\ expensive\ so\ only\ enabled\ for\ secure\ mode\ 4}}
\DoxyCodeLine{00382\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00383\ }
\DoxyCodeLine{00384\ \textcolor{preprocessor}{\#if\ (MI\_ENCODE\_FREELIST\ \&\&\ (MI\_SECURE>=4\ ||\ MI\_DEBUG!=0))}}
\DoxyCodeLine{00385\ \textcolor{comment}{//\ linear\ check\ if\ the\ free\ list\ contains\ a\ specific\ element}}
\DoxyCodeLine{00386\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ mi\_list\_contains(\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ list,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ elem)\ \{}
\DoxyCodeLine{00387\ \ \ \textcolor{keywordflow}{while}\ (list\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00388\ \ \ \ \ \textcolor{keywordflow}{if}\ (elem==list)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00389\ \ \ \ \ \mbox{\hyperlink{namespaceluisa_afbdbb20de8bb3730f578eaba0e3803b6}{list}}\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aaa5daf3a8b3db89666b6861cbb1e2f96}{mi\_block\_next}}(page,\ list);}
\DoxyCodeLine{00390\ \ \ \}}
\DoxyCodeLine{00391\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00392\ \}}
\DoxyCodeLine{00393\ }
\DoxyCodeLine{00394\ \textcolor{keyword}{static}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a0a63ad6116421ea60eb43806f8881a3b}{mi\_decl\_noinline}}\ \textcolor{keywordtype}{bool}\ mi\_check\_is\_double\_freex(\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}})\ \{}
\DoxyCodeLine{00395\ \ \ \textcolor{comment}{//\ The\ decoded\ value\ is\ in\ the\ same\ page\ (or\ NULL).}}
\DoxyCodeLine{00396\ \ \ \textcolor{comment}{//\ Walk\ the\ free\ lists\ to\ verify\ positively\ if\ it\ is\ already\ freed}}
\DoxyCodeLine{00397\ \ \ \textcolor{keywordflow}{if}\ (mi\_list\_contains(page,\ page-\/>\mbox{\hyperlink{structmi__page__s_ae2d4b1c483d94e3624319bbca00d3da3}{free}},\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}})\ ||}
\DoxyCodeLine{00398\ \ \ \ \ \ \ mi\_list\_contains(page,\ page-\/>\mbox{\hyperlink{structmi__page__s_a9ed7774dcbd4de583d1594d698128830}{local\_free}},\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}})\ ||}
\DoxyCodeLine{00399\ \ \ \ \ \ \ mi\_list\_contains(page,\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa8e0e6183cf707bee8707e2f5f5e5c3e}{mi\_page\_thread\_free}}(page),\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}}))}
\DoxyCodeLine{00400\ \ \ \{}
\DoxyCodeLine{00401\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a2bebc073bcaac71658e57bb260c2e426}{\_mi\_error\_message}}(\mbox{\hyperlink{types_8h_af0fac1cea1165b4debec7f686edf3313}{EAGAIN}},\ \textcolor{stringliteral}{"{}double\ free\ detected\ of\ block\ \%p\ with\ size\ \%zu\(\backslash\)n"{}},\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a6134893990c1f09da2b40092ceecc780}{mi\_page\_block\_size}}(page));}
\DoxyCodeLine{00402\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00403\ \ \ \}}
\DoxyCodeLine{00404\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00405\ \}}
\DoxyCodeLine{00406\ }
\DoxyCodeLine{00407\ \textcolor{preprocessor}{\#define\ mi\_track\_page(page,access)\ \ \{\ size\_t\ psize;\ void*\ pstart\ =\ \_mi\_page\_start(\_mi\_page\_segment(page),page,\&psize);\ mi\_track\_mem\_\#\#access(\ pstart,\ psize);\ \}}}
\DoxyCodeLine{00408\ }
\DoxyCodeLine{00409\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{free_8c_ad23f1572e5f6b82c4c59a43fb9f0595d}{mi\_check\_is\_double\_free}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}})\ \{}
\DoxyCodeLine{00410\ \ \ \textcolor{keywordtype}{bool}\ is\_double\_free\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00411\ \ \ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ n\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a0887e65e0c4cafb80c0851bb81602a42}{mi\_block\_nextx}}(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ page-\/>\mbox{\hyperlink{structmi__page__s_a720620090a6e049d89c015c647900034}{keys}});\ \textcolor{comment}{//\ pretend\ it\ is\ freed,\ and\ get\ the\ decoded\ first\ field}}
\DoxyCodeLine{00412\ \ \ \textcolor{keywordflow}{if}\ (((uintptr\_t)n\ \&\ (\mbox{\hyperlink{bits_8h_af8a1f49c3ca95474d8fc5fdb53874026}{MI\_INTPTR\_SIZE}}-\/1))==0\ \&\&\ \ \textcolor{comment}{//\ quick\ check:\ aligned\ pointer?}}
\DoxyCodeLine{00413\ \ \ \ \ \ \ (n==\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ ||\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a31ad3a70b52caeb52b6babacd5a97894}{mi\_is\_in\_same\_page}}(\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ n)))\ \textcolor{comment}{//\ quick\ check:\ in\ same\ page\ or\ NULL?}}
\DoxyCodeLine{00414\ \ \ \{}
\DoxyCodeLine{00415\ \ \ \ \ \textcolor{comment}{//\ Suspicious:\ decoded\ value\ a\ in\ block\ is\ in\ the\ same\ page\ (or\ NULL)\ -\/-\/\ maybe\ a\ double\ free?}}
\DoxyCodeLine{00416\ \ \ \ \ \textcolor{comment}{//\ (continue\ in\ separate\ function\ to\ improve\ code\ generation)}}
\DoxyCodeLine{00417\ \ \ \ \ is\_double\_free\ =\ mi\_check\_is\_double\_freex(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});}
\DoxyCodeLine{00418\ \ \ \}}
\DoxyCodeLine{00419\ \ \ \textcolor{keywordflow}{return}\ is\_double\_free;}
\DoxyCodeLine{00420\ \}}
\DoxyCodeLine{00421\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00422\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{free_8c_ad23f1572e5f6b82c4c59a43fb9f0595d}{mi\_check\_is\_double\_free}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}})\ \{}
\DoxyCodeLine{00423\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(page);}
\DoxyCodeLine{00424\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});}
\DoxyCodeLine{00425\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00426\ \}}
\DoxyCodeLine{00427\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00428\ }
\DoxyCodeLine{00429\ }
\DoxyCodeLine{00430\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00431\ \textcolor{comment}{//\ Check\ for\ heap\ block\ overflow\ by\ setting\ up\ padding\ at\ the\ end\ of\ the\ block}}
\DoxyCodeLine{00432\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00433\ }
\DoxyCodeLine{00434\ \textcolor{preprocessor}{\#if\ MI\_PADDING\ }\textcolor{comment}{//\ \&\&\ !MI\_TRACK\_ENABLED}}
\DoxyCodeLine{00435\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ mi\_page\_decode\_padding(\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \textcolor{keywordtype}{size\_t}*\ delta,\ \textcolor{keywordtype}{size\_t}*\ bsize)\ \{}
\DoxyCodeLine{00436\ \ \ *bsize\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a432abca03d059a7d40d8d39617afc8f7}{mi\_page\_usable\_block\_size}}(page);}
\DoxyCodeLine{00437\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_ac07397b1cfdc81657699d5fc21610aa4}{mi\_padding\_t}}*\ \textcolor{keyword}{const}\ padding\ =\ (\mbox{\hyperlink{types_8h_ac07397b1cfdc81657699d5fc21610aa4}{mi\_padding\_t}}*)((\mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*)\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}}\ +\ *bsize);}
\DoxyCodeLine{00438\ \ \ \mbox{\hyperlink{track_8h_a6e155ed879c074c60f2d2656be414b04}{mi\_track\_mem\_defined}}(padding,\textcolor{keyword}{sizeof}(\mbox{\hyperlink{types_8h_ac07397b1cfdc81657699d5fc21610aa4}{mi\_padding\_t}}));}
\DoxyCodeLine{00439\ \ \ *delta\ =\ padding-\/>\mbox{\hyperlink{structmi__padding__s_a68c8d1f1912c6b5a9c040e77094cb5ec}{delta}};}
\DoxyCodeLine{00440\ \ \ \mbox{\hyperlink{eabase_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ canary\ =\ padding-\/>\mbox{\hyperlink{structmi__padding__s_a227a1074f8f9ab4c2e4e1dba83da4164}{canary}};}
\DoxyCodeLine{00441\ \ \ \mbox{\hyperlink{namespacedetail_a2638ce12131bdd8c9b3c44aa6f37fb6e}{uintptr\_t}}\ keys[2];}
\DoxyCodeLine{00442\ \ \ keys[0]\ =\ page-\/>\mbox{\hyperlink{structmi__page__s_a720620090a6e049d89c015c647900034}{keys}}[0];}
\DoxyCodeLine{00443\ \ \ keys[1]\ =\ page-\/>\mbox{\hyperlink{structmi__page__s_a720620090a6e049d89c015c647900034}{keys}}[1];}
\DoxyCodeLine{00444\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}}\ =\ (\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_afc7cd0f28b20eddef19b40acd724a1cf}{mi\_ptr\_encode\_canary}}(page,\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},keys)\ ==\ canary\ \&\&\ *delta\ <=\ *bsize);}
\DoxyCodeLine{00445\ \ \ \mbox{\hyperlink{track_8h_ab1bbf1b6b42034ef12d83ab7f74de620}{mi\_track\_mem\_noaccess}}(padding,\textcolor{keyword}{sizeof}(\mbox{\hyperlink{types_8h_ac07397b1cfdc81657699d5fc21610aa4}{mi\_padding\_t}}));}
\DoxyCodeLine{00446\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}};}
\DoxyCodeLine{00447\ \}}
\DoxyCodeLine{00448\ }
\DoxyCodeLine{00449\ \textcolor{comment}{//\ Return\ the\ exact\ usable\ size\ of\ a\ block.}}
\DoxyCodeLine{00450\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{free_8c_a26335e66b160c5319806a2e33f7b70e7}{mi\_page\_usable\_size\_of}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}})\ \{}
\DoxyCodeLine{00451\ \ \ \textcolor{keywordtype}{size\_t}\ bsize;}
\DoxyCodeLine{00452\ \ \ \textcolor{keywordtype}{size\_t}\ delta;}
\DoxyCodeLine{00453\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}}\ =\ mi\_page\_decode\_padding(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \&delta,\ \&bsize);}
\DoxyCodeLine{00454\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}});\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(delta\ <=\ bsize);}
\DoxyCodeLine{00455\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}}\ ?\ bsize\ -\/\ delta\ :\ 0);}
\DoxyCodeLine{00456\ \}}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ \textcolor{comment}{//\ When\ a\ non-\/thread-\/local\ block\ is\ freed,\ it\ becomes\ part\ of\ the\ thread\ delayed\ free}}
\DoxyCodeLine{00459\ \textcolor{comment}{//\ list\ that\ is\ freed\ later\ by\ the\ owning\ heap.\ If\ the\ exact\ usable\ size\ is\ too\ small\ to}}
\DoxyCodeLine{00460\ \textcolor{comment}{//\ contain\ the\ pointer\ for\ the\ delayed\ list,\ then\ shrink\ the\ padding\ (by\ decreasing\ delta)}}
\DoxyCodeLine{00461\ \textcolor{comment}{//\ so\ it\ will\ later\ not\ trigger\ an\ overflow\ error\ in\ \`{}mi\_free\_block`.}}
\DoxyCodeLine{00462\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{free_8c_a2ca7e9c13b02f9086a3f96498e49782e}{\_mi\_padding\_shrink}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ min\_size)\ \{}
\DoxyCodeLine{00463\ \ \ \textcolor{keywordtype}{size\_t}\ bsize;}
\DoxyCodeLine{00464\ \ \ \textcolor{keywordtype}{size\_t}\ delta;}
\DoxyCodeLine{00465\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}}\ =\ mi\_page\_decode\_padding(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \&delta,\ \&bsize);}
\DoxyCodeLine{00466\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}});}
\DoxyCodeLine{00467\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}}\ ||\ (bsize\ -\/\ delta)\ >=\ min\_size)\ \textcolor{keywordflow}{return};\ \ \textcolor{comment}{//\ usually\ already\ enough\ space}}
\DoxyCodeLine{00468\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(bsize\ >=\ min\_size);}
\DoxyCodeLine{00469\ \ \ \textcolor{keywordflow}{if}\ (bsize\ <\ min\_size)\ \textcolor{keywordflow}{return};\ \ \textcolor{comment}{//\ should\ never\ happen}}
\DoxyCodeLine{00470\ \ \ \textcolor{keywordtype}{size\_t}\ new\_delta\ =\ (bsize\ -\/\ min\_size);}
\DoxyCodeLine{00471\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(new\_delta\ <\ bsize);}
\DoxyCodeLine{00472\ \ \ \mbox{\hyperlink{types_8h_ac07397b1cfdc81657699d5fc21610aa4}{mi\_padding\_t}}*\ padding\ =\ (\mbox{\hyperlink{types_8h_ac07397b1cfdc81657699d5fc21610aa4}{mi\_padding\_t}}*)((\mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*)\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}}\ +\ bsize);}
\DoxyCodeLine{00473\ \ \ \mbox{\hyperlink{track_8h_a6e155ed879c074c60f2d2656be414b04}{mi\_track\_mem\_defined}}(padding,\textcolor{keyword}{sizeof}(\mbox{\hyperlink{types_8h_ac07397b1cfdc81657699d5fc21610aa4}{mi\_padding\_t}}));}
\DoxyCodeLine{00474\ \ \ padding-\/>\mbox{\hyperlink{structmi__padding__s_a68c8d1f1912c6b5a9c040e77094cb5ec}{delta}}\ =\ (\mbox{\hyperlink{eabase_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}})new\_delta;}
\DoxyCodeLine{00475\ \ \ \mbox{\hyperlink{track_8h_ab1bbf1b6b42034ef12d83ab7f74de620}{mi\_track\_mem\_noaccess}}(padding,\textcolor{keyword}{sizeof}(\mbox{\hyperlink{types_8h_ac07397b1cfdc81657699d5fc21610aa4}{mi\_padding\_t}}));}
\DoxyCodeLine{00476\ \}}
\DoxyCodeLine{00477\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00478\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{free_8c_a26335e66b160c5319806a2e33f7b70e7}{mi\_page\_usable\_size\_of}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}})\ \{}
\DoxyCodeLine{00479\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});}
\DoxyCodeLine{00480\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a432abca03d059a7d40d8d39617afc8f7}{mi\_page\_usable\_block\_size}}(page);}
\DoxyCodeLine{00481\ \}}
\DoxyCodeLine{00482\ }
\DoxyCodeLine{00483\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{free_8c_a2ca7e9c13b02f9086a3f96498e49782e}{\_mi\_padding\_shrink}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ min\_size)\ \{}
\DoxyCodeLine{00484\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(page);}
\DoxyCodeLine{00485\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});}
\DoxyCodeLine{00486\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(min\_size);}
\DoxyCodeLine{00487\ \}}
\DoxyCodeLine{00488\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00489\ }
\DoxyCodeLine{00490\ \textcolor{preprocessor}{\#if\ MI\_PADDING\ \&\&\ MI\_PADDING\_CHECK}}
\DoxyCodeLine{00491\ }
\DoxyCodeLine{00492\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ mi\_verify\_padding(\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \textcolor{keywordtype}{size\_t}*\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ \textcolor{keywordtype}{size\_t}*\ wrong)\ \{}
\DoxyCodeLine{00493\ \ \ \textcolor{keywordtype}{size\_t}\ bsize;}
\DoxyCodeLine{00494\ \ \ \textcolor{keywordtype}{size\_t}\ delta;}
\DoxyCodeLine{00495\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}}\ =\ mi\_page\_decode\_padding(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \&delta,\ \&bsize);}
\DoxyCodeLine{00496\ \ \ *\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}}\ =\ *wrong\ =\ bsize;}
\DoxyCodeLine{00497\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}})\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00498\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(bsize\ >=\ delta);}
\DoxyCodeLine{00499\ \ \ *\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}}\ =\ bsize\ -\/\ delta;}
\DoxyCodeLine{00500\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aebe1b18846bd3fc16de5b52cd2250bec}{mi\_page\_is\_huge}}(page))\ \{}
\DoxyCodeLine{00501\ \ \ \ \ \mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*\ \mbox{\hyperlink{namespaceeastl_a46734ee4d1a924a12ed3d4ca8021925a}{fill}}\ =\ (\mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*)\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}}\ +\ bsize\ -\/\ delta;}
\DoxyCodeLine{00502\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ maxpad\ =\ (delta\ >\ \mbox{\hyperlink{types_8h_a0f3c19062830f837622baa796853c1d3}{MI\_MAX\_ALIGN\_SIZE}}\ ?\ \mbox{\hyperlink{types_8h_a0f3c19062830f837622baa796853c1d3}{MI\_MAX\_ALIGN\_SIZE}}\ :\ delta);\ \textcolor{comment}{//\ check\ at\ most\ the\ first\ N\ padding\ bytes}}
\DoxyCodeLine{00503\ \ \ \ \ \mbox{\hyperlink{track_8h_a6e155ed879c074c60f2d2656be414b04}{mi\_track\_mem\_defined}}(fill,\ maxpad);}
\DoxyCodeLine{00504\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ maxpad;\ i++)\ \{}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fill[i]\ !=\ \mbox{\hyperlink{types_8h_a9010af21ec690aaaf1d72b465875bef0}{MI\_DEBUG\_PADDING}})\ \{}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ *wrong\ =\ bsize\ -\/\ delta\ +\ i;}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00510\ \ \ \ \ \}}
\DoxyCodeLine{00511\ \ \ \ \ \mbox{\hyperlink{track_8h_ab1bbf1b6b42034ef12d83ab7f74de620}{mi\_track\_mem\_noaccess}}(fill,\ maxpad);}
\DoxyCodeLine{00512\ \ \ \}}
\DoxyCodeLine{00513\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}};}
\DoxyCodeLine{00514\ \}}
\DoxyCodeLine{00515\ }
\DoxyCodeLine{00516\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{free_8c_a607d73b1962b5676b5fb0a58d0eda6d8}{mi\_check\_padding}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}})\ \{}
\DoxyCodeLine{00517\ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}};}
\DoxyCodeLine{00518\ \ \ \textcolor{keywordtype}{size\_t}\ wrong;}
\DoxyCodeLine{00519\ \ \ \textcolor{keywordflow}{if}\ (!mi\_verify\_padding(page,\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\&\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\&wrong))\ \{}
\DoxyCodeLine{00520\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a2bebc073bcaac71658e57bb260c2e426}{\_mi\_error\_message}}(\mbox{\hyperlink{types_8h_a3f317946e043623f9d6b93dbf60e6316}{EFAULT}},\ \textcolor{stringliteral}{"{}buffer\ overflow\ in\ heap\ block\ \%p\ of\ size\ \%zu:\ write\ after\ \%zu\ bytes\(\backslash\)n"{}},\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ wrong\ );}
\DoxyCodeLine{00521\ \ \ \}}
\DoxyCodeLine{00522\ \}}
\DoxyCodeLine{00523\ }
\DoxyCodeLine{00524\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00525\ }
\DoxyCodeLine{00526\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{free_8c_a607d73b1962b5676b5fb0a58d0eda6d8}{mi\_check\_padding}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}})\ \{}
\DoxyCodeLine{00527\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(page);}
\DoxyCodeLine{00528\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});}
\DoxyCodeLine{00529\ \}}
\DoxyCodeLine{00530\ }
\DoxyCodeLine{00531\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00532\ }
\DoxyCodeLine{00533\ \textcolor{comment}{//\ only\ maintain\ stats\ for\ smaller\ objects\ if\ requested}}
\DoxyCodeLine{00534\ \textcolor{preprocessor}{\#if\ (MI\_STAT>0)}}
\DoxyCodeLine{00535\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{free_8c_a559045bfe8e993e8ee3e7aef40cf1e35}{mi\_stat\_free}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}})\ \{}
\DoxyCodeLine{00536\ \textcolor{preprocessor}{\ \ \#if\ (MI\_STAT\ <\ 2)}}
\DoxyCodeLine{00537\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});}
\DoxyCodeLine{00538\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00539\ \ \ \mbox{\hyperlink{group__heap_ga34a47cde5a5b38c29f1aa3c5e76943c2}{mi\_heap\_t}}*\ \textcolor{keyword}{const}\ heap\ =\ \mbox{\hyperlink{group__heap_ga14c667a6e2c5d28762d8cb7d4e057909}{mi\_heap\_get\_default}}();}
\DoxyCodeLine{00540\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ bsize\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a432abca03d059a7d40d8d39617afc8f7}{mi\_page\_usable\_block\_size}}(page);}
\DoxyCodeLine{00541\ \textcolor{preprocessor}{\ \ \#if\ (MI\_STAT>1)}}
\DoxyCodeLine{00542\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ usize\ =\ \mbox{\hyperlink{free_8c_a26335e66b160c5319806a2e33f7b70e7}{mi\_page\_usable\_size\_of}}(page,\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});}
\DoxyCodeLine{00543\ \ \ \mbox{\hyperlink{types_8h_a9a929f4920a380a78705a9dc7504945f}{mi\_heap\_stat\_decrease}}(heap,\ malloc\_requested,\ usize);}
\DoxyCodeLine{00544\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00545\ \ \ \textcolor{keywordflow}{if}\ (bsize\ <=\ \mbox{\hyperlink{types_8h_aedfdf546ebfa1e91dcf909b8db7b21dc}{MI\_LARGE\_MAX\_OBJ\_SIZE}})\ \{}
\DoxyCodeLine{00546\ \ \ \ \ \mbox{\hyperlink{types_8h_a9a929f4920a380a78705a9dc7504945f}{mi\_heap\_stat\_decrease}}(heap,\ malloc\_normal,\ bsize);}
\DoxyCodeLine{00547\ \textcolor{preprocessor}{\ \ \ \ \#if\ (MI\_STAT\ >\ 1)}}
\DoxyCodeLine{00548\ \ \ \ \ \mbox{\hyperlink{types_8h_a9a929f4920a380a78705a9dc7504945f}{mi\_heap\_stat\_decrease}}(heap,\ malloc\_bins[\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a0d92abe27db4a21968468b2fe73473d6}{\_mi\_bin}}(bsize)],\ 1);}
\DoxyCodeLine{00549\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{00550\ \ \ \}}
\DoxyCodeLine{00551\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00552\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ bpsize\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a6134893990c1f09da2b40092ceecc780}{mi\_page\_block\_size}}(page);\ \ \textcolor{comment}{//\ match\ stat\ in\ page.c:mi\_huge\_page\_alloc}}
\DoxyCodeLine{00553\ \ \ \ \ \mbox{\hyperlink{types_8h_a9a929f4920a380a78705a9dc7504945f}{mi\_heap\_stat\_decrease}}(heap,\ malloc\_huge,\ bpsize);}
\DoxyCodeLine{00554\ \ \ \}}
\DoxyCodeLine{00555\ \}}
\DoxyCodeLine{00556\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00557\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{free_8c_a559045bfe8e993e8ee3e7aef40cf1e35}{mi\_stat\_free}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}})\ \{}
\DoxyCodeLine{00558\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(page);\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}});}
\DoxyCodeLine{00559\ \}}
\DoxyCodeLine{00560\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00561\ }
\DoxyCodeLine{00562\ }
\DoxyCodeLine{00563\ \textcolor{comment}{//\ Remove\ guard\ page\ when\ building\ with\ MI\_GUARDED}}
\DoxyCodeLine{00564\ \textcolor{preprocessor}{\#if\ MI\_GUARDED}}
\DoxyCodeLine{00565\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ mi\_block\_unguard(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}*\ \mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \{}
\DoxyCodeLine{00566\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00567\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(mi\_block\_ptr\_is\_guarded(\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}},\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}));}
\DoxyCodeLine{00568\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ae0b5641b1e2fabf59c84685e08520852}{mi\_page\_has\_aligned}}(page));}
\DoxyCodeLine{00569\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}((\mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*)\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ -\/\ (\mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*)\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}}\ >=\ (ptrdiff\_t)\textcolor{keyword}{sizeof}(\mbox{\hyperlink{types_8h_a9a69f9a34bc130b6a51162b980e9c631}{mi\_block\_t}}));}
\DoxyCodeLine{00570\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}}-\/>next\ ==\ MI\_BLOCK\_TAG\_GUARDED);}
\DoxyCodeLine{00571\ }
\DoxyCodeLine{00572\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ bsize\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a6134893990c1f09da2b40092ceecc780}{mi\_page\_block\_size}}(page);}
\DoxyCodeLine{00573\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ psize\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a723e4c95209d4c6282b53317473e83d5}{\_mi\_os\_page\_size}}();}
\DoxyCodeLine{00574\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(bsize\ >\ psize);}
\DoxyCodeLine{00575\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(!page-\/>\mbox{\hyperlink{structmi__page__s_a38337bec0f42cdba61acbf5eded5eddb}{memid}}.\mbox{\hyperlink{structmi__memid__s_ac91743de3a74ed0c22ff2cbeddd265eb}{is\_pinned}});}
\DoxyCodeLine{00576\ \ \ \textcolor{keywordtype}{void}*\ gpage\ =\ (\mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*)\mbox{\hyperlink{mimalloc_8h_a840cb394e7433c7fe0c4875a3030c955}{block}}\ +\ bsize\ -\/\ psize;}
\DoxyCodeLine{00577\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ad446ae4d82cbdbd78dfbe46fa2330555}{\_mi\_is\_aligned}}(gpage,\ psize));}
\DoxyCodeLine{00578\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a51771404981128b8f401f9d17bcae520}{\_mi\_os\_unprotect}}(gpage,\ psize);}
\DoxyCodeLine{00579\ \}}
\DoxyCodeLine{00580\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
