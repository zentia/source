\doxysection{procedural\+\_\+primitive.\+h}
\hypertarget{procedural__primitive_8h_source}{}\label{procedural__primitive_8h_source}\index{runtime/runtime/rtx/procedural\_primitive.h@{runtime/runtime/rtx/procedural\_primitive.h}}
\mbox{\hyperlink{procedural__primitive_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <luisa/runtime/device.h>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <luisa/runtime/buffer.h>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <luisa/runtime/rtx/aabb.h>}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceluisa_1_1compute}{luisa::compute}}\ \{}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{comment}{//\ ProceduralPrimitive\ is\ bottom-\/level\ acceleration\ structure(BLAS)\ for\ ray-\/tracing,\ it\ present\ AABB\ for\ custom\ intersection.}}
\DoxyCodeLine{00010\ \textcolor{comment}{//\ Remember,\ the\ AABB\ intersection\ is\ conservative\ and\ may-\/be\ inaccurate,\ so\ never\ use\ it\ as\ "{}box\ intersection"{}}}
\DoxyCodeLine{00011\ \textcolor{keyword}{class\ }\mbox{\hyperlink{dll__export_8h_ad06d699c99cabff41979e596b53ac25a}{LC\_RUNTIME\_API}}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a2f27e82196f6bf12b4c77081d3c39900}{ProceduralPrimitive}}\ final\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_resource_ad04c9df5461ad463bc3bfa340590a61a}{Resource}}\ \{}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a520fa05e0bf58785da428f7a0241eee2}{Device}};}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00016\ \ \ \ \ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a5dba491eeaab0b11acc33f2ab180d5ba}{\_aabb\_buffer\_native\_handle}}\{\};}
\DoxyCodeLine{00017\ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a5d4935c63055ef1191bd43ee3ec02ac9}{\_aabb\_buffer}}\{\};}
\DoxyCodeLine{00018\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a5f76f1ae06df5976414e05f3f04230c7}{\_aabb\_buffer\_offset\_bytes}}\{\};}
\DoxyCodeLine{00019\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_af418507fd205efcf028fb8154c00e529}{\_aabb\_buffer\_size\_bytes}}\{\};}
\DoxyCodeLine{00020\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a7c302b3fc2950a68401978832aa4adbd}{\_aabb\_buffer\_total\_size\_bytes}}\{\};}
\DoxyCodeLine{00021\ \ \ \ \ \mbox{\hyperlink{namespaceluisa_a70f466a8a407b18f0870c81f4bd3bf66}{uint}}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_afc1594e9c63dbe5b01b2ad805f1e84e7}{\_motion\_keyframe\_count}}\{\};}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive}{ProceduralPrimitive}}(\mbox{\hyperlink{classluisa_1_1compute_1_1_device_interface}{DeviceInterface}}\ *device,}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_buffer_view}{BufferView<AABB>}}\ aabb,}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structluisa_1_1compute_1_1_accel_option}{AccelOption}}\ \&\mbox{\hyperlink{structoption}{option}})\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00028\ \ \ \ \ [[nodiscard]]\ \mbox{\hyperlink{classluisa_1_1compute_1_1_buffer_view}{BufferView<AABB>}}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a5c456bd3fcb064be79f7e19175205534}{aabb\_buffer}}()\ const\ noexcept\ \{}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{\mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a5dba491eeaab0b11acc33f2ab180d5ba}{\_aabb\_buffer\_native\_handle}},\ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a5d4935c63055ef1191bd43ee3ec02ac9}{\_aabb\_buffer}},\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structluisa_1_1compute_1_1_a_a_b_b}{AABB}}),}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a5f76f1ae06df5976414e05f3f04230c7}{\_aabb\_buffer\_offset\_bytes}},\ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_af418507fd205efcf028fb8154c00e529}{\_aabb\_buffer\_size\_bytes}}\ /\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structluisa_1_1compute_1_1_a_a_b_b}{AABB}}),}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a7c302b3fc2950a68401978832aa4adbd}{\_aabb\_buffer\_total\_size\_bytes}}\ /\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structluisa_1_1compute_1_1_a_a_b_b}{AABB}})\};}
\DoxyCodeLine{00032\ \ \ \ \ \}}
\DoxyCodeLine{00033\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_ae045d7308ad665d8b527312541d60d30}{ProceduralPrimitive}}()\ noexcept\ =\ \mbox{\hyperlink{sugar_8h_a6face89e97cccad5464dd9bb9c7efd23}{default}};}
\DoxyCodeLine{00034\ \ \ \ \ \string~\mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a2f27e82196f6bf12b4c77081d3c39900}{ProceduralPrimitive}}()\ noexcept\ override;}
\DoxyCodeLine{00035\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a2f27e82196f6bf12b4c77081d3c39900}{ProceduralPrimitive}}(\mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a2f27e82196f6bf12b4c77081d3c39900}{ProceduralPrimitive}}\ \&\&)\ noexcept\ =\ \mbox{\hyperlink{sugar_8h_a6face89e97cccad5464dd9bb9c7efd23}{default}};}
\DoxyCodeLine{00036\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a2f27e82196f6bf12b4c77081d3c39900}{ProceduralPrimitive}}(\mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a2f27e82196f6bf12b4c77081d3c39900}{ProceduralPrimitive}}\ const\ \&)\ noexcept\ =\ delete;}
\DoxyCodeLine{00037\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a2f27e82196f6bf12b4c77081d3c39900}{ProceduralPrimitive}}\ \&operator=(\mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a2f27e82196f6bf12b4c77081d3c39900}{ProceduralPrimitive}}\ \&\&rhs)\ noexcept\ \{}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_resource_ac8bd4f95e29f120931f646355e51323a}{\_move\_from}}(std::move(rhs));}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00040\ \ \ \ \ \}}
\DoxyCodeLine{00041\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a2f27e82196f6bf12b4c77081d3c39900}{ProceduralPrimitive}}\ \&\mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_abaca39b8736917aa1104e3ce01bafe8b}{operator=}}(\mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a2f27e82196f6bf12b4c77081d3c39900}{ProceduralPrimitive}}\ \textcolor{keyword}{const}\ \&)\ \textcolor{keyword}{noexcept}\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{keyword}{using\ }Resource::operator\ \mbox{\hyperlink{sugar_8h_abb452686968e48b67397da5f97445f5b}{bool}};}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{comment}{//\ build\ procedural\ primitives'\ based\ bottom-\/level\ acceleration\ structure}}
\DoxyCodeLine{00045\ \ \ \ \ [[nodiscard]]\ luisa::unique\_ptr<Command>\ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a2f7fffbdeaed1da2d4c5c633b0b18dc1}{build}}(}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceluisa_1_1compute_a64463a2984ce24f41388a1cf382ead11}{AccelBuildRequest}}\ request\ =\ \mbox{\hyperlink{namespaceluisa_1_1compute_a64463a2984ce24f41388a1cf382ead11a51c5ea1e50025d8780628e8894a6635f}{AccelBuildRequest::PREFER\_UPDATE}})\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{00047\ \ \ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_ae0048a2be12f3a1e5760f1dea67a8c63}{aabb\_buffer\_offset}}()\ const\ noexcept\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_resource_acd4eeb601dbaa644497541380a30c9aa}{\_check\_is\_valid}}();}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a5f76f1ae06df5976414e05f3f04230c7}{\_aabb\_buffer\_offset\_bytes}};}
\DoxyCodeLine{00050\ \ \ \ \ \}}
\DoxyCodeLine{00051\ \ \ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a87f7372d0b9fd2e19cc989ec194c2dd3}{aabb\_buffer\_size}}()\ const\ noexcept\ \{}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_resource_acd4eeb601dbaa644497541380a30c9aa}{\_check\_is\_valid}}();}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_af418507fd205efcf028fb8154c00e529}{\_aabb\_buffer\_size\_bytes}};}
\DoxyCodeLine{00054\ \ \ \ \ \}}
\DoxyCodeLine{00055\ \ \ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a794fa6461ca4ef3168264587be3e274f}{motion\_keyframe\_count}}()\ const\ noexcept\ \{}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_resource_acd4eeb601dbaa644497541380a30c9aa}{\_check\_is\_valid}}();}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::max<uint>(1u,\ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_afc1594e9c63dbe5b01b2ad805f1e84e7}{\_motion\_keyframe\_count}});}
\DoxyCodeLine{00058\ \ \ \ \ \}}
\DoxyCodeLine{00059\ \ \ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_aec0ab9b57f193d60e0cdd06184521d47}{aabb\_count\_per\_motion\_keyframe}}()\ const\ noexcept\ \{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ n\ =\ this-\/>\mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_a794fa6461ca4ef3168264587be3e274f}{motion\_keyframe\_count}}();}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive_af418507fd205efcf028fb8154c00e529}{\_aabb\_buffer\_size\_bytes}}\ /\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structluisa_1_1compute_1_1_a_a_b_b}{AABB}})\ /\ n;}
\DoxyCodeLine{00062\ \ \ \ \ \}}
\DoxyCodeLine{00063\ \};}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ AABBBuffer>}
\DoxyCodeLine{00066\ \mbox{\hyperlink{classluisa_1_1compute_1_1_procedural_primitive}{ProceduralPrimitive}}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_device_a0677f001f6eb1f89316116dfbb022ae0}{Device::create\_procedural\_primitive}}(}
\DoxyCodeLine{00067\ \ \ \ \ AABBBuffer\ \&\&aabb\_buffer,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structluisa_1_1compute_1_1_accel_option}{AccelOption}}\ \&\mbox{\hyperlink{structoption}{option}})\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordflow}{return}\ this-\/>\mbox{\hyperlink{classluisa_1_1compute_1_1_device_a989b9aac0ea5d2b4e432c05b6fe821f5}{\_create<ProceduralPrimitive>}}(std::forward<AABBBuffer>(aabb\_buffer),\ \mbox{\hyperlink{structoption}{option}});}
\DoxyCodeLine{00069\ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \}\textcolor{comment}{//\ namespace\ luisa::compute}}

\end{DoxyCode}
