\doxysection{base.\+h}
\hypertarget{external_2libcds_2cds_2urcu_2details_2base_8h_source}{}\label{external_2libcds_2cds_2urcu_2details_2base_8h_source}\index{external/libcds/cds/urcu/details/base.h@{external/libcds/cds/urcu/details/base.h}}
\mbox{\hyperlink{external_2libcds_2cds_2urcu_2details_2base_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ (c)\ 2006-\/2018\ Maxim\ Khizhinsky}}
\DoxyCodeLine{00002\ \textcolor{comment}{//}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ Distributed\ under\ the\ Boost\ Software\ License,\ Version\ 1.0.\ (See\ accompanying}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ file\ LICENSE\ or\ copy\ at\ http://www.boost.org/LICENSE\_1\_0.txt)}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#ifndef\ CDSLIB\_URCU\_DETAILS\_BASE\_H}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#define\ CDSLIB\_URCU\_DETAILS\_BASE\_H}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{external_2libcds_2cds_2algo_2atomic_8h}{cds/algo/atomic.h}}>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{retired__ptr_8h}{cds/gc/details/retired\_ptr.h}}>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{external_2libcds_2cds_2details_2allocator_8h}{cds/details/allocator.h}}>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{cds_2os_2thread_8h}{cds/os/thread.h}}>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{marked__ptr_8h}{cds/details/marked\_ptr.h}}>}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacecds}{cds}}\ \{}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacecds_1_1urcu}{urcu}}\ \{}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \textcolor{preprocessor}{\#\ \ \ if\ (CDS\_OS\_INTERFACE\ ==\ CDS\_OSI\_UNIX\ ||\ defined(CDS\_DOXYGEN\_INVOKED))\ \&\&\ !defined(CDS\_THREAD\_SANITIZER\_ENABLED)}}
\DoxyCodeLine{00200\ \textcolor{preprocessor}{\#\ \ \ \ \ \ \ define\ CDS\_URCU\_SIGNAL\_HANDLING\_ENABLED\ 1}}
\DoxyCodeLine{00201\ \textcolor{preprocessor}{\#\ \ \ endif}}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structcds_1_1urcu_1_1general__purpose__rcu}{general\_purpose\_rcu}}\ \{}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//@cond}}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{eabase_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \textcolor{keyword}{const}\ c\_nControlBit\ =\ 0x80000000;}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{eabase_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \textcolor{keyword}{const}\ c\_nNestMask\ \ \ =\ c\_nControlBit\ -\/\ 1;}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//@endcond}}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \textcolor{preprocessor}{\#\ \ \ ifdef\ CDS\_URCU\_SIGNAL\_HANDLING\_ENABLED}}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structcds_1_1urcu_1_1signal__handling__rcu}{signal\_handling\_rcu}}\ \{}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//@cond}}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{eabase_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \textcolor{keyword}{const}\ c\_nControlBit\ =\ 0x80000000;}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{eabase_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \textcolor{keyword}{const}\ c\_nNestMask\ \ \ =\ c\_nControlBit\ -\/\ 1;}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//@endcond}}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00219\ \textcolor{preprocessor}{\#\ \ \ endif}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structcds_1_1urcu_1_1general__instant__tag}{general\_instant\_tag}}:\ \textcolor{keyword}{public}\ \mbox{\hyperlink{structcds_1_1urcu_1_1general__purpose__rcu}{general\_purpose\_rcu}}\ \{}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{structcds_1_1urcu_1_1general__purpose__rcu}{general\_purpose\_rcu}}\ \ \ \ \ \mbox{\hyperlink{structcds_1_1urcu_1_1general__instant__tag_a2cf7a67bea98b3d8d5f96a37a598cb11}{rcu\_class}}\ ;\ }
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structcds_1_1urcu_1_1general__buffered__tag}{general\_buffered\_tag}}:\ \textcolor{keyword}{public}\ \mbox{\hyperlink{structcds_1_1urcu_1_1general__purpose__rcu}{general\_purpose\_rcu}}}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{structcds_1_1urcu_1_1general__purpose__rcu}{general\_purpose\_rcu}}\ \ \ \ \ \mbox{\hyperlink{structcds_1_1urcu_1_1general__buffered__tag_a9f8f18d4f705d0ad74f411d02d9ada9f}{rcu\_class}}\ ;\ }
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00231\ }
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structcds_1_1urcu_1_1general__threaded__tag}{general\_threaded\_tag}}:\ \textcolor{keyword}{public}\ \mbox{\hyperlink{structcds_1_1urcu_1_1general__purpose__rcu}{general\_purpose\_rcu}}\ \{}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{structcds_1_1urcu_1_1general__purpose__rcu}{general\_purpose\_rcu}}\ \ \ \ \ \mbox{\hyperlink{structcds_1_1urcu_1_1general__threaded__tag_ad3bf11d7255fcefb0e79581819d05e10}{rcu\_class}}\ ;\ }
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \textcolor{preprocessor}{\#\ \ \ ifdef\ CDS\_URCU\_SIGNAL\_HANDLING\_ENABLED}}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structcds_1_1urcu_1_1signal__buffered__tag}{signal\_buffered\_tag}}:\ \textcolor{keyword}{public}\ \mbox{\hyperlink{structcds_1_1urcu_1_1signal__handling__rcu}{signal\_handling\_rcu}}\ \{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{structcds_1_1urcu_1_1signal__handling__rcu}{signal\_handling\_rcu}}\ \ \ \ \ \mbox{\hyperlink{structcds_1_1urcu_1_1signal__buffered__tag_a1650ecc74b15d59cc9473c9cf3f85dd0}{rcu\_class}}\ ;\ }
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00242\ \textcolor{preprocessor}{\#\ \ \ endif}}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ cds::gc::details::retired\_ptr\ \ \ \mbox{\hyperlink{namespacecds_1_1urcu_a9fd06318cc85d4d956ba7fb8152083c1}{retired\_ptr}};}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }cds::gc::make\_retired\_ptr;}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ cds::gc::details::free\_retired\_ptr\_func\ \mbox{\hyperlink{namespacecds_1_1urcu_a914791bb9ca62963d05a12cb5271f7d5}{free\_retired\_ptr\_func}};}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \textcolor{comment}{//@cond}}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacecds_1_1urcu_1_1details}{details}}\ \{}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ RCUtag>}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }thread\_data;}
\DoxyCodeLine{00257\ }
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ RCUtag>}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{class\ }thread\_gc;}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ RCUtag\ >}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{class\ }singleton;}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//@cond}}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{class\ }singleton\_vtbl\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \string~singleton\_vtbl()}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\}}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ retire\_ptr(\ \mbox{\hyperlink{namespacecds_1_1urcu_a9fd06318cc85d4d956ba7fb8152083c1}{retired\_ptr}}\&\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ )\ =\ 0;}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{class\ }gc\_common}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ MarkedPtr>\ \textcolor{keyword}{using\ }atomic\_marked\_ptr\ =\ atomics::atomic<MarkedPtr>;}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//@endcond}}
\DoxyCodeLine{00279\ }
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//@cond}}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ ThreadData>}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }thread\_list\_record\ \{}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ThreadData*\ \ next\_\ =\ \textcolor{keyword}{nullptr};\ \ \ }
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ atomics::atomic<OS::ThreadId>\ thread\_id\_\{\ cds::OS::c\_NullThreadId\ \};\ }
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ thread\_list\_record()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{explicit}\ thread\_list\_record(\ \mbox{\hyperlink{namespacecds_1_1_o_s_1_1posix_aa5d1cef6c4dd410d6d21c851201bfc40}{OS::ThreadId}}\ owner\ )}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ thread\_id\_(\ owner\ )}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\}}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \string~thread\_list\_record()}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\}}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//@endcond}}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//@cond}}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ RCUtag,\ \textcolor{keyword}{class}\ Alloc\ =\ CDS\_DEFAULT\_ALLOCATOR\ >}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{class\ }thread\_list\ \{}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ thread\_data<RCUtag>\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ thread\_record;}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classcds_1_1details_1_1_allocator}{cds::details::Allocator<\ thread\_record,\ Alloc\ >}}\ allocator\_type;}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ atomics::atomic<thread\_record\ *>\ m\_pHead;}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ thread\_list()}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ m\_pHead(\ \textcolor{keyword}{nullptr}\ )}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\}}
\DoxyCodeLine{00311\ }
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \string~thread\_list()}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ destroy();}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ thread\_record\ *\ alloc()}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ thread\_record\ *\ pRec;}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacecds_1_1_o_s_1_1posix_aa5d1cef6c4dd410d6d21c851201bfc40}{cds::OS::ThreadId}}\ \textcolor{keyword}{const}\ nullThreadId\ =\ cds::OS::c\_NullThreadId;}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacecds_1_1_o_s_1_1posix_aa5d1cef6c4dd410d6d21c851201bfc40}{cds::OS::ThreadId}}\ \textcolor{keyword}{const}\ curThreadId\ \ =\ \mbox{\hyperlink{namespacecds_1_1_o_s_1_1posix_a083987470e15085707e4665d15d66307}{cds::OS::get\_current\_thread\_id}}();}
\DoxyCodeLine{00322\ }
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ First,\ try\ to\ reuse\ a\ retired\ (non-\/active)\ HP\ record}}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ pRec\ =\ m\_pHead.load(\ atomics::memory\_order\_acquire\ );\ pRec;\ pRec\ =\ pRec-\/>m\_list.next\_\ )\ \{}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacecds_1_1_o_s_1_1posix_aa5d1cef6c4dd410d6d21c851201bfc40}{cds::OS::ThreadId}}\ thId\ =\ nullThreadId;}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !pRec-\/>m\_list.thread\_id\_.compare\_exchange\_strong(\ thId,\ curThreadId,\ atomics::memory\_order\_acquire,\ atomics::memory\_order\_relaxed\ ))}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ pRec;}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ records\ available\ for\ reuse}}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Allocate\ and\ push\ a\ new\ record}}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pRec\ =\ allocator\_type().New(\ curThreadId\ );}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ thread\_record\ *\ pOldHead\ =\ m\_pHead.load(\ atomics::memory\_order\_acquire\ );}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compiler\ barriers:\ assignment\ MUST\ BE\ inside\ the\ loop}}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{gcc_2compiler__barriers_8h_aaa93ffc9d7c22091e77cba55f18b856c}{CDS\_COMPILER\_RW\_BARRIER}};}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pRec-\/>m\_list.next\_\ =\ pOldHead;}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{gcc_2compiler__barriers_8h_aaa93ffc9d7c22091e77cba55f18b856c}{CDS\_COMPILER\_RW\_BARRIER}};}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ (\ !m\_pHead.compare\_exchange\_weak(\ pOldHead,\ pRec,\ atomics::memory\_order\_release,\ atomics::memory\_order\_acquire\ ));}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ pRec;}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ retire(\ thread\_record\ *\ pRec\ )}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ assert(\ pRec\ !=\ \textcolor{keyword}{nullptr}\ );}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pRec-\/>m\_list.thread\_id\_.store(\ cds::OS::c\_NullThreadId,\ atomics::memory\_order\_release\ );}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00351\ }
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ detach\_all()}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ thread\_record\ *\ pNext\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacecds_1_1_o_s_1_1posix_aa5d1cef6c4dd410d6d21c851201bfc40}{cds::OS::ThreadId}}\ \textcolor{keyword}{const}\ nullThreadId\ =\ cds::OS::c\_NullThreadId;}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ thread\_record\ *\ pRec\ =\ m\_pHead.load(\ atomics::memory\_order\_acquire\ );\ pRec;\ pRec\ =\ pNext\ )\ \{}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pNext\ =\ pRec-\/>m\_list.next\_;}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ pRec-\/>m\_list.thread\_id\_.load(\ atomics::memory\_order\_acquire\ )\ !=\ nullThreadId\ )\ \{}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ retire(\ pRec\ );}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00364\ }
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ thread\_record\ *\ \mbox{\hyperlink{ittnotify__static_8h_ad492e8facf9b4113e52f1918fceb8804}{head}}(\ atomics::memory\_order\ mo\ )\textcolor{keyword}{\ const}}
\DoxyCodeLine{00366\ \textcolor{keyword}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ m\_pHead.load(\ mo\ );}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ destroy()}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ allocator\_type\ al;}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{details_2defs_8h_ab49f4aea1a39215dae0410af9ccba6f3}{CDS\_DEBUG\_ONLY}}(\ \mbox{\hyperlink{namespacecds_1_1_o_s_1_1posix_aa5d1cef6c4dd410d6d21c851201bfc40}{cds::OS::ThreadId}}\ \textcolor{keyword}{const}\ nullThreadId\ =\ cds::OS::c\_NullThreadId;\ )}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{details_2defs_8h_ab49f4aea1a39215dae0410af9ccba6f3}{CDS\_DEBUG\_ONLY}}(\ \mbox{\hyperlink{namespacecds_1_1_o_s_1_1posix_aa5d1cef6c4dd410d6d21c851201bfc40}{cds::OS::ThreadId}}\ \textcolor{keyword}{const}\ mainThreadId\ =\ \mbox{\hyperlink{namespacecds_1_1_o_s_1_1posix_a083987470e15085707e4665d15d66307}{cds::OS::get\_current\_thread\_id}}()\ ;)}
\DoxyCodeLine{00376\ }
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ thread\_record\ *\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ m\_pHead.exchange(\ \textcolor{keyword}{nullptr},\ atomics::memory\_order\_acquire\ );}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ )\ \{}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ thread\_record\ *\ pNext\ =\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}-\/>m\_list.next\_;}
\DoxyCodeLine{00380\ }
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ assert(\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}-\/>m\_list.thread\_id\_.load(\ atomics::memory\_order\_relaxed\ )\ ==\ nullThreadId}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}-\/>m\_list.thread\_id\_.load(\ atomics::memory\_order\_relaxed\ )\ ==\ mainThreadId}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{00384\ }
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ al.Delete(\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ );}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ pNext;}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//@endcond}}
\DoxyCodeLine{00391\ }
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//@cond}}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ThreadGC>}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{class\ }scoped\_lock\ \{}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ ThreadGC\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ thread\_gc;}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ thread\_gc::rcu\_tag\ rcu\_tag;}
\DoxyCodeLine{00398\ }
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ scoped\_lock()}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ thread\_gc::access\_lock();}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00404\ }
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \string~scoped\_lock()}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ thread\_gc::access\_unlock();}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//@endcond}}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ namespace\ details}}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ \textcolor{comment}{//@endcond}}
\DoxyCodeLine{00413\ }
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ forwards}}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \textcolor{comment}{//@cond}}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ RCUimpl>\ \textcolor{keyword}{class\ }\mbox{\hyperlink{namespacecds_1_1gc}{gc}};}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ \textcolor{comment}{//@endcond}}
\DoxyCodeLine{00418\ }
\DoxyCodeLine{00420\ }
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structcds_1_1urcu_1_1epoch__retired__ptr_aa4f89705926205d529fcd659204dfceb}{epoch\_retired\_ptr}}:\ \textcolor{keyword}{public}\ \mbox{\hyperlink{namespacecds_1_1urcu_a9fd06318cc85d4d956ba7fb8152083c1}{retired\_ptr}}}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \ \ \ \mbox{\hyperlink{structcds_1_1urcu_1_1epoch__retired__ptr_a263aca6dbadbe941f6677c561a4f8726}{m\_nEpoch}};\ \ }
\DoxyCodeLine{00427\ }
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//@cond}}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structcds_1_1urcu_1_1epoch__retired__ptr_aa4f89705926205d529fcd659204dfceb}{epoch\_retired\_ptr}}()}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \ \ \ \ \{\}}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//@endcond}}
\DoxyCodeLine{00432\ }
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structcds_1_1urcu_1_1epoch__retired__ptr_aa4f89705926205d529fcd659204dfceb}{epoch\_retired\_ptr}}(\ \mbox{\hyperlink{namespacecds_1_1urcu_a9fd06318cc85d4d956ba7fb8152083c1}{retired\_ptr}}\ \textcolor{keyword}{const}\&\ rp,\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ nEpoch\ )}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{namespacecds_1_1urcu_a9fd06318cc85d4d956ba7fb8152083c1}{retired\_ptr}}(\ rp\ )}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ,\ \mbox{\hyperlink{structcds_1_1urcu_1_1epoch__retired__ptr_a263aca6dbadbe941f6677c561a4f8726}{m\_nEpoch}}(\ nEpoch\ )}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \ \ \ \ \{\}}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00439\ }
\DoxyCodeLine{00440\ \ \ \ \ \}\ \textcolor{comment}{//\ namespace\ urcu}}
\DoxyCodeLine{00441\ \}\ \textcolor{comment}{//\ namespace\ cds}}
\DoxyCodeLine{00442\ }
\DoxyCodeLine{00443\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ \#ifndef\ CDSLIB\_URCU\_DETAILS\_BASE\_H}}

\end{DoxyCode}
