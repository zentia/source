\doxysection{private\+\_\+server.\+cpp}
\hypertarget{private__server_8cpp_source}{}\label{private__server_8cpp_source}\index{external/taskflow/3rd-\/party/tbb/src/tbb/private\_server.cpp@{external/taskflow/3rd-\/party/tbb/src/tbb/private\_server.cpp}}
\mbox{\hyperlink{private__server_8cpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ \ \ \ Copyright\ (c)\ 2005-\/2020\ Intel\ Corporation}}
\DoxyCodeLine{00003\ \textcolor{comment}{}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ \ \ \ Licensed\ under\ the\ Apache\ License,\ Version\ 2.0\ (the\ "{}License"{});}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ \ \ \ you\ may\ not\ use\ this\ file\ except\ in\ compliance\ with\ the\ License.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ \ \ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00007\ \textcolor{comment}{}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ \ \ \ \ \ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00009\ \textcolor{comment}{}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ \ \ \ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,\ software}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ \ \ \ distributed\ under\ the\ License\ is\ distributed\ on\ an\ "{}AS\ IS"{}\ BASIS,}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ \ \ \ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY\ KIND,\ either\ express\ or\ implied.}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ \ \ \ See\ the\ License\ for\ the\ specific\ language\ governing\ permissions\ and}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ \ \ \ limitations\ under\ the\ License.}}
\DoxyCodeLine{00015\ \textcolor{comment}{*/}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{rml__tbb_8h}{../rml/include/rml\_tbb.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{thread__monitor_8h}{../rml/server/thread\_monitor.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{external_2taskflow_23rd-party_2tbb_2include_2tbb_2atomic_8h}{tbb/atomic.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cache__aligned__allocator_8h}{tbb/cache\_aligned\_allocator.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{scheduler__common_8h}{scheduler\_common.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{governor_8h}{governor.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tbb__misc_8h}{tbb\_misc.h}}"{}}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{keyword}{using\ }\mbox{\hyperlink{classrml_1_1internal_1_1thread__monitor}{rml::internal::thread\_monitor}};}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetbb}{tbb}}\ \{}
\DoxyCodeLine{00028\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetbb_1_1internal}{internal}}\ \{}
\DoxyCodeLine{00029\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetbb_1_1internal_1_1rml}{rml}}\ \{}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{keyword}{typedef}\ thread\_monitor::handle\_type\ \mbox{\hyperlink{namespacetbb_1_1internal_1_1rml_a82834ba59b391aaf39b176ac47ce6247}{thread\_handle}};}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server}{private\_server}};}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_aabf8c53453ec333ca4efcd3902cd5edc}{private\_worker}}:\ no\_copy\ \{}
\DoxyCodeLine{00036\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keyword}{enum}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234}{state\_t}}\ \{}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234a490195f93cdd2fd907db7287d10df017}{st\_init}},}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234abd55681b45afd309cad178bb5154b5ac}{st\_starting}},}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234a73e9233f5ba7783a05d1003b5a6b1e5f}{st\_normal}},}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234a7bff4b40d31b7402447953bab754eb70}{st\_quit}}}
\DoxyCodeLine{00053\ \ \ \ \ \};}
\DoxyCodeLine{00054\ \ \ \ \ \mbox{\hyperlink{sugar_8h_a48f1c51623545bd4f58fbab2fa6091d0}{atomic<state\_t>}}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_aad6c215e7cc3e4d6772c1482f8139c29}{my\_state}};}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00057\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_ab2148ff648505b5cfc4e67de39af10e8}{private\_server}}\&\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a1228521a934c33d8f4a06e390d90b021}{my\_server}};}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00060\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1tbb__client}{tbb\_client}}\&\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_ab5e85075491fdbd1a1194158e12739a6}{my\_client}};}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_ac8489df7418837e26954ad2cd8817ff9}{my\_index}};}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00068\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1thread__monitor}{thread\_monitor}}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a5997b0d39846715229a7faab8bd7c6cc}{my\_thread\_monitor}};}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00071\ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_1_1rml_a82834ba59b391aaf39b176ac47ce6247}{thread\_handle}}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a1dddd90bed68a2bdd4391f407eb1a8ae}{my\_handle}};}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00074\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_aabf8c53453ec333ca4efcd3902cd5edc}{private\_worker}}*\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a2787631f2924ada895b183cfbee5b72d}{my\_next}};}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_ab2148ff648505b5cfc4e67de39af10e8}{private\_server}};}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_acfcd50e891e9815c7fb5c7422ee62a9f}{run}}();}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_aafc770ff14751ed4dd2c3f3b1d030156}{wake\_or\_launch}}();}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a1fc69b65169acd8f06011e21d1892dcd}{start\_shutdown}}();}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keyword}{static}\ \_\_RML\_DECL\_THREAD\_ROUTINE\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a70d97a45a6aa80d21f193f1aabe631a0}{thread\_routine}}(\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}}\ );}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a6e4301e948ea0fe1b57b4f5f3ec9375a}{release\_handle}}(\mbox{\hyperlink{namespacetbb_1_1internal_1_1rml_a82834ba59b391aaf39b176ac47ce6247}{thread\_handle}}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a1dddd90bed68a2bdd4391f407eb1a8ae}{my\_handle}},\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bundled_2ranges_8h_a703e3555a519a55eae7986580660994c}{join}});}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00092\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_aabf8c53453ec333ca4efcd3902cd5edc}{private\_worker}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_ab2148ff648505b5cfc4e67de39af10e8}{private\_server}}\&\ server,\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1tbb__client}{tbb\_client}}\&\ client,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ )\ :}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a1228521a934c33d8f4a06e390d90b021}{my\_server}}(server),\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_ab5e85075491fdbd1a1194158e12739a6}{my\_client}}(client),\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_ac8489df7418837e26954ad2cd8817ff9}{my\_index}}(\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}),}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a5997b0d39846715229a7faab8bd7c6cc}{my\_thread\_monitor}}(),\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a1dddd90bed68a2bdd4391f407eb1a8ae}{my\_handle}}(),\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a2787631f2924ada895b183cfbee5b72d}{my\_next}}()}
\DoxyCodeLine{00095\ \ \ \ \ \{}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_aad6c215e7cc3e4d6772c1482f8139c29}{my\_state}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234a490195f93cdd2fd907db7287d10df017}{st\_init}};}
\DoxyCodeLine{00097\ \ \ \ \ \}}
\DoxyCodeLine{00098\ \};}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{namespacetbb_1_1internal_1_1rml_a92b08a6fe663c24962f7e3ce74387baa}{cache\_line\_size}}\ =\ tbb::internal::NFS\_MaxLineSize;}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \textcolor{preprocessor}{\#if\ \_MSC\_VER\ \&\&\ !defined(\_\_INTEL\_COMPILER)}}
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{comment}{//\ Suppress\ overzealous\ compiler\ warnings\ about\ uninstantiable\ class}}
\DoxyCodeLine{00105\ \textcolor{preprocessor}{\ \ \ \ \#pragma\ warning(push)}}
\DoxyCodeLine{00106\ \textcolor{preprocessor}{\ \ \ \ \#pragma\ warning(disable:4510\ 4610)}}
\DoxyCodeLine{00107\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00108\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1padded__private__worker_af82bc89002b70605295d42909da4063d}{padded\_private\_worker}}:\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_aabf8c53453ec333ca4efcd3902cd5edc}{private\_worker}}\ \{}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keywordtype}{char}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1padded__private__worker_a668d152e3588f5154d61581dfb6fba92}{pad}}[\mbox{\hyperlink{namespacetbb_1_1internal_1_1rml_a92b08a6fe663c24962f7e3ce74387baa}{cache\_line\_size}}\ -\/\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_aabf8c53453ec333ca4efcd3902cd5edc}{private\_worker}})\%\mbox{\hyperlink{namespacetbb_1_1internal_1_1rml_a92b08a6fe663c24962f7e3ce74387baa}{cache\_line\_size}}];}
\DoxyCodeLine{00110\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00111\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1padded__private__worker_af82bc89002b70605295d42909da4063d}{padded\_private\_worker}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_ab2148ff648505b5cfc4e67de39af10e8}{private\_server}}\&\ server,\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1tbb__client}{tbb\_client}}\&\ client,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ )}
\DoxyCodeLine{00112\ \ \ \ \ :\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_aabf8c53453ec333ca4efcd3902cd5edc}{private\_worker}}(server,client,\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{\ suppress\_unused\_warning(\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1padded__private__worker_a668d152e3588f5154d61581dfb6fba92}{pad}});\ \}}
\DoxyCodeLine{00113\ \};}
\DoxyCodeLine{00114\ \textcolor{preprocessor}{\#if\ \_MSC\_VER\ \&\&\ !defined(\_\_INTEL\_COMPILER)}}
\DoxyCodeLine{00115\ \textcolor{preprocessor}{\ \ \ \ \#pragma\ warning(pop)}}
\DoxyCodeLine{00116\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a941f2e582957e03d164a9a3c81e77fa2}{private\_server}}:\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1tbb__server}{tbb\_server}},\ no\_copy\ \{}
\DoxyCodeLine{00119\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00120\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1tbb__client}{tbb\_client}}\&\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_afab7ce16d2c4777bc78d3414018cd6c9}{my\_client}};}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classrml_1_1client_a0dc06ede570f7ee6d3021862cb71119f}{tbb\_client::size\_type}}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a1899982faeae9713e24d25d4fd26a34a}{my\_n\_thread}};}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a16e4dfc8c5e061a1d9889012b9246e3e}{my\_stack\_size}};}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00133\ \ \ \ \ \mbox{\hyperlink{sugar_8h_a48f1c51623545bd4f58fbab2fa6091d0}{atomic<int>}}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aa2bf328b950275f1aa80b33f43021ce1}{my\_slack}};}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00136\ \ \ \ \ \mbox{\hyperlink{sugar_8h_a48f1c51623545bd4f58fbab2fa6091d0}{atomic<int>}}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a9ae8da3b2b8828316be5be20ad19e92f}{my\_ref\_count}};}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1padded__private__worker}{padded\_private\_worker}}*\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_ada8ed4bd1a1ded121471fb872b07c71c}{my\_thread\_array}};}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00141\ \ \ \ \ tbb::atomic<private\_worker*>\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aa9a4e0652fbb72cab569ea784989b65c}{my\_asleep\_list\_root}};}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{namespacetbb_1_1internal_a7129c5cff1bad05eaf6c218a04f70456}{scheduler\_mutex\_type}}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a53b661dc82f3484dfaba0cba1917cb6e}{asleep\_list\_mutex\_type}};}
\DoxyCodeLine{00145\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a53b661dc82f3484dfaba0cba1917cb6e}{asleep\_list\_mutex\_type}}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_abdadfc9229feb5e185139e32348fa0e2}{my\_asleep\_list\_mutex}};}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \textcolor{preprocessor}{\#if\ TBB\_USE\_ASSERT}}
\DoxyCodeLine{00148\ \ \ \ \ \mbox{\hyperlink{sugar_8h_a48f1c51623545bd4f58fbab2fa6091d0}{atomic<int>}}\ my\_net\_slack\_requests;}
\DoxyCodeLine{00149\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ TBB\_USE\_ASSERT\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a23bccadb141031d3e12b0c3c99838798}{propagate\_chain\_reaction}}()\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ First\ test\ of\ a\ double-\/check\ idiom.\ \ Second\ test\ is\ inside\ wake\_some(0).}}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aa9a4e0652fbb72cab569ea784989b65c}{my\_asleep\_list\_root}}\ )}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a2be83f895b89b3861ee8ab31535c1f34}{wake\_some}}(0);}
\DoxyCodeLine{00158\ \ \ \ \ \}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a65bd5075630d2f9cce6f71fc3c922e46}{try\_insert\_in\_asleep\_list}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker}{private\_worker}}\&\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ );}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a2be83f895b89b3861ee8ab31535c1f34}{wake\_some}}(\ \textcolor{keywordtype}{int}\ additional\_slack\ );}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a3f85635899ef8652d32de0e42fcbd3cd}{\string~private\_server}}();}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_af8d1c910ec7d64b8fc93b03bdc23ef64}{remove\_server\_ref}}()\ \{}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ -\/-\/\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a9ae8da3b2b8828316be5be20ad19e92f}{my\_ref\_count}}==0\ )\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_afab7ce16d2c4777bc78d3414018cd6c9}{my\_client}}.acknowledge\_close\_connection();}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ \ \ this-\/>\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a3f85635899ef8652d32de0e42fcbd3cd}{\string~private\_server}}();}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1cache__aligned__allocator}{tbb::cache\_aligned\_allocator<private\_server>}}().\mbox{\hyperlink{classtbb_1_1cache__aligned__allocator_a7f7310e046c4b6b8618864de8e27a471}{deallocate}}(\ \textcolor{keyword}{this},\ 1\ );}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00174\ \ \ \ \ \}}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_af1df28b1fce17bd3ac403abe94d1f331}{private\_worker}};}
\DoxyCodeLine{00177\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00178\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a941f2e582957e03d164a9a3c81e77fa2}{private\_server}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1tbb__client}{tbb\_client}}\&\ client\ );}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \ \ \mbox{\hyperlink{classrml_1_1versioned__object_a759650010b271238ef9433442730c423}{version\_type}}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a0eb1efa6f4ec7fc6f21bf729b80690be}{version}}()\ const\ \_\_TBB\_override\ \{}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00182\ \ \ \ \ \}}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aa3168e9dc158c52625a69a47ebf840d5}{request\_close\_connection}}(\ \textcolor{keywordtype}{bool}\ \textcolor{comment}{/*exiting*/}\ )\ \_\_TBB\_override\ \{}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a1899982faeae9713e24d25d4fd26a34a}{my\_n\_thread}};\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ )}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_ada8ed4bd1a1ded121471fb872b07c71c}{my\_thread\_array}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}].start\_shutdown();}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_af8d1c910ec7d64b8fc93b03bdc23ef64}{remove\_server\_ref}}();}
\DoxyCodeLine{00188\ \ \ \ \ \}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a3417aa3f61a3ba3d6fed88b0e5a9b040}{yield}}()\ \_\_TBB\_override\ \{\mbox{\hyperlink{ibm__aix51_8h_a2b17e6e4504bddf60a920f609fc46ea6}{\_\_TBB\_Yield}}();\}}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a2f6777b6edbb4526ea7be59d8278a3fa}{independent\_thread\_number\_changed}}(\ \textcolor{keywordtype}{int}\ )\ \_\_TBB\_override\ \{\mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\textcolor{keyword}{false},\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});\}}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a43a468f1aa03ce9be85e4cf0e99e7f17}{default\_concurrency}}()\ const\ \_\_TBB\_override\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_a87ef607c22c347eb97ddafa4384b4f1d}{governor::default\_num\_threads}}()\ -\/\ 1;\ \}}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aed71f902aab1aef77a016420c586f535}{adjust\_job\_count\_estimate}}(\ \textcolor{keywordtype}{int}\ delta\ )\ \_\_TBB\_override;}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \textcolor{preprocessor}{\#if\ \_WIN32||\_WIN64}}
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keywordtype}{void}\ register\_master\ (\ ::rml::server::execution\_resource\_t\&\ )\ \_\_TBB\_override\ \{\}}
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{keywordtype}{void}\ unregister\_master\ (\ ::rml::server::execution\_resource\_t\ )\ \_\_TBB\_override\ \{\}}
\DoxyCodeLine{00201\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_WIN32||\_WIN64\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00202\ \};}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00205\ \textcolor{comment}{//\ Methods\ of\ private\_worker}}
\DoxyCodeLine{00206\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00207\ \textcolor{preprocessor}{\#if\ \_MSC\_VER\ \&\&\ !defined(\_\_INTEL\_COMPILER)}}
\DoxyCodeLine{00208\ \ \ \ \ \textcolor{comment}{//\ Suppress\ overzealous\ compiler\ warnings\ about\ an\ initialized\ variable\ 'sink\_for\_alloca'\ not\ referenced}}
\DoxyCodeLine{00209\ \textcolor{preprocessor}{\ \ \ \ \#pragma\ warning(push)}}
\DoxyCodeLine{00210\ \textcolor{preprocessor}{\ \ \ \ \#pragma\ warning(disable:4189)}}
\DoxyCodeLine{00211\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00212\ \textcolor{preprocessor}{\#if\ \_\_MINGW32\_\_\ \&\&\ \_\_GNUC\_\_==4\ \&\&\_\_GNUC\_MINOR\_\_>=2\ \&\&\ !\_\_MINGW64\_\_}}
\DoxyCodeLine{00213\ \textcolor{comment}{//\ ensure\ that\ stack\ is\ properly\ aligned\ for\ TBB\ threads}}
\DoxyCodeLine{00214\ \mbox{\hyperlink{bench__reverse_8cpp_af57f208bfabc394dd45616e63728dce0}{\_\_attribute\_\_}}((force\_align\_arg\_pointer))}
\DoxyCodeLine{00215\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00216\ \_\_RML\_DECL\_THREAD\_ROUTINE\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a70d97a45a6aa80d21f193f1aabe631a0}{private\_worker::thread\_routine}}(\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}}\ )\ \{}
\DoxyCodeLine{00217\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_aabf8c53453ec333ca4efcd3902cd5edc}{private\_worker}}*\ self\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_aabf8c53453ec333ca4efcd3902cd5edc}{private\_worker}}*\textcolor{keyword}{>}(\mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}});}
\DoxyCodeLine{00218\ \ \ \ \ \mbox{\hyperlink{thread__monitor_8h_aa4241f64a04d10990a389eeba6fd4d8c}{AVOID\_64K\_ALIASING}}(\ self-\/>\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_ac8489df7418837e26954ad2cd8817ff9}{my\_index}}\ );}
\DoxyCodeLine{00219\ \ \ \ \ self-\/>\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_acfcd50e891e9815c7fb5c7422ee62a9f}{run}}();}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00221\ \}}
\DoxyCodeLine{00222\ \textcolor{preprocessor}{\#if\ \_MSC\_VER\ \&\&\ !defined(\_\_INTEL\_COMPILER)}}
\DoxyCodeLine{00223\ \textcolor{preprocessor}{\ \ \ \ \#pragma\ warning(pop)}}
\DoxyCodeLine{00224\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a6e4301e948ea0fe1b57b4f5f3ec9375a}{private\_worker::release\_handle}}(\mbox{\hyperlink{namespacetbb_1_1internal_1_1rml_a82834ba59b391aaf39b176ac47ce6247}{thread\_handle}}\ handle,\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bundled_2ranges_8h_a703e3555a519a55eae7986580660994c}{join}})\ \{}
\DoxyCodeLine{00227\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bundled_2ranges_8h_a703e3555a519a55eae7986580660994c}{join}})}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classthread__monitor_a2be9fe6a3ec89c83442b2acd31d87df7}{thread\_monitor::join}}(handle);}
\DoxyCodeLine{00229\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classthread__monitor_aaec978fb92f21dd1823401f7fd1d6f24}{thread\_monitor::detach\_thread}}(handle);}
\DoxyCodeLine{00231\ \}}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a1fc69b65169acd8f06011e21d1892dcd}{private\_worker::start\_shutdown}}()\ \{}
\DoxyCodeLine{00234\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234}{state\_t}}\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}};}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_aad6c215e7cc3e4d6772c1482f8139c29}{my\_state}};}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}!=\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234a7bff4b40d31b7402447953bab754eb70}{st\_quit}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00239\ \ \ \ \ \}\ \textcolor{keywordflow}{while}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_aad6c215e7cc3e4d6772c1482f8139c29}{my\_state}}.compare\_and\_swap(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234a7bff4b40d31b7402447953bab754eb70}{st\_quit}},\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ )!=\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ );}
\DoxyCodeLine{00240\ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}==\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234a73e9233f5ba7783a05d1003b5a6b1e5f}{st\_normal}}\ ||\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}==\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234abd55681b45afd309cad178bb5154b5ac}{st\_starting}}\ )\ \{}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ May\ have\ invalidated\ invariant\ for\ sleeping,\ so\ wake\ up\ the\ thread.}}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Note\ that\ the\ notify()\ here\ occurs\ without\ maintaining\ invariants\ for\ my\_slack.}}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It\ does\ not\ matter,\ because\ my\_state==st\_quit\ overrides\ checking\ of\ my\_slack.}}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a5997b0d39846715229a7faab8bd7c6cc}{my\_thread\_monitor}}.notify();}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Do\ not\ need\ release\ handle\ in\ st\_init\ state,}}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ because\ in\ this\ case\ the\ thread\ wasn't\ started\ yet.}}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ For\ st\_starting\ release\ is\ done\ at\ launch\ site.}}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}==\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234a73e9233f5ba7783a05d1003b5a6b1e5f}{st\_normal}})}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a6e4301e948ea0fe1b57b4f5f3ec9375a}{release\_handle}}(\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a1dddd90bed68a2bdd4391f407eb1a8ae}{my\_handle}},\ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_a43c19dfa41213a92de3da1d0841cbf5a}{governor::does\_client\_join\_workers}}(\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_ab5e85075491fdbd1a1194158e12739a6}{my\_client}}));}
\DoxyCodeLine{00250\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}==\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234a490195f93cdd2fd907db7287d10df017}{st\_init}}\ )\ \{}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Perform\ action\ that\ otherwise\ would\ be\ performed\ by\ associated\ thread\ when\ it\ quits.}}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a1228521a934c33d8f4a06e390d90b021}{my\_server}}.remove\_server\_ref();}
\DoxyCodeLine{00253\ \ \ \ \ \}}
\DoxyCodeLine{00254\ \}}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_acfcd50e891e9815c7fb5c7422ee62a9f}{private\_worker::run}}()\ \{}
\DoxyCodeLine{00257\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a1228521a934c33d8f4a06e390d90b021}{my\_server}}.propagate\_chain\_reaction();}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ \ \ \ \ \textcolor{comment}{//\ Transiting\ to\ st\_normal\ here\ would\ require\ setting\ my\_handle,}}
\DoxyCodeLine{00260\ \ \ \ \ \textcolor{comment}{//\ which\ would\ create\ race\ with\ the\ launching\ thread\ and}}
\DoxyCodeLine{00261\ \ \ \ \ \textcolor{comment}{//\ complications\ in\ handle\ management\ on\ Windows.}}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00263\ \ \ \ \ \mbox{\hyperlink{classrml_1_1job}{::rml::job}}\&\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}\ =\ *\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_ab5e85075491fdbd1a1194158e12739a6}{my\_client}}.create\_one\_job();}
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{keywordflow}{while}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_aad6c215e7cc3e4d6772c1482f8139c29}{my\_state}}!=\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234a7bff4b40d31b7402447953bab754eb70}{st\_quit}}\ )\ \{}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a1228521a934c33d8f4a06e390d90b021}{my\_server}}.my\_slack>=0\ )\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_ab5e85075491fdbd1a1194158e12739a6}{my\_client}}.process(\mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}});}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classthread__monitor_1_1cookie}{thread\_monitor::cookie}}\ \mbox{\hyperlink{bench_vec_add_8cpp_a41689956983587b085f9da3e48f31d99}{c}};}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Prepare\ to\ wait}}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a5997b0d39846715229a7faab8bd7c6cc}{my\_thread\_monitor}}.prepare\_wait(\mbox{\hyperlink{bench_vec_add_8cpp_a41689956983587b085f9da3e48f31d99}{c}});}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check/set\ the\ invariant\ for\ sleeping}}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_aad6c215e7cc3e4d6772c1482f8139c29}{my\_state}}!=\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234a7bff4b40d31b7402447953bab754eb70}{st\_quit}}\ \&\&\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a1228521a934c33d8f4a06e390d90b021}{my\_server}}.try\_insert\_in\_asleep\_list(*\textcolor{keyword}{this})\ )\ \{}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a5997b0d39846715229a7faab8bd7c6cc}{my\_thread\_monitor}}.commit\_wait(\mbox{\hyperlink{bench_vec_add_8cpp_a41689956983587b085f9da3e48f31d99}{c}});}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_aad6c215e7cc3e4d6772c1482f8139c29}{my\_state}}==\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234a7bff4b40d31b7402447953bab754eb70}{st\_quit}}\ ||\ !\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a2787631f2924ada895b183cfbee5b72d}{my\_next}},\ \textcolor{stringliteral}{"{}Thread\ monitor\ missed\ a\ spurious\ wakeup?"{}}\ );}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a1228521a934c33d8f4a06e390d90b021}{my\_server}}.propagate\_chain\_reaction();}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Invariant\ broken}}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a5997b0d39846715229a7faab8bd7c6cc}{my\_thread\_monitor}}.cancel\_wait();}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00281\ \ \ \ \ \}}
\DoxyCodeLine{00282\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_ab5e85075491fdbd1a1194158e12739a6}{my\_client}}.cleanup(\mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}});}
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00284\ \ \ \ \ ++\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a1228521a934c33d8f4a06e390d90b021}{my\_server}}.my\_slack;}
\DoxyCodeLine{00285\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a1228521a934c33d8f4a06e390d90b021}{my\_server}}.remove\_server\_ref();}
\DoxyCodeLine{00286\ \}}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_aafc770ff14751ed4dd2c3f3b1d030156}{private\_worker::wake\_or\_launch}}()\ \{}
\DoxyCodeLine{00289\ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_aad6c215e7cc3e4d6772c1482f8139c29}{my\_state}}==\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234a490195f93cdd2fd907db7287d10df017}{st\_init}}\ \&\&\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_aad6c215e7cc3e4d6772c1482f8139c29}{my\_state}}.compare\_and\_swap(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234abd55681b45afd309cad178bb5154b5ac}{st\_starting}},\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234a490195f93cdd2fd907db7287d10df017}{st\_init}}\ )==\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234a490195f93cdd2fd907db7287d10df017}{st\_init}}\ )\ \{}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ after\ this\ point,\ remove\_server\_ref()\ must\ be\ done\ by\ created\ thread}}
\DoxyCodeLine{00291\ \textcolor{preprocessor}{\#if\ USE\_WINTHREAD}}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a1dddd90bed68a2bdd4391f407eb1a8ae}{my\_handle}}\ =\ thread\_monitor::launch(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a70d97a45a6aa80d21f193f1aabe631a0}{thread\_routine}},\ \textcolor{keyword}{this},\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a1228521a934c33d8f4a06e390d90b021}{my\_server}}.my\_stack\_size,\ \&this-\/>my\_index\ );}
\DoxyCodeLine{00293\ \textcolor{preprocessor}{\#elif\ USE\_PTHREAD}}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1affinity__helper}{affinity\_helper}}\ fpa;}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ fpa.\mbox{\hyperlink{classtbb_1_1internal_1_1affinity__helper_a11acc19303b90ef5c4ee72c4a536ad98}{protect\_affinity\_mask}}(\ \textcolor{comment}{/*restore\_process\_mask=*/}\textcolor{keyword}{true}\ );}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a1dddd90bed68a2bdd4391f407eb1a8ae}{my\_handle}}\ =\ thread\_monitor::launch(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a70d97a45a6aa80d21f193f1aabe631a0}{thread\_routine}},\ \textcolor{keyword}{this},\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a1228521a934c33d8f4a06e390d90b021}{my\_server}}.my\_stack\_size\ );}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Implicit\ destruction\ of\ fpa\ resets\ original\ affinity\ mask.}}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00300\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ USE\_PTHREAD\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234}{state\_t}}\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_aad6c215e7cc3e4d6772c1482f8139c29}{my\_state}}.compare\_and\_swap(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234a73e9233f5ba7783a05d1003b5a6b1e5f}{st\_normal}},\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234abd55681b45afd309cad178bb5154b5ac}{st\_starting}}\ );}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234abd55681b45afd309cad178bb5154b5ac}{st\_starting}}\ !=\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}})\ \{}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Do\ shutdown\ during\ startup.\ my\_handle\ can't\ be\ released}}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ by\ start\_shutdown,\ because\ my\_handle\ value\ might\ be\ not\ set\ yet}}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ at\ time\ of\ transition\ from\ st\_starting\ to\ st\_quit.}}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}==\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a37bb91ea8c50cfff8c255b1b700e2234a7bff4b40d31b7402447953bab754eb70}{st\_quit}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a6e4301e948ea0fe1b57b4f5f3ec9375a}{release\_handle}}(\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a1dddd90bed68a2bdd4391f407eb1a8ae}{my\_handle}},\ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_a43c19dfa41213a92de3da1d0841cbf5a}{governor::does\_client\_join\_workers}}(\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_ab5e85075491fdbd1a1194158e12739a6}{my\_client}}));}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00309\ \ \ \ \ \}}
\DoxyCodeLine{00310\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a2787631f2924ada895b183cfbee5b72d}{my\_next}},\ \textcolor{stringliteral}{"{}Should\ not\ wake\ a\ thread\ while\ it's\ still\ in\ asleep\ list"{}}\ );}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__worker_a5997b0d39846715229a7faab8bd7c6cc}{my\_thread\_monitor}}.notify();}
\DoxyCodeLine{00313\ \ \ \ \ \}}
\DoxyCodeLine{00314\ \}}
\DoxyCodeLine{00315\ }
\DoxyCodeLine{00316\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00317\ \textcolor{comment}{//\ Methods\ of\ private\_server}}
\DoxyCodeLine{00318\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00319\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a941f2e582957e03d164a9a3c81e77fa2}{private\_server::private\_server}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1tbb__client}{tbb\_client}}\&\ client\ )\ :}
\DoxyCodeLine{00320\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_afab7ce16d2c4777bc78d3414018cd6c9}{my\_client}}(client),}
\DoxyCodeLine{00321\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a1899982faeae9713e24d25d4fd26a34a}{my\_n\_thread}}(client.max\_job\_count()),}
\DoxyCodeLine{00322\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a16e4dfc8c5e061a1d9889012b9246e3e}{my\_stack\_size}}(client.min\_stack\_size()),}
\DoxyCodeLine{00323\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_ada8ed4bd1a1ded121471fb872b07c71c}{my\_thread\_array}}(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})}
\DoxyCodeLine{00324\ \{}
\DoxyCodeLine{00325\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a9ae8da3b2b8828316be5be20ad19e92f}{my\_ref\_count}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a1899982faeae9713e24d25d4fd26a34a}{my\_n\_thread}}+1;}
\DoxyCodeLine{00326\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aa2bf328b950275f1aa80b33f43021ce1}{my\_slack}}\ =\ 0;}
\DoxyCodeLine{00327\ \textcolor{preprocessor}{\#if\ TBB\_USE\_ASSERT}}
\DoxyCodeLine{00328\ \ \ \ \ my\_net\_slack\_requests\ =\ 0;}
\DoxyCodeLine{00329\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ TBB\_USE\_ASSERT\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00330\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aa9a4e0652fbb72cab569ea784989b65c}{my\_asleep\_list\_root}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00331\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_ada8ed4bd1a1ded121471fb872b07c71c}{my\_thread\_array}}\ =\ \mbox{\hyperlink{classtbb_1_1cache__aligned__allocator}{tbb::cache\_aligned\_allocator<padded\_private\_worker>}}().\mbox{\hyperlink{classtbb_1_1cache__aligned__allocator_a99d05096f80877849cb31d80247e0f85}{allocate}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a1899982faeae9713e24d25d4fd26a34a}{my\_n\_thread}}\ );}
\DoxyCodeLine{00332\ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a1899982faeae9713e24d25d4fd26a34a}{my\_n\_thread}};\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ )\ \{}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_af1df28b1fce17bd3ac403abe94d1f331}{private\_worker}}*\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \textcolor{keyword}{new}(\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_ada8ed4bd1a1ded121471fb872b07c71c}{my\_thread\_array}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]\ )\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1padded__private__worker}{padded\_private\_worker}}(\ *\textcolor{keyword}{this},\ client,\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ );}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>my\_next\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aa9a4e0652fbb72cab569ea784989b65c}{my\_asleep\_list\_root}};}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aa9a4e0652fbb72cab569ea784989b65c}{my\_asleep\_list\_root}}\ =\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}};}
\DoxyCodeLine{00336\ \ \ \ \ \}}
\DoxyCodeLine{00337\ \}}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a3f85635899ef8652d32de0e42fcbd3cd}{private\_server::\string~private\_server}}()\ \{}
\DoxyCodeLine{00340\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ my\_net\_slack\_requests==0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00341\ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a1899982faeae9713e24d25d4fd26a34a}{my\_n\_thread}};\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}-\/-\/;\ )}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_ada8ed4bd1a1ded121471fb872b07c71c}{my\_thread\_array}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}].\string~\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1padded__private__worker}{padded\_private\_worker}}();}
\DoxyCodeLine{00343\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1cache__aligned__allocator}{tbb::cache\_aligned\_allocator<padded\_private\_worker>}}().\mbox{\hyperlink{classtbb_1_1cache__aligned__allocator_a7f7310e046c4b6b8618864de8e27a471}{deallocate}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_ada8ed4bd1a1ded121471fb872b07c71c}{my\_thread\_array}},\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a1899982faeae9713e24d25d4fd26a34a}{my\_n\_thread}}\ );}
\DoxyCodeLine{00344\ \ \ \ \ tbb::internal::poison\_pointer(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_ada8ed4bd1a1ded121471fb872b07c71c}{my\_thread\_array}}\ );}
\DoxyCodeLine{00345\ \}}
\DoxyCodeLine{00346\ }
\DoxyCodeLine{00347\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a65bd5075630d2f9cce6f71fc3c922e46}{private\_server::try\_insert\_in\_asleep\_list}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_af1df28b1fce17bd3ac403abe94d1f331}{private\_worker}}\&\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ )\ \{}
\DoxyCodeLine{00348\ \ \ \ \ asleep\_list\_mutex\_type::scoped\_lock\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}};}
\DoxyCodeLine{00349\ \ \ \ \ \textcolor{keywordflow}{if}(\ !\mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}.try\_acquire(\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_abdadfc9229feb5e185139e32348fa0e2}{my\_asleep\_list\_mutex}})\ )}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00351\ \ \ \ \ \textcolor{comment}{//\ Contribute\ to\ slack\ under\ lock\ so\ that\ if\ another\ takes\ that\ unit\ of\ slack,}}
\DoxyCodeLine{00352\ \ \ \ \ \textcolor{comment}{//\ it\ sees\ us\ sleeping\ on\ the\ list\ and\ wakes\ us\ up.}}
\DoxyCodeLine{00353\ \ \ \ \ \textcolor{keywordtype}{int}\ k\ =\ ++\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aa2bf328b950275f1aa80b33f43021ce1}{my\_slack}};}
\DoxyCodeLine{00354\ \ \ \ \ \textcolor{keywordflow}{if}(\ k<=0\ )\ \{}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}.my\_next\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aa9a4e0652fbb72cab569ea784989b65c}{my\_asleep\_list\_root}};}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aa9a4e0652fbb72cab569ea784989b65c}{my\_asleep\_list\_root}}\ =\ \&\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}};}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00358\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ -\/-\/\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aa2bf328b950275f1aa80b33f43021ce1}{my\_slack}};}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00361\ \ \ \ \ \}}
\DoxyCodeLine{00362\ \}}
\DoxyCodeLine{00363\ }
\DoxyCodeLine{00364\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a2be83f895b89b3861ee8ab31535c1f34}{private\_server::wake\_some}}(\ \textcolor{keywordtype}{int}\ additional\_slack\ )\ \{}
\DoxyCodeLine{00365\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ additional\_slack>=0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00366\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_af1df28b1fce17bd3ac403abe94d1f331}{private\_worker}}*\ wakee[2];}
\DoxyCodeLine{00367\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_af1df28b1fce17bd3ac403abe94d1f331}{private\_worker}}**\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}\ =\ wakee;}
\DoxyCodeLine{00368\ \ \ \ \ \{}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ asleep\_list\_mutex\_type::scoped\_lock\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_abdadfc9229feb5e185139e32348fa0e2}{my\_asleep\_list\_mutex}});}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aa9a4e0652fbb72cab569ea784989b65c}{my\_asleep\_list\_root}}\ \&\&\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}<wakee+2\ )\ \{}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ additional\_slack>0\ )\ \{}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (additional\_slack+\mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aa2bf328b950275f1aa80b33f43021ce1}{my\_slack}}<=0)\ \textcolor{comment}{//\ additional\ demand\ does\ not\ exceed\ surplus\ supply}}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/additional\_slack;}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Chain\ reaction;\ Try\ to\ claim\ unit\ of\ slack}}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ old;}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ old\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aa2bf328b950275f1aa80b33f43021ce1}{my\_slack}};}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ old<=0\ )\ \textcolor{keywordflow}{goto}\ \mbox{\hyperlink{cpq__pdes_8cpp_a1d39aac66e12dae50a24cd7a9100ef33}{done}};}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aa2bf328b950275f1aa80b33f43021ce1}{my\_slack}}.compare\_and\_swap(old-\/1,old)!=old\ );}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pop\ sleeping\ worker\ to\ combine\ with\ claimed\ unit\ of\ slack}}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aa9a4e0652fbb72cab569ea784989b65c}{my\_asleep\_list\_root}}\ =\ (*\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}++\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aa9a4e0652fbb72cab569ea784989b65c}{my\_asleep\_list\_root}})-\/>my\_next;}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ additional\_slack\ )\ \{}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Contribute\ our\ unused\ slack\ to\ my\_slack.}}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aa2bf328b950275f1aa80b33f43021ce1}{my\_slack}}\ +=\ additional\_slack;}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00390\ \ \ \ \ \}}
\DoxyCodeLine{00391\ \mbox{\hyperlink{cpq__pdes_8cpp_a1d39aac66e12dae50a24cd7a9100ef33}{done}}:}
\DoxyCodeLine{00392\ \ \ \ \ \textcolor{keywordflow}{while}(\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}>wakee\ )\ \{}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_af1df28b1fce17bd3ac403abe94d1f331}{private\_worker}}*\ \mbox{\hyperlink{core_2swizzle__4_8inl_8h_ad7b9d5be956a732abc733eca37f40eef}{ww}}\ =\ *-\/-\/\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}};}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{core_2swizzle__4_8inl_8h_ad7b9d5be956a732abc733eca37f40eef}{ww}}-\/>my\_next\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{core_2swizzle__4_8inl_8h_ad7b9d5be956a732abc733eca37f40eef}{ww}}-\/>wake\_or\_launch();}
\DoxyCodeLine{00396\ \ \ \ \ \}}
\DoxyCodeLine{00397\ \}}
\DoxyCodeLine{00398\ }
\DoxyCodeLine{00399\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aed71f902aab1aef77a016420c586f535}{private\_server::adjust\_job\_count\_estimate}}(\ \textcolor{keywordtype}{int}\ delta\ )\ \{}
\DoxyCodeLine{00400\ \textcolor{preprocessor}{\#if\ TBB\_USE\_ASSERT}}
\DoxyCodeLine{00401\ \ \ \ \ my\_net\_slack\_requests+=delta;}
\DoxyCodeLine{00402\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ TBB\_USE\_ASSERT\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00403\ \ \ \ \ \textcolor{keywordflow}{if}(\ delta<0\ )\ \{}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_aa2bf328b950275f1aa80b33f43021ce1}{my\_slack}}+=delta;}
\DoxyCodeLine{00405\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ delta>0\ )\ \{}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server_a2be83f895b89b3861ee8ab31535c1f34}{wake\_some}}(\ delta\ );}
\DoxyCodeLine{00407\ \ \ \ \ \}}
\DoxyCodeLine{00408\ \}}
\DoxyCodeLine{00409\ }
\DoxyCodeLine{00411\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1tbb__server}{tbb\_server}}*\ \mbox{\hyperlink{namespacetbb_1_1internal_1_1rml_a8ef19f713537ac8030e4de4a1a3fdf26}{make\_private\_server}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1tbb__client}{tbb\_client}}\&\ client\ )\ \{}
\DoxyCodeLine{00412\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}(\ \mbox{\hyperlink{classtbb_1_1cache__aligned__allocator}{tbb::cache\_aligned\_allocator<private\_server>}}().\mbox{\hyperlink{classtbb_1_1cache__aligned__allocator_a99d05096f80877849cb31d80247e0f85}{allocate}}(1)\ )\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1private__server}{private\_server}}(client);}
\DoxyCodeLine{00413\ \}}
\DoxyCodeLine{00414\ }
\DoxyCodeLine{00415\ \}\ \textcolor{comment}{//\ namespace\ rml}}
\DoxyCodeLine{00416\ \}\ \textcolor{comment}{//\ namespace\ internal}}
\DoxyCodeLine{00417\ }
\DoxyCodeLine{00418\ \}\ \textcolor{comment}{//\ namespace\ tbb}}

\end{DoxyCode}
