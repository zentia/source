\chapter{Custom parsers}
\hypertarget{md_external_2reflect-cpp_2docs_2custom__parser}{}\label{md_external_2reflect-cpp_2docs_2custom__parser}\index{Custom parsers@{Custom parsers}}
\label{md_external_2reflect-cpp_2docs_2custom__parser_autotoc_md560}%
\Hypertarget{md_external_2reflect-cpp_2docs_2custom__parser_autotoc_md560}%
\hypertarget{md_external_2reflect-cpp_2docs_2custom__parser_autotoc_md561}{}\doxysection{\texorpdfstring{{\ttfamily rfl\+::\+Reflector}}{{\ttfamily rfl\+::\+Reflector}}}\label{md_external_2reflect-cpp_2docs_2custom__parser_autotoc_md561}
If you absolutely do not want to make any changes to your original classes whatsoever, You can create a Reflector template specialization for your type\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacerfl}{rfl}}\ \{}
\DoxyCodeLine{\textcolor{keyword}{template}\ <>}
\DoxyCodeLine{\textcolor{keyword}{struct\ }\mbox{\hyperlink{structrfl_1_1_reflector}{Reflector}}<Person>\ \{}
\DoxyCodeLine{\ \ \textcolor{keyword}{struct\ }ReflType\ \{}
\DoxyCodeLine{\ \ \ \ std::string\ first\_name;}
\DoxyCodeLine{\ \ \ \ std::string\ last\_name;}
\DoxyCodeLine{\ \ \};}
\DoxyCodeLine{\ \ }
\DoxyCodeLine{\ \ \textcolor{keyword}{static}\ Person\ to(\textcolor{keyword}{const}\ ReflType\&\ \mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}})\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{return}\ \{\mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}}.first\_name,\ \mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}}.last\_name\};}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \textcolor{keyword}{static}\ ReflType\ from(\textcolor{keyword}{const}\ Person\&\ \mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}})\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{return}\ \{\mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}}.first\_name,\ \mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}}.last\_name\};}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\};}
\DoxyCodeLine{\}}

\end{DoxyCode}


It\textquotesingle{}s also fine to define just the {\ttfamily from} method when the original class is only written, or {\ttfamily to} when the original class is only read\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ This\ can\ only\ be\ used\ for\ writing.}}
\DoxyCodeLine{\textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacerfl}{rfl}}\ \{}
\DoxyCodeLine{\textcolor{keyword}{template}\ <>}
\DoxyCodeLine{\textcolor{keyword}{struct\ }\mbox{\hyperlink{structrfl_1_1_reflector}{Reflector}}<Person>\ \{}
\DoxyCodeLine{\ \ \textcolor{keyword}{struct\ }ReflType\ \{}
\DoxyCodeLine{\ \ \ \ std::string\ first\_name;}
\DoxyCodeLine{\ \ \ \ std::string\ last\_name;}
\DoxyCodeLine{\ \ \};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \textcolor{keyword}{static}\ ReflType\ from(\textcolor{keyword}{const}\ Person\&\ \mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}})\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{return}\ \{\mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}}.first\_name,\ \mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}}.last\_name\};}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\};}
\DoxyCodeLine{\}}

\end{DoxyCode}


Note that the {\ttfamily Refl\+Type} does not have to be a struct. For instance, if you have a custom type called {\ttfamily My\+Custom\+Type} that you want to be serialized as a string, you can do the following\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacerfl}{rfl}}\ \{}
\DoxyCodeLine{\textcolor{keyword}{template}\ <>}
\DoxyCodeLine{\textcolor{keyword}{struct\ }\mbox{\hyperlink{structrfl_1_1_reflector}{Reflector}}<MyCustomType>\ \{}
\DoxyCodeLine{\ \ \textcolor{keyword}{using\ }ReflType\ =\ std::string;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \textcolor{keyword}{static}\ MyCustomType\ to(\textcolor{keyword}{const}\ ReflType\&\ str)\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{return}\ MyCustomType::from\_string(str);}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \textcolor{keyword}{static}\ ReflType\ from(\textcolor{keyword}{const}\ MyCustomType\&\ \mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}})\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}}.to\_string();}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\};}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md_external_2reflect-cpp_2docs_2custom__parser_autotoc_md562}{}\doxysection{\texorpdfstring{{\ttfamily rfl\+::parsing\+::\+Custom\+Parser}}{{\ttfamily rfl\+::parsing\+::\+Custom\+Parser}}}\label{md_external_2reflect-cpp_2docs_2custom__parser_autotoc_md562}
Alternatively, you can implement a custom parser using {\ttfamily \doxylink{structrfl_1_1parsing_1_1_custom_parser}{rfl\+::parsing\+::\+Custom\+Parser}}.

In order to do so, you must do the following\+:

You must create a helper struct that {\itshape can} be parsed. The helper struct must fulfill the following conditions\+:

1) It must contain a static method called {\ttfamily from\+\_\+class} that takes your original class as an input and returns the helper struct. This method must not throw an exception. 2) (Optional) It must contain a method called {\ttfamily to\+\_\+class} that transforms the helper struct into your original class. This method may throw an exception, if you want to. If you can directly construct your custom class from the field values in the order they were declared in the helper struct, you do not have to write a {\ttfamily to\+\_\+class} method.

You can then implement a custom parser for your class like this\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacerfl_1_1parsing}{rfl::parsing}}\ \{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ReaderType,\ \textcolor{keyword}{class}\ WriterType,\ \textcolor{keyword}{class}\ ProcessorsType>}
\DoxyCodeLine{\textcolor{keyword}{struct\ }\mbox{\hyperlink{structrfl_1_1parsing_1_1_parser}{Parser}}<ReaderType,\ WriterType,\ YourOriginalClass,\ ProcessorsType>}
\DoxyCodeLine{\ \ \ \ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{structrfl_1_1parsing_1_1_custom_parser}{CustomParser}}<ReaderType,\ WriterType,\ ProcessorsType,\ YourOriginalClass,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ YourHelperStruct>\ \{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\}\ \ \textcolor{comment}{//\ namespace\ rfl::parsing}}

\end{DoxyCode}
\hypertarget{md_external_2reflect-cpp_2docs_2custom__parser_autotoc_md563}{}\doxysection{\texorpdfstring{Example}{Example}}\label{md_external_2reflect-cpp_2docs_2custom__parser_autotoc_md563}
Suppose your original class looks like this\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{struct\ }Person\ \{}
\DoxyCodeLine{\ \ \ \ Person(\textcolor{keyword}{const}\ std::string\&\ \_first\_name,\ \textcolor{keyword}{const}\ std::string\&\ \_last\_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \_age)}
\DoxyCodeLine{\ \ \ \ \ \ \ \ :\ first\_name\_(\_first\_name),\ last\_name\_(\_last\_name),\ age\_(\_age)\ \{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ first\_name()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ first\_name\_;\ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ last\_name()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ last\_name\_;\ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{namespacectre_af1ab492eac22f0bfaebe58d37347ce28a7d637d275668ed6d41a9b97e6ad3a556}{age}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ age\_;\ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{\ \ \ \ std::string\ first\_name\_;}
\DoxyCodeLine{\ \ \ \ std::string\ last\_name\_;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{int}\ age\_;}
\DoxyCodeLine{\};}

\end{DoxyCode}


You can then write a helper struct\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{struct\ }PersonImpl\ \{}
\DoxyCodeLine{\ \ \ \ rfl::Rename<\textcolor{stringliteral}{"{}firstName"{}},\ std::string>\ first\_name;}
\DoxyCodeLine{\ \ \ \ rfl::Rename<\textcolor{stringliteral}{"{}lastName"{}},\ std::string>\ last\_name;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespacectre_af1ab492eac22f0bfaebe58d37347ce28a7d637d275668ed6d41a9b97e6ad3a556}{age}};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ 1)\ Static\ method\ that\ takes\ your\ original\ class\ as\ an\ input\ and}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ \ \ \ returns\ the\ helper\ struct.}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ \ \ \ MUST\ NOT\ THROW\ AN\ EXCEPTION!}}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{static}\ PersonImpl\ from\_class(\textcolor{keyword}{const}\ Person\&\ \_p)\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ PersonImpl\{.first\_name\ =\ \_p.first\_name(),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .last\_name\ =\ \_p.last\_name(),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .age\ =\ \_p.age()\};}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ 2)\ Const\ method\ called\ \`{}to\_class`\ that\ transforms\ the\ helper\ struct}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ \ \ \ into\ your\ original\ class.}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ \ \ \ In\ this\ case,\ the\ \`{}to\_class`\ method\ is\ actually\ optional,\ because}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ \ \ \ you\ can\ directly\ create\ Person\ from\ the\ field\ values.}}
\DoxyCodeLine{\ \ \ \ Person\ to\_class()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ Person(first\_name(),\ last\_name(),\ age);\ \}}
\DoxyCodeLine{\};}

\end{DoxyCode}


You then implement the custom parser\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacerfl_1_1parsing}{rfl::parsing}}\ \{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ReaderType,\ \textcolor{keyword}{class}\ WriterType,\ \textcolor{keyword}{class}\ ProcessorsType>}
\DoxyCodeLine{\textcolor{keyword}{struct\ }\mbox{\hyperlink{structrfl_1_1parsing_1_1_parser}{Parser}}<ReaderType,\ WriterType,\ Person,\ ProcessorsType>}
\DoxyCodeLine{\ \ \ \ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{structrfl_1_1parsing_1_1_custom_parser}{CustomParser}}<ReaderType,\ WriterType,\ ProcessorsType,\ Person,\ PersonImpl>\ \{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\}\ \ \textcolor{comment}{//\ namespace\ rfl::parsing}}

\end{DoxyCode}


Now your custom class is fully supported by reflect-\/cpp. So for instance, you could parse it inside a vector\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ people\ =\ \mbox{\hyperlink{namespacerfl_1_1json_a905573518eca04a9c269d1bb32de7dd1}{rfl::json::read<std::vector<Person>}}>(json\_str).\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_abe8e049f756b5ba547bda825af81b645}{value}}();}

\end{DoxyCode}


As we have noted, in this particular example, the {\ttfamily Person} class can be constructed from the field values in {\ttfamily Person\+Impl} in the exact same order they were declared in {\ttfamily Person\+Impl}. So we can drop the {\ttfamily .to\+\_\+class} method\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{struct\ }PersonImpl\ \{}
\DoxyCodeLine{\ \ \ \ rfl::Rename<\textcolor{stringliteral}{"{}firstName"{}},\ std::string>\ first\_name;}
\DoxyCodeLine{\ \ \ \ rfl::Rename<\textcolor{stringliteral}{"{}lastName"{}},\ std::string>\ last\_name;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespacectre_af1ab492eac22f0bfaebe58d37347ce28a7d637d275668ed6d41a9b97e6ad3a556}{age}};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{static}\ PersonImpl\ from\_class(\textcolor{keyword}{const}\ Person\&\ \_p)\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ PersonImpl\{.first\_name\ =\ \_p.first\_name(),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .last\_name\ =\ \_p.last\_name(),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .age\ =\ \_p.age()\};}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\};}

\end{DoxyCode}
 