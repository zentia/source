\doxysection{tf\+::Semaphore类 参考}
\hypertarget{classtf_1_1_semaphore}{}\label{classtf_1_1_semaphore}\index{tf::Semaphore@{tf::Semaphore}}


class to create a semophore object for building a concurrency constraint  




{\ttfamily \#include $<$semaphore.\+hpp$>$}



tf\+::Semaphore 的协作图\+:
% FIG 0
\doxysubsubsection*{Public 成员函数}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classtf_1_1_semaphore_a6c5eda744df63aabf30398142a8c73c2}{Semaphore}} ()=\mbox{\hyperlink{sugar_8h_a6face89e97cccad5464dd9bb9c7efd23}{default}}
\begin{DoxyCompactList}\small\item\em constructs a default semaphore \end{DoxyCompactList}\item 
\mbox{\hyperlink{classtf_1_1_semaphore_abbd094f2f48025fbf0707ae977307a3e}{Semaphore}} (size\+\_\+t \mbox{\hyperlink{classtf_1_1_semaphore_a2871b5f5d7527c822abe871d99a482b3}{max\+\_\+value}})
\begin{DoxyCompactList}\small\item\em constructs a semaphore with the given value (i.\+e., counter) \end{DoxyCompactList}\item 
size\+\_\+t \mbox{\hyperlink{classtf_1_1_semaphore_a8ba4d8f7a70fe36b883eb0ad1aa8dcd1}{value}} () const
\begin{DoxyCompactList}\small\item\em queries the current counter value \end{DoxyCompactList}\item 
size\+\_\+t \mbox{\hyperlink{classtf_1_1_semaphore_a2871b5f5d7527c822abe871d99a482b3}{max\+\_\+value}} () const
\begin{DoxyCompactList}\small\item\em queries the maximum allowable value of this semaphore \end{DoxyCompactList}\item 
\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}} \mbox{\hyperlink{classtf_1_1_semaphore_ad0f7801055550b20b8c2ae6d6099f220}{reset}} ()
\begin{DoxyCompactList}\small\item\em resets the semaphores to a clean state \end{DoxyCompactList}\item 
\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}} \mbox{\hyperlink{classtf_1_1_semaphore_a3193f673011ac0a8527284fa8f68ee6a}{reset}} (size\+\_\+t new\+\_\+max\+\_\+value)
\begin{DoxyCompactList}\small\item\em resets the semaphores to a clean state with the given new maximum value \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Private 成员函数}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{sugar_8h_abb452686968e48b67397da5f97445f5b}{bool}} \mbox{\hyperlink{classtf_1_1_semaphore_aeb12ad1db7794e13829a0a62549d157b}{\+\_\+try\+\_\+acquire\+\_\+or\+\_\+wait}} (\mbox{\hyperlink{classtf_1_1_node}{Node}} \texorpdfstring{$\ast$}{*})
\item 
\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}} \mbox{\hyperlink{classtf_1_1_semaphore_a066258fab2fa8c2ee123b22f77a64ccf}{\+\_\+release}} (\mbox{\hyperlink{classtf_1_1_small_vector}{Small\+Vector}}$<$ \mbox{\hyperlink{classtf_1_1_node}{Node}} \texorpdfstring{$\ast$}{*} $>$ \&)
\end{DoxyCompactItemize}
\doxysubsubsection*{Private 属性}
\begin{DoxyCompactItemize}
\item 
std\+::mutex \mbox{\hyperlink{classtf_1_1_semaphore_a329424188b5287ca596f1af3f6db58f1}{\+\_\+mtx}}
\item 
size\+\_\+t \mbox{\hyperlink{classtf_1_1_semaphore_a3e58194192dcfdac92d186b67c96498d}{\+\_\+max\+\_\+value}} \{0\}
\item 
size\+\_\+t \mbox{\hyperlink{classtf_1_1_semaphore_af749214114dbfccd36adffa337eb44ca}{\+\_\+cur\+\_\+value}} \{0\}
\item 
\mbox{\hyperlink{classtf_1_1_small_vector}{Small\+Vector}}$<$ \mbox{\hyperlink{classtf_1_1_node}{Node}} \texorpdfstring{$\ast$}{*} $>$ \mbox{\hyperlink{classtf_1_1_semaphore_a2c266637822af51b6ea77a47e35ad3fd}{\+\_\+waiters}}
\end{DoxyCompactItemize}
\doxysubsubsection*{友元}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{classtf_1_1_semaphore_a6db9d28bd448a131448276ee03de1e6d}{Node}}
\item 
class \mbox{\hyperlink{classtf_1_1_semaphore_a763b2f90bc53f92d680a635fe28e858e}{Executor}}
\end{DoxyCompactItemize}


\doxysubsection{详细描述}
class to create a semophore object for building a concurrency constraint 

\doxylink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A} semaphore creates a constraint that limits the maximum concurrency, i.\+e., the number of workers, in a set of tasks. You can let a task acquire/release one or multiple semaphores before/after executing its work. \doxylink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A} task can acquire and release a semaphore, or just acquire or just release it. \doxylink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A} \doxylink{classtf_1_1_semaphore}{tf\+::\+Semaphore} object starts with an initial count. As long as that count is above 0, tasks can acquire the semaphore and do their work. If the count is 0 or less, a task trying to acquire the semaphore will not run but goes to a waiting list of that semaphore. When the semaphore is released by another task, it reschedules all tasks on that waiting list.


\begin{DoxyCode}{0}
\DoxyCodeLine{tf::Executor\ \mbox{\hyperlink{thread__pool_8cpp_a543e564a8407bbeac15cb2d929fec755}{executor}}(8);\ \ \ \textcolor{comment}{//\ create\ an\ executor\ of\ 8\ workers}}
\DoxyCodeLine{tf::Taskflow\ \mbox{\hyperlink{poisson_8hpp_aa56fe360bb0ae38e0082f49e394ff825}{taskflow}};}
\DoxyCodeLine{}
\DoxyCodeLine{tf::Semaphore\ semaphore(1);\ \textcolor{comment}{//\ create\ a\ semaphore\ with\ initial\ count\ 1}}
\DoxyCodeLine{}
\DoxyCodeLine{SmallVector<tf::Task>\ tasks\ \{}
\DoxyCodeLine{\ \ \mbox{\hyperlink{poisson_8hpp_aa56fe360bb0ae38e0082f49e394ff825}{taskflow}}.emplace([]()\{\ std::cout\ <<\ \textcolor{stringliteral}{"{}A"{}}\ <<\ std::endl;\ \}),}
\DoxyCodeLine{\ \ \mbox{\hyperlink{poisson_8hpp_aa56fe360bb0ae38e0082f49e394ff825}{taskflow}}.emplace([]()\{\ std::cout\ <<\ \textcolor{stringliteral}{"{}B"{}}\ <<\ std::endl;\ \}),}
\DoxyCodeLine{\ \ \mbox{\hyperlink{poisson_8hpp_aa56fe360bb0ae38e0082f49e394ff825}{taskflow}}.emplace([]()\{\ std::cout\ <<\ \textcolor{stringliteral}{"{}C"{}}\ <<\ std::endl;\ \}),}
\DoxyCodeLine{\ \ \mbox{\hyperlink{poisson_8hpp_aa56fe360bb0ae38e0082f49e394ff825}{taskflow}}.emplace([]()\{\ std::cout\ <<\ \textcolor{stringliteral}{"{}D"{}}\ <<\ std::endl;\ \}),}
\DoxyCodeLine{\ \ \mbox{\hyperlink{poisson_8hpp_aa56fe360bb0ae38e0082f49e394ff825}{taskflow}}.emplace([]()\{\ std::cout\ <<\ \textcolor{stringliteral}{"{}E"{}}\ <<\ std::endl;\ \})}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\ \&\ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}\ :\ tasks)\ \{\ \ \textcolor{comment}{//\ each\ task\ acquires\ and\ release\ the\ semaphore}}
\DoxyCodeLine{\ \ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}.acquire(semaphore);}
\DoxyCodeLine{\ \ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}.release(semaphore);}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{thread__pool_8cpp_a543e564a8407bbeac15cb2d929fec755}{executor}}.\mbox{\hyperlink{classtf_1_1_executor_a519777f5783981d534e9e53b99712069}{run}}(\mbox{\hyperlink{poisson_8hpp_aa56fe360bb0ae38e0082f49e394ff825}{taskflow}}).wait();}

\end{DoxyCode}


The above example creates five tasks with no dependencies between them. Under normal circumstances, the five tasks would be executed concurrently. However, this example has a semaphore with initial count 1, and all tasks need to acquire that semaphore before running and release that semaphore after they are done. This arrangement limits the number of concurrently running tasks to only one. 

\doxysubsection{构造及析构函数说明}
\Hypertarget{classtf_1_1_semaphore_a6c5eda744df63aabf30398142a8c73c2}\index{tf::Semaphore@{tf::Semaphore}!Semaphore@{Semaphore}}
\index{Semaphore@{Semaphore}!tf::Semaphore@{tf::Semaphore}}
\doxysubsubsection{\texorpdfstring{Semaphore()}{Semaphore()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily \label{classtf_1_1_semaphore_a6c5eda744df63aabf30398142a8c73c2} 
tf\+::\+Semaphore\+::\+Semaphore (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [default]}}



constructs a default semaphore 

\doxylink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A} default semaphore has the value of zero. Users can call \doxylink{classtf_1_1_semaphore_ad0f7801055550b20b8c2ae6d6099f220}{tf\+::\+Semaphore\+::reset} to reassign a new value to the semaphore. 函数调用图\+:
% FIG 1
\Hypertarget{classtf_1_1_semaphore_abbd094f2f48025fbf0707ae977307a3e}\index{tf::Semaphore@{tf::Semaphore}!Semaphore@{Semaphore}}
\index{Semaphore@{Semaphore}!tf::Semaphore@{tf::Semaphore}}
\doxysubsubsection{\texorpdfstring{Semaphore()}{Semaphore()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily \label{classtf_1_1_semaphore_abbd094f2f48025fbf0707ae977307a3e} 
tf\+::\+Semaphore\+::\+Semaphore (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{max\+\_\+value}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [explicit]}}



constructs a semaphore with the given value (i.\+e., counter) 

\doxylink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A} semaphore creates a constraint that limits the maximum concurrency, i.\+e., the number of workers, in a set of tasks.


\begin{DoxyCode}{0}
\DoxyCodeLine{tf::Semaphore\ semaphore(4);\ \ \textcolor{comment}{//\ concurrency\ constraint\ of\ 4\ workers}}

\end{DoxyCode}
 函数调用图\+:
% FIG 2


\doxysubsection{成员函数说明}
\Hypertarget{classtf_1_1_semaphore_a066258fab2fa8c2ee123b22f77a64ccf}\index{tf::Semaphore@{tf::Semaphore}!\_release@{\_release}}
\index{\_release@{\_release}!tf::Semaphore@{tf::Semaphore}}
\doxysubsubsection{\texorpdfstring{\_release()}{\_release()}}
{\footnotesize\ttfamily \label{classtf_1_1_semaphore_a066258fab2fa8c2ee123b22f77a64ccf} 
\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}} tf\+::\+Semaphore\+::\+\_\+release (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classtf_1_1_small_vector}{Small\+Vector}}$<$ \mbox{\hyperlink{classtf_1_1_node}{Node}} \texorpdfstring{$\ast$}{*} $>$ \&}]{dst}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}

\Hypertarget{classtf_1_1_semaphore_aeb12ad1db7794e13829a0a62549d157b}\index{tf::Semaphore@{tf::Semaphore}!\_try\_acquire\_or\_wait@{\_try\_acquire\_or\_wait}}
\index{\_try\_acquire\_or\_wait@{\_try\_acquire\_or\_wait}!tf::Semaphore@{tf::Semaphore}}
\doxysubsubsection{\texorpdfstring{\_try\_acquire\_or\_wait()}{\_try\_acquire\_or\_wait()}}
{\footnotesize\ttfamily \label{classtf_1_1_semaphore_aeb12ad1db7794e13829a0a62549d157b} 
\mbox{\hyperlink{sugar_8h_abb452686968e48b67397da5f97445f5b}{bool}} tf\+::\+Semaphore\+::\+\_\+try\+\_\+acquire\+\_\+or\+\_\+wait (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classtf_1_1_node}{Node}} \texorpdfstring{$\ast$}{*}}]{me}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}

函数调用图\+:
% FIG 3
\Hypertarget{classtf_1_1_semaphore_a2871b5f5d7527c822abe871d99a482b3}\index{tf::Semaphore@{tf::Semaphore}!max\_value@{max\_value}}
\index{max\_value@{max\_value}!tf::Semaphore@{tf::Semaphore}}
\doxysubsubsection{\texorpdfstring{max\_value()}{max\_value()}}
{\footnotesize\ttfamily \label{classtf_1_1_semaphore_a2871b5f5d7527c822abe871d99a482b3} 
size\+\_\+t tf\+::\+Semaphore\+::max\+\_\+value (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



queries the maximum allowable value of this semaphore 

\Hypertarget{classtf_1_1_semaphore_ad0f7801055550b20b8c2ae6d6099f220}\index{tf::Semaphore@{tf::Semaphore}!reset@{reset}}
\index{reset@{reset}!tf::Semaphore@{tf::Semaphore}}
\doxysubsubsection{\texorpdfstring{reset()}{reset()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily \label{classtf_1_1_semaphore_ad0f7801055550b20b8c2ae6d6099f220} 
\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}} tf\+::\+Semaphore\+::reset (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



resets the semaphores to a clean state 

\Hypertarget{classtf_1_1_semaphore_a3193f673011ac0a8527284fa8f68ee6a}\index{tf::Semaphore@{tf::Semaphore}!reset@{reset}}
\index{reset@{reset}!tf::Semaphore@{tf::Semaphore}}
\doxysubsubsection{\texorpdfstring{reset()}{reset()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily \label{classtf_1_1_semaphore_a3193f673011ac0a8527284fa8f68ee6a} 
\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}} tf\+::\+Semaphore\+::reset (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{new\+\_\+max\+\_\+value}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



resets the semaphores to a clean state with the given new maximum value 

\Hypertarget{classtf_1_1_semaphore_a8ba4d8f7a70fe36b883eb0ad1aa8dcd1}\index{tf::Semaphore@{tf::Semaphore}!value@{value}}
\index{value@{value}!tf::Semaphore@{tf::Semaphore}}
\doxysubsubsection{\texorpdfstring{value()}{value()}}
{\footnotesize\ttfamily \label{classtf_1_1_semaphore_a8ba4d8f7a70fe36b883eb0ad1aa8dcd1} 
size\+\_\+t tf\+::\+Semaphore\+::value (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [inline]}}



queries the current counter value 



\doxysubsection{友元及相关符号说明}
\Hypertarget{classtf_1_1_semaphore_a763b2f90bc53f92d680a635fe28e858e}\index{tf::Semaphore@{tf::Semaphore}!Executor@{Executor}}
\index{Executor@{Executor}!tf::Semaphore@{tf::Semaphore}}
\doxysubsubsection{\texorpdfstring{Executor}{Executor}}
{\footnotesize\ttfamily \label{classtf_1_1_semaphore_a763b2f90bc53f92d680a635fe28e858e} 
friend class \mbox{\hyperlink{classtf_1_1_executor}{Executor}}\hspace{0.3cm}{\ttfamily [friend]}}

\Hypertarget{classtf_1_1_semaphore_a6db9d28bd448a131448276ee03de1e6d}\index{tf::Semaphore@{tf::Semaphore}!Node@{Node}}
\index{Node@{Node}!tf::Semaphore@{tf::Semaphore}}
\doxysubsubsection{\texorpdfstring{Node}{Node}}
{\footnotesize\ttfamily \label{classtf_1_1_semaphore_a6db9d28bd448a131448276ee03de1e6d} 
friend class \mbox{\hyperlink{classtf_1_1_node}{Node}}\hspace{0.3cm}{\ttfamily [friend]}}



\doxysubsection{类成员变量说明}
\Hypertarget{classtf_1_1_semaphore_af749214114dbfccd36adffa337eb44ca}\index{tf::Semaphore@{tf::Semaphore}!\_cur\_value@{\_cur\_value}}
\index{\_cur\_value@{\_cur\_value}!tf::Semaphore@{tf::Semaphore}}
\doxysubsubsection{\texorpdfstring{\_cur\_value}{\_cur\_value}}
{\footnotesize\ttfamily \label{classtf_1_1_semaphore_af749214114dbfccd36adffa337eb44ca} 
size\+\_\+t tf\+::\+Semaphore\+::\+\_\+cur\+\_\+value \{0\}\hspace{0.3cm}{\ttfamily [private]}}

\Hypertarget{classtf_1_1_semaphore_a3e58194192dcfdac92d186b67c96498d}\index{tf::Semaphore@{tf::Semaphore}!\_max\_value@{\_max\_value}}
\index{\_max\_value@{\_max\_value}!tf::Semaphore@{tf::Semaphore}}
\doxysubsubsection{\texorpdfstring{\_max\_value}{\_max\_value}}
{\footnotesize\ttfamily \label{classtf_1_1_semaphore_a3e58194192dcfdac92d186b67c96498d} 
size\+\_\+t tf\+::\+Semaphore\+::\+\_\+max\+\_\+value \{0\}\hspace{0.3cm}{\ttfamily [private]}}

\Hypertarget{classtf_1_1_semaphore_a329424188b5287ca596f1af3f6db58f1}\index{tf::Semaphore@{tf::Semaphore}!\_mtx@{\_mtx}}
\index{\_mtx@{\_mtx}!tf::Semaphore@{tf::Semaphore}}
\doxysubsubsection{\texorpdfstring{\_mtx}{\_mtx}}
{\footnotesize\ttfamily \label{classtf_1_1_semaphore_a329424188b5287ca596f1af3f6db58f1} 
std\+::mutex tf\+::\+Semaphore\+::\+\_\+mtx\hspace{0.3cm}{\ttfamily [mutable]}, {\ttfamily [private]}}

\Hypertarget{classtf_1_1_semaphore_a2c266637822af51b6ea77a47e35ad3fd}\index{tf::Semaphore@{tf::Semaphore}!\_waiters@{\_waiters}}
\index{\_waiters@{\_waiters}!tf::Semaphore@{tf::Semaphore}}
\doxysubsubsection{\texorpdfstring{\_waiters}{\_waiters}}
{\footnotesize\ttfamily \label{classtf_1_1_semaphore_a2c266637822af51b6ea77a47e35ad3fd} 
\mbox{\hyperlink{classtf_1_1_small_vector}{Small\+Vector}}$<$\mbox{\hyperlink{classtf_1_1_node}{Node}}\texorpdfstring{$\ast$}{*}$>$ tf\+::\+Semaphore\+::\+\_\+waiters\hspace{0.3cm}{\ttfamily [private]}}



该类的文档由以下文件生成\+:\begin{DoxyCompactItemize}
\item 
external/taskflow/taskflow/core/\mbox{\hyperlink{semaphore_8hpp}{semaphore.\+hpp}}\end{DoxyCompactItemize}
