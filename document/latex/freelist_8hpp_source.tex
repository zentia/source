\doxysection{freelist.\+hpp}
\hypertarget{freelist_8hpp_source}{}\label{freelist_8hpp_source}\index{external/taskflow/taskflow/core/freelist.hpp@{external/taskflow/taskflow/core/freelist.hpp}}
\mbox{\hyperlink{freelist_8hpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tsq_8hpp}{tsq.hpp}}"{}}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetf}{tf}}\ \{}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00011\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00012\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtf_1_1_freelist_a1e0f893362fad8ef304a099cd23d7ed0}{Freelist}}\ \{}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtf_1_1_freelist_a763b2f90bc53f92d680a635fe28e858e}{Executor}};}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00017\ \ \ }
\DoxyCodeLine{00018\ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structtf_1_1_freelist_1_1_bucket}{Bucket}}\ \{}
\DoxyCodeLine{00019\ \ \ \ \ std::mutex\ \mbox{\hyperlink{structtf_1_1_freelist_1_1_bucket_adef1f80d11bf7ade4a14e875d560ada8}{mutex}};}
\DoxyCodeLine{00020\ \ \ \ \ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue}{UnboundedTaskQueue<T>}}\ \mbox{\hyperlink{namespacequeue}{queue}};}
\DoxyCodeLine{00021\ \ \ \};}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \ \ \mbox{\hyperlink{macros_8hpp_a579f8be7dacb19f3c7cd55d79da8b0ff}{TF\_FORCE\_INLINE}}\ \mbox{\hyperlink{classtf_1_1_freelist_a1e0f893362fad8ef304a099cd23d7ed0}{Freelist}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}})\ :\ \mbox{\hyperlink{classtf_1_1_freelist_a754f96e84fa039f43996df0f87b741ad}{\_buckets}}(\mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}}\ <\ 4\ ?\ 1\ :\ \mbox{\hyperlink{namespacetf_a8845f13b039ef9820087c9f467f6c734}{floor\_log2}}(\mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}}))\ \{\}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \ \ \textcolor{comment}{//TF\_FORCE\_INLINE\ void\ push(size\_t\ w,\ T\ item)\ \{}}
\DoxyCodeLine{00026\ \ \ \textcolor{comment}{//\ \ std::scoped\_lock\ lock(\_buckets[w].mutex);}}
\DoxyCodeLine{00027\ \ \ \textcolor{comment}{//\ \ \_buckets[w].queue.push(item);\ \ }}
\DoxyCodeLine{00028\ \ \ \textcolor{comment}{//\}}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \ \ \mbox{\hyperlink{macros_8hpp_a579f8be7dacb19f3c7cd55d79da8b0ff}{TF\_FORCE\_INLINE}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_freelist_ae4b6cda4e9f4ebb7f4c9d81f54d912f2}{push}}(\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ item)\ \{}
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ =\ \textcolor{keyword}{reinterpret\_cast<}uintptr\_t\textcolor{keyword}{>}(item)\ \%\ \mbox{\hyperlink{classtf_1_1_freelist_a754f96e84fa039f43996df0f87b741ad}{\_buckets}}.size();}
\DoxyCodeLine{00032\ \ \ \ \ std::scoped\_lock\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\mbox{\hyperlink{classtf_1_1_freelist_a754f96e84fa039f43996df0f87b741ad}{\_buckets}}[\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}].\mbox{\hyperlink{harness__graph_8h_a7066db3b13dac6171efe89e7c49eb0d0}{mutex}});}
\DoxyCodeLine{00033\ \ \ \ \ \mbox{\hyperlink{classtf_1_1_freelist_a754f96e84fa039f43996df0f87b741ad}{\_buckets}}[\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}].queue.push(item);}
\DoxyCodeLine{00034\ \ \ \}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \mbox{\hyperlink{macros_8hpp_a579f8be7dacb19f3c7cd55d79da8b0ff}{TF\_FORCE\_INLINE}}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classtf_1_1_freelist_af1339dbf4b5e553cfb00821cd44728d2}{steal}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}})\ \{}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classtf_1_1_freelist_a754f96e84fa039f43996df0f87b741ad}{\_buckets}}[\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}].queue.steal();}
\DoxyCodeLine{00038\ \ \ \}}
\DoxyCodeLine{00039\ \ \ }
\DoxyCodeLine{00040\ \ \ \mbox{\hyperlink{macros_8hpp_a579f8be7dacb19f3c7cd55d79da8b0ff}{TF\_FORCE\_INLINE}}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classtf_1_1_freelist_a9fb2a685b962fb0c6b3b36f45f17b7bd}{steal\_with\_hint}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}},\ \textcolor{keywordtype}{size\_t}\&\ num\_empty\_steals)\ \{}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classtf_1_1_freelist_a754f96e84fa039f43996df0f87b741ad}{\_buckets}}[\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}].queue.steal\_with\_hint(num\_empty\_steals);}
\DoxyCodeLine{00042\ \ \ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ \mbox{\hyperlink{macros_8hpp_a579f8be7dacb19f3c7cd55d79da8b0ff}{TF\_FORCE\_INLINE}}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtf_1_1_freelist_a841fe2a20860a4b2e5bde8f8a0d1e546}{size}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classtf_1_1_freelist_a754f96e84fa039f43996df0f87b741ad}{\_buckets}}.size();}
\DoxyCodeLine{00046\ \ \ \}}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \mbox{\hyperlink{macros_8hpp_a579f8be7dacb19f3c7cd55d79da8b0ff}{TF\_FORCE\_INLINE}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtf_1_1_freelist_a02126ed2b88a16f9e90caa36a40c0675}{empty}}(\textcolor{keywordtype}{size\_t}\&\ which)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keywordflow}{for}(which=0;\ which<\mbox{\hyperlink{classtf_1_1_freelist_a754f96e84fa039f43996df0f87b741ad}{\_buckets}}.size();\ ++which)\ \{}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!\mbox{\hyperlink{classtf_1_1_freelist_a754f96e84fa039f43996df0f87b741ad}{\_buckets}}[which].\mbox{\hyperlink{namespacequeue}{queue}}.empty())\ \{}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00053\ \ \ \ \ \}}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00055\ \ \ \}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00058\ \ \ }
\DoxyCodeLine{00059\ \ \ std::vector<Bucket>\ \mbox{\hyperlink{classtf_1_1_freelist_a754f96e84fa039f43996df0f87b741ad}{\_buckets}};}
\DoxyCodeLine{00060\ \};}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \}\ \ \textcolor{comment}{//\ end\ of\ namespace\ tf\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}

\end{DoxyCode}
