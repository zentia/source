\doxysection{bitmap.\+h}
\hypertarget{bitmap_8h_source}{}\label{bitmap_8h_source}\index{runtime/EASTL/packages/mimalloc/src/bitmap.h@{runtime/EASTL/packages/mimalloc/src/bitmap.h}}
\mbox{\hyperlink{bitmap_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00002\ \textcolor{comment}{Copyright\ (c)\ 2019-\/2024\ Microsoft\ Research,\ Daan\ Leijen}}
\DoxyCodeLine{00003\ \textcolor{comment}{This\ is\ free\ software;\ you\ can\ redistribute\ it\ and/or\ modify\ it\ under\ the}}
\DoxyCodeLine{00004\ \textcolor{comment}{terms\ of\ the\ MIT\ license.\ A\ copy\ of\ the\ license\ can\ be\ found\ in\ the\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{"{}LICENSE"{}\ at\ the\ root\ of\ this\ distribution.}}
\DoxyCodeLine{00006\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00009\ \textcolor{comment}{Concurrent\ bitmap\ that\ can\ set/reset\ sequences\ of\ bits\ atomically}}
\DoxyCodeLine{00010\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#ifndef\ MI\_BITMAP\_H}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#define\ MI\_BITMAP\_H}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00016\ \textcolor{comment}{\ \ Atomic\ bitmaps\ with\ release/acquire\ guarantees:}}
\DoxyCodeLine{00017\ \textcolor{comment}{}}
\DoxyCodeLine{00018\ \textcolor{comment}{\ \ \`{}mi\_bfield\_t`:\ is\ a\ single\ machine\ word\ that\ can\ efficiently\ be\ bit\ counted\ (usually\ \`{}size\_t`)}}
\DoxyCodeLine{00019\ \textcolor{comment}{\ \ \ \ \ \ each\ bit\ usually\ represents\ a\ single\ MI\_ARENA\_SLICE\_SIZE\ in\ an\ arena\ (64\ KiB).}}
\DoxyCodeLine{00020\ \textcolor{comment}{\ \ \ \ \ \ We\ need\ 16K\ bits\ to\ represent\ a\ 1GiB\ arena.}}
\DoxyCodeLine{00021\ \textcolor{comment}{}}
\DoxyCodeLine{00022\ \textcolor{comment}{\ \ \`{}mi\_bchunk\_t`:\ a\ chunk\ of\ bfield's\ of\ a\ total\ of\ MI\_BCHUNK\_BITS\ (=\ 512\ on\ 64-\/bit,\ 256\ on\ 32-\/bit)}}
\DoxyCodeLine{00023\ \textcolor{comment}{\ \ \ \ \ \ allocations\ never\ span\ across\ chunks\ -\/-\/\ so\ MI\_ARENA\_MAX\_OBJ\_SIZE\ is\ the\ number}}
\DoxyCodeLine{00024\ \textcolor{comment}{\ \ \ \ \ \ of\ bits\ in\ a\ chunk\ times\ the\ MI\_ARENA\_SLICE\_SIZE\ (512\ *\ 64KiB\ =\ 32\ MiB).}}
\DoxyCodeLine{00025\ \textcolor{comment}{\ \ \ \ \ \ These\ chunks\ are\ cache-\/aligned\ and\ we\ can\ use\ AVX2/AVX512/NEON/SVE/SVE2/etc.\ instructions}}
\DoxyCodeLine{00026\ \textcolor{comment}{\ \ \ \ \ \ to\ scan\ for\ bits\ (perhaps)\ more\ efficiently.}}
\DoxyCodeLine{00027\ \textcolor{comment}{}}
\DoxyCodeLine{00028\ \textcolor{comment}{\ \ \ \ \ \ We\ allocate\ byte-\/sized\ ranges\ aligned\ to\ bytes\ in\ the\ bfield,\ and\ bfield-\/sized}}
\DoxyCodeLine{00029\ \textcolor{comment}{\ \ \ \ \ \ ranges\ aligned\ to\ a\ bfield.}}
\DoxyCodeLine{00030\ \textcolor{comment}{}}
\DoxyCodeLine{00031\ \textcolor{comment}{\ \ \ \ Searching\ linearly\ through\ the\ chunks\ would\ be\ too\ slow\ (16K\ bits\ per\ GiB).}}
\DoxyCodeLine{00032\ \textcolor{comment}{\ \ \ \ Instead\ we\ add\ a\ "{}chunkmap"{}\ to\ do\ a\ two-\/level\ search\ (more\ or\ less\ a\ btree\ of\ depth\ 2).}}
\DoxyCodeLine{00033\ \textcolor{comment}{}}
\DoxyCodeLine{00034\ \textcolor{comment}{\ \ \ \`{}mi\_bchunkmap\_t`\ (==\ \`{}mi\_bchunk\_t`):\ for\ each\ chunk\ we\ track\ if\ it\ has\ (potentially)\ any\ bit\ set.}}
\DoxyCodeLine{00035\ \textcolor{comment}{\ \ \ \ \ \ The\ chunkmap\ has\ 1\ bit\ per\ chunk\ that\ is\ set\ if\ the\ chunk\ potentially\ has\ a\ bit\ set.}}
\DoxyCodeLine{00036\ \textcolor{comment}{\ \ \ \ \ \ This\ is\ used\ to\ avoid\ scanning\ every\ chunk.\ (and\ thus\ strictly\ an\ optimization)}}
\DoxyCodeLine{00037\ \textcolor{comment}{\ \ \ \ \ \ It\ is\ conservative:\ it\ is\ fine\ to\ set\ a\ bit\ in\ the\ chunk\ map\ even\ if\ the\ chunk\ turns\ out}}
\DoxyCodeLine{00038\ \textcolor{comment}{\ \ \ \ \ \ to\ have\ no\ bits\ set.\ It\ is\ also\ allowed\ to\ briefly\ have\ a\ clear\ bit\ even\ if\ the}}
\DoxyCodeLine{00039\ \textcolor{comment}{\ \ \ \ \ \ chunk\ has\ bits\ set\ -\/-\/\ as\ long\ as\ we\ guarantee\ that\ the\ bit\ will\ be\ set\ later\ on;}}
\DoxyCodeLine{00040\ \textcolor{comment}{\ \ \ \ \ \ (this\ allows\ us\ to\ set\ the\ chunkmap\ bit\ right\ after\ we\ set\ a\ bit\ in\ the\ corresponding\ chunk).}}
\DoxyCodeLine{00041\ \textcolor{comment}{}}
\DoxyCodeLine{00042\ \textcolor{comment}{\ \ \ \ \ \ However,\ when\ we\ clear\ a\ bit\ in\ a\ chunk,\ and\ the\ chunk\ is\ indeed\ all\ clear,\ we}}
\DoxyCodeLine{00043\ \textcolor{comment}{\ \ \ \ \ \ cannot\ safely\ clear\ the\ bit\ corresponding\ to\ the\ chunk\ in\ the\ chunkmap\ since\ it}}
\DoxyCodeLine{00044\ \textcolor{comment}{\ \ \ \ \ \ may\ race\ with\ another\ thread\ setting\ a\ bit\ in\ the\ same\ chunk.\ Therefore,\ when}}
\DoxyCodeLine{00045\ \textcolor{comment}{\ \ \ \ \ \ clearing,\ we\ first\ test\ if\ a\ chunk\ is\ clear,\ then\ clear\ the\ chunkmap\ bit,\ and}}
\DoxyCodeLine{00046\ \textcolor{comment}{\ \ \ \ \ \ then\ test\ again\ to\ catch\ any\ set\ bits\ that\ we\ may\ have\ missed.}}
\DoxyCodeLine{00047\ \textcolor{comment}{}}
\DoxyCodeLine{00048\ \textcolor{comment}{\ \ \ \ \ \ Since\ the\ chunkmap\ may\ thus\ be\ briefly\ out-\/of-\/sync,\ this\ means\ that\ we\ may\ sometimes}}
\DoxyCodeLine{00049\ \textcolor{comment}{\ \ \ \ \ \ not\ find\ a\ free\ page\ even\ though\ it's\ there\ (but\ we\ accept\ this\ as\ we\ avoid\ taking}}
\DoxyCodeLine{00050\ \textcolor{comment}{\ \ \ \ \ \ full\ locks).\ (Another\ way\ to\ do\ this\ is\ to\ use\ an\ epoch\ but\ we\ like\ to\ avoid\ that\ complexity}}
\DoxyCodeLine{00051\ \textcolor{comment}{\ \ \ \ \ \ for\ now).}}
\DoxyCodeLine{00052\ \textcolor{comment}{}}
\DoxyCodeLine{00053\ \textcolor{comment}{\ \ \ \`{}mi\_bitmap\_t`:\ a\ bitmap\ with\ N\ chunks.\ A\ bitmap\ has\ a\ chunkmap\ of\ MI\_BCHUNK\_BITS\ (512)}}
\DoxyCodeLine{00054\ \textcolor{comment}{\ \ \ \ \ \ and\ thus\ has\ at\ most\ 512\ chunks\ (=2\string^18\ bits\ x\ 64\ KiB\ slices\ =\ 16\ GiB\ max\ arena\ size).}}
\DoxyCodeLine{00055\ \textcolor{comment}{\ \ \ \ \ \ The\ minimum\ is\ 1\ chunk\ which\ is\ a\ 32\ MiB\ arena.}}
\DoxyCodeLine{00056\ \textcolor{comment}{}}
\DoxyCodeLine{00057\ \textcolor{comment}{\ \ \ For\ now,\ the\ implementation\ assumes\ MI\_HAS\_FAST\_BITSCAN\ and\ uses\ trailing-\/zero-\/count}}
\DoxyCodeLine{00058\ \textcolor{comment}{\ \ \ and\ pop-\/count\ (but\ we\ think\ it\ can\ be\ adapted\ work\ reasonably\ well\ on\ older\ hardware\ too)}}
\DoxyCodeLine{00059\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \textcolor{comment}{//\ A\ word-\/size\ bit\ field.}}
\DoxyCodeLine{00062\ \textcolor{keyword}{typedef}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}};}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \textcolor{preprocessor}{\#define\ MI\_BFIELD\_BITS\_SHIFT\ \ \ \ \ \ \ \ \ (MI\_SIZE\_SHIFT+3)}}
\DoxyCodeLine{00065\ \textcolor{preprocessor}{\#define\ MI\_BFIELD\_BITS\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (1\ <<\ MI\_BFIELD\_BITS\_SHIFT)}}
\DoxyCodeLine{00066\ \textcolor{preprocessor}{\#define\ MI\_BFIELD\_SIZE\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (MI\_BFIELD\_BITS/8)}}
\DoxyCodeLine{00067\ \textcolor{preprocessor}{\#define\ MI\_BFIELD\_LO\_BIT8\ \ \ \ \ \ \ \ \ \ \ \ (((\string~(mi\_bfield\_t)0))/0xFF)\ \ \ \ \ \ \ \ \ }\textcolor{comment}{//\ 0x01010101\ ..}}
\DoxyCodeLine{00068\ \textcolor{preprocessor}{\#define\ MI\_BFIELD\_HI\_BIT8\ \ \ \ \ \ \ \ \ \ \ \ (MI\_BFIELD\_LO\_BIT8\ <<\ 7)\ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{//\ 0x80808080\ ..}}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \textcolor{preprocessor}{\#define\ MI\_BCHUNK\_SIZE\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (MI\_BCHUNK\_BITS\ /\ 8)}}
\DoxyCodeLine{00071\ \textcolor{preprocessor}{\#define\ MI\_BCHUNK\_FIELDS\ \ \ \ \ \ \ \ \ \ \ \ \ (MI\_BCHUNK\_BITS\ /\ MI\_BFIELD\_BITS)\ \ }\textcolor{comment}{//\ 8\ on\ both\ 64-\/\ and\ 32-\/bit}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \textcolor{comment}{//\ A\ bitmap\ chunk\ contains\ 512\ bits\ on\ 64-\/bit\ \ (256\ on\ 32-\/bit)}}
\DoxyCodeLine{00075\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a33031eab8e070d840b30ac61cf163c07}{mi\_decl\_align}}(\mbox{\hyperlink{bitmap_8h_a19d45f49ea2bf72626dd09fc4a8e6b60}{MI\_BCHUNK\_SIZE}})\ \textcolor{keyword}{struct\ }mi\_bchunk\_s\ \{}
\DoxyCodeLine{00076\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})\ bfields[\mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}}];}
\DoxyCodeLine{00077\ \}\ \mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}};}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \textcolor{comment}{//\ The\ chunkmap\ has\ one\ bit\ per\ corresponding\ chunk\ that\ is\ set\ if\ the\ chunk\ potentially\ has\ bits\ set.}}
\DoxyCodeLine{00081\ \textcolor{comment}{//\ The\ chunkmap\ is\ itself\ a\ chunk.}}
\DoxyCodeLine{00082\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}\ \mbox{\hyperlink{bitmap_8h_a0b4ba3cd3091fc6ed215a6e670bcda8f}{mi\_bchunkmap\_t}};}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \textcolor{preprocessor}{\#define\ MI\_BCHUNKMAP\_BITS\ \ \ \ \ \ \ \ \ \ \ \ \ MI\_BCHUNK\_BITS}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \textcolor{preprocessor}{\#define\ MI\_BITMAP\_MAX\_CHUNK\_COUNT\ \ \ \ \ (MI\_BCHUNKMAP\_BITS)}}
\DoxyCodeLine{00087\ \textcolor{preprocessor}{\#define\ MI\_BITMAP\_MIN\_CHUNK\_COUNT\ \ \ \ \ (1)}}
\DoxyCodeLine{00088\ \textcolor{preprocessor}{\#if\ MI\_SIZE\_BITS\ >\ 32}}
\DoxyCodeLine{00089\ \textcolor{preprocessor}{\#define\ MI\_BITMAP\_DEFAULT\_CHUNK\_COUNT\ \ \ \ \ (64)\ \ }\textcolor{comment}{//\ 2\ GiB\ on\ 64-\/bit\ -\/-\/\ this\ is\ for\ the\ page\ map}}
\DoxyCodeLine{00090\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00091\ \textcolor{preprocessor}{\#define\ MI\_BITMAP\_DEFAULT\_CHUNK\_COUNT\ \ \ \ \ \ (1)}}
\DoxyCodeLine{00092\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00093\ \textcolor{preprocessor}{\#define\ MI\_BITMAP\_MAX\_BIT\_COUNT\ \ \ \ \ \ \ (MI\_BITMAP\_MAX\_CHUNK\_COUNT\ *\ MI\_BCHUNK\_BITS)\ \ }\textcolor{comment}{//\ 16\ GiB\ arena}}
\DoxyCodeLine{00094\ \textcolor{preprocessor}{\#define\ MI\_BITMAP\_MIN\_BIT\_COUNT\ \ \ \ \ \ \ (MI\_BITMAP\_MIN\_CHUNK\_COUNT\ *\ MI\_BCHUNK\_BITS)\ \ }\textcolor{comment}{//\ 32\ MiB\ arena}}
\DoxyCodeLine{00095\ \textcolor{preprocessor}{\#define\ MI\_BITMAP\_DEFAULT\_BIT\_COUNT\ \ \ (MI\_BITMAP\_DEFAULT\_CHUNK\_COUNT\ *\ MI\_BCHUNK\_BITS)\ \ }\textcolor{comment}{//\ 2\ GiB\ arena}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \textcolor{comment}{//\ An\ atomic\ bitmap}}
\DoxyCodeLine{00099\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a33031eab8e070d840b30ac61cf163c07}{mi\_decl\_align}}(\mbox{\hyperlink{bitmap_8h_a19d45f49ea2bf72626dd09fc4a8e6b60}{MI\_BCHUNK\_SIZE}})\ \textcolor{keyword}{struct\ }mi\_bitmap\_s\ \{}
\DoxyCodeLine{00100\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\textcolor{keywordtype}{size\_t})\ \ chunk\_count;\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ total\ count\ of\ chunks\ (0\ <\ N\ <=\ MI\_BCHUNKMAP\_BITS)}}
\DoxyCodeLine{00101\ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \ \ \ \ \_padding[\mbox{\hyperlink{bitmap_8h_a19d45f49ea2bf72626dd09fc4a8e6b60}{MI\_BCHUNK\_SIZE}}/\mbox{\hyperlink{bits_8h_ae445b2692ff95de866d5bb1f5daffe2c}{MI\_SIZE\_SIZE}}\ -\/\ 1];\ \ \ \ \textcolor{comment}{//\ suppress\ warning\ on\ msvc}}
\DoxyCodeLine{00102\ \ \ \mbox{\hyperlink{bitmap_8h_a0b4ba3cd3091fc6ed215a6e670bcda8f}{mi\_bchunkmap\_t}}\ \ \ chunkmap;}
\DoxyCodeLine{00103\ \ \ \mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}\ \ \ \ \ \ chunks[\mbox{\hyperlink{bitmap_8h_a1c19041c2009b1e91ce7ac00f07ceda0}{MI\_BITMAP\_DEFAULT\_CHUNK\_COUNT}}];\ \ \ \ \ \ \ \ \textcolor{comment}{//\ usually\ dynamic\ MI\_BITMAP\_MAX\_CHUNK\_COUNT}}
\DoxyCodeLine{00104\ \}\ \mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}};}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{bitmap_8h_adbc04bcdad6dd6f18993c5ed4b92f2a4}{mi\_bitmap\_chunk\_count}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap)\ \{}
\DoxyCodeLine{00108\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&((\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*)bitmap)-\/>chunk\_count);}
\DoxyCodeLine{00109\ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{bitmap_8h_ac65c5f63cedfbd7ef9c6dcbdf9d37a0f}{mi\_bitmap\_max\_bits}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap)\ \{}
\DoxyCodeLine{00112\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{bitmap_8h_adbc04bcdad6dd6f18993c5ed4b92f2a4}{mi\_bitmap\_chunk\_count}}(bitmap)\ *\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00113\ \}}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00118\ \textcolor{comment}{\ \ Atomic\ bitmap\ operations}}
\DoxyCodeLine{00119\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \textcolor{comment}{//\ Many\ operations\ are\ generic\ over\ setting\ or\ clearing\ the\ bit\ sequence:\ we\ use\ \`{}mi\_xset\_t`\ for\ this\ (true\ if\ setting,\ false\ if\ clearing)}}
\DoxyCodeLine{00122\ \textcolor{keyword}{typedef}\ \textcolor{keywordtype}{bool}\ \ \mbox{\hyperlink{bitmap_8h_a67332e1b1063739efba1c809b15eeb36}{mi\_xset\_t}};}
\DoxyCodeLine{00123\ \textcolor{preprocessor}{\#define\ MI\_BIT\_SET\ \ \ \ (true)}}
\DoxyCodeLine{00124\ \textcolor{preprocessor}{\#define\ MI\_BIT\_CLEAR\ \ (false)}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \textcolor{comment}{//\ Required\ size\ of\ a\ bitmap\ to\ represent\ \`{}bit\_count`\ bits.}}
\DoxyCodeLine{00128\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{bitmap_8h_a05f9d27564a0329b540d5001c5b50b44}{mi\_bitmap\_size}}(\textcolor{keywordtype}{size\_t}\ bit\_count,\ \textcolor{keywordtype}{size\_t}*\ chunk\_count);}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \textcolor{comment}{//\ Initialize\ a\ bitmap\ to\ all\ clear;\ avoid\ a\ mem\_zero\ if\ \`{}already\_zero`\ is\ true}}
\DoxyCodeLine{00131\ \textcolor{comment}{//\ returns\ the\ size\ of\ the\ bitmap.}}
\DoxyCodeLine{00132\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{bitmap_8h_aed0bd8f290f3f1cc162df7b7ef95c35d}{mi\_bitmap\_init}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ bit\_count,\ \textcolor{keywordtype}{bool}\ already\_zero);}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \textcolor{comment}{//\ Set/clear\ a\ sequence\ of\ \`{}n`\ bits\ in\ the\ bitmap\ (and\ can\ cross\ chunks).}}
\DoxyCodeLine{00135\ \textcolor{comment}{//\ Not\ atomic\ so\ only\ use\ if\ still\ local\ to\ a\ thread.}}
\DoxyCodeLine{00136\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bitmap_8h_a563a4de12743448216d8b9763ce0fcbf}{mi\_bitmap\_unsafe\_setN}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n);}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \textcolor{comment}{//\ Set\ a\ bit\ in\ the\ bitmap;\ returns\ \`{}true`\ if\ it\ atomically\ transitioned\ from\ 0\ to\ 1}}
\DoxyCodeLine{00140\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_a929cc4a78e5271092ab20f25c10ba956}{mi\_bitmap\_set}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ idx);}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \textcolor{comment}{//\ Clear\ a\ bit\ in\ the\ bitmap;\ returns\ \`{}true`\ if\ it\ atomically\ transitioned\ from\ 1\ to\ 0}}
\DoxyCodeLine{00143\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_a8307caae564be5c0c96d17562ce1291b}{mi\_bitmap\_clear}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ idx);}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \textcolor{comment}{//\ Set\ a\ sequence\ of\ \`{}n`\ bits\ in\ the\ bitmap;\ returns\ \`{}true`\ if\ atomically\ transitioned\ from\ all\ 0's\ to\ 1's}}
\DoxyCodeLine{00146\ \textcolor{comment}{//\ \`{}n`\ cannot\ cross\ chunk\ boundaries\ (and\ \`{}n\ <=\ MI\_BCHUNK\_BITS`)!}}
\DoxyCodeLine{00147\ \textcolor{comment}{//\ If\ \`{}already\_set`\ is\ not\ NULL,\ it\ is\ set\ to\ count\ of\ bits\ were\ already\ all\ set.}}
\DoxyCodeLine{00148\ \textcolor{comment}{//\ (this\ is\ used\ for\ correct\ statistics\ if\ commiting\ over\ a\ partially\ committed\ area)}}
\DoxyCodeLine{00149\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_a8b50ea67e216213718b39a8bdc71c089}{mi\_bitmap\_setN}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{size\_t}*\ already\_set);}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \textcolor{comment}{//\ Clear\ a\ sequence\ of\ \`{}n`\ bits\ in\ the\ bitmap;\ returns\ \`{}true`\ if\ atomically\ transitioned\ from\ all\ 1's\ to\ 0's}}
\DoxyCodeLine{00152\ \textcolor{comment}{//\ \`{}n`\ cannot\ cross\ chunk\ boundaries\ (and\ \`{}n\ <=\ MI\_BCHUNK\_BITS`)!}}
\DoxyCodeLine{00153\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_aa8d5d77b9137fac58dba2415da230b4b}{mi\_bitmap\_clearN}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n);}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \textcolor{comment}{//\ Is\ a\ sequence\ of\ n\ bits\ already\ all\ set/cleared?}}
\DoxyCodeLine{00157\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_adb22535bc9bc502a2e9f4f41e64972b2}{mi\_bitmap\_is\_xsetN}}(\mbox{\hyperlink{bitmap_8h_a67332e1b1063739efba1c809b15eeb36}{mi\_xset\_t}}\ \mbox{\hyperlink{bundled_2ranges_8h_a080be1238e6ee3bd4b9f193b4181cf4dacdaeeeba9b4a4c5ebf042c0215a7bb0e}{set}},\ \mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n);}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \textcolor{comment}{//\ Is\ a\ sequence\ of\ n\ bits\ already\ set?}}
\DoxyCodeLine{00160\ \textcolor{comment}{//\ (Used\ to\ check\ if\ a\ memory\ range\ is\ already\ committed)}}
\DoxyCodeLine{00161\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_a1198ba479412d3f0fa55b87e40397dfa}{mi\_bitmap\_is\_setN}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n)\ \{}
\DoxyCodeLine{00162\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8h_adb22535bc9bc502a2e9f4f41e64972b2}{mi\_bitmap\_is\_xsetN}}(\mbox{\hyperlink{bitmap_8h_a5dbfb222b02d9b5694b56930ec5af3e5}{MI\_BIT\_SET}},\ bitmap,\ idx,\ n);}
\DoxyCodeLine{00163\ \}}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \textcolor{comment}{//\ Is\ a\ sequence\ of\ n\ bits\ already\ clear?}}
\DoxyCodeLine{00166\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_af936c34984e522b68823945d71373534}{mi\_bitmap\_is\_clearN}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n)\ \{}
\DoxyCodeLine{00167\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8h_adb22535bc9bc502a2e9f4f41e64972b2}{mi\_bitmap\_is\_xsetN}}(\mbox{\hyperlink{bitmap_8h_a726b00f7dbd3dc51249355e79845011b}{MI\_BIT\_CLEAR}},\ bitmap,\ idx,\ n);}
\DoxyCodeLine{00168\ \}}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_a16bfdf9334caeca0f356c0bdae1c7282}{mi\_bitmap\_is\_set}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ idx)\ \{}
\DoxyCodeLine{00171\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8h_a1198ba479412d3f0fa55b87e40397dfa}{mi\_bitmap\_is\_setN}}(bitmap,\ idx,\ 1);}
\DoxyCodeLine{00172\ \}}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_a5410022f92ddd60d2d1800c3161a1c43}{mi\_bitmap\_is\_clear}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ idx)\ \{}
\DoxyCodeLine{00175\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8h_af936c34984e522b68823945d71373534}{mi\_bitmap\_is\_clearN}}(bitmap,\ idx,\ 1);}
\DoxyCodeLine{00176\ \}}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \textcolor{comment}{//\ Called\ once\ a\ bit\ is\ cleared\ to\ see\ if\ the\ memory\ slice\ can\ be\ claimed.}}
\DoxyCodeLine{00179\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{sugar_8h_abb452686968e48b67397da5f97445f5b}{bool}}\ (\mbox{\hyperlink{bitmap_8h_a20baea921bde52c3d1b2626d03d409aa}{mi\_claim\_fun\_t}})(\textcolor{keywordtype}{size\_t}\ slice\_index,\ \mbox{\hyperlink{types_8h_a4187c38d7fe26f37558a31eb935dfe2d}{mi\_arena\_t}}*\ arena,\ \mbox{\hyperlink{types_8h_a4e05bcab5a6832b213e85e7186bd24bd}{mi\_heaptag\_t}}\ heap\_tag,\ \textcolor{keywordtype}{bool}*\ keep\_set);}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \textcolor{comment}{//\ Find\ a\ set\ bits\ in\ the\ bitmap,\ atomically\ clear\ it,\ and\ check\ if\ \`{}claim`\ returns\ true.}}
\DoxyCodeLine{00182\ \textcolor{comment}{//\ If\ not\ claimed,\ continue\ on\ (potentially\ setting\ the\ bit\ again\ depending\ on\ \`{}keep\_set`).}}
\DoxyCodeLine{00183\ \textcolor{comment}{//\ Returns\ true\ on\ success,\ and\ in\ that\ case\ sets\ the\ index:\ \`{}0\ <=\ *pidx\ <=\ MI\_BITMAP\_MAX\_BITS-\/n`.}}
\DoxyCodeLine{00184\ \mbox{\hyperlink{mimalloc_8h_acbaf5f4132fcfb51f0bf40e3b50f0981}{mi\_decl\_nodiscard}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_ad3abd3ec821fcd51ee18dd26221eee99}{mi\_bitmap\_try\_find\_and\_claim}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ tseq,\ \textcolor{keywordtype}{size\_t}*\ pidx,}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bitmap_8h_a20baea921bde52c3d1b2626d03d409aa}{mi\_claim\_fun\_t}}*\ claim,\ \mbox{\hyperlink{types_8h_a4187c38d7fe26f37558a31eb935dfe2d}{mi\_arena\_t}}*\ arena,\ \mbox{\hyperlink{types_8h_a4e05bcab5a6832b213e85e7186bd24bd}{mi\_heaptag\_t}}\ heap\_tag\ );}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \textcolor{comment}{//\ Atomically\ clear\ a\ bit\ but\ only\ if\ it\ is\ set.\ Will\ block\ otherwise\ until\ the\ bit\ is\ set.}}
\DoxyCodeLine{00189\ \textcolor{comment}{//\ This\ is\ used\ to\ delay\ free-\/ing\ a\ page\ that\ it\ at\ the\ same\ time\ being\ considered\ to\ be}}
\DoxyCodeLine{00190\ \textcolor{comment}{//\ allocated\ from\ \`{}mi\_arena\_try\_abandoned`\ (and\ is\ in\ the\ \`{}claim`\ function\ of\ \`{}mi\_bitmap\_try\_find\_and\_claim`).}}
\DoxyCodeLine{00191\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bitmap_8h_a5d33d5a4632e5bea06e41cd8a8f1179d}{mi\_bitmap\_clear\_once\_set}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ idx);}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \textcolor{comment}{//\ If\ a\ bit\ is\ set\ in\ the\ bitmap,\ return\ \`{}true`\ and\ set\ \`{}idx`\ to\ the\ index\ of\ the\ highest\ bit.}}
\DoxyCodeLine{00195\ \textcolor{comment}{//\ Otherwise\ return\ \`{}false`\ (and\ \`{}*idx`\ is\ undefined).}}
\DoxyCodeLine{00196\ \textcolor{comment}{//\ Used\ for\ unloading\ arena's}}
\DoxyCodeLine{00197\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_ae16f179c5be39c21cbad41f9f07b4d53}{mi\_bitmap\_bsr}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}*\ idx);}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{sugar_8h_abb452686968e48b67397da5f97445f5b}{bool}}\ (\mbox{\hyperlink{bitmap_8h_a04d7717532d9d613467ba190bca61188}{mi\_forall\_set\_fun\_t}})(\textcolor{keywordtype}{size\_t}\ slice\_index,\ \textcolor{keywordtype}{size\_t}\ slice\_count,\ \mbox{\hyperlink{types_8h_a4187c38d7fe26f37558a31eb935dfe2d}{mi\_arena\_t}}*\ arena,\ \textcolor{keywordtype}{void}*\ arg2);}
\DoxyCodeLine{00201\ }
\DoxyCodeLine{00202\ \textcolor{comment}{//\ Visit\ all\ set\ bits\ in\ a\ bitmap\ (`slice\_count\ ==\ 1`)}}
\DoxyCodeLine{00203\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_a7e9c291ee2f088455bc48a714d09e49a}{\_mi\_bitmap\_forall\_set}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \mbox{\hyperlink{bitmap_8h_a04d7717532d9d613467ba190bca61188}{mi\_forall\_set\_fun\_t}}*\ visit,\ \mbox{\hyperlink{types_8h_a4187c38d7fe26f37558a31eb935dfe2d}{mi\_arena\_t}}*\ arena,\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}});}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \textcolor{comment}{//\ Visit\ all\ set\ bits\ in\ a\ bitmap\ with\ larger\ ranges\ if\ possible\ (`slice\_count\ >=\ 1`)}}
\DoxyCodeLine{00206\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_a48ab4eea9d7b3ac453303f475d57d279}{\_mi\_bitmap\_forall\_setc\_ranges}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \mbox{\hyperlink{bitmap_8h_a04d7717532d9d613467ba190bca61188}{mi\_forall\_set\_fun\_t}}*\ visit,\ \mbox{\hyperlink{types_8h_a4187c38d7fe26f37558a31eb935dfe2d}{mi\_arena\_t}}*\ arena,\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}});}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00209\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00210\ \textcolor{comment}{\ \ Binned\ concurrent\ bitmap}}
\DoxyCodeLine{00211\ \textcolor{comment}{\ \ Assigns\ a\ size\ class\ to\ each\ chunk\ such\ that\ small\ blocks\ don't\ cause\ too}}
\DoxyCodeLine{00212\ \textcolor{comment}{\ \ much\ fragmentation\ since\ we\ keep\ chunks\ for\ larger\ blocks\ separate.}}
\DoxyCodeLine{00213\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \textcolor{comment}{//\ Size\ bins;\ larger\ bins\ are\ allowed\ to\ go\ into\ smaller\ bins.}}
\DoxyCodeLine{00216\ \textcolor{comment}{//\ SMALL\ can\ only\ be\ in\ small\ (and\ NONE),\ so\ they\ cannot\ fragment\ the\ larger\ bins.}}
\DoxyCodeLine{00217\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{enum}\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2}{mi\_bbin\_e}}\ \{}
\DoxyCodeLine{00218\ \ \ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2afac9ed2fe80193aef5e155bc142057d5}{MI\_BBIN\_SMALL}},\ \ \ \ \textcolor{comment}{//\ slice\_count\ ==\ 1}}
\DoxyCodeLine{00219\ \ \ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2addadd4a566187a53599ced6a88df8332}{MI\_BBIN\_OTHER}},\ \ \ \ \textcolor{comment}{//\ slice\_count:\ any\ other\ from\ the\ other\ bins,\ and\ 1\ <=\ slice\_count\ <=\ MI\_BCHUNK\_BITS}}
\DoxyCodeLine{00220\ \ \ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2a73a44b95f27919aa56395042bf644e64}{MI\_BBIN\_MEDIUM}},\ \ \ \textcolor{comment}{//\ slice\_count\ ==\ 8}}
\DoxyCodeLine{00221\ \ \ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2ac26f89e8436c31f8d2b5524f2e819acb}{MI\_BBIN\_LARGE}},\ \ \ \ \textcolor{comment}{//\ slice\_count\ ==\ MI\_BFIELD\_BITS\ \ -\/-\/\ only\ used\ if\ MI\_ENABLE\_LARGE\_PAGES\ is\ 1}}
\DoxyCodeLine{00222\ \ \ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2a85f2a45d1680076d7df3955c93e7e794}{MI\_BBIN\_NONE}},\ \ \ \ \ \textcolor{comment}{//\ no\ bin\ assigned\ yet\ (the\ chunk\ is\ completely\ free)}}
\DoxyCodeLine{00223\ \ \ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2a64558e9ce6219950529e130d68029e5a}{MI\_BBIN\_COUNT}}}
\DoxyCodeLine{00224\ \}\ \mbox{\hyperlink{bitmap_8h_adc852dbc4ef60361c7f31529a9e43927}{mi\_bbin\_t}};}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{bitmap_8h_adc852dbc4ef60361c7f31529a9e43927}{mi\_bbin\_t}}\ \mbox{\hyperlink{bitmap_8h_a3ac44ca2692e75b2a9bc1ab1ed9f5a84}{mi\_bbin\_inc}}(\mbox{\hyperlink{bitmap_8h_adc852dbc4ef60361c7f31529a9e43927}{mi\_bbin\_t}}\ bbin)\ \{}
\DoxyCodeLine{00227\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(bbin\ <\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2a64558e9ce6219950529e130d68029e5a}{MI\_BBIN\_COUNT}});}
\DoxyCodeLine{00228\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{bitmap_8h_adc852dbc4ef60361c7f31529a9e43927}{mi\_bbin\_t}})((\mbox{\hyperlink{sugar_8h_ae88a82478e3818cade3f598c25437904}{int}})bbin\ +\ 1);}
\DoxyCodeLine{00229\ \}}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{bitmap_8h_adc852dbc4ef60361c7f31529a9e43927}{mi\_bbin\_t}}\ \mbox{\hyperlink{bitmap_8h_a3db58938099f3275a827288d8f640271}{mi\_bbin\_dec}}(\mbox{\hyperlink{bitmap_8h_adc852dbc4ef60361c7f31529a9e43927}{mi\_bbin\_t}}\ bbin)\ \{}
\DoxyCodeLine{00232\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(bbin\ >\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2a85f2a45d1680076d7df3955c93e7e794}{MI\_BBIN\_NONE}});}
\DoxyCodeLine{00233\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{bitmap_8h_adc852dbc4ef60361c7f31529a9e43927}{mi\_bbin\_t}})((\mbox{\hyperlink{sugar_8h_ae88a82478e3818cade3f598c25437904}{int}})bbin\ -\/\ 1);}
\DoxyCodeLine{00234\ \}}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{bitmap_8h_adc852dbc4ef60361c7f31529a9e43927}{mi\_bbin\_t}}\ \mbox{\hyperlink{bitmap_8h_a2b2a3c07810f9ec7680d37f24113c16c}{mi\_bbin\_of}}(\textcolor{keywordtype}{size\_t}\ slice\_count)\ \{}
\DoxyCodeLine{00237\ \ \ \textcolor{keywordflow}{if}\ (slice\_count==1)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2afac9ed2fe80193aef5e155bc142057d5}{MI\_BBIN\_SMALL}};}
\DoxyCodeLine{00238\ \ \ \textcolor{keywordflow}{if}\ (slice\_count==8)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2a73a44b95f27919aa56395042bf644e64}{MI\_BBIN\_MEDIUM}};}
\DoxyCodeLine{00239\ \textcolor{preprocessor}{\ \ \#if\ MI\_ENABLE\_LARGE\_PAGES}}
\DoxyCodeLine{00240\ \ \ \textcolor{keywordflow}{if}\ (slice\_count==\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}})\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2ac26f89e8436c31f8d2b5524f2e819acb}{MI\_BBIN\_LARGE}};}
\DoxyCodeLine{00241\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00242\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2addadd4a566187a53599ced6a88df8332}{MI\_BBIN\_OTHER}};}
\DoxyCodeLine{00243\ \}}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \textcolor{comment}{//\ An\ atomic\ "{}binned"{}\ bitmap\ for\ the\ free\ slices\ where\ we\ keep\ chunks\ reserved\ for\ particalar\ size\ classes}}
\DoxyCodeLine{00246\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a33031eab8e070d840b30ac61cf163c07}{mi\_decl\_align}}(\mbox{\hyperlink{bitmap_8h_a19d45f49ea2bf72626dd09fc4a8e6b60}{MI\_BCHUNK\_SIZE}})\ \textcolor{keyword}{struct\ }mi\_bbitmap\_s\ \{}
\DoxyCodeLine{00247\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\textcolor{keywordtype}{size\_t})\ \ chunk\_count;\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ total\ count\ of\ chunks\ (0\ <\ N\ <=\ MI\_BCHUNKMAP\_BITS)}}
\DoxyCodeLine{00248\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\textcolor{keywordtype}{size\_t})\ \ chunk\_max\_accessed;\ \ \textcolor{comment}{//\ max\ chunk\ index\ that\ was\ once\ cleared\ or\ set}}
\DoxyCodeLine{00249\ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \ \ \ \ \_padding[\mbox{\hyperlink{bitmap_8h_a19d45f49ea2bf72626dd09fc4a8e6b60}{MI\_BCHUNK\_SIZE}}/\mbox{\hyperlink{bits_8h_ae445b2692ff95de866d5bb1f5daffe2c}{MI\_SIZE\_SIZE}}\ -\/\ 2];\ \ \ \ \textcolor{comment}{//\ suppress\ warning\ on\ msvc}}
\DoxyCodeLine{00250\ \ \ \mbox{\hyperlink{bitmap_8h_a0b4ba3cd3091fc6ed215a6e670bcda8f}{mi\_bchunkmap\_t}}\ \ \ chunkmap;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00251\ \ \ \mbox{\hyperlink{bitmap_8h_a0b4ba3cd3091fc6ed215a6e670bcda8f}{mi\_bchunkmap\_t}}\ \ \ chunkmap\_bins[\mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2a64558e9ce6219950529e130d68029e5a}{MI\_BBIN\_COUNT}}\ -\/\ 1];\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ chunkmaps\ with\ bit\ set\ if\ the\ chunk\ is\ in\ that\ size\ class\ (excluding\ MI\_BBIN\_NONE)\ \ }}
\DoxyCodeLine{00252\ \ \ \mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}\ \ \ \ \ \ chunks[\mbox{\hyperlink{bitmap_8h_a1c19041c2009b1e91ce7ac00f07ceda0}{MI\_BITMAP\_DEFAULT\_CHUNK\_COUNT}}];\ \ \ \ \ \ \ \ \textcolor{comment}{//\ usually\ dynamic\ MI\_BITMAP\_MAX\_CHUNK\_COUNT}}
\DoxyCodeLine{00253\ \}\ \mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}};}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{bitmap_8h_a61d4c39827af9a9dbeb574d28856ba90}{mi\_bbitmap\_chunk\_count}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap)\ \{}
\DoxyCodeLine{00257\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&((\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*)bbitmap)-\/>chunk\_count);}
\DoxyCodeLine{00258\ \}}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00260\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{bitmap_8h_afb1f816c002677982471bf19521ac6ee}{mi\_bbitmap\_max\_bits}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap)\ \{}
\DoxyCodeLine{00261\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{bitmap_8h_a61d4c39827af9a9dbeb574d28856ba90}{mi\_bbitmap\_chunk\_count}}(bbitmap)\ *\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00262\ \}}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \mbox{\hyperlink{bitmap_8h_adc852dbc4ef60361c7f31529a9e43927}{mi\_bbin\_t}}\ \mbox{\hyperlink{bitmap_8h_a14329350e0ffe573a7439d1d3108fbe5}{mi\_bbitmap\_debug\_get\_bin}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunkmap\_bins,\ \textcolor{keywordtype}{size\_t}\ chunk\_idx);}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{bitmap_8h_a2b10ca74c49e6d2c264476451cbec8e3}{mi\_bbitmap\_size}}(\textcolor{keywordtype}{size\_t}\ bit\_count,\ \textcolor{keywordtype}{size\_t}*\ chunk\_count);}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \textcolor{comment}{//\ Initialize\ a\ bitmap\ to\ all\ clear;\ avoid\ a\ mem\_zero\ if\ \`{}already\_zero`\ is\ true}}
\DoxyCodeLine{00270\ \textcolor{comment}{//\ returns\ the\ size\ of\ the\ bitmap.}}
\DoxyCodeLine{00271\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{bitmap_8h_a4bd0f59fd39f7ef532ecf6379640103a}{mi\_bbitmap\_init}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ bit\_count,\ \textcolor{keywordtype}{bool}\ already\_zero);}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00273\ \textcolor{comment}{//\ Set/clear\ a\ sequence\ of\ \`{}n`\ bits\ in\ the\ bitmap\ (and\ can\ cross\ chunks).}}
\DoxyCodeLine{00274\ \textcolor{comment}{//\ Not\ atomic\ so\ only\ use\ if\ still\ local\ to\ a\ thread.}}
\DoxyCodeLine{00275\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bitmap_8h_a370a9392dc0bbcf78d5ff77ca2a9e15b}{mi\_bbitmap\_unsafe\_setN}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n);}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00277\ }
\DoxyCodeLine{00278\ \textcolor{comment}{//\ Set\ a\ sequence\ of\ \`{}n`\ bits\ in\ the\ bbitmap;\ returns\ \`{}true`\ if\ atomically\ transitioned\ from\ all\ 0's\ to\ 1's}}
\DoxyCodeLine{00279\ \textcolor{comment}{//\ \`{}n`\ cannot\ cross\ chunk\ boundaries\ (and\ \`{}n\ <=\ MI\_BCHUNK\_BITS`)!}}
\DoxyCodeLine{00280\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_ad8105936ebee14e0c6cadb2e8c37b024}{mi\_bbitmap\_setN}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n);}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ \textcolor{comment}{//\ Is\ a\ sequence\ of\ n\ bits\ already\ all\ set/cleared?}}
\DoxyCodeLine{00284\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_a143c1ab4aaff95bc9a5642f45e2fc52f}{mi\_bbitmap\_is\_xsetN}}(\mbox{\hyperlink{bitmap_8h_a67332e1b1063739efba1c809b15eeb36}{mi\_xset\_t}}\ \mbox{\hyperlink{bundled_2ranges_8h_a080be1238e6ee3bd4b9f193b4181cf4dacdaeeeba9b4a4c5ebf042c0215a7bb0e}{set}},\ \mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n);}
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00286\ \textcolor{comment}{//\ Is\ a\ sequence\ of\ n\ bits\ already\ set?}}
\DoxyCodeLine{00287\ \textcolor{comment}{//\ (Used\ to\ check\ if\ a\ memory\ range\ is\ already\ committed)}}
\DoxyCodeLine{00288\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_abd353a68e23af859581f723f5918fb5b}{mi\_bbitmap\_is\_setN}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n)\ \{}
\DoxyCodeLine{00289\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8h_a143c1ab4aaff95bc9a5642f45e2fc52f}{mi\_bbitmap\_is\_xsetN}}(\mbox{\hyperlink{bitmap_8h_a5dbfb222b02d9b5694b56930ec5af3e5}{MI\_BIT\_SET}},\ bbitmap,\ idx,\ n);}
\DoxyCodeLine{00290\ \}}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \textcolor{comment}{//\ Is\ a\ sequence\ of\ n\ bits\ already\ clear?}}
\DoxyCodeLine{00293\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_a5424318442a5d1f904eab0d157bc777e}{mi\_bbitmap\_is\_clearN}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n)\ \{}
\DoxyCodeLine{00294\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8h_a143c1ab4aaff95bc9a5642f45e2fc52f}{mi\_bbitmap\_is\_xsetN}}(\mbox{\hyperlink{bitmap_8h_a726b00f7dbd3dc51249355e79845011b}{MI\_BIT\_CLEAR}},\ bbitmap,\ idx,\ n);}
\DoxyCodeLine{00295\ \}}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00298\ \textcolor{comment}{//\ Try\ to\ atomically\ transition\ \`{}n`\ bits\ from\ all\ set\ to\ all\ clear.\ Returns\ \`{}true`\ on\ succes.}}
\DoxyCodeLine{00299\ \textcolor{comment}{//\ \`{}n`\ cannot\ cross\ chunk\ boundaries,\ where\ \`{}n\ <=\ MI\_CHUNK\_BITS`.}}
\DoxyCodeLine{00300\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_a1462519a63f8d0b1454a5cbe8d7cafa1}{mi\_bbitmap\_try\_clearN}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n);}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ \textcolor{comment}{//\ Specialized\ versions\ for\ common\ bit\ sequence\ sizes}}
\DoxyCodeLine{00303\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_af4021b82102a0099956ce78b094ef754}{mi\_bbitmap\_try\_find\_and\_clear}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ tseq,\ \textcolor{keywordtype}{size\_t}*\ pidx);\ \ \textcolor{comment}{//\ 1-\/bit}}
\DoxyCodeLine{00304\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_a1cea740ac26cb096d1af87f0ccf155e6}{mi\_bbitmap\_try\_find\_and\_clear8}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ tseq,\ \textcolor{keywordtype}{size\_t}*\ pidx);\ \textcolor{comment}{//\ 8-\/bits}}
\DoxyCodeLine{00305\ \textcolor{comment}{//\ bool\ mi\_bbitmap\_try\_find\_and\_clearX(mi\_bbitmap\_t*\ bbitmap,\ size\_t\ tseq,\ size\_t*\ pidx);\ //\ MI\_BFIELD\_BITS}}
\DoxyCodeLine{00306\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_a793bcf93e039c01e3c499db5e250e915}{mi\_bbitmap\_try\_find\_and\_clearNX}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{size\_t}\ tseq,\ \textcolor{keywordtype}{size\_t}*\ pidx);\ \textcolor{comment}{//\ <\ MI\_BFIELD\_BITS}}
\DoxyCodeLine{00307\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_a255100c05b035d8901b377cf24c3e634}{mi\_bbitmap\_try\_find\_and\_clearN\_}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{size\_t}\ tseq,\ \textcolor{keywordtype}{size\_t}*\ pidx);\ \textcolor{comment}{//\ >\ MI\_BFIELD\_BITS\ <=\ MI\_BCHUNK\_BITS}}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \textcolor{comment}{//\ Find\ a\ sequence\ of\ \`{}n`\ bits\ in\ the\ bbitmap\ with\ all\ bits\ set,\ and\ try\ to\ atomically\ clear\ all.}}
\DoxyCodeLine{00310\ \textcolor{comment}{//\ Returns\ true\ on\ success,\ and\ in\ that\ case\ sets\ the\ index:\ \`{}0\ <=\ *pidx\ <=\ MI\_BITMAP\_MAX\_BITS-\/n`.}}
\DoxyCodeLine{00311\ \mbox{\hyperlink{mimalloc_8h_acbaf5f4132fcfb51f0bf40e3b50f0981}{mi\_decl\_nodiscard}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8h_a68973af6da3993bcf5f6e14bd5395e0e}{mi\_bbitmap\_try\_find\_and\_clearN}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{size\_t}\ tseq,\ \textcolor{keywordtype}{size\_t}*\ pidx)\ \{}
\DoxyCodeLine{00312\ \ \ \textcolor{keywordflow}{if}\ (n==1)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8h_af4021b82102a0099956ce78b094ef754}{mi\_bbitmap\_try\_find\_and\_clear}}(bbitmap,\ tseq,\ pidx);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ small\ pages}}
\DoxyCodeLine{00313\ \ \ \textcolor{keywordflow}{if}\ (n==8)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8h_a1cea740ac26cb096d1af87f0ccf155e6}{mi\_bbitmap\_try\_find\_and\_clear8}}(bbitmap,\ tseq,\ pidx);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ medium\ pages}}
\DoxyCodeLine{00314\ \ \ \textcolor{comment}{//\ if\ (n==MI\_BFIELD\_BITS)\ return\ mi\_bbitmap\_try\_find\_and\_clearX(bbitmap,\ tseq,\ pidx);\ //\ large\ pages}}
\DoxyCodeLine{00315\ \ \ \textcolor{keywordflow}{if}\ (n==0\ ||\ n>\mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}})\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \ \textcolor{comment}{//\ cannot\ be\ more\ than\ a\ chunk}}
\DoxyCodeLine{00316\ \ \ \textcolor{keywordflow}{if}\ (n<=\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}})\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8h_a793bcf93e039c01e3c499db5e250e915}{mi\_bbitmap\_try\_find\_and\_clearNX}}(bbitmap,\ tseq,\ n,\ pidx);}
\DoxyCodeLine{00317\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8h_a255100c05b035d8901b377cf24c3e634}{mi\_bbitmap\_try\_find\_and\_clearN\_}}(bbitmap,\ tseq,\ n,\ pidx);}
\DoxyCodeLine{00318\ \}}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ }
\DoxyCodeLine{00321\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ MI\_BITMAP\_H}}

\end{DoxyCode}
