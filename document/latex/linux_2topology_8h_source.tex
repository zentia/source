\doxysection{topology.\+h}
\hypertarget{linux_2topology_8h_source}{}\label{linux_2topology_8h_source}\index{external/libcds/cds/os/linux/topology.h@{external/libcds/cds/os/linux/topology.h}}
\mbox{\hyperlink{linux_2topology_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ (c)\ 2006-\/2018\ Maxim\ Khizhinsky}}
\DoxyCodeLine{00002\ \textcolor{comment}{//}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ Distributed\ under\ the\ Boost\ Software\ License,\ Version\ 1.0.\ (See\ accompanying}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ file\ LICENSE\ or\ copy\ at\ http://www.boost.org/LICENSE\_1\_0.txt)}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#ifndef\ CDSLIB\_OS\_LINUX\_TOPOLOGY\_H}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#define\ CDSLIB\_OS\_LINUX\_TOPOLOGY\_H}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#ifndef\ CDSLIB\_OS\_TOPOLOGY\_H}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#\ \ \ error\ "{}<cds/os/topology.h>\ must\ be\ included\ instead"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{details_2defs_8h}{cds/details/defs.h}}>}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{model_8h}{cds/threading/model.h}}>}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ <sys/syscall.h>}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ <sched.h>}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacecds}{cds}}\ \{\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacecds_1_1_o_s}{OS}}\ \{}
\DoxyCodeLine{00021\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacecds_1_1_o_s_1_1_linux}{Linux}}\ \{}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structcds_1_1_o_s_1_1_linux_1_1topology}{topology}}\ \{}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//@cond}}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \ \ \ \ \mbox{\hyperlink{dllmain_8cpp_aa3f35f60ed340be15f5922ab20a3126a}{s\_nProcessorCount}};}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//@endcond}}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structcds_1_1_o_s_1_1_linux_1_1topology_a8b49913b2d2c3223000cc11ed6c3fdc3}{processor\_count}}()}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{dllmain_8cpp_aa3f35f60ed340be15f5922ab20a3126a}{s\_nProcessorCount}};}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structcds_1_1_o_s_1_1_linux_1_1topology_a65a152c04efaa3d7164d08a4a3c98471}{current\_processor}}()}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Compile\ libcds\ with\ -\/DCDS\_LINUX\_NO\_sched\_getcpu\ if\ your\ linux\ does\ not\ have\ sched\_getcpu\ (glibc\ version\ less\ than\ 2.6)}}
\DoxyCodeLine{00052\ \textcolor{preprocessor}{\#\ \ \ \ \ \ \ \ \ \ \ if\ !defined(CDS\_LINUX\_NO\_sched\_getcpu)\ \&\&\ defined(SYS\_getcpu)}}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ nProcessor\ =\ ::sched\_getcpu();}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ nProcessor\ ==\ -\/1\ ?\ 0\ :\ (\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{sugar_8h_ae4f82344f573c70aa1066a2394bba345}{int}})\ nProcessor;}
\DoxyCodeLine{00055\ \textcolor{preprocessor}{\#\ \ \ \ \ \ \ \ \ \ \ else}}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Use\ fake\ "{}current\ processor\ number"{}\ assigned\ for\ current\ thread}}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int})\ threading::Manager::fake\_current\_processor();}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00060\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Another\ way\ (for\ x86/amd64\ only)}}
\DoxyCodeLine{00061\ \textcolor{comment}{}}
\DoxyCodeLine{00062\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Using\ cpuid\ and\ APIC\ ID\ (http://www.scss.tcd.ie/Jeremy.Jones/GetCurrentProcessorNumberXP.htm)}}
\DoxyCodeLine{00063\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ for\ x86\ and\ amd64}}
\DoxyCodeLine{00064\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}}
\DoxyCodeLine{00065\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_asm\ \{mov\ eax,\ 1\}}}
\DoxyCodeLine{00066\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_asm\ \{cpuid\}}}
\DoxyCodeLine{00067\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_asm\ \{shr\ ebx,\ 24\}}}
\DoxyCodeLine{00068\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_asm\ \{mov\ eax,\ ebx\}}}
\DoxyCodeLine{00069\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}}
\DoxyCodeLine{00070\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ However:}}
\DoxyCodeLine{00071\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/\ cpuid\ is\ full\ sync\ barrier}}
\DoxyCodeLine{00072\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/\ it\ is\ only\ for\ x86/amd64\ architecture}}
\DoxyCodeLine{00073\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00074\ \textcolor{preprocessor}{\#\ \ \ \ \ \ \ \ \ \ \ endif}}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structcds_1_1_o_s_1_1_linux_1_1topology_ac1199be1fad892c04da28aa08053a0a2}{native\_current\_processor}}()}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structcds_1_1_o_s_1_1_linux_1_1topology_a65a152c04efaa3d7164d08a4a3c98471}{current\_processor}}();}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//@cond}}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{boing_8c_a2858154e2009b0e6e616f313177762bc}{init}}();}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ fini();}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//@endcond}}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00088\ \ \ \ \ \}\ \ \ \textcolor{comment}{//\ namespace\ Linux}}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \}\}\ \ \textcolor{comment}{//\ namespace\ cds::OS}}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \#ifndef\ CDSLIB\_OS\_LINUX\_TOPOLOGY\_H}}

\end{DoxyCode}
