\doxysection{Map\+Reader.\+hpp}
\hypertarget{_map_reader_8hpp_source}{}\label{_map_reader_8hpp_source}\index{external/reflect-\/cpp/include/rfl/parsing/MapReader.hpp@{external/reflect-\/cpp/include/rfl/parsing/MapReader.hpp}}
\mbox{\hyperlink{_map_reader_8hpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ RFL\_PARSING\_MAPREADER\_HPP\_}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ RFL\_PARSING\_MAPREADER\_HPP\_}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <string\_view>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <type\_traits>}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <utility>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_result_8hpp}{../Result.hpp}}"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{always__false_8hpp}{../always\_false.hpp}}"{}}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacerfl_1_1parsing}{rfl::parsing}}\ \{}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ R,\ \textcolor{keyword}{class}\ W,\ \textcolor{keyword}{class}\ MapType,\ \textcolor{keyword}{class}\ ProcessorsType>}
\DoxyCodeLine{00016\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_a2fc069259cf241b376045a1794637d2e}{MapReader}}\ \{}
\DoxyCodeLine{00017\ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00018\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_a89766119dd218e0c12ccc1ed0db53bfa}{InputVarType}}\ =\ \textcolor{keyword}{typename}\ R::InputVarType;}
\DoxyCodeLine{00019\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_a1cbbdb8b20cfcc7290ff67b5e4c09660}{KeyType}}\ =\ std::remove\_cvref\_t<typename\ MapType::value\_type::first\_type>;}
\DoxyCodeLine{00020\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_a9d7b82bc52311532e8708210543f8dde}{ValueType}}\ =}
\DoxyCodeLine{00021\ \ \ \ \ \ \ std::remove\_cvref\_t<typename\ MapType::value\_type::second\_type>;}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00024\ \ \ \mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_a2fc069259cf241b376045a1794637d2e}{MapReader}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{test__broadcast__node_8cpp_a554e63228b946db0d44c4f398b18e212}{R}}*\ \_r,\ \mbox{\hyperlink{_tutorial___map__using_8cpp_a07abaf7fcecdbd63813bdb5795a256a1}{MapType}}*\ \_map,\ std::vector<Error>*\ \_errors)}
\DoxyCodeLine{00025\ \ \ \ \ \ \ :\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_af220c808d8bfddd82cd7c2f3efcf66db}{r\_}}(\_r),\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_a5551d28c53b61f19e258130048d5eb9c}{map\_}}(\_map),\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_aa382cb7904fff89ed02fe405382d7781}{errors\_}}(\_errors)\ \{\}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \ \ \mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_aff22bb275231fcea5951595df0a60d61}{\string~MapReader}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_ac6517df38e93f77dbc5141cb5c1c8742}{read}}(\textcolor{keyword}{const}\ std::string\_view\&\ \_name,}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_a89766119dd218e0c12ccc1ed0db53bfa}{InputVarType}}\&\ \_var)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}\ =\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_a425577f2bc02f3306cda29b517b151f0}{get\_pair}}(\_name,\ \_var);}
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}})\ \{}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_a5551d28c53b61f19e258130048d5eb9c}{map\_}}-\/>emplace(std::move(*\mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}));}
\DoxyCodeLine{00034\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_aa382cb7904fff89ed02fe405382d7781}{errors\_}}-\/>push\_back(\mbox{\hyperlink{classrfl_1_1_error}{Error}}(\textcolor{stringliteral}{"{}Failed\ to\ parse\ field\ '"{}}\ +\ std::string(\_name)\ +}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}':\ "{}}\ +\ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}.error().what()));}
\DoxyCodeLine{00037\ \ \ \ \ \}}
\DoxyCodeLine{00038\ \ \ \}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00041\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{00042\ \ \ \mbox{\hyperlink{classrfl_1_1_result}{Result<T>}}\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_a519bd765a19fc242c3f56a7275c1eee2}{key\_to\_numeric}}(\textcolor{keyword}{auto}\&\ \_pair)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::is\_integral\_v<T>\ \&\&\ std::is\_signed\_v<T>)\ \{}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\textcolor{keyword}{>}(std::stoll(\_pair.first));}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::is\_integral\_v<T>\ \&\&\ std::is\_unsigned\_v<T>)\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\textcolor{keyword}{>}(std::stoull(\_pair.first));}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::is\_floating\_point\_v<T>)\ \{}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\textcolor{keyword}{>}(std::stod(\_pair.first));}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_assert}(\mbox{\hyperlink{namespacerfl_a31e80cea0068eae493065be48bba8d04}{always\_false\_v<T>}},\ \textcolor{stringliteral}{"{}Unsupported\ type"{}});}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00053\ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (std::exception\&\ \mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}})\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacerfl_a6625864c6c297dfdc3d3c3ee3181dd8c}{error}}(\mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}}.what());}
\DoxyCodeLine{00055\ \ \ \ \ \}}
\DoxyCodeLine{00056\ \ \ \}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \mbox{\hyperlink{classrfl_1_1_result}{Result<std::pair<KeyType,\ ValueType>}}>\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_a3771dd44bc9fda4f09e96fd5707f8c48}{make\_key}}(\textcolor{keyword}{auto}\&\ \_pair)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ to\_pair\ =}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ [\&](\textcolor{keyword}{auto}\ \_key)\ -\/>\ \mbox{\hyperlink{classrfl_1_1_result}{Result}}<std::pair<KeyType,\ ValueType>>\ \{}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \textcolor{keywordflow}{try}\ \{}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::make\_pair(\mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_a1cbbdb8b20cfcc7290ff67b5e4c09660}{KeyType}}(std::move(\_key)),}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::move(\_pair.second));}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{catch}\ (std::exception\&\ \mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}})\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacerfl_a6625864c6c297dfdc3d3c3ee3181dd8c}{error}}(\mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}}.what());}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00067\ \ \ \ \ \};}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::is\_integral\_v<KeyType>\ ||}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::is\_floating\_point\_v<KeyType>)\ \{}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_a519bd765a19fc242c3f56a7275c1eee2}{key\_to\_numeric<KeyType>}}(\_pair).and\_then(to\_pair);}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (\mbox{\hyperlink{namespacerfl_1_1internal_a1e6f34bf15629b2b77fc0df4e0075709}{internal::has\_reflection\_type\_v<KeyType>}})\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \textcolor{keyword}{using\ }ReflT\ =\ \textcolor{keyword}{typename}\ KeyType::ReflectionType;}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::is\_integral\_v<ReflT>\ ||}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::is\_floating\_point\_v<ReflT>)\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_a519bd765a19fc242c3f56a7275c1eee2}{key\_to\_numeric<ReflT>}}(\_pair).and\_then(to\_pair);}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ to\_pair(\_pair.first);}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::move(\_pair);}
\DoxyCodeLine{00085\ \ \ \ \ \}}
\DoxyCodeLine{00086\ \ \ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \mbox{\hyperlink{classrfl_1_1_result}{Result<std::pair<KeyType,\ ValueType>}}>\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_a425577f2bc02f3306cda29b517b151f0}{get\_pair}}(}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\_view\&\ \_name,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_a89766119dd218e0c12ccc1ed0db53bfa}{InputVarType}}\&\ \_var)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ to\_pair\ =\ [\&](\mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_a9d7b82bc52311532e8708210543f8dde}{ValueType}}\&\&\ \_val)\ \{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ pair\ =\ std::make\_pair(std::string(\_name),\ std::move(\_val));}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_a3771dd44bc9fda4f09e96fd5707f8c48}{make\_key}}(pair);}
\DoxyCodeLine{00093\ \ \ \ \ \};}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structrfl_1_1parsing_1_1_parser}{Parser<R,\ W,\ std::remove\_cvref\_t<ValueType>}},\ ProcessorsType>\mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_ac6517df38e93f77dbc5141cb5c1c8742}{::read}}(}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *\mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_af220c808d8bfddd82cd7c2f3efcf66db}{r\_}},\ \_var)}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ .and\_then(to\_pair);}
\DoxyCodeLine{00097\ \ \ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00101\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{test__broadcast__node_8cpp_a554e63228b946db0d44c4f398b18e212}{R}}*\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_af220c808d8bfddd82cd7c2f3efcf66db}{r\_}};}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00104\ \ \ \mbox{\hyperlink{_tutorial___map__using_8cpp_a07abaf7fcecdbd63813bdb5795a256a1}{MapType}}*\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_a5551d28c53b61f19e258130048d5eb9c}{map\_}};}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00107\ \ \ std::vector<Error>*\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_map_reader_aa382cb7904fff89ed02fe405382d7781}{errors\_}};}
\DoxyCodeLine{00108\ \};}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \}\ \ \textcolor{comment}{//\ namespace\ rfl::parsing}}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
