\doxysection{task\+\_\+dsl.\+hpp}
\hypertarget{task__dsl_8hpp_source}{}\label{task__dsl_8hpp_source}\index{external/taskflow/taskflow/dsl/task\_dsl.hpp@{external/taskflow/taskflow/dsl/task\_dsl.hpp}}
\mbox{\hyperlink{task__dsl_8hpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ 2020/08/28\ -\/\ Created\ by\ netcan:\ https://github.com/netcan}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{flow__builder_8hpp}{../core/flow\_builder.hpp}}"{}}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{meta__macro_8hpp}{meta\_macro.hpp}}"{}}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{task__analyzer_8hpp}{task\_analyzer.hpp}}"{}}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{task__trait_8hpp}{task\_trait.hpp}}"{}}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetf}{tf}}\ \{}
\DoxyCodeLine{00009\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetf_1_1dsl}{dsl}}\ \{}
\DoxyCodeLine{00010\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structtf_1_1dsl_1_1_empty_context}{EmptyContext}}\ \{\};}
\DoxyCodeLine{00011\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ CONTEXT\ =\ \mbox{\hyperlink{structtf_1_1dsl_1_1_empty_context}{EmptyContext}},\ \textcolor{keyword}{typename}...\ Chains>\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_a7ec8bd0e7518f2e95265067ddaad7dd9}{TaskDsl}}\ \{}
\DoxyCodeLine{00012\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_a39e2219ec45b4d16c867d5f943f9ca90}{Links}}\ =\ \mbox{\hyperlink{namespacetf_1_1dsl_a09576ad6e39020850ce8531914ee195d}{Unique\_t<Flatten\_t<TypeList<typename\ Chain<Chains>::type}}...>>>;}
\DoxyCodeLine{00013\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_a5789c11e7a3ce21765d6a6d886b1e25f}{Analyzer}}\ =\ \textcolor{keyword}{typename}\ Links::template\ exportTo<TaskAnalyzer>;}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_ae9fd3ffee6d1389bc6402a64d9dac310}{AllTasks}}\ =\ \textcolor{keyword}{typename}\ Analyzer::AllTasks;}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ TASK>\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structtf_1_1dsl_1_1_task_dsl_1_1_task_cb_with_context}{TaskCbWithContext}}\ \{}
\DoxyCodeLine{00018\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structtf_1_1dsl_1_1_task_dsl_1_1_task_cb_with_context_a914c603c5c8e1bc904c26ccf52316f4c}{type}}\ =\ \mbox{\hyperlink{structtf_1_1dsl_1_1_task_cb}{TaskCb<TASK,\ CONTEXT>}};}
\DoxyCodeLine{00019\ \ \ \};}
\DoxyCodeLine{00020\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_a559464f8aee7a719790b5a198b62d4cb}{TasksCB}}\ =}
\DoxyCodeLine{00021\ \ \ \ \ \ \ \textcolor{keyword}{typename}\ \mbox{\hyperlink{namespacetf_1_1dsl_a3fa11ca485f1f49049558cb2e2e72986}{Map\_t}}<\mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_ae9fd3ffee6d1389bc6402a64d9dac310}{AllTasks}},}
\DoxyCodeLine{00022\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtf_1_1dsl_1_1_task_dsl_1_1_task_cb_with_context}{TaskCbWithContext}}>::template\ exportTo<std::tuple>;}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_a415ae6f0b52878101658590924794003}{OneToOneLinkSet}}\ =\ \textcolor{keyword}{typename}\ Analyzer::OneToOneLinkSet;}
\DoxyCodeLine{00025\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ OneToOneLink>\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structtf_1_1dsl_1_1_task_dsl_1_1_one_to_one_link_instance_type}{OneToOneLinkInstanceType}}\ \{}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{structtf_1_1dsl_1_1_task_dsl_1_1_one_to_one_link_instance_type_afe12ded7e4bb8b3171158afef4056757}{type}}\ =\ \textcolor{keyword}{typename}\ OneToOneLink::template\ InstanceType<TasksCB>;}
\DoxyCodeLine{00027\ \ \ \};}
\DoxyCodeLine{00028\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_af09b2694fc86afdc042b7a577820724a}{OneToOneLinkInstances}}\ =}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \textcolor{keyword}{typename}\ \mbox{\hyperlink{namespacetf_1_1dsl_a3fa11ca485f1f49049558cb2e2e72986}{Map\_t}}<\mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_a415ae6f0b52878101658590924794003}{OneToOneLinkSet}},}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtf_1_1dsl_1_1_task_dsl_1_1_one_to_one_link_instance_type}{OneToOneLinkInstanceType}}>::template\ exportTo<std::tuple>;}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00033\ \ \ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_a7ec8bd0e7518f2e95265067ddaad7dd9}{TaskDsl}}(\mbox{\hyperlink{classtf_1_1_flow_builder}{FlowBuilder}}\ \&flow\_builder,\ \textcolor{keyword}{const}\ CONTEXT\ \&\mbox{\hyperlink{classcontext}{context}}\ =\ \{\})\ \{}
\DoxyCodeLine{00034\ \ \ \ \ \mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_a6268f70f11918bd67d89c64a2af72b16}{build\_tasks\_cb}}(flow\_builder,\ \mbox{\hyperlink{classcontext}{context}},}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::make\_index\_sequence<AllTasks::size>\{\});}
\DoxyCodeLine{00036\ \ \ \ \ \mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_af7440c4498daa10013e712fcfe30ef49}{build\_links}}(std::make\_index\_sequence<OneToOneLinkSet::size>\{\});}
\DoxyCodeLine{00037\ \ \ \}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ TASK>\ \mbox{\hyperlink{classtf_1_1_task}{Task}}\ \&\mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_afba86ce83e29846895950223eeea4dd8}{get\_task}}()\ \{}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{size\_t}\ TasksCBSize\ =\ std::tuple\_size<TasksCB>::value;}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{size\_t}\ TaskIndex\ =}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetf_1_1dsl_a510d682f2ec4114b0c68afb61e5f5084}{TupleElementByF\_v<TasksCB,\ IsTask<TASK>::template}}\ apply>;}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{keyword}{static\_assert}(TaskIndex\ <\ TasksCBSize,\ \textcolor{stringliteral}{"{}fatal:\ not\ find\ TaskCb\ in\ TasksCB"{}});}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacestd_aae41d8280b7ccc3f0e0a0be2dab21c8f}{std::get<TaskIndex>}}(\mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_a496178fa255254d6e4174cb632bea4ce}{tasksCb\_}}).task\_;}
\DoxyCodeLine{00045\ \ \ \}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00048\ \ \ \textcolor{keyword}{template}\ <\textcolor{keywordtype}{size\_t}...\ Is>}
\DoxyCodeLine{00049\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_a6268f70f11918bd67d89c64a2af72b16}{build\_tasks\_cb}}(\mbox{\hyperlink{classtf_1_1_flow_builder}{FlowBuilder}}\ \&flow\_builder,\ \textcolor{keyword}{const}\ CONTEXT\ \&\mbox{\hyperlink{classcontext}{context}},}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::index\_sequence<Is...>)\ \{}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keyword}{auto}\ \_\ =\ \{0,\ (\mbox{\hyperlink{namespacestd_aae41d8280b7ccc3f0e0a0be2dab21c8f}{std::get<Is>}}(\mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_a496178fa255254d6e4174cb632bea4ce}{tasksCb\_}}).build(flow\_builder,\ \mbox{\hyperlink{classcontext}{context}}),\ 0)...\};}
\DoxyCodeLine{00052\ \ \ \ \ (\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}})\_;}
\DoxyCodeLine{00053\ \ \ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \textcolor{keyword}{template}\ <\textcolor{keywordtype}{size\_t}...\ Is>\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_af7440c4498daa10013e712fcfe30ef49}{build\_links}}(std::index\_sequence<Is...>)\ \{}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keyword}{auto}\ \_\ =\ \{0,\ (\mbox{\hyperlink{namespacestd_aae41d8280b7ccc3f0e0a0be2dab21c8f}{std::get<Is>}}(\mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_a147e58a41517cb7f0eb9bdd283946bc5}{links\_}}).build(\mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_a496178fa255254d6e4174cb632bea4ce}{tasksCb\_}}),\ 0)...\};}
\DoxyCodeLine{00057\ \ \ \ \ (\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}})\_;}
\DoxyCodeLine{00058\ \ \ \}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00061\ \ \ \mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_a559464f8aee7a719790b5a198b62d4cb}{TasksCB}}\ \mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_a496178fa255254d6e4174cb632bea4ce}{tasksCb\_}};}
\DoxyCodeLine{00062\ \ \ \mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_af09b2694fc86afdc042b7a577820724a}{OneToOneLinkInstances}}\ \mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl_a147e58a41517cb7f0eb9bdd283946bc5}{links\_}};}
\DoxyCodeLine{00063\ \};}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ =\ \mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}},\ \textcolor{keyword}{typename}...\ Chains,\ \textcolor{keyword}{typename}\ CONTEXT\ =\ \mbox{\hyperlink{structtf_1_1dsl_1_1_empty_context}{EmptyContext}}>}
\DoxyCodeLine{00066\ \textcolor{keyword}{constexpr}\ \mbox{\hyperlink{classtf_1_1dsl_1_1_task_dsl}{TaskDsl}}<CONTEXT,\ Chains...>\ \mbox{\hyperlink{namespacetf_1_1dsl_a91acb57fea20e16dfbbaad466dc0ac7b}{taskDsl}}(\mbox{\hyperlink{classtf_1_1_flow_builder}{FlowBuilder}}\ \&flow\_builder,}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CONTEXT\ \&\&\mbox{\hyperlink{classcontext}{context}}\ =\ \{\})\ \{}
\DoxyCodeLine{00068\ \ \ \textcolor{keywordflow}{return}\ \{flow\_builder,\ \mbox{\hyperlink{classcontext}{context}}\};}
\DoxyCodeLine{00069\ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \}\ \textcolor{comment}{//\ namespace\ dsl}}
\DoxyCodeLine{00072\ \}\ \textcolor{comment}{//\ namespace\ tf}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00075\ \textcolor{preprocessor}{\#define\ TF\_CHAIN(link)\ ,\ link-\/>void}}
\DoxyCodeLine{00076\ \textcolor{preprocessor}{\#define\ TF\_CONTEXT\_1(name)\ tf::dsl::EmptyContext}}
\DoxyCodeLine{00077\ \textcolor{preprocessor}{\#define\ TF\_CONTEXT\_2(name,\ context)\ context}}
\DoxyCodeLine{00078\ \textcolor{preprocessor}{\#define\ TF\_CAPTURE\_THIS\_1}}
\DoxyCodeLine{00079\ \textcolor{preprocessor}{\#define\ TF\_CAPTURE\_THIS\_2\ *this}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00082\ \textcolor{comment}{//\ make\_task(TASK\_NAME,\ \{\ return\ a\ action\ lambda\ \})}}
\DoxyCodeLine{00083\ \textcolor{preprocessor}{\#define\ make\_task(name,\ ...)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00084\ \textcolor{preprocessor}{\ \ struct\ TF\_GET\_FIRST\ name\ :\ tf::dsl::TaskSignature,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00085\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ TF\_PASTE(TF\_CONTEXT\_,\ TF\_GET\_ARG\_COUNT\ name)\ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00086\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ name\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00087\ \textcolor{preprocessor}{\ \ \ \ using\ \_ContextType\ =\ TF\_PASTE(TF\_CONTEXT\_,\ TF\_GET\_ARG\_COUNT\ name)\ name;\ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00088\ \textcolor{preprocessor}{\ \ \ \ TF\_GET\_FIRST\ name(const\ \_ContextType\ \&context)\ :\ \_ContextType(context)\ \{\}\ \ \(\backslash\)}}
\DoxyCodeLine{00089\ \textcolor{preprocessor}{\ \ \ \ auto\ operator()()\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00090\ \textcolor{preprocessor}{\ \ \ \ \ \ return\ [TF\_PASTE(TF\_CAPTURE\_THIS\_,\ TF\_GET\_ARG\_COUNT\ name)]\ \_\_VA\_ARGS\_\_;\ \ \(\backslash\)}}
\DoxyCodeLine{00091\ \textcolor{preprocessor}{\ \ \ \ \}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00092\ \textcolor{preprocessor}{\ \ \}}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \textcolor{comment}{//\ some\_tasks(A,\ B,\ C)\ means\ SomeTask}}
\DoxyCodeLine{00095\ \textcolor{preprocessor}{\#define\ some\_tasks(...)\ auto\ (*)(tf::dsl::SomeTask<\_\_VA\_ARGS\_\_>)}}
\DoxyCodeLine{00096\ \textcolor{comment}{//\ same\ as\ some\_tasks}}
\DoxyCodeLine{00097\ \textcolor{preprocessor}{\#define\ fork\_tasks(...)\ some\_tasks(\_\_VA\_ARGS\_\_)}}
\DoxyCodeLine{00098\ \textcolor{comment}{//\ same\ as\ some\_tasks}}
\DoxyCodeLine{00099\ \textcolor{preprocessor}{\#define\ merge\_tasks(...)\ some\_tasks(\_\_VA\_ARGS\_\_)}}
\DoxyCodeLine{00100\ \textcolor{comment}{//\ task(A)\ means\ a\ task\ A}}
\DoxyCodeLine{00101\ \textcolor{preprocessor}{\#define\ task(Task)\ auto\ (*)(Task)}}
\DoxyCodeLine{00102\ \textcolor{comment}{//\ taskbuild(...)\ build\ a\ task\ dsl\ graph}}
\DoxyCodeLine{00103\ \textcolor{preprocessor}{\#define\ build\_taskflow(...)\ tf::dsl::taskDsl<void\ TF\_MAP(TF\_CHAIN,\ \_\_VA\_ARGS\_\_)>}}
\DoxyCodeLine{00104\ }

\end{DoxyCode}
