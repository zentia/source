\doxysection{ff\+\_\+dsender\+MPI.\+hpp}
\hypertarget{ff__dsender_m_p_i_8hpp_source}{}\label{ff__dsender_m_p_i_8hpp_source}\index{external/taskflow/3rd-\/party/ff/distributed/ff\_dsenderMPI.hpp@{external/taskflow/3rd-\/party/ff/distributed/ff\_dsenderMPI.hpp}}
\mbox{\hyperlink{ff__dsender_m_p_i_8hpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ FF\_DSENDER\_MPI\_H}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ FF\_DSENDER\_MPI\_H}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <map>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{ff_8hpp}{ff/ff.hpp}}>}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{ff__network_8hpp}{ff/distributed/ff\_network.hpp}}>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <sys/types.h>}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <netdb.h>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <cmath>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <thread>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <mpi.h>}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <cereal/cereal.hpp>}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <cereal/archives/portable\_binary.hpp>}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ <cereal/types/vector.hpp>}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ <cereal/types/polymorphic.hpp>}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespaceff}{ff}};}
\DoxyCodeLine{00020\ \textcolor{keyword}{using\ }\mbox{\hyperlink{ff__dsender_8hpp_a2bf91bcabbf423fc5c27cd19b199d6e9}{precomputedRT\_t}}\ =\ std::map<std::string,\ std::pair<std::vector<int>,\ \mbox{\hyperlink{ff__network_8hpp_a19a96edeeb9d37072c4ce9f862d19ba8}{ChannelType}}>>;}
\DoxyCodeLine{00021\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classff__dsender_m_p_i_ab813381b8878c75591f0a6779d445efb}{ff\_dsenderMPI}}:\ \textcolor{keyword}{public}\ \mbox{\hyperlink{structff_1_1ff__minode__t_a0f826e91746af74bdd91a84651f087b8}{ff\_minode\_t}}<message\_t>\ \{\ }
\DoxyCodeLine{00022\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a87cec066c4e3c07033a2a5db9bbae195}{batchBuffer}}\ \{}
\DoxyCodeLine{00024\ \ \ \ \ \textcolor{keyword}{protected}:\ \ \ \ }
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_ab1ab672fa2a9bf7cde92ca4cdc932283}{rank}};}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a414fe6388c5162a0592efc06f357286b}{blocked}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a36623e627b60018db6d263f45049fdc4}{size\_}},\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a2a98293ff2d31805abe08190a60bf17c}{actualSize}}\ =\ 0;}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ std::vector<char>\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a1d91f6a9df31d194d126b18e7c6bb5f3}{buffer}};}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ std::vector<long>\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a026a25bbfeb3b5baeb2e5fd5d5826394}{headers}};}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ MPI\_Request\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a301b3574e628c6e8d8a5543bb4940d61}{headersR}},\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a5f94d39ada1d7c9aed346de7b6a78004}{datasR}};}
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a87cec066c4e3c07033a2a5db9bbae195}{batchBuffer}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a36623e627b60018db6d263f45049fdc4}{size\_}},\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_ab1ab672fa2a9bf7cde92ca4cdc932283}{rank}})\ :\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_ab1ab672fa2a9bf7cde92ca4cdc932283}{rank}}(\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_ab1ab672fa2a9bf7cde92ca4cdc932283}{rank}}),\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a36623e627b60018db6d263f45049fdc4}{size\_}}(\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a36623e627b60018db6d263f45049fdc4}{size\_}})\{}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a026a25bbfeb3b5baeb2e5fd5d5826394}{headers}}.reserve(\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a36623e627b60018db6d263f45049fdc4}{size\_}}*3+1);}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a3c9a908c8c3c4190ca33da6c2f1639a6}{waitCompletion}}()\{}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a414fe6388c5162a0592efc06f357286b}{blocked}})\{}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Wait(\&\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a301b3574e628c6e8d8a5543bb4940d61}{headersR}},\ MPI\_STATUS\_IGNORE);}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Wait(\&\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a5f94d39ada1d7c9aed346de7b6a78004}{datasR}},\ MPI\_STATUS\_IGNORE);}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a026a25bbfeb3b5baeb2e5fd5d5826394}{headers}}.clear();}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a1d91f6a9df31d194d126b18e7c6bb5f3}{buffer}}.clear();}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a414fe6388c5162a0592efc06f357286b}{blocked}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a4443cd697ed671a89ef627c9e6a3cc17}{size}}()\ \{\textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a2a98293ff2d31805abe08190a60bf17c}{actualSize}};\}}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_aa9e6d378422d434ff5b845acd67fafea}{push}}(\mbox{\hyperlink{structmessage__t}{message\_t}}*\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}})\{}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a3c9a908c8c3c4190ca33da6c2f1639a6}{waitCompletion}}();}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idx\ =\ 3*\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a2a98293ff2d31805abe08190a60bf17c}{actualSize}}++;}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a026a25bbfeb3b5baeb2e5fd5d5826394}{headers}}[idx+1]\ =\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>sender;}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a026a25bbfeb3b5baeb2e5fd5d5826394}{headers}}[idx+2]\ =\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>chid;}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a026a25bbfeb3b5baeb2e5fd5d5826394}{headers}}[idx+3]\ =\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>data.getLen();}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a1d91f6a9df31d194d126b18e7c6bb5f3}{buffer}}.insert(\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a1d91f6a9df31d194d126b18e7c6bb5f3}{buffer}}.end(),\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>data.getPtr(),\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>data.getPtr()\ +\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>data.getLen());}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}};}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a2a98293ff2d31805abe08190a60bf17c}{actualSize}}\ ==\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a36623e627b60018db6d263f45049fdc4}{size\_}})\ \{}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ this-\/>\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_afd727558b18e86db07643e493fd099cd}{flush}}();}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_afd727558b18e86db07643e493fd099cd}{flush}}()\{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ headers[0]\ =\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a2a98293ff2d31805abe08190a60bf17c}{actualSize}};}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Isend(\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a026a25bbfeb3b5baeb2e5fd5d5826394}{headers}}.data(),\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a2a98293ff2d31805abe08190a60bf17c}{actualSize}}*3+1,\ MPI\_LONG,\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_ab1ab672fa2a9bf7cde92ca4cdc932283}{rank}},\ DFF\_HEADER\_TAG,\ MPI\_COMM\_WORLD,\ \&\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a301b3574e628c6e8d8a5543bb4940d61}{headersR}});}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Isend(\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a1d91f6a9df31d194d126b18e7c6bb5f3}{buffer}}.data(),\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a1d91f6a9df31d194d126b18e7c6bb5f3}{buffer}}.size(),\ MPI\_BYTE,\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_ab1ab672fa2a9bf7cde92ca4cdc932283}{rank}},\ DFF\_TASK\_TAG,\ MPI\_COMM\_WORLD,\ \&\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a5f94d39ada1d7c9aed346de7b6a78004}{datasR}});}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a414fe6388c5162a0592efc06f357286b}{blocked}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a2a98293ff2d31805abe08190a60bf17c}{actualSize}}\ =\ 0;}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_afaf192eb0f0f049d7136d2a8df767928}{pushEOS}}()\{}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idx\ =\ 3*\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a2a98293ff2d31805abe08190a60bf17c}{actualSize}}++;}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a026a25bbfeb3b5baeb2e5fd5d5826394}{headers}}[idx+1]\ =\ 0;\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a026a25bbfeb3b5baeb2e5fd5d5826394}{headers}}[idx+2]\ =\ 0;\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a026a25bbfeb3b5baeb2e5fd5d5826394}{headers}}[idx+3]\ =\ 0;}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ this-\/>\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_afd727558b18e86db07643e493fd099cd}{flush}}();}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00077\ \ \ \ \ \};}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_a95ee470d26caede24914a823271e8e14}{directBatchBuffer}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a87cec066c4e3c07033a2a5db9bbae195}{batchBuffer}}\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structmessage__t}{message\_t}}*\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_a56bb11e00b0d8f450e590373e4d3e1df}{currData}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_a21d35c8035c1b24467ae36eb278baaf9}{currHeader}}[4]\ =\ \{1,\ 0,\ 0,\ 0\};\ }
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_a95ee470d26caede24914a823271e8e14}{directBatchBuffer}}(\textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_ab1ab672fa2a9bf7cde92ca4cdc932283}{rank}})\ :\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a87cec066c4e3c07033a2a5db9bbae195}{batchBuffer}}(0,\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_ab1ab672fa2a9bf7cde92ca4cdc932283}{rank}})\{\}}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_ad85c0a06340be43bd0272e21d392a69c}{pushEOS}}()\{}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_ad7e2212d52eeb77e0a668458908cacfc}{waitCompletion}}();}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_a21d35c8035c1b24467ae36eb278baaf9}{currHeader}}[1]\ =\ 0;\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_a21d35c8035c1b24467ae36eb278baaf9}{currHeader}}[2]\ =\ 0;\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_a21d35c8035c1b24467ae36eb278baaf9}{currHeader}}[3]\ =\ 0;}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Send(\mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_a21d35c8035c1b24467ae36eb278baaf9}{currHeader}},\ 4,\ MPI\_LONG,\ this-\/>\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_ab1ab672fa2a9bf7cde92ca4cdc932283}{rank}},\ DFF\_HEADER\_TAG,\ MPI\_COMM\_WORLD);}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_a5353f325fc70756254dfe1bce8edecec}{flush}}()\ \{\}}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_ad7e2212d52eeb77e0a668458908cacfc}{waitCompletion}}()\{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a414fe6388c5162a0592efc06f357286b}{blocked}})\{}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Wait(\&\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a301b3574e628c6e8d8a5543bb4940d61}{headersR}},\ MPI\_STATUS\_IGNORE);}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_a56bb11e00b0d8f450e590373e4d3e1df}{currData}}-\/>data.getLen()\ >\ 0)}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Wait(\&\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a5f94d39ada1d7c9aed346de7b6a78004}{datasR}},\ MPI\_STATUS\_IGNORE);}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_a56bb11e00b0d8f450e590373e4d3e1df}{currData}})\ \textcolor{keyword}{delete}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_a56bb11e00b0d8f450e590373e4d3e1df}{currData}};}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a414fe6388c5162a0592efc06f357286b}{blocked}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_af9171bf87d0f755f82eaf04699124809}{push}}(\mbox{\hyperlink{structmessage__t}{message\_t}}*\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}})\{}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_ad7e2212d52eeb77e0a668458908cacfc}{waitCompletion}}();}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_a21d35c8035c1b24467ae36eb278baaf9}{currHeader}}[1]\ =\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>sender;\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_a21d35c8035c1b24467ae36eb278baaf9}{currHeader}}[2]\ =\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>chid;\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_a21d35c8035c1b24467ae36eb278baaf9}{currHeader}}[3]\ =\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>data.getLen();}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Isend(\mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_a21d35c8035c1b24467ae36eb278baaf9}{currHeader}},\ 4,\ MPI\_LONG,\ this-\/>\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_ab1ab672fa2a9bf7cde92ca4cdc932283}{rank}},\ DFF\_HEADER\_TAG,\ MPI\_COMM\_WORLD,\ \&this-\/>\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a301b3574e628c6e8d8a5543bb4940d61}{headersR}});}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>data.getLen()\ >\ 0)}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MPI\_Isend(\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>data.getPtr(),\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>data.getLen(),\ MPI\_BYTE,\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_ab1ab672fa2a9bf7cde92ca4cdc932283}{rank}},\ DFF\_TASK\_TAG,\ MPI\_COMM\_WORLD,\ \&\mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a5f94d39ada1d7c9aed346de7b6a78004}{datasR}});}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer_a56bb11e00b0d8f450e590373e4d3e1df}{currData}}\ =\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}};}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer_a414fe6388c5162a0592efc06f357286b}{blocked}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00109\ \ \ \ \ \};}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classff__dsender_m_p_i_a3a878aeeb10eb475d3cb4ba4597c02df}{neos}}=0;}
\DoxyCodeLine{00111\ \ \ \ \ \mbox{\hyperlink{ff__dsender_m_p_i_8hpp_a2bf91bcabbf423fc5c27cd19b199d6e9}{precomputedRT\_t}}*\ \mbox{\hyperlink{classff__dsender_m_p_i_a54bb8124eee49b9fc7946ee157605b1d}{rt}};}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_aecf1520d53969e1bbee470b85531f1c1}{last\_rr\_rank}}\ =\ 0;\ \textcolor{comment}{//next\ destiation\ to\ send\ for\ round\ robin\ policy}}
\DoxyCodeLine{00113\ \ \ \ \ std::map<std::pair<int,\ ChannelType>,\ \textcolor{keywordtype}{int}>\ \mbox{\hyperlink{classff__dsender_m_p_i_a27fae59ea2921823590f527714a5083e}{dest2Rank}};}
\DoxyCodeLine{00114\ \ \ \ \ std::map<int,\ std::pair<int,\ std::vector<batchBuffer*>>>\ \mbox{\hyperlink{classff__dsender_m_p_i_a670d4ef16f3e708d731275091ad32ba2}{buffers}};}
\DoxyCodeLine{00115\ \ \ \ \ std::vector<std::pair<int,\ ChannelType>>\ \mbox{\hyperlink{classff__dsender_m_p_i_a736a637c36714c8a00b18523e6b01e60}{ranks}};}
\DoxyCodeLine{00116\ \ \ \ \ std::vector<std::pair<ChannelType,\ ff\_endpoint>>\ \mbox{\hyperlink{classff__dsender_m_p_i_a0767ccaaa33464c2cf738e424ec510a2}{destRanks}};}
\DoxyCodeLine{00117\ \ \ \ \ std::string\ \mbox{\hyperlink{classff__dsender_m_p_i_a0841679ca35bed4b90bf945495023fb2}{gName}};}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_a2fd72eeb35b2849d161f29d9e616b7be}{batchSize}};}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_a9a742801cac95f2b1ef704f19b76f02a}{messageOTF}};}
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_a3eaf6d5305d0269b9ec28766b618dfb8}{coreid}};}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_ad5306744ea037c59493b5d801b25fb70}{handshakeHandler}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}},\ \mbox{\hyperlink{ff__network_8hpp_a19a96edeeb9d37072c4ce9f862d19ba8}{ChannelType}}\ ct)\{}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ MPI\_Send(\mbox{\hyperlink{classff__dsender_m_p_i_a0841679ca35bed4b90bf945495023fb2}{gName}}.c\_str(),\ \mbox{\hyperlink{classff__dsender_m_p_i_a0841679ca35bed4b90bf945495023fb2}{gName}}.size(),\ MPI\_BYTE,\ \mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}},\ DFF\_GROUP\_NAME\_TAG,\ MPI\_COMM\_WORLD);}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ MPI\_Send(\&ct,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{ff__network_8hpp_a19a96edeeb9d37072c4ce9f862d19ba8}{ChannelType}}),\ MPI\_BYTE,\ \mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}},\ DFF\_CHANNEL\_TYPE\_TAG,\ MPI\_COMM\_WORLD);}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00126\ \ \ \ \ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_a44c74a5dd8576b1206f5976c1e71c43f}{getMostFilledBufferRank}}(\textcolor{keywordtype}{bool}\ feedback)\{}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ rankMax\ =\ -\/1;}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ sizeMax\ =\ 0;}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\&\ [\mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}},ct]\ :\ \mbox{\hyperlink{classff__dsender_m_p_i_a736a637c36714c8a00b18523e6b01e60}{ranks}})\{}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((feedback\ \&\&\ ct\ !=\ \mbox{\hyperlink{ff__network_8hpp_a19a96edeeb9d37072c4ce9f862d19ba8ac53d16911739e991ff812058af14979c}{ChannelType::FBK}})\ ||\ (!feedback\ \&\&\ ct\ !=\ \mbox{\hyperlink{ff__network_8hpp_a19a96edeeb9d37072c4ce9f862d19ba8a7e34b7ae523ac22114cdb965ee8db601}{ChannelType::FWD}}))\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ batchBB\ =\ \mbox{\hyperlink{classff__dsender_m_p_i_a670d4ef16f3e708d731275091ad32ba2}{buffers}}[\mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}}];}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ sz\ =\ batchBB.second[batchBB.first]-\/>size();}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (sz\ >\ sizeMax)\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rankMax\ =\ \mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}};}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sizeMax\ =\ sz;}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (rankMax\ >=\ 0)\ \textcolor{keywordflow}{return}\ rankMax;}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_aecf1520d53969e1bbee470b85531f1c1}{last\_rr\_rank}}\ =\ (\mbox{\hyperlink{classff__dsender_m_p_i_aecf1520d53969e1bbee470b85531f1c1}{last\_rr\_rank}}\ +\ 1)\ \%\ this-\/>ranks.size();}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ (this-\/>ranks[\mbox{\hyperlink{classff__dsender_m_p_i_aecf1520d53969e1bbee470b85531f1c1}{last\_rr\_rank}}].\mbox{\hyperlink{second___n_o_n_e_8f_ae9f971a8b343bd2fcb85c3b16da97f10}{second}}\ !=\ (feedback\ ?\ \mbox{\hyperlink{ff__network_8hpp_a19a96edeeb9d37072c4ce9f862d19ba8ac53d16911739e991ff812058af14979c}{ChannelType::FBK}}\ :\ \mbox{\hyperlink{ff__network_8hpp_a19a96edeeb9d37072c4ce9f862d19ba8a7e34b7ae523ac22114cdb965ee8db601}{ChannelType::FWD}}));}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ this-\/>ranks[\mbox{\hyperlink{classff__dsender_m_p_i_aecf1520d53969e1bbee470b85531f1c1}{last\_rr\_rank}}].first;\ }
\DoxyCodeLine{00146\ \ \ \ \ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00149\ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_ab813381b8878c75591f0a6779d445efb}{ff\_dsenderMPI}}(std::pair<ChannelType,\ ff\_endpoint>\ destRank,\ \mbox{\hyperlink{ff__dsender_m_p_i_8hpp_a2bf91bcabbf423fc5c27cd19b199d6e9}{precomputedRT\_t}}*\ \mbox{\hyperlink{classff__dsender_m_p_i_a54bb8124eee49b9fc7946ee157605b1d}{rt}},\ std::string\ \mbox{\hyperlink{classff__dsender_m_p_i_a0841679ca35bed4b90bf945495023fb2}{gName}}\ =\ \textcolor{stringliteral}{"{}"{}},\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_a2fd72eeb35b2849d161f29d9e616b7be}{batchSize}}\ =\ \mbox{\hyperlink{dff_8hpp_a123fa013ecd2c91686ad58c0b8d985b3}{DEFAULT\_BATCH\_SIZE}},\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_a9a742801cac95f2b1ef704f19b76f02a}{messageOTF}}\ =\ \mbox{\hyperlink{dff_8hpp_a98084099edfbe21df8ff5a1f89c26700}{DEFAULT\_MESSAGE\_OTF}},\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_a3eaf6d5305d0269b9ec28766b618dfb8}{coreid}}=-\/1)}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classff__dsender_m_p_i_a54bb8124eee49b9fc7946ee157605b1d}{rt}}(\mbox{\hyperlink{classff__dsender_m_p_i_a54bb8124eee49b9fc7946ee157605b1d}{rt}}),\ \mbox{\hyperlink{classff__dsender_m_p_i_a0841679ca35bed4b90bf945495023fb2}{gName}}(\mbox{\hyperlink{classff__dsender_m_p_i_a0841679ca35bed4b90bf945495023fb2}{gName}}),\ \mbox{\hyperlink{classff__dsender_m_p_i_a2fd72eeb35b2849d161f29d9e616b7be}{batchSize}}(\mbox{\hyperlink{classff__dsender_m_p_i_a2fd72eeb35b2849d161f29d9e616b7be}{batchSize}}),\ \mbox{\hyperlink{classff__dsender_m_p_i_a9a742801cac95f2b1ef704f19b76f02a}{messageOTF}}(\mbox{\hyperlink{classff__dsender_m_p_i_a9a742801cac95f2b1ef704f19b76f02a}{messageOTF}}),\ \mbox{\hyperlink{classff__dsender_m_p_i_a3eaf6d5305d0269b9ec28766b618dfb8}{coreid}}(\mbox{\hyperlink{classff__dsender_m_p_i_a3eaf6d5305d0269b9ec28766b618dfb8}{coreid}})\ \{}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ this-\/>destRanks.push\_back(std::move(destRank));}
\DoxyCodeLine{00152\ \ \ \ \ \}}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_a7da3297b08fad23f29fd91ffbf9624ab}{ff\_dsenderMPI}}(\ std::vector<std::pair<ChannelType,\ ff\_endpoint>>\ destRanks\_,\ \mbox{\hyperlink{ff__dsender_m_p_i_8hpp_a2bf91bcabbf423fc5c27cd19b199d6e9}{precomputedRT\_t}}*\ \mbox{\hyperlink{classff__dsender_m_p_i_a54bb8124eee49b9fc7946ee157605b1d}{rt}},\ std::string\ \mbox{\hyperlink{classff__dsender_m_p_i_a0841679ca35bed4b90bf945495023fb2}{gName}}\ =\ \textcolor{stringliteral}{"{}"{}},\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_a2fd72eeb35b2849d161f29d9e616b7be}{batchSize}}\ =\ \mbox{\hyperlink{dff_8hpp_a123fa013ecd2c91686ad58c0b8d985b3}{DEFAULT\_BATCH\_SIZE}},\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_a9a742801cac95f2b1ef704f19b76f02a}{messageOTF}}\ =\ \mbox{\hyperlink{dff_8hpp_a98084099edfbe21df8ff5a1f89c26700}{DEFAULT\_MESSAGE\_OTF}},\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_a3eaf6d5305d0269b9ec28766b618dfb8}{coreid}}=-\/1)}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classff__dsender_m_p_i_a54bb8124eee49b9fc7946ee157605b1d}{rt}}(\mbox{\hyperlink{classff__dsender_m_p_i_a54bb8124eee49b9fc7946ee157605b1d}{rt}}),\ \mbox{\hyperlink{classff__dsender_m_p_i_a0767ccaaa33464c2cf738e424ec510a2}{destRanks}}(\mbox{\hyperlink{namespacestd}{std}}::move(destRanks\_)),\ \mbox{\hyperlink{classff__dsender_m_p_i_a0841679ca35bed4b90bf945495023fb2}{gName}}(\mbox{\hyperlink{classff__dsender_m_p_i_a0841679ca35bed4b90bf945495023fb2}{gName}}),\ \mbox{\hyperlink{classff__dsender_m_p_i_a2fd72eeb35b2849d161f29d9e616b7be}{batchSize}}(\mbox{\hyperlink{classff__dsender_m_p_i_a2fd72eeb35b2849d161f29d9e616b7be}{batchSize}}),\ \mbox{\hyperlink{classff__dsender_m_p_i_a9a742801cac95f2b1ef704f19b76f02a}{messageOTF}}(\mbox{\hyperlink{classff__dsender_m_p_i_a9a742801cac95f2b1ef704f19b76f02a}{messageOTF}}),\ \mbox{\hyperlink{classff__dsender_m_p_i_a3eaf6d5305d0269b9ec28766b618dfb8}{coreid}}(\mbox{\hyperlink{classff__dsender_m_p_i_a3eaf6d5305d0269b9ec28766b618dfb8}{coreid}})\ \{\}}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_acf29ef936ac188461e4fec7a8f13d25b}{svc\_init}}()\ \{}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff__dsender_m_p_i_a3eaf6d5305d0269b9ec28766b618dfb8}{coreid}}!=-\/1)}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mapping__utils_8hpp_a55cc056711b4071b978f875d18914b44}{ff\_mapThreadToCpu}}(\mbox{\hyperlink{classff__dsender_m_p_i_a3eaf6d5305d0269b9ec28766b618dfb8}{coreid}});}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\&\ [ct,\ \mbox{\hyperlink{_json_8c_a00793ba086b417bb3d75ab79af8c83fb}{ep}}]:\ this-\/>destRanks)\{}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_ad5306744ea037c59493b5d801b25fb70}{handshakeHandler}}(\mbox{\hyperlink{_json_8c_a00793ba086b417bb3d75ab79af8c83fb}{ep}}.getRank(),\ ct);}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_a736a637c36714c8a00b18523e6b01e60}{ranks}}.push\_back(\{\mbox{\hyperlink{_json_8c_a00793ba086b417bb3d75ab79af8c83fb}{ep}}.getRank(),\ ct\});}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ \ \ std::vector<batchBuffer*>\ appo;}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ \mbox{\hyperlink{classff__dsender_m_p_i_a9a742801cac95f2b1ef704f19b76f02a}{messageOTF}};\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}++)\ appo.push\_back(\mbox{\hyperlink{classff__dsender_m_p_i_a2fd72eeb35b2849d161f29d9e616b7be}{batchSize}}\ ==\ 1\ ?\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer}{directBatchBuffer}}(\mbox{\hyperlink{_json_8c_a00793ba086b417bb3d75ab79af8c83fb}{ep}}.getRank())\ :\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer}{batchBuffer}}(\mbox{\hyperlink{classff__dsender_m_p_i_a2fd72eeb35b2849d161f29d9e616b7be}{batchSize}},\ \mbox{\hyperlink{_json_8c_a00793ba086b417bb3d75ab79af8c83fb}{ep}}.getRank()));}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_a670d4ef16f3e708d731275091ad32ba2}{buffers}}.emplace(std::make\_pair(\mbox{\hyperlink{_json_8c_a00793ba086b417bb3d75ab79af8c83fb}{ep}}.getRank(),\ std::make\_pair(0,\ std::move(appo))));}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ dest\ :\ \mbox{\hyperlink{classff__dsender_m_p_i_a54bb8124eee49b9fc7946ee157605b1d}{rt}}-\/>operator[](\mbox{\hyperlink{_json_8c_a00793ba086b417bb3d75ab79af8c83fb}{ep}}.groupName).first)}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_a27fae59ea2921823590f527714a5083e}{dest2Rank}}[std::make\_pair(dest,\ ct)]\ =\ \mbox{\hyperlink{_json_8c_a00793ba086b417bb3d75ab79af8c83fb}{ep}}.getRank();}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ this-\/>destRanks.clear();}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00175\ \ \ \ \ \}}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff__dsender_m_p_i_a1efe17a79756bbc3b08085883e32fa94}{svc\_end}}()\{}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\&\ [\mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}},\ bb]\ :\ \mbox{\hyperlink{classff__dsender_m_p_i_a670d4ef16f3e708d731275091ad32ba2}{buffers}})}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\&\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ :\ bb.second)\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}-\/>waitCompletion();}
\DoxyCodeLine{00180\ \ \ \ \ \}}
\DoxyCodeLine{00181\ \ \ }
\DoxyCodeLine{00182\ \ \ \ \ \mbox{\hyperlink{structmessage__t}{message\_t}}\ *\mbox{\hyperlink{classff__dsender_m_p_i_af75da69139caa46d63dc022edbb047c2}{svc}}(\mbox{\hyperlink{structmessage__t}{message\_t}}*\ task)\ \{}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}};}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (task-\/>chid\ !=\ -\/1)}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}}\ =\ \mbox{\hyperlink{classff__dsender_m_p_i_a27fae59ea2921823590f527714a5083e}{dest2Rank}}[\{task-\/>chid,\ task-\/>feedback\ ?\ \mbox{\hyperlink{ff__network_8hpp_a19a96edeeb9d37072c4ce9f862d19ba8ac53d16911739e991ff812058af14979c}{ChannelType::FBK}}\ :\ \mbox{\hyperlink{ff__network_8hpp_a19a96edeeb9d37072c4ce9f862d19ba8a7e34b7ae523ac22114cdb965ee8db601}{ChannelType::FWD}}\}];\ }
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ }
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}}\ =\ \mbox{\hyperlink{classff__dsender_m_p_i_a44c74a5dd8576b1206f5976c1e71c43f}{getMostFilledBufferRank}}(task-\/>feedback);}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ buffs\ =\ \mbox{\hyperlink{classff__dsender_m_p_i_a670d4ef16f3e708d731275091ad32ba2}{buffers}}[\mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}}];}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ assert(buffs.second.size()\ >\ 0);}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (buffs.second[buffs.first]-\/>push(task))\ \textcolor{comment}{//\ the\ push\ triggered\ a\ flush,\ so\ we\ must\ go\ ion\ the\ next\ buffer}}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ buffs.first\ =\ (buffs.first\ +\ 1)\ \%\ buffs.second.size();\ \textcolor{comment}{//\ increment\ the\ used\ buffer\ of\ 1}}
\DoxyCodeLine{00193\ \ \ \ \ }
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ this-\/>\mbox{\hyperlink{structff_1_1ff__minode__t_aafe87b1772b455605c8c3aa23048c28f}{GO\_ON}};}
\DoxyCodeLine{00195\ \ \ \ \ \}}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff__dsender_m_p_i_a5b481f334111b4aadfb32ec8d1ebd7cb}{eosnotify}}(\mbox{\hyperlink{eabase_8h_a831c6b6852c6d34448e30a88c34539fd}{ssize\_t}}\ \textcolor{keywordtype}{id})\ \{}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ [\mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}},\ \_]\ :\ \mbox{\hyperlink{classff__dsender_m_p_i_a736a637c36714c8a00b18523e6b01e60}{ranks}})\{}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ buffs\ =\ \mbox{\hyperlink{classff__dsender_m_p_i_a670d4ef16f3e708d731275091ad32ba2}{buffers}}[\mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}}];}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ buffs.second[buffs.first]-\/>push(\textcolor{keyword}{new}\ \mbox{\hyperlink{structmessage__t}{message\_t}}(\textcolor{keywordtype}{id},\ -\/2));}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (++\mbox{\hyperlink{classff__dsender_m_p_i_a3a878aeeb10eb475d3cb4ba4597c02df}{neos}}\ >=\ this-\/>\mbox{\hyperlink{classff_1_1ff__minode_a1f4076371d457755d18579bb0990a70d}{get\_num\_inchannels}}())}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\&\ [\mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}},\ ct]\ :\ \mbox{\hyperlink{classff__dsender_m_p_i_a736a637c36714c8a00b18523e6b01e60}{ranks}})\{}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ buffs\ =\ \mbox{\hyperlink{classff__dsender_m_p_i_a670d4ef16f3e708d731275091ad32ba2}{buffers}}[\mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}}];}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ buffs.second[buffs.first]-\/>pushEOS();}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \ \ \ \ \ \ }
\DoxyCodeLine{00208\ \ \ \ \ \}}
\DoxyCodeLine{00209\ \};}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classff__dsender_h_m_p_i_a12a13eeb6292443e90dc73571c621b43}{ff\_dsenderHMPI}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classff__dsender_m_p_i_ab813381b8878c75591f0a6779d445efb}{ff\_dsenderMPI}}\ \{}
\DoxyCodeLine{00213\ \ \ \ \ std::vector<int>\ \mbox{\hyperlink{classff__dsender_h_m_p_i_aa0a89b4ca61c86243ec10692bc436a06}{internalRanks}};}
\DoxyCodeLine{00214\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_h_m_p_i_ac4ac19f630531cde1f3b1c8486047284}{last\_rr\_rank\_Internal}}\ =\ -\/1;}
\DoxyCodeLine{00215\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_h_m_p_i_a6969bb5c5b25426cfc278c77f0023f1c}{internalMessageOTF}};}
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classff__dsender_h_m_p_i_ab604e341d74c66d9bc62975b65d1eaaf}{squareBoxEOS}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_h_m_p_i_a27c421fc08ab6841c28a4da89e9a6047}{getMostFilledInternalBufferRank}}()\{}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ rankMax\ =\ -\/1;}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ sizeMax\ =\ 0;}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ \mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}}\ :\ \mbox{\hyperlink{classff__dsender_h_m_p_i_aa0a89b4ca61c86243ec10692bc436a06}{internalRanks}})\{}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ batchBB\ =\ \mbox{\hyperlink{classff__dsender_m_p_i_a670d4ef16f3e708d731275091ad32ba2}{buffers}}[\mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}}];}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ sz\ =\ batchBB.second[batchBB.first]-\/>size();}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (sz\ >\ sizeMax)\ \{}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rankMax\ =\ \mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}};}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sizeMax\ =\ sz;}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (rankMax\ >=\ 0)\ \textcolor{keywordflow}{return}\ rankMax;}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_h_m_p_i_ac4ac19f630531cde1f3b1c8486047284}{last\_rr\_rank\_Internal}}\ =\ (\mbox{\hyperlink{classff__dsender_h_m_p_i_ac4ac19f630531cde1f3b1c8486047284}{last\_rr\_rank\_Internal}}\ +\ 1)\ \%\ this-\/>internalRanks.size();}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff__dsender_h_m_p_i_aa0a89b4ca61c86243ec10692bc436a06}{internalRanks}}[\mbox{\hyperlink{classff__dsender_h_m_p_i_ac4ac19f630531cde1f3b1c8486047284}{last\_rr\_rank\_Internal}}];}
\DoxyCodeLine{00233\ \ \ \ \ \}}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \ \ \ \ \mbox{\hyperlink{classff__dsender_h_m_p_i_a12a13eeb6292443e90dc73571c621b43}{ff\_dsenderHMPI}}(std::pair<ChannelType,\ ff\_endpoint>\ \mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}},\ \mbox{\hyperlink{ff__dsender_m_p_i_8hpp_a2bf91bcabbf423fc5c27cd19b199d6e9}{precomputedRT\_t}}*\ \mbox{\hyperlink{classff__dsender_m_p_i_a54bb8124eee49b9fc7946ee157605b1d}{rt}},\ \ std::string\ \mbox{\hyperlink{classff__dsender_m_p_i_a0841679ca35bed4b90bf945495023fb2}{gName}}\ \ =\ \textcolor{stringliteral}{"{}"{}},\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_a2fd72eeb35b2849d161f29d9e616b7be}{batchSize}}\ =\ \mbox{\hyperlink{dff_8hpp_a123fa013ecd2c91686ad58c0b8d985b3}{DEFAULT\_BATCH\_SIZE}},\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_a9a742801cac95f2b1ef704f19b76f02a}{messageOTF}}\ =\ \mbox{\hyperlink{dff_8hpp_a98084099edfbe21df8ff5a1f89c26700}{DEFAULT\_MESSAGE\_OTF}},\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_h_m_p_i_a6969bb5c5b25426cfc278c77f0023f1c}{internalMessageOTF}}\ =\ \mbox{\hyperlink{dff_8hpp_a087a86968d7c77fbd2ec5d81cacac019}{DEFAULT\_INTERNALMSG\_OTF}},\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_a3eaf6d5305d0269b9ec28766b618dfb8}{coreid}}=-\/1)\ :\ \mbox{\hyperlink{classff__dsender_m_p_i_ab813381b8878c75591f0a6779d445efb}{ff\_dsenderMPI}}(\mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}},\ \mbox{\hyperlink{classff__dsender_m_p_i_a54bb8124eee49b9fc7946ee157605b1d}{rt}},\ \mbox{\hyperlink{classff__dsender_m_p_i_a0841679ca35bed4b90bf945495023fb2}{gName}},\ \mbox{\hyperlink{classff__dsender_m_p_i_a2fd72eeb35b2849d161f29d9e616b7be}{batchSize}},\ \mbox{\hyperlink{classff__dsender_m_p_i_a9a742801cac95f2b1ef704f19b76f02a}{messageOTF}},\ \mbox{\hyperlink{classff__dsender_m_p_i_a3eaf6d5305d0269b9ec28766b618dfb8}{coreid}}),\ \mbox{\hyperlink{classff__dsender_h_m_p_i_a6969bb5c5b25426cfc278c77f0023f1c}{internalMessageOTF}}(\mbox{\hyperlink{classff__dsender_h_m_p_i_a6969bb5c5b25426cfc278c77f0023f1c}{internalMessageOTF}})\ \{\}\ }
\DoxyCodeLine{00238\ \ \ \ \ \mbox{\hyperlink{classff__dsender_h_m_p_i_a6abc00d4ebaa3cd9455294f6b5acdab4}{ff\_dsenderHMPI}}(std::vector<std::pair<ChannelType,\ ff\_endpoint>>\ dest\_endpoints\_,\ \mbox{\hyperlink{ff__dsender_m_p_i_8hpp_a2bf91bcabbf423fc5c27cd19b199d6e9}{precomputedRT\_t}}*\ \mbox{\hyperlink{classff__dsender_m_p_i_a54bb8124eee49b9fc7946ee157605b1d}{rt}},\ std::string\ \mbox{\hyperlink{classff__dsender_m_p_i_a0841679ca35bed4b90bf945495023fb2}{gName}}\ \ =\ \textcolor{stringliteral}{"{}"{}},\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_a2fd72eeb35b2849d161f29d9e616b7be}{batchSize}}\ =\ \mbox{\hyperlink{dff_8hpp_a123fa013ecd2c91686ad58c0b8d985b3}{DEFAULT\_BATCH\_SIZE}},\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_a9a742801cac95f2b1ef704f19b76f02a}{messageOTF}}\ =\ \mbox{\hyperlink{dff_8hpp_a98084099edfbe21df8ff5a1f89c26700}{DEFAULT\_MESSAGE\_OTF}},\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_h_m_p_i_a6969bb5c5b25426cfc278c77f0023f1c}{internalMessageOTF}}\ =\ \mbox{\hyperlink{dff_8hpp_a087a86968d7c77fbd2ec5d81cacac019}{DEFAULT\_INTERNALMSG\_OTF}},\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_m_p_i_a3eaf6d5305d0269b9ec28766b618dfb8}{coreid}}=-\/1)\ :\ \mbox{\hyperlink{classff__dsender_m_p_i_ab813381b8878c75591f0a6779d445efb}{ff\_dsenderMPI}}(dest\_endpoints\_,\ \mbox{\hyperlink{classff__dsender_m_p_i_a54bb8124eee49b9fc7946ee157605b1d}{rt}},\ \mbox{\hyperlink{classff__dsender_m_p_i_a0841679ca35bed4b90bf945495023fb2}{gName}},\ \mbox{\hyperlink{classff__dsender_m_p_i_a2fd72eeb35b2849d161f29d9e616b7be}{batchSize}},\ \mbox{\hyperlink{classff__dsender_m_p_i_a9a742801cac95f2b1ef704f19b76f02a}{messageOTF}},\ \mbox{\hyperlink{classff__dsender_m_p_i_a3eaf6d5305d0269b9ec28766b618dfb8}{coreid}}),\ \mbox{\hyperlink{classff__dsender_h_m_p_i_a6969bb5c5b25426cfc278c77f0023f1c}{internalMessageOTF}}(\mbox{\hyperlink{classff__dsender_h_m_p_i_a6969bb5c5b25426cfc278c77f0023f1c}{internalMessageOTF}})\ \{\}}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff__dsender_h_m_p_i_aebc1d80c65392600b19b6f87b626bec8}{svc\_init}}()\ \{}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff__dsender_m_p_i_a3eaf6d5305d0269b9ec28766b618dfb8}{coreid}}!=-\/1)}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mapping__utils_8hpp_a55cc056711b4071b978f875d18914b44}{ff\_mapThreadToCpu}}(\mbox{\hyperlink{classff__dsender_m_p_i_a3eaf6d5305d0269b9ec28766b618dfb8}{coreid}});}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\&\ [ct,\ endpoint]\ :\ this-\/>\mbox{\hyperlink{classff__dsender_m_p_i_a0767ccaaa33464c2cf738e424ec510a2}{destRanks}})\{}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}}\ =\ endpoint.getRank();}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ isInternal\ =\ ct\ ==\ \mbox{\hyperlink{ff__network_8hpp_a19a96edeeb9d37072c4ce9f862d19ba8afd5a5f51ce25953f3db2c7e93eb7864a}{ChannelType::INT}};}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isInternal)\ }
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_h_m_p_i_aa0a89b4ca61c86243ec10692bc436a06}{internalRanks}}.push\_back(\mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}});}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_a736a637c36714c8a00b18523e6b01e60}{ranks}}.push\_back(\{\mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}},\ ct\});}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<batchBuffer*>\ appo;}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ (isInternal\ ?\ \mbox{\hyperlink{classff__dsender_h_m_p_i_a6969bb5c5b25426cfc278c77f0023f1c}{internalMessageOTF}}\ :\ \mbox{\hyperlink{classff__dsender_m_p_i_a9a742801cac95f2b1ef704f19b76f02a}{messageOTF}});\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}++)\ appo.push\_back(\mbox{\hyperlink{classff__dsender_m_p_i_a2fd72eeb35b2849d161f29d9e616b7be}{batchSize}}\ ==\ 1\ ?\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1direct_batch_buffer}{directBatchBuffer}}(\mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}})\ :\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classff__dsender_m_p_i_1_1batch_buffer}{batchBuffer}}(\mbox{\hyperlink{classff__dsender_m_p_i_a2fd72eeb35b2849d161f29d9e616b7be}{batchSize}},\ \mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}}));}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_a670d4ef16f3e708d731275091ad32ba2}{buffers}}.emplace(std::make\_pair(\mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}},\ std::make\_pair(0,\ std::move(appo))));}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff__dsender_m_p_i_ad5306744ea037c59493b5d801b25fb70}{handshakeHandler}}(\mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}},\ ct)\ <\ 0)\ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ dest\ :\ \mbox{\hyperlink{classff__dsender_m_p_i_a54bb8124eee49b9fc7946ee157605b1d}{rt}}-\/>operator[](endpoint.groupName).first)}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_m_p_i_a27fae59ea2921823590f527714a5083e}{dest2Rank}}[std::make\_pair(dest,\ ct)]\ =\ \mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}};}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ this-\/>destRanks.clear();}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00267\ \ \ \ \ \}}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \ \ \ \ \mbox{\hyperlink{structmessage__t}{message\_t}}\ *\mbox{\hyperlink{classff__dsender_h_m_p_i_afb164003f078811f7b4b72857145aed4}{svc}}(\mbox{\hyperlink{structmessage__t}{message\_t}}*\ task)\ \{}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (this-\/>\mbox{\hyperlink{classff_1_1ff__minode_aec0199f5245ed82be8e205540691c6b0}{get\_channel\_id}}()\ ==\ (\mbox{\hyperlink{eabase_8h_a831c6b6852c6d34448e30a88c34539fd}{ssize\_t}})(this-\/>\mbox{\hyperlink{classff_1_1ff__minode_a1f4076371d457755d18579bb0990a70d}{get\_num\_inchannels}}()\ -\/\ 1))\{}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}};}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ pick\ destination\ from\ the\ list\ of\ internal\ connections!}}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (task-\/>chid\ !=\ -\/1)\{\ \textcolor{comment}{//\ roundrobin\ over\ the\ destinations}}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}}\ =\ \mbox{\hyperlink{classff__dsender_m_p_i_a27fae59ea2921823590f527714a5083e}{dest2Rank}}[\{task-\/>chid,\ \mbox{\hyperlink{ff__network_8hpp_a19a96edeeb9d37072c4ce9f862d19ba8afd5a5f51ce25953f3db2c7e93eb7864a}{ChannelType::INT}}\}];}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}}\ =\ \mbox{\hyperlink{classff__dsender_h_m_p_i_a27c421fc08ab6841c28a4da89e9a6047}{getMostFilledInternalBufferRank}}();}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ buffs\ =\ \mbox{\hyperlink{classff__dsender_m_p_i_a670d4ef16f3e708d731275091ad32ba2}{buffers}}[\mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}}];}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (buffs.second[buffs.first]-\/>push(task))\ \textcolor{comment}{//\ the\ push\ triggered\ a\ flush,\ so\ we\ must\ go\ ion\ the\ next\ buffer}}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ buffs.first\ =\ (buffs.first\ +\ 1)\ \%\ buffs.second.size();\ \textcolor{comment}{//\ increment\ the\ used\ buffer\ of\ 1}}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ this-\/>\mbox{\hyperlink{structff_1_1ff__minode__t_aafe87b1772b455605c8c3aa23048c28f}{GO\_ON}};}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff__dsender_m_p_i_af75da69139caa46d63dc022edbb047c2}{ff\_dsenderMPI::svc}}(task);}
\DoxyCodeLine{00287\ \ \ \ \ \}}
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00289\ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff__dsender_h_m_p_i_a21db3202c06c1d6a2db76f8e364777cf}{eosnotify}}(\mbox{\hyperlink{eabase_8h_a831c6b6852c6d34448e30a88c34539fd}{ssize\_t}}\ \textcolor{keywordtype}{id})\ \{}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keywordtype}{id}\ ==\ (\mbox{\hyperlink{eabase_8h_a831c6b6852c6d34448e30a88c34539fd}{ssize\_t}})(this-\/>\mbox{\hyperlink{classff_1_1ff__minode_a1f4076371d457755d18579bb0990a70d}{get\_num\_inchannels}}()\ -\/\ 1))\{}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ send\ the\ EOS\ to\ all\ the\ internal\ connections}}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (squareBoxEOS)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff__dsender_h_m_p_i_ab604e341d74c66d9bc62975b65d1eaaf}{squareBoxEOS}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}}\ :\ \mbox{\hyperlink{classff__dsender_h_m_p_i_aa0a89b4ca61c86243ec10692bc436a06}{internalRanks}})\{}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ buffs\ =\ \mbox{\hyperlink{classff__dsender_m_p_i_a670d4ef16f3e708d731275091ad32ba2}{buffers}}[\mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}}];}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ buffs.second[buffs.first]-\/>pushEOS();}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (++\mbox{\hyperlink{classff__dsender_m_p_i_a3a878aeeb10eb475d3cb4ba4597c02df}{neos}}\ >=\ this-\/>\mbox{\hyperlink{classff_1_1ff__minode_a1f4076371d457755d18579bb0990a70d}{get\_num\_inchannels}}())}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\&\ [\mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}},\ ct]\ :\ \mbox{\hyperlink{classff__dsender_m_p_i_a736a637c36714c8a00b18523e6b01e60}{ranks}})\{}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\&\ buffs\ =\ \mbox{\hyperlink{classff__dsender_m_p_i_a670d4ef16f3e708d731275091ad32ba2}{buffers}}[\mbox{\hyperlink{ittnotify__static_8h_a4d59258314b5b7d431d257e3a5a98b57}{rank}}];}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ buffs.second[buffs.first]-\/>pushEOS();}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \ \ \ \ \ }
\DoxyCodeLine{00304\ \ \ \ \ \ \}}
\DoxyCodeLine{00305\ \ \ \ \ }
\DoxyCodeLine{00306\ \};}
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00308\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
