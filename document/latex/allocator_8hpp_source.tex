\doxysection{allocator.\+hpp}
\hypertarget{allocator_8hpp_source}{}\label{allocator_8hpp_source}\index{external/taskflow/3rd-\/party/ff/allocator.hpp@{external/taskflow/3rd-\/party/ff/allocator.hpp}}
\mbox{\hyperlink{allocator_8hpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*\ -\/*-\/\ Mode:\ C++;\ tab-\/width:\ 4;\ c-\/basic-\/offset:\ 4;\ indent-\/tabs-\/mode:\ nil\ -\/*-\/\ */}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{comment}{/*\ ***************************************************************************}}
\DoxyCodeLine{00032\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00033\ \textcolor{comment}{\ *\ \ FastFlow\ is\ free\ software;\ you\ can\ redistribute\ it\ and/or\ modify\ it}}
\DoxyCodeLine{00034\ \textcolor{comment}{\ *\ \ under\ the\ terms\ of\ the\ GNU\ Lesser\ General\ Public\ License\ version\ 3\ as}}
\DoxyCodeLine{00035\ \textcolor{comment}{\ *\ \ published\ by\ the\ Free\ Software\ Foundation.}}
\DoxyCodeLine{00036\ \textcolor{comment}{\ *\ \ Starting\ from\ version\ 3.0.1\ FastFlow\ is\ dual\ licensed\ under\ the\ GNU\ LGPLv3}}
\DoxyCodeLine{00037\ \textcolor{comment}{\ *\ \ or\ MIT\ License\ (https://github.com/ParaGroup/WindFlow/blob/vers3.x/LICENSE.MIT)}}
\DoxyCodeLine{00038\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00039\ \textcolor{comment}{\ *\ \ This\ program\ is\ distributed\ in\ the\ hope\ that\ it\ will\ be\ useful,\ but\ WITHOUT}}
\DoxyCodeLine{00040\ \textcolor{comment}{\ *\ \ ANY\ WARRANTY;\ without\ even\ the\ implied\ warranty\ of\ MERCHANTABILITY\ or}}
\DoxyCodeLine{00041\ \textcolor{comment}{\ *\ \ FITNESS\ FOR\ A\ PARTICULAR\ PURPOSE.\ \ See\ the\ GNU\ General\ Public\ License\ for}}
\DoxyCodeLine{00042\ \textcolor{comment}{\ *\ \ more\ details.}}
\DoxyCodeLine{00043\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00044\ \textcolor{comment}{\ *\ \ You\ should\ have\ received\ a\ copy\ of\ the\ GNU\ General\ Public\ License\ along}}
\DoxyCodeLine{00045\ \textcolor{comment}{\ *\ \ with\ this\ program;\ if\ not,\ write\ to\ the\ Free\ Software\ Foundation,\ Inc.,\ 59}}
\DoxyCodeLine{00046\ \textcolor{comment}{\ *\ \ Temple\ Place\ -\/\ Suite\ 330,\ Boston,\ MA\ 02111-\/1307,\ USA.}}
\DoxyCodeLine{00047\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00048\ \textcolor{comment}{\ *\ \ As\ a\ special\ exception,\ you\ may\ use\ this\ file\ as\ part\ of\ a\ free\ software}}
\DoxyCodeLine{00049\ \textcolor{comment}{\ *\ \ library\ without\ restriction.\ \ Specifically,\ if\ other\ files\ instantiate}}
\DoxyCodeLine{00050\ \textcolor{comment}{\ *\ \ templates\ or\ use\ macros\ or\ inline\ functions\ from\ this\ file,\ or\ you\ compile}}
\DoxyCodeLine{00051\ \textcolor{comment}{\ *\ \ this\ file\ and\ link\ it\ with\ other\ files\ to\ produce\ an\ executable,\ this\ file}}
\DoxyCodeLine{00052\ \textcolor{comment}{\ *\ \ does\ not\ by\ itself\ cause\ the\ resulting\ executable\ to\ be\ covered\ by\ the\ GNU}}
\DoxyCodeLine{00053\ \textcolor{comment}{\ *\ \ General\ Public\ License.\ \ This\ exception\ does\ not\ however\ invalidate\ any}}
\DoxyCodeLine{00054\ \textcolor{comment}{\ *\ \ other\ reasons\ why\ the\ executable\ file\ might\ be\ covered\ by\ the\ GNU\ General}}
\DoxyCodeLine{00055\ \textcolor{comment}{\ *\ \ Public\ License.}}
\DoxyCodeLine{00056\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00057\ \textcolor{comment}{\ *\ **************************************************************************/}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \textcolor{comment}{/*\ Lock-\/free\ FastFlow\ allocator.}}
\DoxyCodeLine{00060\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00061\ \textcolor{comment}{\ *\ Here\ we\ defined\ the\ ff\_allocator\ (1)\ and\ the\ FFAllocator\ (2).}}
\DoxyCodeLine{00062\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00063\ \textcolor{comment}{\ *\ 1.\ The\ ff\_allocator\ allocates\ only\ large\ chunks\ of\ memory,\ slicing\ them\ up}}
\DoxyCodeLine{00064\ \textcolor{comment}{\ *\ \ \ \ into\ little\ chunks\ all\ with\ the\ same\ size.\ Only\ one\ thread\ can\ perform}}
\DoxyCodeLine{00065\ \textcolor{comment}{\ *\ \ \ \ malloc\ operations\ while\ any\ number\ of\ threads\ may\ perform\ frees\ using}}
\DoxyCodeLine{00066\ \textcolor{comment}{\ *\ \ \ \ the\ ff\_allocator.}}
\DoxyCodeLine{00067\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00068\ \textcolor{comment}{\ *\ \ \ \ The\ ff\_allocator\ is\ based\ on\ the\ idea\ of\ Slab\ Allocator,\ for\ more\ details}}
\DoxyCodeLine{00069\ \textcolor{comment}{\ *\ \ \ \ about\ Slab\ Allocator\ please\ see:}}
\DoxyCodeLine{00070\ \textcolor{comment}{\ *\ \ \ \ \ Bonwick,\ Jeff.\ "{}The\ Slab\ Allocator:\ An\ Object-\/Caching\ Kernel\ Memory}}
\DoxyCodeLine{00071\ \textcolor{comment}{\ *\ \ \ \ \ Allocator."{}\ Boston\ USENIX\ Proceedings,\ 1994.}}
\DoxyCodeLine{00072\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00073\ \textcolor{comment}{\ *\ 2.\ Based\ on\ the\ ff\_allocator,\ the\ FFAllocator\ has\ been\ implemented.}}
\DoxyCodeLine{00074\ \textcolor{comment}{\ *\ \ \ \ It\ might\ be\ used\ by\ any\ number\ of\ threads\ to\ dynamically}}
\DoxyCodeLine{00075\ \textcolor{comment}{\ *\ \ \ \ allocate/deallocate\ memory.\ You\ have\ to\ include\ allocator.hpp\ and\ just\ use}}
\DoxyCodeLine{00076\ \textcolor{comment}{\ *\ \ \ \ ff\_malloc,\ ff\_free,\ ff\_realloc,\ ff\_posix\_memalign.}}
\DoxyCodeLine{00077\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00078\ \textcolor{comment}{\ *\ Note:\ In\ all\ the\ cases\ it\ is\ possible,\ it\ is\ better\ to\ use\ the\ ff\_allocator}}
\DoxyCodeLine{00079\ \textcolor{comment}{\ *\ \ \ \ \ \ \ as\ it\ allows\ more\ control\ and\ is\ more\ efficient.}}
\DoxyCodeLine{00080\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00081\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \textcolor{comment}{/*}}
\DoxyCodeLine{00084\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00085\ \textcolor{comment}{\ *\ \ \ Author:}}
\DoxyCodeLine{00086\ \textcolor{comment}{\ *\ \ \ \ \ \ Massimo\ Torquati\ <torquati@di.unipi.it>\ or\ <massimotor@gmail.com>}}
\DoxyCodeLine{00087\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00088\ \textcolor{comment}{\ *\ \ -\/\ June\ \ 2008\ first\ version}}
\DoxyCodeLine{00089\ \textcolor{comment}{\ *\ \ -\/\ March\ 2011\ main\ rework}}
\DoxyCodeLine{00090\ \textcolor{comment}{\ *\ \ -\/\ June\ \ 2012\ \ -\/\ performance\ improvement\ in\ getfrom\_fb}}
\DoxyCodeLine{00091\ \textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/\ statistics\ cleanup}}
\DoxyCodeLine{00092\ \textcolor{comment}{\ *\ \ -\/\ Sept\ \ 2015\ Marco\ Aldinucci:\ porting\ to\ c++11}}
\DoxyCodeLine{00093\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00094\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \textcolor{preprocessor}{\#ifndef\ FF\_ALLOCATOR\_HPP}}
\DoxyCodeLine{00098\ \textcolor{preprocessor}{\#define\ FF\_ALLOCATOR\_HPP}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \textcolor{preprocessor}{\#include\ <assert.h>}}
\DoxyCodeLine{00102\ \textcolor{preprocessor}{\#include\ <algorithm>}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{external_2taskflow_23rd-party_2ff_2platforms_2_platform_8h}{ff/platforms/platform.h}}>}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \textcolor{comment}{//\ \#if\ defined(HAVE\_ATOMIC\_H)}}
\DoxyCodeLine{00107\ \textcolor{comment}{//\ \#include\ <asm/atomic.h>}}
\DoxyCodeLine{00108\ \textcolor{comment}{//\ \#else\ }}
\DoxyCodeLine{00109\ \textcolor{comment}{//\ \#include\ <ff/atomic/atomic.h>}}
\DoxyCodeLine{00110\ \textcolor{comment}{//\ \#endif}}
\DoxyCodeLine{00111\ \textcolor{preprocessor}{\#include\ <atomic>}}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \textcolor{preprocessor}{\#if\ defined(ALLOCATOR\_STATS)}}
\DoxyCodeLine{00114\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{00115\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \textcolor{comment}{//\#include\ <pthread.h>}}
\DoxyCodeLine{00119\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{ubuffer_8hpp}{ff/ubuffer.hpp}}>}}
\DoxyCodeLine{00120\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{spin-lock_8hpp}{ff/spin-\/lock.hpp}}>}}
\DoxyCodeLine{00121\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{svector_8hpp}{ff/svector.hpp}}>}}
\DoxyCodeLine{00122\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{utils_8hpp}{ff/utils.hpp}}>}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \textcolor{comment}{//\#define\ DEBUG\_ALLOCATOR\ 1}}
\DoxyCodeLine{00126\ \textcolor{preprocessor}{\#if\ defined(DEBUG\_ALLOCATOR)}}
\DoxyCodeLine{00127\ \textcolor{preprocessor}{\#define\ DBG(X)\ X}}
\DoxyCodeLine{00128\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00129\ \textcolor{preprocessor}{\#define\ DBG(X)}}
\DoxyCodeLine{00130\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceff}{ff}}\ \{}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00135\ \textcolor{comment}{\ \ \ \ \ *\ \ \(\backslash\)ingroup\ building\_blocks}}
\DoxyCodeLine{00136\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00137\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00138\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keyword}{enum}\ \{\ \mbox{\hyperlink{namespaceff_ac70617c84eb066a57e5d904bf5c3e62da9b057b825c2a8d1ab94ef55519344dd1}{N\_SLABBUFFER}}=9,\ \mbox{\hyperlink{namespaceff_ac70617c84eb066a57e5d904bf5c3e62dac4e03297ac4c5065b5b8690d0c651dae}{MAX\_SLABBUFFER\_SIZE}}=8192\};}
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespaceff_aa1f1e3ae7276d8194e9cd91e2dffd9eb}{POW2\_MIN}}\ \ =\ 5;}
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespaceff_acb06e7498e7fd41e08de493ee51261aa}{POW2\_MAX}}\ \ =\ 13;}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{comment}{//\ array\ containing\ different\ possbile\ sizes\ for\ a\ slab\ buffer}}
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespaceff_adc84d5e813921475f8f9ec164561309d}{buffersize}}[\mbox{\hyperlink{namespaceff_ac70617c84eb066a57e5d904bf5c3e62da9b057b825c2a8d1ab94ef55519344dd1}{N\_SLABBUFFER}}]\ =\ }
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \{\ 32,\ 64,128,256,512,1024,2048,4096,8192\ \ \};}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{comment}{//\ array\ containing\ the\ allowed\ numbers\ (quantity)\ of\ buffers.\ These\ values\ will\ be\ }}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{comment}{//\ used\ together\ with\ the\ array\ of\ possible\ sizes\ for\ buffers:\ they\ will\ be\ paired\ }}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{comment}{//\ with\ a\ specific\ buffer\ size\ and\ will\ denote\ the\ number\ of\ buffers\ of\ that\ size,\ }}
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{comment}{//\ present\ inside\ the\ cache.}}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespaceff_aa1467f40b1c3300221f6918c5478d0bb}{nslabs\_default}}[\mbox{\hyperlink{namespaceff_ac70617c84eb066a57e5d904bf5c3e62da9b057b825c2a8d1ab94ef55519344dd1}{N\_SLABBUFFER}}]\ =}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \{\ 512,512,512,512,128,\ \ 64,\ \ 32,\ \ 16,\ \ \ 8\ \};}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \textcolor{preprocessor}{\#if\ defined(ALLOCATOR\_STATS)}}
\DoxyCodeLine{00155\ \ \ \ \ }
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keyword}{struct\ }all\_stats\ \{}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ std::atomic\_long\ \ \ \ \ \ nmalloc;}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ std::atomic\_long\ \ \ \ \ \ nfree;}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ std::atomic\_long\ \ \ \ \ \ nrealloc;}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ std::atomic\_long\ \ \ \ \ \ sysmalloc;}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ std::atomic\_long\ \ \ \ \ \ sysfree;}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ std::atomic\_long\ \ \ \ \ \ sysrealloc;}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ std::atomic\_long\ \ \ \ \ \ hit;}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ std::atomic\_long\ \ \ \ \ \ miss;}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ std::atomic\_long\ \ \ \ \ \ leakremoved;}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ std::atomic\_long\ \ \ \ \ \ memallocated;}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ std::atomic\_long\ \ \ \ \ \ memfreed;}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ std::atomic\_long\ \ \ \ \ \ segmalloc;}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ std::atomic\_long\ \ \ \ \ \ segfree;}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ std::atomic\_long\ \ \ \ \ \ newallocator;}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ std::atomic\_long\ \ \ \ \ \ deleteallocator;}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ all\_stats()\ \{}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ \ \ nmalloc.store(0);}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ nfree.store(0);}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ nrealloc.store(0);}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ sysmalloc.store(0);}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ sysfree.store(0);}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ sysrealloc.store(0);}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ hit.store(0);}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ miss.store(0);}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ leakremoved.store(0);}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ memallocated.store(0);}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ memfreed.store(0);}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ segmalloc.store(0);}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ segfree.store(0);}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ newallocator.store(0);}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ deleteallocator.store(0);}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00190\ \ \ \ \ }
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ all\_stats\ *\mbox{\hyperlink{ittnotify__static_8h_a73b55cf9365a83ac86bac9da2dada5ee}{instance}}()\ \{}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ all\_stats\ allstats;}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \&allstats;}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{runtime_2spdlog_2include_2spdlog_2fmt_2bundled_2base_8h_a59025bfaf390e425b4e274c966a77557}{print}}(std::ostream\ \&\ out\ =\ std::cout)\ \{}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n-\/-\/-\/\ Allocator\ Stats\ -\/-\/-\/\(\backslash\)n"{}}}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}malloc\ \ \ \ \ \ \ \ =\ "{}}\ <<\ nmalloc\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ cache\ hit\ \ \ =\ "{}}\ <<\ hit\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ cache\ miss\ \ =\ "{}}\ <<\ miss\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ leakremoved\ =\ "{}}\ <<\ leakremoved\ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}}}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}free\ \ \ \ \ \ \ \ \ \ =\ "{}}\ <<\ nfree\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}realloc\ \ \ \ \ \ \ =\ "{}}\ <<\ nrealloc\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}}}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}mem.\ allocated=\ "{}}\ <<\ memallocated\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}mem.\ freed\ \ \ \ =\ "{}}\ <<\ memfreed\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}}}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}segmalloc\ \ \ \ \ =\ "{}}\ <<\ segmalloc\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}segfree\ \ \ \ \ \ \ =\ "{}}\ <<\ segfree\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}}}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}sysmalloc\ \ \ \ \ =\ "{}}\ <<\ sysmalloc\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}sysfree\ \ \ \ \ \ \ =\ "{}}\ <<\ sysfree\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}sysrealloc\ \ \ \ =\ "{}}\ <<\ sysrealloc\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (newallocator>0)\ \{}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\ -\/-\/-\/-\/\ How\ many\ allocators\ -\/-\/-\/-\/\(\backslash\)n"{}}}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}new\ allocator\ \ \ \ =\ "{}}\ <<\ newallocator\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}delete\ allocator\ =\ "{}}\ <<\ deleteallocator\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00217\ \ \ \ \ \};}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ \textcolor{preprocessor}{\#define\ ALLSTATS(X)\ X}}
\DoxyCodeLine{00220\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00221\ \textcolor{preprocessor}{\#define\ ALLSTATS(X)}}
\DoxyCodeLine{00222\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ ALLOCATOR\_STATS\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespaceff_a94e8617a117c5ad8c4ce0d196c1413da}{isPowerOfTwoMultiple}}(\textcolor{keywordtype}{size\_t}\ alignment,\ \textcolor{keywordtype}{size\_t}\ multiple)\ \{}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ alignment\ \&\&\ ((alignment\ \&\ (alignment-\/multiple))==0);}
\DoxyCodeLine{00227\ \ \ \ \ \}}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00229\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00230\ \textcolor{comment}{\ \ \ \ \ *\ \(\backslash\)class\ SegmentAllocator}}
\DoxyCodeLine{00231\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00232\ \textcolor{comment}{\ \ \ \ \ *\ \(\backslash\)brief\ Uses\ standard\ \(\backslash\)p\ libc\ allocator\ to\ allocate\ chunks\ of\ (possibly}}
\DoxyCodeLine{00233\ \textcolor{comment}{\ \ \ \ \ *\ aligned)\ memory.\ It\ also\ keeps\ track\ of\ the\ amount\ of\ allocated\ memory.}}
\DoxyCodeLine{00234\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00235\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classff_1_1_segment_allocator_a51e83e0b28aa840c31d1c090fd1e05cf}{SegmentAllocator}}\ \{}
\DoxyCodeLine{00238\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_segment_allocator_a51e83e0b28aa840c31d1c090fd1e05cf}{SegmentAllocator}}():\mbox{\hyperlink{classff_1_1_segment_allocator_acfd3a5522d42f6808a1b14618bfe2343}{memory\_allocated}}(0)\ \{\ \}}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_segment_allocator_ad3c316e0336425fcddfb54b7f1b455fe}{\string~SegmentAllocator}}()\ \{\}}
\DoxyCodeLine{00241\ \ \ \ \ }
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00243\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Allocates\ a\ new\ segment\ of\ (possibly\ aligned)\ memory.\ \ \(\backslash\)n\ This\ method}}
\DoxyCodeLine{00244\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ uses\ standard\ \(\backslash\)p\ malloc\ to\ allocate\ memory\ (or\ \(\backslash\)p\ posix\_memalign\ when}}
\DoxyCodeLine{00245\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ possible).\ \(\backslash\)p\ malloc\ should\ guarantee\ a\ sufficiently\ well\ aligned\ memory}}
\DoxyCodeLine{00246\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ for\ any\ purpose,\ while\ \(\backslash\)p\ posix\_memalign\ is\ used\ to\ effectively\ allocate}}
\DoxyCodeLine{00247\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ memory\ aligned\ in\ a\ defined\ way\ (i.e.\ the\ address\ of\ the\ allocated}}
\DoxyCodeLine{00248\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ memory\ will\ be\ a\ multiple\ of\ a\ specific\ value).}}
\DoxyCodeLine{00249\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00250\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)param\ segment\_size\ the\ quantity\ of\ memory\ to\ be\ allocated.}}
\DoxyCodeLine{00251\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00252\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)returns\ a\ pointer\ to\ the\ chunk\ of\ memory\ allocated.}}
\DoxyCodeLine{00253\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{classff_1_1_segment_allocator_a423525f3395358241af84dab10eda02e}{newsegment}}(\textcolor{keywordtype}{size\_t}\ segment\_size)\ \{}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//void\ *\ ptr\ =\ ::malloc(segment\_size);}}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}=\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ MA:\ Check\ if\ this\ does\ not\ lead\ to\ a\ page\ swap}}
\DoxyCodeLine{00258\ \textcolor{preprocessor}{\#if\ defined\ (\_SC\_PAGESIZE)}}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}\ =\ \mbox{\hyperlink{sysdep_8h_ae77dd87ccd6c736ac3eb1aa624d05269}{getAlignedMemory}}(sysconf(\_SC\_PAGESIZE),segment\_size);}
\DoxyCodeLine{00260\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}\ =\ \mbox{\hyperlink{sysdep_8h_ae77dd87ccd6c736ac3eb1aa624d05269}{getAlignedMemory}}(4096,segment\_size);\ \textcolor{comment}{//\ To\ be\ fixed\ for\ MSC}}
\DoxyCodeLine{00262\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_segment_allocator_acfd3a5522d42f6808a1b14618bfe2343}{memory\_allocated}}\ +=\ segment\_size;\ \textcolor{comment}{//\ updt\ quantity\ of\ allocated\ memory}}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>segmalloc.fetch\_add(1);}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ all\_stats::instance()-\/>memallocated.fetch\_add(segment\_size));}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ \textcolor{preprocessor}{\#if\ defined(MAKE\_VALGRIND\_HAPPY)}}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \ \ memset(\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}},0,segment\_size);}
\DoxyCodeLine{00272\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}};}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00277\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Free\ \(\backslash\)p\ segment\_size\ amount\ of\ memory\ from\ the\ memory\ chunk\ pointed\ by}}
\DoxyCodeLine{00278\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)p\ ptr.\(\backslash\)n\ First,\ it\ checks\ that\ the\ total\ allocated\ memory\ is\ at\ least}}
\DoxyCodeLine{00279\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ as\ big\ as\ \(\backslash\)p\ segment\_size.\ Then,\ it\ frees\ memory\ and\ updates\ the\ counter}}
\DoxyCodeLine{00280\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ of\ the\ total\ allocated\ memory.}}
\DoxyCodeLine{00281\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00282\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)param\ ptr\ pointer\ to\ the\ memory\ chunk\ to\ be\ freed}}
\DoxyCodeLine{00283\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)param\ segment\_size\ quantity\ of\ memory\ to\ free\ from\ the\ chunk}}
\DoxyCodeLine{00284\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ requested.}}
\DoxyCodeLine{00285\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \ \ \mbox{\hyperlink{classff_1_1_segment_allocator_af4a56c9dc0c716e2ab85b57f13f071fa}{freesegment}}(\textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}},\ \textcolor{keywordtype}{size\_t}\ segment\_size)\ \{}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(assert(\mbox{\hyperlink{classff_1_1_segment_allocator_acfd3a5522d42f6808a1b14618bfe2343}{memory\_allocated}}\ >=segment\_size));}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//::free(ptr);}}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sysdep_8h_a8d0b69a707e38b6ee06c8039cce3a9ae}{freeAlignedMemory}}(\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}});}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_segment_allocator_acfd3a5522d42f6808a1b14618bfe2343}{memory\_allocated}}\ -\/=\ segment\_size;}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(\ all\_stats::instance()-\/>segfree.fetch\_add(1);}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ all\_stats::instance()-\/>memfreed.fetch\_add(segment\_size)\ );}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00295\ \ \ \ \ }
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00297\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)return\ Returns\ the\ amount\ of\ allocated\ memory}}
\DoxyCodeLine{00298\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classff_1_1_segment_allocator_ae405e5b812a70da3208e62b4e9401757}{getallocated}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff_1_1_segment_allocator_acfd3a5522d42f6808a1b14618bfe2343}{memory\_allocated}};\ \}}
\DoxyCodeLine{00300\ \ \ \ \ }
\DoxyCodeLine{00301\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_segment_allocator_acfd3a5522d42f6808a1b14618bfe2343}{memory\_allocated}};}
\DoxyCodeLine{00303\ \ \ \ \ \};}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \ \ \ \ \textcolor{comment}{//\ forward\ declarations}}
\DoxyCodeLine{00306\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classff_1_1_slab_cache}{SlabCache}};}
\DoxyCodeLine{00307\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classff_1_1ff__allocator}{ff\_allocator}};}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00310\ \textcolor{comment}{\ \ \ \ \ *\ \(\backslash\)struct\ Buf\_ctl}}
\DoxyCodeLine{00311\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00312\ \textcolor{comment}{\ \ \ \ \ *\ \(\backslash\)brief\ A\ buffer\ controller}}
\DoxyCodeLine{00313\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00314\ \textcolor{comment}{\ \ \ \ \ *\ Each\ slab\ buffer\ has\ a\ \(\backslash\)p\ Buf\_ctl\ structure\ at\ the\ beginning\ of\ the\ data.}}
\DoxyCodeLine{00315\ \textcolor{comment}{\ \ \ \ \ *\ This\ structure\ holds\ a\ back-\/pointer\ to\ the\ controlling\ slab.}}
\DoxyCodeLine{00316\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00317\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00318\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00319\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ \{\ \ \mbox{\hyperlink{classff_1_1_slab_cache}{SlabCache}}\ \ *\ \mbox{\hyperlink{structff_1_1_buf__ctl_a577380a7867fa0c24543931999c09407}{ptr}};\ \};}
\DoxyCodeLine{00320\ }
\DoxyCodeLine{00321\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00322\ \textcolor{comment}{\ \ \ \ \ *\ \(\backslash\)struct\ Seg\_ctl}}
\DoxyCodeLine{00323\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00324\ \textcolor{comment}{\ \ \ \ \ *\ \(\backslash\)brief\ The\ segment\ controller}}
\DoxyCodeLine{00325\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00326\ \textcolor{comment}{\ \ \ \ \ *\ Each\ slab\ segment\ has\ a\ \(\backslash\)p\ Seg\_ctl\ structure\ at\ the\ beginning\ of\ the}}
\DoxyCodeLine{00327\ \textcolor{comment}{\ \ \ \ \ *\ segment,\ responsible\ for\ maintaining\ the\ linkage\ with\ other\ slabs\ in\ the}}
\DoxyCodeLine{00328\ \textcolor{comment}{\ \ \ \ \ *\ cache,\ the\ number\ of\ buffers\ in\ use\ and\ the\ number\ of\ available\ buffers.}}
\DoxyCodeLine{00329\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00330\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00331\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}}\ \{}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ number\ of\ buffers\ in\ use}}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(\textcolor{keywordtype}{size\_t}\ refcount;)}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ reference\ to\ the\ SlabCache\ that\ owns\ the\ segment}}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache}{SlabCache}}\ *\ \mbox{\hyperlink{structff_1_1_seg__ctl_a44837b4e12e72be6c87fbb8142eebf89}{cacheentry}};}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ reference\ to\ the\ allocator}}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__allocator}{ff\_allocator}}\ *\ \mbox{\hyperlink{structff_1_1_seg__ctl_af833ba28f55b725b21484347f06697eb}{allocator}};}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ number\ of\ items\ in\ the\ buffer\ freelist\ (i.e.\ Buffers\ available)}}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \textcolor{comment}{//atomic\_long\_t\ \ \ \ \ \ \ \ availbuffers;}}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \mbox{\hyperlink{structff_1_1_seg__ctl_a094f541403cf6d508dc6712c0567be4f}{availbuffers}};}
\DoxyCodeLine{00344\ \ \ \ \ \};}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ }
\DoxyCodeLine{00347\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00348\ \textcolor{comment}{\ \ \ \ \ *\ \(\backslash\)struct\ xThreadData}}
\DoxyCodeLine{00349\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00350\ \textcolor{comment}{\ \ \ \ \ *\ \(\backslash\)brief\ A\ buffer\ shared\ among\ threads\ (i.e.\ leak\ queue)}}
\DoxyCodeLine{00351\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00352\ \textcolor{comment}{\ \ \ \ \ *\ A\ buffer\ that\ is\ used\ as\ a\ channel\ for\ exchanging\ shared\ data\ among\ threads.}}
\DoxyCodeLine{00353\ \textcolor{comment}{\ \ \ \ \ *\ It\ is\ built\ upon\ FastFlow's\ unbounded\ Single-\/Writer\ /\ Single-\/Reader\ queues}}
\DoxyCodeLine{00354\ \textcolor{comment}{\ \ \ \ \ *\ (\(\backslash\)p\ uSWSR\_Ptr\_Buffer).\ These\ buffers\ guarantee\ deadlock\ avoidance\ and}}
\DoxyCodeLine{00355\ \textcolor{comment}{\ \ \ \ \ *\ scalability\ in\ stream-\/oriented\ applications.}}
\DoxyCodeLine{00356\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00357\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00358\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00359\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structff_1_1x_thread_data_a9d5e3fdf51f63854c638c7cf5e75a931}{xThreadData}}\ \{}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \textcolor{keyword}{enum}\ \{\ \mbox{\hyperlink{structff_1_1x_thread_data_af1871a4b69e59034158ed18580f1b393a0ea4993b80f25d6caaa4dacfb69ea79e}{LEAK\_CHUNK}}=4096\ \};}
\DoxyCodeLine{00361\ \ \ \ \ }
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1x_thread_data_a9d5e3fdf51f63854c638c7cf5e75a931}{xThreadData}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ \textcolor{comment}{/*allocator*/},\ \textcolor{keywordtype}{size\_t}\ \textcolor{comment}{/*nslabs*/},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{pthread__minport__windows_8h_ad665cf4bf4a61dd23aab712d9c5e9d81}{pthread\_t}}\ \mbox{\hyperlink{structff_1_1x_thread_data_ab8f274c7461edc3f7ca078458b4a6f3d}{key}})}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{structff_1_1x_thread_data_a84773d1f5fd9166f38e3f4447d639d73}{leak}}(0),\ \mbox{\hyperlink{structff_1_1x_thread_data_ab8f274c7461edc3f7ca078458b4a6f3d}{key}}(\mbox{\hyperlink{structff_1_1x_thread_data_ab8f274c7461edc3f7ca078458b4a6f3d}{key}})\ \{}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//leak\ =\ (uSWSR\_Ptr\_Buffer*)::malloc(sizeof(uSWSR\_Ptr\_Buffer));}}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1x_thread_data_a84773d1f5fd9166f38e3f4447d639d73}{leak}}\ =\ (\mbox{\hyperlink{classff_1_1u_s_w_s_r___ptr___buffer}{uSWSR\_Ptr\_Buffer}}*)\mbox{\hyperlink{sysdep_8h_ae77dd87ccd6c736ac3eb1aa624d05269}{getAlignedMemory}}(128,\textcolor{keyword}{sizeof}(\mbox{\hyperlink{classff_1_1u_s_w_s_r___ptr___buffer}{uSWSR\_Ptr\_Buffer}}));}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{structff_1_1x_thread_data_a84773d1f5fd9166f38e3f4447d639d73}{leak}})\ abort();}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{new}\ (\mbox{\hyperlink{structff_1_1x_thread_data_a84773d1f5fd9166f38e3f4447d639d73}{leak}})\ \mbox{\hyperlink{classff_1_1u_s_w_s_r___ptr___buffer}{uSWSR\_Ptr\_Buffer}}(\mbox{\hyperlink{structff_1_1x_thread_data_af1871a4b69e59034158ed18580f1b393a0ea4993b80f25d6caaa4dacfb69ea79e}{LEAK\_CHUNK}});}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{structff_1_1x_thread_data_a84773d1f5fd9166f38e3f4447d639d73}{leak}}-\/>init())\ abort();}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00370\ }
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1x_thread_data_a49b8713327d424af3684168d0354b095}{\string~xThreadData}}()\ \{}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structff_1_1x_thread_data_a84773d1f5fd9166f38e3f4447d639d73}{leak}})\ \{\ \mbox{\hyperlink{structff_1_1x_thread_data_a84773d1f5fd9166f38e3f4447d639d73}{leak}}-\/>\string~uSWSR\_Ptr\_Buffer();\ \mbox{\hyperlink{sysdep_8h_a8d0b69a707e38b6ee06c8039cce3a9ae}{freeAlignedMemory}}(\mbox{\hyperlink{structff_1_1x_thread_data_a84773d1f5fd9166f38e3f4447d639d73}{leak}});\ \}\ \textcolor{comment}{//\ free(leak)}}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00374\ \ \ \ \ }
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1u_s_w_s_r___ptr___buffer}{uSWSR\_Ptr\_Buffer}}\ *\ \mbox{\hyperlink{structff_1_1x_thread_data_a84773d1f5fd9166f38e3f4447d639d73}{leak}};\ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{pthread__minport__windows_8h_ad665cf4bf4a61dd23aab712d9c5e9d81}{pthread\_t}}\ \ \ \ \mbox{\hyperlink{structff_1_1x_thread_data_ab8f274c7461edc3f7ca078458b4a6f3d}{key}};\ \ \ \ \textcolor{comment}{//\ used\ to\ identify\ a\ thread\ (threadID)}}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{structff_1_1x_thread_data_ac73358e84d1af154ce24a7578d2e16e5}{padding}}[\mbox{\hyperlink{namespaceff_ad0bc32203f6c871e1a6d21be4437d272}{longxCacheLine}}-\/((\textcolor{keyword}{sizeof}(\textcolor{keyword}{const}\ \mbox{\hyperlink{pthread__minport__windows_8h_ad665cf4bf4a61dd23aab712d9c5e9d81}{pthread\_t}})+\textcolor{keyword}{sizeof}(\mbox{\hyperlink{classff_1_1u_s_w_s_r___ptr___buffer}{uSWSR\_Ptr\_Buffer}}*))/\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{long}))];\ \textcolor{comment}{//}}
\DoxyCodeLine{00378\ \ \ \ \ \};}
\DoxyCodeLine{00379\ }
\DoxyCodeLine{00380\ \ \ \ \ \textcolor{comment}{/*\ }}
\DoxyCodeLine{00381\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ SlabCache}}
\DoxyCodeLine{00382\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ <-\/-\/-\/}}
\DoxyCodeLine{00383\ \textcolor{comment}{\ \ \ \ \ *\ \ \ |\ size\ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ |}}
\DoxyCodeLine{00384\ \textcolor{comment}{\ \ \ \ \ *\ \ \ |\ cur\ ptr\ seg\ \ \ \ \ |\ \ \ \ |}}
\DoxyCodeLine{00385\ \textcolor{comment}{\ \ \ \ \ *\ \ \ |\ availbuffers\ \ \ \ |\ \ \ \ |}}
\DoxyCodeLine{00386\ \textcolor{comment}{\ \ \ \ \ *\ \ \ |\ vect\ of\ buf-\/ptr\ |\ \ \ \ |}}
\DoxyCodeLine{00387\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ |}}
\DoxyCodeLine{00388\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/<-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/<-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00389\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00390\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ v\ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00391\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ (Slab\ segment)\ \ \ \ \ \ |\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00392\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ p\ |\ \ \ \ \ \ \ \ \ \ \ \ |\ p\ |}}
\DoxyCodeLine{00393\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |-\/-\/-\/|-\/\ cacheentry\ \ |\ t\ |\ \ \ \ data\ \ \ \ |\ t\ |\ \ \ \ data}}
\DoxyCodeLine{00394\ \textcolor{comment}{\ \ \ \ \ *\ \ <-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/|-\/\ allocator\ \ \ |\ r\ |\ \ \ \ \ \ \ \ \ \ \ \ |\ r\ |}}
\DoxyCodeLine{00395\ \textcolor{comment}{\ \ \ \ \ *\ \ \ (ptr\ to\ ff\_allocator)\ \ \ \ \ \ |-\/\ availbuffers|\ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ |}}
\DoxyCodeLine{00396\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00397\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ Seg\_ctl\ \ \ |\ \string^\ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \string^\ |}}
\DoxyCodeLine{00398\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00399\ \textcolor{comment}{\ \ \ \ \ *\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |-\/-\/-\/\ Buf\_ctl\ \ \ \ \ \ \ \ |-\/-\/-\/\ Buf\_ctl}}
\DoxyCodeLine{00400\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00401\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00402\ \textcolor{comment}{\ \ \ \ \ *\ \ NOTE:\ the\ segment\ overhead\ is:\ \ sizeof(Seg\_ctl)\ +\ (nbuffer\ *\ BUFFER\_OVERHEAD)}}
\DoxyCodeLine{00403\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00404\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00405\ }
\DoxyCodeLine{00406\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00407\ \textcolor{comment}{\ \ \ \ \ *\ \(\backslash\)class\ SlabCache}}
\DoxyCodeLine{00408\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00409\ \textcolor{comment}{\ \ \ \ \ *\ \(\backslash\)brief\ Cache\ of\ slab\ segments.}}
\DoxyCodeLine{00410\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00411\ \textcolor{comment}{\ \ \ \ \ *\ A\ SlabCache\ is\ meant\ to\ keep\ commonly\ used\ object\ in\ an\ initialised\ state,}}
\DoxyCodeLine{00412\ \textcolor{comment}{\ \ \ \ \ *\ available\ for\ use\ by\ kernel.\ Each\ cache\ contains\ blocks\ of\ contiguous\ pages}}
\DoxyCodeLine{00413\ \textcolor{comment}{\ \ \ \ \ *\ in\ memory\ (i.e.\ \(\backslash\)a\ slab\ segments).}}
\DoxyCodeLine{00414\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00415\ \textcolor{comment}{\ \ \ \ \ *\ Each\ slab\ segment\ consists\ of\ contiguous\ memory\ blocks,\ carved\ up\ into}}
\DoxyCodeLine{00416\ \textcolor{comment}{\ \ \ \ \ *\ equal-\/size\ chunks,\ with\ a\ reference\ count\ to\ indicate\ the\ number\ of}}
\DoxyCodeLine{00417\ \textcolor{comment}{\ \ \ \ \ *\ allocated\ chunks.}}
\DoxyCodeLine{00418\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00419\ \textcolor{comment}{\ \ \ \ \ *\ The\ SlabCache\ is\ used\ to\ implement\ the\ efficient\ lock-\/free\ allocator\ used\ in}}
\DoxyCodeLine{00420\ \textcolor{comment}{\ \ \ \ \ *\ FastFlow\ (\(\backslash\)p\ ff\_allocator),\ which\ is\ based\ on\ the}}
\DoxyCodeLine{00421\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00422\ \textcolor{comment}{\ \ \ \ \ *\ <a}}
\DoxyCodeLine{00423\ \textcolor{comment}{\ \ \ \ \ *\ href="{}http://www.ibm.com/developerworks/linux/library/l-\/linux-\/slab-\/allocator/"{}}}
\DoxyCodeLine{00424\ \textcolor{comment}{\ \ \ \ \ *\ target="{}\_blank"{}>Slab\ allocator</a>}}
\DoxyCodeLine{00425\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00426\ \textcolor{comment}{\ \ \ \ \ *\ At\ the\ beginning\ of\ each\ segment\ there\ is\ a\ Seg\_ctl\ structure,\ that\ is}}
\DoxyCodeLine{00427\ \textcolor{comment}{\ \ \ \ \ *\ responsible\ for\ maintaining\ the\ linkage\ with\ other\ slabs\ in\ the\ cache,\ keeps}}
\DoxyCodeLine{00428\ \textcolor{comment}{\ \ \ \ \ *\ track\ of\ the\ number\ of\ buffers\ in\ use\ and\ the\ number\ of\ available\ buffers.}}
\DoxyCodeLine{00429\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00430\ \textcolor{comment}{\ \ \ \ \ *\ Each\ buffer\ in\ the\ segment\ is\ managed\ by\ a\ Buf\_ctl\ structure,\ that\ holds\ a}}
\DoxyCodeLine{00431\ \textcolor{comment}{\ \ \ \ \ *\ back-\/pointer\ to\ the\ controlling\ slab.}}
\DoxyCodeLine{00432\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{00433\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00434\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classff_1_1_slab_cache_a1f9d288d5e3b06f97455c083b560d0a9}{SlabCache}}\ \{\ \ \ \ }
\DoxyCodeLine{00435\ \ \ \ \ \textcolor{keyword}{private}:\ \ \ \ }
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \textcolor{keyword}{enum}\ \{\mbox{\hyperlink{classff_1_1_slab_cache_a346691e882a42ea3f21c0312b95e8018a084b381fbabc8bf244f1a96b8f731104}{TICKS\_TO\_WAIT}}=500,\mbox{\hyperlink{classff_1_1_slab_cache_a346691e882a42ea3f21c0312b95e8018a92d7806a07103ec71c39f6547255f0eb}{TICKS\_CNT}}=3\};}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \textcolor{keyword}{enum}\ \{\mbox{\hyperlink{classff_1_1_slab_cache_a42bc05e9d5b6b4aceeffc20c5a0458dca6a5a3a4c7378180cd32a5c9c8893e777}{BUFFER\_OVERHEAD}}=\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}})\};}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \textcolor{keyword}{enum}\ \{\mbox{\hyperlink{classff_1_1_slab_cache_a447450b5773e2c4a750977797e41b71fa8d0317c9760fdf88f806744e1f06adeb}{MIN\_FB\_CAPACITY}}=32\};}
\DoxyCodeLine{00439\ \ \ \ \ }
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}}\ *\ \mbox{\hyperlink{classff_1_1_slab_cache_aab86f32e4c04c60521ef90129e7150a0}{getsegctl}}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *\ buf)\ \{}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *((\mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}}\ **)buf);}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00443\ }
\DoxyCodeLine{00444\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00445\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ This\ method\ creates\ a\ new\ slab,\ that\ is,\ it\ allocates\ a\ new\ segment\ of}}
\DoxyCodeLine{00446\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ large\ and\ possibly\ aligned\ memory.}}
\DoxyCodeLine{00447\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00448\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)returns\ 0\ if\ the\ creation\ of\ a\ new\ Slab\ succeedes;\ a\ negative\ value}}
\DoxyCodeLine{00449\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ otherwise.}}
\DoxyCodeLine{00450\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff_1_1_slab_cache_aaf75a579f4dd150507144d6e7ea02cb0}{newslab}}()\ \{}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00453\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ Allocate\ a\ large\ chunk\ of\ memory.\ The\ size\ of\ each\ chunk\ is\ equal\ to}}
\DoxyCodeLine{00454\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ the\ size\ of\ the\ slab\ buffer\ times\ the\ num\ of\ slubs\ in\ the\ segment}}
\DoxyCodeLine{00455\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ plus\ the\ segment\ overhead.}}
\DoxyCodeLine{00456\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00457\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ 'alloc'\ is\ of\ type\ SegmentAllocator}}
\DoxyCodeLine{00458\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}\ =\ \mbox{\hyperlink{classff_1_1_slab_cache_a7a342093b6ee8d1beb61144991138d64}{alloc}}-\/>newsegment(\ \mbox{\hyperlink{classff_1_1_slab_cache_a08fe5f765021928aa35f3fc7e0cbb24e}{size}}*\mbox{\hyperlink{classff_1_1_slab_cache_a702cb5918d08c3f04c5957545e2aef57}{nslabs}}\ +\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}})\ +}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a702cb5918d08c3f04c5957545e2aef57}{nslabs}}\ *\ \mbox{\hyperlink{classff_1_1_slab_cache_a42bc05e9d5b6b4aceeffc20c5a0458dca6a5a3a4c7378180cd32a5c9c8893e777}{BUFFER\_OVERHEAD}}\ );}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00462\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00463\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ If\ the\ allocation\ of\ the\ new\ segment\ succeedes,\ the\ pointer\ to\ the}}
\DoxyCodeLine{00464\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ newly\ allocated\ segment\ of\ memory\ becomes\ the\ new\ Segment\ controller}}
\DoxyCodeLine{00465\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ and\ all\ its\ embedded\ data\ are\ reset.}}
\DoxyCodeLine{00466\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \{}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}}\ *\ seg\ \ \ \ \ \ =\ (\mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}}\ *)\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}};\ \textcolor{comment}{//\ Segment\ controller}}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(seg-\/>refcount\ \ =\ 0);\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ number\ of\ buffers\ in\ use}}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ seg-\/>\mbox{\hyperlink{structff_1_1_seg__ctl_a44837b4e12e72be6c87fbb8142eebf89}{cacheentry}}\ \ \ \ =\ \textcolor{keyword}{this};\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ owner\ of\ the\ segment}}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ seg-\/>\mbox{\hyperlink{structff_1_1_seg__ctl_af833ba28f55b725b21484347f06697eb}{allocator}}\ \ \ \ \ =\ \mbox{\hyperlink{classff_1_1_slab_cache_aceaa50c4deafa58ef17c2b3673c1842c}{mainalloc}};\ \ \ \ \ \ \textcolor{comment}{//\ ref\ to\ the\ ff\_allocator}}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//atomic\_long\_set(\&seg-\/>availbuffers,nslabs);}}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ seg-\/>\mbox{\hyperlink{structff_1_1_seg__ctl_a094f541403cf6d508dc6712c0567be4f}{availbuffers}}\ =\ \mbox{\hyperlink{classff_1_1_slab_cache_a702cb5918d08c3f04c5957545e2aef57}{nslabs}};}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++seg;}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *(\mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}}\ **)seg\ =\ (\mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}}\ *)\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}};}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a08932cc48bc237fbd1fb93ff468dcfb0}{buffptr}}\ \ \ \ \ \ \ \ \ \ =\ (\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)seg;}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a27c506a87b5f119b6389e558ce8cb632}{availbuffers}}\ \ \ \ +=\ \mbox{\hyperlink{classff_1_1_slab_cache_a702cb5918d08c3f04c5957545e2aef57}{nslabs}};}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a07ed55814ceb8c89014147d71247736c}{seglist}}.push\_back(\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}});\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ add\ new\ slab\ into\ list\ of\ seg}}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00483\ }
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00485\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00486\ }
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00488\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Free\ a\ slab\ of\ memory\ previously\ allocated.\ This\ method\ frees\ the\ memory}}
\DoxyCodeLine{00489\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ segment\ pointed\ by\ 'ptr'.\ The\ size\ of\ the\ freed\ memory\ is\ exactly\ the}}
\DoxyCodeLine{00490\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ same\ size\ of\ the\ allocated\ segment:\ the\ size\ of\ the\ slab\ buffer\ times}}
\DoxyCodeLine{00491\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ the\ num\ of\ slubs\ in\ the\ segment\ plus\ the\ segment\ overhead.}}
\DoxyCodeLine{00492\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00493\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ By\ default,\ the\ 'seglist\_rem''\ is\ set\ to\ true.\ It\ means\ that\ it\ has\ to}}
\DoxyCodeLine{00494\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ remove\ the\ given\ pointer\ from\ the\ list\ of\ pointers\ that\ point\ to\ active}}
\DoxyCodeLine{00495\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ memory\ chunks.}}
\DoxyCodeLine{00496\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00497\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff_1_1_slab_cache_ab971f6f7d11425dad0f84e49f92d3856}{freeslab}}(\textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}},\ \textcolor{keywordtype}{bool}\ seglist\_rem=\textcolor{keyword}{true})\ \{}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a7a342093b6ee8d1beb61144991138d64}{alloc}}-\/>freesegment(\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}},\ \mbox{\hyperlink{classff_1_1_slab_cache_a08fe5f765021928aa35f3fc7e0cbb24e}{size}}*\mbox{\hyperlink{classff_1_1_slab_cache_a702cb5918d08c3f04c5957545e2aef57}{nslabs}}\ +\ \ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}})\ +\ \mbox{\hyperlink{classff_1_1_slab_cache_a702cb5918d08c3f04c5957545e2aef57}{nslabs}}\ *\ \mbox{\hyperlink{classff_1_1_slab_cache_a42bc05e9d5b6b4aceeffc20c5a0458dca6a5a3a4c7378180cd32a5c9c8893e777}{BUFFER\_OVERHEAD}}\ );}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00501\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (seglist\_rem)\ \{\ \ \ \ \ \ \textcolor{comment}{/*\ remove\ ptr\ from\ seglist\ */}}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1svector_a82c249e1a0efe0f1e5a377fa8b692978}{svector<void\ *>::iterator}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}(\mbox{\hyperlink{classff_1_1_slab_cache_a07ed55814ceb8c89014147d71247736c}{seglist}}.begin()),\ \mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}}(\mbox{\hyperlink{classff_1_1_slab_cache_a07ed55814ceb8c89014147d71247736c}{seglist}}.end());}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(;\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}!=\mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}};++\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})==\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \{}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a07ed55814ceb8c89014147d71247736c}{seglist}}.erase(\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}});}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(assert(1==0));}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00511\ }
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00513\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ This\ function\ is\ called\ when\ freeing\ a\ slab\ and\ the\ allocator\ has\ been}}
\DoxyCodeLine{00514\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ deregistered.\ It\ checks\ whether\ the\ memory\ occupied\ by\ the\ slab\ segment}}
\DoxyCodeLine{00515\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ given\ as\ argument\ can\ actually\ be\ deallocated.\ And\ this\ is\ possible\ when}}
\DoxyCodeLine{00516\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ none\ of\ the\ slab\ buffers\ are\ in\ use.\ In\ this\ case,\ the\ memory\ occupied}}
\DoxyCodeLine{00517\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ by\ the\ slab\ segment\ can\ be\ deallocated\ and\ the\ segment\ removed\ from\ the}}
\DoxyCodeLine{00518\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ list\ of\ segments.}}
\DoxyCodeLine{00519\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00520\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)returns\ true\ if\ the\ operation\ suceeds;\ false\ otherwise.}}
\DoxyCodeLine{00521\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classff_1_1_slab_cache_ae7edea362b76f8dd7f5a17c2457be0ee}{checkReclaim}}(\mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}}\ \ *\ seg)\ \{}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}}=\textcolor{keyword}{false};}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ \ \ \ \ spin\_lock(\mbox{\hyperlink{classff_1_1_slab_cache_a98bbf636229dfcc1b919e81f3d9bd5ae}{lock}});\ \ \ \ \textcolor{comment}{//\ per-\/cache\ locking}}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(assert(seg-\/>\mbox{\hyperlink{structff_1_1_seg__ctl_a094f541403cf6d508dc6712c0567be4f}{availbuffers}}\ <=\ (\textcolor{keywordtype}{unsigned})\mbox{\hyperlink{classff_1_1_slab_cache_a702cb5918d08c3f04c5957545e2aef57}{nslabs}}));}
\DoxyCodeLine{00526\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (++(seg-\/>\mbox{\hyperlink{structff_1_1_seg__ctl_a094f541403cf6d508dc6712c0567be4f}{availbuffers}})\ ==\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long})\mbox{\hyperlink{classff_1_1_slab_cache_a702cb5918d08c3f04c5957545e2aef57}{nslabs}})\ \{}
\DoxyCodeLine{00527\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_ab971f6f7d11425dad0f84e49f92d3856}{freeslab}}(seg);\ \textcolor{comment}{/*\ Free\ the\ given\ segment\ of\ memory\ (a\ slab)\ */}}
\DoxyCodeLine{00528\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}}=\textcolor{keyword}{true};}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \ \ \ \ \ \ spin\_unlock(\mbox{\hyperlink{classff_1_1_slab_cache_a98bbf636229dfcc1b919e81f3d9bd5ae}{lock}});}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}};}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00533\ }
\DoxyCodeLine{00534\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff_1_1_slab_cache_a39392c85cc3d3f302db3da59f7ccb1b6}{checkReclaimD}}(\mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}}\ \ *\ seg)\ \{}
\DoxyCodeLine{00535\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (++(seg-\/>\mbox{\hyperlink{structff_1_1_seg__ctl_a094f541403cf6d508dc6712c0567be4f}{availbuffers}})\ ==\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long})\mbox{\hyperlink{classff_1_1_slab_cache_a702cb5918d08c3f04c5957545e2aef57}{nslabs}})\ \{}
\DoxyCodeLine{00536\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_ab971f6f7d11425dad0f84e49f92d3856}{freeslab}}(seg);\ \textcolor{comment}{/*\ Free\ the\ given\ segment\ of\ memory\ (a\ slab)\ */}}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00539\ }
\DoxyCodeLine{00540\ }
\DoxyCodeLine{00541\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ REW}}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ The\ following\ have\ to\ be\ checked\ if\ it\ can\ use\ the\ last\ queue}}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ index\ \ as\ in\ the\ getfrom\_fb()\ method\ !!!!!}}
\DoxyCodeLine{00544\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00545\ }
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{classff_1_1_slab_cache_a207f4fd0af05e4d67594642fe83ad23b}{getfrom\_fb\_delayed}}()\ \{}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1_slab_cache_ac387629cd72732ea8a3a9159fc51fb9b}{fb\_size}}==1)\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=1;\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{classff_1_1_slab_cache_ac387629cd72732ea8a3a9159fc51fb9b}{fb\_size}};++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>leak-\/>length()<(\textcolor{keywordtype}{unsigned})\mbox{\hyperlink{classff_1_1_slab_cache_a826bdca9f0fded7aedfcddfe6ef2eb21}{delayedReclaim}})\ \ \{}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;\ \textcolor{comment}{//\ cache\ is\ empty}}
\DoxyCodeLine{00551\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00553\ }
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{union\ }\{\ \mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *\ buf;\ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}};\ \}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}=\{\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\};}
\DoxyCodeLine{00555\ }
\DoxyCodeLine{00556\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=2;\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{classff_1_1_slab_cache_ac387629cd72732ea8a3a9159fc51fb9b}{fb\_size}};++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{00557\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>leak-\/>pop(\&\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}.ptr);}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(assert(\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}.ptr));}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a39392c85cc3d3f302db3da59f7ccb1b6}{checkReclaimD}}(\mbox{\hyperlink{classff_1_1_slab_cache_aab86f32e4c04c60521ef90129e7150a0}{getsegctl}}(\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}.buf));}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00561\ }
\DoxyCodeLine{00562\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}}[1]-\/>leak-\/>pop(\&\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}.ptr);}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>leakremoved.fetch\_add(1));}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}.ptr;}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00566\ }
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{classff_1_1_slab_cache_ae6f0300f7619e38adf975fb5f091d078}{getfrom\_fb}}()\ \{}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\ buf\ =\ 0;}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=0;\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{classff_1_1_slab_cache_ac387629cd72732ea8a3a9159fc51fb9b}{fb\_size}};++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ k=(\mbox{\hyperlink{classff_1_1_slab_cache_a389805085c805d29064891f8120422af}{lastqueue}}+\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\%\mbox{\hyperlink{classff_1_1_slab_cache_ac387629cd72732ea8a3a9159fc51fb9b}{fb\_size}};}
\DoxyCodeLine{00571\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}}[k]-\/>leak-\/>pop((\textcolor{keywordtype}{void}\ **)\&buf))\ \{}
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>leakremoved.fetch\_add(1));}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a389805085c805d29064891f8120422af}{lastqueue}}=k;}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ buf;}
\DoxyCodeLine{00575\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00577\ }
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ free\ buffers\ are\ empty}}
\DoxyCodeLine{00579\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00580\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00581\ }
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff_1_1_slab_cache_a52b4a51e7c788b16b72fd82ff600af3f}{searchfb}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{pthread__minport__windows_8h_ad665cf4bf4a61dd23aab712d9c5e9d81}{pthread\_t}}\ \mbox{\hyperlink{ittnotify__static_8h_aeeaf6235e69da2907f537f67e598fc9d}{key}})\ \{}
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=0;\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{classff_1_1_slab_cache_ac387629cd72732ea8a3a9159fc51fb9b}{fb\_size}};++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{00584\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>\mbox{\hyperlink{ittnotify__static_8h_aeeaf6235e69da2907f537f67e598fc9d}{key}}\ ==\ \mbox{\hyperlink{ittnotify__static_8h_aeeaf6235e69da2907f537f67e598fc9d}{key}})\ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{int})\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}};}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00587\ }
\DoxyCodeLine{00588\ \ \ \ \ \textcolor{keyword}{public}:\ }
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00590\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Default\ Constructor}}
\DoxyCodeLine{00591\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00592\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \ \(\backslash\)param\ mainalloc\ a\ pointer\ to\ the\ allocator\ used\ (must\ be\ of\ type}}
\DoxyCodeLine{00593\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \ \(\backslash\)p\ ff\_allocator).}}
\DoxyCodeLine{00594\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \ \(\backslash\)param\ delayedReclaim\ a\ flag\ to...\ REW}}
\DoxyCodeLine{00595\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \ \(\backslash\)param\ alloc\ a\ pointer\ to\ a\ \(\backslash\)p\ SegmentAllocator\ object,\ used\ to\ obtain\ large}}
\DoxyCodeLine{00596\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \ (and\ possibly\ aligned)\ chunks\ of\ memory\ from\ the\ operating\ system.}}
\DoxyCodeLine{00597\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \ \(\backslash\)param\ sz\ the\ size\ of\ each\ buffer\ in\ a\ segment\ of\ the\ slab\ cache.}}
\DoxyCodeLine{00598\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \ \(\backslash\)param\ ns\ number\ of\ buffers\ (slabs)\ in\ each\ segment\ (note\ that,\ as\ the}}
\DoxyCodeLine{00599\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \ size\ of\ each\ buffer\ increases,\ the\ number\ of\ buffers\ in\ each\ segment}}
\DoxyCodeLine{00600\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \ decreases).}}
\DoxyCodeLine{00601\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00602\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a1f9d288d5e3b06f97455c083b560d0a9}{SlabCache}}(\ \mbox{\hyperlink{classff_1_1ff__allocator}{ff\_allocator}}\ *\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classff_1_1_slab_cache_aceaa50c4deafa58ef17c2b3673c1842c}{mainalloc}},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff_1_1_slab_cache_a826bdca9f0fded7aedfcddfe6ef2eb21}{delayedReclaim}},}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_segment_allocator}{SegmentAllocator}}\ *\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classff_1_1_slab_cache_a7a342093b6ee8d1beb61144991138d64}{alloc}},\ \textcolor{keywordtype}{size\_t}\ sz,\ \textcolor{keywordtype}{int}\ ns\ )}
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classff_1_1_slab_cache_a08fe5f765021928aa35f3fc7e0cbb24e}{size}}(sz),\ \mbox{\hyperlink{classff_1_1_slab_cache_a702cb5918d08c3f04c5957545e2aef57}{nslabs}}(ns),\ \mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}}(0),\ \mbox{\hyperlink{classff_1_1_slab_cache_a50f89c58c8382eec8610c20c8781e899}{fb\_capacity}}(0),\ \mbox{\hyperlink{classff_1_1_slab_cache_ac387629cd72732ea8a3a9159fc51fb9b}{fb\_size}}(0),}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a08932cc48bc237fbd1fb93ff468dcfb0}{buffptr}}(0),\ \mbox{\hyperlink{classff_1_1_slab_cache_a27c506a87b5f119b6389e558ce8cb632}{availbuffers}}(0),\ \mbox{\hyperlink{classff_1_1_slab_cache_a7a342093b6ee8d1beb61144991138d64}{alloc}}(\mbox{\hyperlink{classff_1_1_slab_cache_a7a342093b6ee8d1beb61144991138d64}{alloc}}),}
\DoxyCodeLine{00607\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_aceaa50c4deafa58ef17c2b3673c1842c}{mainalloc}}(\mbox{\hyperlink{classff_1_1_slab_cache_aceaa50c4deafa58ef17c2b3673c1842c}{mainalloc}}),\ \mbox{\hyperlink{classff_1_1_slab_cache_a826bdca9f0fded7aedfcddfe6ef2eb21}{delayedReclaim}}(\mbox{\hyperlink{classff_1_1_slab_cache_a826bdca9f0fded7aedfcddfe6ef2eb21}{delayedReclaim}}),\mbox{\hyperlink{classff_1_1_slab_cache_a389805085c805d29064891f8120422af}{lastqueue}}(0)\ \{\ \}}
\DoxyCodeLine{00608\ \ \ \ \ }
\DoxyCodeLine{00612\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a21609044273bf919dc302d968f6b21dd}{\string~SlabCache}}()\ \{}
\DoxyCodeLine{00613\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classff_1_1_slab_cache_a702cb5918d08c3f04c5957545e2aef57}{nslabs}})\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00614\ }
\DoxyCodeLine{00615\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1svector_a82c249e1a0efe0f1e5a377fa8b692978}{svector<void\ *>::iterator}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}(\mbox{\hyperlink{classff_1_1_slab_cache_a07ed55814ceb8c89014147d71247736c}{seglist}}.begin()),\ \mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}}(\mbox{\hyperlink{classff_1_1_slab_cache_a07ed55814ceb8c89014147d71247736c}{seglist}}.end());}
\DoxyCodeLine{00616\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(;\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}!=\mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}};++\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})\ \{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ just\ check\ the\ list\ is\ not\ empty}}
\DoxyCodeLine{00617\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_ab971f6f7d11425dad0f84e49f92d3856}{freeslab}}(*\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}},\textcolor{keyword}{false});\ \textcolor{comment}{//\ seglist\_rem\ =\ false:\ nothing\ is\ removed}}
\DoxyCodeLine{00618\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a07ed55814ceb8c89014147d71247736c}{seglist}}.clear();\ \ \ \ \ \ \ \ \textcolor{comment}{//\ clear\ the\ list}}
\DoxyCodeLine{00620\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}})\ \{}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=0;\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{classff_1_1_slab_cache_ac387629cd72732ea8a3a9159fc51fb9b}{fb\_size}};++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}])\ \{}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>\string~xThreadData();}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mimalloc-override_8h_a9d4b5df3530d1bc733070a4669ba6ebc}{::free}}(\mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]);}
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00626\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mimalloc-override_8h_a9d4b5df3530d1bc733070a4669ba6ebc}{::free}}(\mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}});}
\DoxyCodeLine{00627\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00628\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00629\ }
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00631\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Initialise\ a\ new\ SlabCache.}}
\DoxyCodeLine{00632\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00633\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ This\ method\ creates\ a\ new\ slab,\ that\ is,}}
\DoxyCodeLine{00634\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ it\ allocates\ space\ for\ an\ unbounded\ buffer\ built\ upon\ the}}
\DoxyCodeLine{00635\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ uSWSR\_Ptr\_Buffer.\ Then\ it\ creates\ a\ new\ segment\ of\ large\ and\ (possibly)}}
\DoxyCodeLine{00636\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ aligned\ memory.\ The\ initial\ size\ of\ the\ buffer\ -\/\ set\ to\ a\ minimum\ value}}
\DoxyCodeLine{00637\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ equal\ to\ 32\ -\/\ can\ be\ later\ increased,\ if\ necessary.}}
\DoxyCodeLine{00638\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00639\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)param\ prealloc\ flag\ that\ act\ as\ a\ mask\ against\ the\ creation\ of\ a\ new}}
\DoxyCodeLine{00640\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Slab.\ By\ default\ it\ is\ set\ to\ \(\backslash\)p\ true.}}
\DoxyCodeLine{00641\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00642\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)returns\ 0\ if\ the\ creation\ of\ a\ new\ Slab\ succeedes\ and\ the\ prealloc\ mask}}
\DoxyCodeLine{00643\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ is\ set\ to\ \(\backslash\)p\ true\ OR\ if\ the\ creation\ of\ a\ new\ Slab\ fails\ and\ the}}
\DoxyCodeLine{00644\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ prealloc\ mask\ is\ set\ to\ \(\backslash\)p\ false.\ Gives\ a\ negative\ value\ otherwise.}}
\DoxyCodeLine{00645\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff_1_1_slab_cache_a2ed10bdaaf2ce6c1936799e4ba800956}{init}}(\textcolor{keywordtype}{bool}\ prealloc=\textcolor{keyword}{true})\ \{}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classff_1_1_slab_cache_a702cb5918d08c3f04c5957545e2aef57}{nslabs}})\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00648\ }
\DoxyCodeLine{00649\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_aaa08e4d3dc71584104be728163169549}{nomoremalloc}}.store(0);\ \ \ \textcolor{comment}{//\ atomic\ variable\ set\ to\ 0}}
\DoxyCodeLine{00650\ }
\DoxyCodeLine{00651\ \ \ \ \ \ \ \ \ \ \ \ \ init\_unlocked(\mbox{\hyperlink{classff_1_1_slab_cache_a98bbf636229dfcc1b919e81f3d9bd5ae}{lock}});}
\DoxyCodeLine{00652\ }
\DoxyCodeLine{00653\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Allocate\ space\ for\ leak\ queue\ */}}
\DoxyCodeLine{00654\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}}\ =\ (\mbox{\hyperlink{structff_1_1x_thread_data}{xThreadData}}**)\mbox{\hyperlink{mimalloc-override_8h_a99aa8fd9f4831e1b0fa9e1cdcde3e249}{::malloc}}(\mbox{\hyperlink{classff_1_1_slab_cache_a447450b5773e2c4a750977797e41b71fa8d0317c9760fdf88f806744e1f06adeb}{MIN\_FB\_CAPACITY}}*\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1x_thread_data}{xThreadData}}*));}
\DoxyCodeLine{00655\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}})\ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00656\ }
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a50f89c58c8382eec8610c20c8781e899}{fb\_capacity}}\ =\ \mbox{\hyperlink{classff_1_1_slab_cache_a447450b5773e2c4a750977797e41b71fa8d0317c9760fdf88f806744e1f06adeb}{MIN\_FB\_CAPACITY}};\ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00658\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ prealloc\ \&\&\ (\mbox{\hyperlink{classff_1_1_slab_cache_aaf75a579f4dd150507144d6e7ea02cb0}{newslab}}()<0)\ )\ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00661\ \ \ \ \ }
\DoxyCodeLine{00662\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00663\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Register\ the\ calling\ thread\ into\ the\ shared\ buffer\ (leak\ queue).\(\backslash\)n}}
\DoxyCodeLine{00664\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ In\ case\ the\ thread\ (ID)\ is\ already\ registered\ in\ the\ buffer,\ it\ returns\ a}}
\DoxyCodeLine{00665\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ pointer\ to\ its\ position\ in\ the\ buffer.\ If\ it\ is\ not\ registered,\ then}}
\DoxyCodeLine{00666\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ allocates\ space\ for\ a\ new\ thread's\ buffer\ and\ initialise\ the\ new\ buffer}}
\DoxyCodeLine{00667\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ with\ the\ key\ of\ the\ new\ thread.\ The\ \(\backslash\)p\ allocator\ flag\ is\ set\ to\ false.}}
\DoxyCodeLine{00668\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00669\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)param\ allocator\ \(\backslash\)p\ true\ if\ the\ calling\ thread\ is\ the\ allocator\ thread;}}
\DoxyCodeLine{00670\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)p\ false\ by\ default.}}
\DoxyCodeLine{00671\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)returns\ a\ pointer\ to\ the\ allocated\ thread\ in\ the\ buffer.}}
\DoxyCodeLine{00672\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00673\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \mbox{\hyperlink{structff_1_1x_thread_data}{xThreadData}}\ *\ \mbox{\hyperlink{classff_1_1_slab_cache_a775f0081648d1d7909e1a8908796d628}{register4free}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ allocator=\textcolor{keyword}{false})\ \{}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(assert(\mbox{\hyperlink{classff_1_1_slab_cache_a702cb5918d08c3f04c5957545e2aef57}{nslabs}}>0));}
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00676\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pthread__minport__windows_8h_ad665cf4bf4a61dd23aab712d9c5e9d81}{pthread\_t}}\ \mbox{\hyperlink{ittnotify__static_8h_aeeaf6235e69da2907f537f67e598fc9d}{key}}=\ \mbox{\hyperlink{pthread__minport__windows_8h_a31ffbf449d7404f9bb088564190c6bce}{pthread\_self}}();\ \ \textcolor{comment}{//\ obtain\ ID\ of\ the\ calling\ thread}}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ entry\ =\ \mbox{\hyperlink{classff_1_1_slab_cache_a52b4a51e7c788b16b72fd82ff600af3f}{searchfb}}(\mbox{\hyperlink{ittnotify__static_8h_aeeaf6235e69da2907f537f67e598fc9d}{key}});\ \ \ \ \ \ \textcolor{comment}{//\ search\ for\ threadID\ in\ leak\ queue}}
\DoxyCodeLine{00678\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry<0)\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ threadID\ not\ found}}
\DoxyCodeLine{00679\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ allocate\ a\ new\ buffer\ for\ thread\ 'key'}}
\DoxyCodeLine{00680\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1x_thread_data}{xThreadData}}\ *\ xtd\ =\ (\mbox{\hyperlink{structff_1_1x_thread_data}{xThreadData}}*)\mbox{\hyperlink{mimalloc-override_8h_a99aa8fd9f4831e1b0fa9e1cdcde3e249}{::malloc}}(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1x_thread_data}{xThreadData}}));}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!xtd)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00682\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{new}\ (xtd)\ \mbox{\hyperlink{structff_1_1x_thread_data}{xThreadData}}(allocator,\ \mbox{\hyperlink{classff_1_1_slab_cache_a702cb5918d08c3f04c5957545e2aef57}{nslabs}},\ \mbox{\hyperlink{ittnotify__static_8h_aeeaf6235e69da2907f537f67e598fc9d}{key}});}
\DoxyCodeLine{00683\ }
\DoxyCodeLine{00684\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00685\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *\ REW}}
\DoxyCodeLine{00686\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *\ if\ the\ size\ of\ the\ existing\ leak\ queue\ has\ reached\ the\ max}}
\DoxyCodeLine{00687\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *\ capacity,\ allocate\ more\ space\ (::realloc)\ and\ update\ the\ queue's}}
\DoxyCodeLine{00688\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *\ capacity.\ These\ operations\ are\ thread\ safe\ (mutual\ exclusion).}}
\DoxyCodeLine{00689\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00690\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ spin\_lock(\mbox{\hyperlink{classff_1_1_slab_cache_a98bbf636229dfcc1b919e81f3d9bd5ae}{lock}});}
\DoxyCodeLine{00691\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1_slab_cache_ac387629cd72732ea8a3a9159fc51fb9b}{fb\_size}}==\mbox{\hyperlink{classff_1_1_slab_cache_a50f89c58c8382eec8610c20c8781e899}{fb\_capacity}})\ \{}
\DoxyCodeLine{00692\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1x_thread_data}{xThreadData}}\ **\ fb\_new\ =\ (\mbox{\hyperlink{structff_1_1x_thread_data}{xThreadData}}**)\mbox{\hyperlink{mimalloc-override_8h_adbbb9b1695e5714db8873077d44ade2f}{::realloc}}(\ \mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}},}
\DoxyCodeLine{00693\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{classff_1_1_slab_cache_a50f89c58c8382eec8610c20c8781e899}{fb\_capacity}}+\mbox{\hyperlink{classff_1_1_slab_cache_a447450b5773e2c4a750977797e41b71fa8d0317c9760fdf88f806744e1f06adeb}{MIN\_FB\_CAPACITY}})\ *\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1x_thread_data}{xThreadData}}*)\ );}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!fb\_new)\ \{}
\DoxyCodeLine{00695\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ spin\_unlock(\mbox{\hyperlink{classff_1_1_slab_cache_a98bbf636229dfcc1b919e81f3d9bd5ae}{lock}});}
\DoxyCodeLine{00696\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}}\ =\ fb\_new;}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a50f89c58c8382eec8610c20c8781e899}{fb\_capacity}}\ +=\ \mbox{\hyperlink{classff_1_1_slab_cache_a447450b5773e2c4a750977797e41b71fa8d0317c9760fdf88f806744e1f06adeb}{MIN\_FB\_CAPACITY}};}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00701\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ add\ the\ new\ buffer\ to\ the\ leak\ queue\ and\ release\ lock}}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}}[entry=(\mbox{\hyperlink{sugar_8h_ae4f82344f573c70aa1066a2394bba345}{int}})\ \mbox{\hyperlink{classff_1_1_slab_cache_ac387629cd72732ea8a3a9159fc51fb9b}{fb\_size}}++]\ =\ xtd;}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ spin\_unlock(\mbox{\hyperlink{classff_1_1_slab_cache_a98bbf636229dfcc1b919e81f3d9bd5ae}{lock}});}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(assert(\mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}}[entry]-\/>\mbox{\hyperlink{ittnotify__static_8h_aeeaf6235e69da2907f537f67e598fc9d}{key}}\ ==\ \mbox{\hyperlink{ittnotify__static_8h_aeeaf6235e69da2907f537f67e598fc9d}{key}}));}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}}[entry];\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ position\ of\ new\ entry\ in\ buffer}}
\DoxyCodeLine{00707\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00708\ }
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00710\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Deregister\ the\ allocator\ thread\ and\ reclaim\ memory}}
\DoxyCodeLine{00711\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00712\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff_1_1_slab_cache_aefed8b3ddf3a371444a9628ac362d922}{deregisterAllocator}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ reclaim)\ \{}
\DoxyCodeLine{00713\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(assert(\mbox{\hyperlink{classff_1_1_slab_cache_a702cb5918d08c3f04c5957545e2aef57}{nslabs}}>0));}
\DoxyCodeLine{00714\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(assert(\mbox{\hyperlink{classff_1_1_slab_cache_a826bdca9f0fded7aedfcddfe6ef2eb21}{delayedReclaim}}==0));}
\DoxyCodeLine{00715\ }
\DoxyCodeLine{00716\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ atomic\ variable\ set\ to\ 1:\ allocator\ has\ been\ deregistered}}
\DoxyCodeLine{00717\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ and\ prevented\ from\ allocating}}
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_aaa08e4d3dc71584104be728163169549}{nomoremalloc}}.store(1);}
\DoxyCodeLine{00719\ }
\DoxyCodeLine{00720\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ try\ to\ reclaim\ some\ memory}}
\DoxyCodeLine{00721\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=0;\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{classff_1_1_slab_cache_ac387629cd72732ea8a3a9159fc51fb9b}{fb\_size}};++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(assert(\mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]));}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (reclaim)\ \{}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{union\ }\{\ \mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *\ buf2;\ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}};\ \}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}=\{\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\};}
\DoxyCodeLine{00725\ }
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>leak-\/>pop(\&\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}.ptr))\ \{\ \ \ \textcolor{comment}{//\ while\ pop\ \ succeedes}}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_ae7edea362b76f8dd7f5a17c2457be0ee}{checkReclaim}}(\mbox{\hyperlink{classff_1_1_slab_cache_aab86f32e4c04c60521ef90129e7150a0}{getsegctl}}(\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}.buf2));}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00730\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00731\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00732\ }
\DoxyCodeLine{00733\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00734\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Get\ an\ item\ from\ a\ Slab\ segment.}}
\DoxyCodeLine{00735\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00736\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)returns\ a\ pointer\ to\ the\ item\ obtained}}
\DoxyCodeLine{00737\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00738\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{classff_1_1_slab_cache_ae5af7f1f395d27f056cc6cda4a4e5471}{getitem}}()\ \{}
\DoxyCodeLine{00739\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(assert(\mbox{\hyperlink{classff_1_1_slab_cache_a702cb5918d08c3f04c5957545e2aef57}{nslabs}}>0));}
\DoxyCodeLine{00740\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\ item\ =\ 0;}
\DoxyCodeLine{00741\ }
\DoxyCodeLine{00742\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ try\ to\ get\ one\ item\ from\ the\ available\ ones\ */}}
\DoxyCodeLine{00743\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1_slab_cache_a27c506a87b5f119b6389e558ce8cb632}{availbuffers}})\ \{}
\DoxyCodeLine{00744\ \ \ \ \ \ \ \ \ \ \ \ \ avail:}
\DoxyCodeLine{00745\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}}\ *\ seg\ =\ *((\mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}}\ **)\mbox{\hyperlink{classff_1_1_slab_cache_a08932cc48bc237fbd1fb93ff468dcfb0}{buffptr}});}
\DoxyCodeLine{00746\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(assert(seg));}
\DoxyCodeLine{00747\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(++seg-\/>refcount);\ \ \ \ \ \ \ \textcolor{comment}{//\ incr\ num\ buffers\ in\ use}}
\DoxyCodeLine{00748\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/(seg-\/>\mbox{\hyperlink{structff_1_1_seg__ctl_a094f541403cf6d508dc6712c0567be4f}{availbuffers}});\ \ \ \ \ \ \textcolor{comment}{//\ decr\ available\ buffers}}
\DoxyCodeLine{00749\ }
\DoxyCodeLine{00750\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(\textcolor{keywordflow}{if}\ (seg-\/>refcount==1)\ assert(\mbox{\hyperlink{classff_1_1_slab_cache_a27c506a87b5f119b6389e558ce8cb632}{availbuffers}}==\mbox{\hyperlink{classff_1_1_slab_cache_a702cb5918d08c3f04c5957545e2aef57}{nslabs}}));}
\DoxyCodeLine{00751\ }
\DoxyCodeLine{00752\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ item\ =\ (\textcolor{keywordtype}{char}\ *)\mbox{\hyperlink{classff_1_1_slab_cache_a08932cc48bc237fbd1fb93ff468dcfb0}{buffptr}}\ +\ \mbox{\hyperlink{classff_1_1_slab_cache_a42bc05e9d5b6b4aceeffc20c5a0458dca6a5a3a4c7378180cd32a5c9c8893e777}{BUFFER\_OVERHEAD}};\ \ \ \textcolor{comment}{//\ set\ data\ pointer}}
\DoxyCodeLine{00753\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (-\/-\/\mbox{\hyperlink{classff_1_1_slab_cache_a27c506a87b5f119b6389e558ce8cb632}{availbuffers}})\ \{}
\DoxyCodeLine{00754\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}}\ **\ ctl\ \ \ =\ (\mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}}\ **)((\textcolor{keywordtype}{char}\ *)item\ +\ \mbox{\hyperlink{classff_1_1_slab_cache_a08fe5f765021928aa35f3fc7e0cbb24e}{size}});}
\DoxyCodeLine{00755\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *ctl\ \ \ \ \ \ \ \ \ \ \ \ \ =\ seg;}
\DoxyCodeLine{00756\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a08932cc48bc237fbd1fb93ff468dcfb0}{buffptr}}\ \ \ \ \ \ \ \ \ \ =\ (\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)ctl;}
\DoxyCodeLine{00757\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \mbox{\hyperlink{classff_1_1_slab_cache_a08932cc48bc237fbd1fb93ff468dcfb0}{buffptr}}\ =\ 0;}
\DoxyCodeLine{00758\ }
\DoxyCodeLine{00759\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(\ \textcolor{keywordflow}{if}\ ((\mbox{\hyperlink{classff_1_1_slab_cache_aab86f32e4c04c60521ef90129e7150a0}{getsegctl}}((\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)((\textcolor{keywordtype}{char}\ *)item\ -\/}
\DoxyCodeLine{00760\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}))))-\/>allocator\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})}
\DoxyCodeLine{00761\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ abort()\ );}
\DoxyCodeLine{00762\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ item;}
\DoxyCodeLine{00763\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00764\ }
\DoxyCodeLine{00765\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ else,\ try\ to\ get\ a\ free\ item\ from\ cache}}
\DoxyCodeLine{00766\ \ \ \ \ \ \ \ \ \ \ \ \ item\ =\ \mbox{\hyperlink{classff_1_1_slab_cache_a826bdca9f0fded7aedfcddfe6ef2eb21}{delayedReclaim}}\ ?\ \mbox{\hyperlink{classff_1_1_slab_cache_a207f4fd0af05e4d67594642fe83ad23b}{getfrom\_fb\_delayed}}()\ :\ \mbox{\hyperlink{classff_1_1_slab_cache_ae6f0300f7619e38adf975fb5f091d078}{getfrom\_fb}}();}
\DoxyCodeLine{00767\ }
\DoxyCodeLine{00768\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (item)\ \{}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>hit.fetch\_add(1));}
\DoxyCodeLine{00770\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(\textcolor{keywordflow}{if}\ ((\mbox{\hyperlink{classff_1_1_slab_cache_aab86f32e4c04c60521ef90129e7150a0}{getsegctl}}((\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)item))-\/>allocator\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ abort());}
\DoxyCodeLine{00771\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ((\textcolor{keywordtype}{char}\ *)item\ +\ \mbox{\hyperlink{classff_1_1_slab_cache_a42bc05e9d5b6b4aceeffc20c5a0458dca6a5a3a4c7378180cd32a5c9c8893e777}{BUFFER\_OVERHEAD}});}
\DoxyCodeLine{00772\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00773\ }
\DoxyCodeLine{00774\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>miss.fetch\_add(1));}
\DoxyCodeLine{00775\ }
\DoxyCodeLine{00776\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ if\ there\ are\ not\ available\ items\ try\ to\ allocate\ a\ new\ slab\ */}}
\DoxyCodeLine{00777\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1_slab_cache_aaf75a579f4dd150507144d6e7ea02cb0}{newslab}}()<0)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00778\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{goto}\ avail;}
\DoxyCodeLine{00779\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};\ \textcolor{comment}{//\ not\ reached}}
\DoxyCodeLine{00780\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00781\ }
\DoxyCodeLine{00782\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00783\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Push\ an\ item\ into\ the\ slab}}
\DoxyCodeLine{00784\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00785\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)return\ false\ if\ the\ operation\ succedes;\ true\ if\ some\ memory\ has\ been}}
\DoxyCodeLine{00786\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ reclaimed}}
\DoxyCodeLine{00787\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00788\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classff_1_1_slab_cache_a46e04d141dd4bc5e59c805287966db0a}{putitem}}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *\ buf)\ \{}
\DoxyCodeLine{00789\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(assert(buf));\ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(assert(\mbox{\hyperlink{classff_1_1_slab_cache_a702cb5918d08c3f04c5957545e2aef57}{nslabs}}>0));}
\DoxyCodeLine{00790\ }
\DoxyCodeLine{00791\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00792\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ If\ nomoremalloc\ is\ set\ to\ 1,\ it\ means\ the\ allocator\ has\ been}}
\DoxyCodeLine{00793\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ deregistered\ and\ the\ memory\ in\ segment\ 'seg'\ could\ have\ been}}
\DoxyCodeLine{00794\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ reclaimed.}}
\DoxyCodeLine{00795\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1_slab_cache_aaa08e4d3dc71584104be728163169549}{nomoremalloc}}.load())\ \{}
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ NOTE:\ if\ delayedReclaim\ is\ set,\ freeing\ threads\ cannot\ pass\ here}}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(assert(\mbox{\hyperlink{classff_1_1_slab_cache_a826bdca9f0fded7aedfcddfe6ef2eb21}{delayedReclaim}}==0));}
\DoxyCodeLine{00799\ }
\DoxyCodeLine{00800\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}}\ \ *\ seg\ =\ *(\mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}}\ **)buf;}
\DoxyCodeLine{00801\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff_1_1_slab_cache_ae7edea362b76f8dd7f5a17c2457be0ee}{checkReclaim}}(seg);\ \ \ \textcolor{comment}{//\ true\ if\ some\ memory\ can\ be\ reclaimed}}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00803\ }
\DoxyCodeLine{00804\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00805\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ If\ nomorealloc\ is\ 0,}}
\DoxyCodeLine{00806\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ entry\ =\ \mbox{\hyperlink{classff_1_1_slab_cache_a52b4a51e7c788b16b72fd82ff600af3f}{searchfb}}(\mbox{\hyperlink{pthread__minport__windows_8h_a31ffbf449d7404f9bb088564190c6bce}{pthread\_self}}());\ \ \ \textcolor{comment}{//\ look\ for\ calling\ thread}}
\DoxyCodeLine{00808\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1x_thread_data}{xThreadData}}\ *\ xtd\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00809\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry<0)\ xtd\ =\ \mbox{\hyperlink{classff_1_1_slab_cache_a775f0081648d1d7909e1a8908796d628}{register4free}}();\ \ \ \ \ \textcolor{comment}{//\ if\ not\ present,\ register\ it}}
\DoxyCodeLine{00810\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ xtd\ =\ \mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}}[entry];\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ else,\ point\ to\ its\ position}}
\DoxyCodeLine{00811\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(\textcolor{keywordflow}{if}\ (!xtd)\ abort());}
\DoxyCodeLine{00812\ \ \ \ \ \ \ \ \ \ \ \ \ xtd-\/>\mbox{\hyperlink{structff_1_1x_thread_data_a84773d1f5fd9166f38e3f4447d639d73}{leak}}-\/>\mbox{\hyperlink{classff_1_1u_s_w_s_r___ptr___buffer_adb1520445be2837b83a33995d2bf4e7f}{push}}((\textcolor{keywordtype}{void}\ *)buf);\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ push\ the\ item\ in\ the\ buffer}}
\DoxyCodeLine{00813\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00814\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00815\ }
\DoxyCodeLine{00817\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classff_1_1_slab_cache_ad68a396a79136ae55167393124365ce3}{getsize}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff_1_1_slab_cache_a08fe5f765021928aa35f3fc7e0cbb24e}{size}};\ \}}
\DoxyCodeLine{00819\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classff_1_1_slab_cache_af777f44b91974bc97e1d78a992117e2f}{getnslabs}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff_1_1_slab_cache_a702cb5918d08c3f04c5957545e2aef57}{nslabs}};\}}
\DoxyCodeLine{00820\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classff_1_1_slab_cache_a3b1014e882638828ff91c84b398843ea}{allocatedsize}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00821\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{classff_1_1_slab_cache_a7a342093b6ee8d1beb61144991138d64}{alloc}}?\mbox{\hyperlink{classff_1_1_slab_cache_a7a342093b6ee8d1beb61144991138d64}{alloc}}-\/>getallocated():0);}
\DoxyCodeLine{00822\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00823\ }
\DoxyCodeLine{00824\ \ \ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00825\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a08fe5f765021928aa35f3fc7e0cbb24e}{size}};\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ size\ of\ slab\ buffer\ */}}
\DoxyCodeLine{00826\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a702cb5918d08c3f04c5957545e2aef57}{nslabs}};\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ num\ of\ buffers\ in\ segment\ */}}
\DoxyCodeLine{00827\ }
\DoxyCodeLine{00828\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1x_thread_data}{xThreadData}}\ \ \ \ \ \ \ \ \ \ \ \ **\ \ \mbox{\hyperlink{classff_1_1_slab_cache_a5028956d4b855af53685cfaa91329a0c}{fb}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ leak\ queue\ */}}
\DoxyCodeLine{00829\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a50f89c58c8382eec8610c20c8781e899}{fb\_capacity}};\ \ \ \ \ \textcolor{comment}{/*\ Min\ is\ 32\ */}}
\DoxyCodeLine{00830\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_ac387629cd72732ea8a3a9159fc51fb9b}{fb\_size}};}
\DoxyCodeLine{00831\ \ \ \ \ \ \ \ \ lock\_t\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a98bbf636229dfcc1b919e81f3d9bd5ae}{lock}};}
\DoxyCodeLine{00832\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00833\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a08932cc48bc237fbd1fb93ff468dcfb0}{buffptr}};}
\DoxyCodeLine{00834\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a27c506a87b5f119b6389e558ce8cb632}{availbuffers}};}
\DoxyCodeLine{00835\ }
\DoxyCodeLine{00836\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00837\ \ \ \ \ \ \ \ \ std::atomic\_long\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_aaa08e4d3dc71584104be728163169549}{nomoremalloc}};}
\DoxyCodeLine{00838\ }
\DoxyCodeLine{00839\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_segment_allocator}{SegmentAllocator}}\ *\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classff_1_1_slab_cache_a7a342093b6ee8d1beb61144991138d64}{alloc}};}
\DoxyCodeLine{00840\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__allocator}{ff\_allocator}}\ \ \ \ \ *\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classff_1_1_slab_cache_aceaa50c4deafa58ef17c2b3673c1842c}{mainalloc}};\ \ \ \ \ \textcolor{comment}{//\ the\ main\ allocator}}
\DoxyCodeLine{00841\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a826bdca9f0fded7aedfcddfe6ef2eb21}{delayedReclaim}};}
\DoxyCodeLine{00842\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a389805085c805d29064891f8120422af}{lastqueue}};}
\DoxyCodeLine{00843\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1svector}{svector<void\ *>}}\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache_a07ed55814ceb8c89014147d71247736c}{seglist}};\ \ \ \ \ \ \ \textcolor{comment}{//\ list\ of\ pointers\ to\ mem\ segments}}
\DoxyCodeLine{00844\ \ \ \ \ \};}
\DoxyCodeLine{00845\ }
\DoxyCodeLine{00877\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classff_1_1ff__allocator_a3f4683ff1c69931dfc1edc6679c0b2cd}{ff\_allocator}}\ \{}
\DoxyCodeLine{00878\ \ \ \ \ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classff_1_1ff__allocator_a90dcaed0c9c7a0dc2f18aaa9468cc743}{FFAllocator}};}
\DoxyCodeLine{00879\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00880\ }
\DoxyCodeLine{00881\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00882\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Check\ if\ there\ is\ a\ slab\ big\ enough\ to\ contain\ an\ object\ as\ big\ as\ \(\backslash\)p}}
\DoxyCodeLine{00883\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ size.}}
\DoxyCodeLine{00884\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00885\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Since\ there\ is\ a\ limited\ number\ of\ possible\ slab\ sizes,\ and\ these}}
\DoxyCodeLine{00886\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ predefined\ dimensions\ are\ all\ powers\ of\ 2,\ it\ is\ easy\ to\ find\ which\ slub}}
\DoxyCodeLine{00887\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ can\ contain\ the\ object\ of\ the\ given\ size.}}
\DoxyCodeLine{00888\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00889\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)param\ size\ the\ size\ of\ the\ object\ that\ must\ be\ contained\ in\ a\ slab.}}
\DoxyCodeLine{00890\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00891\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)return\ \ 0\ \ if\ the\ object\ can\ be\ contained\ in\ the\ slab\ of\ the}}
\DoxyCodeLine{00892\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ smallest\ size}}
\DoxyCodeLine{00893\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)return\ \ the\ index\ of\ the\ suitable\ slab\ size\ in\ the\ array\ of\ possible\ sizes,\ if}}
\DoxyCodeLine{00894\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ one\ exists}}
\DoxyCodeLine{00895\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)return\ -\/1\ if\ the\ object\ is\ too\ big\ to\ be\ contained\ in\ one\ of\ the\ slabs.}}
\DoxyCodeLine{00896\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00897\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff_1_1ff__allocator_a8382d619374c20723c838afff6dc0585}{getslabs}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}})\ \{}
\DoxyCodeLine{00898\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}})\ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00899\ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}};}
\DoxyCodeLine{00900\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}}=1,\ sz=\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}};}
\DoxyCodeLine{00901\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(sz\ >>=\ 1)\ ++\mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}};}
\DoxyCodeLine{00902\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}}\ <\ (\textcolor{keywordtype}{size\_t})\mbox{\hyperlink{namespaceff_aa1f1e3ae7276d8194e9cd91e2dffd9eb}{POW2\_MIN}})\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00903\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}}\ >\ (\textcolor{keywordtype}{size\_t})\mbox{\hyperlink{namespaceff_acb06e7498e7fd41e08de493ee51261aa}{POW2\_MAX}})\ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00904\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00905\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}}
\DoxyCodeLine{00906\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ for(int\ i=POW2\_MAX-\/POW2\_MIN+1;i<N\_SLABBUFFER;++i)}}
\DoxyCodeLine{00907\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ if\ ((size\_t)buffersize[i]>=size)\ return\ i;}}
\DoxyCodeLine{00908\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}}
\DoxyCodeLine{00909\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00910\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{int})\ \mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}}\ -\/\ \mbox{\hyperlink{namespaceff_aa1f1e3ae7276d8194e9cd91e2dffd9eb}{POW2\_MIN}};}
\DoxyCodeLine{00911\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00912\ }
\DoxyCodeLine{00913\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00914\ }
\DoxyCodeLine{00915\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}}\ *\ \mbox{\hyperlink{classff_1_1ff__allocator_a632c9d399d139cee6317dc4fd3a625e6}{getsegctl}}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *\ buf)\ \{}
\DoxyCodeLine{00916\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *((\mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}}\ **)buf);}
\DoxyCodeLine{00917\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00918\ }
\DoxyCodeLine{00919\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \mbox{\hyperlink{classff_1_1_slab_cache}{SlabCache}}\ *\ \mbox{\hyperlink{classff_1_1ff__allocator_adbff514152f454289da91e44ffb5f49b}{getslabs}}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *\ buf)\ \{}
\DoxyCodeLine{00920\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{classff_1_1ff__allocator_a632c9d399d139cee6317dc4fd3a625e6}{getsegctl}}(buf))-\/>cacheentry;}
\DoxyCodeLine{00921\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00922\ }
\DoxyCodeLine{00923\ \ \ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00924\ }
\DoxyCodeLine{00925\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00926\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Frees\ the\ buffer\ \(\backslash\)p\ buf\ and\ returns\ it\ to\ its\ slab\ segment}}
\DoxyCodeLine{00927\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{00928\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)return\ \(\backslash\)p\ true\ if\ some\ memory\ has\ been\ reclaimed}}
\DoxyCodeLine{00929\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00930\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \ \ \mbox{\hyperlink{classff_1_1ff__allocator_a6fe7b7eef67f4bebfba3c705096a067d}{free}}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *\ buf)\ \{}
\DoxyCodeLine{00931\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache}{SlabCache}}\ *\ \textcolor{keyword}{const}\ entry\ =\ \mbox{\hyperlink{classff_1_1ff__allocator_a8382d619374c20723c838afff6dc0585}{getslabs}}(buf);}
\DoxyCodeLine{00932\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(\ \textcolor{keywordflow}{if}\ (!entry)\ abort()\ );}
\DoxyCodeLine{00933\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>nfree.fetch\_add(1));}
\DoxyCodeLine{00934\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ entry-\/>\mbox{\hyperlink{classff_1_1_slab_cache_a46e04d141dd4bc5e59c805287966db0a}{putitem}}(buf);}
\DoxyCodeLine{00935\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00936\ }
\DoxyCodeLine{00937\ }
\DoxyCodeLine{00938\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classff_1_1ff__allocator_a1156e5f5142be9fa15d1b703e8032246}{allocatedsize}}()\ \{}
\DoxyCodeLine{00939\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}=0;}
\DoxyCodeLine{00940\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1svector_a82c249e1a0efe0f1e5a377fa8b692978}{svector<SlabCache\ *>::iterator}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}(slabcache.begin()),\ \mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}}(slabcache.end());}
\DoxyCodeLine{00941\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(;\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}!=\mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}};++\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})\ \{}
\DoxyCodeLine{00942\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})\ \&\&\ (*b)-\/>getnslabs())}
\DoxyCodeLine{00943\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}+=(*b)-\/>allocatedsize();}
\DoxyCodeLine{00944\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00945\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}};}
\DoxyCodeLine{00946\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00947\ }
\DoxyCodeLine{00948\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00949\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ FIX:\ we\ have\ to\ implement\ max\_size\ !!!!}}
\DoxyCodeLine{00951\ }
\DoxyCodeLine{00952\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__allocator_a3f4683ff1c69931dfc1edc6679c0b2cd}{ff\_allocator}}(\textcolor{keywordtype}{size\_t}\ \textcolor{comment}{/*max\_size*/}=0,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff_1_1ff__allocator_ab4acffca209f242ece598bff4499ba9e}{delayedReclaim}}=0)\ :}
\DoxyCodeLine{00953\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__allocator_a83eef76f0a8022f2528e4e23d1ba5603}{alloc}}(0),\ \textcolor{comment}{/*\ max\_size(max\_size),\ */}\ \mbox{\hyperlink{classff_1_1ff__allocator_ab4acffca209f242ece598bff4499ba9e}{delayedReclaim}}(\mbox{\hyperlink{classff_1_1ff__allocator_ab4acffca209f242ece598bff4499ba9e}{delayedReclaim}})\ \{\ }
\DoxyCodeLine{00954\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00955\ }
\DoxyCodeLine{00956\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00957\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Destructor}}
\DoxyCodeLine{00958\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00959\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classff_1_1ff__allocator_aa9787a0f1539c6f0bd559c9ab4d98442}{\string~ff\_allocator}}()\ \{}
\DoxyCodeLine{00960\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=0;\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<slabcache.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{00961\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (slabcache[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}])\ \{}
\DoxyCodeLine{00962\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ slabcache[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>\string~SlabCache();}
\DoxyCodeLine{00963\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mimalloc-override_8h_a9d4b5df3530d1bc733070a4669ba6ebc}{::free}}(slabcache[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]);}
\DoxyCodeLine{00964\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ slabcache[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00965\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00966\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00967\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1ff__allocator_a83eef76f0a8022f2528e4e23d1ba5603}{alloc}})\ \{}
\DoxyCodeLine{00968\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__allocator_a83eef76f0a8022f2528e4e23d1ba5603}{alloc}}-\/>\string~SegmentAllocator();}
\DoxyCodeLine{00969\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mimalloc-override_8h_a9d4b5df3530d1bc733070a4669ba6ebc}{::free}}(\mbox{\hyperlink{classff_1_1ff__allocator_a83eef76f0a8022f2528e4e23d1ba5603}{alloc}});}
\DoxyCodeLine{00970\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__allocator_a83eef76f0a8022f2528e4e23d1ba5603}{alloc}}=\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00971\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00972\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00973\ }
\DoxyCodeLine{00974\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ initialize\ the\ allocator\ -\/\ Check\ this\ -\/-\/\ REW}}
\DoxyCodeLine{01002\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff_1_1ff__allocator_a4256355feee6ed6fd39a515da813fbcb}{init}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \_nslabs[\mbox{\hyperlink{namespaceff_ac70617c84eb066a57e5d904bf5c3e62da9b057b825c2a8d1ab94ef55519344dd1}{N\_SLABBUFFER}}]=0,\ \textcolor{keywordtype}{bool}\ prealloc=\textcolor{keyword}{true})\ \{}
\DoxyCodeLine{01003\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1svector}{svector<int>}}\ nslabs;\ \ \textcolor{comment}{//\ used\ to\ specify\ the\ num\ of\ buffers\ in\ a\ slab}}
\DoxyCodeLine{01004\ }
\DoxyCodeLine{01005\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_nslabs)}
\DoxyCodeLine{01006\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=0;\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{namespaceff_ac70617c84eb066a57e5d904bf5c3e62da9b057b825c2a8d1ab94ef55519344dd1}{N\_SLABBUFFER}};\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01007\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nslabs.\mbox{\hyperlink{classff_1_1svector_ab59de8f11f93dac689691fe46ed987ce}{push\_back}}(\_nslabs[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]);}
\DoxyCodeLine{01008\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01009\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=0;\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{namespaceff_ac70617c84eb066a57e5d904bf5c3e62da9b057b825c2a8d1ab94ef55519344dd1}{N\_SLABBUFFER}};\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01010\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nslabs.\mbox{\hyperlink{classff_1_1svector_ab59de8f11f93dac689691fe46ed987ce}{push\_back}}(\mbox{\hyperlink{namespaceff_aa1467f40b1c3300221f6918c5478d0bb}{nslabs\_default}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]);}
\DoxyCodeLine{01011\ }
\DoxyCodeLine{01012\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{01013\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ Allocate\ space\ for\ a\ SegmenAllocator\ object\ and}}
\DoxyCodeLine{01014\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ initialise\ it.}}
\DoxyCodeLine{01015\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{01016\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__allocator_a83eef76f0a8022f2528e4e23d1ba5603}{alloc}}\ =\ (\mbox{\hyperlink{classff_1_1_segment_allocator}{SegmentAllocator}}\ *)\mbox{\hyperlink{classff_1_1ff__allocator_a9cfb8892d71d1fa72d233cc22b117dbf}{::malloc}}(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{classff_1_1_segment_allocator}{SegmentAllocator}}));}
\DoxyCodeLine{01017\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classff_1_1ff__allocator_a83eef76f0a8022f2528e4e23d1ba5603}{alloc}})\ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01018\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{new}\ (\mbox{\hyperlink{classff_1_1ff__allocator_a83eef76f0a8022f2528e4e23d1ba5603}{alloc}})\ \mbox{\hyperlink{classff_1_1_segment_allocator}{SegmentAllocator}}();}
\DoxyCodeLine{01019\ }
\DoxyCodeLine{01020\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache}{SlabCache}}\ *\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ =\ 0;}
\DoxyCodeLine{01021\ \ \ \ \ \ \ \ \ \ \ \ \ slabcache.reserve(\mbox{\hyperlink{namespaceff_ac70617c84eb066a57e5d904bf5c3e62da9b057b825c2a8d1ab94ef55519344dd1}{N\_SLABBUFFER}});}
\DoxyCodeLine{01022\ }
\DoxyCodeLine{01023\ }
\DoxyCodeLine{01024\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{01025\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ Allocate\ space\ for\ 'N\_SLABBUFFER'\ caches\ and\ create\ SlabCache}}
\DoxyCodeLine{01026\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ objects.\ Buffers\ size\ within\ a\ cache\ size\ grows\ from\ 32\ to\ 8192.\ if}}
\DoxyCodeLine{01027\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ not\ otherwise\ specified,\ the\ number\ of\ slab\ buffers\ in\ a\ segment}}
\DoxyCodeLine{01028\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ decreases\ as\ the\ size\ of\ the\ slab\ increases.}}
\DoxyCodeLine{01029\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{01030\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{namespaceff_ac70617c84eb066a57e5d904bf5c3e62da9b057b825c2a8d1ab94ef55519344dd1}{N\_SLABBUFFER}};\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{01031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ =\ (\mbox{\hyperlink{classff_1_1_slab_cache}{SlabCache}}*)\mbox{\hyperlink{classff_1_1ff__allocator_a9cfb8892d71d1fa72d233cc22b117dbf}{::malloc}}(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{classff_1_1_slab_cache}{SlabCache}}));}
\DoxyCodeLine{01032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}})\ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{new}\ (\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}})\ \mbox{\hyperlink{classff_1_1_slab_cache}{SlabCache}}(\ \textcolor{keyword}{this},\ \mbox{\hyperlink{classff_1_1ff__allocator_ab4acffca209f242ece598bff4499ba9e}{delayedReclaim}},\ \mbox{\hyperlink{classff_1_1ff__allocator_a83eef76f0a8022f2528e4e23d1ba5603}{alloc}},}
\DoxyCodeLine{01034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceff_adc84d5e813921475f8f9ec164561309d}{buffersize}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}],\ nslabs[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]\ );}
\DoxyCodeLine{01035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>init(prealloc)<0)\ \{}
\DoxyCodeLine{01036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceff_a27d926d29b55e019eba5b70672301d82}{error}}(\textcolor{stringliteral}{"{}ff\_allocator:init:\ slab\ init\ fails!\(\backslash\)n"{}});}
\DoxyCodeLine{01037\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01039\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ slabcache.push\_back(\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}});\ \ \ \ \ \textcolor{comment}{//\ create\ a\ list\ of\ SlabCaches}}
\DoxyCodeLine{01040\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01041\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01042\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01043\ }
\DoxyCodeLine{01053\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff_1_1ff__allocator_a09e650148ba1d77a17015eb302808714}{registerAllocator}}()\ \{}
\DoxyCodeLine{01054\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1svector_a82c249e1a0efe0f1e5a377fa8b692978}{svector<SlabCache\ *>::iterator}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}(slabcache.begin()),\ \mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}}(slabcache.end());}
\DoxyCodeLine{01055\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(;\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}!=\mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}};++\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})\ \{}
\DoxyCodeLine{01056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*b)-\/>getnslabs())}
\DoxyCodeLine{01057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*b)-\/>register4free(\textcolor{keyword}{true})==0)\ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01058\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01059\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01060\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01061\ }
\DoxyCodeLine{01072\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff_1_1ff__allocator_acc24fb135fae47a76d9c4581f7fe74ea}{deregisterAllocator}}(\textcolor{keywordtype}{bool}\ reclaimMemory=\textcolor{keyword}{true})\ \{}
\DoxyCodeLine{01073\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1svector_a82c249e1a0efe0f1e5a377fa8b692978}{svector<SlabCache\ *>::iterator}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}(slabcache.begin()),\ \mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}}(slabcache.end());}
\DoxyCodeLine{01074\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(;\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}!=\mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}};++\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})\ \{}
\DoxyCodeLine{01075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*b)-\/>getnslabs())}
\DoxyCodeLine{01076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (*b)-\/>deregisterAllocator(reclaimMemory);}
\DoxyCodeLine{01077\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01078\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01079\ }
\DoxyCodeLine{01080\ }
\DoxyCodeLine{01092\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff_1_1ff__allocator_ac09381e5eaa8279a60b7a191f2210174}{register4free}}()\ \{}
\DoxyCodeLine{01093\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1svector_a82c249e1a0efe0f1e5a377fa8b692978}{svector<SlabCache\ *>::iterator}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}(slabcache.begin()),\ \mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}}(slabcache.end());}
\DoxyCodeLine{01094\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(;\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}!=\mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}};++\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})\ \{}
\DoxyCodeLine{01095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*b)-\/>getnslabs())}
\DoxyCodeLine{01096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*b)-\/>register4free()==0)\ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01097\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01098\ }
\DoxyCodeLine{01099\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01100\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01101\ }
\DoxyCodeLine{01126\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{classff_1_1ff__allocator_a9cfb8892d71d1fa72d233cc22b117dbf}{malloc}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}})\ \{}
\DoxyCodeLine{01131\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}}>\mbox{\hyperlink{namespaceff_ac70617c84eb066a57e5d904bf5c3e62dac4e03297ac4c5065b5b8690d0c651dae}{MAX\_SLABBUFFER\_SIZE}}\ ||}
\DoxyCodeLine{01132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (slabcache[\mbox{\hyperlink{classff_1_1ff__allocator_a8382d619374c20723c838afff6dc0585}{getslabs}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}})]-\/>getnslabs()==0)\ )\ \{}
\DoxyCodeLine{01133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>sysmalloc.fetch\_add(1));}
\DoxyCodeLine{01134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}\ =\ \mbox{\hyperlink{mimalloc-override_8h_a99aa8fd9f4831e1b0fa9e1cdcde3e249}{::malloc}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}}+\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}));}
\DoxyCodeLine{01135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01136\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})-\/>ptr\ =\ 0;}
\DoxyCodeLine{01137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{char}\ *)\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}\ +\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}});}
\DoxyCodeLine{01138\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01139\ }
\DoxyCodeLine{01140\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ otherwise}}
\DoxyCodeLine{01141\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ entry\ =\ \mbox{\hyperlink{classff_1_1ff__allocator_a8382d619374c20723c838afff6dc0585}{getslabs}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}});}
\DoxyCodeLine{01142\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(\textcolor{keywordflow}{if}\ (entry<0)\ abort());}
\DoxyCodeLine{01143\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>nmalloc.fetch\_add(1));}
\DoxyCodeLine{01144\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\ buf\ =\ slabcache[entry]-\/>getitem();}
\DoxyCodeLine{01145\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ buf;}
\DoxyCodeLine{01146\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01147\ }
\DoxyCodeLine{01163\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff_1_1ff__allocator_a3ad062e04d2c1739a089cbc0a60dda0b}{posix\_memalign}}(\textcolor{keywordtype}{void}\ **memptr,\ \textcolor{keywordtype}{size\_t}\ alignment,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}})\ \{}
\DoxyCodeLine{01164\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{namespaceff_a94e8617a117c5ad8c4ce0d196c1413da}{isPowerOfTwoMultiple}}(alignment,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{void}\ *)))\ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01165\ }
\DoxyCodeLine{01166\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ realsize\ =\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}}+alignment;}
\DoxyCodeLine{01167\ }
\DoxyCodeLine{01168\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{01169\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ if\ the\ size\ is\ too\ big\ or\ we\ don't\ want\ to\ use\ the\ ff\_allocator}}
\DoxyCodeLine{01170\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ *\ for\ that\ size,\ use\ the\ standard\ allocator\ and\ force\ alignment}}
\DoxyCodeLine{01171\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{01172\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (realsize\ >\ \mbox{\hyperlink{namespaceff_ac70617c84eb066a57e5d904bf5c3e62dac4e03297ac4c5065b5b8690d0c651dae}{MAX\_SLABBUFFER\_SIZE}}\ ||}
\DoxyCodeLine{01173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (slabcache[\mbox{\hyperlink{classff_1_1ff__allocator_a8382d619374c20723c838afff6dc0585}{getslabs}}(realsize)]-\/>getnslabs()==0))\ \{}
\DoxyCodeLine{01174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>sysmalloc.fetch\_add(1));}
\DoxyCodeLine{01175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}\ =\ \mbox{\hyperlink{mimalloc-override_8h_a99aa8fd9f4831e1b0fa9e1cdcde3e249}{::malloc}}(realsize+\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}));}
\DoxyCodeLine{01176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})-\/>ptr\ =\ 0;}
\DoxyCodeLine{01178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\ ptraligned\ =\ (\textcolor{keywordtype}{void}\ *)(\ \ (\ (\textcolor{keywordtype}{long})((\textcolor{keywordtype}{char}*)\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}\ +}
\DoxyCodeLine{01179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}))\ +\ alignment\ )\ \&\ \string~(alignment-\/1)\ \ );}
\DoxyCodeLine{01180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)((\textcolor{keywordtype}{char}\ *)ptraligned\ -\/\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}})))-\/>ptr\ =\ 0;}
\DoxyCodeLine{01181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *memptr\ =\ ptraligned;}
\DoxyCodeLine{01182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01183\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01184\ }
\DoxyCodeLine{01185\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ else\ use}}
\DoxyCodeLine{01186\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ entry\ =\ \mbox{\hyperlink{classff_1_1ff__allocator_a8382d619374c20723c838afff6dc0585}{getslabs}}(realsize);}
\DoxyCodeLine{01187\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(\textcolor{keywordflow}{if}\ (entry<0)\ abort());}
\DoxyCodeLine{01188\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>nmalloc.fetch\_add(1));}
\DoxyCodeLine{01189\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\ buf\ =\ slabcache[entry]-\/>getitem();}
\DoxyCodeLine{01190\ }
\DoxyCodeLine{01191\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *\ backptr\ =\ (\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)((\textcolor{keywordtype}{char}\ *)buf\ -\/\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}));}
\DoxyCodeLine{01192\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(assert(backptr));}
\DoxyCodeLine{01193\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\ ptraligned\ =\ (\textcolor{keywordtype}{void}\ *)(((\textcolor{keywordtype}{long})((\textcolor{keywordtype}{char}*)buf)\ +\ alignment)\ \&\ \string~(alignment-\/1));}
\DoxyCodeLine{01194\ }
\DoxyCodeLine{01195\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}=(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}*)buf;\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}!=(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}*)ptraligned;\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}++)\ \{}
\DoxyCodeLine{01196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}-\/>ptr\ =\ backptr-\/>\mbox{\hyperlink{structff_1_1_buf__ctl_a577380a7867fa0c24543931999c09407}{ptr}};}
\DoxyCodeLine{01197\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01198\ }
\DoxyCodeLine{01199\ \ \ \ \ \ \ \ \ \ \ \ \ *memptr\ =\ ptraligned;}
\DoxyCodeLine{01200\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01201\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01202\ }
\DoxyCodeLine{01203\ }
\DoxyCodeLine{01204\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ BUG\ 2\ FIX:\ free\ fails\ if\ memory\ has\ been\ previously\ allocated\ using\ the}}
\DoxyCodeLine{01205\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ posix\_memalign\ method\ with\ a\ size\ grater\ than\ MAX\_SLABBUFFER\_SIZE!!!!}}
\DoxyCodeLine{01224\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \ \ \mbox{\hyperlink{classff_1_1ff__allocator_ad4fe08078fc1624b607c3a9fdd823350}{free}}(\textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \{}
\DoxyCodeLine{01225\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01226\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ \ *\ buf\ =\ (\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)((\textcolor{keywordtype}{char}\ *)\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}\ -\/\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}));}
\DoxyCodeLine{01227\ }
\DoxyCodeLine{01228\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!buf-\/>\mbox{\hyperlink{structff_1_1_buf__ctl_a577380a7867fa0c24543931999c09407}{ptr}})\ \{}
\DoxyCodeLine{01229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>sysfree.fetch\_add(1));}
\DoxyCodeLine{01230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mimalloc-override_8h_a9d4b5df3530d1bc733070a4669ba6ebc}{::free}}(buf);}
\DoxyCodeLine{01231\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01232\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01233\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ \ *\ buf2\ =\ (\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)((\textcolor{keywordtype}{char}\ *)buf\ -\/\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}));}
\DoxyCodeLine{01234\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(buf-\/>\mbox{\hyperlink{structff_1_1_buf__ctl_a577380a7867fa0c24543931999c09407}{ptr}}\ ==\ buf2-\/>\mbox{\hyperlink{structff_1_1_buf__ctl_a577380a7867fa0c24543931999c09407}{ptr}})\ \{}
\DoxyCodeLine{01235\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ buf\ =\ buf2;}
\DoxyCodeLine{01236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ buf2\ =\ (\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)((\textcolor{keywordtype}{char}\ *)buf\ -\/\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}));}
\DoxyCodeLine{01237\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01238\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mimalloc-override_8h_a9d4b5df3530d1bc733070a4669ba6ebc}{free}}(buf);}
\DoxyCodeLine{01239\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01240\ }
\DoxyCodeLine{01266\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{classff_1_1ff__allocator_a83e8958912ce97820addd8ad2ad999f7}{realloc}}(\textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}},\ \textcolor{keywordtype}{size\_t}\ newsize)\ \{}
\DoxyCodeLine{01267\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \{}
\DoxyCodeLine{01268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ oldsize;}
\DoxyCodeLine{01269\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ \ *\ buf\ =\ (\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)((\textcolor{keywordtype}{char}\ *)\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}\ -\/\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}));}
\DoxyCodeLine{01270\ }
\DoxyCodeLine{01271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!buf-\/>\mbox{\hyperlink{structff_1_1_buf__ctl_a577380a7867fa0c24543931999c09407}{ptr}})\ \{}
\DoxyCodeLine{01272\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>sysrealloc.fetch\_add(1));}
\DoxyCodeLine{01273\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\ newptr=\ \mbox{\hyperlink{mimalloc-override_8h_adbbb9b1695e5714db8873077d44ade2f}{::realloc}}(buf,\ newsize+\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}));}
\DoxyCodeLine{01274\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01275\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)newptr)-\/>ptr\ =\ 0;}
\DoxyCodeLine{01276\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{char}\ *)newptr\ +\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}});}
\DoxyCodeLine{01277\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01278\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>nrealloc.fetch\_add(1));}
\DoxyCodeLine{01279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache}{SlabCache}}\ *\ \textcolor{keyword}{const}\ entry\ =\ \mbox{\hyperlink{classff_1_1ff__allocator_a8382d619374c20723c838afff6dc0585}{getslabs}}(buf);}
\DoxyCodeLine{01280\ }
\DoxyCodeLine{01281\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!entry)\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((oldsize=entry-\/>\mbox{\hyperlink{classff_1_1_slab_cache_ad68a396a79136ae55167393124365ce3}{getsize}}())\ >=\ newsize)\ \{}
\DoxyCodeLine{01283\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}};}
\DoxyCodeLine{01284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\ newptr\ =\ this-\/>\mbox{\hyperlink{mimalloc-override_8h_a99aa8fd9f4831e1b0fa9e1cdcde3e249}{malloc}}(newsize);}
\DoxyCodeLine{01286\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ memcpy(newptr,\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}},oldsize);}
\DoxyCodeLine{01287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entry-\/>\mbox{\hyperlink{classff_1_1_slab_cache_a46e04d141dd4bc5e59c805287966db0a}{putitem}}(buf);}
\DoxyCodeLine{01288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ newptr;}
\DoxyCodeLine{01289\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01290\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ this-\/>\mbox{\hyperlink{mimalloc-override_8h_a99aa8fd9f4831e1b0fa9e1cdcde3e249}{malloc}}(newsize);}
\DoxyCodeLine{01291\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01292\ }
\DoxyCodeLine{01293\ }
\DoxyCodeLine{01294\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{classff_1_1ff__allocator_a9e72260f154d03da4edb766a5edfe116}{growsup}}(\textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}},\ \textcolor{keywordtype}{size\_t}\ newsize)\ \{}
\DoxyCodeLine{01295\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \{}
\DoxyCodeLine{01296\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ oldsize;}
\DoxyCodeLine{01297\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ \ *\ buf\ =\ (\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)((\textcolor{keywordtype}{char}\ *)\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}\ -\/\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}));}
\DoxyCodeLine{01298\ }
\DoxyCodeLine{01299\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!buf-\/>\mbox{\hyperlink{structff_1_1_buf__ctl_a577380a7867fa0c24543931999c09407}{ptr}})\ \{\ \textcolor{comment}{/*\ WARNING:\ this\ is\ probably\ an\ error\ !!!\ */}}
\DoxyCodeLine{01300\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>sysrealloc.fetch\_add(1));}
\DoxyCodeLine{01301\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\ newptr=\ \mbox{\hyperlink{mimalloc-override_8h_adbbb9b1695e5714db8873077d44ade2f}{::realloc}}(buf,\ newsize+\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}));}
\DoxyCodeLine{01302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01303\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)newptr)-\/>ptr\ =\ 0;}
\DoxyCodeLine{01304\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{char}\ *)newptr\ +\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}});}
\DoxyCodeLine{01305\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01306\ }
\DoxyCodeLine{01307\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_slab_cache}{SlabCache}}\ *\ \textcolor{keyword}{const}\ entry\ =\ \mbox{\hyperlink{classff_1_1ff__allocator_a8382d619374c20723c838afff6dc0585}{getslabs}}(buf);}
\DoxyCodeLine{01308\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!entry)\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01309\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((oldsize=entry-\/>\mbox{\hyperlink{classff_1_1_slab_cache_ad68a396a79136ae55167393124365ce3}{getsize}}())\ >=\ newsize)\ \{}
\DoxyCodeLine{01310\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}};}
\DoxyCodeLine{01311\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01312\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ entry-\/>\mbox{\hyperlink{classff_1_1_slab_cache_a46e04d141dd4bc5e59c805287966db0a}{putitem}}(buf);}
\DoxyCodeLine{01313\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01314\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ this-\/>\mbox{\hyperlink{mimalloc-override_8h_a99aa8fd9f4831e1b0fa9e1cdcde3e249}{malloc}}(newsize);}
\DoxyCodeLine{01315\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01316\ }
\DoxyCodeLine{01317\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(\ \textcolor{keywordtype}{void}\ printstats(std::ostream\ \&\ out)\ \{}
\DoxyCodeLine{01318\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ all\_stats::instance()-\/>print(out);\ \}}
\DoxyCodeLine{01319\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{01320\ }
\DoxyCodeLine{01321\ \ \ \ \ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{01322\ \ \ \ \ \ \ \ \ svector<SlabCache\ *>\ \ \ slabcache;\ \ \ \ \ \ \ \textcolor{comment}{//\ List\ of\ caches}}
\DoxyCodeLine{01323\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_segment_allocator}{SegmentAllocator}}\ \ \ \ \ *\ \mbox{\hyperlink{classff_1_1ff__allocator_a83eef76f0a8022f2528e4e23d1ba5603}{alloc}};}
\DoxyCodeLine{01324\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ const\ size\_t\ \ \ \ \ \ \ \ \ \ \ max\_size;\ */}\ \ \textcolor{comment}{//\ TODO}}
\DoxyCodeLine{01325\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__allocator_ab4acffca209f242ece598bff4499ba9e}{delayedReclaim}};}
\DoxyCodeLine{01326\ \ \ \ \ \};}
\DoxyCodeLine{01327\ }
\DoxyCodeLine{01328\ \ \ \ \ \textcolor{comment}{//\ forward\ decl}}
\DoxyCodeLine{01329\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classff_1_1ffa__wrapper}{ffa\_wrapper}};}
\DoxyCodeLine{01330\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceff_a7ce928bba667c9a4c80178bf1d10e8ea}{FFAkeyDestructorHandler}}(\textcolor{keywordtype}{void}\ *\ kv);}
\DoxyCodeLine{01331\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceff_ab0944ddc87ac43b2b29fa77c9c435361}{killMyself}}(\mbox{\hyperlink{classff_1_1ffa__wrapper}{ffa\_wrapper}}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}});}
\DoxyCodeLine{01332\ }
\DoxyCodeLine{01333\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{01334\ \textcolor{comment}{\ \ \ \ \ *\ \(\backslash\)class\ ffa\_wrapper}}
\DoxyCodeLine{01335\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{01336\ \textcolor{comment}{\ \ \ \ \ *\ \(\backslash\)brief\ A\ wrapper\ of\ the\ ff\_allocator.}}
\DoxyCodeLine{01337\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{01338\ \textcolor{comment}{\ \ \ \ \ *\ This\ wrapper\ acts\ as\ an\ intermediate\ level\ between\ the\ ff\_allocator\ (which}}
\DoxyCodeLine{01339\ \textcolor{comment}{\ \ \ \ \ *\ it\ extends)\ and\ the\ FFAllocator\ (which\ uses\ the\ wrapper\ through\ the}}
\DoxyCodeLine{01340\ \textcolor{comment}{\ \ \ \ \ *\ FFAxThreadData\ structure).}}
\DoxyCodeLine{01341\ \textcolor{comment}{\ \ \ \ \ *}}
\DoxyCodeLine{01342\ \textcolor{comment}{\ \ \ \ \ *\ This\ class\ is\ defined\ in\ \(\backslash\)ref\ allocator.hpp}}
\DoxyCodeLine{01343\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{01344\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classff_1_1ffa__wrapper_a5a96d0d2cc7d943d55f800180e7b757b}{ffa\_wrapper}}:\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classff_1_1ff__allocator_a3f4683ff1c69931dfc1edc6679c0b2cd}{ff\_allocator}}\ \{}
\DoxyCodeLine{01345\ \ \ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{01346\ }
\DoxyCodeLine{01347\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classff_1_1ffa__wrapper_ada3370f18adff1597c079ee64fb15329}{free}}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *\ buf)\ \{}
\DoxyCodeLine{01348\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ reclaimed\ =\ \mbox{\hyperlink{classff_1_1ff__allocator_a6fe7b7eef67f4bebfba3c705096a067d}{ff\_allocator::free}}(buf);}
\DoxyCodeLine{01349\ }
\DoxyCodeLine{01350\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Do\ I\ have\ to\ kill\ myself?}}
\DoxyCodeLine{01351\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (reclaimed\ \&\&\ \mbox{\hyperlink{classff_1_1ffa__wrapper_a8513620a240b948c12a167fb24f3f7ff}{nomorealloc}}.load()\ \&\&\ (\mbox{\hyperlink{classff_1_1ff__allocator_a1156e5f5142be9fa15d1b703e8032246}{allocatedsize}}()==0))\ \{}
\DoxyCodeLine{01352\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceff_ab0944ddc87ac43b2b29fa77c9c435361}{killMyself}}(\textcolor{keyword}{this});}
\DoxyCodeLine{01353\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01354\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ reclaimed;}
\DoxyCodeLine{01355\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01356\ }
\DoxyCodeLine{01357\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{01358\ \ \ \ \ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff_1_1ffa__wrapper_a90a5de74e8fd8ea0ba5fa1ac97cd825b}{FFAkeyDestructorHandler}}(\textcolor{keywordtype}{void}\ *\ kv);}
\DoxyCodeLine{01359\ }
\DoxyCodeLine{01360\ }
\DoxyCodeLine{01361\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ffa__wrapper_a5a96d0d2cc7d943d55f800180e7b757b}{ffa\_wrapper}}(\textcolor{keywordtype}{size\_t}\ max\_size=0,\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff_1_1ff__allocator_ab4acffca209f242ece598bff4499ba9e}{delayedReclaim}}=0)\ :}
\DoxyCodeLine{01362\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__allocator_a3f4683ff1c69931dfc1edc6679c0b2cd}{ff\_allocator}}(max\_size,\mbox{\hyperlink{classff_1_1ff__allocator_ab4acffca209f242ece598bff4499ba9e}{delayedReclaim}})\ \{}
\DoxyCodeLine{01363\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ffa__wrapper_a8513620a240b948c12a167fb24f3f7ff}{nomorealloc}}.store(0);}
\DoxyCodeLine{01364\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01365\ }
\DoxyCodeLine{01366\ }
\DoxyCodeLine{01367\ \ \ \ \ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classff_1_1ffa__wrapper_a14506f81f656aee7101bd8d10320eaa7}{\string~ffa\_wrapper}}()\ \{\}}
\DoxyCodeLine{01368\ }
\DoxyCodeLine{01369\ }
\DoxyCodeLine{01370\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{classff_1_1ffa__wrapper_abb4205d3fbd73f705dfa3633aae66b4c}{malloc}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}})\ \{}
\DoxyCodeLine{01371\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff_1_1ff__allocator_a9cfb8892d71d1fa72d233cc22b117dbf}{ff\_allocator::malloc}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}});}
\DoxyCodeLine{01372\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01373\ }
\DoxyCodeLine{01374\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff_1_1ffa__wrapper_a03ded4a9da45b06eb82b4366513abf45}{posix\_memalign}}(\textcolor{keywordtype}{void}\ **memptr,\ \textcolor{keywordtype}{size\_t}\ alignment,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}})\ \{}
\DoxyCodeLine{01375\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff_1_1ff__allocator_a3ad062e04d2c1739a089cbc0a60dda0b}{ff\_allocator::posix\_memalign}}(memptr,alignment,\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}});}
\DoxyCodeLine{01376\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01377\ }
\DoxyCodeLine{01378\ }
\DoxyCodeLine{01379\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \ \ \mbox{\hyperlink{classff_1_1ffa__wrapper_a14efccf64441ad08ac086b472983593f}{free}}(\textcolor{keywordtype}{void}\ *)\ \{\ \ abort();\ \ \}}
\DoxyCodeLine{01380\ }
\DoxyCodeLine{01381\ }
\DoxyCodeLine{01382\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{classff_1_1ffa__wrapper_af384ca68b86f0b5574070ae5a8885afe}{realloc}}(\textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}},\ \textcolor{keywordtype}{size\_t}\ newsize)\ \{}
\DoxyCodeLine{01383\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff_1_1ff__allocator_a83e8958912ce97820addd8ad2ad999f7}{ff\_allocator::realloc}}(\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}},newsize);}
\DoxyCodeLine{01384\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01385\ }
\DoxyCodeLine{01386\ }
\DoxyCodeLine{01387\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{classff_1_1ffa__wrapper_a0a1d543a1d592fdcbe6f9ca16293e212}{growsup}}(\textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}},\ \textcolor{keywordtype}{size\_t}\ newsize)\ \{}
\DoxyCodeLine{01388\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff_1_1ff__allocator_a9e72260f154d03da4edb766a5edfe116}{ff\_allocator::growsup}}(\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}},newsize);}
\DoxyCodeLine{01389\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01390\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{01391\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff_1_1ffa__wrapper_ab8c9047ab7fad19b1294ecd0f142d639}{nomoremalloc}}()\ \{}
\DoxyCodeLine{01392\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ffa__wrapper_a8513620a240b948c12a167fb24f3f7ff}{nomorealloc}}.store(1);}
\DoxyCodeLine{01393\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01394\ }
\DoxyCodeLine{01395\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{01396\ \ \ \ \ \ \ \ \ std::atomic\_long\ \ \ \ \mbox{\hyperlink{classff_1_1ffa__wrapper_a8513620a240b948c12a167fb24f3f7ff}{nomorealloc}};}
\DoxyCodeLine{01397\ \ \ \ \ \};}
\DoxyCodeLine{01398\ }
\DoxyCodeLine{01399\ }
\DoxyCodeLine{01400\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structff_1_1_f_f_ax_thread_data_ae9517c5917d74bf2e0f25f89224398e6}{FFAxThreadData}}\ \{}
\DoxyCodeLine{01401\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_f_f_ax_thread_data_ae9517c5917d74bf2e0f25f89224398e6}{FFAxThreadData}}(\mbox{\hyperlink{classff_1_1ffa__wrapper}{ffa\_wrapper}}\ *\ \mbox{\hyperlink{structff_1_1_f_f_ax_thread_data_a82a1a74158119103c513a9cfe1923e6e}{f}}):\ \mbox{\hyperlink{structff_1_1_f_f_ax_thread_data_a82a1a74158119103c513a9cfe1923e6e}{f}}(\mbox{\hyperlink{structff_1_1_f_f_ax_thread_data_a82a1a74158119103c513a9cfe1923e6e}{f}})\ \{\ \}}
\DoxyCodeLine{01402\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ffa__wrapper}{ffa\_wrapper}}\ *\ \mbox{\hyperlink{structff_1_1_f_f_ax_thread_data_a82a1a74158119103c513a9cfe1923e6e}{f}};}
\DoxyCodeLine{01403\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{structff_1_1_f_f_ax_thread_data_abf38d730374efbe7ebcc0dd84cc210b4}{padding}}[\mbox{\hyperlink{namespaceff_ad0bc32203f6c871e1a6d21be4437d272}{longxCacheLine}}-\/(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{classff_1_1ffa__wrapper}{ffa\_wrapper}}*)/\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{long}))];}
\DoxyCodeLine{01404\ \ \ \ \ \};}
\DoxyCodeLine{01405\ }
\DoxyCodeLine{01427\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classff_1_1_f_f_allocator_a14063768984177b43e47950e1e67be32}{FFAllocator}}\ \{}
\DoxyCodeLine{01428\ \ \ \ \ \ \ \ \ \textcolor{keyword}{enum}\ \{\mbox{\hyperlink{classff_1_1_f_f_allocator_a0e3ffbd131af74ab8a3224f544d4d3a9a0993f5e33c11436242969578b2852631}{MIN\_A\_CAPACITY}}=32\};}
\DoxyCodeLine{01429\ }
\DoxyCodeLine{01430\ \ \ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{01431\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}}\ *\ \mbox{\hyperlink{classff_1_1_f_f_allocator_a5c331370c04418cec3e151782994ac2b}{getsegctl}}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *\ buf)\ \{}
\DoxyCodeLine{01432\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *((\mbox{\hyperlink{structff_1_1_seg__ctl}{Seg\_ctl}}\ **)buf);}
\DoxyCodeLine{01433\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01434\ }
\DoxyCodeLine{01435\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \mbox{\hyperlink{structff_1_1_f_f_ax_thread_data}{FFAxThreadData}}\ *\ \mbox{\hyperlink{classff_1_1_f_f_allocator_aafb4c080d57ae46f3dd48b3179199e6d}{newAllocator}}(\ \textcolor{keywordtype}{bool}\ prealloc,}
\DoxyCodeLine{01436\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \_nslabs[\mbox{\hyperlink{namespaceff_ac70617c84eb066a57e5d904bf5c3e62da9b057b825c2a8d1ab94ef55519344dd1}{N\_SLABBUFFER}}],}
\DoxyCodeLine{01437\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ max\_size\ )}
\DoxyCodeLine{01438\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01439\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_f_f_ax_thread_data}{FFAxThreadData}}\ *\ ffaxtd\ =}
\DoxyCodeLine{01440\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{structff_1_1_f_f_ax_thread_data}{FFAxThreadData}}\ *)\mbox{\hyperlink{classff_1_1_f_f_allocator_a31d2c6453ebb112ae523eb8da155707f}{::malloc}}(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_f_f_ax_thread_data}{FFAxThreadData}})\ +}
\DoxyCodeLine{01441\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{classff_1_1ffa__wrapper}{ffa\_wrapper}}));}
\DoxyCodeLine{01442\ }
\DoxyCodeLine{01443\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!ffaxtd)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01444\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ffa__wrapper}{ffa\_wrapper}}\ *\ \mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}}\ =\ (\mbox{\hyperlink{classff_1_1ffa__wrapper}{ffa\_wrapper}}*)((\textcolor{keywordtype}{char}\ *)\ ffaxtd\ +}
\DoxyCodeLine{01445\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_f_f_ax_thread_data}{FFAxThreadData}}));}
\DoxyCodeLine{01446\ }
\DoxyCodeLine{01447\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{new}\ (\mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}})\ \mbox{\hyperlink{classff_1_1ffa__wrapper}{ffa\_wrapper}}(max\_size,\mbox{\hyperlink{classff_1_1_f_f_allocator_a95cfdf153883ae42a8f318c60f0abb9f}{delayedReclaim}});}
\DoxyCodeLine{01448\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{new}\ (ffaxtd)\ \mbox{\hyperlink{structff_1_1_f_f_ax_thread_data}{FFAxThreadData}}(\mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}});}
\DoxyCodeLine{01449\ }
\DoxyCodeLine{01450\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}}-\/>init(\_nslabs,\ prealloc)<0)\ \{}
\DoxyCodeLine{01451\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceff_a27d926d29b55e019eba5b70672301d82}{error}}(\textcolor{stringliteral}{"{}FFAllocator:newAllocator:\ init\ fails!\(\backslash\)n"{}});}
\DoxyCodeLine{01452\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01453\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01454\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}}-\/>registerAllocator()<0)\ \{\ \ \ \ \ \textcolor{comment}{//\ register\ allocator\ to\ leak\ queue}}
\DoxyCodeLine{01455\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceff_a27d926d29b55e019eba5b70672301d82}{error}}(\textcolor{stringliteral}{"{}FFAllocator:newAllocator:\ registerAllocator\ fails!\(\backslash\)n"{}});}
\DoxyCodeLine{01456\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01457\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01458\ }
\DoxyCodeLine{01459\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ REW\ -\/-\/\ like\ in\ register4free}}
\DoxyCodeLine{01460\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ more\ space\ in\ the\ SlabCache\ is\ needed,\ allocate\ more\ space}}
\DoxyCodeLine{01461\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (::realloc)\ and\ update\ counters.\ Thread-\/safe\ operation\ (mutex)}}
\DoxyCodeLine{01462\ \ \ \ \ \ \ \ \ \ \ \ \ spin\_lock(\mbox{\hyperlink{classff_1_1_f_f_allocator_a120393744e98f0ed5fe086a25521ca00}{lock}});}
\DoxyCodeLine{01463\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1_f_f_allocator_a322c667c6bb7330dbc3d0ba16b2599e2}{A\_size}}\ ==\ \mbox{\hyperlink{classff_1_1_f_f_allocator_af3352177bcdbfca3186186c76618d88c}{A\_capacity}})\ \{}
\DoxyCodeLine{01464\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_f_f_ax_thread_data}{FFAxThreadData}}\ **\ A\_new\ =\ (\mbox{\hyperlink{structff_1_1_f_f_ax_thread_data}{FFAxThreadData}}**)\ \mbox{\hyperlink{classff_1_1_f_f_allocator_a65f9c023e525f7b529c4250adf3b1feb}{::realloc}}(\ \mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}},}
\DoxyCodeLine{01465\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{classff_1_1_f_f_allocator_af3352177bcdbfca3186186c76618d88c}{A\_capacity}}+\mbox{\hyperlink{classff_1_1_f_f_allocator_a0e3ffbd131af74ab8a3224f544d4d3a9a0993f5e33c11436242969578b2852631}{MIN\_A\_CAPACITY}})*\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_f_f_ax_thread_data}{FFAxThreadData}}*)\ );}
\DoxyCodeLine{01466\ }
\DoxyCodeLine{01467\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!A\_new)\ \{\ spin\_unlock(\mbox{\hyperlink{classff_1_1_f_f_allocator_a120393744e98f0ed5fe086a25521ca00}{lock}});\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};\}}
\DoxyCodeLine{01468\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}}=A\_new;}
\DoxyCodeLine{01469\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_f_f_allocator_af3352177bcdbfca3186186c76618d88c}{A\_capacity}}\ +=\ \mbox{\hyperlink{classff_1_1_f_f_allocator_a0e3ffbd131af74ab8a3224f544d4d3a9a0993f5e33c11436242969578b2852631}{MIN\_A\_CAPACITY}};}
\DoxyCodeLine{01470\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01471\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}}[\mbox{\hyperlink{classff_1_1_f_f_allocator_a322c667c6bb7330dbc3d0ba16b2599e2}{A\_size}}++]\ =\ ffaxtd;}
\DoxyCodeLine{01472\ \ \ \ \ \ \ \ \ \ \ \ \ spin\_unlock(\mbox{\hyperlink{classff_1_1_f_f_allocator_a120393744e98f0ed5fe086a25521ca00}{lock}});}
\DoxyCodeLine{01473\ }
\DoxyCodeLine{01474\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>newallocator.fetch\_add(1));}
\DoxyCodeLine{01475\ }
\DoxyCodeLine{01476\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ffaxtd;}
\DoxyCodeLine{01477\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01478\ }
\DoxyCodeLine{01479\ }
\DoxyCodeLine{01480\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{01481\ }
\DoxyCodeLine{01487\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_f_f_allocator_a14063768984177b43e47950e1e67be32}{FFAllocator}}(\textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff_1_1_f_f_allocator_a95cfdf153883ae42a8f318c60f0abb9f}{delayedReclaim}}=0)\ :}
\DoxyCodeLine{01488\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}}(0),\ \mbox{\hyperlink{classff_1_1_f_f_allocator_af3352177bcdbfca3186186c76618d88c}{A\_capacity}}(0),\ \mbox{\hyperlink{classff_1_1_f_f_allocator_a322c667c6bb7330dbc3d0ba16b2599e2}{A\_size}}(0),}
\DoxyCodeLine{01489\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_f_f_allocator_a95cfdf153883ae42a8f318c60f0abb9f}{delayedReclaim}}(\mbox{\hyperlink{classff_1_1_f_f_allocator_a95cfdf153883ae42a8f318c60f0abb9f}{delayedReclaim}})}
\DoxyCodeLine{01490\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01491\ \ \ \ \ \ \ \ \ \ \ \ \ init\_unlocked(\mbox{\hyperlink{classff_1_1_f_f_allocator_a120393744e98f0ed5fe086a25521ca00}{lock}});}
\DoxyCodeLine{01492\ }
\DoxyCodeLine{01493\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{pthread__minport__windows_8h_aeec8c9fbaa95db94c605152be4dbe088}{pthread\_key\_create}}(\ \&\mbox{\hyperlink{classff_1_1_f_f_allocator_a2aa4953ca4f4e4eb53acd60ce8e57303}{A\_key}},}
\DoxyCodeLine{01494\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{classff_1_1_f_f_allocator_a95cfdf153883ae42a8f318c60f0abb9f}{delayedReclaim}}\ ?\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ :\ \mbox{\hyperlink{namespaceff_a7ce928bba667c9a4c80178bf1d10e8ea}{FFAkeyDestructorHandler}})\ )!=0)\ \ \{}
\DoxyCodeLine{01495\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceff_a27d926d29b55e019eba5b70672301d82}{error}}(\textcolor{stringliteral}{"{}FFAllocator\ FATAL\ ERROR:\ pthread\_key\_create\ fails\(\backslash\)n"{}});}
\DoxyCodeLine{01496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ abort();}
\DoxyCodeLine{01497\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01498\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01499\ }
\DoxyCodeLine{01505\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_f_f_allocator_ab05d8dc09da9cde929a60137ff869207}{\string~FFAllocator}}()\ \{}
\DoxyCodeLine{01506\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1_f_f_allocator_a95cfdf153883ae42a8f318c60f0abb9f}{delayedReclaim}})\ \{}
\DoxyCodeLine{01507\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}})\ \{}
\DoxyCodeLine{01508\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=0;\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{classff_1_1_f_f_allocator_a322c667c6bb7330dbc3d0ba16b2599e2}{A\_size}};++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01509\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}])\ \mbox{\hyperlink{classff_1_1_f_f_allocator_afc84ba77a7deeb78c970589dd8c065bc}{deleteAllocator}}(\mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>\mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}});}
\DoxyCodeLine{01510\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mimalloc-override_8h_a9d4b5df3530d1bc733070a4669ba6ebc}{::free}}(\mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}});}
\DoxyCodeLine{01511\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01512\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pthread__minport__windows_8h_a20c3a19dc169f60d2b3df87499686ac2}{pthread\_key\_delete}}(\mbox{\hyperlink{classff_1_1_f_f_allocator_a2aa4953ca4f4e4eb53acd60ce8e57303}{A\_key}});}
\DoxyCodeLine{01513\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01514\ }
\DoxyCodeLine{01515\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01516\ }
\DoxyCodeLine{01521\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{classff_1_1_f_f_allocator_a14063768984177b43e47950e1e67be32}{FFAllocator}}\ *\ \mbox{\hyperlink{classff_1_1_f_f_allocator_adeb8f18b5ea955ec7c3941d8e38c2fcc}{instance}}()\ \{}
\DoxyCodeLine{01522\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classff_1_1_f_f_allocator_a14063768984177b43e47950e1e67be32}{FFAllocator}}\ FFA;}
\DoxyCodeLine{01523\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \&FFA;}
\DoxyCodeLine{01524\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01525\ }
\DoxyCodeLine{01526\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{01527\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Allocator\ factory\ method.}}
\DoxyCodeLine{01528\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{01529\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Each\ time\ this\ method\ is\ called\ it\ spawns\ a\ new\ memory\ allocator.\ The}}
\DoxyCodeLine{01530\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ calling\ thread\ is\ registered\ as\ an\ allocator\ thread.\ Other\ threads}}
\DoxyCodeLine{01531\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ willing\ to\ use\ this\ SlabCache\ have\ to\ register\ themselves\ to\ the\ shared}}
\DoxyCodeLine{01532\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ leak\ queue\ of\ the\ allocator.}}
\DoxyCodeLine{01533\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{01534\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)param\ max\_size\ PARAMETER\ NOT\ USED!}}
\DoxyCodeLine{01535\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)param\ \_nslabs\ \ array\ specifying\ the\ allowed\ quantities\ of\ buffers.\ By}}
\DoxyCodeLine{01536\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ default\ it\ is\ initialised\ to\ 0s}}
\DoxyCodeLine{01537\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)param\ prealloc\ flag\ that\ is\ used\ as\ a\ mask\ when\ creating\ a\ new\ slab.}}
\DoxyCodeLine{01538\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Default\ is\ \(\backslash\)p\ true.}}
\DoxyCodeLine{01539\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{01540\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)returns\ a\ \(\backslash\)p\ ffa\_wrapper\ object,\ that\ is\ in\ turn\ an\ extension\ of}}
\DoxyCodeLine{01541\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ a\ \(\backslash\)ff\_allocator\ object.}}
\DoxyCodeLine{01542\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{01543\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \mbox{\hyperlink{classff_1_1ffa__wrapper}{ffa\_wrapper}}\ *\ \mbox{\hyperlink{classff_1_1_f_f_allocator_a93138a8a73364e7e9f7a37a4895c1690}{newAllocator}}(\ \textcolor{keywordtype}{size\_t}\ max\_size=0,}
\DoxyCodeLine{01544\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \_nslabs[\mbox{\hyperlink{namespaceff_ac70617c84eb066a57e5d904bf5c3e62da9b057b825c2a8d1ab94ef55519344dd1}{N\_SLABBUFFER}}]=0,}
\DoxyCodeLine{01545\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ prealloc=\textcolor{keyword}{true}\ )}
\DoxyCodeLine{01546\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01547\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_f_f_ax_thread_data}{FFAxThreadData}}\ *\ ffaxtd\ =\ \mbox{\hyperlink{classff_1_1_f_f_allocator_aafb4c080d57ae46f3dd48b3179199e6d}{newAllocator}}(prealloc,\ \_nslabs,\ max\_size);}
\DoxyCodeLine{01548\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!ffaxtd)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01549\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ffaxtd-\/>\mbox{\hyperlink{structff_1_1_f_f_ax_thread_data_a82a1a74158119103c513a9cfe1923e6e}{f}};}
\DoxyCodeLine{01550\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01551\ }
\DoxyCodeLine{01552\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{01553\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Delete\ the\ allocator\ \(\backslash\)p\ f\ passed\ as\ argument\ and\ reclaim\ the\ used}}
\DoxyCodeLine{01554\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ memory.\(\backslash\)n\ Also\ updates\ the\ counter\ of\ the\ available\ size\ in\ the\ slab}}
\DoxyCodeLine{01555\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{01556\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)param\ f\ an\ object\ of\ type\ ffa\_wrapper.}}
\DoxyCodeLine{01557\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \(\backslash\)param\ reclaimMemory\ flag\ to\ decide\ whether\ to\ reclaim\ memory\ or\ not.}}
\DoxyCodeLine{01558\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{01559\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff_1_1_f_f_allocator_a084d6b571f1efda50fec501844104f5f}{deleteAllocator}}(\mbox{\hyperlink{classff_1_1ffa__wrapper}{ffa\_wrapper}}\ *\ \mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}},\ \textcolor{keywordtype}{bool}\ reclaimMemory=\textcolor{keyword}{true})\ \{}
\DoxyCodeLine{01560\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}})\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01561\ }
\DoxyCodeLine{01562\ \ \ \ \ \ \ \ \ \ \ \ \ spin\_lock(\mbox{\hyperlink{classff_1_1_f_f_allocator_a120393744e98f0ed5fe086a25521ca00}{lock}});}
\DoxyCodeLine{01563\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=0;\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{classff_1_1_f_f_allocator_a322c667c6bb7330dbc3d0ba16b2599e2}{A\_size}};++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{01564\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>\mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}}\ ==\ \mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}})\ \{}
\DoxyCodeLine{01565\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}}-\/>deregisterAllocator(reclaimMemory);}
\DoxyCodeLine{01566\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}}-\/>\string~ffa\_wrapper();}
\DoxyCodeLine{01567\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>\string~FFAxThreadData();}
\DoxyCodeLine{01568\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mimalloc-override_8h_a9d4b5df3530d1bc733070a4669ba6ebc}{::free}}(\mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]);}
\DoxyCodeLine{01569\ }
\DoxyCodeLine{01570\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}=\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}+1;\mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}<\mbox{\hyperlink{classff_1_1_f_f_allocator_a322c667c6bb7330dbc3d0ba16b2599e2}{A\_size}};++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}},++\mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}})}
\DoxyCodeLine{01571\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]=\mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}}[\mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}];}
\DoxyCodeLine{01572\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/\mbox{\hyperlink{classff_1_1_f_f_allocator_a322c667c6bb7330dbc3d0ba16b2599e2}{A\_size}};}
\DoxyCodeLine{01573\ }
\DoxyCodeLine{01574\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01575\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01576\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01577\ \ \ \ \ \ \ \ \ \ \ \ \ spin\_unlock(\mbox{\hyperlink{classff_1_1_f_f_allocator_a120393744e98f0ed5fe086a25521ca00}{lock}});}
\DoxyCodeLine{01578\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>deleteallocator.fetch\_add(1));}
\DoxyCodeLine{01579\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01580\ }
\DoxyCodeLine{01581\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{01582\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Delete\ allocator\ owned\ by\ calling\ thread\ and\ reclaim\ memory}}
\DoxyCodeLine{01583\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *}}
\DoxyCodeLine{01584\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{01585\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff_1_1_f_f_allocator_afc84ba77a7deeb78c970589dd8c065bc}{deleteAllocator}}()\ \{}
\DoxyCodeLine{01586\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_f_f_ax_thread_data}{FFAxThreadData}}\ *\ ffaxtd\ =\ (\mbox{\hyperlink{structff_1_1_f_f_ax_thread_data}{FFAxThreadData}}*)\mbox{\hyperlink{pthread__minport__windows_8h_ab064e0f7c4c8e199c99a7617c924931b}{pthread\_getspecific}}(\mbox{\hyperlink{classff_1_1_f_f_allocator_a2aa4953ca4f4e4eb53acd60ce8e57303}{A\_key}});}
\DoxyCodeLine{01587\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!ffaxtd)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01588\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_f_f_allocator_afc84ba77a7deeb78c970589dd8c065bc}{deleteAllocator}}(ffaxtd-\/>\mbox{\hyperlink{structff_1_1_f_f_ax_thread_data_a82a1a74158119103c513a9cfe1923e6e}{f}},\textcolor{keyword}{true});}
\DoxyCodeLine{01589\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01590\ }
\DoxyCodeLine{01601\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{classff_1_1_f_f_allocator_a31d2c6453ebb112ae523eb8da155707f}{malloc}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}})\ \{}
\DoxyCodeLine{01602\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ use\ standard\ allocator\ if\ the\ size\ is\ too\ big\ */}}
\DoxyCodeLine{01603\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}}>\mbox{\hyperlink{namespaceff_ac70617c84eb066a57e5d904bf5c3e62dac4e03297ac4c5065b5b8690d0c651dae}{MAX\_SLABBUFFER\_SIZE}})\ \{}
\DoxyCodeLine{01604\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>sysmalloc.fetch\_add(1));}
\DoxyCodeLine{01605\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}\ =\ \mbox{\hyperlink{mimalloc-override_8h_a99aa8fd9f4831e1b0fa9e1cdcde3e249}{::malloc}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}}+\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}));}
\DoxyCodeLine{01606\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01607\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})-\/>ptr\ =\ 0;}
\DoxyCodeLine{01608\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{char}\ *)\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}\ +\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}});}
\DoxyCodeLine{01609\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01610\ }
\DoxyCodeLine{01611\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_f_f_ax_thread_data}{FFAxThreadData}}\ *\ ffaxtd\ =\ (\mbox{\hyperlink{structff_1_1_f_f_ax_thread_data}{FFAxThreadData}}*)\ \mbox{\hyperlink{pthread__minport__windows_8h_ab064e0f7c4c8e199c99a7617c924931b}{pthread\_getspecific}}(\mbox{\hyperlink{classff_1_1_f_f_allocator_a2aa4953ca4f4e4eb53acd60ce8e57303}{A\_key}});}
\DoxyCodeLine{01612\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!ffaxtd)\ \{}
\DoxyCodeLine{01613\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ no\ thread-\/data\ is\ associated\ to\ the\ key}}
\DoxyCodeLine{01614\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ initialise\ and\ register\ a\ new\ allocator}}
\DoxyCodeLine{01615\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ REW\ -\/-\/\ why\ prealloc\ is\ FALSE??}}
\DoxyCodeLine{01616\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{01617\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ffaxtd\ =\ \mbox{\hyperlink{classff_1_1_f_f_allocator_aafb4c080d57ae46f3dd48b3179199e6d}{newAllocator}}(\textcolor{keyword}{false},0,0);}
\DoxyCodeLine{01618\ }
\DoxyCodeLine{01619\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!ffaxtd)\ \{}
\DoxyCodeLine{01620\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceff_a27d926d29b55e019eba5b70672301d82}{error}}(\textcolor{stringliteral}{"{}FFAllocator:malloc:\ newAllocator\ fails!\(\backslash\)n"{}});}
\DoxyCodeLine{01621\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01622\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01623\ }
\DoxyCodeLine{01624\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ REW\ -\/-\/\ ?}}
\DoxyCodeLine{01625\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ spin\_lock(\mbox{\hyperlink{classff_1_1_f_f_allocator_a120393744e98f0ed5fe086a25521ca00}{lock}});}
\DoxyCodeLine{01626\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{pthread__minport__windows_8h_a0dbd17094cde9a462d8e04a0741595b2}{pthread\_setspecific}}(\mbox{\hyperlink{classff_1_1_f_f_allocator_a2aa4953ca4f4e4eb53acd60ce8e57303}{A\_key}},\ ffaxtd)!=0)\ \{}
\DoxyCodeLine{01627\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_f_f_allocator_afc84ba77a7deeb78c970589dd8c065bc}{deleteAllocator}}(ffaxtd-\/>\mbox{\hyperlink{structff_1_1_f_f_ax_thread_data_a82a1a74158119103c513a9cfe1923e6e}{f}});}
\DoxyCodeLine{01628\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ spin\_unlock(\mbox{\hyperlink{classff_1_1_f_f_allocator_a120393744e98f0ed5fe086a25521ca00}{lock}});}
\DoxyCodeLine{01629\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01630\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01631\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ spin\_unlock(\mbox{\hyperlink{classff_1_1_f_f_allocator_a120393744e98f0ed5fe086a25521ca00}{lock}});}
\DoxyCodeLine{01632\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01633\ }
\DoxyCodeLine{01634\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ffaxtd-\/>\mbox{\hyperlink{structff_1_1_f_f_ax_thread_data_a82a1a74158119103c513a9cfe1923e6e}{f}}-\/>\mbox{\hyperlink{classff_1_1ffa__wrapper_abb4205d3fbd73f705dfa3633aae66b4c}{malloc}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}});}
\DoxyCodeLine{01635\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01636\ }
\DoxyCodeLine{01648\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff_1_1_f_f_allocator_ac9f4185b78a1516480aa89de8847a640}{posix\_memalign}}(\textcolor{keywordtype}{void}\ **memptr,\ \textcolor{keywordtype}{size\_t}\ alignment,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}})\ \{}
\DoxyCodeLine{01649\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{namespaceff_a94e8617a117c5ad8c4ce0d196c1413da}{isPowerOfTwoMultiple}}(alignment,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{void}\ *)))\ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01650\ }
\DoxyCodeLine{01651\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ realsize\ =\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}}+alignment;}
\DoxyCodeLine{01652\ }
\DoxyCodeLine{01653\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (realsize\ >\ \mbox{\hyperlink{namespaceff_ac70617c84eb066a57e5d904bf5c3e62dac4e03297ac4c5065b5b8690d0c651dae}{MAX\_SLABBUFFER\_SIZE}})\ \{}
\DoxyCodeLine{01654\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>sysmalloc.fetch\_add(1));}
\DoxyCodeLine{01655\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}\ =\ \mbox{\hyperlink{mimalloc-override_8h_a99aa8fd9f4831e1b0fa9e1cdcde3e249}{::malloc}}(realsize+\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}));}
\DoxyCodeLine{01656\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01657\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})-\/>ptr\ =\ 0;}
\DoxyCodeLine{01658\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\ ptraligned\ =\ (\textcolor{keywordtype}{void}\ *)(((\textcolor{keywordtype}{long})((\textcolor{keywordtype}{char}*)\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}+\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}))\ +\ alignment)\ \&\ \string~(alignment-\/1));}
\DoxyCodeLine{01659\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)((\textcolor{keywordtype}{char}\ *)ptraligned\ -\/\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}})))-\/>ptr\ =\ 0;}
\DoxyCodeLine{01660\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *memptr\ =\ ptraligned;}
\DoxyCodeLine{01661\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01662\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01663\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_f_f_ax_thread_data}{FFAxThreadData}}\ *\ ffaxtd\ =\ (\mbox{\hyperlink{structff_1_1_f_f_ax_thread_data}{FFAxThreadData}}*)\mbox{\hyperlink{pthread__minport__windows_8h_ab064e0f7c4c8e199c99a7617c924931b}{pthread\_getspecific}}(\mbox{\hyperlink{classff_1_1_f_f_allocator_a2aa4953ca4f4e4eb53acd60ce8e57303}{A\_key}});}
\DoxyCodeLine{01664\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!ffaxtd)\ \{}
\DoxyCodeLine{01665\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ initialise\ and\ register\ a\ new\ allocator}}
\DoxyCodeLine{01666\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ REW\ -\/-\/\ why\ prealloc\ FALSE??}}
\DoxyCodeLine{01667\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ffaxtd\ =\ \mbox{\hyperlink{classff_1_1_f_f_allocator_aafb4c080d57ae46f3dd48b3179199e6d}{newAllocator}}(\textcolor{keyword}{false},0,0);}
\DoxyCodeLine{01668\ }
\DoxyCodeLine{01669\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!ffaxtd)\ \{}
\DoxyCodeLine{01670\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceff_a27d926d29b55e019eba5b70672301d82}{error}}(\textcolor{stringliteral}{"{}FFAllocator:posix\_memalign:\ newAllocator\ fails!\(\backslash\)n"{}});}
\DoxyCodeLine{01671\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01672\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01673\ }
\DoxyCodeLine{01674\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ spin\_lock(\mbox{\hyperlink{classff_1_1_f_f_allocator_a120393744e98f0ed5fe086a25521ca00}{lock}});}
\DoxyCodeLine{01675\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{pthread__minport__windows_8h_a0dbd17094cde9a462d8e04a0741595b2}{pthread\_setspecific}}(\mbox{\hyperlink{classff_1_1_f_f_allocator_a2aa4953ca4f4e4eb53acd60ce8e57303}{A\_key}},\ ffaxtd)!=0)\ \{}
\DoxyCodeLine{01676\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_f_f_allocator_afc84ba77a7deeb78c970589dd8c065bc}{deleteAllocator}}(ffaxtd-\/>\mbox{\hyperlink{structff_1_1_f_f_ax_thread_data_a82a1a74158119103c513a9cfe1923e6e}{f}});}
\DoxyCodeLine{01677\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ spin\_unlock(\mbox{\hyperlink{classff_1_1_f_f_allocator_a120393744e98f0ed5fe086a25521ca00}{lock}});}
\DoxyCodeLine{01678\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01679\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01680\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ spin\_unlock(\mbox{\hyperlink{classff_1_1_f_f_allocator_a120393744e98f0ed5fe086a25521ca00}{lock}});}
\DoxyCodeLine{01681\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01682\ }
\DoxyCodeLine{01683\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ffaxtd-\/>\mbox{\hyperlink{structff_1_1_f_f_ax_thread_data_a82a1a74158119103c513a9cfe1923e6e}{f}}-\/>\mbox{\hyperlink{classff_1_1ffa__wrapper_a03ded4a9da45b06eb82b4366513abf45}{posix\_memalign}}(memptr,alignment,\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}});}
\DoxyCodeLine{01684\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01685\ }
\DoxyCodeLine{01694\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \ \ \mbox{\hyperlink{classff_1_1_f_f_allocator_af8a3d0229a337ec1eb1300a6d188f9cf}{free}}(\textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \{}
\DoxyCodeLine{01695\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01696\ }
\DoxyCodeLine{01697\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ \ *\ buf\ =\ (\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)((\textcolor{keywordtype}{char}\ *)\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}\ -\/\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}));}
\DoxyCodeLine{01698\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!buf-\/>\mbox{\hyperlink{structff_1_1_buf__ctl_a577380a7867fa0c24543931999c09407}{ptr}})\ \{}
\DoxyCodeLine{01699\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>sysfree.fetch\_add(1));}
\DoxyCodeLine{01700\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mimalloc-override_8h_a9d4b5df3530d1bc733070a4669ba6ebc}{::free}}(buf);}
\DoxyCodeLine{01701\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01702\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01703\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ \ *\ buf2\ =\ (\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)((\textcolor{keywordtype}{char}\ *)buf\ -\/\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}));}
\DoxyCodeLine{01704\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(buf-\/>\mbox{\hyperlink{structff_1_1_buf__ctl_a577380a7867fa0c24543931999c09407}{ptr}}\ ==\ buf2-\/>\mbox{\hyperlink{structff_1_1_buf__ctl_a577380a7867fa0c24543931999c09407}{ptr}})\ \{}
\DoxyCodeLine{01705\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ buf\ =\ buf2;}
\DoxyCodeLine{01706\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ buf2\ =\ (\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)((\textcolor{keywordtype}{char}\ *)buf\ -\/\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}));}
\DoxyCodeLine{01707\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01708\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_ad33d37230e2f3c601bc29fc619adde35}{DBG}}(\textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classff_1_1_f_f_allocator_a5c331370c04418cec3e151782994ac2b}{getsegctl}}(buf)-\/>allocator)\ abort());}
\DoxyCodeLine{01709\ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{classff_1_1_f_f_allocator_a5c331370c04418cec3e151782994ac2b}{getsegctl}}(buf)-\/>\mbox{\hyperlink{structff_1_1_seg__ctl_af833ba28f55b725b21484347f06697eb}{allocator}})-\/>\mbox{\hyperlink{mimalloc-override_8h_a9d4b5df3530d1bc733070a4669ba6ebc}{free}}(buf);}
\DoxyCodeLine{01710\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01711\ }
\DoxyCodeLine{01722\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{classff_1_1_f_f_allocator_a65f9c023e525f7b529c4250adf3b1feb}{realloc}}(\textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}},\ \textcolor{keywordtype}{size\_t}\ newsize)\ \{}
\DoxyCodeLine{01723\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \{}
\DoxyCodeLine{01724\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ \ *\ buf\ =\ (\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)((\textcolor{keywordtype}{char}\ *)\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}\ -\/\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}));}
\DoxyCodeLine{01725\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!buf-\/>\mbox{\hyperlink{structff_1_1_buf__ctl_a577380a7867fa0c24543931999c09407}{ptr}})\ \{\ \textcolor{comment}{/*\ use\ standard\ allocator\ */}}
\DoxyCodeLine{01726\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>sysrealloc.fetch\_add(1));}
\DoxyCodeLine{01727\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\ newptr=\ \mbox{\hyperlink{mimalloc-override_8h_adbbb9b1695e5714db8873077d44ade2f}{::realloc}}(buf,\ newsize+\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}));}
\DoxyCodeLine{01728\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01729\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)newptr)-\/>ptr\ =\ 0;}
\DoxyCodeLine{01730\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{char}\ *)newptr\ +\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}});}
\DoxyCodeLine{01731\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01732\ }
\DoxyCodeLine{01733\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ffa__wrapper}{ffa\_wrapper}}\ *\ \mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}}\ =\ (\mbox{\hyperlink{classff_1_1ffa__wrapper}{ffa\_wrapper}}*)\ \mbox{\hyperlink{pthread__minport__windows_8h_ab064e0f7c4c8e199c99a7617c924931b}{pthread\_getspecific}}(\mbox{\hyperlink{classff_1_1_f_f_allocator_a2aa4953ca4f4e4eb53acd60ce8e57303}{A\_key}});}
\DoxyCodeLine{01734\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}})\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01735\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}}-\/>realloc(\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}},newsize);}
\DoxyCodeLine{01736\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01737\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ this-\/>\mbox{\hyperlink{mimalloc-override_8h_a99aa8fd9f4831e1b0fa9e1cdcde3e249}{malloc}}(newsize);}
\DoxyCodeLine{01738\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01739\ }
\DoxyCodeLine{01740\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{classff_1_1_f_f_allocator_a81f85ed9c4f8cec1d6d00a9dcc2177c7}{growsup}}(\textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}},\ \textcolor{keywordtype}{size\_t}\ newsize)\ \{}
\DoxyCodeLine{01741\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \{}
\DoxyCodeLine{01742\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ \ *\ buf\ =\ (\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)((\textcolor{keywordtype}{char}\ *)\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}\ -\/\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}));}
\DoxyCodeLine{01743\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!buf-\/>\mbox{\hyperlink{structff_1_1_buf__ctl_a577380a7867fa0c24543931999c09407}{ptr}})\ \{\ \textcolor{comment}{/*\ use\ standard\ allocator\ */}}
\DoxyCodeLine{01744\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(all\_stats::instance()-\/>sysrealloc.fetch\_add(1));}
\DoxyCodeLine{01745\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\ newptr=\ \mbox{\hyperlink{mimalloc-override_8h_adbbb9b1695e5714db8873077d44ade2f}{::realloc}}(buf,\ newsize+\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}));}
\DoxyCodeLine{01746\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01747\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}}\ *)newptr)-\/>ptr\ =\ 0;}
\DoxyCodeLine{01748\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{char}\ *)newptr\ +\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structff_1_1_buf__ctl}{Buf\_ctl}});}
\DoxyCodeLine{01749\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01750\ }
\DoxyCodeLine{01751\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ffa__wrapper}{ffa\_wrapper}}\ *\ \mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}}\ =\ (\mbox{\hyperlink{classff_1_1ffa__wrapper}{ffa\_wrapper}}*)\mbox{\hyperlink{pthread__minport__windows_8h_ab064e0f7c4c8e199c99a7617c924931b}{pthread\_getspecific}}(\mbox{\hyperlink{classff_1_1_f_f_allocator_a2aa4953ca4f4e4eb53acd60ce8e57303}{A\_key}});}
\DoxyCodeLine{01752\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}})\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01753\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{cxx11__tensor__map_8cpp_a7f507fea02198f6cb81c86640c7b1a4e}{f}}-\/>growsup(\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}},newsize);}
\DoxyCodeLine{01754\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01755\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ this-\/>\mbox{\hyperlink{mimalloc-override_8h_a99aa8fd9f4831e1b0fa9e1cdcde3e249}{malloc}}(newsize);}
\DoxyCodeLine{01756\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01757\ }
\DoxyCodeLine{01758\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{allocator_8hpp_a2fbd97af3a198200b674b6658fb90a50}{ALLSTATS}}(\textcolor{keywordtype}{void}\ printstats(std::ostream\ \&\ out)\ \{}
\DoxyCodeLine{01759\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ all\_stats::instance()-\/>print(out);}
\DoxyCodeLine{01760\ \ \ \ \ \ \ \ \ \ \ \ \ \})}
\DoxyCodeLine{01761\ }
\DoxyCodeLine{01762\ \ \ \ \ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{01763\ \ \ \ \ \ \ \ \ FFAxThreadData\ **\mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}};\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ffa\_wrapper\ :\ ff\_allocator}}
\DoxyCodeLine{01764\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_f_f_allocator_af3352177bcdbfca3186186c76618d88c}{A\_capacity}};\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{01765\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_f_f_allocator_a322c667c6bb7330dbc3d0ba16b2599e2}{A\_size}};\ \ \ \ \ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{01766\ }
\DoxyCodeLine{01767\ \ \ \ \ \ \ \ \ lock\_t\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_f_f_allocator_a120393744e98f0ed5fe086a25521ca00}{lock}};}
\DoxyCodeLine{01768\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pthread__minport__windows_8h_abd9df76622c288b7b7a8a80365b6ddd7}{pthread\_key\_t}}\ \ \ \mbox{\hyperlink{classff_1_1_f_f_allocator_a2aa4953ca4f4e4eb53acd60ce8e57303}{A\_key}};}
\DoxyCodeLine{01769\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_f_f_allocator_a95cfdf153883ae42a8f318c60f0abb9f}{delayedReclaim}};}
\DoxyCodeLine{01770\ \ \ \ \ \};}
\DoxyCodeLine{01771\ }
\DoxyCodeLine{01772\ \ \ \ \ \textcolor{comment}{/*\ REW\ -\/\ Document\ these?\ */}}
\DoxyCodeLine{01773\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceff_a7ce928bba667c9a4c80178bf1d10e8ea}{FFAkeyDestructorHandler}}(\textcolor{keywordtype}{void}\ *\ kv)\ \{}
\DoxyCodeLine{01774\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structff_1_1_f_f_ax_thread_data}{FFAxThreadData}}\ *\ ffaxtd\ =\ (\mbox{\hyperlink{structff_1_1_f_f_ax_thread_data}{FFAxThreadData}}*)kv;}
\DoxyCodeLine{01775\ \ \ \ \ \ \ \ \ ffaxtd-\/>\mbox{\hyperlink{structff_1_1_f_f_ax_thread_data_a82a1a74158119103c513a9cfe1923e6e}{f}}-\/>\mbox{\hyperlink{classff_1_1ffa__wrapper_ab8c9047ab7fad19b1294ecd0f142d639}{nomoremalloc}}();}
\DoxyCodeLine{01776\ \ \ \ \ \ \ \ \ ffaxtd-\/>\mbox{\hyperlink{structff_1_1_f_f_ax_thread_data_a82a1a74158119103c513a9cfe1923e6e}{f}}-\/>\mbox{\hyperlink{classff_1_1ff__allocator_acc24fb135fae47a76d9c4581f7fe74ea}{deregisterAllocator}}();}
\DoxyCodeLine{01777\ \ \ \ \ \}}
\DoxyCodeLine{01778\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceff_ab0944ddc87ac43b2b29fa77c9c435361}{killMyself}}(\mbox{\hyperlink{classff_1_1ffa__wrapper}{ffa\_wrapper}}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \{}
\DoxyCodeLine{01779\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_f_f_allocator_adeb8f18b5ea955ec7c3941d8e38c2fcc}{FFAllocator::instance}}()-\/>\mbox{\hyperlink{classff_1_1_f_f_allocator_a084d6b571f1efda50fec501844104f5f}{deleteAllocator}}(\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}});}
\DoxyCodeLine{01780\ \ \ \ \ \}}
\DoxyCodeLine{01781\ }
\DoxyCodeLine{01782\ }
\DoxyCodeLine{01783\ \ \ \ \ \textcolor{comment}{//\ Static\ functions\ below\ are\ not\ documented,\ but\ their\ usage\ is\ quite\ obvious}}
\DoxyCodeLine{01784\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{namespaceff_a51a2593e7c0dcaef7e36d2ce733bc5bc}{ff\_malloc}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}})\ \{}
\DoxyCodeLine{01785\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff_1_1_f_f_allocator_adeb8f18b5ea955ec7c3941d8e38c2fcc}{FFAllocator::instance}}()-\/>\mbox{\hyperlink{classff_1_1_f_f_allocator_a31d2c6453ebb112ae523eb8da155707f}{malloc}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}});}
\DoxyCodeLine{01786\ \ \ \ \ \}}
\DoxyCodeLine{01787\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \ \ \mbox{\hyperlink{namespaceff_a5e79b0a002e32d63c4049995f1e38a44}{ff\_free}}(\textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \{}
\DoxyCodeLine{01788\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_f_f_allocator_adeb8f18b5ea955ec7c3941d8e38c2fcc}{FFAllocator::instance}}()-\/>\mbox{\hyperlink{classff_1_1_f_f_allocator_af8a3d0229a337ec1eb1300a6d188f9cf}{free}}(\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}});}
\DoxyCodeLine{01789\ \ \ \ \ \}}
\DoxyCodeLine{01790\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{namespaceff_a94dc33d45aea6301a545275f0b226cca}{ff\_realloc}}(\textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}},\ \textcolor{keywordtype}{size\_t}\ newsize)\ \{}
\DoxyCodeLine{01791\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff_1_1_f_f_allocator_adeb8f18b5ea955ec7c3941d8e38c2fcc}{FFAllocator::instance}}()-\/>\mbox{\hyperlink{classff_1_1_f_f_allocator_a65f9c023e525f7b529c4250adf3b1feb}{realloc}}(\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}},newsize);}
\DoxyCodeLine{01792\ \ \ \ \ \}}
\DoxyCodeLine{01793\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \ \ \ \mbox{\hyperlink{namespaceff_a79a7a00587aeb4226a0ff161eed08271}{ff\_posix\_memalign}}(\textcolor{keywordtype}{void}\ **memptr,\ \textcolor{keywordtype}{size\_t}\ alignment,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}})\ \{}
\DoxyCodeLine{01794\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff_1_1_f_f_allocator_adeb8f18b5ea955ec7c3941d8e38c2fcc}{FFAllocator::instance}}()-\/>\mbox{\hyperlink{classff_1_1_f_f_allocator_ac9f4185b78a1516480aa89de8847a640}{posix\_memalign}}(memptr,alignment,\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}});}
\DoxyCodeLine{01795\ \ \ \ \ \}}
\DoxyCodeLine{01796\ }
\DoxyCodeLine{01797\ }
\DoxyCodeLine{01798\ \}\ \textcolor{comment}{//\ namespace\ ff}}
\DoxyCodeLine{01799\ }
\DoxyCodeLine{01800\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ FF\_ALLOCATOR\_HPP\ */}\textcolor{preprocessor}{}}

\end{DoxyCode}
