\doxysection{gcc\+\_\+itsx.\+h}
\hypertarget{gcc__itsx_8h_source}{}\label{gcc__itsx_8h_source}\index{external/taskflow/3rd-\/party/tbb/include/tbb/machine/gcc\_itsx.h@{external/taskflow/3rd-\/party/tbb/include/tbb/machine/gcc\_itsx.h}}
\mbox{\hyperlink{gcc__itsx_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ \ \ \ Copyright\ (c)\ 2005-\/2020\ Intel\ Corporation}}
\DoxyCodeLine{00003\ \textcolor{comment}{}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ \ \ \ Licensed\ under\ the\ Apache\ License,\ Version\ 2.0\ (the\ "{}License"{});}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ \ \ \ you\ may\ not\ use\ this\ file\ except\ in\ compliance\ with\ the\ License.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ \ \ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00007\ \textcolor{comment}{}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ \ \ \ \ \ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00009\ \textcolor{comment}{}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ \ \ \ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,\ software}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ \ \ \ distributed\ under\ the\ License\ is\ distributed\ on\ an\ "{}AS\ IS"{}\ BASIS,}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ \ \ \ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY\ KIND,\ either\ express\ or\ implied.}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ \ \ \ See\ the\ License\ for\ the\ specific\ language\ governing\ permissions\ and}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ \ \ \ limitations\ under\ the\ License.}}
\DoxyCodeLine{00015\ \textcolor{comment}{*/}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#if\ !defined(\_\_TBB\_machine\_H)\ ||\ defined(\_\_TBB\_machine\_gcc\_itsx\_H)}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#error\ Do\ not\ \#include\ this\ internal\ file\ directly;\ use\ public\ TBB\ headers\ instead.}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#define\ \_\_TBB\_machine\_gcc\_itsx\_H}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#define\ \_\_TBB\_OP\_XACQUIRE\ 0xF2}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#define\ \_\_TBB\_OP\_XRELEASE\ 0xF3}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#define\ \_\_TBB\_OP\_LOCK\ \ \ \ \ 0xF0}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#define\ \_\_TBB\_STRINGIZE\_INTERNAL(arg)\ \#arg}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#define\ \_\_TBB\_STRINGIZE(arg)\ \_\_TBB\_STRINGIZE\_INTERNAL(arg)}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#ifdef\ \_\_TBB\_x86\_64}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#define\ \_\_TBB\_r\_out\ "{}=r"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#define\ \_\_TBB\_r\_out\ "{}=q"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \textcolor{keyword}{inline}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{gcc__itsx_8h_a4e016a5e7abdf67d3a7f83f6dc256eac}{\_\_TBB\_machine\_try\_lock\_elided}}(\ \textcolor{keyword}{volatile}\ \mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*\ lk\ )}
\DoxyCodeLine{00037\ \{}
\DoxyCodeLine{00038\ \ \ \ \ \mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_abe8e049f756b5ba547bda825af81b645}{value}}\ =\ 1;}
\DoxyCodeLine{00039\ \ \ \ \ \_\_asm\_\_\ \textcolor{keyword}{volatile}\ (\textcolor{stringliteral}{"{}.byte\ "{}}\ \mbox{\hyperlink{gcc__itsx_8h_a80156038db02057a85e581c6229d2823}{\_\_TBB\_STRINGIZE}}(\mbox{\hyperlink{gcc__itsx_8h_a74aec0f6a131958314a3601e273bce59}{\_\_TBB\_OP\_XACQUIRE}})\textcolor{stringliteral}{"{};\ lock;\ xchgb\ \%0,\ \%1;"{}}}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{gcc__itsx_8h_a6b0eed7a5bc5c7bbaa858f1f7d4c19a5}{\_\_TBB\_r\_out}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_abe8e049f756b5ba547bda825af81b645}{value}}),\ \textcolor{stringliteral}{"{}=m"{}}(*lk)\ \ :\ \textcolor{stringliteral}{"{}0"{}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_abe8e049f756b5ba547bda825af81b645}{value}}),\ \textcolor{stringliteral}{"{}m"{}}(*lk)\ :\ \textcolor{stringliteral}{"{}memory"{}}\ );}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_abe8e049f756b5ba547bda825af81b645}{value}}\string^1);}
\DoxyCodeLine{00042\ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \textcolor{keyword}{inline}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{gcc__itsx_8h_a0737c9bdf1a04557d066fe023a2bdd93}{\_\_TBB\_machine\_try\_lock\_elided\_cancel}}()}
\DoxyCodeLine{00045\ \{}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{comment}{//\ 'pause'\ instruction\ aborts\ HLE/RTM\ transactions}}
\DoxyCodeLine{00047\ \ \ \ \ \_\_asm\_\_\ \textcolor{keyword}{volatile}\ (\textcolor{stringliteral}{"{}pause\(\backslash\)n"{}}\ :\ :\ :\ \textcolor{stringliteral}{"{}memory"{}}\ );}
\DoxyCodeLine{00048\ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \textcolor{keyword}{inline}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{gcc__itsx_8h_a2c9b93854a733861350ae1e9e081671a}{\_\_TBB\_machine\_unlock\_elided}}(\ \textcolor{keyword}{volatile}\ \mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*\ lk\ )}
\DoxyCodeLine{00051\ \{}
\DoxyCodeLine{00052\ \ \ \ \ \_\_asm\_\_\ \textcolor{keyword}{volatile}\ (\textcolor{stringliteral}{"{}.byte\ "{}}\ \mbox{\hyperlink{gcc__itsx_8h_a80156038db02057a85e581c6229d2823}{\_\_TBB\_STRINGIZE}}(\mbox{\hyperlink{gcc__itsx_8h_ad702d5c20e8634c60d255f6eaa16be0d}{\_\_TBB\_OP\_XRELEASE}})\textcolor{stringliteral}{"{};\ movb\ \$0,\ \%0"{}}}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \textcolor{stringliteral}{"{}=m"{}}(*lk)\ :\ \textcolor{stringliteral}{"{}m"{}}(*lk)\ :\ \textcolor{stringliteral}{"{}memory"{}}\ );}
\DoxyCodeLine{00054\ \}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TSX\_INTRINSICS\_PRESENT}}
\DoxyCodeLine{00057\ \textcolor{preprocessor}{\#include\ <immintrin.h>}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \textcolor{preprocessor}{\#define\ \_\_TBB\_machine\_is\_in\_transaction\ \_xtest}}
\DoxyCodeLine{00060\ \textcolor{preprocessor}{\#define\ \_\_TBB\_machine\_begin\_transaction\ \_xbegin}}
\DoxyCodeLine{00061\ \textcolor{preprocessor}{\#define\ \_\_TBB\_machine\_end\_transaction\ \ \ \_xend}}
\DoxyCodeLine{00062\ \textcolor{preprocessor}{\#define\ \_\_TBB\_machine\_transaction\_conflict\_abort()\ \_xabort(0xff)}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00069\ \textcolor{keyword}{inline}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{gcc__itsx_8h_a8154cad4b7686564e435a8b926cb8e12}{\_\_TBB\_machine\_is\_in\_transaction}}()}
\DoxyCodeLine{00070\ \{}
\DoxyCodeLine{00071\ \ \ \ \ \mbox{\hyperlink{eabase_8h_aef44329758059c91c76d334e8fc09700}{int8\_t}}\ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}\ =\ 0;}
\DoxyCodeLine{00072\ \textcolor{preprocessor}{\#if\ \_\_TBB\_x86\_32}}
\DoxyCodeLine{00073\ \ \ \ \ \_\_asm\_\_\ \textcolor{keyword}{volatile}\ (\textcolor{stringliteral}{"{}.byte\ 0x0F;\ .byte\ 0x01;\ .byte\ 0xD6;\(\backslash\)n"{}}}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}setz\ \%0"{}}\ :\ \textcolor{stringliteral}{"{}=q"{}}(\mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}})\ :\ :\ \textcolor{stringliteral}{"{}memory"{}}\ );}
\DoxyCodeLine{00075\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00076\ \ \ \ \ \_\_asm\_\_\ \textcolor{keyword}{volatile}\ (\textcolor{stringliteral}{"{}.byte\ 0x0F;\ .byte\ 0x01;\ .byte\ 0xD6;\(\backslash\)n"{}}}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}setz\ \%0"{}}\ :\ \textcolor{stringliteral}{"{}=r"{}}(\mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}})\ :\ :\ \textcolor{stringliteral}{"{}memory"{}}\ );}
\DoxyCodeLine{00078\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}==0;}
\DoxyCodeLine{00080\ \}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00087\ \textcolor{keyword}{inline}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{eabase_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{gcc__itsx_8h_a8868fac2cb72926318653baf95cc6052}{\_\_TBB\_machine\_begin\_transaction}}()}
\DoxyCodeLine{00088\ \{}
\DoxyCodeLine{00089\ \ \ \ \ \mbox{\hyperlink{eabase_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}\ =\ \mbox{\hyperlink{eabase_8h_a435d1572bf3f880d55459d9805097f62}{\string~uint32\_t}}(0);\ \ \ \textcolor{comment}{//\ success\ value}}
\DoxyCodeLine{00090\ \ \ \ \ \_\_asm\_\_\ \textcolor{keyword}{volatile}\ (\textcolor{stringliteral}{"{}1:\ .byte\ \ 0xC7;\ .byte\ 0xF8;\(\backslash\)n"{}}\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ XBEGIN\ <abort-\/offset>}}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ .long\ \ 2f-\/1b-\/6\(\backslash\)n"{}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ 2f-\/1b\ ==\ difference\ in\ addresses\ of\ start}}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ of\ XBEGIN\ and\ the\ MOVL}}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ 2f\ -\/\ 1b\ -\/\ 6\ ==\ that\ difference\ minus\ the\ size\ of\ the}}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ XBEGIN\ instruction.\ \ This\ is\ the\ abort\ offset\ to}}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ 2:\ below.}}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ \ \ jmp\ \ \ 3f\(\backslash\)n"{}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ success\ (leave\ -\/1\ in\ res)}}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}2:\ \ movl\ \ \%\%eax,\%0\(\backslash\)n"{}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ store\ failure\ code\ in\ res}}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}3:"{}}}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\textcolor{stringliteral}{"{}=r"{}}(\mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}):\textcolor{stringliteral}{"{}0"{}}(\mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}):\textcolor{stringliteral}{"{}memory"{}},\textcolor{stringliteral}{"{}\%eax"{}});}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}};}
\DoxyCodeLine{00101\ \}}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00106\ \textcolor{keyword}{inline}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{gcc__itsx_8h_ae0c2e8d2667ee9e9bdbab33953ba99c6}{\_\_TBB\_machine\_end\_transaction}}()}
\DoxyCodeLine{00107\ \{}
\DoxyCodeLine{00108\ \ \ \ \ \_\_asm\_\_\ \textcolor{keyword}{volatile}\ (\textcolor{stringliteral}{"{}.byte\ 0x0F;\ .byte\ 0x01;\ .byte\ 0xD5"{}}\ :::\textcolor{stringliteral}{"{}memory"{}});\ \ \ \textcolor{comment}{//\ XEND}}
\DoxyCodeLine{00109\ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \textcolor{comment}{/*}}
\DoxyCodeLine{00112\ \textcolor{comment}{\ *\ aborts\ with\ code\ 0xFF\ (lock\ already\ held)}}
\DoxyCodeLine{00113\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00114\ \textcolor{keyword}{inline}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{gcc__itsx_8h_a0eea661bf4a6904d21f3b192a2af2c1f}{\_\_TBB\_machine\_transaction\_conflict\_abort}}()}
\DoxyCodeLine{00115\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \_\_asm\_\_\ \textcolor{keyword}{volatile}\ (\textcolor{stringliteral}{"{}.byte\ 0xC6;\ .byte\ 0xF8;\ .byte\ 0xFF"{}}\ :::\textcolor{stringliteral}{"{}memory"{}});}
\DoxyCodeLine{00117\ \}}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TSX\_INTRINSICS\_PRESENT\ */}\textcolor{preprocessor}{}}

\end{DoxyCode}
