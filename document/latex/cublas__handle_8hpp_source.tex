\doxysection{cublas\+\_\+handle.\+hpp}
\hypertarget{cublas__handle_8hpp_source}{}\label{cublas__handle_8hpp_source}\index{external/taskflow/sandbox/cublas\_core/cublas\_handle.hpp@{external/taskflow/sandbox/cublas\_core/cublas\_handle.hpp}}
\mbox{\hyperlink{cublas__handle_8hpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cublas__error_8hpp}{cublas\_error.hpp}}"{}}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetf}{tf}}\ \{}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00012\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structtf_1_1cublas_handle_creator}{cublasHandleCreator}}\ \{}
\DoxyCodeLine{00013\ \ \ cublasHandle\_t\ \mbox{\hyperlink{structtf_1_1cublas_handle_creator_a02654e57cb0f43d4617d491f5190461a}{operator\ ()\ }}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00014\ \ \ \ \ cublasHandle\_t\ handle;}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \ \ \ \ \mbox{\hyperlink{cublas__error_8hpp_a33522c7eaf0222e2fe42854c0b57a94b}{TF\_CHECK\_CUBLAS}}(}
\DoxyCodeLine{00017\ \ \ \ \ \ \ cublasCreate(\&handle),\ \textcolor{stringliteral}{"{}failed\ to\ create\ a\ cublas\ handle"{}}}
\DoxyCodeLine{00018\ \ \ \ \ );}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \ \ \ \ \mbox{\hyperlink{cublas__error_8hpp_a33522c7eaf0222e2fe42854c0b57a94b}{TF\_CHECK\_CUBLAS}}(}
\DoxyCodeLine{00021\ \ \ \ \ \ \ cublasSetPointerMode(handle,\ CUBLAS\_POINTER\_MODE\_DEVICE),}
\DoxyCodeLine{00022\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}failed\ to\ set\ cublas\ pointer\ mode\ on\ device"{}}}
\DoxyCodeLine{00023\ \ \ \ \ );}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{comment}{//std::cout\ <<\ "{}create\ cublas\ handle\ "{}\ <<\ handle\ <<\ '\(\backslash\)n';}}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keywordflow}{return}\ handle;}
\DoxyCodeLine{00027\ \ \ \}}
\DoxyCodeLine{00028\ \};}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00031\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structtf_1_1cublas_handle_deleter}{cublasHandleDeleter}}\ \{}
\DoxyCodeLine{00032\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structtf_1_1cublas_handle_deleter_a6baa71b4c2f9edd2da939f9a33bf0a99}{operator\ ()\ }}(cublasHandle\_t\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{comment}{//std::cout\ <<\ "{}destroy\ cublas\ handle\ "{}\ <<\ ptr\ <<\ '\(\backslash\)n';}}
\DoxyCodeLine{00034\ \ \ \ \ cublasDestroy(\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}});}
\DoxyCodeLine{00035\ \ \ \}}
\DoxyCodeLine{00036\ \};}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00041\ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacetf_ad0e075704cf55fa29b4c595543816d9c}{cublasPerThreadHandlePool}}\ =\ cudaPerThreadDeviceObjectPool<}
\DoxyCodeLine{00042\ \ \ cublasHandle\_t,\ \mbox{\hyperlink{structtf_1_1cublas_handle_creator}{cublasHandleCreator}},\ \mbox{\hyperlink{structtf_1_1cublas_handle_deleter}{cublasHandleDeleter}}}
\DoxyCodeLine{00043\ >;}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00048\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{namespacetf_ad0e075704cf55fa29b4c595543816d9c}{cublasPerThreadHandlePool}}\&\ \mbox{\hyperlink{namespacetf_a09c225e54ac891210cc13666fce26528}{cublas\_per\_thread\_handle\_pool}}()\ \{}
\DoxyCodeLine{00049\ \ \ \textcolor{keyword}{thread\_local}\ \mbox{\hyperlink{namespacetf_ad0e075704cf55fa29b4c595543816d9c}{cublasPerThreadHandlePool}}\ pool;}
\DoxyCodeLine{00050\ \ \ \textcolor{keywordflow}{return}\ pool;}
\DoxyCodeLine{00051\ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00054\ \textcolor{comment}{//\ cublasScopedPerThreadHandle\ definition}}
\DoxyCodeLine{00055\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00079\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_ab38a12915fc954f3c3527fcbc74bc6b7}{cublasScopedPerThreadHandle}}\ \{}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00088\ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_ab38a12915fc954f3c3527fcbc74bc6b7}{cublasScopedPerThreadHandle}}(\textcolor{keywordtype}{int}\ \mbox{\hyperlink{ittnotify__static_8h_a5f135fd1e66a03efd5275434478e0d97}{d}})\ :}
\DoxyCodeLine{00089\ \ \ \ \ \mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_aa1a0eb136f4e140e0f565650cf45d79c}{\_ptr}}\ \{\mbox{\hyperlink{namespacetf_a09c225e54ac891210cc13666fce26528}{cublas\_per\_thread\_handle\_pool}}().acquire(\mbox{\hyperlink{ittnotify__static_8h_a5f135fd1e66a03efd5275434478e0d97}{d}})\}\ \{}
\DoxyCodeLine{00090\ \ \ \}}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00097\ \ \ \mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_a3389f3b54d3ff91ae65cf843d1335ab5}{cublasScopedPerThreadHandle}}()\ :}
\DoxyCodeLine{00098\ \ \ \ \ \mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_aa1a0eb136f4e140e0f565650cf45d79c}{\_ptr}}\ \{\mbox{\hyperlink{namespacetf_a09c225e54ac891210cc13666fce26528}{cublas\_per\_thread\_handle\_pool}}().acquire(\mbox{\hyperlink{namespacetf_a235f5a9ce203d538eec1f4114221d473}{cuda\_get\_device}}())\}\ \{}
\DoxyCodeLine{00099\ \ \ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00106\ \ \ \mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_a82fa514493e7ac4299a00242ca8cc37c}{\string~cublasScopedPerThreadHandle}}()\ \{}
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_aa1a0eb136f4e140e0f565650cf45d79c}{\_ptr}})\ \{}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \mbox{\hyperlink{namespacetf_a09c225e54ac891210cc13666fce26528}{cublas\_per\_thread\_handle\_pool}}().release(std::move(\mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_aa1a0eb136f4e140e0f565650cf45d79c}{\_ptr}}));}
\DoxyCodeLine{00109\ \ \ \ \ \}}
\DoxyCodeLine{00110\ \ \ \}}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00115\ \ \ \textcolor{keyword}{operator}\ cublasHandle\_t\ ()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_aa1a0eb136f4e140e0f565650cf45d79c}{\_ptr}}-\/>value;}
\DoxyCodeLine{00117\ \ \ \}}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00122\ \ \ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_a006ac650347d4ac7091c0b4a2c4aaa54}{use\_count}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_aa1a0eb136f4e140e0f565650cf45d79c}{\_ptr}}.use\_count();}
\DoxyCodeLine{00124\ \ \ \}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00129\ \ \ \mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_aa4e48a9c2bf023c80bd1d23252e7194f}{cublasScopedPerThreadHandle}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_ab38a12915fc954f3c3527fcbc74bc6b7}{cublasScopedPerThreadHandle}}\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00134\ \ \ \mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_a6213c011866158b7f12b900e1b1604f1}{cublasScopedPerThreadHandle}}(\mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_ab38a12915fc954f3c3527fcbc74bc6b7}{cublasScopedPerThreadHandle}}\&\&)\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00139\ \ \ \mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_ab38a12915fc954f3c3527fcbc74bc6b7}{cublasScopedPerThreadHandle}}\&\ \mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_aec17ee5f5cd0463f4091de5f72084c78}{operator\ =\ }}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_ab38a12915fc954f3c3527fcbc74bc6b7}{cublasScopedPerThreadHandle}}\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00144\ \ \ \mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_ab38a12915fc954f3c3527fcbc74bc6b7}{cublasScopedPerThreadHandle}}\&\ \mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_aec17ee5f5cd0463f4091de5f72084c78}{operator\ =\ }}(\mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_ab38a12915fc954f3c3527fcbc74bc6b7}{cublasScopedPerThreadHandle}}\&\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ std::shared\_ptr<cublasPerThreadHandlePool::Object>\ \mbox{\hyperlink{classtf_1_1cublas_scoped_per_thread_handle_aa1a0eb136f4e140e0f565650cf45d79c}{\_ptr}};}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \};}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \}\ \ \textcolor{comment}{//\ end\ of\ namespace\ tf\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ }

\end{DoxyCode}
