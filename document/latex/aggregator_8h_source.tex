\doxysection{aggregator.\+h}
\hypertarget{aggregator_8h_source}{}\label{aggregator_8h_source}\index{external/taskflow/3rd-\/party/tbb/include/tbb/aggregator.h@{external/taskflow/3rd-\/party/tbb/include/tbb/aggregator.h}}
\mbox{\hyperlink{aggregator_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ \ \ \ Copyright\ (c)\ 2005-\/2020\ Intel\ Corporation}}
\DoxyCodeLine{00003\ \textcolor{comment}{}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ \ \ \ Licensed\ under\ the\ Apache\ License,\ Version\ 2.0\ (the\ "{}License"{});}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ \ \ \ you\ may\ not\ use\ this\ file\ except\ in\ compliance\ with\ the\ License.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ \ \ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00007\ \textcolor{comment}{}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ \ \ \ \ \ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00009\ \textcolor{comment}{}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ \ \ \ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,\ software}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ \ \ \ distributed\ under\ the\ License\ is\ distributed\ on\ an\ "{}AS\ IS"{}\ BASIS,}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ \ \ \ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY\ KIND,\ either\ express\ or\ implied.}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ \ \ \ See\ the\ License\ for\ the\ specific\ language\ governing\ permissions\ and}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ \ \ \ limitations\ under\ the\ License.}}
\DoxyCodeLine{00015\ \textcolor{comment}{*/}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#ifndef\ \_\_TBB\_\_aggregator\_H}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#define\ \_\_TBB\_\_aggregator\_H}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#define\ \_\_TBB\_aggregator\_H\_include\_area}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{__warning__suppress__enable__notice_8h}{internal/\_warning\_suppress\_enable\_notice.h}}"{}}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#if\ !TBB\_PREVIEW\_AGGREGATOR}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#error\ Set\ TBB\_PREVIEW\_AGGREGATOR\ before\ including\ aggregator.h}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{external_2taskflow_23rd-party_2tbb_2include_2tbb_2atomic_8h}{atomic.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tbb__profiling_8h}{tbb\_profiling.h}}"{}}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetbb}{tbb}}\ \{}
\DoxyCodeLine{00031\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetbb_1_1interface6}{interface6}}\ \{}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{keyword}{using\ namespace\ }\mbox{\hyperlink{namespacetbb_1_1internal}{tbb::internal}};}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1aggregator__operation_a738a66479f1096b66af9c475c7b1a2eb}{aggregator\_operation}}\ \{}
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ handler\_type>\ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a7f6e7d315f893b1b66d06ffdad12038e}{aggregator\_ext}};}
\DoxyCodeLine{00037\ \ \ \ \ uintptr\_t\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a39b0e293bdf0bb07fc6435f8407a698f}{status}};}
\DoxyCodeLine{00038\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a738a66479f1096b66af9c475c7b1a2eb}{aggregator\_operation}}*\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a59dc9ab03103816a0fba592f32317380}{my\_next}};}
\DoxyCodeLine{00039\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keyword}{enum}\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a855dc55cb1823ed4845f4ed6b0a87700}{aggregator\_operation\_status}}\ \{\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a855dc55cb1823ed4845f4ed6b0a87700ae4b950724537bc1d5ad648ccca782904}{agg\_waiting}}=0,\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a855dc55cb1823ed4845f4ed6b0a87700ab163b489650e5d47d4c90a719c1aca20}{agg\_finished}}\ \};}
\DoxyCodeLine{00041\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a738a66479f1096b66af9c475c7b1a2eb}{aggregator\_operation}}()\ :\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a39b0e293bdf0bb07fc6435f8407a698f}{status}}(\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a855dc55cb1823ed4845f4ed6b0a87700ae4b950724537bc1d5ad648ccca782904}{agg\_waiting}}),\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a59dc9ab03103816a0fba592f32317380}{my\_next}}(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\}}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_adc0e032aa604f1da85ffc7ec269b157f}{start}}()\ \{\ \mbox{\hyperlink{namespacetbb_1_1internal_ae998b9627068b137cb2047f9979fc9c1}{call\_itt\_notify}}(\mbox{\hyperlink{namespacetbb_1_1internal_a0079fa537b191a596ed128fc55bee8d4ab654e493e3ec49658787a07dd3995be8}{acquired}},\ \&\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a39b0e293bdf0bb07fc6435f8407a698f}{status}});\ \}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_ac7edadfe74f475783f3b429904e7010a}{finish}}()\ \{\ \mbox{\hyperlink{namespacetbb_1_1internal_ac4715a28e1dc69356c2dae5c2e84b5f4}{itt\_store\_word\_with\_release}}(\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a39b0e293bdf0bb07fc6435f8407a698f}{status}},\ uintptr\_t(\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a855dc55cb1823ed4845f4ed6b0a87700ab163b489650e5d47d4c90a719c1aca20}{agg\_finished}}));\ \}}
\DoxyCodeLine{00047\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a738a66479f1096b66af9c475c7b1a2eb}{aggregator\_operation}}*\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a2fc2592cd13dbe9c56fd2d92ccaff264}{next}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacetbb_1_1internal_ad2789f49c08d4136961e0649f5fd09e8}{itt\_hide\_load\_word}}(\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a59dc9ab03103816a0fba592f32317380}{my\_next}});\}}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a03cf9fad0ca21da61b83325a50e17d0b}{set\_next}}(\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a738a66479f1096b66af9c475c7b1a2eb}{aggregator\_operation}}*\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}})\ \{\ \mbox{\hyperlink{namespacetbb_1_1internal_a8fc0aa75d9aa4fe4948e1577ca0ab1ec}{itt\_hide\_store\_word}}(\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a59dc9ab03103816a0fba592f32317380}{my\_next}},\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}});\ \}}
\DoxyCodeLine{00049\ \};}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceinternal}{internal}}\ \{}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1interface6_1_1internal_1_1basic__operation__base_a98851e8df6936de4233739ea76ab10e9}{basic\_operation\_base}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a738a66479f1096b66af9c475c7b1a2eb}{aggregator\_operation}}\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1interface6_1_1internal_1_1basic__operation__base_afe66260da7455bea5b701a3d8a537ba7}{basic\_handler}};}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1interface6_1_1internal_1_1basic__operation__base_a736d459cc83dc435bfb7e05e60ff04bc}{apply\_body}}()\ =\ 0;}
\DoxyCodeLine{00056\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00057\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1interface6_1_1internal_1_1basic__operation__base_a98851e8df6936de4233739ea76ab10e9}{basic\_operation\_base}}()\ :\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a738a66479f1096b66af9c475c7b1a2eb}{aggregator\_operation}}()\ \{\}}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classtbb_1_1interface6_1_1internal_1_1basic__operation__base_ae59910d6e6445f4494fa73641b6fb70b}{\string~basic\_operation\_base}}()\ \{\}}
\DoxyCodeLine{00059\ \};}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Body>}
\DoxyCodeLine{00062\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1interface6_1_1internal_1_1basic__operation_adf48b2339f7de2f002c24c8951a03057}{basic\_operation}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classtbb_1_1interface6_1_1internal_1_1basic__operation__base_a98851e8df6936de4233739ea76ab10e9}{basic\_operation\_base}},\ no\_assign\ \{}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_body}{Body}}\&\ \mbox{\hyperlink{classtbb_1_1interface6_1_1internal_1_1basic__operation_a8566763261dfc938511eddd69ad02181}{my\_body}};}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1interface6_1_1internal_1_1basic__operation_ad8528580eb4c596756c0a9b093f6a71d}{apply\_body}}()\ \_\_TBB\_override\ \{\ \mbox{\hyperlink{classtbb_1_1interface6_1_1internal_1_1basic__operation_a8566763261dfc938511eddd69ad02181}{my\_body}}();\ \}}
\DoxyCodeLine{00065\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00066\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1interface6_1_1internal_1_1basic__operation_adf48b2339f7de2f002c24c8951a03057}{basic\_operation}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_body}{Body}}\&\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})\ :\ \mbox{\hyperlink{classtbb_1_1interface6_1_1internal_1_1basic__operation__base_a98851e8df6936de4233739ea76ab10e9}{basic\_operation\_base}}(),\ \mbox{\hyperlink{classtbb_1_1interface6_1_1internal_1_1basic__operation_a8566763261dfc938511eddd69ad02181}{my\_body}}(\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})\ \{\}}
\DoxyCodeLine{00067\ \};}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1interface6_1_1internal_1_1basic__handler_abca6c2495803eca2fa5a65c047e8ba00}{basic\_handler}}\ \{}
\DoxyCodeLine{00070\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00071\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1interface6_1_1internal_1_1basic__handler_abca6c2495803eca2fa5a65c047e8ba00}{basic\_handler}}()\ \{\}}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1interface6_1_1internal_1_1basic__handler_ac65de02ea66d515b25dbde95fde8848f}{operator()}}(\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation}{aggregator\_operation}}*\ op\_list)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (op\_list)\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ITT\ note:\ \&(op\_list-\/>status)\ tag\ is\ used\ to\ cover\ accesses\ to\ the\ operation\ data.}}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ executing\ thread\ "{}acquires"{}\ the\ tag\ (see\ start())\ and\ then\ performs}}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ associated\ operation\ w/o\ triggering\ a\ race\ condition\ diagnostics.}}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ A\ thread\ that\ created\ the\ operation\ is\ waiting\ for\ its\ status\ (see\ execute\_impl()),}}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ so\ when\ this\ thread\ is\ done\ with\ the\ operation,\ it\ will\ "{}release"{}\ the\ tag}}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ and\ update\ the\ status\ (see\ finish())\ to\ give\ control\ back\ to\ the\ waiting\ thread.}}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1interface6_1_1internal_1_1basic__operation__base}{basic\_operation\_base}}\&\ request\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classtbb_1_1interface6_1_1internal_1_1basic__operation__base}{basic\_operation\_base}}\&\textcolor{keyword}{>}(*op\_list);}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ IMPORTANT:\ need\ to\ advance\ op\_list\ to\ op\_list-\/>next()\ before\ calling\ request.finish()}}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ op\_list\ =\ op\_list-\/>\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a2fc2592cd13dbe9c56fd2d92ccaff264}{next}}();}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ request.\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_adc0e032aa604f1da85ffc7ec269b157f}{start}}();}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \ \ request.\mbox{\hyperlink{classtbb_1_1interface6_1_1internal_1_1basic__operation__base_a736d459cc83dc435bfb7e05e60ff04bc}{apply\_body}}();}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \ \ request.\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_ac7edadfe74f475783f3b429904e7010a}{finish}}();}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00087\ \ \ \ \ \}}
\DoxyCodeLine{00088\ \};}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \}\ \textcolor{comment}{//\ namespace\ internal}}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00095\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ handler\_type>}
\DoxyCodeLine{00096\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1aggregator__ext_a8ae120a21264cc1ea0a9cfafaa0634e4}{aggregator\_ext}}\ :\ tbb::internal::no\_copy\ \{}
\DoxyCodeLine{00097\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00098\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_a8ae120a21264cc1ea0a9cfafaa0634e4}{aggregator\_ext}}(\textcolor{keyword}{const}\ handler\_type\&\ \mbox{\hyperlink{ittnotify__static_8h_ae68700d2ebda197674e2fdd0f916f00c}{h}})\ :\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_afb1870b65bf861b42f8f201cd4a23b00}{handler\_busy}}(0),\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_a4f39a9bdc42692911a8798d9dd22f80c}{handle\_operations}}(\mbox{\hyperlink{ittnotify__static_8h_ae68700d2ebda197674e2fdd0f916f00c}{h}})\ \{\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_a5fdd40835cca9f24b53a6f691005af78}{mailbox}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};\ \}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_ae55b16ec6af204aa00d6a716fccec9f7}{process}}(\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation}{aggregator\_operation}}\ *op)\ \{\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_ad376e5c31d10e885f33964592aa629d4}{execute\_impl}}(*op);\ \}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_ad376e5c31d10e885f33964592aa629d4}{execute\_impl}}(\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation}{aggregator\_operation}}\&\ op)\ \{}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation}{aggregator\_operation}}*\ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}};}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ITT\ note:\ \&(op.status)\ tag\ is\ used\ to\ cover\ accesses\ to\ this\ operation.\ This}}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ thread\ has\ created\ the\ operation,\ and\ now\ releases\ it\ so\ that\ the\ handler}}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ thread\ may\ handle\ the\ associated\ operation\ w/o\ triggering\ a\ race\ condition;}}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ thus\ this\ tag\ will\ be\ acquired\ just\ before\ the\ operation\ is\ handled\ in\ the}}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ handle\_operations\ functor.}}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_ae998b9627068b137cb2047f9979fc9c1}{call\_itt\_notify}}(\mbox{\hyperlink{namespacetbb_1_1internal_a0079fa537b191a596ed128fc55bee8d4a9fa11ee77857974db0da962d06ff582f}{releasing}},\ \&(op.\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a39b0e293bdf0bb07fc6435f8407a698f}{status}}));}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ insert\ the\ operation\ into\ the\ list}}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ITT\ may\ flag\ the\ following\ line\ as\ a\ race;\ it\ is\ a\ false\ positive:}}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ is\ an\ atomic\ read;\ we\ don't\ provide\ itt\_hide\_load\_word\ for\ atomics}}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ op.\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a59dc9ab03103816a0fba592f32317380}{my\_next}}\ =\ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}\ =\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_a5fdd40835cca9f24b53a6f691005af78}{mailbox}};\ \textcolor{comment}{//\ NOT\ A\ RACE}}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_a5fdd40835cca9f24b53a6f691005af78}{mailbox}}.compare\_and\_swap(\&op,\ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}})\ !=\ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}});}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}})\ \{\ \textcolor{comment}{//\ first\ in\ the\ list;\ handle\ the\ operations}}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ITT\ note:\ \&mailbox\ tag\ covers\ access\ to\ the\ handler\_busy\ flag,\ which\ this}}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ waiting\ handler\ thread\ will\ try\ to\ set\ before\ entering\ handle\_operations.}}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_ae998b9627068b137cb2047f9979fc9c1}{call\_itt\_notify}}(\mbox{\hyperlink{namespacetbb_1_1internal_a0079fa537b191a596ed128fc55bee8d4ab654e493e3ec49658787a07dd3995be8}{acquired}},\ \&\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_a5fdd40835cca9f24b53a6f691005af78}{mailbox}});}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_a779e53657aad2d95167fd4f12f44a96e}{start\_handle\_operations}}();}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(op.\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a39b0e293bdf0bb07fc6435f8407a698f}{status}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ not\ first;\ wait\ for\ op\ to\ be\ ready}}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_ae998b9627068b137cb2047f9979fc9c1}{call\_itt\_notify}}(\mbox{\hyperlink{namespacetbb_1_1internal_a0079fa537b191a596ed128fc55bee8d4a6cb3fdd7de05de6297f50e873501734f}{prepare}},\ \&(op.\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a39b0e293bdf0bb07fc6435f8407a698f}{status}}));}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ spin\_wait\_while\_eq(op.\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a39b0e293bdf0bb07fc6435f8407a698f}{status}},\ uintptr\_t(\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a855dc55cb1823ed4845f4ed6b0a87700ae4b950724537bc1d5ad648ccca782904}{aggregator\_operation::agg\_waiting}}));}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a911cbec92461f245730d2f47516525a3}{itt\_load\_word\_with\_acquire}}(op.\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation_a39b0e293bdf0bb07fc6435f8407a698f}{status}});}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00134\ \ \ \ \ \}}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00139\ \ \ \ \ \mbox{\hyperlink{sugar_8h_a48f1c51623545bd4f58fbab2fa6091d0}{atomic<aggregator\_operation\ *>}}\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_a5fdd40835cca9f24b53a6f691005af78}{mailbox}};}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \ \ uintptr\_t\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_afb1870b65bf861b42f8f201cd4a23b00}{handler\_busy}};}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \ \ handler\_type\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_a4f39a9bdc42692911a8798d9dd22f80c}{handle\_operations}};}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_a779e53657aad2d95167fd4f12f44a96e}{start\_handle\_operations}}()\ \{}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation}{aggregator\_operation}}\ *pending\_operations;}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ITT\ note:\ \&handler\_busy\ tag\ covers\ access\ to\ mailbox\ as\ it\ is\ passed}}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ between\ active\ and\ waiting\ handlers.\ \ Below,\ the\ waiting\ handler\ waits\ until}}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ active\ handler\ releases,\ and\ the\ waiting\ handler\ acquires\ \&handler\_busy\ as}}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ it\ becomes\ the\ active\_handler.\ The\ release\ point\ is\ at\ the\ end\ of\ this}}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ function,\ when\ all\ operations\ in\ mailbox\ have\ been\ handled\ by\ the}}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ owner\ of\ this\ aggregator.}}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_ae998b9627068b137cb2047f9979fc9c1}{call\_itt\_notify}}(\mbox{\hyperlink{namespacetbb_1_1internal_a0079fa537b191a596ed128fc55bee8d4a6cb3fdd7de05de6297f50e873501734f}{prepare}},\ \&\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_afb1870b65bf861b42f8f201cd4a23b00}{handler\_busy}});}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ get\ handler\_busy:\ only\ one\ thread\ can\ possibly\ spin\ here\ at\ a\ time}}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ spin\_wait\_until\_eq(\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_afb1870b65bf861b42f8f201cd4a23b00}{handler\_busy}},\ uintptr\_t(0));}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_ae998b9627068b137cb2047f9979fc9c1}{call\_itt\_notify}}(\mbox{\hyperlink{namespacetbb_1_1internal_a0079fa537b191a596ed128fc55bee8d4ab654e493e3ec49658787a07dd3995be8}{acquired}},\ \&\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_afb1870b65bf861b42f8f201cd4a23b00}{handler\_busy}});}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ acquire\ fence\ not\ necessary\ here\ due\ to\ causality\ rule\ and\ surrounding\ atomics}}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \_\_TBB\_store\_with\_release(\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_afb1870b65bf861b42f8f201cd4a23b00}{handler\_busy}},\ uintptr\_t(1));}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ITT\ note:\ \&mailbox\ tag\ covers\ access\ to\ the\ handler\_busy\ flag\ itself.}}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Capturing\ the\ state\ of\ the\ mailbox\ signifies\ that\ handler\_busy\ has\ been}}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ set\ and\ a\ new\ active\ handler\ will\ now\ process\ that\ list's\ operations.}}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_ae998b9627068b137cb2047f9979fc9c1}{call\_itt\_notify}}(\mbox{\hyperlink{namespacetbb_1_1internal_a0079fa537b191a596ed128fc55bee8d4a9fa11ee77857974db0da962d06ff582f}{releasing}},\ \&\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_a5fdd40835cca9f24b53a6f691005af78}{mailbox}});}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ grab\ pending\_operations}}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ pending\_operations\ =\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_a5fdd40835cca9f24b53a6f691005af78}{mailbox}}.fetch\_and\_store(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ handle\ all\ the\ operations}}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_a4f39a9bdc42692911a8798d9dd22f80c}{handle\_operations}}(pending\_operations);}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ release\ the\ handler}}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_ac4715a28e1dc69356c2dae5c2e84b5f4}{itt\_store\_word\_with\_release}}(\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext_afb1870b65bf861b42f8f201cd4a23b00}{handler\_busy}},\ uintptr\_t(0));}
\DoxyCodeLine{00176\ \ \ \ \ \}}
\DoxyCodeLine{00177\ \};}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00180\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1aggregator_ac36b563a9adc1847b8110fc4603b537c}{aggregator}}\ :\ \textcolor{keyword}{private}\ \mbox{\hyperlink{classtbb_1_1aggregator__ext_a8ae120a21264cc1ea0a9cfafaa0634e4}{aggregator\_ext}}<internal::basic\_handler>\ \{}
\DoxyCodeLine{00181\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00182\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator_ac36b563a9adc1847b8110fc4603b537c}{aggregator}}()\ :\ \mbox{\hyperlink{classtbb_1_1aggregator__ext_a8ae120a21264cc1ea0a9cfafaa0634e4}{aggregator\_ext}}<\mbox{\hyperlink{namespaceinternal}{internal}}::basic\_handler>(\mbox{\hyperlink{namespaceinternal}{internal}}::basic\_handler())\ \{\}}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Body>}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator_aa7cc924b6f0d17578d61fd9002f59f84}{execute}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_body}{Body}}\&\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})\ \{}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1interface6_1_1internal_1_1basic__operation}{internal::basic\_operation<Body>}}\ op(\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}});}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ this-\/>\mbox{\hyperlink{classtbb_1_1aggregator__ext_ad376e5c31d10e885f33964592aa629d4}{execute\_impl}}(op);}
\DoxyCodeLine{00190\ \ \ \ \ \}}
\DoxyCodeLine{00191\ \};}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \}\ \textcolor{comment}{//\ namespace\ interface6}}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \textcolor{keyword}{using\ }\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator}{interface6::aggregator}};}
\DoxyCodeLine{00196\ \textcolor{keyword}{using\ }\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__ext}{interface6::aggregator\_ext}};}
\DoxyCodeLine{00197\ \textcolor{keyword}{using\ }\mbox{\hyperlink{classtbb_1_1interface6_1_1aggregator__operation}{interface6::aggregator\_operation}};}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \}\ \textcolor{comment}{//\ namespace\ tbb}}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{__warning__suppress__disable__notice_8h}{internal/\_warning\_suppress\_disable\_notice.h}}"{}}}
\DoxyCodeLine{00202\ \textcolor{preprocessor}{\#undef\ \_\_TBB\_aggregator\_H\_include\_area}}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_\_TBB\_\_aggregator\_H}}

\end{DoxyCode}
