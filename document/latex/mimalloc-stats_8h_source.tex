\doxysection{mimalloc-\/stats.h}
\hypertarget{mimalloc-stats_8h_source}{}\label{mimalloc-stats_8h_source}\index{runtime/EASTL/packages/mimalloc/include/mimalloc-\/stats.h@{runtime/EASTL/packages/mimalloc/include/mimalloc-\/stats.h}}
\mbox{\hyperlink{mimalloc-stats_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00002\ \textcolor{comment}{Copyright\ (c)\ 2018-\/2025,\ Microsoft\ Research,\ Daan\ Leijen}}
\DoxyCodeLine{00003\ \textcolor{comment}{This\ is\ free\ software;\ you\ can\ redistribute\ it\ and/or\ modify\ it\ under\ the}}
\DoxyCodeLine{00004\ \textcolor{comment}{terms\ of\ the\ MIT\ license.\ A\ copy\ of\ the\ license\ can\ be\ found\ in\ the\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{"{}LICENSE"{}\ at\ the\ root\ of\ this\ distribution.}}
\DoxyCodeLine{00006\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#ifndef\ MIMALLOC\_STATS\_H}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#define\ MIMALLOC\_STATS\_H}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{mimalloc_8h}{mimalloc.h}}>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <stdint.h>}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#define\ MI\_STAT\_VERSION\ \ \ 1\ \ \ }\textcolor{comment}{//\ increased\ on\ every\ backward\ incompatible\ change}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{comment}{//\ count\ allocation\ over\ time}}
\DoxyCodeLine{00017\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structmi__stat__count__s}{mi\_stat\_count\_s}}\ \{}
\DoxyCodeLine{00018\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{structmi__stat__count__s_adb06f0e52e8868982c44b6634972ef44}{total}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ total\ allocated}}
\DoxyCodeLine{00019\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{structmi__stat__count__s_adc7065b8cd4fca121e267d6879cd8f93}{peak}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ peak\ allocation}}
\DoxyCodeLine{00020\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{structmi__stat__count__s_a93dc22ceeaee6e181107634a573074b0}{current}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ current\ allocation}}
\DoxyCodeLine{00021\ \}\ \mbox{\hyperlink{mimalloc-stats_8h_ae2a74ada89b66a45fafbe34d9c7a55ee}{mi\_stat\_count\_t}};}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{comment}{//\ counters\ only\ increase}}
\DoxyCodeLine{00024\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structmi__stat__counter__s}{mi\_stat\_counter\_s}}\ \{}
\DoxyCodeLine{00025\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{structmi__stat__counter__s_a0a76c25045986e8ace21551b009e2c7c}{total}};\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ total\ count}}
\DoxyCodeLine{00026\ \}\ \mbox{\hyperlink{mimalloc-stats_8h_ab484eb2f2d08706c801718f31e749fcb}{mi\_stat\_counter\_t}};}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#define\ MI\_STAT\_FIELDS()\ \(\backslash\)}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNT(pages)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ count\ of\ mimalloc\ pages\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNT(reserved)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ reserved\ memory\ bytes\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNT(committed)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ committed\ bytes\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNT(reset)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ reset\ bytes\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNT(purged)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ purged\ bytes\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNT(page\_committed)\ \ \ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ committed\ memory\ inside\ pages\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNT(pages\_abandoned)\ \ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ abandonded\ pages\ count\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNT(threads)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ number\ of\ threads\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNT(malloc\_normal)\ \ \ \ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ allocated\ bytes\ <=\ MI\_LARGE\_OBJ\_SIZE\_MAX\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNT(malloc\_huge)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ allocated\ bytes\ in\ huge\ pages\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNT(malloc\_requested)\ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ malloc\ requested\ bytes\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\ \ \(\backslash\)}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNTER(mmap\_calls)\ \(\backslash\)}}
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNTER(commit\_calls)\ \(\backslash\)}}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNTER(reset\_calls)\ \(\backslash\)}}
\DoxyCodeLine{00044\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNTER(purge\_calls)\ \(\backslash\)}}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNTER(arena\_count)\ \ \ \ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ number\ of\ memory\ arena's\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00046\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNTER(malloc\_normal\_count)\ \ \ \ \ \ }\textcolor{comment}{/*\ number\ of\ blocks\ <=\ MI\_LARGE\_OBJ\_SIZE\_MAX\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNTER(malloc\_huge\_count)\ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ number\ of\ huge\ bloks\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00048\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNTER(malloc\_guarded\_count)\ \ \ \ \ }\textcolor{comment}{/*\ number\ of\ allocations\ with\ guard\ pages\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00049\ \textcolor{preprocessor}{\ \ \(\backslash\)}}
\DoxyCodeLine{00050\ \textcolor{preprocessor}{\ \ }\textcolor{comment}{/*\ internal\ statistics\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00051\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNTER(arena\_rollback\_count)\ \(\backslash\)}}
\DoxyCodeLine{00052\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNTER(arena\_purges)\ \(\backslash\)}}
\DoxyCodeLine{00053\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNTER(pages\_extended)\ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ number\ of\ page\ extensions\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00054\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNTER(pages\_retire)\ \ \ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ number\ of\ pages\ that\ are\ retired\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00055\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNTER(page\_searches)\ \ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ searches\ for\ a\ fresh\ page\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00056\ \textcolor{preprocessor}{\ \ }\textcolor{comment}{/*\ only\ on\ v1\ and\ v2\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00057\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNT(segments)\ \(\backslash\)}}
\DoxyCodeLine{00058\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNT(segments\_abandoned)\ \(\backslash\)}}
\DoxyCodeLine{00059\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNT(segments\_cache)\ \(\backslash\)}}
\DoxyCodeLine{00060\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNT(\_segments\_reserved)\ \(\backslash\)}}
\DoxyCodeLine{00061\ \textcolor{preprocessor}{\ \ }\textcolor{comment}{/*\ only\ on\ v3\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{00062\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNTER(pages\_reclaim\_on\_alloc)\ \(\backslash\)}}
\DoxyCodeLine{00063\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNTER(pages\_reclaim\_on\_free)\ \(\backslash\)}}
\DoxyCodeLine{00064\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNTER(pages\_reabandon\_full)\ \(\backslash\)}}
\DoxyCodeLine{00065\ \textcolor{preprocessor}{\ \ MI\_STAT\_COUNTER(pages\_unabandon\_busy\_wait)\ \(\backslash\)}}
\DoxyCodeLine{00066\ \textcolor{preprocessor}{}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \textcolor{comment}{//\ Define\ the\ statistics\ structure}}
\DoxyCodeLine{00069\ \textcolor{preprocessor}{\#define\ MI\_BIN\_HUGE\ \ \ \ \ \ \ \ \ \ \ \ \ (73U)\ \ \ }\textcolor{comment}{//\ see\ types.h}}
\DoxyCodeLine{00070\ \textcolor{preprocessor}{\#define\ MI\_STAT\_COUNT(stat)\ \ \ \ \ mi\_stat\_count\_t\ stat;}}
\DoxyCodeLine{00071\ \textcolor{preprocessor}{\#define\ MI\_STAT\_COUNTER(stat)\ \ \ mi\_stat\_counter\_t\ stat;}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structmi__stats__s}{mi\_stats\_s}}}
\DoxyCodeLine{00074\ \{}
\DoxyCodeLine{00075\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structmi__stats__s_a440036b6a7fc6fd0bdec79c06b02696f}{version}};}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \mbox{\hyperlink{mimalloc-stats_8h_af1bbf7a39d0a130fa6be5a3f534598df}{MI\_STAT\_FIELDS}}()}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \textcolor{comment}{//\ future\ extension}}
\DoxyCodeLine{00080\ \ \ \mbox{\hyperlink{mimalloc-stats_8h_ae2a74ada89b66a45fafbe34d9c7a55ee}{mi\_stat\_count\_t}}\ \ \ \mbox{\hyperlink{structmi__stats__s_a24dec999fe8dd02098ec45ddedbf17e4}{\_stat\_reserved}}[4];}
\DoxyCodeLine{00081\ \ \ \mbox{\hyperlink{mimalloc-stats_8h_ab484eb2f2d08706c801718f31e749fcb}{mi\_stat\_counter\_t}}\ \mbox{\hyperlink{structmi__stats__s_ab956ef9d28b1b2f4b0e8288319b154fa}{\_stat\_counter\_reserved}}[4];}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \textcolor{comment}{//\ size\ segregated\ statistics}}
\DoxyCodeLine{00084\ \ \ \mbox{\hyperlink{mimalloc-stats_8h_ae2a74ada89b66a45fafbe34d9c7a55ee}{mi\_stat\_count\_t}}\ \ \ \mbox{\hyperlink{structmi__stats__s_a676ed8f001a99ba1c8b37991d20eaf4d}{malloc\_bins}}[\mbox{\hyperlink{mimalloc-stats_8h_a8068f41e171eeed896f5e9981118874b}{MI\_BIN\_HUGE}}+1];\ \ \ \textcolor{comment}{//\ allocation\ per\ size\ bin}}
\DoxyCodeLine{00085\ \ \ \mbox{\hyperlink{mimalloc-stats_8h_ae2a74ada89b66a45fafbe34d9c7a55ee}{mi\_stat\_count\_t}}\ \ \ \mbox{\hyperlink{structmi__stats__s_ae3fc3bc753d72e7077ff23434d68a2c4}{page\_bins}}[\mbox{\hyperlink{mimalloc-stats_8h_a8068f41e171eeed896f5e9981118874b}{MI\_BIN\_HUGE}}+1];\ \ \ \ \ \textcolor{comment}{//\ pages\ allocated\ per\ size\ bin}}
\DoxyCodeLine{00086\ \}\ \mbox{\hyperlink{mimalloc-stats_8h_ae899fc419d2db1af97887b3f8c049dc1}{mi\_stats\_t}};}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \textcolor{preprocessor}{\#undef\ MI\_STAT\_COUNT}}
\DoxyCodeLine{00089\ \textcolor{preprocessor}{\#undef\ MI\_STAT\_COUNTER}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \textcolor{comment}{//\ Exported\ definitions}}
\DoxyCodeLine{00092\ \textcolor{preprocessor}{\#ifdef\ \_\_cplusplus}}
\DoxyCodeLine{00093\ \textcolor{keyword}{extern}\ \textcolor{stringliteral}{"{}C"{}}\ \{}
\DoxyCodeLine{00094\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \mbox{\hyperlink{mimalloc_8h_a19c83f9861b67bdf3a3229436d4dc366}{mi\_decl\_export}}\ \textcolor{keywordtype}{void}\ \ \mbox{\hyperlink{mimalloc-stats_8h_aa8183bd267c9c182e0180af6b9d2e482}{mi\_stats\_get}}(\ \textcolor{keywordtype}{size\_t}\ stats\_size,\ \mbox{\hyperlink{mimalloc-stats_8h_ae899fc419d2db1af97887b3f8c049dc1}{mi\_stats\_t}}*\ stats\ )\ \mbox{\hyperlink{mimalloc_8h_a2d1ca113437044da99abaaedd0b36ed8}{mi\_attr\_noexcept}};}
\DoxyCodeLine{00097\ \mbox{\hyperlink{mimalloc_8h_a19c83f9861b67bdf3a3229436d4dc366}{mi\_decl\_export}}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{mimalloc-stats_8h_a54dd65811832d4d987b25469622ff698}{mi\_stats\_get\_json}}(\ \textcolor{keywordtype}{size\_t}\ buf\_size,\ \textcolor{keywordtype}{char}*\ buf\ )\ \mbox{\hyperlink{mimalloc_8h_a2d1ca113437044da99abaaedd0b36ed8}{mi\_attr\_noexcept}};\ \ \ \ \textcolor{comment}{//\ use\ mi\_free\ to\ free\ the\ result\ if\ the\ input\ buf\ ==\ NULL}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \textcolor{preprocessor}{\#ifdef\ \_\_cplusplus}}
\DoxyCodeLine{00100\ \}}
\DoxyCodeLine{00101\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ MIMALLOC\_STATS\_H}}

\end{DoxyCode}
