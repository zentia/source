\chapter{Using the library}
\hypertarget{using}{}\label{using}\index{Using the library@{Using the library}}
\hypertarget{using_autotoc_md21}{}\doxysubsubsection{\texorpdfstring{Build}{Build}}\label{using_autotoc_md21}
The preferred usage is including {\ttfamily \texorpdfstring{$<$}{<}\doxylink{mimalloc_8h}{mimalloc.\+h}\texorpdfstring{$>$}{>}}, linking with the shared-\/ or static library, and using the {\ttfamily mi\+\_\+malloc} API exclusively for allocation. For example, 
\begin{DoxyCode}{0}
\DoxyCodeLine{gcc\ -\/o\ myprogram\ -\/lmimalloc\ myfile.c}

\end{DoxyCode}


mimalloc uses only safe OS calls ({\ttfamily mmap} and {\ttfamily Virtual\+Alloc}) and can co-\/exist with other allocators linked to the same program. If you use {\ttfamily cmake}, you can simply use\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{find\_package(mimalloc\ 2.1\ REQUIRED)}

\end{DoxyCode}
 in your {\ttfamily CMake\+Lists.\+txt} to find a locally installed mimalloc. Then use either\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{target\_link\_libraries(myapp\ PUBLIC\ mimalloc)}

\end{DoxyCode}
 to link with the shared (dynamic) library, or\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{target\_link\_libraries(myapp\ PUBLIC\ mimalloc-\/\textcolor{keyword}{static})}

\end{DoxyCode}
 to link with the static library. See {\ttfamily test\textbackslash{}CMake\+Lists.\+txt} for an example.\hypertarget{using_autotoc_md22}{}\doxysubsubsection{\texorpdfstring{C++}{C++}}\label{using_autotoc_md22}
For best performance in C++ programs, it is also recommended to override the global {\ttfamily new} and {\ttfamily delete} operators. For convenience, mimalloc provides \href{https://github.com/microsoft/mimalloc/blob/master/include/mimalloc-new-delete.h}{\texttt{ {\ttfamily mimalloc-\/new-\/delete.\+h}}} which does this for you -- just include it in a single(!) source file in your project.

In C++, mimalloc also provides the {\ttfamily \doxylink{structmi__stl__allocator}{mi\+\_\+stl\+\_\+allocator}} struct which implements the {\ttfamily std\+::allocator} interface. For example\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{std::vector<some\_struct,\ mi\_stl\_allocator<some\_struct>>\ vec;}
\DoxyCodeLine{vec.push\_back(\mbox{\hyperlink{structsome__struct}{some\_struct}}());}

\end{DoxyCode}
\hypertarget{using_autotoc_md23}{}\doxysubsubsection{\texorpdfstring{Statistics}{Statistics}}\label{using_autotoc_md23}
You can pass environment variables to print verbose messages ({\ttfamily MIMALLOC\+\_\+\+VERBOSE=1}) and statistics ({\ttfamily MIMALLOC\+\_\+\+SHOW\+\_\+\+STATS=1}) (in the debug version)\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{>\ env\ MIMALLOC\_SHOW\_STATS=1\ ./cfrac\ 175451865205073170563711388363}
\DoxyCodeLine{}
\DoxyCodeLine{175451865205073170563711388363\ =\ 374456281610909315237213\ *\ 468551}
\DoxyCodeLine{}
\DoxyCodeLine{heap\ stats:\ \ \ \ \ peak\ \ \ \ \ \ total\ \ \ \ \ \ freed\ \ \ \ \ \ \ unit}
\DoxyCodeLine{normal\ \ \ 2:\ \ \ \ 16.4\ kb\ \ \ \ 17.5\ mb\ \ \ \ 17.5\ mb\ \ \ \ \ \ 16\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}}}
\DoxyCodeLine{normal\ \ \ 3:\ \ \ \ 16.3\ kb\ \ \ \ 15.2\ mb\ \ \ \ 15.2\ mb\ \ \ \ \ \ 24\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}}}
\DoxyCodeLine{normal\ \ \ 4:\ \ \ \ \ \ 64\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \ \ \ 4.6\ kb\ \ \ \ \ 4.6\ kb\ \ \ \ \ \ 32\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}}}
\DoxyCodeLine{normal\ \ \ 5:\ \ \ \ \ \ 80\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \ 118.4\ kb\ \ \ 118.4\ kb\ \ \ \ \ \ 40\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}}}
\DoxyCodeLine{normal\ \ \ 6:\ \ \ \ \ \ 48\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \ \ \ \ 48\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \ \ \ \ 48\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \ \ \ \ 48\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}}}
\DoxyCodeLine{normal\ \ 17:\ \ \ \ \ 960\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \ \ \ 960\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \ \ \ 960\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \ \ \ 320\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}}}
\DoxyCodeLine{}
\DoxyCodeLine{heap\ stats:\ \ \ \ \ peak\ \ \ \ \ \ total\ \ \ \ \ \ freed\ \ \ \ \ \ \ unit}
\DoxyCodeLine{\ \ \ \ normal:\ \ \ \ 33.9\ kb\ \ \ \ 32.8\ mb\ \ \ \ 32.8\ mb\ \ \ \ \ \ \ 1\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}}}
\DoxyCodeLine{\ \ \ \ \ \ huge:\ \ \ \ \ \ \ 0\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \ \ \ \ \ 0\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \ \ \ \ \ 0\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \ \ \ \ \ 1\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}}}
\DoxyCodeLine{\ \ \ \ \ total:\ \ \ \ 33.9\ kb\ \ \ \ 32.8\ mb\ \ \ \ 32.8\ mb\ \ \ \ \ \ \ 1\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}}}
\DoxyCodeLine{\mbox{\hyperlink{mimalloc-override_8h_a99aa8fd9f4831e1b0fa9e1cdcde3e249}{malloc}}\ requested:\ \ \ \ \ \ \ \ \ 32.8\ mb}
\DoxyCodeLine{}
\DoxyCodeLine{\ committed:\ \ \ \ 58.2\ kb\ \ \ \ 58.2\ kb\ \ \ \ 58.2\ kb\ \ \ \ \ \ \ 1\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}}}
\DoxyCodeLine{\ \ reserved:\ \ \ \ \ 2.0\ mb\ \ \ \ \ 2.0\ mb\ \ \ \ \ 2.0\ mb\ \ \ \ \ \ \ 1\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}}}
\DoxyCodeLine{\ \ \ \ \ reset:\ \ \ \ \ \ \ 0\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \ \ \ \ \ 0\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \ \ \ \ \ 0\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \ \ \ \ \ 1\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \ \mbox{\hyperlink{testhelper_8h_a047ea0d874e6802b9b6d08f6b50248e5}{ok}}}
\DoxyCodeLine{\ \ segments:\ \ \ \ \ \ \ 1\ \ \ \ \ \ \ \ \ \ 1\ \ \ \ \ \ \ \ \ \ 1}
\DoxyCodeLine{-\/abandoned:\ \ \ \ \ \ \ 0}
\DoxyCodeLine{\ \ \ \ \ pages:\ \ \ \ \ \ \ 6\ \ \ \ \ \ \ \ \ \ 6\ \ \ \ \ \ \ \ \ \ 6}
\DoxyCodeLine{-\/abandoned:\ \ \ \ \ \ \ 0}
\DoxyCodeLine{\ \ \ \ \ mmaps:\ \ \ \ \ \ \ 3}
\DoxyCodeLine{\ mmap\ fast:\ \ \ \ \ \ \ 0}
\DoxyCodeLine{\ mmap\ slow:\ \ \ \ \ \ \ 1}
\DoxyCodeLine{\ \ \ threads:\ \ \ \ \ \ \ 0}
\DoxyCodeLine{\ \ \ elapsed:\ \ \ \ \ 2.022\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}}
\DoxyCodeLine{\ \ \ process:\ user:\ 1.781\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}},\ system:\ 0.016\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}},\ faults:\ 756,\ reclaims:\ 0,\ rss:\ 2.7\ mb}

\end{DoxyCode}


The above model of using the {\ttfamily mi\+\_\+} prefixed API is not always possible though in existing programs that already use the standard malloc interface, and another option is to override the standard malloc interface completely and redirect all calls to the {\itshape mimalloc} library instead.

See \doxysectlink{overrides}{Overriding Malloc}{0} for more info. 