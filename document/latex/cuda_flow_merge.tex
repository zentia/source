\chapter{Parallel Merge}
\hypertarget{cuda_flow_merge}{}\label{cuda_flow_merge}\index{Parallel Merge@{Parallel Merge}}
cuda\+Flow provides template methods to create parallel merge tasks on a CUDA GPU.\hypertarget{cuda_flow_merge_CUDAParallelMergeIncludeTheHeader}{}\doxysection{\texorpdfstring{Include the Header}{Include the Header}}\label{cuda_flow_merge_CUDAParallelMergeIncludeTheHeader}
You need to include the header file, {\ttfamily taskflow/cuda/algorithm/merge.hpp}, for creating a parallel-\/merge task.\hypertarget{cuda_flow_merge_cudaFlowMergeTwoRangesOfItems}{}\doxysection{\texorpdfstring{Merge two Sorted Ranges of Items}{Merge two Sorted Ranges of Items}}\label{cuda_flow_merge_cudaFlowMergeTwoRangesOfItems}
tf\+::cuda\+Flow\+::merge performs a parallel merge over two ranges of elements into a sorted range of items. The following code merges two sorted arrays {\ttfamily input\+\_\+1} and {\ttfamily input\+\_\+2}, each of 1000 items, into a sorted array {\ttfamily output} of 2000 items.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}}\ =\ 1000;}
\DoxyCodeLine{\textcolor{keywordtype}{int}*\ input\_1\ =\ \mbox{\hyperlink{namespacetf_ad289846c38e3f122e1315d906243fc8b}{tf::cuda\_malloc\_shared<int>}}(\mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}});\ \ \ \ \textcolor{comment}{//\ input\ vector\ 1}}
\DoxyCodeLine{\textcolor{keywordtype}{int}*\ input\_2\ =\ \mbox{\hyperlink{namespacetf_ad289846c38e3f122e1315d906243fc8b}{tf::cuda\_malloc\_shared<int>}}(\mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}});\ \ \ \ \textcolor{comment}{//\ input\ vector\ 2}}
\DoxyCodeLine{\textcolor{keywordtype}{int}*\ \mbox{\hyperlink{benchmarks_2scan_2scan_8hpp_a8390452002ecc7a0dadc5ae0dccc9b6c}{output}}\ \ =\ \mbox{\hyperlink{namespacetf_ad289846c38e3f122e1315d906243fc8b}{tf::cuda\_malloc\_shared<int>}}(2*\mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}});\ \ \textcolor{comment}{//\ output\ vector}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ initializes\ the\ data}}
\DoxyCodeLine{\textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}};\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}++)\ \{}
\DoxyCodeLine{\ \ input\_1[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]\ =\ rand()\%100;}
\DoxyCodeLine{\ \ input\_2[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]\ =\ rand()\%100;}
\DoxyCodeLine{\}}
\DoxyCodeLine{std::sort(input\_1,\ input1\ +\ \mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}});}
\DoxyCodeLine{std::sort(input\_2,\ input2\ +\ \mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ merge\ input\_1\ and\ input\_2\ to\ output}}
\DoxyCodeLine{\mbox{\hyperlink{classtf_1_1cuda_flow}{tf::cudaFlow}}\ cf;}
\DoxyCodeLine{\mbox{\hyperlink{classtf_1_1cuda_task}{tf::cudaTask}}\ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}\ =\ cf.merge(}
\DoxyCodeLine{\ \ input\_1,\ input\_1\ +\ \mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}},\ input\_2,\ input\_2\ +\ \mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}},\ \mbox{\hyperlink{benchmarks_2scan_2scan_8hpp_a8390452002ecc7a0dadc5ae0dccc9b6c}{output}},\ }
\DoxyCodeLine{\ \ []\_\_device\_\_\ (\textcolor{keywordtype}{int}\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}},\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ <\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}};\ \}\ \ \textcolor{comment}{//\ comparator}}
\DoxyCodeLine{);}
\DoxyCodeLine{cf.offload();}

\end{DoxyCode}
\hypertarget{cuda_flow_merge_cudaFlowMergeTwoRangesOfKeyValueItems}{}\doxysection{\texorpdfstring{Merge two Sorted Ranges of Key-\/\+Value Items}{Merge two Sorted Ranges of Key-\/\+Value Items}}\label{cuda_flow_merge_cudaFlowMergeTwoRangesOfKeyValueItems}
tf\+::cuda\+Flow\+::merge\+\_\+by\+\_\+key performs key-\/value merge over two sorted ranges in a similar way to \doxylink{namespacetf_a37ec481149c2f01669353033d75ed72a}{tf\+::cuda\+\_\+merge}; additionally, it copies elements from the two ranges of values associated with two input keys, respectively. The following code performs key-\/value merge over {\ttfamily a} and {\ttfamily b\+:} 


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}}\ =\ 2;}
\DoxyCodeLine{\textcolor{keywordtype}{int}*\ a\_keys\ =\ \mbox{\hyperlink{namespacetf_ad289846c38e3f122e1315d906243fc8b}{tf::cuda\_malloc\_shared<int>}}(\mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}});}
\DoxyCodeLine{\textcolor{keywordtype}{int}*\ a\_vals\ =\ \mbox{\hyperlink{namespacetf_ad289846c38e3f122e1315d906243fc8b}{tf::cuda\_malloc\_shared<int>}}(\mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}});}
\DoxyCodeLine{\textcolor{keywordtype}{int}*\ b\_keys\ =\ \mbox{\hyperlink{namespacetf_ad289846c38e3f122e1315d906243fc8b}{tf::cuda\_malloc\_shared<int>}}(\mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}});}
\DoxyCodeLine{\textcolor{keywordtype}{int}*\ b\_vals\ =\ \mbox{\hyperlink{namespacetf_ad289846c38e3f122e1315d906243fc8b}{tf::cuda\_malloc\_shared<int>}}(\mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}});}
\DoxyCodeLine{\textcolor{keywordtype}{int}*\ c\_keys\ =\ \mbox{\hyperlink{namespacetf_ad289846c38e3f122e1315d906243fc8b}{tf::cuda\_malloc\_shared<int>}}(2*\mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}});}
\DoxyCodeLine{\textcolor{keywordtype}{int}*\ c\_vals\ =\ \mbox{\hyperlink{namespacetf_ad289846c38e3f122e1315d906243fc8b}{tf::cuda\_malloc\_shared<int>}}(2*\mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ initializes\ the\ data}}
\DoxyCodeLine{a\_keys[0]\ =\ 8,\ a\_keys[1]\ =\ 1;}
\DoxyCodeLine{a\_vals[0]\ =\ 1,\ a\_vals[1]\ =\ 2;}
\DoxyCodeLine{b\_keys[0]\ =\ 3,\ b\_keys[1]\ =\ 7;}
\DoxyCodeLine{b\_vals[0]\ =\ 3,\ b\_vals[1]\ =\ 4;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ performs\ key-\/value\ merge}}
\DoxyCodeLine{\mbox{\hyperlink{classtf_1_1cuda_flow}{tf::cudaFlow}}\ cf;}
\DoxyCodeLine{cf.merge\_by\_key(}
\DoxyCodeLine{\ \ a\_keys,\ a\_keys+\mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}},\ a\_vals,\ }
\DoxyCodeLine{\ \ b\_keys,\ b\_keys+\mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}},\ b\_vals,\ }
\DoxyCodeLine{\ \ c\_keys,\ c\_vals,}
\DoxyCodeLine{\ \ []\ \_\_device\_\_\ (\textcolor{keywordtype}{int}\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}},\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ <\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}};\ \},}
\DoxyCodeLine{);}
\DoxyCodeLine{cf.offload();}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ now,\ c\_keys\ =\ \{1,\ 3,\ 7,\ 8\}}}
\DoxyCodeLine{\textcolor{comment}{//\ now,\ c\_vals\ =\ \{2,\ 3,\ 4,\ 1\}}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ delete\ the\ device\ memory}}
\DoxyCodeLine{\mbox{\hyperlink{namespacetf_ac7a8fe7456b888d6072ba94783c5003c}{tf::cuda\_free}}(\mbox{\hyperlink{sugar_8h_aaadc06b5dac8070de2c8677210967bdb}{buffer}});}
\DoxyCodeLine{\mbox{\hyperlink{namespacetf_ac7a8fe7456b888d6072ba94783c5003c}{tf::cuda\_free}}(a\_keys);}
\DoxyCodeLine{\mbox{\hyperlink{namespacetf_ac7a8fe7456b888d6072ba94783c5003c}{tf::cuda\_free}}(b\_keys);}
\DoxyCodeLine{\mbox{\hyperlink{namespacetf_ac7a8fe7456b888d6072ba94783c5003c}{tf::cuda\_free}}(c\_keys);}
\DoxyCodeLine{\mbox{\hyperlink{namespacetf_ac7a8fe7456b888d6072ba94783c5003c}{tf::cuda\_free}}(a\_vals);}
\DoxyCodeLine{\mbox{\hyperlink{namespacetf_ac7a8fe7456b888d6072ba94783c5003c}{tf::cuda\_free}}(b\_vals);}
\DoxyCodeLine{\mbox{\hyperlink{namespacetf_ac7a8fe7456b888d6072ba94783c5003c}{tf::cuda\_free}}(c\_vals);}

\end{DoxyCode}
\hypertarget{cuda_flow_merge_cudaFlowMergeMiscellaneousItems}{}\doxysection{\texorpdfstring{Miscellaneous Items}{Miscellaneous Items}}\label{cuda_flow_merge_cudaFlowMergeMiscellaneousItems}
Parallel merge algorithms are also available in \doxylink{classtf_1_1cuda_flow_capturer}{tf\+::cuda\+Flow\+Capturer} with the same API. 