\doxysection{test\+\_\+server.\+h}
\hypertarget{test__server_8h_source}{}\label{test__server_8h_source}\index{external/taskflow/3rd-\/party/tbb/src/rml/test/test\_server.h@{external/taskflow/3rd-\/party/tbb/src/rml/test/test\_server.h}}
\mbox{\hyperlink{test__server_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ \ \ \ Copyright\ (c)\ 2005-\/2020\ Intel\ Corporation}}
\DoxyCodeLine{00003\ \textcolor{comment}{}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ \ \ \ Licensed\ under\ the\ Apache\ License,\ Version\ 2.0\ (the\ "{}License"{});}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ \ \ \ you\ may\ not\ use\ this\ file\ except\ in\ compliance\ with\ the\ License.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ \ \ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00007\ \textcolor{comment}{}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ \ \ \ \ \ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00009\ \textcolor{comment}{}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ \ \ \ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,\ software}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ \ \ \ distributed\ under\ the\ License\ is\ distributed\ on\ an\ "{}AS\ IS"{}\ BASIS,}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ \ \ \ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY\ KIND,\ either\ express\ or\ implied.}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ \ \ \ See\ the\ License\ for\ the\ specific\ language\ governing\ permissions\ and}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ \ \ \ limitations\ under\ the\ License.}}
\DoxyCodeLine{00015\ \textcolor{comment}{*/}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{comment}{/*\ This\ header\ contains\ code\ shared\ by\ test\_omp\_server.cpp\ and\ test\_tbb\_server.cpp\ }}
\DoxyCodeLine{00018\ \textcolor{comment}{\ \ \ There\ is\ no\ ifndef\ guard\ -\/\ test\ is\ supposed\ to\ include\ this\ file\ exactly\ once.}}
\DoxyCodeLine{00019\ \textcolor{comment}{\ \ \ The\ test\ is\ also\ executed\ to\ have\ \#include\ of\ rml\_omp.h\ or\ rml\_tbb.h\ before\ }}
\DoxyCodeLine{00020\ \textcolor{comment}{\ \ \ including\ this\ header.\ }}
\DoxyCodeLine{00021\ \textcolor{comment}{}}
\DoxyCodeLine{00022\ \textcolor{comment}{\ \ \ This\ header\ should\ not\ use\ any\ parts\ of\ TBB\ that\ require\ linking\ in\ the\ TBB\ run-\/time.\ }}
\DoxyCodeLine{00023\ \textcolor{comment}{\ \ \ It\ uses\ a\ few\ instances\ of\ tbb::atomic<T>,\ all\ of\ which\ are\ completely\ inlined.\ */}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{external_2taskflow_23rd-party_2tbb_2include_2tbb_2atomic_8h}{tbb/atomic.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tbb__thread_8h}{tbb/tbb\_thread.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{harness_8h}{harness.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{harness__memory_8h}{harness\_memory.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{harness__concurrency__tracker_8h}{harness\_concurrency\_tracker.h}}"{}}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#define\ TRIVIAL\ 0}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#if\ TRIVIAL\ }}
\DoxyCodeLine{00036\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{test__server_8h_a5a3711b210093711745c7fa41a5f777b}{MaxClient}}\ =\ 1;}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00038\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{test__server_8h_a5a3711b210093711745c7fa41a5f777b}{MaxClient}}\ =\ 4;}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{test__server_8h_a5943aadf2fa7d2470ace3a42335129eb}{ClientStackSize}}[\mbox{\hyperlink{test__server_8h_a5a3711b210093711745c7fa41a5f777b}{MaxClient}}]\ =\ \{}
\DoxyCodeLine{00042\ \ \ \ \ 1000000}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\#if\ !TRIVIAL}}
\DoxyCodeLine{00044\ \ \ \ ,2000000}
\DoxyCodeLine{00045\ \ \ \ ,1000000}
\DoxyCodeLine{00046\ \ \ \ ,4000000}
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ TRIVIAL\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00048\ \};}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{test__server_8h_a35a52cc52ae1c93202214fc1b0d8aac4}{OverheadStackSize}}\ =\ 500000;}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{test__server_8h_af54589088a029b241f655c7d703e3144}{JobArraySize}}\ =\ 1000;}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{test__server_8h_a504d97b14c7255da49c431a792589383}{TestSingleConnection}};}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{test__server_8h_a6f749070ab07fbd1efac071e89d4b828}{N\_TestConnections}};}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{test__server_8h_ab30e44fab88eccf77654e3c1cfab793e}{server\_concurrency}};}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_my_job_ae3d9643372a704e6512fa32b3975ef28}{MyJob}}:\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classrml_1_1job}{::rml::job}}\ \{}
\DoxyCodeLine{00061\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keyword}{enum}\ \mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990}{state\_t}}\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990a4e2de3a378e6ee8c06a02526b0633b6e}{unallocated}},}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990a09d330bda86806a4a270dd6457de4f1c}{idle}},}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990aa0a3bdd0a6e7e629c60ec61e068d8c42}{busy}},}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990a46229049d574a49884331f09889dc6c7}{clean}}}
\DoxyCodeLine{00072\ \ \ \ \ \};}
\DoxyCodeLine{00073\ \ \ \ \ tbb::atomic<int>\ \mbox{\hyperlink{class_my_job_a7f5a8cef9effe4013aba12e9d1175731}{state}};}
\DoxyCodeLine{00074\ \ \ \ \ tbb::atomic<int>\ \mbox{\hyperlink{class_my_job_a48724c12e5bc721555f850e749ba7b53}{processing\_count}};}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_my_job_a52e30afbaa40d5a75a193261a4a84813}{update}}(\ \mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990}{state\_t}}\ new\_state,\ \mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990}{state\_t}}\ old\_state\ )\ \{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ o\ =\ \mbox{\hyperlink{class_my_job_a7f5a8cef9effe4013aba12e9d1175731}{state}}.compare\_and\_swap(new\_state,old\_state);}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ o==old\_state,\ \textcolor{stringliteral}{"{}illegal\ transition"{}}\ );}
\DoxyCodeLine{00078\ \ \ \ \ \}}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_my_job_a6e41db3dda2e8d3be04de7ad5efa975d}{update\_from\_either}}(\ \mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990}{state\_t}}\ new\_state,\ \mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990}{state\_t}}\ old\_state1,\ \mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990}{state\_t}}\ old\_state2\ )\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ snapshot;}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ snapshot\ =\ \mbox{\hyperlink{class_my_job_a7f5a8cef9effe4013aba12e9d1175731}{state}};}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ snapshot==old\_state1||snapshot==old\_state2,\ \textcolor{stringliteral}{"{}illegal\ transition"{}}\ );}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}(\ \mbox{\hyperlink{class_my_job_a7f5a8cef9effe4013aba12e9d1175731}{state}}.compare\_and\_swap(new\_state,snapshot)!=snapshot\ );}
\DoxyCodeLine{00085\ \ \ \ \ \}}
\DoxyCodeLine{00086\ \ \ \ \ \mbox{\hyperlink{class_my_job_ae3d9643372a704e6512fa32b3975ef28}{MyJob}}()\ \{}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_my_job_a7f5a8cef9effe4013aba12e9d1175731}{state}}=\mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990a4e2de3a378e6ee8c06a02526b0633b6e}{unallocated}};}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_my_job_a48724c12e5bc721555f850e749ba7b53}{processing\_count}}=0;}
\DoxyCodeLine{00089\ \ \ \ \ \}}
\DoxyCodeLine{00090\ \ \ \ \ \mbox{\hyperlink{class_my_job_a96efb1bc0533759a4fad82938fdfe67b}{\string~MyJob}}()\ \{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Overwrite\ so\ that\ accidental\ use\ after\ destruction\ can\ be\ detected.}}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ memset(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{void}*\textcolor{keyword}{>}(\textcolor{keyword}{this}),-\/1,\textcolor{keyword}{sizeof}(*\textcolor{keyword}{this}));}
\DoxyCodeLine{00093\ \ \ \ \ \}}
\DoxyCodeLine{00094\ \};}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \textcolor{keyword}{static}\ tbb::atomic<int>\ \mbox{\hyperlink{test__server_8h_ae45ed7318eee1ef6d6fe36a14db431ff}{ClientConstructions}};}
\DoxyCodeLine{00097\ \textcolor{keyword}{static}\ tbb::atomic<int>\ \mbox{\hyperlink{test__server_8h_a08a6613318e9718411e69a98c47f47be}{ClientDestructions}};}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_nesting_a0f5fa6fa01110299924edf51562f2c89}{Nesting}}\ \{}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{struct_nesting_ad83425c9b4b63962c111f9186c4d277c}{level}};}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{struct_nesting_ad89a95ea7e97d32f71e6b7ea3c44d97f}{limit}};}
\DoxyCodeLine{00102\ \ \ \ \ \mbox{\hyperlink{struct_nesting_a0f5fa6fa01110299924edf51562f2c89}{Nesting}}()\ :\ \mbox{\hyperlink{struct_nesting_ad83425c9b4b63962c111f9186c4d277c}{level}}(0),\ \mbox{\hyperlink{struct_nesting_ad89a95ea7e97d32f71e6b7ea3c44d97f}{limit}}(0)\ \{\}}
\DoxyCodeLine{00103\ \ \ \ \ \mbox{\hyperlink{struct_nesting_aeedf090c681d1a89f509023940b167f1}{Nesting}}(\ \textcolor{keywordtype}{int}\ level\_,\ \textcolor{keywordtype}{int}\ limit\_\ )\ :\ \mbox{\hyperlink{struct_nesting_ad83425c9b4b63962c111f9186c4d277c}{level}}(level\_),\ \mbox{\hyperlink{struct_nesting_ad89a95ea7e97d32f71e6b7ea3c44d97f}{limit}}(limit\_)\ \{\}}
\DoxyCodeLine{00104\ \};}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Client>}
\DoxyCodeLine{00107\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_client_base}{ClientBase}}:\ \textcolor{keyword}{public}\ \mbox{\hyperlink{class_client}{Client}}\ \{}
\DoxyCodeLine{00108\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ Client::size\_type\ \mbox{\hyperlink{class_client_base_a3fb9b8d35c124fde0cded67440384696}{size\_type}};}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ Client::version\_type\ \mbox{\hyperlink{class_client_base_a3aee12354b8dc46ac41b027a38dfed9f}{version\_type}};}
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ Client::policy\_type\ \mbox{\hyperlink{class_client_base_a40d220fc1bef3d85ea8932cc2170d184}{policy\_type}};}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ Client::job\ \mbox{\hyperlink{class_client_base_a834359c26532db38c369e99544e86424}{job}};}
\DoxyCodeLine{00113\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00114\ \ \ \ \ \mbox{\hyperlink{class_client_base_a3fb9b8d35c124fde0cded67440384696}{size\_type}}\ \mbox{\hyperlink{class_client_base_a3ea52c483c88420739abf4e60a66e0f7}{my\_max\_job\_count}};}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{class_client_base_a22b95576c86b89847e39430f19efaaee}{my\_stack\_size}};}
\DoxyCodeLine{00116\ \ \ \ \ tbb::atomic<size\_t>\ \mbox{\hyperlink{class_client_base_a330dd3bef8d71177b182f4753c685ffb}{next\_job\_index}};}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{class_client_base_a9dcb96ca245129e235b3a071e41df631}{my\_client\_id}};}
\DoxyCodeLine{00118\ \ \ \ \ \mbox{\hyperlink{classrml_1_1server}{rml::server}}*\ \mbox{\hyperlink{class_client_base_a97eff0e07cd31dfeea4a093406c97c5a}{my\_server}};}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{keyword}{enum}\ \mbox{\hyperlink{class_client_base_a2c65b478eaf40b5bf4c6f7fb83a81990}{state\_t}}\ \{}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_client_base_a2c65b478eaf40b5bf4c6f7fb83a81990a9c48c59ce92b8985d50fb31e0bba1b83}{live}}=0x1234,}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_client_base_a2c65b478eaf40b5bf4c6f7fb83a81990a17121ecf8d6185605b0a86cd033a11d4}{destroyed}}=0xDEAD}
\DoxyCodeLine{00126\ \ \ \ \ \};}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \ \ tbb::atomic<int>\ \mbox{\hyperlink{class_client_base_a6a94fd44794b13d5e42d310d079b2c4c}{state}};}
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_client_base_afc4d384ecfc8aa9755c034b58b1c5a0e}{update}}(\ \mbox{\hyperlink{class_client_base_a2c65b478eaf40b5bf4c6f7fb83a81990}{state\_t}}\ new\_state,\ \mbox{\hyperlink{class_client_base_a2c65b478eaf40b5bf4c6f7fb83a81990}{state\_t}}\ old\_state\ )\ \{}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ o\ =\ \mbox{\hyperlink{class_client_base_a6a94fd44794b13d5e42d310d079b2c4c}{state}}.compare\_and\_swap(new\_state,old\_state);}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ o==old\_state,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00132\ \ \ \ \ \}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ tbb::atomic<bool>\ \mbox{\hyperlink{class_client_base_a882393e6903dcbf72465a445973183e4}{expect\_close\_connection}};}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \ \ \mbox{\hyperlink{class_my_job}{MyJob}}\ *\mbox{\hyperlink{class_client_base_aec9598b61d4c7e4ee929227cbabe4636}{job\_array}};}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \mbox{\hyperlink{class_client_base_a3aee12354b8dc46ac41b027a38dfed9f}{version\_type}}\ \mbox{\hyperlink{class_client_base_ae04288928d94683ad3f06a778b21f1d8}{version}}()\ const\ \_\_TBB\_override\ \{}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ \mbox{\hyperlink{class_client_base_a6a94fd44794b13d5e42d310d079b2c4c}{state}}==\mbox{\hyperlink{class_client_base_a2c65b478eaf40b5bf4c6f7fb83a81990a9c48c59ce92b8985d50fb31e0bba1b83}{live}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00141\ \ \ \ \ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \ \ \mbox{\hyperlink{class_client_base_a3fb9b8d35c124fde0cded67440384696}{size\_type}}\ \mbox{\hyperlink{class_client_base_a628fdec27acc07826e62372eb4de8dab}{max\_job\_count}}()\ const\ \_\_TBB\_override\ \{}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ \mbox{\hyperlink{class_client_base_a6a94fd44794b13d5e42d310d079b2c4c}{state}}==\mbox{\hyperlink{class_client_base_a2c65b478eaf40b5bf4c6f7fb83a81990a9c48c59ce92b8985d50fb31e0bba1b83}{live}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_client_base_a3ea52c483c88420739abf4e60a66e0f7}{my\_max\_job\_count}};}
\DoxyCodeLine{00146\ \ \ \ \ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{class_client_base_a9b21b7ae9f6b921804053f6cc995013b}{min\_stack\_size}}()\ const\ \_\_TBB\_override\ \{}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ \mbox{\hyperlink{class_client_base_a6a94fd44794b13d5e42d310d079b2c4c}{state}}==\mbox{\hyperlink{class_client_base_a2c65b478eaf40b5bf4c6f7fb83a81990a9c48c59ce92b8985d50fb31e0bba1b83}{live}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_client_base_a22b95576c86b89847e39430f19efaaee}{my\_stack\_size}};}
\DoxyCodeLine{00151\ \ \ \ \ \}}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ \mbox{\hyperlink{class_client_base_a40d220fc1bef3d85ea8932cc2170d184}{policy\_type}}\ \mbox{\hyperlink{class_client_base_a012e7356dcaddf7b30ddf340244e32c5}{policy}}()\ const\ \_\_TBB\_override\ \{\textcolor{keywordflow}{return}\ Client::throughput;\}}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_client_base_a89a955975aef1acef2011ad61264c862}{acknowledge\_close\_connection}}()\ \_\_TBB\_override\ \{}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ \mbox{\hyperlink{class_client_base_a882393e6903dcbf72465a445973183e4}{expect\_close\_connection}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keywordtype}{size\_t}\ k=\mbox{\hyperlink{class_client_base_a330dd3bef8d71177b182f4753c685ffb}{next\_job\_index}};\ k>0;\ )\ \{}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/k;}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ \mbox{\hyperlink{class_client_base_aec9598b61d4c7e4ee929227cbabe4636}{job\_array}}[k].\mbox{\hyperlink{class_client_base_a6a94fd44794b13d5e42d310d079b2c4c}{state}}==\mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990a46229049d574a49884331f09889dc6c7}{MyJob::clean}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}[]\ \mbox{\hyperlink{class_client_base_aec9598b61d4c7e4ee929227cbabe4636}{job\_array}};}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_client_base_aec9598b61d4c7e4ee929227cbabe4636}{job\_array}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ \mbox{\hyperlink{class_client_base_a97eff0e07cd31dfeea4a093406c97c5a}{my\_server}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_client_base_afc4d384ecfc8aa9755c034b58b1c5a0e}{update}}(\ \mbox{\hyperlink{class_client_base_a2c65b478eaf40b5bf4c6f7fb83a81990a17121ecf8d6185605b0a86cd033a11d4}{destroyed}},\ \mbox{\hyperlink{class_client_base_a2c65b478eaf40b5bf4c6f7fb83a81990a9c48c59ce92b8985d50fb31e0bba1b83}{live}}\ );}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ \textcolor{keyword}{this};}
\DoxyCodeLine{00166\ \ \ \ \ \}}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_client_base_af000d9f4141c31eefb8652210c594a02}{cleanup}}(\ \mbox{\hyperlink{class_client_base_a834359c26532db38c369e99544e86424}{job}}\&\ j\_\ )\ \_\_TBB\_override\ \{}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{harness__report_8h_ace9fba7267bf6a9a92654ce7f25c5516}{REMARK}}(\textcolor{stringliteral}{"{}client\ \%d:\ cleanup(\%p)\ called\(\backslash\)n"{}},\mbox{\hyperlink{class_client_base_a20f366306bc72126041abf84c3f7f022}{client\_id}}(),\&j\_);}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ \mbox{\hyperlink{class_client_base_a6a94fd44794b13d5e42d310d079b2c4c}{state}}==\mbox{\hyperlink{class_client_base_a2c65b478eaf40b5bf4c6f7fb83a81990a9c48c59ce92b8985d50fb31e0bba1b83}{live}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_my_job}{MyJob}}\&\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{class_my_job}{MyJob}}\&\textcolor{keyword}{>}(j\_);}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}.state==\mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990aa0a3bdd0a6e7e629c60ec61e068d8c42}{MyJob::busy}}\ )}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_client_base_a97eff0e07cd31dfeea4a093406c97c5a}{my\_server}}-\/>yield();}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}.update(\mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990a46229049d574a49884331f09889dc6c7}{MyJob::clean}},\mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990a09d330bda86806a4a270dd6457de4f1c}{MyJob::idle}});}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{harness__report_8h_ace9fba7267bf6a9a92654ce7f25c5516}{REMARK}}(\textcolor{stringliteral}{"{}client\ \%d:\ cleanup(\%p)\ returns\(\backslash\)n"{}},\mbox{\hyperlink{class_client_base_a20f366306bc72126041abf84c3f7f022}{client\_id}}(),\&j\_);}
\DoxyCodeLine{00176\ \ \ \ \ \}}
\DoxyCodeLine{00177\ \ \ \ }
\DoxyCodeLine{00178\ \ \ \ \ \mbox{\hyperlink{class_client_base_a834359c26532db38c369e99544e86424}{job}}*\ \mbox{\hyperlink{class_client_base_aacd0530bea4ef337cc82dfbd4f311338}{create\_one\_job}}();}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_client_base_ad502a3c9a347ad1b272f6bc90265d94a}{do\_process}}(\ \mbox{\hyperlink{class_client_base_a834359c26532db38c369e99544e86424}{job}}*\ j\_\ )\ \{}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ \mbox{\hyperlink{class_client_base_a6a94fd44794b13d5e42d310d079b2c4c}{state}}==\mbox{\hyperlink{class_client_base_a2c65b478eaf40b5bf4c6f7fb83a81990a9c48c59ce92b8985d50fb31e0bba1b83}{live}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_my_job}{MyJob}}\&\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{class_my_job}{MyJob}}\&\textcolor{keyword}{>}(*j\_);}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ j\_,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}.update(\mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990aa0a3bdd0a6e7e629c60ec61e068d8c42}{MyJob::busy}},\mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990a09d330bda86806a4a270dd6457de4f1c}{MyJob::idle}});}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ use\ of\ the\ plain\ addition\ (not\ the\ atomic\ increment)\ is\ intentonial}}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}.processing\_count\ =\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}.processing\_count\ +\ 1;}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ \mbox{\hyperlink{class_client_base_a22b95576c86b89847e39430f19efaaee}{my\_stack\_size}}>\mbox{\hyperlink{test__server_8h_a35a52cc52ae1c93202214fc1b0d8aac4}{OverheadStackSize}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );\ }
\DoxyCodeLine{00189\ \textcolor{preprocessor}{\#ifdef\ \_\_ia64\_\_}}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Half\ of\ the\ stack\ is\ reserved\ for\ RSE,\ so\ test\ only\ remaining\ half.}}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{harness__memory_8h_a9008c341bb6a75aca38d2bf68fe9808c}{UseStackSpace}}(\ (\mbox{\hyperlink{class_client_base_a22b95576c86b89847e39430f19efaaee}{my\_stack\_size}}-\/\mbox{\hyperlink{test__server_8h_a35a52cc52ae1c93202214fc1b0d8aac4}{OverheadStackSize}})/2\ );}
\DoxyCodeLine{00192\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{harness__memory_8h_a9008c341bb6a75aca38d2bf68fe9808c}{UseStackSpace}}(\ \mbox{\hyperlink{class_client_base_a22b95576c86b89847e39430f19efaaee}{my\_stack\_size}}-\/\mbox{\hyperlink{test__server_8h_a35a52cc52ae1c93202214fc1b0d8aac4}{OverheadStackSize}}\ );}
\DoxyCodeLine{00194\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}.update(\mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990a09d330bda86806a4a270dd6457de4f1c}{MyJob::idle}},\mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990aa0a3bdd0a6e7e629c60ec61e068d8c42}{MyJob::busy}});}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_client_base_a97eff0e07cd31dfeea4a093406c97c5a}{my\_server}}-\/>yield();}
\DoxyCodeLine{00197\ \ \ \ \ \}\ }
\DoxyCodeLine{00198\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00199\ \ \ \ \ \mbox{\hyperlink{class_client_base_ae531bed8069f70dfb9017ff70cc8e161}{ClientBase}}()\ :\ \mbox{\hyperlink{class_client_base_a97eff0e07cd31dfeea4a093406c97c5a}{my\_server}}(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_client_base_a9dcb96ca245129e235b3a071e41df631}{my\_client\_id}}\ =\ \mbox{\hyperlink{test__server_8h_ae45ed7318eee1ef6d6fe36a14db431ff}{ClientConstructions}}++;}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_client_base_a330dd3bef8d71177b182f4753c685ffb}{next\_job\_index}}\ =\ 0;\ }
\DoxyCodeLine{00202\ \ \ \ \ \}}
\DoxyCodeLine{00203\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{class_client_base_a20f366306bc72126041abf84c3f7f022}{client\_id}}()\textcolor{keyword}{\ const\ }\{\textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_client_base_a9dcb96ca245129e235b3a071e41df631}{my\_client\_id}};\}}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ \ \ \mbox{\hyperlink{struct_nesting}{Nesting}}\ \mbox{\hyperlink{class_client_base_a4f99c8dd680d36b05caf49f8c5db0461}{nesting}};}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_client_base_aef944515ea6728b68d51cf13dd69666d}{initialize}}(\ \mbox{\hyperlink{class_client_base_a3fb9b8d35c124fde0cded67440384696}{size\_type}}\ \mbox{\hyperlink{class_client_base_a628fdec27acc07826e62372eb4de8dab}{max\_job\_count}},\ \mbox{\hyperlink{struct_nesting}{Nesting}}\ nesting\_,\ \textcolor{keywordtype}{size\_t}\ stack\_size\ )\ \{}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ stack\_size>0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_client_base_a3ea52c483c88420739abf4e60a66e0f7}{my\_max\_job\_count}}\ =\ \mbox{\hyperlink{class_client_base_a628fdec27acc07826e62372eb4de8dab}{max\_job\_count}};}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_client_base_a4f99c8dd680d36b05caf49f8c5db0461}{nesting}}\ =\ nesting\_;}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_client_base_a22b95576c86b89847e39430f19efaaee}{my\_stack\_size}}\ =\ stack\_size;}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_client_base_aec9598b61d4c7e4ee929227cbabe4636}{job\_array}}\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_my_job}{MyJob}}[\mbox{\hyperlink{test__server_8h_af54589088a029b241f655c7d703e3144}{JobArraySize}}];}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_client_base_a882393e6903dcbf72465a445973183e4}{expect\_close\_connection}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_client_base_a6a94fd44794b13d5e42d310d079b2c4c}{state}}\ =\ \mbox{\hyperlink{class_client_base_a2c65b478eaf40b5bf4c6f7fb83a81990a9c48c59ce92b8985d50fb31e0bba1b83}{live}};}
\DoxyCodeLine{00215\ \ \ \ \ \}}
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_client_base_a5eff33ac6ad0b9f068a60b5668a6176e}{set\_server}}(\ \mbox{\hyperlink{classrml_1_1server}{rml::server}}*\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ )\ \{\mbox{\hyperlink{class_client_base_a97eff0e07cd31dfeea4a093406c97c5a}{my\_server}}=\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}};\}}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{class_client_base_a964bd95949114805ade2986de6bd304a}{default\_concurrency}}()\textcolor{keyword}{\ const\ }\{\ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ \mbox{\hyperlink{class_client_base_a97eff0e07cd31dfeea4a093406c97c5a}{my\_server}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_client_base_a97eff0e07cd31dfeea4a093406c97c5a}{my\_server}}-\/>default\_concurrency();\ \}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{class_client_base_a9996fbdf4ef23b906b0037106975fd5b}{\string~ClientBase}}()\ \{}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ \mbox{\hyperlink{class_client_base_a6a94fd44794b13d5e42d310d079b2c4c}{state}}==\mbox{\hyperlink{class_client_base_a2c65b478eaf40b5bf4c6f7fb83a81990a17121ecf8d6185605b0a86cd033a11d4}{destroyed}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ ++\mbox{\hyperlink{test__server_8h_a08a6613318e9718411e69a98c47f47be}{ClientDestructions}};}
\DoxyCodeLine{00224\ \ \ \ \ \}}
\DoxyCodeLine{00225\ \};}
\DoxyCodeLine{00226\ }
\DoxyCodeLine{00227\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Client>}
\DoxyCodeLine{00228\ \textcolor{keyword}{typename}\ Client::job*\ \mbox{\hyperlink{class_client_base_a9476947cf38db4e809086571f5c23393}{ClientBase<Client>::create\_one\_job}}()\ \{}
\DoxyCodeLine{00229\ \ \ \ \ \mbox{\hyperlink{harness__report_8h_ace9fba7267bf6a9a92654ce7f25c5516}{REMARK}}(\textcolor{stringliteral}{"{}client\ \%d:\ create\_one\_job()\ called\(\backslash\)n"{}},client\_id());}
\DoxyCodeLine{00230\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ k\ =\ next\_job\_index++;}
\DoxyCodeLine{00231\ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ state==live,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00232\ \ \ \ \ \textcolor{comment}{//\ Following\ assertion\ depends\ on\ assumption\ that\ implementation\ does\ not\ destroy\ jobs\ until\ }}
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{comment}{//\ the\ connection\ is\ closed.\ \ If\ the\ implementation\ is\ changed\ to\ destroy\ jobs\ sooner,\ the\ }}
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{comment}{//\ test\ logic\ in\ this\ header\ will\ have\ to\ be\ reworked.}}
\DoxyCodeLine{00235\ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ k<my\_max\_job\_count,\ \textcolor{stringliteral}{"{}RML\ allocated\ more\ than\ max\_job\_count\ jobs\ simultaneously"{}}\ );}
\DoxyCodeLine{00236\ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ k<\mbox{\hyperlink{test__server_8h_af54589088a029b241f655c7d703e3144}{JobArraySize}},\ \textcolor{stringliteral}{"{}JobArraySize\ not\ big\ enough\ (problem\ is\ in\ test,\ not\ RML)"{}}\ );}
\DoxyCodeLine{00237\ \ \ \ \ \mbox{\hyperlink{class_my_job}{MyJob}}\&\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}\ =\ job\_array[k];}
\DoxyCodeLine{00238\ \ \ \ \ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}.update(\mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990a09d330bda86806a4a270dd6457de4f1c}{MyJob::idle}},\mbox{\hyperlink{class_my_job_a44f37d865cfb3f176ea9c11a1e8e8990a4e2de3a378e6ee8c06a02526b0633b6e}{MyJob::unallocated}});}
\DoxyCodeLine{00239\ \ \ \ \ \mbox{\hyperlink{harness__report_8h_ace9fba7267bf6a9a92654ce7f25c5516}{REMARK}}(\textcolor{stringliteral}{"{}client\ \%d:\ create\_one\_job()\ for\ k=\%d\ returns\ \%p\(\backslash\)n"{}},client\_id(),\textcolor{keywordtype}{int}(k),\&\mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}});}
\DoxyCodeLine{00240\ \ \ \ \ \textcolor{keywordflow}{return}\ \&\mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}};}
\DoxyCodeLine{00241\ \}}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structwarning__tracker_a7811c20998fe584f37e1f3f03ef4ec83}{warning\_tracker}}\ \{}
\DoxyCodeLine{00244\ \ \ \ \ tbb::atomic<int>\ \mbox{\hyperlink{structwarning__tracker_aaaa03376ab9805b1a254b0ba8f1bf488}{n\_more\_than\_available}};}
\DoxyCodeLine{00245\ \ \ \ \ tbb::atomic<int>\ \mbox{\hyperlink{structwarning__tracker_af110e1980a9498541acba8f4d10cfe65}{n\_too\_many\_threads}};}
\DoxyCodeLine{00246\ \ \ \ \ tbb::atomic<int>\ \mbox{\hyperlink{structwarning__tracker_a5d665bd2d84e06c20c273cc3d6a9c85c}{n\_system\_overload}};}
\DoxyCodeLine{00247\ \ \ \ \ \mbox{\hyperlink{structwarning__tracker_a7811c20998fe584f37e1f3f03ef4ec83}{warning\_tracker}}()\ \{}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structwarning__tracker_aaaa03376ab9805b1a254b0ba8f1bf488}{n\_more\_than\_available}}\ =\ 0;}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structwarning__tracker_af110e1980a9498541acba8f4d10cfe65}{n\_too\_many\_threads}}\ =\ 0;}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structwarning__tracker_a5d665bd2d84e06c20c273cc3d6a9c85c}{n\_system\_overload}}\ =\ 0;}
\DoxyCodeLine{00251\ \ \ \ \ \}}
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{structwarning__tracker_af368c1c033f7178444e87f45c9a9555a}{all\_set}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structwarning__tracker_aaaa03376ab9805b1a254b0ba8f1bf488}{n\_more\_than\_available}}>0\ \&\&\ \mbox{\hyperlink{structwarning__tracker_af110e1980a9498541acba8f4d10cfe65}{n\_too\_many\_threads}}>0\ \&\&\ \mbox{\hyperlink{structwarning__tracker_a5d665bd2d84e06c20c273cc3d6a9c85c}{n\_system\_overload}}>0;\ \}}
\DoxyCodeLine{00253\ \}\ \mbox{\hyperlink{test__server_8h_a2722b2f1fecf6527f885e94809862b88}{tracker}};}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_checker_a2cca44c79f833e678734fe3e390a68b2}{Checker}}\ \{}
\DoxyCodeLine{00256\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00257\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{class_checker_ab760636ae13b430d0b6e2ffa5718e5bf}{default\_concurrency}};}
\DoxyCodeLine{00258\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_checker_aba7bca4d0608bb0db6284526ad6b678c}{check\_number\_of\_threads\_delivered}}(\ \textcolor{keywordtype}{int}\ n\_delivered,\ \textcolor{keywordtype}{int}\ n\_requested,\ \textcolor{keywordtype}{int}\ n\_extra\ )\ \textcolor{keyword}{const};}
\DoxyCodeLine{00259\ \ \ \ \ \mbox{\hyperlink{class_checker_a2cca44c79f833e678734fe3e390a68b2}{Checker}}(\ \mbox{\hyperlink{classrml_1_1server}{rml::server}}\&\ server\ )\ :\ \mbox{\hyperlink{class_checker_ab760636ae13b430d0b6e2ffa5718e5bf}{default\_concurrency}}(\mbox{\hyperlink{sugar_8h_ae4f82344f573c70aa1066a2394bba345}{int}}(server.\mbox{\hyperlink{class_checker_ab760636ae13b430d0b6e2ffa5718e5bf}{default\_concurrency}}()))\ \{\}}
\DoxyCodeLine{00260\ \};}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_checker_aba7bca4d0608bb0db6284526ad6b678c}{Checker::check\_number\_of\_threads\_delivered}}(\ \textcolor{keywordtype}{int}\ n\_delivered,\ \textcolor{keywordtype}{int}\ n\_requested,\ \textcolor{keywordtype}{int}\ n\_extra\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00263\ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ \mbox{\hyperlink{class_checker_ab760636ae13b430d0b6e2ffa5718e5bf}{default\_concurrency}}>=0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{test__server_8h_a2722b2f1fecf6527f885e94809862b88}{tracker}}.all\_set()\ )\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00265\ \ \ \ \ \textcolor{comment}{//\ Check\ that\ number\ of\ threads\ delivered\ is\ reasonable.}}
\DoxyCodeLine{00266\ \ \ \ \ \textcolor{keywordtype}{int}\ n\_avail\ =\ \mbox{\hyperlink{class_checker_ab760636ae13b430d0b6e2ffa5718e5bf}{default\_concurrency}};}
\DoxyCodeLine{00267\ \ \ \ \ \textcolor{keywordflow}{if}(\ n\_extra>0\ )}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ n\_avail-\/=n\_extra;}
\DoxyCodeLine{00269\ \ \ \ \ \textcolor{keywordflow}{if}(\ n\_avail<0\ )\ }
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ n\_avail=0;}
\DoxyCodeLine{00271\ \ \ \ \ \textcolor{keywordflow}{if}(\ n\_requested>\mbox{\hyperlink{class_checker_ab760636ae13b430d0b6e2ffa5718e5bf}{default\_concurrency}}\ )\ }
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ n\_avail\ +=\ n\_requested-\/\mbox{\hyperlink{class_checker_ab760636ae13b430d0b6e2ffa5718e5bf}{default\_concurrency}};}
\DoxyCodeLine{00273\ \ \ \ \ \textcolor{keywordtype}{int}\ n\_expected\ =\ n\_requested;}
\DoxyCodeLine{00274\ \ \ \ \ \textcolor{keywordflow}{if}(\ n\_expected>n\_avail\ )}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ n\_expected=n\_avail;}
\DoxyCodeLine{00276\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ msg\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00277\ \ \ \ \ \textcolor{keywordflow}{if}(\ n\_delivered>n\_avail\ )\ \{}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ ++\mbox{\hyperlink{test__server_8h_a2722b2f1fecf6527f885e94809862b88}{tracker}}.n\_more\_than\_available>1\ )}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ msg\ =\ \textcolor{stringliteral}{"{}server\ delivered\ more\ threads\ than\ were\ theoretically\ available"{}};}
\DoxyCodeLine{00281\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ n\_delivered>n\_expected\ )\ \{}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ ++\mbox{\hyperlink{test__server_8h_a2722b2f1fecf6527f885e94809862b88}{tracker}}.n\_too\_many\_threads>1\ )}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ msg\ =\ \textcolor{stringliteral}{"{}server\ delivered\ more\ threads\ than\ expected"{}};}
\DoxyCodeLine{00285\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ n\_delivered<n\_expected\ )\ \{}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ ++\mbox{\hyperlink{test__server_8h_a2722b2f1fecf6527f885e94809862b88}{tracker}}.n\_system\_overload>1\ )}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ msg\ =\ \textcolor{stringliteral}{"{}server\ delivered\ fewer\ threads\ than\ ideal;\ or,\ the\ system\ is\ overloaded?"{}};}
\DoxyCodeLine{00289\ \ \ \ \ \}}
\DoxyCodeLine{00290\ \ \ \ \ \textcolor{keywordflow}{if}(\ msg\ )\ \{}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{harness__report_8h_a787099914a94ed31fa544b985b55752f}{REPORT}}(\textcolor{stringliteral}{"{}Warning:\ \%s\ (n\_delivered=\%d\ n\_avail=\%d\ n\_requested=\%d\ n\_extra=\%d\ default\_concurrency=\%d)\(\backslash\)n"{}},}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ msg,\ n\_delivered,\ n\_avail,\ n\_requested,\ n\_extra,\ \mbox{\hyperlink{class_checker_ab760636ae13b430d0b6e2ffa5718e5bf}{default\_concurrency}}\ );}
\DoxyCodeLine{00293\ \ \ \ \ \}}
\DoxyCodeLine{00294\ \}}
\DoxyCodeLine{00295\ }
\DoxyCodeLine{00296\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Factory,\textcolor{keyword}{typename}\ Client>}
\DoxyCodeLine{00297\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_do_one_connection_a18403131d68f337317135ad07f0da5bc}{DoOneConnection}}:\ \mbox{\hyperlink{class_no_assign_acb5f52ed820065725301a8152ccc2eb3}{NoAssign}}\ \{}
\DoxyCodeLine{00299\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{class_do_one_connection_adfe684b86a816d0f351bdb90987e1593}{n\_thread}};}
\DoxyCodeLine{00301\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{struct_nesting}{Nesting}}\ \mbox{\hyperlink{class_do_one_connection_afeb9d0c0c4a0e674a42d88925caaf40c}{nesting}};}
\DoxyCodeLine{00303\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{class_do_one_connection_a971c8a409317fd17898563a90c95b231}{n\_extra}};}
\DoxyCodeLine{00305\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_do_one_connection_a8e0a7dc8be530bce2355d773398c5aa9}{check\_delivered}};}
\DoxyCodeLine{00306\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00307\ \ \ \ \ \mbox{\hyperlink{class_do_one_connection_a18403131d68f337317135ad07f0da5bc}{DoOneConnection}}(\ \textcolor{keywordtype}{int}\ n\_thread\_,\ \mbox{\hyperlink{struct_nesting}{Nesting}}\ nesting\_,\ \textcolor{keywordtype}{int}\ n\_extra\_,\ \textcolor{keywordtype}{bool}\ check\_delivered\_\ )\ :\ }
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_do_one_connection_adfe684b86a816d0f351bdb90987e1593}{n\_thread}}(n\_thread\_),\ }
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_do_one_connection_afeb9d0c0c4a0e674a42d88925caaf40c}{nesting}}(nesting\_),\ }
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_do_one_connection_a971c8a409317fd17898563a90c95b231}{n\_extra}}(n\_extra\_),\ }
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_do_one_connection_a8e0a7dc8be530bce2355d773398c5aa9}{check\_delivered}}(check\_delivered\_)}
\DoxyCodeLine{00312\ \ \ \ \ \{}
\DoxyCodeLine{00313\ \ \ \ \ \}}
\DoxyCodeLine{00314\ \ \ \ }
\DoxyCodeLine{00316\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_do_one_connection_a43d3aca4370137e1053e85619b8be61c}{operator()}}(\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ )\ \textcolor{keyword}{const};}
\DoxyCodeLine{00317\ \};}
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00319\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Factory,\textcolor{keyword}{typename}\ Client>}
\DoxyCodeLine{00320\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_do_one_connection_a43d3aca4370137e1053e85619b8be61c}{DoOneConnection<Factory,Client>::operator()}}(\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00321\ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{test__server_8h_a5a3711b210093711745c7fa41a5f777b}{MaxClient}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00322\ \ \ \ \ \mbox{\hyperlink{class_client}{Client}}*\ client\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_client}{Client}};}
\DoxyCodeLine{00323\ \ \ \ \ client-\/>initialize(\ Client::is\_omp\ ?\ \mbox{\hyperlink{test__server_8h_af54589088a029b241f655c7d703e3144}{JobArraySize}}\ :\ \mbox{\hyperlink{class_do_one_connection_adfe684b86a816d0f351bdb90987e1593}{n\_thread}},\ \mbox{\hyperlink{class_do_one_connection_afeb9d0c0c4a0e674a42d88925caaf40c}{nesting}},\ \mbox{\hyperlink{test__server_8h_a5943aadf2fa7d2470ace3a42335129eb}{ClientStackSize}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]\ );}
\DoxyCodeLine{00324\ \ \ \ \ Factory\ factory;}
\DoxyCodeLine{00325\ \ \ \ \ memset(\ \&factory,\ 0,\ \textcolor{keyword}{sizeof}(factory)\ );}
\DoxyCodeLine{00326\ \ \ \ \ \textcolor{keyword}{typename}\ Factory::status\_type\ status\ =\ factory.open();}
\DoxyCodeLine{00327\ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ status==Factory::st\_success,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00329\ \ \ \ \ \textcolor{keyword}{typename}\ Factory::server\_type*\ server;\ }
\DoxyCodeLine{00330\ \ \ \ \ status\ =\ factory.make\_server(\ server,\ *client\ );}
\DoxyCodeLine{00331\ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ status==Factory::st\_success,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00332\ \ \ \ \ \mbox{\hyperlink{class_harness_1_1_concurrency_tracker}{Harness::ConcurrencyTracker}}\ ct;}
\DoxyCodeLine{00333\ \ \ \ \ \mbox{\hyperlink{harness__report_8h_ace9fba7267bf6a9a92654ce7f25c5516}{REMARK}}(\textcolor{stringliteral}{"{}client\ \%d:\ opened\ server\ n\_thread=\%d\ nesting=(\%d,\%d)\(\backslash\)n"{}},}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ client-\/>client\_id(),\ \mbox{\hyperlink{class_do_one_connection_adfe684b86a816d0f351bdb90987e1593}{n\_thread}},\ \mbox{\hyperlink{class_do_one_connection_afeb9d0c0c4a0e674a42d88925caaf40c}{nesting}}.level,\ \mbox{\hyperlink{class_do_one_connection_afeb9d0c0c4a0e674a42d88925caaf40c}{nesting}}.limit);}
\DoxyCodeLine{00335\ \ \ \ \ client-\/>set\_server(\ server\ );}
\DoxyCodeLine{00336\ \ \ \ \ \mbox{\hyperlink{class_checker}{Checker}}\ checker(\ *server\ );}
\DoxyCodeLine{00337\ \ }
\DoxyCodeLine{00338\ \ \ \ \ \mbox{\hyperlink{test__rml__omp_8cpp_a3ac7bea7ef6145a4a10e8bc42ffd04ab}{FireUpJobs}}(\ *server,\ *client,\ \mbox{\hyperlink{class_do_one_connection_adfe684b86a816d0f351bdb90987e1593}{n\_thread}},\ \mbox{\hyperlink{class_do_one_connection_a971c8a409317fd17898563a90c95b231}{n\_extra}},\ \mbox{\hyperlink{class_do_one_connection_a8e0a7dc8be530bce2355d773398c5aa9}{check\_delivered}}\ \&\&\ !client-\/>is\_strict()\ ?\ \&checker\ :\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00339\ }
\DoxyCodeLine{00340\ \ \ \ \ \textcolor{comment}{//\ Close\ the\ connection}}
\DoxyCodeLine{00341\ \ \ \ \ client-\/>expect\_close\_connection\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00342\ \ \ \ \ \mbox{\hyperlink{harness__report_8h_ace9fba7267bf6a9a92654ce7f25c5516}{REMARK}}(\textcolor{stringliteral}{"{}client\ \%d:\ calling\ request\_close\_connection\(\backslash\)n"{}},\ client-\/>client\_id());}
\DoxyCodeLine{00343\ \textcolor{preprocessor}{\#if\ !RML\_USE\_WCRM}}
\DoxyCodeLine{00344\ \ \ \ \ \textcolor{keywordtype}{int}\ default\_concurrency\ =\ server-\/>default\_concurrency();}
\DoxyCodeLine{00345\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00346\ \ \ \ \ server-\/>request\_close\_connection();}
\DoxyCodeLine{00347\ \ \ \ \ \textcolor{comment}{//\ Client\ deletes\ itself\ when\ it\ sees\ call\ to\ acknowledge\_close\_connection\ from\ server.}}
\DoxyCodeLine{00348\ \ \ \ \ factory.close();}
\DoxyCodeLine{00349\ \textcolor{preprocessor}{\#if\ !RML\_USE\_WCRM}}
\DoxyCodeLine{00350\ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{test__server_8h_a504d97b14c7255da49c431a792589383}{TestSingleConnection}}\ )}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a643ae54febb34aa0f2543aa5385a606f}{\_\_TBB\_ASSERT\_EX}}(\ uintptr\_t(factory.scratch\_ptr)==uintptr\_t(default\_concurrency),\ \textcolor{stringliteral}{"{}under/over\ subscription?"{}}\ );}
\DoxyCodeLine{00352\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00353\ \}}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00356\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Factory,\ \textcolor{keyword}{typename}\ Client>}
\DoxyCodeLine{00357\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{test__server_8h_a529b5dde513b5c8bf374120abe3d387f}{SimpleTest}}()\ \{}
\DoxyCodeLine{00358\ \ \ \ \ \mbox{\hyperlink{class_harness_1_1_concurrency_tracker_a246884e98e5a47fe34ec60da871fb43b}{Harness::ConcurrencyTracker::Reset}}();}
\DoxyCodeLine{00359\ \ \ \ \ \mbox{\hyperlink{test__server_8h_a504d97b14c7255da49c431a792589383}{TestSingleConnection}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00360\ \ \ \ \ \mbox{\hyperlink{test__server_8h_a6f749070ab07fbd1efac071e89d4b828}{N\_TestConnections}}\ =\ 1;}
\DoxyCodeLine{00361\ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keywordtype}{int}\ n\_thread=\mbox{\hyperlink{harness_8h_afc1c4a6f82d8f81c0a0fd2525149824a}{MinThread}};\ n\_thread<=\mbox{\hyperlink{harness_8h_a1c41cdeec6c1cec819e816d1adada13b}{MaxThread}};\ ++n\_thread\ )\ \{}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Test\ a\ single\ connection,\ no\ nesting,\ no\ extra\ threads}}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_do_one_connection}{DoOneConnection<Factory,Client>}}\ doc(n\_thread,\mbox{\hyperlink{struct_nesting}{Nesting}}(0,0),0,\textcolor{keyword}{false});}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ doc(0);}
\DoxyCodeLine{00365\ \ \ \ \ \}}
\DoxyCodeLine{00366\ \textcolor{preprocessor}{\#if\ !TRIVIAL}}
\DoxyCodeLine{00367\ \ \ \ \ \mbox{\hyperlink{test__server_8h_a504d97b14c7255da49c431a792589383}{TestSingleConnection}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00368\ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keywordtype}{int}\ n\_thread=\mbox{\hyperlink{harness_8h_afc1c4a6f82d8f81c0a0fd2525149824a}{MinThread}};\ n\_thread<=\mbox{\hyperlink{harness_8h_a1c41cdeec6c1cec819e816d1adada13b}{MaxThread}};\ ++n\_thread\ )\ \{}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Test\ parallel\ connections}}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keywordtype}{int}\ n\_client=1;\ n\_client<=\mbox{\hyperlink{sugar_8h_ae4f82344f573c70aa1066a2394bba345}{int}}(\mbox{\hyperlink{test__server_8h_a5a3711b210093711745c7fa41a5f777b}{MaxClient}});\ ++n\_client\ )\ \{}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__server_8h_a6f749070ab07fbd1efac071e89d4b828}{N\_TestConnections}}\ =\ n\_client;}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{harness__report_8h_ace9fba7267bf6a9a92654ce7f25c5516}{REMARK}}(\textcolor{stringliteral}{"{}SimpleTest:\ n\_thread=\%d\ n\_client=\%d\(\backslash\)n"{}},n\_thread,n\_client);}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{harness_8h_ad5b2c9cf4e169014b7919debb3c91d45}{NativeParallelFor}}(\ n\_client,\ \mbox{\hyperlink{class_do_one_connection}{DoOneConnection<Factory,Client>}}(n\_thread,\mbox{\hyperlink{struct_nesting}{Nesting}}(0,0),0,\textcolor{keyword}{false})\ );}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Test\ server::independent\_thread\_number\_changed}}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__server_8h_a6f749070ab07fbd1efac071e89d4b828}{N\_TestConnections}}\ =\ 1;}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ \textcolor{keywordtype}{int}\ n\_extra=-\/4;\ n\_extra<=32;\ n\_extra=n\_extra+1+n\_extra/5\ )\ \{}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_do_one_connection}{DoOneConnection<Factory,Client>}}\ doc(n\_thread,\mbox{\hyperlink{struct_nesting}{Nesting}}(0,0),n\_extra,\textcolor{keyword}{true});}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \ \ \ \ doc(0);}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00381\ \textcolor{preprocessor}{\#if\ !RML\_USE\_WCRM}}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Test\ nested\ connections}}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_do_one_connection}{DoOneConnection<Factory,Client>}}\ doc(n\_thread,\mbox{\hyperlink{struct_nesting}{Nesting}}(0,2),0,\textcolor{keyword}{false});}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ doc(0);}
\DoxyCodeLine{00385\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00386\ \ \ \ \ \}}
\DoxyCodeLine{00387\ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ \mbox{\hyperlink{class_harness_1_1_concurrency_tracker_ab30286b932e0856c8329a059b3875b38}{Harness::ConcurrencyTracker::PeakParallelism}}()>1\ ||\ \mbox{\hyperlink{test__server_8h_ab30e44fab88eccf77654e3c1cfab793e}{server\_concurrency}}==0,\ \textcolor{stringliteral}{"{}No\ multiple\ connections\ exercised?"{}}\ );}
\DoxyCodeLine{00388\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ !TRIVIAL\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00389\ \ \ \ \ \textcolor{comment}{//\ Let\ RML\ catch\ up.}}
\DoxyCodeLine{00390\ \ \ \ \ \textcolor{keywordflow}{while}(\ \mbox{\hyperlink{test__server_8h_ae45ed7318eee1ef6d6fe36a14db431ff}{ClientConstructions}}!=\mbox{\hyperlink{test__server_8h_a08a6613318e9718411e69a98c47f47be}{ClientDestructions}}\ )}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespace_harness_a6109bacdcb4cd184d842b933d7fb18a4}{Harness::Sleep}}(1);}
\DoxyCodeLine{00392\ \}}
\DoxyCodeLine{00393\ }
\DoxyCodeLine{00394\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{test__server_8h_a0669a5383a414c5fa361eee27f2ff8d2}{check\_server\_info}}(\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ server\_info\ )}
\DoxyCodeLine{00395\ \{}
\DoxyCodeLine{00396\ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ strstr(server\_info,\ (\textcolor{keywordtype}{char}*)\mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}}),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00397\ \}}
\DoxyCodeLine{00398\ }
\DoxyCodeLine{00399\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Factory,\ \textcolor{keyword}{typename}\ Client>}
\DoxyCodeLine{00400\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{test__server_8h_a431ae7284f3e7379de7359602054fa75}{VerifyInitialization}}(\ \textcolor{keywordtype}{int}\ n\_thread\ )\ \{}
\DoxyCodeLine{00401\ \ \ \ \ \mbox{\hyperlink{class_client}{Client}}*\ client\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_client}{Client}};}
\DoxyCodeLine{00402\ \ \ \ \ client-\/>initialize(\ Client::is\_omp\ ?\ \mbox{\hyperlink{test__server_8h_af54589088a029b241f655c7d703e3144}{JobArraySize}}\ :\ n\_thread,\ \mbox{\hyperlink{struct_nesting}{Nesting}}(),\ \mbox{\hyperlink{test__server_8h_a5943aadf2fa7d2470ace3a42335129eb}{ClientStackSize}}[0]\ );}
\DoxyCodeLine{00403\ \ \ \ \ Factory\ factory;}
\DoxyCodeLine{00404\ \ \ \ \ memset(\ \&factory,\ 0,\ \textcolor{keyword}{sizeof}(factory)\ );}
\DoxyCodeLine{00405\ \ \ \ \ \textcolor{keyword}{typename}\ Factory::status\_type\ status\ =\ factory.open();}
\DoxyCodeLine{00406\ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ status!=Factory::st\_not\_found,\ \textcolor{stringliteral}{"{}could\ not\ find\ RML\ library"{}}\ );}
\DoxyCodeLine{00407\ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ status!=Factory::st\_incompatible,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00408\ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ status==Factory::st\_success,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00409\ \ \ \ \ factory.call\_with\_server\_info(\ \mbox{\hyperlink{test__server_8h_a0669a5383a414c5fa361eee27f2ff8d2}{check\_server\_info}},\ (\textcolor{keywordtype}{void}*)\textcolor{stringliteral}{"{}Intel(R)\ RML\ library"{}}\ );}
\DoxyCodeLine{00410\ \ \ \ \ \textcolor{keyword}{typename}\ Factory::server\_type*\ server;\ }
\DoxyCodeLine{00411\ \ \ \ \ status\ =\ factory.make\_server(\ server,\ *client\ );}
\DoxyCodeLine{00412\ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ status!=Factory::st\_incompatible,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00413\ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ status!=Factory::st\_not\_found,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00414\ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ status==Factory::st\_success,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00415\ \ \ \ \ \mbox{\hyperlink{harness__report_8h_ace9fba7267bf6a9a92654ce7f25c5516}{REMARK}}(\textcolor{stringliteral}{"{}client\ \%d:\ opened\ server\ n\_thread=\%d\ nesting=(\%d,\%d)\(\backslash\)n"{}},}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ client-\/>client\_id(),\ n\_thread,\ 0,\ 0);}
\DoxyCodeLine{00417\ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ server,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00418\ \ \ \ \ client-\/>set\_server(\ server\ );}
\DoxyCodeLine{00419\ \ \ \ \ \mbox{\hyperlink{test__server_8h_ab30e44fab88eccf77654e3c1cfab793e}{server\_concurrency}}\ =\ server-\/>default\_concurrency();}
\DoxyCodeLine{00420\ }
\DoxyCodeLine{00421\ \ \ \ \ \mbox{\hyperlink{test__rml__omp_8cpp_adab8736799397b0982efc5853fd7391d}{DoClientSpecificVerification}}(\ *server,\ n\_thread\ );}
\DoxyCodeLine{00422\ }
\DoxyCodeLine{00423\ \ \ \ \ \textcolor{comment}{//\ Close\ the\ connection}}
\DoxyCodeLine{00424\ \ \ \ \ client-\/>expect\_close\_connection\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00425\ \ \ \ \ \mbox{\hyperlink{harness__report_8h_ace9fba7267bf6a9a92654ce7f25c5516}{REMARK}}(\textcolor{stringliteral}{"{}client\ \%d:\ calling\ request\_close\_connection\(\backslash\)n"{}},\ client-\/>client\_id());}
\DoxyCodeLine{00426\ \ \ \ \ server-\/>request\_close\_connection();}
\DoxyCodeLine{00427\ \ \ \ \ \textcolor{comment}{//\ Client\ deletes\ itself\ when\ it\ sees\ call\ to\ acknowledge\_close\_connection\ from\ server.}}
\DoxyCodeLine{00428\ \ \ \ \ factory.close();}
\DoxyCodeLine{00429\ \}}

\end{DoxyCode}
