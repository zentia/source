\doxysection{ellen\+\_\+bintree\+\_\+update\+\_\+desc\+\_\+pool.\+h}
\hypertarget{ellen__bintree__update__desc__pool_8h_source}{}\label{ellen__bintree__update__desc__pool_8h_source}\index{external/libcds/test/stress/framework/ellen\_bintree\_update\_desc\_pool.h@{external/libcds/test/stress/framework/ellen\_bintree\_update\_desc\_pool.h}}
\mbox{\hyperlink{ellen__bintree__update__desc__pool_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ (c)\ 2006-\/2018\ Maxim\ Khizhinsky}}
\DoxyCodeLine{00002\ \textcolor{comment}{//}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ Distributed\ under\ the\ Boost\ Software\ License,\ Version\ 1.0.\ (See\ accompanying}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ file\ LICENSE\ or\ copy\ at\ http://www.boost.org/LICENSE\_1\_0.txt)}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#ifndef\ CDSUNIT\_ELLEN\_BINTREE\_UPDATE\_DESC\_POOL\_H}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#define\ CDSUNIT\_ELLEN\_BINTREE\_UPDATE\_DESC\_POOL\_H}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{general__instant_8h}{cds/urcu/general\_instant.h}}>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{container_2details_2ellen__bintree__base_8h}{cds/container/details/ellen\_bintree\_base.h}}>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{vyukov__queue__pool_8h}{cds/memory/vyukov\_queue\_pool.h}}>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{pool__allocator_8h}{cds/memory/pool\_allocator.h}}>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceellen__bintree__pool}{ellen\_bintree\_pool}}\ \{}
\DoxyCodeLine{00016\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{structcds_1_1intrusive_1_1ellen__bintree_1_1node__types}{cds::container::ellen\_bintree::node\_types<\ cds::urcu::gc<\ cds::urcu::general\_instant<>}}\ >,\ \textcolor{keywordtype}{int}\ >\ \mbox{\hyperlink{namespaceellen__bintree__pool_ae9057b4b023b1c6e169293f869fbb9b7}{node\_types}};\ \textcolor{comment}{//\ fake}}
\DoxyCodeLine{00017\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{structcds_1_1intrusive_1_1ellen__bintree_1_1node__types_a7ee74e55aff8387d545483c623cb7664}{node\_types::leaf\_node\_type}}\ \ \ \ \ \mbox{\hyperlink{namespaceellen__bintree__pool_a5eaf0717672e2462d26eadd37b056201}{leaf\_node}};}
\DoxyCodeLine{00018\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{structcds_1_1intrusive_1_1ellen__bintree_1_1node__types_a4b7c455b635fa1ffe6c36dfad0d9a3b1}{node\_types::internal\_node\_type}}\ \mbox{\hyperlink{namespaceellen__bintree__pool_a4803d95a9a31c948f2a4cf14f4a6b979}{internal\_node}};}
\DoxyCodeLine{00019\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{structcds_1_1intrusive_1_1ellen__bintree_1_1node__types_a1b9baf7fd14ef4bef0a417beac10282e}{node\_types::update\_desc\_type}}\ \ \ \mbox{\hyperlink{namespaceellen__bintree__pool_a3dc4be7577e7b5ed21cdb4993275c188}{update\_desc}};}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \ \ \ \ \textcolor{comment}{//\ Update\ descriptor\ pool\ based\ on\ Vyukov's\ queue}}
\DoxyCodeLine{00022\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structellen__bintree__pool_1_1update__desc__pool__traits}{update\_desc\_pool\_traits}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{structcds_1_1memory_1_1vyukov__queue__pool__traits}{cds::memory::vyukov\_queue\_pool\_traits}}}
\DoxyCodeLine{00023\ \ \ \ \ \{}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classcds_1_1opt_1_1v_1_1initialized__static__buffer}{cds::opt::v::initialized\_static\_buffer<\ cds::any\_type,\ 4096\ >}}\ \mbox{\hyperlink{structellen__bintree__pool_1_1update__desc__pool__traits_a9c45173bcf09c5b9075ba44acc4e4a59}{buffer}};}
\DoxyCodeLine{00025\ \ \ \ \ \};}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classcds_1_1memory_1_1vyukov__queue__pool}{cds::memory::vyukov\_queue\_pool<\ update\_desc,\ update\_desc\_pool\_traits\ >}}\ \mbox{\hyperlink{namespaceellen__bintree__pool_a05f844ec5c87f8d3bb62b6b6e4ca5501}{update\_desc\_pool\_type}};}
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{keyword}{extern}\ \mbox{\hyperlink{namespaceellen__bintree__pool_a05f844ec5c87f8d3bb62b6b6e4ca5501}{update\_desc\_pool\_type}}\ \mbox{\hyperlink{namespaceellen__bintree__pool_a68ff438d8d161d658b39a1e5887039a0}{s\_UpdateDescPool}};}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structellen__bintree__pool_1_1update__desc__pool__accessor}{update\_desc\_pool\_accessor}}\ \{}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classcds_1_1memory_1_1vyukov__queue__pool_aeb0c4af604d77e19ea604cc445051148}{update\_desc\_pool\_type::value\_type}}\ \ \ \ \ \mbox{\hyperlink{structellen__bintree__pool_1_1update__desc__pool__accessor_a28c4f82373eda36cd9dbb7a3fd1a34e7}{value\_type}};}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceellen__bintree__pool_a05f844ec5c87f8d3bb62b6b6e4ca5501}{update\_desc\_pool\_type}}\&\ \mbox{\hyperlink{structellen__bintree__pool_1_1update__desc__pool__accessor_aac0149e1da346757208ba4ef5754dfdd}{operator()}}()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00034\ \textcolor{keyword}{\ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespaceellen__bintree__pool_a68ff438d8d161d658b39a1e5887039a0}{s\_UpdateDescPool}};}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00037\ \ \ \ \ \};}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{comment}{//\ Update\ descriptor\ pool\ based\ on\ bounded\ Vyukov's\ queue}}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structellen__bintree__pool_1_1bounded__update__desc__pool__traits}{bounded\_update\_desc\_pool\_traits}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{structcds_1_1memory_1_1vyukov__queue__pool__traits}{cds::memory::vyukov\_queue\_pool\_traits}}}
\DoxyCodeLine{00041\ \ \ \ \ \{}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classcds_1_1opt_1_1v_1_1initialized__static__buffer}{cds::opt::v::initialized\_static\_buffer<\ cds::any\_type,\ 4096\ >}}\ \mbox{\hyperlink{structellen__bintree__pool_1_1bounded__update__desc__pool__traits_abcb60b5b3bc457a4169c5483408d5e63}{buffer}};}
\DoxyCodeLine{00043\ \ \ \ \ \};}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classcds_1_1memory_1_1bounded__vyukov__queue__pool}{cds::memory::bounded\_vyukov\_queue\_pool<\ update\_desc,\ bounded\_update\_desc\_pool\_traits\ >}}\ \mbox{\hyperlink{namespaceellen__bintree__pool_a1ae28cf5234b033dc6e9616f678a0ffc}{bounded\_update\_desc\_pool\_type}};}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keyword}{extern}\ \mbox{\hyperlink{namespaceellen__bintree__pool_a1ae28cf5234b033dc6e9616f678a0ffc}{bounded\_update\_desc\_pool\_type}}\ \mbox{\hyperlink{namespaceellen__bintree__pool_a3a8a247f1493e40aab27a8e908d028ab}{s\_BoundedUpdateDescPool}};}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structellen__bintree__pool_1_1bounded__update__desc__pool__accessor}{bounded\_update\_desc\_pool\_accessor}}\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classcds_1_1memory_1_1bounded__vyukov__queue__pool_a7bf5a4aa73e20b3c5adcaab574452231}{bounded\_update\_desc\_pool\_type::value\_type}}\ \ \ \ \ \mbox{\hyperlink{structellen__bintree__pool_1_1bounded__update__desc__pool__accessor_aa2102e154cb8d5a1fe52af7ecb8548f1}{value\_type}};}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceellen__bintree__pool_a1ae28cf5234b033dc6e9616f678a0ffc}{bounded\_update\_desc\_pool\_type}}\&\ \mbox{\hyperlink{structellen__bintree__pool_1_1bounded__update__desc__pool__accessor_a7fb532fb577d7e3e3eebc867f6a2057c}{operator()}}()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00051\ \textcolor{keyword}{\ \ \ \ \ \ \ \ }\{}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespaceellen__bintree__pool_a3a8a247f1493e40aab27a8e908d028ab}{s\_BoundedUpdateDescPool}};}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00054\ \ \ \ \ \};}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{comment}{//\ Internal\ node\ allocator}}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structellen__bintree__pool_1_1internal__node__counter}{internal\_node\_counter}}}
\DoxyCodeLine{00059\ \ \ \ \ \{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classcds_1_1atomicity_1_1event__counter}{cds::atomicity::event\_counter}}\ \ \ \mbox{\hyperlink{structellen__bintree__pool_1_1internal__node__counter_a662a184bfa9e5387ab3223f81904ea03}{m\_nAlloc}};}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classcds_1_1atomicity_1_1event__counter}{cds::atomicity::event\_counter}}\ \ \ \mbox{\hyperlink{structellen__bintree__pool_1_1internal__node__counter_a1bc8369f5097950e9a0e5fee4410c99b}{m\_nFree}};}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structellen__bintree__pool_1_1internal__node__counter_aa94aa510cb63c2aaf4ef65fc2382b2c2}{onAlloc}}()}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ ++\mbox{\hyperlink{structellen__bintree__pool_1_1internal__node__counter_a662a184bfa9e5387ab3223f81904ea03}{m\_nAlloc}};}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structellen__bintree__pool_1_1internal__node__counter_af061b3d835f3e53db5154a55f9b0bc6e}{onFree}}()}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ ++\mbox{\hyperlink{structellen__bintree__pool_1_1internal__node__counter_a1bc8369f5097950e9a0e5fee4410c99b}{m\_nFree}};}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structellen__bintree__pool_1_1internal__node__counter_ac3c6508187cb847ea88a2ee0a59c4ee4}{reset}}()}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structellen__bintree__pool_1_1internal__node__counter_a662a184bfa9e5387ab3223f81904ea03}{m\_nAlloc}}.reset();}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structellen__bintree__pool_1_1internal__node__counter_a1bc8369f5097950e9a0e5fee4410c99b}{m\_nFree}}.reset();}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00077\ \ \ \ \ \};}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ Alloc\ =\ CDS\_DEFAULT\_ALLOCATOR>}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classellen__bintree__pool_1_1internal__node__allocator}{internal\_node\_allocator}}}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ :\ \textcolor{keyword}{public}\ std::allocator\_traits<Alloc>::template\ rebind\_alloc<\ T\ >}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ ,\ \mbox{\hyperlink{structellen__bintree__pool_1_1internal__node__counter}{internal\_node\_counter}}}
\DoxyCodeLine{00083\ \ \ \ \ \{}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ std::allocator\_traits<Alloc>::template\ rebind\_alloc<\ T\ >\ \mbox{\hyperlink{classellen__bintree__pool_1_1internal__node__allocator_a7691e5696b3bffb2497f9400ab5747ee}{base\_class}};}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Other>}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structellen__bintree__pool_1_1internal__node__allocator_1_1rebind}{rebind}}\ \{}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classellen__bintree__pool_1_1internal__node__allocator}{internal\_node\_allocator<\ Other,\ Alloc\ >}}\ \mbox{\hyperlink{structellen__bintree__pool_1_1internal__node__allocator_1_1rebind_a00c9124bc63d2a11ac0d8ef1a744c3e7}{other}};}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ *\ \mbox{\hyperlink{classellen__bintree__pool_1_1internal__node__allocator_ab369d514349064f6dcece2d96c8e6787}{allocate}}(\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}},\ \textcolor{keywordtype}{void}\ \textcolor{keyword}{const}\ *\ pHint\ =\ \textcolor{keyword}{nullptr}\ )}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structellen__bintree__pool_1_1internal__node__counter_aa94aa510cb63c2aaf4ef65fc2382b2c2}{internal\_node\_counter::onAlloc}}();}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ *\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ std::allocator\_traits<base\_class>::allocate(\ *\textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classellen__bintree__pool_1_1internal__node__allocator_a7691e5696b3bffb2497f9400ab5747ee}{base\_class}}*\textcolor{keyword}{>}(\ \textcolor{keyword}{this}\ ),\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}},\ pHint\ );}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}};}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classellen__bintree__pool_1_1internal__node__allocator_a5aad2773283beb913b4d27af0c253023}{deallocate}}(\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ *\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ )}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structellen__bintree__pool_1_1internal__node__counter_af061b3d835f3e53db5154a55f9b0bc6e}{internal\_node\_counter::onFree}}();}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \ \ \ \ std::allocator\_traits<base\_class>::deallocate(\ *\textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classellen__bintree__pool_1_1internal__node__allocator_a7691e5696b3bffb2497f9400ab5747ee}{base\_class}}*\textcolor{keyword}{>}(\ \textcolor{keyword}{this}\ ),\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ );}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00103\ \ \ \ \ \};}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \}\ \textcolor{comment}{//\ namespace\ ellen\_bintree\_pool}}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ \#ifndef\ CDSUNIT\_ELLEN\_BINTREE\_UPDATE\_DESC\_POOL\_H}}

\end{DoxyCode}
