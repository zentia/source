\doxysection{market.\+cpp}
\hypertarget{market_8cpp_source}{}\label{market_8cpp_source}\index{external/taskflow/3rd-\/party/tbb/src/tbb/market.cpp@{external/taskflow/3rd-\/party/tbb/src/tbb/market.cpp}}
\mbox{\hyperlink{market_8cpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ \ \ \ Copyright\ (c)\ 2005-\/2020\ Intel\ Corporation}}
\DoxyCodeLine{00003\ \textcolor{comment}{}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ \ \ \ Licensed\ under\ the\ Apache\ License,\ Version\ 2.0\ (the\ "{}License"{});}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ \ \ \ you\ may\ not\ use\ this\ file\ except\ in\ compliance\ with\ the\ License.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ \ \ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00007\ \textcolor{comment}{}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ \ \ \ \ \ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00009\ \textcolor{comment}{}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ \ \ \ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,\ software}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ \ \ \ distributed\ under\ the\ License\ is\ distributed\ on\ an\ "{}AS\ IS"{}\ BASIS,}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ \ \ \ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY\ KIND,\ either\ express\ or\ implied.}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ \ \ \ See\ the\ License\ for\ the\ specific\ language\ governing\ permissions\ and}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ \ \ \ limitations\ under\ the\ License.}}
\DoxyCodeLine{00015\ \textcolor{comment}{*/}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tbb__stddef_8h}{tbb/tbb\_stddef.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{global__control_8h}{tbb/global\_control.h}}"{}}\ \textcolor{comment}{//\ global\_control::active\_value}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{market_8h}{market.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tbb__main_8h}{tbb\_main.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{governor_8h}{governor.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{scheduler_8h}{scheduler.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{itt__notify_8h}{itt\_notify.h}}"{}}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetbb}{tbb}}\ \{}
\DoxyCodeLine{00027\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetbb_1_1internal}{internal}}\ \{}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a829b50e27820a2ecb57067b0d8147422}{market::insert\_arena\_into\_list}}\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adc288c92e3de5dd87e56ab61885cf63e}{arena}}\&\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ )\ \{}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_PRIORITY}}
\DoxyCodeLine{00031\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a1e16d59c635a7c825700c682f0d6392e}{arena\_list\_type}}\ \&arenas\ =\ my\_priority\_levels[\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_top\_priority].arenas;}
\DoxyCodeLine{00032\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adc288c92e3de5dd87e56ab61885cf63e}{arena}}\ *\&next\ =\ my\_priority\_levels[\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_top\_priority].next\_arena;}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#else\ }\textcolor{comment}{/*\ !\_\_TBB\_TASK\_PRIORITY\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00034\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a1e16d59c635a7c825700c682f0d6392e}{arena\_list\_type}}\ \&arenas\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_aab9e3f5ceeb9189ea960798fa472db7f}{my\_arenas}};}
\DoxyCodeLine{00035\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adc288c92e3de5dd87e56ab61885cf63e}{arena}}\ *\&next\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_afe6b17aefb399a82440951f14f70884b}{my\_next\_arena}};}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ !\_\_TBB\_TASK\_PRIORITY\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00037\ \ \ \ \ arenas.\mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_ae828e0c3fb139491fd633152cbf6140a}{push\_front}}(\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ );}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ arenas.\mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_ac2d9912b3562b598099aee949b8c7c4b}{size}}()\ ==\ 1\ )}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ next\ =\ \&*arenas.\mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_a27a1cf03b6f163c2835d861fc6519aba}{begin}}();}
\DoxyCodeLine{00040\ \}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a9f3b90e1f82aff92b8493b78a909d434}{market::remove\_arena\_from\_list}}\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adc288c92e3de5dd87e56ab61885cf63e}{arena}}\&\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ )\ \{}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_PRIORITY}}
\DoxyCodeLine{00044\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a1e16d59c635a7c825700c682f0d6392e}{arena\_list\_type}}\ \&arenas\ =\ my\_priority\_levels[\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_top\_priority].arenas;}
\DoxyCodeLine{00045\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adc288c92e3de5dd87e56ab61885cf63e}{arena}}\ *\&next\ =\ my\_priority\_levels[\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_top\_priority].next\_arena;}
\DoxyCodeLine{00046\ \textcolor{preprocessor}{\#else\ }\textcolor{comment}{/*\ !\_\_TBB\_TASK\_PRIORITY\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00047\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a1e16d59c635a7c825700c682f0d6392e}{arena\_list\_type}}\ \&arenas\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_aab9e3f5ceeb9189ea960798fa472db7f}{my\_arenas}};}
\DoxyCodeLine{00048\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adc288c92e3de5dd87e56ab61885cf63e}{arena}}\ *\&next\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_afe6b17aefb399a82440951f14f70884b}{my\_next\_arena}};}
\DoxyCodeLine{00049\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ !\_\_TBB\_TASK\_PRIORITY\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00050\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_a2ad160b840dca6434996b97306ab03dd}{arena\_list\_type::iterator}}\ it\ =\ next;}
\DoxyCodeLine{00051\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ it\ !=\ arenas.\mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_a61fa0658a500c11ff2cdf4c294c33e97}{end}}(),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ next\ ==\ \&\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ )\ \{}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ ++it\ ==\ arenas.\mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_a61fa0658a500c11ff2cdf4c294c33e97}{end}}()\ \&\&\ arenas.\mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_ac2d9912b3562b598099aee949b8c7c4b}{size}}()\ >\ 1\ )}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ it\ =\ arenas.\mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_a27a1cf03b6f163c2835d861fc6519aba}{begin}}();}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ next\ =\ \&*it;}
\DoxyCodeLine{00056\ \ \ \ \ \}}
\DoxyCodeLine{00057\ \ \ \ \ arenas.\mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_a578b02d9d632a423471e3574edf8c315}{remove}}(\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ );}
\DoxyCodeLine{00058\ \}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00061\ \textcolor{comment}{//\ market}}
\DoxyCodeLine{00062\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_acdbf87ad0efe5f3e224d88ecb2536e93}{market::market}}\ (\ \textcolor{keywordtype}{unsigned}\ workers\_soft\_limit,\ \textcolor{keywordtype}{unsigned}\ workers\_hard\_limit,\ \textcolor{keywordtype}{size\_t}\ stack\_size\ )}
\DoxyCodeLine{00065\ \ \ \ \ :\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a0e2353e9048c25db08e639869694a0a5}{my\_num\_workers\_hard\_limit}}(workers\_hard\_limit)}
\DoxyCodeLine{00066\ \ \ \ \ ,\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae6f56dc7b83aaa5e44a52d5aa1685193}{my\_num\_workers\_soft\_limit}}(workers\_soft\_limit)}
\DoxyCodeLine{00067\ \#\mbox{\hyperlink{sugar_8h_a89d24c74d8a8669b882cd54e44029c98}{if}}\ \mbox{\hyperlink{tbb__config_8h_a4e0e73b2cc4af78992c895c2aae72c5c}{\_\_TBB\_TASK\_PRIORITY}}}
\DoxyCodeLine{00068\ \ \ \ \ ,\ my\_global\_top\_priority(normalized\_normal\_priority)}
\DoxyCodeLine{00069\ \ \ \ \ ,\ my\_global\_bottom\_priority(normalized\_normal\_priority)}
\DoxyCodeLine{00070\ \#endif\ \textcolor{comment}{/*\ \_\_TBB\_TASK\_PRIORITY\ */}}
\DoxyCodeLine{00071\ \ \ \ \ ,\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_acc6123ee9f177debfe705b53e509220e}{my\_ref\_count}}(1)}
\DoxyCodeLine{00072\ \ \ \ \ ,\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ad2e4a6ecf43c20e6171b0de586912957}{my\_stack\_size}}(stack\_size)}
\DoxyCodeLine{00073\ \ \ \ \ ,\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_abd198eefc75453a31fc994e0f7c18103}{my\_workers\_soft\_limit\_to\_report}}(workers\_soft\_limit)}
\DoxyCodeLine{00074\ \{}
\DoxyCodeLine{00075\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_PRIORITY}}
\DoxyCodeLine{00076\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ my\_global\_reload\_epoch\ ==\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00077\ \ \ \ \ my\_priority\_levels[normalized\_normal\_priority].workers\_available\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae6f56dc7b83aaa5e44a52d5aa1685193}{my\_num\_workers\_soft\_limit}};}
\DoxyCodeLine{00078\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_PRIORITY\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{comment}{//\ Once\ created\ RML\ server\ will\ start\ initializing\ workers\ that\ will\ need}}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{comment}{//\ global\ market\ instance\ to\ get\ worker\ stack\ size}}
\DoxyCodeLine{00082\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_af7429d97c388e8adcbf37fcdbf64c075}{my\_server}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_aec70bdc2a20ee8377a1676dd3b4c843b}{governor::create\_rml\_server}}(\ *\textcolor{keyword}{this}\ );}
\DoxyCodeLine{00083\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_af7429d97c388e8adcbf37fcdbf64c075}{my\_server}},\ \textcolor{stringliteral}{"{}Failed\ to\ create\ RML\ server"{}}\ );}
\DoxyCodeLine{00084\ \}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{namespacetbb_1_1internal_aa59c19a68c963626ba810d72317f0d18}{calc\_workers\_soft\_limit}}(\textcolor{keywordtype}{unsigned}\ workers\_soft\_limit,\ \textcolor{keywordtype}{unsigned}\ workers\_hard\_limit)\ \{}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keywordflow}{if}(\ \textcolor{keywordtype}{int}\ soft\_limit\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a857327e374da8c7bb5c4b529aca05405}{market::app\_parallelism\_limit}}()\ )}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ workers\_soft\_limit\ =\ soft\_limit-\/1;}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ if\ user\ set\ no\ limits\ (yet),\ use\ market's\ parameter}}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ workers\_soft\_limit\ =\ \mbox{\hyperlink{datatypes_8h_affe776513b24d84b39af8ab0930fef7f}{max}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_a87ef607c22c347eb97ddafa4384b4f1d}{governor::default\_num\_threads}}()\ -\/\ 1,\ workers\_soft\_limit\ );}
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordflow}{if}(\ workers\_soft\_limit\ >=\ workers\_hard\_limit\ )}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ workers\_soft\_limit\ =\ workers\_hard\_limit-\/1;}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordflow}{return}\ workers\_soft\_limit;}
\DoxyCodeLine{00094\ \}}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_acdbf87ad0efe5f3e224d88ecb2536e93}{market}}\&\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a08ccaf89d501a9e56912eb5bd624066f}{market::global\_market}}\ (\ \textcolor{keywordtype}{bool}\ is\_public,\ \textcolor{keywordtype}{unsigned}\ workers\_requested,\ \textcolor{keywordtype}{size\_t}\ stack\_size\ )\ \{}
\DoxyCodeLine{00097\ \ \ \ \ global\_market\_mutex\_type::scoped\_lock\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae4ba85f7230a2668979009bf3b29df39}{theMarketMutex}}\ );}
\DoxyCodeLine{00098\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_acdbf87ad0efe5f3e224d88ecb2536e93}{market}}\ *\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a1dbc378b5e39901f1c11f2021b35688c}{theMarket}};}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}\ )\ \{}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ ++\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>my\_ref\_count;}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ old\_public\_count\ =\ is\_public?\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>my\_public\_ref\_count++\ :\ \textcolor{comment}{/*any\ non-\/zero\ value*/}1;}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}.release();}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ old\_public\_count==0\ )}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a50bb92619e74a81b3f8552ccca139c9f}{set\_active\_num\_workers}}(\ \mbox{\hyperlink{namespacetbb_1_1internal_aa59c19a68c963626ba810d72317f0d18}{calc\_workers\_soft\_limit}}(workers\_requested,\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>my\_num\_workers\_hard\_limit)\ );}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ do\ not\ warn\ if\ default\ number\ of\ workers\ is\ requested}}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ workers\_requested\ !=\ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_a87ef607c22c347eb97ddafa4384b4f1d}{governor::default\_num\_threads}}()-\/1\ )\ \{}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a4a7383505d411e8ecbd3b9fd6b90170e}{skip\_soft\_limit\_warning}}\ >\ workers\_requested,}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}skip\_soft\_limit\_warning\ must\ be\ larger\ than\ any\ valid\ workers\_requested"{}}\ );}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ soft\_limit\_to\_report\ =\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>my\_workers\_soft\_limit\_to\_report;}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ soft\_limit\_to\_report\ <\ workers\_requested\ )\ \{}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__concurrent__hash__map_8cpp_a7de19b53af11a9175c96b42320b1d082}{runtime\_warning}}(\ \textcolor{stringliteral}{"{}The\ number\ of\ workers\ is\ currently\ limited\ to\ \%u.\ "{}}}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}The\ request\ for\ \%u\ workers\ is\ ignored.\ Further\ requests\ for\ more\ workers\ "{}}}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}will\ be\ silently\ ignored\ until\ the\ limit\ changes.\(\backslash\)n"{}},}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ soft\_limit\_to\_report,\ workers\_requested\ );}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ race\ is\ possible\ when\ multiple\ threads\ report\ warnings.}}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ are\ OK\ with\ that,\ as\ there\ are\ just\ multiple\ warnings.}}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a958f482f9d5f3476ca70610af5336040}{internal::as\_atomic}}(\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>my\_workers\_soft\_limit\_to\_report).}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ compare\_and\_swap(\mbox{\hyperlink{classtbb_1_1internal_1_1market_a4a7383505d411e8ecbd3b9fd6b90170e}{skip\_soft\_limit\_warning}},\ soft\_limit\_to\_report);}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>my\_stack\_size\ <\ stack\_size\ )}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__concurrent__hash__map_8cpp_a7de19b53af11a9175c96b42320b1d082}{runtime\_warning}}(\ \textcolor{stringliteral}{"{}Thread\ stack\ size\ has\ been\ already\ set\ to\ \%u.\ "{}}}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}The\ request\ for\ larger\ stack\ (\%u)\ cannot\ be\ satisfied.\(\backslash\)n"{}},}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>my\_stack\_size,\ stack\_size\ );}
\DoxyCodeLine{00127\ \ \ \ \ \}}
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ A\ lot\ is\ done\ under\ theMarketMutex\ locked.\ Can\ anything\ be\ moved\ out?}}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ stack\_size\ ==\ 0\ )}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ stack\_size\ =\ \mbox{\hyperlink{classtbb_1_1global__control_a8451d931cfc205d896ca2da26fe123ff}{global\_control::active\_value}}(\mbox{\hyperlink{classtbb_1_1global__control_a04221b8e619bef332234db90d31f3e5eabbf02a674a9e7175b8038166c5d47a12}{global\_control::thread\_stack\_size}});}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Expecting\ that\ 4P\ is\ suitable\ for\ most\ applications.}}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Limit\ to\ 2P\ for\ large\ thread\ number.}}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ ask\ RML\ for\ max\ concurrency\ and\ possibly\ correct\ hard\_limit}}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{fft_8c_a13b942e46c2348d4cfe7bced3e905d1d}{factor}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_a87ef607c22c347eb97ddafa4384b4f1d}{governor::default\_num\_threads}}()<=128?\ 4\ :\ 2;}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ requested\ number\ of\ threads\ is\ intentionally\ not\ considered\ in}}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ computation\ of\ the\ hard\ limit,\ in\ order\ to\ separate\ responsibilities}}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ and\ avoid\ complicated\ interactions\ between\ global\_control\ and\ task\_scheduler\_init.}}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ market\ guarantees\ that\ at\ least\ 256\ threads\ might\ be\ created.}}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ workers\_hard\_limit\ =\ \mbox{\hyperlink{datatypes_8h_affe776513b24d84b39af8ab0930fef7f}{max}}(\mbox{\hyperlink{datatypes_8h_affe776513b24d84b39af8ab0930fef7f}{max}}(\mbox{\hyperlink{fft_8c_a13b942e46c2348d4cfe7bced3e905d1d}{factor}}*\mbox{\hyperlink{classtbb_1_1internal_1_1governor_a87ef607c22c347eb97ddafa4384b4f1d}{governor::default\_num\_threads}}(),\ 256u),\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a857327e374da8c7bb5c4b529aca05405}{app\_parallelism\_limit}}());}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ workers\_soft\_limit\ =\ \mbox{\hyperlink{namespacetbb_1_1internal_aa59c19a68c963626ba810d72317f0d18}{calc\_workers\_soft\_limit}}(workers\_requested,\ workers\_hard\_limit);}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ the\ global\ market\ instance}}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}}\ =\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{classtbb_1_1internal_1_1market_acdbf87ad0efe5f3e224d88ecb2536e93}{market}});}
\DoxyCodeLine{00144\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_GROUP\_CONTEXT}}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \_\_TBB\_offsetof(\mbox{\hyperlink{classtbb_1_1internal_1_1market_acdbf87ad0efe5f3e224d88ecb2536e93}{market}},\ my\_workers)\ +\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{classtbb_1_1internal_1_1market_a9acd4f7b134e3bcd5625ce386ec7db60}{generic\_scheduler}}*)\ ==\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{classtbb_1_1internal_1_1market_acdbf87ad0efe5f3e224d88ecb2536e93}{market}}),}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}my\_workers\ must\ be\ the\ last\ data\ field\ of\ the\ market\ class"{}});}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}}\ +=\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{classtbb_1_1internal_1_1market_a9acd4f7b134e3bcd5625ce386ec7db60}{generic\_scheduler}}*)\ *\ (workers\_hard\_limit\ -\/\ 1);}
\DoxyCodeLine{00148\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_GROUP\_CONTEXT\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1_____t_b_b___init_once_aeb552d69cd0db07e0ec3526c22e8899a}{\_\_TBB\_InitOnce::add\_ref}}();}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ storage\ =\ \mbox{\hyperlink{namespacetbb_1_1internal_a395611542e21705f49de2a06e2c88f59}{NFS\_Allocate}}(1,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ memset(\ storage,\ 0,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}}\ );}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Initialize\ and\ publish\ global\ market}}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}\ =\ \textcolor{keyword}{new}\ (storage)\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_acdbf87ad0efe5f3e224d88ecb2536e93}{market}}(\ workers\_soft\_limit,\ workers\_hard\_limit,\ stack\_size\ );}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ is\_public\ )}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>my\_public\_ref\_count\ =\ 1;}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a1dbc378b5e39901f1c11f2021b35688c}{theMarket}}\ =\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}};}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ check\ relies\ on\ the\ fact\ that\ for\ shared\ RML\ default\_concurrency==max\_concurrency}}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\mbox{\hyperlink{classtbb_1_1internal_1_1governor_ad0227786c18290c2822bf2886ffc3c3c}{governor::UsePrivateRML}}\ \&\&\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>my\_server-\/>default\_concurrency()\ <\ workers\_soft\_limit\ )}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__concurrent__hash__map_8cpp_a7de19b53af11a9175c96b42320b1d082}{runtime\_warning}}(\ \textcolor{stringliteral}{"{}RML\ might\ limit\ the\ number\ of\ workers\ to\ \%u\ while\ \%u\ is\ requested.\(\backslash\)n"{}}}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ,\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>my\_server-\/>default\_concurrency(),\ workers\_soft\_limit\ );}
\DoxyCodeLine{00161\ \ \ \ \ \}}
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{keywordflow}{return}\ *\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}};}
\DoxyCodeLine{00163\ \}}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a5ca285e2d383ecaf3ff0460b30a3551e}{market::destroy}}\ ()\ \{}
\DoxyCodeLine{00166\ \textcolor{preprocessor}{\#if\ \_\_TBB\_COUNT\_TASK\_NODES}}
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ my\_task\_node\_count\ )}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__concurrent__hash__map_8cpp_a7de19b53af11a9175c96b42320b1d082}{runtime\_warning}}(\ \textcolor{stringliteral}{"{}Leaked\ \%ld\ task\ objects\(\backslash\)n"{}},\ (\textcolor{keywordtype}{long})my\_task\_node\_count\ );}
\DoxyCodeLine{00169\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_COUNT\_TASK\_NODES\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00170\ \ \ \ \ this-\/>market::\string~market();\ \textcolor{comment}{//\ qualified\ to\ suppress\ warning}}
\DoxyCodeLine{00171\ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_abd3fdd42ea716867fc95116354481b4e}{NFS\_Free}}(\ \textcolor{keyword}{this}\ );}
\DoxyCodeLine{00172\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1_____t_b_b___init_once_a78b2b1b7265cdedc9ea3689fff04ac35}{\_\_TBB\_InitOnce::remove\_ref}}();}
\DoxyCodeLine{00173\ \}}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a76b1783a39252c34da34d0cebfe101b5}{market::release}}\ (\ \textcolor{keywordtype}{bool}\ is\_public,\ \textcolor{keywordtype}{bool}\ blocking\_terminate\ )\ \{}
\DoxyCodeLine{00176\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a1dbc378b5e39901f1c11f2021b35688c}{theMarket}}\ ==\ \textcolor{keyword}{this},\ \textcolor{stringliteral}{"{}Global\ market\ instance\ was\ destroyed\ prematurely?"{}}\ );}
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{keywordtype}{bool}\ do\_release\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00178\ \ \ \ \ \{}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ global\_market\_mutex\_type::scoped\_lock\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae4ba85f7230a2668979009bf3b29df39}{theMarketMutex}}\ );}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ blocking\_terminate\ )\ \{}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ is\_public,\ \textcolor{stringliteral}{"{}Only\ an\ object\ with\ a\ public\ reference\ can\ request\ the\ blocking\ terminate"{}}\ );}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a3ec107af897da09a5d400c63f0c8d866}{my\_public\_ref\_count}}\ ==\ 1\ \&\&\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_acc6123ee9f177debfe705b53e509220e}{my\_ref\_count}}\ >\ 1\ )\ \{}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}.release();}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ To\ guarantee\ that\ request\_close\_connection()\ is\ called\ by\ the\ last\ master,\ we\ need\ to\ wait\ till\ all}}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ references\ are\ released.\ Re-\/read\ my\_public\_ref\_count\ to\ limit\ waiting\ if\ new\ masters\ are\ created.}}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Theoretically,\ new\ private\ references\ to\ the\ market\ can\ be\ added\ during\ waiting\ making\ it\ potentially}}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ endless.}}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ revise\ why\ the\ weak\ scheduler\ needs\ market's\ pointer\ and\ try\ to\ remove\ this\ wait.}}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Note\ that\ the\ market\ should\ know\ about\ its\ schedulers\ for\ cancellation/exception/priority\ propagation,}}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ see\ e.g.\ task\_group\_context::cancel\_group\_execution()}}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\ \_\_TBB\_load\_with\_acquire(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a3ec107af897da09a5d400c63f0c8d866}{my\_public\_ref\_count}}\ )\ ==\ 1\ \&\&\ \_\_TBB\_load\_with\_acquire(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_acc6123ee9f177debfe705b53e509220e}{my\_ref\_count}}\ )\ >\ 1\ )}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ibm__aix51_8h_a2b17e6e4504bddf60a920f609fc46ea6}{\_\_TBB\_Yield}}();}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}.acquire(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae4ba85f7230a2668979009bf3b29df39}{theMarketMutex}}\ );}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ is\_public\ )\ \{}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a1dbc378b5e39901f1c11f2021b35688c}{theMarket}}\ ==\ \textcolor{keyword}{this},\ \textcolor{stringliteral}{"{}Global\ market\ instance\ was\ destroyed\ prematurely?"{}}\ );}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a3ec107af897da09a5d400c63f0c8d866}{my\_public\_ref\_count}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/\mbox{\hyperlink{classtbb_1_1internal_1_1market_a3ec107af897da09a5d400c63f0c8d866}{my\_public\_ref\_count}};}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ -\/-\/\mbox{\hyperlink{classtbb_1_1internal_1_1market_acc6123ee9f177debfe705b53e509220e}{my\_ref\_count}}\ ==\ 0\ )\ \{}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\mbox{\hyperlink{classtbb_1_1internal_1_1market_a3ec107af897da09a5d400c63f0c8d866}{my\_public\_ref\_count}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ do\_release\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a1dbc378b5e39901f1c11f2021b35688c}{theMarket}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00206\ \ \ \ \ \}}
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{keywordflow}{if}(\ do\_release\ )\ \{}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\_\_TBB\_load\_with\_acquire(\mbox{\hyperlink{classtbb_1_1internal_1_1market_a3ec107af897da09a5d400c63f0c8d866}{my\_public\_ref\_count}}),\ \textcolor{stringliteral}{"{}No\ public\ references\ remain\ if\ we\ remove\ the\ market."{}}\ );}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ inform\ RML\ that\ blocking\ termination\ is\ required}}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a2fe7f13bbfeb7da913dae45a996eecb7}{my\_join\_workers}}\ =\ blocking\_terminate;}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_af7429d97c388e8adcbf37fcdbf64c075}{my\_server}}-\/>request\_close\_connection();}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ blocking\_terminate;}
\DoxyCodeLine{00213\ \ \ \ \ \}}
\DoxyCodeLine{00214\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00215\ \}}
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00217\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a61e46dcffd92e6d8bae0337f258112fa}{market::update\_workers\_request}}()\ \{}
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{keywordtype}{int}\ old\_request\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a91c485f06e84cd7c8f357ac2653c0425}{my\_num\_workers\_requested}};}
\DoxyCodeLine{00219\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a91c485f06e84cd7c8f357ac2653c0425}{my\_num\_workers\_requested}}\ =\ \mbox{\hyperlink{datatypes_8h_ac6afabdc09a49a433ee19d8a9486056d}{min}}(\mbox{\hyperlink{classtbb_1_1internal_1_1market_ac358959b1d07ef2051827926643bfd26}{my\_total\_demand}},\ (\textcolor{keywordtype}{int})\mbox{\hyperlink{classtbb_1_1internal_1_1market_ae6f56dc7b83aaa5e44a52d5aa1685193}{my\_num\_workers\_soft\_limit}});}
\DoxyCodeLine{00220\ \textcolor{preprocessor}{\#if\ \_\_TBB\_ENQUEUE\_ENFORCED\_CONCURRENCY}}
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{keywordflow}{if}\ (my\_mandatory\_num\_requested\ >\ 0)\ \{}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\mbox{\hyperlink{classtbb_1_1internal_1_1market_ae6f56dc7b83aaa5e44a52d5aa1685193}{my\_num\_workers\_soft\_limit}}\ ==\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a91c485f06e84cd7c8f357ac2653c0425}{my\_num\_workers\_requested}}\ =\ 1;}
\DoxyCodeLine{00224\ \ \ \ \ \}}
\DoxyCodeLine{00225\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00226\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_PRIORITY}}
\DoxyCodeLine{00227\ \ \ \ \ my\_priority\_levels[my\_global\_top\_priority].workers\_available\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a91c485f06e84cd7c8f357ac2653c0425}{my\_num\_workers\_requested}};}
\DoxyCodeLine{00228\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae02e2394f18a6c25a022fa44be65d317}{update\_allotment}}(my\_global\_top\_priority);}
\DoxyCodeLine{00229\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00230\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae02e2394f18a6c25a022fa44be65d317}{update\_allotment}}(\mbox{\hyperlink{classtbb_1_1internal_1_1market_a91c485f06e84cd7c8f357ac2653c0425}{my\_num\_workers\_requested}});}
\DoxyCodeLine{00231\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00232\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a91c485f06e84cd7c8f357ac2653c0425}{my\_num\_workers\_requested}}\ -\/\ old\_request;}
\DoxyCodeLine{00233\ \}}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a50bb92619e74a81b3f8552ccca139c9f}{market::set\_active\_num\_workers}}\ (\ \textcolor{keywordtype}{unsigned}\ soft\_limit\ )\ \{}
\DoxyCodeLine{00236\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_acdbf87ad0efe5f3e224d88ecb2536e93}{market}}\ *\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}};}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \ \ \ \ \{}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ global\_market\_mutex\_type::scoped\_lock\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae4ba85f7230a2668979009bf3b29df39}{theMarketMutex}}\ );}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\mbox{\hyperlink{classtbb_1_1internal_1_1market_a1dbc378b5e39901f1c11f2021b35688c}{theMarket}}\ )}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ actual\ value\ will\ be\ used\ at\ market\ creation}}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a1dbc378b5e39901f1c11f2021b35688c}{theMarket}};}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>my\_num\_workers\_soft\_limit\ ==\ soft\_limit)}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ ++\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>my\_ref\_count;}
\DoxyCodeLine{00246\ \ \ \ \ \}}
\DoxyCodeLine{00247\ \ \ \ \ \textcolor{comment}{//\ have\ my\_ref\_count\ for\ market,\ use\ it\ safely}}
\DoxyCodeLine{00248\ }
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{keywordtype}{int}\ delta\ =\ 0;}
\DoxyCodeLine{00250\ \ \ \ \ \{}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1spin__rw__mutex_1_1scoped__lock}{arenas\_list\_mutex\_type::scoped\_lock}}\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>my\_arenas\_list\_mutex\ );}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(soft\_limit\ <=\ m-\/>\mbox{\hyperlink{classtbb_1_1internal_1_1market_a0e2353e9048c25db08e639869694a0a5}{my\_num\_workers\_hard\_limit}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ \textcolor{preprocessor}{\#if\ \_\_TBB\_ENQUEUE\_ENFORCED\_CONCURRENCY}}
\DoxyCodeLine{00255\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_PRIORITY}}
\DoxyCodeLine{00256\ \textcolor{preprocessor}{\#define\ FOR\_EACH\_PRIORITY\_LEVEL\_BEGIN\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00257\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ for\ (int\ p\ =\ m-\/>my\_global\_top\_priority;\ p\ >=\ m-\/>my\_global\_bottom\_priority;\ -\/-\/p)\ \{\ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00258\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ priority\_level\_info\&\ pl\ =\ m-\/>my\_priority\_levels[p];\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00259\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ arena\_list\_type\&\ arenas\ =\ pl.arenas;}}
\DoxyCodeLine{00260\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00261\ \textcolor{preprocessor}{\#define\ FOR\_EACH\_PRIORITY\_LEVEL\_BEGIN\ \{\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00262\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ const\ int\ p\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00263\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ tbb::internal::suppress\_unused\_warning(p);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00264\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ arena\_list\_type\&\ arenas\ =\ m-\/>my\_arenas;}}
\DoxyCodeLine{00265\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00266\ \textcolor{preprocessor}{\#define\ FOR\_EACH\_PRIORITY\_LEVEL\_END\ \}\ \}}}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>my\_num\_workers\_soft\_limit\ ==\ 0\ \&\&\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>my\_mandatory\_num\_requested\ >\ 0)\ \{}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ \ \ FOR\_EACH\_PRIORITY\_LEVEL\_BEGIN}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_a2ad160b840dca6434996b97306ab03dd}{arena\_list\_type::iterator}}\ it\ =\ arenas.begin();\ it\ !=\ arenas.end();\ ++it)}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it-\/>my\_global\_concurrency\_mode)}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>disable\_mandatory\_concurrency\_impl(\&*it);}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ \ \ FOR\_EACH\_PRIORITY\_LEVEL\_END}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>my\_mandatory\_num\_requested\ ==\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00276\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00277\ }
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a958f482f9d5f3476ca70610af5336040}{as\_atomic}}(\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>my\_num\_workers\_soft\_limit)\ =\ soft\_limit;}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ report\ only\ once\ after\ new\ soft\ limit\ value\ is\ set}}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>my\_workers\_soft\_limit\_to\_report\ =\ soft\_limit;}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ \textcolor{preprocessor}{\#if\ \_\_TBB\_ENQUEUE\_ENFORCED\_CONCURRENCY}}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>my\_num\_workers\_soft\_limit\ ==\ 0)\ \{}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ \ \ FOR\_EACH\_PRIORITY\_LEVEL\_BEGIN}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_a2ad160b840dca6434996b97306ab03dd}{arena\_list\_type::iterator}}\ it\ =\ arenas.begin();\ it\ !=\ arenas.end();\ ++it)\ \{}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!it-\/>my\_task\_stream.empty(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}))}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>enable\_mandatory\_concurrency\_impl(\&*it);}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ FOR\_EACH\_PRIORITY\_LEVEL\_END}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00291\ \textcolor{preprocessor}{\#undef\ FOR\_EACH\_PRIORITY\_LEVEL\_BEGIN}}
\DoxyCodeLine{00292\ \textcolor{preprocessor}{\#undef\ FOR\_EACH\_PRIORITY\_LEVEL\_END}}
\DoxyCodeLine{00293\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ delta\ =\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>update\_workers\_request();}
\DoxyCodeLine{00296\ \ \ \ \ \}}
\DoxyCodeLine{00297\ \ \ \ \ \textcolor{comment}{//\ adjust\_job\_count\_estimate\ must\ be\ called\ outside\ of\ any\ locks}}
\DoxyCodeLine{00298\ \ \ \ \ \textcolor{keywordflow}{if}(\ delta!=0\ )}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>my\_server-\/>adjust\_job\_count\_estimate(\ delta\ );}
\DoxyCodeLine{00300\ \ \ \ \ \textcolor{comment}{//\ release\ internal\ market\ reference\ to\ match\ ++m-\/>my\_ref\_count\ above}}
\DoxyCodeLine{00301\ \ \ \ \ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>release(\ \textcolor{comment}{/*is\_public=*/}\textcolor{keyword}{false},\ \textcolor{comment}{/*blocking\_terminate=*/}\textcolor{keyword}{false}\ );}
\DoxyCodeLine{00302\ \}}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_a43c19dfa41213a92de3da1d0841cbf5a}{governor::does\_client\_join\_workers}}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classtbb_1_1internal_1_1rml_1_1tbb__client}{tbb::internal::rml::tbb\_client}}\ \&client)\ \{}
\DoxyCodeLine{00305\ \ \ \ \ \textcolor{keywordflow}{return}\ ((\textcolor{keyword}{const}\ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_ad285005b97c0c084157a6be5e6e0f2ee}{market}}\&)client).must\_join\_workers();}
\DoxyCodeLine{00306\ \}}
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00308\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adc288c92e3de5dd87e56ab61885cf63e}{arena}}*\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_aa73a40282b782676f30f27dcde0ea967}{market::create\_arena}}\ (\ \textcolor{keywordtype}{int}\ num\_slots,\ \textcolor{keywordtype}{int}\ num\_reserved\_slots,\ \textcolor{keywordtype}{size\_t}\ stack\_size\ )\ \{}
\DoxyCodeLine{00309\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ num\_slots\ >\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00310\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ num\_reserved\_slots\ <=\ num\_slots,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00311\ \ \ \ \ \textcolor{comment}{//\ Add\ public\ market\ reference\ for\ master\ thread/task\_arena\ (that\ adds\ an\ internal\ reference\ in\ exchange).}}
\DoxyCodeLine{00312\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_acdbf87ad0efe5f3e224d88ecb2536e93}{market}}\ \&\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a08ccaf89d501a9e56912eb5bd624066f}{global\_market}}(\ \textcolor{comment}{/*is\_public=*/}\textcolor{keyword}{true},\ num\_slots-\/num\_reserved\_slots,\ stack\_size\ );}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adc288c92e3de5dd87e56ab61885cf63e}{arena}}\&\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1arena_ad42305a844f6c9dc93b6d1c8c0302238}{arena::allocate\_arena}}(\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}},\ num\_slots,\ num\_reserved\_slots\ );}
\DoxyCodeLine{00315\ \ \ \ \ \textcolor{comment}{//\ Add\ newly\ created\ arena\ into\ the\ existing\ market's\ list.}}
\DoxyCodeLine{00316\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1spin__rw__mutex_1_1scoped__lock}{arenas\_list\_mutex\_type::scoped\_lock}}\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}.my\_arenas\_list\_mutex);}
\DoxyCodeLine{00317\ \ \ \ \ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}.insert\_arena\_into\_list(\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}});}
\DoxyCodeLine{00318\ \ \ \ \ \textcolor{keywordflow}{return}\ \&\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}};}
\DoxyCodeLine{00319\ \}}
\DoxyCodeLine{00320\ }
\DoxyCodeLine{00322\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a5bd937cbff57f636998e1ef4466469e4}{market::detach\_arena}}\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adc288c92e3de5dd87e56ab61885cf63e}{arena}}\&\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ )\ \{}
\DoxyCodeLine{00323\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a1dbc378b5e39901f1c11f2021b35688c}{theMarket}}\ ==\ \textcolor{keyword}{this},\ \textcolor{stringliteral}{"{}Global\ market\ instance\ was\ destroyed\ prematurely?"{}}\ );}
\DoxyCodeLine{00324\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_slots[0].my\_scheduler,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00325\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_global\_concurrency\_mode)}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ disable\_mandatory\_concurrency\_impl(\&\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}});}
\DoxyCodeLine{00327\ }
\DoxyCodeLine{00328\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a9f3b90e1f82aff92b8493b78a909d434}{remove\_arena\_from\_list}}(\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}});}
\DoxyCodeLine{00329\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_aba\_epoch\ ==\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a063b80350da6758a2f8a610a2363aff6}{my\_arenas\_aba\_epoch}}\ )}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ ++\mbox{\hyperlink{classtbb_1_1internal_1_1market_a063b80350da6758a2f8a610a2363aff6}{my\_arenas\_aba\_epoch}};}
\DoxyCodeLine{00331\ \}}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a798355f9d896223c97ac403c879987be}{market::try\_destroy\_arena}}\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adc288c92e3de5dd87e56ab61885cf63e}{arena}}*\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}},\ uintptr\_t\ aba\_epoch\ )\ \{}
\DoxyCodeLine{00334\ \ \ \ \ \textcolor{keywordtype}{bool}\ locked\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00335\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00336\ \ \ \ \ \textcolor{comment}{//\ we\ hold\ reference\ to\ the\ market,\ so\ it\ cannot\ be\ destroyed\ at\ any\ moment\ here}}
\DoxyCodeLine{00337\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \textcolor{keyword}{this}\ ==\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a1dbc378b5e39901f1c11f2021b35688c}{theMarket}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00338\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_acc6123ee9f177debfe705b53e509220e}{my\_ref\_count}}!=0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00339\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a939c230060372e2af4025aade0f91a6e}{my\_arenas\_list\_mutex}}.lock();}
\DoxyCodeLine{00340\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_abac77eac68e7a47e3edde883ff7a59ab}{assert\_market\_valid}}();}
\DoxyCodeLine{00341\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_PRIORITY}}
\DoxyCodeLine{00342\ \ \ \ \ \textcolor{comment}{//\ scan\ all\ priority\ levels,\ not\ only\ in\ [my\_global\_bottom\_priority;my\_global\_top\_priority]}}
\DoxyCodeLine{00343\ \ \ \ \ \textcolor{comment}{//\ range,\ because\ arena\ to\ be\ destroyed\ can\ have\ no\ outstanding\ request\ for\ workers}}
\DoxyCodeLine{00344\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ \mbox{\hyperlink{namespacetbb_1_1internal_ae1dadab9152ec72bebfb2827c03846e6}{num\_priority\_levels}}-\/1;\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ >=\ 0;\ -\/-\/\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ )\ \{}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ priority\_level\_info\ \&pl\ =\ my\_priority\_levels[\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}];}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a1e16d59c635a7c825700c682f0d6392e}{arena\_list\_type}}\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1market_aab9e3f5ceeb9189ea960798fa472db7f}{my\_arenas}}\ =\ pl.arenas;}
\DoxyCodeLine{00347\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_PRIORITY\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_a2ad160b840dca6434996b97306ab03dd}{arena\_list\_type::iterator}}\ it\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_aab9e3f5ceeb9189ea960798fa472db7f}{my\_arenas}}.begin();}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ ;\ it\ !=\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_aab9e3f5ceeb9189ea960798fa472db7f}{my\_arenas}}.end();\ ++it\ )\ \{}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ ==\ \&*it\ )\ \{}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ it-\/>my\_aba\_epoch\ ==\ aba\_epoch\ )\ \{}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Arena\ is\ alive}}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>my\_num\_workers\_requested\ \&\&\ !\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>my\_references\ )\ \{}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>my\_num\_workers\_allotted\ \&\&\ (\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>my\_pool\_state\ ==\ \mbox{\hyperlink{classtbb_1_1internal_1_1arena_a06d6b9eb47d6cf8a95f468f410e6769c}{arena::SNAPSHOT\_EMPTY}}\ ||\ !\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>my\_max\_num\_workers),\ \textcolor{stringliteral}{"{}Inconsistent\ arena\ state"{}}\ );}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Arena\ is\ abandoned.\ Destroy\ it.}}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a5bd937cbff57f636998e1ef4466469e4}{detach\_arena}}(\ *\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ );}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a939c230060372e2af4025aade0f91a6e}{my\_arenas\_list\_mutex}}.unlock();}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ locked\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>free\_arena();}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (locked)}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a939c230060372e2af4025aade0f91a6e}{my\_arenas\_list\_mutex}}.unlock();}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00367\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_PRIORITY}}
\DoxyCodeLine{00368\ \ \ \ \ \}}
\DoxyCodeLine{00369\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_PRIORITY\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00370\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a939c230060372e2af4025aade0f91a6e}{my\_arenas\_list\_mutex}}.unlock();}
\DoxyCodeLine{00371\ \}}
\DoxyCodeLine{00372\ }
\DoxyCodeLine{00374\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adc288c92e3de5dd87e56ab61885cf63e}{arena}}*\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adb6429452a5a46fc578cef54e692fcb6}{market::arena\_in\_need}}\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a1e16d59c635a7c825700c682f0d6392e}{arena\_list\_type}}\ \&arenas,\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adc288c92e3de5dd87e56ab61885cf63e}{arena}}\ *hint\ )\ \{}
\DoxyCodeLine{00375\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ arenas.\mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_aa41d3155479c72e2d6f76231d85f2f73}{empty}}()\ )}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00377\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_a2ad160b840dca6434996b97306ab03dd}{arena\_list\_type::iterator}}\ it\ =\ hint;}
\DoxyCodeLine{00378\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ it\ !=\ arenas.\mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_a61fa0658a500c11ff2cdf4c294c33e97}{end}}(),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00379\ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adc288c92e3de5dd87e56ab61885cf63e}{arena}}\&\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ =\ *it;}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ ++it\ ==\ arenas.\mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_a61fa0658a500c11ff2cdf4c294c33e97}{end}}()\ )}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \ \ \ \ it\ =\ arenas.\mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_a27a1cf03b6f163c2835d861fc6519aba}{begin}}();}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.num\_workers\_active()\ <\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_allotted\ )\ \{}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_references\ +=\ \mbox{\hyperlink{classtbb_1_1internal_1_1arena_af7e9255877d3efd5966031efe1fe3edf}{arena::ref\_worker}};}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \&\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}};}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00387\ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ (\ it\ !=\ hint\ );}
\DoxyCodeLine{00388\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00389\ \}}
\DoxyCodeLine{00390\ }
\DoxyCodeLine{00391\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae02e2394f18a6c25a022fa44be65d317}{market::update\_allotment}}\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a1e16d59c635a7c825700c682f0d6392e}{arena\_list\_type}}\&\ arenas,\ \textcolor{keywordtype}{int}\ workers\_demand,\ \textcolor{keywordtype}{int}\ max\_workers\ )\ \{}
\DoxyCodeLine{00392\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ workers\_demand\ >\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00393\ \ \ \ \ max\_workers\ =\ \mbox{\hyperlink{datatypes_8h_ac6afabdc09a49a433ee19d8a9486056d}{min}}(workers\_demand,\ max\_workers);}
\DoxyCodeLine{00394\ \ \ \ \ \textcolor{keywordtype}{int}\ assigned\ =\ 0;}
\DoxyCodeLine{00395\ \ \ \ \ \textcolor{keywordtype}{int}\ carry\ =\ 0;}
\DoxyCodeLine{00396\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_a2ad160b840dca6434996b97306ab03dd}{arena\_list\_type::iterator}}\ it\ =\ arenas.\mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_a27a1cf03b6f163c2835d861fc6519aba}{begin}}();\ it\ !=\ arenas.\mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_a61fa0658a500c11ff2cdf4c294c33e97}{end}}();\ ++it)\ \{}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adc288c92e3de5dd87e56ab61885cf63e}{arena}}\&\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ =\ *it;}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_requested\ <=\ 0)\ \{}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(!\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_allotted,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ allotted\ =\ 0;}
\DoxyCodeLine{00403\ \textcolor{preprocessor}{\#if\ \_\_TBB\_ENQUEUE\_ENFORCED\_CONCURRENCY}}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classtbb_1_1internal_1_1market_ae6f56dc7b83aaa5e44a52d5aa1685193}{my\_num\_workers\_soft\_limit}}\ ==\ 0)\ \{}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(max\_workers\ ==\ 0\ ||\ max\_workers\ ==\ 1,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \ \ \ \ allotted\ =\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_global\_concurrency\_mode\ \&\&\ assigned\ <\ max\_workers\ ?\ 1\ :\ 0;}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00408\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ tmp\ =\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_requested\ *\ max\_workers\ +\ carry;}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ \ \ \ \ allotted\ =\ tmp\ /\ workers\_demand;}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ \ \ \ \ carry\ =\ tmp\ \%\ workers\_demand;}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ a.my\_num\_workers\_requested\ may\ temporarily\ exceed\ a.my\_max\_num\_workers}}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ \ \ \ \ allotted\ =\ \mbox{\hyperlink{datatypes_8h_ac6afabdc09a49a433ee19d8a9486056d}{min}}(allotted,\ (\textcolor{keywordtype}{int})\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_max\_num\_workers);}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_allotted\ =\ allotted;}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ assigned\ +=\ allotted;}
\DoxyCodeLine{00418\ \ \ \ \ \}}
\DoxyCodeLine{00419\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ 0\ <=\ assigned\ \&\&\ assigned\ <=\ max\_workers,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00420\ \ \ \ \ \textcolor{keywordflow}{return}\ assigned;}
\DoxyCodeLine{00421\ \}}
\DoxyCodeLine{00422\ }
\DoxyCodeLine{00424\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ab5309747cd8e8e7e094b4417a8a28b76}{market::is\_arena\_in\_list}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a1e16d59c635a7c825700c682f0d6392e}{arena\_list\_type}}\ \&arenas,\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adc288c92e3de5dd87e56ab61885cf63e}{arena}}\ *\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ )\ \{}
\DoxyCodeLine{00425\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ )\ \{}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_a2ad160b840dca6434996b97306ab03dd}{arena\_list\_type::iterator}}\ it\ =\ arenas.\mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_a27a1cf03b6f163c2835d861fc6519aba}{begin}}();\ it\ !=\ arenas.\mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_a61fa0658a500c11ff2cdf4c294c33e97}{end}}();\ ++it\ )}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ ==\ \&*it\ )}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00429\ \ \ \ \ \}}
\DoxyCodeLine{00430\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00431\ \}}
\DoxyCodeLine{00432\ }
\DoxyCodeLine{00433\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_PRIORITY}}
\DoxyCodeLine{00434\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ market::update\_global\_top\_priority\ (\ intptr\_t\ newPriority\ )\ \{}
\DoxyCodeLine{00435\ \ \ \ \ \mbox{\hyperlink{tbb__statistics_8h_a08f1e46bb511c63da3ce07aa9c897bc4}{GATHER\_STATISTIC}}(\ ++\mbox{\hyperlink{classtbb_1_1internal_1_1governor_a2133659b14313088deef73524bf44f69}{governor::local\_scheduler\_if\_initialized}}()-\/>my\_counters.market\_prio\_switches\ );}
\DoxyCodeLine{00436\ \ \ \ \ my\_global\_top\_priority\ =\ newPriority;}
\DoxyCodeLine{00437\ \ \ \ \ my\_priority\_levels[newPriority].workers\_available\ =}
\DoxyCodeLine{00438\ \textcolor{preprocessor}{\#if\ \_\_TBB\_ENQUEUE\_ENFORCED\_CONCURRENCY}}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ my\_mandatory\_num\_requested\ \&\&\ !\mbox{\hyperlink{classtbb_1_1internal_1_1market_ae6f56dc7b83aaa5e44a52d5aa1685193}{my\_num\_workers\_soft\_limit}}\ ?\ 1\ :}
\DoxyCodeLine{00440\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae6f56dc7b83aaa5e44a52d5aa1685193}{my\_num\_workers\_soft\_limit}};}
\DoxyCodeLine{00442\ \ \ \ \ advance\_global\_reload\_epoch();}
\DoxyCodeLine{00443\ \}}
\DoxyCodeLine{00444\ }
\DoxyCodeLine{00445\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ market::reset\_global\_priority\ ()\ \{}
\DoxyCodeLine{00446\ \ \ \ \ my\_global\_bottom\_priority\ =\ normalized\_normal\_priority;}
\DoxyCodeLine{00447\ \ \ \ \ update\_global\_top\_priority(normalized\_normal\_priority);}
\DoxyCodeLine{00448\ \}}
\DoxyCodeLine{00449\ }
\DoxyCodeLine{00450\ \mbox{\hyperlink{structarena}{arena}}*\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adb6429452a5a46fc578cef54e692fcb6}{market::arena\_in\_need}}\ (\ \mbox{\hyperlink{structarena}{arena}}*\ prev\_arena\ )\ \{}
\DoxyCodeLine{00451\ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{namespacetbb_1_1internal_a958f482f9d5f3476ca70610af5336040}{as\_atomic}}(\mbox{\hyperlink{classtbb_1_1internal_1_1market_ac358959b1d07ef2051827926643bfd26}{my\_total\_demand}})\ <=\ 0\ )}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00453\ \ \ \ \ arenas\_list\_mutex\_type::scoped\_lock\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\mbox{\hyperlink{classtbb_1_1internal_1_1market_a939c230060372e2af4025aade0f91a6e}{my\_arenas\_list\_mutex}},\ \textcolor{comment}{/*is\_writer=*/}\textcolor{keyword}{false});}
\DoxyCodeLine{00454\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_abac77eac68e7a47e3edde883ff7a59ab}{assert\_market\_valid}}();}
\DoxyCodeLine{00455\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ my\_global\_top\_priority;}
\DoxyCodeLine{00456\ \ \ \ \ \mbox{\hyperlink{structarena}{arena}}\ *\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ \ \ \ \ \textcolor{comment}{//\ Checks\ if\ arena\ is\ alive\ or\ not}}
\DoxyCodeLine{00459\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ab5309747cd8e8e7e094b4417a8a28b76}{is\_arena\_in\_list}}(\ my\_priority\_levels[\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}].arenas,\ prev\_arena\ )\ )\ \{}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adb6429452a5a46fc578cef54e692fcb6}{arena\_in\_need}}(\ my\_priority\_levels[\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}].arenas,\ prev\_arena\ );}
\DoxyCodeLine{00461\ \ \ \ \ \}}
\DoxyCodeLine{00462\ }
\DoxyCodeLine{00463\ \ \ \ \ \textcolor{keywordflow}{while}\ (\ !\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ \&\&\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ >=\ my\_global\_bottom\_priority\ )\ \{}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ priority\_level\_info\ \&pl\ =\ my\_priority\_levels[\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}-\/-\/];}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adb6429452a5a46fc578cef54e692fcb6}{arena\_in\_need}}(\ pl.arenas,\ pl.next\_arena\ );}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ )\ \{}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a958f482f9d5f3476ca70610af5336040}{as\_atomic}}(pl.next\_arena)\ =\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}};\ \textcolor{comment}{//\ a\ subject\ for\ innocent\ data\ race\ under\ the\ reader\ lock}}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ rework\ global\ round\ robin\ policy\ to\ local\ or\ random\ to\ avoid\ this\ write}}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ When\ refactoring\ task\ priority\ code,\ take\ into\ consideration\ the}}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \_\_TBB\_TRACK\_PRIORITY\_LEVEL\_SATURATION\ sections\ from\ earlier\ versions\ of\ TBB}}
\DoxyCodeLine{00472\ \ \ \ \ \}}
\DoxyCodeLine{00473\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}};}
\DoxyCodeLine{00474\ \}}
\DoxyCodeLine{00475\ }
\DoxyCodeLine{00476\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae02e2394f18a6c25a022fa44be65d317}{market::update\_allotment}}\ (\ intptr\_t\ highest\_affected\_priority\ )\ \{}
\DoxyCodeLine{00477\ \ \ \ \ intptr\_t\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ highest\_affected\_priority;}
\DoxyCodeLine{00478\ \ \ \ \ \textcolor{keywordtype}{int}\ available\ =\ my\_priority\_levels[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}].workers\_available;}
\DoxyCodeLine{00479\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ ;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ >=\ my\_global\_bottom\_priority;\ -\/-\/\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ )\ \{}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ priority\_level\_info\ \&pl\ =\ my\_priority\_levels[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}];}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ pl.workers\_available\ =\ available;}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ pl.workers\_requested\ )\ \{}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \ \ \ \ available\ -\/=\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae02e2394f18a6c25a022fa44be65d317}{update\_allotment}}(\ pl.arenas,\ pl.workers\_requested,\ available\ );}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ available\ <=\ 0\ )\ \{\ \textcolor{comment}{//\ TODO:\ assertion?}}
\DoxyCodeLine{00485\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ available\ =\ 0;}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00489\ \ \ \ \ \}}
\DoxyCodeLine{00490\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <=\ my\_global\_bottom\_priority\ ||\ !available,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00491\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ -\/-\/\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}};\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ >=\ my\_global\_bottom\_priority;\ -\/-\/\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ )\ \{}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \ \ priority\_level\_info\ \&pl\ =\ my\_priority\_levels[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}];}
\DoxyCodeLine{00493\ \ \ \ \ \ \ \ \ pl.workers\_available\ =\ 0;}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1intrusive__list__base_a2ad160b840dca6434996b97306ab03dd}{arena\_list\_type::iterator}}\ it\ =\ pl.arenas.begin();}
\DoxyCodeLine{00495\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ ;\ it\ !=\ pl.arenas.end();\ ++it\ )\ \{}
\DoxyCodeLine{00496\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ it-\/>my\_num\_workers\_requested\ >=\ 0\ ||\ !it-\/>my\_num\_workers\_allotted,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00497\ \ \ \ \ \ \ \ \ \ \ \ \ it-\/>my\_num\_workers\_allotted\ =\ 0;}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00499\ \ \ \ \ \}}
\DoxyCodeLine{00500\ \}}
\DoxyCodeLine{00501\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_PRIORITY\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00502\ }
\DoxyCodeLine{00503\ \textcolor{preprocessor}{\#if\ \_\_TBB\_ENQUEUE\_ENFORCED\_CONCURRENCY}}
\DoxyCodeLine{00504\ \textcolor{keywordtype}{void}\ market::enable\_mandatory\_concurrency\_impl\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1arena}{arena}}\ *\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ )\ \{}
\DoxyCodeLine{00505\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(!\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>my\_global\_concurrency\_mode,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00506\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\mbox{\hyperlink{classtbb_1_1internal_1_1market_ae6f56dc7b83aaa5e44a52d5aa1685193}{my\_num\_workers\_soft\_limit}}\ ==\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00508\ \ \ \ \ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>my\_global\_concurrency\_mode\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00509\ \ \ \ \ my\_mandatory\_num\_requested++;}
\DoxyCodeLine{00510\ \}}
\DoxyCodeLine{00511\ }
\DoxyCodeLine{00512\ \textcolor{keywordtype}{void}\ market::enable\_mandatory\_concurrency\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1arena}{arena}}\ *\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ )\ \{}
\DoxyCodeLine{00513\ \ \ \ \ \textcolor{keywordtype}{int}\ delta\ =\ 0;}
\DoxyCodeLine{00514\ \ \ \ \ \{}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1spin__rw__mutex_1_1scoped__lock}{arenas\_list\_mutex\_type::scoped\_lock}}\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\mbox{\hyperlink{classtbb_1_1internal_1_1market_a939c230060372e2af4025aade0f91a6e}{my\_arenas\_list\_mutex}});}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classtbb_1_1internal_1_1market_ae6f56dc7b83aaa5e44a52d5aa1685193}{my\_num\_workers\_soft\_limit}}\ !=\ 0\ ||\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>my\_global\_concurrency\_mode)}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00518\ }
\DoxyCodeLine{00519\ \ \ \ \ \ \ \ \ enable\_mandatory\_concurrency\_impl(\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}});}
\DoxyCodeLine{00520\ \ \ \ \ \ \ \ \ delta\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a61e46dcffd92e6d8bae0337f258112fa}{update\_workers\_request}}();}
\DoxyCodeLine{00521\ \ \ \ \ \}}
\DoxyCodeLine{00522\ }
\DoxyCodeLine{00523\ \ \ \ \ \textcolor{keywordflow}{if}\ (delta\ !=\ 0)}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_af7429d97c388e8adcbf37fcdbf64c075}{my\_server}}-\/>adjust\_job\_count\_estimate(delta);}
\DoxyCodeLine{00525\ \}}
\DoxyCodeLine{00526\ }
\DoxyCodeLine{00527\ \textcolor{keywordtype}{void}\ market::disable\_mandatory\_concurrency\_impl(\mbox{\hyperlink{classtbb_1_1internal_1_1arena}{arena}}*\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}})\ \{}
\DoxyCodeLine{00528\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>my\_global\_concurrency\_mode,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00529\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(my\_mandatory\_num\_requested\ >\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00530\ }
\DoxyCodeLine{00531\ \ \ \ \ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>my\_global\_concurrency\_mode\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00532\ \ \ \ \ my\_mandatory\_num\_requested-\/-\/;}
\DoxyCodeLine{00533\ \}}
\DoxyCodeLine{00534\ }
\DoxyCodeLine{00535\ \textcolor{keywordtype}{void}\ market::mandatory\_concurrency\_disable\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1arena}{arena}}\ *\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ )\ \{}
\DoxyCodeLine{00536\ \ \ \ \ \textcolor{keywordtype}{int}\ delta\ =\ 0;}
\DoxyCodeLine{00537\ \ \ \ \ \{}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1spin__rw__mutex_1_1scoped__lock}{arenas\_list\_mutex\_type::scoped\_lock}}\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\mbox{\hyperlink{classtbb_1_1internal_1_1market_a939c230060372e2af4025aade0f91a6e}{my\_arenas\_list\_mutex}});}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>my\_global\_concurrency\_mode)}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ There\ is\ a\ racy\ window\ in\ advertise\_new\_work\ between\ mandtory\ concurrency\ enabling\ and\ }}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ setting\ SNAPSHOT\_FULL.\ It\ gives\ a\ chance\ to\ spawn\ request\ to\ disable\ mandatory\ concurrency.}}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Therefore,\ we\ double\ check\ that\ there\ is\ no\ enqueued\ tasks.}}
\DoxyCodeLine{00544\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>has\_enqueued\_tasks())}
\DoxyCodeLine{00545\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00546\ }
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\mbox{\hyperlink{classtbb_1_1internal_1_1market_ae6f56dc7b83aaa5e44a52d5aa1685193}{my\_num\_workers\_soft\_limit}}\ ==\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ disable\_mandatory\_concurrency\_impl(\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}});}
\DoxyCodeLine{00549\ }
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ delta\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a61e46dcffd92e6d8bae0337f258112fa}{update\_workers\_request}}();}
\DoxyCodeLine{00551\ \ \ \ \ \}}
\DoxyCodeLine{00552\ \ \ \ \ \textcolor{keywordflow}{if}\ (delta\ !=\ 0)}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_af7429d97c388e8adcbf37fcdbf64c075}{my\_server}}-\/>adjust\_job\_count\_estimate(delta);}
\DoxyCodeLine{00554\ \}}
\DoxyCodeLine{00555\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_ENQUEUE\_ENFORCED\_CONCURRENCY\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00556\ }
\DoxyCodeLine{00557\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a2147b4639190ad49551f617784dc012b}{market::adjust\_demand}}\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adc288c92e3de5dd87e56ab61885cf63e}{arena}}\&\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}},\ \textcolor{keywordtype}{int}\ delta\ )\ \{}
\DoxyCodeLine{00558\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a1dbc378b5e39901f1c11f2021b35688c}{theMarket}},\ \textcolor{stringliteral}{"{}market\ instance\ was\ destroyed\ prematurely?"{}}\ );}
\DoxyCodeLine{00559\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !delta\ )}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00561\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a939c230060372e2af4025aade0f91a6e}{my\_arenas\_list\_mutex}}.lock();}
\DoxyCodeLine{00562\ \ \ \ \ \textcolor{keywordtype}{int}\ prev\_req\ =\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_requested;}
\DoxyCodeLine{00563\ \ \ \ \ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_requested\ +=\ delta;}
\DoxyCodeLine{00564\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_requested\ <=\ 0\ )\ \{}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_allotted\ =\ 0;}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ prev\_req\ <=\ 0\ )\ \{}
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a939c230060372e2af4025aade0f91a6e}{my\_arenas\_list\_mutex}}.unlock();}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ delta\ =\ -\/prev\_req;}
\DoxyCodeLine{00571\ \ \ \ \ \}}
\DoxyCodeLine{00572\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ prev\_req\ <\ 0\ )\ \{}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ delta\ =\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_requested;}
\DoxyCodeLine{00574\ \ \ \ \ \}}
\DoxyCodeLine{00575\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ac358959b1d07ef2051827926643bfd26}{my\_total\_demand}}\ +=\ delta;}
\DoxyCodeLine{00576\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ effective\_soft\_limit\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae6f56dc7b83aaa5e44a52d5aa1685193}{my\_num\_workers\_soft\_limit}};}
\DoxyCodeLine{00577\ \ \ \ \ \textcolor{keywordflow}{if}\ (my\_mandatory\_num\_requested\ >\ 0)\ \{}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(effective\_soft\_limit\ ==\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00579\ \ \ \ \ \ \ \ \ effective\_soft\_limit\ =\ 1;}
\DoxyCodeLine{00580\ \ \ \ \ \}}
\DoxyCodeLine{00581\ \textcolor{preprocessor}{\#if\ !\_\_TBB\_TASK\_PRIORITY}}
\DoxyCodeLine{00582\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae02e2394f18a6c25a022fa44be65d317}{update\_allotment}}(effective\_soft\_limit);}
\DoxyCodeLine{00583\ \textcolor{preprocessor}{\#else\ }\textcolor{comment}{/*\ !\_\_TBB\_TASK\_PRIORITY\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00584\ \ \ \ \ intptr\_t\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_top\_priority;}
\DoxyCodeLine{00585\ \ \ \ \ priority\_level\_info\ \&pl\ =\ my\_priority\_levels[\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}];}
\DoxyCodeLine{00586\ \ \ \ \ pl.workers\_requested\ +=\ delta;}
\DoxyCodeLine{00587\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ pl.workers\_requested\ >=\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00588\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_requested\ <=\ 0\ )\ \{}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_top\_priority\ !=\ normalized\_normal\_priority\ )\ \{}
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__statistics_8h_a08f1e46bb511c63da3ce07aa9c897bc4}{GATHER\_STATISTIC}}(\ ++\mbox{\hyperlink{classtbb_1_1internal_1_1governor_a2133659b14313088deef73524bf44f69}{governor::local\_scheduler\_if\_initialized}}()-\/>my\_counters.arena\_prio\_resets\ );}
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ \ \ \ \ update\_arena\_top\_priority(\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}},\ normalized\_normal\_priority\ );}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00593\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_bottom\_priority\ =\ normalized\_normal\_priority;}
\DoxyCodeLine{00594\ \ \ \ \ \}}
\DoxyCodeLine{00595\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ ==\ my\_global\_top\_priority\ )\ \{}
\DoxyCodeLine{00596\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !pl.workers\_requested\ )\ \{}
\DoxyCodeLine{00597\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\ -\/-\/\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ >=\ my\_global\_bottom\_priority\ \&\&\ !my\_priority\_levels[\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}].workers\_requested\ )}
\DoxyCodeLine{00598\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ <\ my\_global\_bottom\_priority\ )}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ reset\_global\_priority();}
\DoxyCodeLine{00601\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00602\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ update\_global\_top\_priority(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \ \ my\_priority\_levels[my\_global\_top\_priority].workers\_available\ =\ effective\_soft\_limit;}
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae02e2394f18a6c25a022fa44be65d317}{update\_allotment}}(\ my\_global\_top\_priority\ );}
\DoxyCodeLine{00606\ \ \ \ \ \}}
\DoxyCodeLine{00607\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ >\ my\_global\_top\_priority\ )\ \{}
\DoxyCodeLine{00608\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ pl.workers\_requested\ >\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00609\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ investigate\ if\ the\ following\ invariant\ is\ always\ valid}}
\DoxyCodeLine{00610\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_requested\ >=\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00611\ \ \ \ \ \ \ \ \ update\_global\_top\_priority(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00612\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_allotted\ =\ \mbox{\hyperlink{datatypes_8h_ac6afabdc09a49a433ee19d8a9486056d}{min}}(\ (\textcolor{keywordtype}{int})effective\_soft\_limit,\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_requested\ );}
\DoxyCodeLine{00613\ \ \ \ \ \ \ \ \ my\_priority\_levels[\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ -\/\ 1].workers\_available\ =\ effective\_soft\_limit\ -\/\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_allotted;}
\DoxyCodeLine{00614\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae02e2394f18a6c25a022fa44be65d317}{update\_allotment}}(\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ -\/\ 1\ );}
\DoxyCodeLine{00615\ \ \ \ \ \}}
\DoxyCodeLine{00616\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ ==\ my\_global\_bottom\_priority\ )\ \{}
\DoxyCodeLine{00617\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !pl.workers\_requested\ )\ \{}
\DoxyCodeLine{00618\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\ ++\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ <=\ my\_global\_top\_priority\ \&\&\ !my\_priority\_levels[\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}].workers\_requested\ )}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00620\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ >\ my\_global\_top\_priority\ )}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ reset\_global\_priority();}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ my\_global\_bottom\_priority\ =\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}};}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00626\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae02e2394f18a6c25a022fa44be65d317}{update\_allotment}}(\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ );}
\DoxyCodeLine{00627\ \ \ \ \ \}}
\DoxyCodeLine{00628\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ <\ my\_global\_bottom\_priority\ )\ \{}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ prev\_bottom\ =\ my\_global\_bottom\_priority;}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ my\_global\_bottom\_priority\ =\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}};}
\DoxyCodeLine{00631\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae02e2394f18a6c25a022fa44be65d317}{update\_allotment}}(\ prev\_bottom\ );}
\DoxyCodeLine{00632\ \ \ \ \ \}}
\DoxyCodeLine{00633\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00634\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ my\_global\_bottom\_priority\ <\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ \&\&\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ <\ my\_global\_top\_priority,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00635\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae02e2394f18a6c25a022fa44be65d317}{update\_allotment}}(\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ );}
\DoxyCodeLine{00636\ \ \ \ \ \}}
\DoxyCodeLine{00637\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ my\_global\_top\_priority\ >=\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_top\_priority\ ||\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_requested<=0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00638\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_abac77eac68e7a47e3edde883ff7a59ab}{assert\_market\_valid}}();}
\DoxyCodeLine{00639\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ !\_\_TBB\_TASK\_PRIORITY\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00640\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ delta\ >\ 0\ )\ \{}
\DoxyCodeLine{00641\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ can't\ overflow\ soft\_limit,\ but\ remember\ values\ request\ by\ arenas\ in}}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ my\_total\_demand\ to\ not\ prematurely\ release\ workers\ to\ RML}}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a91c485f06e84cd7c8f357ac2653c0425}{my\_num\_workers\_requested}}+delta\ >\ (\textcolor{keywordtype}{int})effective\_soft\_limit)}
\DoxyCodeLine{00644\ \ \ \ \ \ \ \ \ \ \ \ \ delta\ =\ effective\_soft\_limit\ -\/\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a91c485f06e84cd7c8f357ac2653c0425}{my\_num\_workers\_requested}};}
\DoxyCodeLine{00645\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ number\ of\ workers\ should\ not\ be\ decreased\ below\ my\_total\_demand}}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a91c485f06e84cd7c8f357ac2653c0425}{my\_num\_workers\_requested}}+delta\ <\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ac358959b1d07ef2051827926643bfd26}{my\_total\_demand}}\ )}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \ \ \ \ \ \ delta\ =\ \mbox{\hyperlink{datatypes_8h_ac6afabdc09a49a433ee19d8a9486056d}{min}}(\mbox{\hyperlink{classtbb_1_1internal_1_1market_ac358959b1d07ef2051827926643bfd26}{my\_total\_demand}},\ (\textcolor{keywordtype}{int})effective\_soft\_limit)\ -\/\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a91c485f06e84cd7c8f357ac2653c0425}{my\_num\_workers\_requested}};}
\DoxyCodeLine{00649\ \ \ \ \ \}}
\DoxyCodeLine{00650\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a91c485f06e84cd7c8f357ac2653c0425}{my\_num\_workers\_requested}}\ +=\ delta;}
\DoxyCodeLine{00651\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a91c485f06e84cd7c8f357ac2653c0425}{my\_num\_workers\_requested}}\ <=\ (\textcolor{keywordtype}{int})effective\_soft\_limit,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00652\ }
\DoxyCodeLine{00653\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a939c230060372e2af4025aade0f91a6e}{my\_arenas\_list\_mutex}}.unlock();}
\DoxyCodeLine{00654\ \ \ \ \ \textcolor{comment}{//\ Must\ be\ called\ outside\ of\ any\ locks}}
\DoxyCodeLine{00655\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_af7429d97c388e8adcbf37fcdbf64c075}{my\_server}}-\/>adjust\_job\_count\_estimate(\ delta\ );}
\DoxyCodeLine{00656\ \ \ \ \ \mbox{\hyperlink{tbb__statistics_8h_a08f1e46bb511c63da3ce07aa9c897bc4}{GATHER\_STATISTIC}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_a2133659b14313088deef73524bf44f69}{governor::local\_scheduler\_if\_initialized}}()\ ?\ ++\mbox{\hyperlink{classtbb_1_1internal_1_1governor_a2133659b14313088deef73524bf44f69}{governor::local\_scheduler\_if\_initialized}}()-\/>my\_counters.gate\_switches\ :\ 0\ );}
\DoxyCodeLine{00657\ \}}
\DoxyCodeLine{00658\ }
\DoxyCodeLine{00659\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a574c6275a73f185d391151478e4a7634}{market::process}}(\ \mbox{\hyperlink{classrml_1_1client_a684e4fee23d24f9d9d150eb38f2d254f}{job}}\&\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}\ )\ \{}
\DoxyCodeLine{00660\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a9acd4f7b134e3bcd5625ce386ec7db60}{generic\_scheduler}}\&\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classtbb_1_1internal_1_1market_a9acd4f7b134e3bcd5625ce386ec7db60}{generic\_scheduler}}\&\textcolor{keyword}{>}(\mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}});}
\DoxyCodeLine{00661\ \ \ \ \ \textcolor{comment}{//\ s.my\_arena\ can\ be\ dead.\ Don't\ access\ it\ until\ arena\_in\_need\ is\ called}}
\DoxyCodeLine{00662\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adc288c92e3de5dd87e56ab61885cf63e}{arena}}\ *\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ =\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}.my\_arena;}
\DoxyCodeLine{00663\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_a14d4453f34a770b1c983c2ed38570e31}{governor::is\_set}}(\&\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00664\ }
\DoxyCodeLine{00665\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ 2;\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\ (\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_adb6429452a5a46fc578cef54e692fcb6}{arena\_in\_need}}(\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}))\ )\ \{}
\DoxyCodeLine{00667\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>process(\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}});}
\DoxyCodeLine{00668\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};\ \textcolor{comment}{//\ to\ avoid\ double\ checks\ in\ arena\_in\_need(arena*)\ for\ the\ same\ priority\ level}}
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Workers\ leave\ market\ because\ there\ is\ no\ arena\ in\ need.\ It\ can\ happen\ earlier\ than}}
\DoxyCodeLine{00671\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ adjust\_job\_count\_estimate()\ decreases\ my\_slack\ and\ RML\ can\ put\ this\ thread\ to\ sleep.}}
\DoxyCodeLine{00672\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It\ might\ result\ in\ a\ busy-\/loop\ checking\ for\ my\_slack<0\ and\ calling\ this\ method\ instantly.}}
\DoxyCodeLine{00673\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ yield\ refines\ this\ spinning.}}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ )}
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ibm__aix51_8h_a2b17e6e4504bddf60a920f609fc46ea6}{\_\_TBB\_Yield}}();}
\DoxyCodeLine{00676\ \ \ \ \ \}}
\DoxyCodeLine{00677\ }
\DoxyCodeLine{00678\ \ \ \ \ \mbox{\hyperlink{tbb__statistics_8h_a08f1e46bb511c63da3ce07aa9c897bc4}{GATHER\_STATISTIC}}(\ ++\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}.my\_counters.market\_roundtrips\ );}
\DoxyCodeLine{00679\ \}}
\DoxyCodeLine{00680\ }
\DoxyCodeLine{00681\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a32eca56b49c13d239a2869c33c4a17b0}{market::cleanup}}(\ \mbox{\hyperlink{classrml_1_1client_a684e4fee23d24f9d9d150eb38f2d254f}{job}}\&\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}\ )\ \{}
\DoxyCodeLine{00682\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a1dbc378b5e39901f1c11f2021b35688c}{theMarket}}\ !=\ \textcolor{keyword}{this},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00683\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a9acd4f7b134e3bcd5625ce386ec7db60}{generic\_scheduler}}\&\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classtbb_1_1internal_1_1market_a9acd4f7b134e3bcd5625ce386ec7db60}{generic\_scheduler}}\&\textcolor{keyword}{>}(\mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}});}
\DoxyCodeLine{00684\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a9acd4f7b134e3bcd5625ce386ec7db60}{generic\_scheduler}}*\ mine\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_a2133659b14313088deef73524bf44f69}{governor::local\_scheduler\_if\_initialized}}();}
\DoxyCodeLine{00685\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !mine\ ||\ mine-\/>\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a24ecab941cdf8ff762126f1c65e5274a}{is\_worker}}(),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00686\ \ \ \ \ \textcolor{keywordflow}{if}(\ mine!=\&\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ )\ \{}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_abe1de8df4e3ecce96763951ac97540c6}{governor::assume\_scheduler}}(\ \&\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ );}
\DoxyCodeLine{00688\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ae6a0b659589202963562cbdb23465807}{generic\_scheduler::cleanup\_worker}}(\ \&\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}},\ mine!=\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00689\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_abe1de8df4e3ecce96763951ac97540c6}{governor::assume\_scheduler}}(\ mine\ );}
\DoxyCodeLine{00690\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00691\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ae6a0b659589202963562cbdb23465807}{generic\_scheduler::cleanup\_worker}}(\ \&\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}},\ \textcolor{keyword}{true}\ );}
\DoxyCodeLine{00692\ \ \ \ \ \}}
\DoxyCodeLine{00693\ \}}
\DoxyCodeLine{00694\ }
\DoxyCodeLine{00695\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_abc37f18193cd93d6b5c54acef4feec17}{market::acknowledge\_close\_connection}}()\ \{}
\DoxyCodeLine{00696\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a5ca285e2d383ecaf3ff0460b30a3551e}{destroy}}();}
\DoxyCodeLine{00697\ \}}
\DoxyCodeLine{00698\ }
\DoxyCodeLine{00699\ \mbox{\hyperlink{classrml_1_1job}{::rml::job}}*\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae5f4653c1ea43b7011f9099348849467}{market::create\_one\_job}}()\ \{}
\DoxyCodeLine{00700\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}}\ =\ ++\mbox{\hyperlink{classtbb_1_1internal_1_1market_a2fcee169e3b3be1cbb9b89b9a6c1942c}{my\_first\_unused\_worker\_idx}};}
\DoxyCodeLine{00701\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}}\ >\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00702\ \ \ \ \ \mbox{\hyperlink{itt__notify_8h_aaa33746f4ce9b2b0122b0af5f74908fd}{ITT\_THREAD\_SET\_NAME}}(\mbox{\hyperlink{itt__notify_8h_a12fc55887756a149e9d8bf158f9c72f2}{\_T}}(\textcolor{stringliteral}{"{}TBB\ Worker\ Thread"{}}));}
\DoxyCodeLine{00703\ \ \ \ \ \textcolor{comment}{//\ index\ serves\ as\ a\ hint\ decreasing\ conflicts\ between\ workers\ when\ they\ migrate\ between\ arenas}}
\DoxyCodeLine{00704\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a9acd4f7b134e3bcd5625ce386ec7db60}{generic\_scheduler}}*\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a556929cfad4b9daef4950dfdb6cee485}{generic\_scheduler::create\_worker}}(\ *\textcolor{keyword}{this},\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}},\ \textcolor{comment}{/*\ genuine\ =\ */}\ \textcolor{keyword}{true}\ );}
\DoxyCodeLine{00705\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_GROUP\_CONTEXT}}
\DoxyCodeLine{00706\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}}\ <=\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a0e2353e9048c25db08e639869694a0a5}{my\_num\_workers\_hard\_limit}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00707\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !my\_workers[\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}}\ -\/\ 1],\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00708\ \ \ \ \ my\_workers[\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}}\ -\/\ 1]\ =\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}};}
\DoxyCodeLine{00709\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_GROUP\_CONTEXT\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00710\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}};}
\DoxyCodeLine{00711\ \}}
\DoxyCodeLine{00712\ }
\DoxyCodeLine{00713\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_PRIORITY}}
\DoxyCodeLine{00714\ \textcolor{keywordtype}{void}\ market::update\_arena\_top\_priority\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1arena}{arena}}\&\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}},\ intptr\_t\ new\_priority\ )\ \{}
\DoxyCodeLine{00715\ \ \ \ \ \mbox{\hyperlink{tbb__statistics_8h_a08f1e46bb511c63da3ce07aa9c897bc4}{GATHER\_STATISTIC}}(\ ++\mbox{\hyperlink{classtbb_1_1internal_1_1governor_a2133659b14313088deef73524bf44f69}{governor::local\_scheduler\_if\_initialized}}()-\/>my\_counters.arena\_prio\_switches\ );}
\DoxyCodeLine{00716\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_top\_priority\ !=\ new\_priority,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00717\ \ \ \ \ priority\_level\_info\ \&prev\_level\ =\ my\_priority\_levels[\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_top\_priority],}
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&new\_level\ =\ my\_priority\_levels[new\_priority];}
\DoxyCodeLine{00719\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a9f3b90e1f82aff92b8493b78a909d434}{remove\_arena\_from\_list}}(\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}});}
\DoxyCodeLine{00720\ \ \ \ \ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_top\_priority\ =\ new\_priority;}
\DoxyCodeLine{00721\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a829b50e27820a2ecb57067b0d8147422}{insert\_arena\_into\_list}}(\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}});}
\DoxyCodeLine{00722\ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a958f482f9d5f3476ca70610af5336040}{as\_atomic}}(\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_reload\_epoch\ ).fetch\_and\_increment<\mbox{\hyperlink{namespacetbb_adb86d08473679d6fe0eabcdc766ffe3aa412563418e657114a102db610f726632}{tbb::release}}>();\ \textcolor{comment}{//\ TODO:\ synch\ with\ global\ reload\ epoch\ in\ order\ to\ optimize\ usage\ of\ local\ reload\ epoch}}
\DoxyCodeLine{00723\ \ \ \ \ prev\_level.workers\_requested\ -\/=\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_requested;}
\DoxyCodeLine{00724\ \ \ \ \ new\_level.workers\_requested\ +=\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_requested;}
\DoxyCodeLine{00725\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ prev\_level.workers\_requested\ >=\ 0\ \&\&\ new\_level.workers\_requested\ >=\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00726\ \}}
\DoxyCodeLine{00727\ }
\DoxyCodeLine{00728\ \textcolor{keywordtype}{bool}\ market::lower\_arena\_priority\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1arena}{arena}}\&\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}},\ intptr\_t\ new\_priority,\ uintptr\_t\ old\_reload\_epoch\ )\ \{}
\DoxyCodeLine{00729\ \ \ \ \ \textcolor{comment}{//\ TODO:\ replace\ the\ lock\ with\ a\ try\_lock\ loop\ which\ performs\ a\ double\ check\ of\ the\ epoch}}
\DoxyCodeLine{00730\ \ \ \ \ arenas\_list\_mutex\_type::scoped\_lock\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\mbox{\hyperlink{classtbb_1_1internal_1_1market_a939c230060372e2af4025aade0f91a6e}{my\_arenas\_list\_mutex}});}
\DoxyCodeLine{00731\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_reload\_epoch\ !=\ old\_reload\_epoch\ )\ \{}
\DoxyCodeLine{00732\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_abac77eac68e7a47e3edde883ff7a59ab}{assert\_market\_valid}}();}
\DoxyCodeLine{00733\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00734\ \ \ \ \ \}}
\DoxyCodeLine{00735\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_top\_priority\ >\ new\_priority,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00736\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ my\_global\_top\_priority\ >=\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_top\_priority,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00737\ }
\DoxyCodeLine{00738\ \ \ \ \ intptr\_t\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_top\_priority;}
\DoxyCodeLine{00739\ \ \ \ \ update\_arena\_top\_priority(\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}},\ new\_priority\ );}
\DoxyCodeLine{00740\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_requested\ >\ 0\ )\ \{}
\DoxyCodeLine{00741\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ my\_global\_bottom\_priority\ >\ new\_priority\ )\ \{}
\DoxyCodeLine{00742\ \ \ \ \ \ \ \ \ \ \ \ \ my\_global\_bottom\_priority\ =\ new\_priority;}
\DoxyCodeLine{00743\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00744\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ ==\ my\_global\_top\_priority\ \&\&\ !my\_priority\_levels[\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}].workers\_requested\ )\ \{}
\DoxyCodeLine{00745\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Global\ top\ level\ became\ empty}}
\DoxyCodeLine{00746\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ -\/-\/\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}};\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}>my\_global\_bottom\_priority\ \&\&\ !my\_priority\_levels[\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}].workers\_requested;\ -\/-\/\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ )\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00747\ \ \ \ \ \ \ \ \ \ \ \ \ update\_global\_top\_priority(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00748\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00749\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae02e2394f18a6c25a022fa44be65d317}{update\_allotment}}(\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ );}
\DoxyCodeLine{00750\ \ \ \ \ \}}
\DoxyCodeLine{00751\ }
\DoxyCodeLine{00752\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ my\_global\_top\_priority\ >=\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_top\_priority,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00753\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_abac77eac68e7a47e3edde883ff7a59ab}{assert\_market\_valid}}();}
\DoxyCodeLine{00754\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00755\ \}}
\DoxyCodeLine{00756\ }
\DoxyCodeLine{00757\ \textcolor{keywordtype}{bool}\ market::update\_arena\_priority\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1arena}{arena}}\&\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}},\ intptr\_t\ new\_priority\ )\ \{}
\DoxyCodeLine{00758\ \ \ \ \ \textcolor{comment}{//\ TODO:\ do\ not\ acquire\ this\ global\ lock\ while\ checking\ arena's\ state.}}
\DoxyCodeLine{00759\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1spin__rw__mutex_1_1scoped__lock}{arenas\_list\_mutex\_type::scoped\_lock}}\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\mbox{\hyperlink{classtbb_1_1internal_1_1market_a939c230060372e2af4025aade0f91a6e}{my\_arenas\_list\_mutex}});}
\DoxyCodeLine{00760\ }
\DoxyCodeLine{00761\ \ \ \ \ tbb::internal::assert\_priority\_valid(new\_priority);}
\DoxyCodeLine{00762\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ my\_global\_top\_priority\ >=\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_top\_priority\ ||\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_requested\ <=\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00763\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_abac77eac68e7a47e3edde883ff7a59ab}{assert\_market\_valid}}();}
\DoxyCodeLine{00764\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_top\_priority\ ==\ new\_priority\ )\ \{}
\DoxyCodeLine{00765\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00766\ \ \ \ \ \}}
\DoxyCodeLine{00767\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_top\_priority\ >\ new\_priority\ )\ \{}
\DoxyCodeLine{00768\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_bottom\_priority\ >\ new\_priority\ )}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_bottom\_priority\ =\ new\_priority;}
\DoxyCodeLine{00770\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00771\ \ \ \ \ \}}
\DoxyCodeLine{00772\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_num\_workers\_requested\ <=\ 0\ )\ \{}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00774\ \ \ \ \ \}}
\DoxyCodeLine{00775\ }
\DoxyCodeLine{00776\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ my\_global\_top\_priority\ >=\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_top\_priority,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00777\ }
\DoxyCodeLine{00778\ \ \ \ \ intptr\_t\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_top\_priority;}
\DoxyCodeLine{00779\ \ \ \ \ intptr\_t\ highest\_affected\_level\ =\ \mbox{\hyperlink{datatypes_8h_affe776513b24d84b39af8ab0930fef7f}{max}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ new\_priority);}
\DoxyCodeLine{00780\ \ \ \ \ update\_arena\_top\_priority(\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}},\ new\_priority\ );}
\DoxyCodeLine{00781\ }
\DoxyCodeLine{00782\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ my\_global\_top\_priority\ <\ new\_priority\ )\ \{}
\DoxyCodeLine{00783\ \ \ \ \ \ \ \ \ update\_global\_top\_priority(new\_priority);}
\DoxyCodeLine{00784\ \ \ \ \ \}}
\DoxyCodeLine{00785\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ my\_global\_top\_priority\ ==\ new\_priority\ )\ \{}
\DoxyCodeLine{00786\ \ \ \ \ \ \ \ \ advance\_global\_reload\_epoch();}
\DoxyCodeLine{00787\ \ \ \ \ \}}
\DoxyCodeLine{00788\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00789\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ new\_priority\ <\ my\_global\_top\_priority,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00790\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ new\_priority\ >\ my\_global\_bottom\_priority,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00791\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ ==\ my\_global\_top\_priority\ \&\&\ !my\_priority\_levels[\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}].workers\_requested\ )\ \{}
\DoxyCodeLine{00792\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Global\ top\ level\ became\ empty}}
\DoxyCodeLine{00793\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ my\_global\_bottom\_priority\ <\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00794\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ -\/-\/\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}};\ !my\_priority\_levels[\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}].workers\_requested;\ -\/-\/\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ )\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00795\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ >=\ new\_priority,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \ \ \ \ \ \ update\_global\_top\_priority(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ \ \ \ \ highest\_affected\_level\ =\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}};}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00799\ \ \ \ \ \}}
\DoxyCodeLine{00800\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ ==\ my\_global\_bottom\_priority\ )\ \{}
\DoxyCodeLine{00801\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Arena\ priority\ was\ increased\ from\ the\ global\ bottom\ level.}}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ <\ new\_priority,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00803\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ new\_priority\ <=\ my\_global\_top\_priority,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00804\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\ my\_global\_bottom\_priority\ <\ my\_global\_top\_priority}
\DoxyCodeLine{00805\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ !my\_priority\_levels[my\_global\_bottom\_priority].workers\_requested\ )}
\DoxyCodeLine{00806\ \ \ \ \ \ \ \ \ \ \ \ \ ++my\_global\_bottom\_priority;}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ my\_global\_bottom\_priority\ <=\ new\_priority,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00808\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ my\_priority\_levels[my\_global\_bottom\_priority].workers\_requested\ >\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00809\ \ \ \ \ \}}
\DoxyCodeLine{00810\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_ae02e2394f18a6c25a022fa44be65d317}{update\_allotment}}(\ highest\_affected\_level\ );}
\DoxyCodeLine{00811\ }
\DoxyCodeLine{00812\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ my\_global\_top\_priority\ >=\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}.my\_top\_priority,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00813\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market_abac77eac68e7a47e3edde883ff7a59ab}{assert\_market\_valid}}();}
\DoxyCodeLine{00814\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00815\ \}}
\DoxyCodeLine{00816\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_PRIORITY\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00817\ }
\DoxyCodeLine{00818\ \}\ \textcolor{comment}{//\ namespace\ internal}}
\DoxyCodeLine{00819\ \}\ \textcolor{comment}{//\ namespace\ tbb}}

\end{DoxyCode}
