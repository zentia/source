\doxysection{scheduler.\+cpp}
\hypertarget{scheduler_8cpp_source}{}\label{scheduler_8cpp_source}\index{external/taskflow/3rd-\/party/tbb/src/tbb/scheduler.cpp@{external/taskflow/3rd-\/party/tbb/src/tbb/scheduler.cpp}}
\mbox{\hyperlink{scheduler_8cpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ \ \ \ Copyright\ (c)\ 2005-\/2020\ Intel\ Corporation}}
\DoxyCodeLine{00003\ \textcolor{comment}{}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ \ \ \ Licensed\ under\ the\ Apache\ License,\ Version\ 2.0\ (the\ "{}License"{});}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ \ \ \ you\ may\ not\ use\ this\ file\ except\ in\ compliance\ with\ the\ License.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ \ \ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00007\ \textcolor{comment}{}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ \ \ \ \ \ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00009\ \textcolor{comment}{}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ \ \ \ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,\ software}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ \ \ \ distributed\ under\ the\ License\ is\ distributed\ on\ an\ "{}AS\ IS"{}\ BASIS,}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ \ \ \ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY\ KIND,\ either\ express\ or\ implied.}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ \ \ \ See\ the\ License\ for\ the\ specific\ language\ governing\ permissions\ and}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ \ \ \ limitations\ under\ the\ License.}}
\DoxyCodeLine{00015\ \textcolor{comment}{*/}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{custom__scheduler_8h}{custom\_scheduler.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{scheduler__utility_8h}{scheduler\_utility.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{governor_8h}{governor.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{market_8h}{market.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{arena_8h}{arena.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mailbox_8h}{mailbox.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{observer__proxy_8h}{observer\_proxy.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tbb__machine_8h}{tbb/tbb\_machine.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{external_2taskflow_23rd-party_2tbb_2include_2tbb_2atomic_8h}{tbb/atomic.h}}"{}}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetbb}{tbb}}\ \{}
\DoxyCodeLine{00028\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetbb_1_1internal}{internal}}\ \{}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00031\ \textcolor{comment}{//\ Library\ initialization}}
\DoxyCodeLine{00032\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00035\ \textcolor{keyword}{extern}\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler}{generic\_scheduler}}*\ (*AllocateSchedulerPtr)(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market}{market}}\&,\ \mbox{\hyperlink{sugar_8h_abb452686968e48b67397da5f97445f5b}{bool}}\ );}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler}{generic\_scheduler}}*\ \mbox{\hyperlink{namespacetbb_1_1internal_a92d3a8ab5ddffa18bed996f6ae90b614}{allocate\_scheduler}}\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1market}{market}}\&\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}},\ \textcolor{keywordtype}{bool}\ genuine\ )\ \{}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacetbb_1_1internal_ad591871709391d65483b97bab0ea0d2c}{AllocateSchedulerPtr}}(\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}},\ genuine);}
\DoxyCodeLine{00039\ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_GROUP\_CONTEXT}}
\DoxyCodeLine{00042\ context\_state\_propagation\_mutex\_type\ the\_context\_state\_propagation\_mutex;}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ uintptr\_t\ the\_context\_state\_propagation\_epoch\ =\ 0;}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00049\ \textcolor{keyword}{static}\ task\_group\_context\ the\_dummy\_context(task\_group\_context::isolated);}
\DoxyCodeLine{00050\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_GROUP\_CONTEXT\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacetbb_1_1internal_a79eac24a14b74800f56ac9321d7e95a6}{Scheduler\_OneTimeInitialization}}\ (\ \textcolor{keywordtype}{bool}\ itt\_present\ )\ \{}
\DoxyCodeLine{00053\ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_ad591871709391d65483b97bab0ea0d2c}{AllocateSchedulerPtr}}\ =\ itt\_present\ ?\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1custom__scheduler_a8b286a7e4beb8de0a14661d0136002fd}{custom\_scheduler<DefaultSchedulerTraits>::allocate\_scheduler}}\ :}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\mbox{\hyperlink{classtbb_1_1internal_1_1custom__scheduler_a8b286a7e4beb8de0a14661d0136002fd}{custom\_scheduler<IntelSchedulerTraits>::allocate\_scheduler}};}
\DoxyCodeLine{00055\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_GROUP\_CONTEXT}}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{comment}{//\ There\ must\ be\ no\ tasks\ belonging\ to\ this\ fake\ task\ group.\ Mark\ invalid\ for\ the\ assert}}
\DoxyCodeLine{00057\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(!(task\_group\_context::low\_unused\_state\_bit\ \&\ (task\_group\_context::low\_unused\_state\_bit-\/1)),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00058\ \ \ \ \ the\_dummy\_context.my\_state\ =\ task\_group\_context::low\_unused\_state\_bit;}
\DoxyCodeLine{00059\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_PRIORITY}}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{comment}{//\ It\ should\ never\ prevent\ tasks\ from\ being\ passed\ to\ execution.}}
\DoxyCodeLine{00061\ \ \ \ \ the\_dummy\_context.my\_priority\ =\ \mbox{\hyperlink{namespacetbb_1_1internal_ae1dadab9152ec72bebfb2827c03846e6}{num\_priority\_levels}}\ -\/\ 1;}
\DoxyCodeLine{00062\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_PRIORITY\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00063\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_GROUP\_CONTEXT\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00064\ \}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00067\ \textcolor{comment}{//\ scheduler\ interface}}
\DoxyCodeLine{00068\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \textcolor{comment}{//\ \ A\ pure\ virtual\ destructor\ should\ still\ have\ a\ body}}
\DoxyCodeLine{00071\ \textcolor{comment}{//\ \ so\ the\ one\ for\ tbb::internal::scheduler::\string~scheduler()\ is\ provided\ here}}
\DoxyCodeLine{00072\ scheduler::\string~scheduler(\ )\ \{\}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00075\ \textcolor{comment}{//\ generic\_scheduler}}
\DoxyCodeLine{00076\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \textcolor{preprocessor}{\#if\ \_MSC\_VER\ \&\&\ !defined(\_\_INTEL\_COMPILER)}}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{comment}{//\ Suppress\ overzealous\ compiler\ warning\ about\ using\ 'this'\ in\ base\ initializer\ list.}}
\DoxyCodeLine{00080\ \textcolor{preprocessor}{\ \ \ \ \#pragma\ warning(push)}}
\DoxyCodeLine{00081\ \textcolor{preprocessor}{\ \ \ \ \#pragma\ warning(disable:4355)}}
\DoxyCodeLine{00082\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a838f6ccf79d7ee8a55843de2f8004759}{generic\_scheduler::generic\_scheduler}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market}{market}}\&\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}},\ \textcolor{keywordtype}{bool}\ genuine\ )}
\DoxyCodeLine{00085\ \ \ \ \ :\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ac652e4a610353888a31352e678955e1b}{my\_market}}(\&\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}})}
\DoxyCodeLine{00086\ \ \ \ \ ,\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_aee56a8b51b71d3f96f9c8cacf00fe845}{my\_random}}(this)}
\DoxyCodeLine{00087\ \ \ \ \ ,\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a8cf8d776a439320e1e001381cf5d4ad7}{my\_ref\_count}}(1)}
\DoxyCodeLine{00088\ \#\mbox{\hyperlink{sugar_8h_a89d24c74d8a8669b882cd54e44029c98}{if}}\ \mbox{\hyperlink{tbb__config_8h_a092a3c4399ffa0a71b6b0e2f6d37e289}{\_\_TBB\_PREVIEW\_RESUMABLE\_TASKS}}}
\DoxyCodeLine{00089\ \ \ \ \ ,\ my\_co\_context(\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}.worker\_stack\_size(),\ genuine\ ?\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ :\ this)}
\DoxyCodeLine{00090\ \#endif}
\DoxyCodeLine{00091\ \ \ \ \ ,\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a4bd421a07fae7a1c9e3fa49e005bb513}{my\_small\_task\_count}}(1)\ \ \ \textcolor{comment}{//\ Extra\ 1\ is\ a\ guard\ reference}}
\DoxyCodeLine{00092\ \#\mbox{\hyperlink{sugar_8h_a89d24c74d8a8669b882cd54e44029c98}{if}}\ \_\_TBB\_SURVIVE\_THREAD\_SWITCH\ \&\&\ \mbox{\hyperlink{tbb__config_8h_a38309364fd051369c922cf49210c915d}{TBB\_USE\_ASSERT}}}
\DoxyCodeLine{00093\ \ \ \ \ ,\ my\_cilk\_state(cs\_none)}
\DoxyCodeLine{00094\ \#endif\ \textcolor{comment}{/*\ \_\_TBB\_SURVIVE\_THREAD\_SWITCH\ \&\&\ TBB\_USE\_ASSERT\ */}}
\DoxyCodeLine{00095\ \{}
\DoxyCodeLine{00096\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a35aa72cfdda3b500e908925a3d6da747}{my\_arena\_index}},\ \textcolor{stringliteral}{"{}constructor\ expects\ the\ memory\ being\ zero-\/initialized"{}}\ );}
\DoxyCodeLine{00097\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_a14d4453f34a770b1c983c2ed38570e31}{governor::is\_set}}(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}),\ \textcolor{stringliteral}{"{}scheduler\ is\ already\ initialized\ for\ this\ thread"{}}\ );}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_aac9af4d8baddbbc2af433e11297be8a5}{my\_innermost\_running\_task}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_abc495d5b077a2ef1b05e15e820555d90}{my\_dummy\_task}}\ =\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_aa0d316e9f3063c6b57fa21e0716d4d77}{allocate\_task}}(\ \textcolor{keyword}{sizeof}(task),\ \mbox{\hyperlink{scheduler__common_8h_a0ef18fbe7aa93b76fd4136a153bc2e44}{\_\_TBB\_CONTEXT\_ARG}}(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \&the\_dummy\_context)\ );}
\DoxyCodeLine{00100\ \textcolor{preprocessor}{\#if\ \_\_TBB\_PREVIEW\_CRITICAL\_TASKS}}
\DoxyCodeLine{00101\ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_aed181c52b8462c43272d45e625cd31fa}{my\_properties}}.has\_taken\_critical\_task\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00102\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00103\ \textcolor{preprocessor}{\#if\ \_\_TBB\_PREVIEW\_RESUMABLE\_TASKS}}
\DoxyCodeLine{00104\ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_aed181c52b8462c43272d45e625cd31fa}{my\_properties}}.genuine\ =\ genuine;}
\DoxyCodeLine{00105\ \ \ \ \ my\_current\_is\_recalled\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00106\ \ \ \ \ my\_post\_resume\_action\ =\ PRA\_NONE;}
\DoxyCodeLine{00107\ \ \ \ \ my\_post\_resume\_arg\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00108\ \ \ \ \ my\_wait\_task\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00109\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00110\ \ \ \ \ suppress\_unused\_warning(genuine);}
\DoxyCodeLine{00111\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00112\ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_aed181c52b8462c43272d45e625cd31fa}{my\_properties}}.outermost\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00113\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_PRIORITY}}
\DoxyCodeLine{00114\ \ \ \ \ my\_ref\_top\_priority\ =\ \&\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}.my\_global\_top\_priority;}
\DoxyCodeLine{00115\ \ \ \ \ my\_ref\_reload\_epoch\ =\ \&\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}.my\_global\_reload\_epoch;}
\DoxyCodeLine{00116\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_PRIORITY\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00117\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_GROUP\_CONTEXT}}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{comment}{//\ Sync\ up\ the\ local\ cancellation\ state\ with\ the\ global\ one.\ No\ need\ for\ fence\ here.}}
\DoxyCodeLine{00119\ \ \ \ \ my\_context\_state\_propagation\_epoch\ =\ the\_context\_state\_propagation\_epoch;}
\DoxyCodeLine{00120\ \ \ \ \ my\_context\_list\_head.my\_prev\ =\ \&my\_context\_list\_head;}
\DoxyCodeLine{00121\ \ \ \ \ my\_context\_list\_head.my\_next\ =\ \&my\_context\_list\_head;}
\DoxyCodeLine{00122\ \ \ \ \ \mbox{\hyperlink{itt__notify_8h_a7e0f29d1fe322261ee07367d0cdf2563}{ITT\_SYNC\_CREATE}}(\&my\_context\_list\_mutex,\ SyncType\_Scheduler,\ SyncObj\_ContextsList);}
\DoxyCodeLine{00123\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_GROUP\_CONTEXT\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00124\ \ \ \ \ \mbox{\hyperlink{itt__notify_8h_a7e0f29d1fe322261ee07367d0cdf2563}{ITT\_SYNC\_CREATE}}(\&\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_abc495d5b077a2ef1b05e15e820555d90}{my\_dummy\_task}}-\/>prefix().ref\_count,\ SyncType\_Scheduler,\ SyncObj\_WorkerLifeCycleMgmt);}
\DoxyCodeLine{00125\ \ \ \ \ \mbox{\hyperlink{itt__notify_8h_a7e0f29d1fe322261ee07367d0cdf2563}{ITT\_SYNC\_CREATE}}(\&\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ab5777a002f8b7b3a72cb7fc4a477fb29}{my\_return\_list}},\ SyncType\_Scheduler,\ SyncObj\_TaskReturnList);}
\DoxyCodeLine{00126\ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \textcolor{preprocessor}{\#if\ \_MSC\_VER\ \&\&\ !defined(\_\_INTEL\_COMPILER)}}
\DoxyCodeLine{00129\ \textcolor{preprocessor}{\ \ \ \ \#pragma\ warning(pop)}}
\DoxyCodeLine{00130\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ warning\ 4355\ is\ back}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \textcolor{preprocessor}{\#if\ TBB\_USE\_ASSERT\ >\ 1}}
\DoxyCodeLine{00133\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_adc904ecbeb053f061c66edd8e85ac704}{generic\_scheduler::assert\_task\_pool\_valid}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}\ )}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00136\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ae1cf7dda46c2687a1ea7edacbea10da1}{acquire\_task\_pool}}();}
\DoxyCodeLine{00137\ \ \ \ \ task**\ tp\ =\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr;}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>my\_task\_pool\_size\ )}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>my\_task\_pool\_size\ >=\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1190ee0529a9280846bd50c4f50c8398}{min\_task\_pool\_size}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{gnuplot__common__settings_8hh_a1312167399d185be316962d53af87c87}{H}}\ =\ \_\_TBB\_load\_relaxed(\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>head);\ \textcolor{comment}{//\ mirror}}
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ =\ \_\_TBB\_load\_relaxed(\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>tail);\ \textcolor{comment}{//\ mirror}}
\DoxyCodeLine{00142\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{gnuplot__common__settings_8hh_a1312167399d185be316962d53af87c87}{H}}\ <=\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ \mbox{\hyperlink{gnuplot__common__settings_8hh_a1312167399d185be316962d53af87c87}{H}};\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ )}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ tp[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]\ ==\ poisoned\_ptr,\ \textcolor{stringliteral}{"{}Task\ pool\ corrupted"{}}\ );}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ \mbox{\hyperlink{gnuplot__common__settings_8hh_a1312167399d185be316962d53af87c87}{H}};\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}};\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ )\ \{}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ tp[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]\ )\ \{}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a35e1c039fac0fa1b7d8b4f491d557a86}{assert\_task\_valid}}(\ tp[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]\ );}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ tp[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>prefix().state\ ==\ task::ready\ ||}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tp[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>prefix().extra\_state\ ==\ \mbox{\hyperlink{namespacetbb_1_1internal_a5fb219223e38c8bbcc47d7c943f48e54a2b1c67cc200577a0b07649fdb00bec49}{es\_task\_proxy}},\ \textcolor{stringliteral}{"{}task\ in\ the\ deque\ has\ invalid\ state"{}}\ );}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00151\ \ \ \ \ \}}
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}};\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>my\_task\_pool\_size;\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ )}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ tp[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]\ ==\ poisoned\_ptr,\ \textcolor{stringliteral}{"{}Task\ pool\ corrupted"{}}\ );}
\DoxyCodeLine{00154\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a6ff28eab04933075791b16075ceb5950}{release\_task\_pool}}();}
\DoxyCodeLine{00155\ \}}
\DoxyCodeLine{00156\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ TBB\_USE\_ASSERT\ >\ 1\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00158\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_afd799eae7903abc75b7a7aafd36e20db}{generic\_scheduler::init\_stack\_info}}\ ()\ \{}
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{comment}{//\ Stacks\ are\ growing\ top-\/down.\ Highest\ address\ is\ called\ "{}stack\ base"{},}}
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{comment}{//\ and\ the\ lowest\ is\ "{}stack\ limit"{}.}}
\DoxyCodeLine{00161\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ade9f23ce97db8725a9c3718e76aa682d}{my\_stealing\_threshold}},\ \textcolor{stringliteral}{"{}Stealing\ threshold\ has\ already\ been\ calculated"{}}\ );}
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ stack\_size\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ac652e4a610353888a31352e678955e1b}{my\_market}}-\/>worker\_stack\_size();}
\DoxyCodeLine{00163\ \textcolor{preprocessor}{\#if\ USE\_WINTHREAD}}
\DoxyCodeLine{00164\ \textcolor{preprocessor}{\#if\ defined(\_MSC\_VER)\&\&\_MSC\_VER<1400\ \&\&\ !\_WIN64}}
\DoxyCodeLine{00165\ \ \ \ \ NT\_TIB\ \ *pteb;}
\DoxyCodeLine{00166\ \ \ \ \ \_\_asm\ mov\ eax,\ fs:[0x18]}
\DoxyCodeLine{00167\ \ \ \ \ \_\_asm\ mov\ pteb,\ eax}
\DoxyCodeLine{00168\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00169\ \ \ \ \ NT\_TIB\ \ *pteb\ =\ (NT\_TIB*)NtCurrentTeb();}
\DoxyCodeLine{00170\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00171\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \&pteb\ <\ pteb-\/>StackBase\ \&\&\ \&pteb\ >\ pteb-\/>StackLimit,\ \textcolor{stringliteral}{"{}invalid\ stack\ info\ in\ TEB"{}}\ );}
\DoxyCodeLine{00172\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ stack\_size\ >0,\ \textcolor{stringliteral}{"{}stack\_size\ not\ initialized?"{}}\ );}
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{comment}{//\ When\ a\ thread\ is\ created\ with\ the\ attribute\ STACK\_SIZE\_PARAM\_IS\_A\_RESERVATION,\ stack\ limit}}
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{comment}{//\ in\ the\ TIB\ points\ to\ the\ committed\ part\ of\ the\ stack\ only.\ This\ renders\ the\ expression}}
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{comment}{//\ "{}(uintptr\_t)pteb-\/>StackBase\ /\ 2\ +\ (uintptr\_t)pteb-\/>StackLimit\ /\ 2"{}\ virtually\ useless.}}
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{comment}{//\ Thus\ for\ worker\ threads\ we\ use\ the\ explicit\ stack\ size\ we\ used\ while\ creating\ them.}}
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{comment}{//\ And\ for\ master\ threads\ we\ rely\ on\ the\ following\ fact\ and\ assumption:}}
\DoxyCodeLine{00178\ \ \ \ \ \textcolor{comment}{//\ -\/\ the\ default\ stack\ size\ of\ a\ master\ thread\ on\ Windows\ is\ 1M;}}
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{comment}{//\ -\/\ if\ it\ was\ explicitly\ set\ by\ the\ application\ it\ is\ at\ least\ as\ large\ as\ the\ size\ of\ a\ worker\ stack.}}
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a24ecab941cdf8ff762126f1c65e5274a}{is\_worker}}()\ ||\ stack\_size\ <\ \mbox{\hyperlink{namespacetbb_1_1internal_a62737658527916cac71cf5361606656e}{MByte}}\ )}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ade9f23ce97db8725a9c3718e76aa682d}{my\_stealing\_threshold}}\ =\ (uintptr\_t)pteb-\/>StackBase\ -\/\ stack\_size\ /\ 2;}
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ade9f23ce97db8725a9c3718e76aa682d}{my\_stealing\_threshold}}\ =\ (uintptr\_t)pteb-\/>StackBase\ -\/\ \mbox{\hyperlink{namespacetbb_1_1internal_a62737658527916cac71cf5361606656e}{MByte}}\ /\ 2;}
\DoxyCodeLine{00184\ \textcolor{preprocessor}{\#else\ }\textcolor{comment}{/*\ USE\_PTHREAD\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{comment}{//\ There\ is\ no\ portable\ way\ to\ get\ stack\ base\ address\ in\ Posix,\ so\ we\ use}}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{comment}{//\ non-\/portable\ method\ (on\ all\ modern\ Linux)\ or\ the\ simplified\ approach}}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{comment}{//\ based\ on\ the\ common\ sense\ assumptions.\ The\ most\ important\ assumption}}
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{comment}{//\ is\ that\ the\ main\ thread's\ stack\ size\ is\ not\ less\ than\ that\ of\ other\ threads.}}
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{comment}{//\ See\ also\ comment\ 3\ at\ the\ end\ of\ this\ file}}
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{keywordtype}{void}\ \ \ \ *stack\_base\ =\ \&stack\_size;}
\DoxyCodeLine{00191\ \textcolor{preprocessor}{\#if\ \_\_linux\_\_\ \&\&\ !\_\_bg\_\_}}
\DoxyCodeLine{00192\ \textcolor{preprocessor}{\#if\ \_\_TBB\_ipf}}
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{keywordtype}{void}\ \ \ \ *rsb\_base\ =\ \mbox{\hyperlink{linux__ia64_8h_ad5657a41dbedfab5a94916d82d3f6778}{\_\_TBB\_get\_bsp}}();}
\DoxyCodeLine{00194\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ np\_stack\_size\ =\ 0;}
\DoxyCodeLine{00196\ \ \ \ \ \textcolor{comment}{//\ Points\ to\ the\ lowest\ addressable\ byte\ of\ a\ stack.}}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keywordtype}{void}\ \ \ \ *stack\_limit\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \textcolor{preprocessor}{\#if\ \_\_TBB\_PREVIEW\_RESUMABLE\_TASKS}}
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_aed181c52b8462c43272d45e625cd31fa}{my\_properties}}.genuine\ )\ \{}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ stack\_limit\ =\ my\_co\_context.get\_stack\_limit();}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ (uintptr\_t)stack\_base\ >\ (uintptr\_t)stack\_limit,\ \textcolor{stringliteral}{"{}stack\ size\ must\ be\ positive"{}}\ );}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Size\ of\ the\ stack\ free\ part}}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ stack\_size\ =\ size\_t((\textcolor{keywordtype}{char}*)stack\_base\ -\/\ (\textcolor{keywordtype}{char}*)stack\_limit);}
\DoxyCodeLine{00205\ \ \ \ \ \}}
\DoxyCodeLine{00206\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \ \ \ \ \mbox{\hyperlink{pthread__minport__windows_8h_ad1483d9532e78abdc68abd50693a3bb6}{pthread\_attr\_t}}\ \ np\_attr\_stack;}
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{keywordflow}{if}(\ !stack\_limit\ \&\&\ 0\ ==\ pthread\_getattr\_np(\mbox{\hyperlink{pthread__minport__windows_8h_a31ffbf449d7404f9bb088564190c6bce}{pthread\_self}}(),\ \&np\_attr\_stack)\ )\ \{}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ 0\ ==\ pthread\_attr\_getstack(\&np\_attr\_stack,\ \&stack\_limit,\ \&np\_stack\_size)\ )\ \{}
\DoxyCodeLine{00211\ \textcolor{preprocessor}{\#if\ \_\_TBB\_ipf}}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pthread__minport__windows_8h_ad1483d9532e78abdc68abd50693a3bb6}{pthread\_attr\_t}}\ \ attr\_stack;}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ 0\ ==\ \mbox{\hyperlink{pthread__minport__windows_8h_a5c66c9042370b9d9220428bbd0108da0}{pthread\_attr\_init}}(\&attr\_stack)\ )\ \{}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ 0\ ==\ pthread\_attr\_getstacksize(\&attr\_stack,\ \&stack\_size)\ )\ \{}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ np\_stack\_size\ <\ stack\_size\ )\ \{}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ are\ in\ a\ secondary\ thread.\ Use\ reliable\ data.}}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ IA-\/64\ architecture\ stack\ is\ split\ into\ RSE\ backup\ and\ memory\ parts}}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rsb\_base\ =\ stack\_limit;}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ stack\_size\ =\ np\_stack\_size/2;}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Limit\ of\ the\ memory\ part\ of\ the\ stack}}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ stack\_limit\ =\ (\textcolor{keywordtype}{char}*)stack\_limit\ +\ stack\_size;}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ are\ either\ in\ the\ main\ thread\ or\ this\ thread\ stack}}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ is\ bigger\ that\ that\ of\ the\ main\ one.\ As\ we\ cannot\ discern}}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ these\ cases\ we\ fall\ back\ to\ the\ default\ (heuristic)\ values.}}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pthread__minport__windows_8h_a2836afab79bfa407e60adab6001b0c73}{pthread\_attr\_destroy}}(\&attr\_stack);}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ IA-\/64\ architecture\ stack\ is\ split\ into\ RSE\ backup\ and\ memory\ parts}}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ my\_rsb\_stealing\_threshold\ =\ (uintptr\_t)((\textcolor{keywordtype}{char}*)rsb\_base\ +\ stack\_size/2);}
\DoxyCodeLine{00231\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_ipf\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ pthread\_attr\_getstack\ cannot\ be\ used\ with\ Intel(R)\ Cilk(TM)\ Plus}}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \_\_TBB\_ASSERT(\ (uintptr\_t)stack\_base\ >\ (uintptr\_t)stack\_limit,\ "{}stack\ size\ must\ be\ positive"{}\ );}}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Size\ of\ the\ stack\ free\ part}}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ \ \ stack\_size\ =\ size\_t((\textcolor{keywordtype}{char}*)stack\_base\ -\/\ (\textcolor{keywordtype}{char}*)stack\_limit);}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pthread__minport__windows_8h_a2836afab79bfa407e60adab6001b0c73}{pthread\_attr\_destroy}}(\&np\_attr\_stack);}
\DoxyCodeLine{00238\ \ \ \ \ \}}
\DoxyCodeLine{00239\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_linux\_\_\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00240\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ stack\_size>0,\ \textcolor{stringliteral}{"{}stack\ size\ must\ be\ positive"{}}\ );}
\DoxyCodeLine{00241\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ade9f23ce97db8725a9c3718e76aa682d}{my\_stealing\_threshold}}\ =\ (uintptr\_t)((\textcolor{keywordtype}{char}*)stack\_base\ -\/\ stack\_size/2);}
\DoxyCodeLine{00242\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ USE\_PTHREAD\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00243\ \}}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_GROUP\_CONTEXT}\textcolor{preprocessor}{}}
\DoxyCodeLine{00251\ \textcolor{keywordtype}{void}\ generic\_scheduler::cleanup\_local\_context\_list\ ()\ \{}
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{comment}{//\ Detach\ contexts\ remaining\ in\ the\ local\ list}}
\DoxyCodeLine{00253\ \ \ \ \ \textcolor{keywordtype}{bool}\ wait\_for\_concurrent\_destroyers\_to\_leave\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00254\ \ \ \ \ uintptr\_t\ local\_count\_snapshot\ =\ my\_context\_state\_propagation\_epoch;}
\DoxyCodeLine{00255\ \ \ \ \ my\_local\_ctx\_list\_update.store<\mbox{\hyperlink{namespacetbb_adb86d08473679d6fe0eabcdc766ffe3aa73cb2e2bcb94442b8b2b72e93a76f2e5}{relaxed}}>(1);}
\DoxyCodeLine{00256\ \ \ \ \ \{}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ is\ just\ a\ definition.\ Actual\ lock\ is\ acquired\ only\ in\ case\ of\ conflict.}}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1spin__mutex_1_1scoped__lock}{spin\_mutex::scoped\_lock}}\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}};}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Full\ fence\ prevents\ reordering\ of\ store\ to\ my\_local\_ctx\_list\_update\ with}}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ load\ from\ my\_nonlocal\_ctx\_list\_update.}}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ atomic\_fence();}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ for\ the\ conflict\ with\ concurrent\ destroyer\ or\ cancellation\ propagator}}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ my\_nonlocal\_ctx\_list\_update.load<\mbox{\hyperlink{namespacetbb_adb86d08473679d6fe0eabcdc766ffe3aa73cb2e2bcb94442b8b2b72e93a76f2e5}{relaxed}}>()\ ||\ local\_count\_snapshot\ !=\ the\_context\_state\_propagation\_epoch\ )}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}.acquire(my\_context\_list\_mutex);}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ acquire\ fence\ is\ necessary\ for\ loading\ my\_context\_list\_head.my\_next,}}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ as\ the\ list\ can\ be\ updated\ by\ this\ thread\ only.}}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ context\_list\_node\_t\ *node\ =\ my\_context\_list\_head.my\_next;}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\ node\ !=\ \&my\_context\_list\_head\ )\ \{}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ \ \ task\_group\_context\ \&ctx\ =\ \_\_TBB\_get\_object\_ref(task\_group\_context,\ my\_node,\ node);}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \_\_TBB\_load\_relaxed(ctx.my\_kind)\ !=\ task\_group\_context::binding\_required,\ \textcolor{stringliteral}{"{}Only\ a\ context\ bound\ to\ a\ root\ task\ can\ be\ detached"{}}\ );}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \ \ node\ =\ node-\/>my\_next;}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ is\_alive(ctx.my\_version\_and\_traits),\ \textcolor{stringliteral}{"{}Walked\ into\ a\ destroyed\ context\ while\ detaching\ contexts\ from\ the\ local\ list"{}}\ );}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Synchronizes\ with\ \string~task\_group\_context().\ TODO:\ evaluate\ and\ perhaps\ relax}}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{namespacetbb_1_1internal_a958f482f9d5f3476ca70610af5336040}{internal::as\_atomic}}(ctx.my\_kind).fetch\_and\_store(task\_group\_context::detached)\ ==\ task\_group\_context::dying\ )}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ wait\_for\_concurrent\_destroyers\_to\_leave\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00277\ \ \ \ \ \}}
\DoxyCodeLine{00278\ \ \ \ \ my\_local\_ctx\_list\_update.store<\mbox{\hyperlink{namespacetbb_adb86d08473679d6fe0eabcdc766ffe3aa412563418e657114a102db610f726632}{release}}>(0);}
\DoxyCodeLine{00279\ \ \ \ \ \textcolor{comment}{//\ Wait\ until\ other\ threads\ referencing\ this\ scheduler\ object\ finish\ with\ it}}
\DoxyCodeLine{00280\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ wait\_for\_concurrent\_destroyers\_to\_leave\ )}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ spin\_wait\_until\_eq(\ my\_nonlocal\_ctx\_list\_update,\ 0\mbox{\hyperlink{external_2taskflow_23rd-party_2tbb_2examples_2parallel__for_2seismic_2main_8cpp_a2a671aca47b8db55cef1dd7174adad6f}{u}}\ );}
\DoxyCodeLine{00282\ \}}
\DoxyCodeLine{00283\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_GROUP\_CONTEXT\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_aafb98e4ad94437efc212376f2a8c9d8a}{generic\_scheduler::destroy}}()\ \{}
\DoxyCodeLine{00286\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a4bd421a07fae7a1c9e3fa49e005bb513}{my\_small\_task\_count}}\ ==\ 0,\ \textcolor{stringliteral}{"{}The\ scheduler\ is\ still\ in\ use."{}});}
\DoxyCodeLine{00287\ \ \ \ \ this-\/>\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a838f6ccf79d7ee8a55843de2f8004759}{\string~generic\_scheduler}}();}
\DoxyCodeLine{00288\ \textcolor{preprocessor}{\#if\ TBB\_USE\_DEBUG}}
\DoxyCodeLine{00289\ \ \ \ \ memset((\textcolor{keywordtype}{void}*)\textcolor{keyword}{this},\ -\/1,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a838f6ccf79d7ee8a55843de2f8004759}{generic\_scheduler}}));}
\DoxyCodeLine{00290\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00291\ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_abd3fdd42ea716867fc95116354481b4e}{NFS\_Free}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00292\ \}}
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00294\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a9ad40233836bbb816156a5dacf206089}{generic\_scheduler::cleanup\_scheduler}}()\ \{}
\DoxyCodeLine{00295\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00296\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_PRIORITY}}
\DoxyCodeLine{00297\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ my\_offloaded\_tasks\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00298\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00299\ \textcolor{preprocessor}{\#if\ \_\_TBB\_PREVIEW\_CRITICAL\_TASKS}}
\DoxyCodeLine{00300\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_aed181c52b8462c43272d45e625cd31fa}{my\_properties}}.has\_taken\_critical\_task,\ \textcolor{stringliteral}{"{}Critical\ tasks\ miscount."{}}\ );}
\DoxyCodeLine{00301\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00302\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_GROUP\_CONTEXT}}
\DoxyCodeLine{00303\ \ \ \ \ cleanup\_local\_context\_list();}
\DoxyCodeLine{00304\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_GROUP\_CONTEXT\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00305\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a12dd37171af77214add72a973e6b71ba}{free\_task<small\_local\_task>}}(\ *\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_abc495d5b077a2ef1b05e15e820555d90}{my\_dummy\_task}}\ );}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ \textcolor{preprocessor}{\#if\ \_\_TBB\_HOARD\_NONLOCAL\_TASKS}}
\DoxyCodeLine{00308\ \ \ \ \ \textcolor{keywordflow}{while}(\ task*\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ my\_nonlocal\_free\_list\ )\ \{}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ task\_prefix\&\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix();}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ my\_nonlocal\_free\_list\ =\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}.next;}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}.origin\ \&\&\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}.origin!=\textcolor{keyword}{this},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a720c816c0253fe199e4583cd24090e9b}{free\_nonlocal\_small\_task}}(*\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}});}
\DoxyCodeLine{00313\ \ \ \ \ \}}
\DoxyCodeLine{00314\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00315\ \ \ \ \ \textcolor{comment}{//\ k\ accounts\ for\ a\ guard\ reference\ and\ each\ task\ that\ we\ deallocate.}}
\DoxyCodeLine{00316\ \ \ \ \ intptr\_t\ k\ =\ 1;}
\DoxyCodeLine{00317\ \ \ \ \ \textcolor{keywordflow}{for}(;;)\ \{}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ task*\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a52ed26dede8410a72f37bce24cb26239}{my\_free\_list}}\ )\ \{}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a52ed26dede8410a72f37bce24cb26239}{my\_free\_list}}\ =\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().next;}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ad965858a5e7cb5574926d8d1692063b5}{deallocate\_task}}(*\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}});}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \ \ \ \ ++k;}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ab5777a002f8b7b3a72cb7fc4a477fb29}{my\_return\_list}}==\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a190c2087092b3e0f2a39b01c7cc27e93}{plugged\_return\_list}}()\ )}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a52ed26dede8410a72f37bce24cb26239}{my\_free\_list}}\ =\ (task*)\_\_TBB\_FetchAndStoreW(\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ab5777a002f8b7b3a72cb7fc4a477fb29}{my\_return\_list}},\ (intptr\_t)\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a190c2087092b3e0f2a39b01c7cc27e93}{plugged\_return\_list}}()\ );}
\DoxyCodeLine{00326\ \ \ \ \ \}}
\DoxyCodeLine{00327\ \textcolor{preprocessor}{\#if\ \_\_TBB\_COUNT\_TASK\_NODES}}
\DoxyCodeLine{00328\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ac652e4a610353888a31352e678955e1b}{my\_market}}-\/>update\_task\_node\_count(\ my\_task\_node\_count\ );}
\DoxyCodeLine{00329\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_COUNT\_TASK\_NODES\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00330\ \ \ \ \ \textcolor{comment}{//\ Update\ my\_small\_task\_count\ last.\ \ Doing\ so\ sooner\ might\ cause\ another\ thread\ to\ free\ *this.}}
\DoxyCodeLine{00331\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a4bd421a07fae7a1c9e3fa49e005bb513}{my\_small\_task\_count}}>=k,\ \textcolor{stringliteral}{"{}my\_small\_task\_count\ corrupted"{}}\ );}
\DoxyCodeLine{00332\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_a46a6d847486220d3eab529c78bd883ed}{governor::sign\_off}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00333\ \ \ \ \ \textcolor{keywordflow}{if}(\ \_\_TBB\_FetchAndAddW(\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a4bd421a07fae7a1c9e3fa49e005bb513}{my\_small\_task\_count}},\ -\/k\ )==k\ )}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_aafb98e4ad94437efc212376f2a8c9d8a}{destroy}}();}
\DoxyCodeLine{00335\ \}}
\DoxyCodeLine{00336\ }
\DoxyCodeLine{00337\ task\&\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_aa0d316e9f3063c6b57fa21e0716d4d77}{generic\_scheduler::allocate\_task}}(\ \textcolor{keywordtype}{size\_t}\ number\_of\_bytes,}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{scheduler__common_8h_a0ef18fbe7aa93b76fd4136a153bc2e44}{\_\_TBB\_CONTEXT\_ARG}}(task*\ \mbox{\hyperlink{ittnotify__static_8h_ab242ec323769be8fbbf53617a69d14ff}{parent}},\ task\_group\_context*\ \mbox{\hyperlink{classcontext}{context}})\ )\ \{}
\DoxyCodeLine{00339\ \ \ \ \ \mbox{\hyperlink{tbb__statistics_8h_a08f1e46bb511c63da3ce07aa9c897bc4}{GATHER\_STATISTIC}}(++my\_counters.active\_tasks);}
\DoxyCodeLine{00340\ \ \ \ \ task\ *\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}};}
\DoxyCodeLine{00341\ \ \ \ \ \textcolor{keywordflow}{if}(\ number\_of\_bytes<=\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_afbb75edc69c2ed1bcbf70098ca24a523}{quick\_task\_size}}\ )\ \{}
\DoxyCodeLine{00342\ \textcolor{preprocessor}{\#if\ \_\_TBB\_HOARD\_NONLOCAL\_TASKS}}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ (\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ my\_nonlocal\_free\_list)\ )\ \{}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__statistics_8h_a08f1e46bb511c63da3ce07aa9c897bc4}{GATHER\_STATISTIC}}(-\/-\/my\_counters.free\_list\_length);}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>state()==task::freed,\ \textcolor{stringliteral}{"{}free\ list\ of\ tasks\ is\ corrupted"{}}\ );}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \ \ \ \ my\_nonlocal\_free\_list\ =\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().next;}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00348\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ (\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a52ed26dede8410a72f37bce24cb26239}{my\_free\_list}})\ )\ \{}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__statistics_8h_a08f1e46bb511c63da3ce07aa9c897bc4}{GATHER\_STATISTIC}}(-\/-\/my\_counters.free\_list\_length);}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>state()==task::freed,\ \textcolor{stringliteral}{"{}free\ list\ of\ tasks\ is\ corrupted"{}}\ );}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a52ed26dede8410a72f37bce24cb26239}{my\_free\_list}}\ =\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().next;}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ab5777a002f8b7b3a72cb7fc4a477fb29}{my\_return\_list}}\ )\ \{}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ fence\ required\ for\ read\ of\ my\_return\_list\ above,\ because\ \_\_TBB\_FetchAndStoreW\ has\ a\ fence.}}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ (task*)\_\_TBB\_FetchAndStoreW(\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ab5777a002f8b7b3a72cb7fc4a477fb29}{my\_return\_list}},\ 0\ );\ \textcolor{comment}{//\ with\ acquire}}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}},\ \textcolor{stringliteral}{"{}another\ thread\ emptied\ the\ my\_return\_list"{}}\ );}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().origin==\textcolor{keyword}{this},\ \textcolor{stringliteral}{"{}task\ returned\ to\ wrong\ my\_return\_list"{}}\ );}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{itt__notify_8h_adf75d9635323cc786c012fe69ceef418}{ITT\_NOTIFY}}(\ sync\_acquired,\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ab5777a002f8b7b3a72cb7fc4a477fb29}{my\_return\_list}}\ );}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a52ed26dede8410a72f37bce24cb26239}{my\_free\_list}}\ =\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().next;}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ (task*)((\textcolor{keywordtype}{char}*)\mbox{\hyperlink{namespacetbb_1_1internal_a395611542e21705f49de2a06e2c88f59}{NFS\_Allocate}}(\ 1,\ \mbox{\hyperlink{namespacetbb_1_1internal_a0630d59441f75e740be0b003d2922df8}{task\_prefix\_reservation\_size}}+\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_afbb75edc69c2ed1bcbf70098ca24a523}{quick\_task\_size}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ )\ +\ \mbox{\hyperlink{namespacetbb_1_1internal_a0630d59441f75e740be0b003d2922df8}{task\_prefix\_reservation\_size}}\ );}
\DoxyCodeLine{00362\ \textcolor{preprocessor}{\#if\ \_\_TBB\_COUNT\_TASK\_NODES}}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \ \ \ \ ++my\_task\_node\_count;}
\DoxyCodeLine{00364\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_COUNT\_TASK\_NODES\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().origin\ =\ \textcolor{keyword}{this};}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().next\ =\ 0;}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \ \ \ \ ++\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a4bd421a07fae7a1c9e3fa49e005bb513}{my\_small\_task\_count}};}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00369\ \textcolor{preprocessor}{\#if\ \_\_TBB\_PREFETCHING}}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ task\ *t\_next\ =\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().next;}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !t\_next\ )\ \{\ \textcolor{comment}{//\ the\ task\ was\ last\ in\ the\ list}}
\DoxyCodeLine{00372\ \textcolor{preprocessor}{\#if\ \_\_TBB\_HOARD\_NONLOCAL\_TASKS}}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a52ed26dede8410a72f37bce24cb26239}{my\_free\_list}}\ )}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t\_next\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a52ed26dede8410a72f37bce24cb26239}{my\_free\_list}};}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00376\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ab5777a002f8b7b3a72cb7fc4a477fb29}{my\_return\_list}}\ )\ \textcolor{comment}{//\ enable\ prefetching,\ gives\ speedup}}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t\_next\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a52ed26dede8410a72f37bce24cb26239}{my\_free\_list}}\ =\ (task*)\_\_TBB\_FetchAndStoreW(\ \&\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ab5777a002f8b7b3a72cb7fc4a477fb29}{my\_return\_list}},\ 0\ );}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ t\_next\ )\ \{\ \textcolor{comment}{//\ gives\ speedup\ for\ both\ cache\ lines}}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mic__common_8h_a27c1cc70f5f4fa03859cbefc15242743}{\_\_TBB\_cl\_prefetch}}(t\_next);}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mic__common_8h_a27c1cc70f5f4fa03859cbefc15242743}{\_\_TBB\_cl\_prefetch}}(\&t\_next-\/>prefix());}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00384\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_PREFETCHING\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00385\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__statistics_8h_a08f1e46bb511c63da3ce07aa9c897bc4}{GATHER\_STATISTIC}}(++my\_counters.big\_tasks);}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ (task*)((\textcolor{keywordtype}{char}*)\mbox{\hyperlink{namespacetbb_1_1internal_a395611542e21705f49de2a06e2c88f59}{NFS\_Allocate}}(\ 1,\ \mbox{\hyperlink{namespacetbb_1_1internal_a0630d59441f75e740be0b003d2922df8}{task\_prefix\_reservation\_size}}+number\_of\_bytes,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ )\ +\ \mbox{\hyperlink{namespacetbb_1_1internal_a0630d59441f75e740be0b003d2922df8}{task\_prefix\_reservation\_size}}\ );}
\DoxyCodeLine{00388\ \textcolor{preprocessor}{\#if\ \_\_TBB\_COUNT\_TASK\_NODES}}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ ++my\_task\_node\_count;}
\DoxyCodeLine{00390\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_COUNT\_TASK\_NODES\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().origin\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00392\ \ \ \ \ \}}
\DoxyCodeLine{00393\ \ \ \ \ task\_prefix\&\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix();}
\DoxyCodeLine{00394\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_GROUP\_CONTEXT}}
\DoxyCodeLine{00395\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}.context\ =\ \mbox{\hyperlink{classcontext}{context}};}
\DoxyCodeLine{00396\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_GROUP\_CONTEXT\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00397\ \ \ \ \ \textcolor{comment}{//\ Obsolete.\ But\ still\ in\ use,\ so\ has\ to\ be\ assigned\ correct\ value\ here.}}
\DoxyCodeLine{00398\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}.owner\ =\ \textcolor{keyword}{this};}
\DoxyCodeLine{00399\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}.ref\_count\ =\ 0;}
\DoxyCodeLine{00400\ \ \ \ \ \textcolor{comment}{//\ Obsolete.\ Assign\ some\ not\ outrageously\ out-\/of-\/place\ value\ for\ a\ while.}}
\DoxyCodeLine{00401\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}.depth\ =\ 0;}
\DoxyCodeLine{00402\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}.parent\ =\ \mbox{\hyperlink{ittnotify__static_8h_ab242ec323769be8fbbf53617a69d14ff}{parent}};}
\DoxyCodeLine{00403\ \ \ \ \ \textcolor{comment}{//\ In\ TBB\ 2.1\ and\ later,\ the\ constructor\ for\ task\ sets\ extra\_state\ to\ indicate\ the\ version\ of\ the\ tbb/task.h\ header.}}
\DoxyCodeLine{00404\ \ \ \ \ \textcolor{comment}{//\ In\ TBB\ 2.0\ and\ earlier,\ the\ constructor\ leaves\ extra\_state\ as\ zero.}}
\DoxyCodeLine{00405\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}.extra\_state\ =\ 0;}
\DoxyCodeLine{00406\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}.affinity\ =\ 0;}
\DoxyCodeLine{00407\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}.state\ =\ task::allocated;}
\DoxyCodeLine{00408\ \ \ \ \ \mbox{\hyperlink{scheduler__common_8h_a63e9a35b6d2bfbfb21b3199dc03acc6d}{\_\_TBB\_ISOLATION\_EXPR}}(\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}.isolation\ =\ no\_isolation\ );}
\DoxyCodeLine{00409\ \ \ \ \ \textcolor{keywordflow}{return}\ *\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}};}
\DoxyCodeLine{00410\ \}}
\DoxyCodeLine{00411\ }
\DoxyCodeLine{00412\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a720c816c0253fe199e4583cd24090e9b}{generic\_scheduler::free\_nonlocal\_small\_task}}(\ task\&\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ )\ \{}
\DoxyCodeLine{00413\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}.state()==task::freed,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00414\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a838f6ccf79d7ee8a55843de2f8004759}{generic\_scheduler}}\&\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ =\ *\textcolor{keyword}{static\_cast<}\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a838f6ccf79d7ee8a55843de2f8004759}{generic\_scheduler}}*\textcolor{keyword}{>}(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}.prefix().\mbox{\hyperlink{gnuplot__common__settings_8hh_a5e1adf2b06bbfd5f9d9d115f12529481}{origin}});}
\DoxyCodeLine{00415\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \&\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}!=\textcolor{keyword}{this},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00416\ \ \ \ \ \textcolor{keywordflow}{for}(;;)\ \{}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ task*\ old\ =\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}.my\_return\_list;}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ old==\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a190c2087092b3e0f2a39b01c7cc27e93}{plugged\_return\_list}}()\ )}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Atomically\ insert\ t\ at\ head\ of\ s.my\_return\_list}}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}.prefix().next\ =\ old;}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{itt__notify_8h_adf75d9635323cc786c012fe69ceef418}{ITT\_NOTIFY}}(\ \mbox{\hyperlink{ittnotify__static_8h_ac5a347b47a5603a1f30f6fbf790724b7}{sync\_releasing}},\ \&\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}.my\_return\_list\ );}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{namespacetbb_1_1internal_a958f482f9d5f3476ca70610af5336040}{as\_atomic}}(\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}.my\_return\_list).compare\_and\_swap(\&\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}},\ old\ )==old\ )\ \{}
\DoxyCodeLine{00424\ \textcolor{preprocessor}{\#if\ \_\_TBB\_PREFETCHING}}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mic__common_8h_a644c0db3feb5f77ad8bc19a1b775a2a3}{\_\_TBB\_cl\_evict}}(\&\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}.prefix());}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mic__common_8h_a644c0db3feb5f77ad8bc19a1b775a2a3}{\_\_TBB\_cl\_evict}}(\&\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}});}
\DoxyCodeLine{00427\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00430\ \ \ \ \ \}}
\DoxyCodeLine{00431\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ad965858a5e7cb5574926d8d1692063b5}{deallocate\_task}}(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}});}
\DoxyCodeLine{00432\ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{tbb__machine_8h_a58e2509c2723ffe8c2f2a3e73059d65b}{\_\_TBB\_FetchAndDecrementWrelease}}(\ \&\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}.my\_small\_task\_count\ )==1\ )\ \{}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ freed\ the\ last\ task\ allocated\ by\ scheduler\ s,\ so\ it's\ our\ responsibility}}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ to\ free\ the\ scheduler.}}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}.destroy();}
\DoxyCodeLine{00436\ \ \ \ \ \}}
\DoxyCodeLine{00437\ \}}
\DoxyCodeLine{00438\ }
\DoxyCodeLine{00439\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a0460616fb84af745b12688927ff1bb7d}{generic\_scheduler::prepare\_task\_pool}}\ (\ \textcolor{keywordtype}{size\_t}\ num\_tasks\ )\ \{}
\DoxyCodeLine{00440\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ =\ \_\_TBB\_load\_relaxed(\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>tail);\ \textcolor{comment}{//\ mirror}}
\DoxyCodeLine{00441\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ +\ num\_tasks\ <=\ my\_arena\_slot-\/>my\_task\_pool\_size\ )}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}};}
\DoxyCodeLine{00443\ }
\DoxyCodeLine{00444\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{ittnotify__static_8h_a0ff2395a84e0714023e69b0ff3d7363b}{new\_size}}\ =\ num\_tasks;}
\DoxyCodeLine{00445\ }
\DoxyCodeLine{00446\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>my\_task\_pool\_size\ )\ \{}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1f221aa79878e3962ea2b3eaa7429fe1}{is\_task\_pool\_published}}()\ \&\&\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a089d1ca7efe019834cc06e82b4f3d883}{is\_quiescent\_local\_task\_pool\_reset}}(),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00448\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00449\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ num\_tasks\ <\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1190ee0529a9280846bd50c4f50c8398}{min\_task\_pool\_size}}\ )\ \mbox{\hyperlink{ittnotify__static_8h_a0ff2395a84e0714023e69b0ff3d7363b}{new\_size}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1190ee0529a9280846bd50c4f50c8398}{min\_task\_pool\_size}};}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>allocate\_task\_pool(\ \mbox{\hyperlink{ittnotify__static_8h_a0ff2395a84e0714023e69b0ff3d7363b}{new\_size}}\ );}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00452\ \ \ \ \ \}}
\DoxyCodeLine{00453\ }
\DoxyCodeLine{00454\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ae1cf7dda46c2687a1ea7edacbea10da1}{acquire\_task\_pool}}();}
\DoxyCodeLine{00455\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{gnuplot__common__settings_8hh_a1312167399d185be316962d53af87c87}{H}}\ =\ \_\_TBB\_load\_relaxed(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>head\ );\ \textcolor{comment}{//\ mirror}}
\DoxyCodeLine{00456\ \ \ \ \ task**\ task\_pool\ =\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr;;}
\DoxyCodeLine{00457\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>my\_task\_pool\_size\ >=\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1190ee0529a9280846bd50c4f50c8398}{min\_task\_pool\_size}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00458\ \ \ \ \ \textcolor{comment}{//\ Count\ not\ skipped\ tasks.\ Consider\ using\ std::count\_if.}}
\DoxyCodeLine{00459\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ \mbox{\hyperlink{gnuplot__common__settings_8hh_a1312167399d185be316962d53af87c87}{H}};\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}};\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ )}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ task\_pool[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]\ )\ ++\mbox{\hyperlink{ittnotify__static_8h_a0ff2395a84e0714023e69b0ff3d7363b}{new\_size}};}
\DoxyCodeLine{00461\ \ \ \ \ \textcolor{comment}{//\ If\ the\ free\ space\ at\ the\ beginning\ of\ the\ task\ pool\ is\ too\ short,\ we}}
\DoxyCodeLine{00462\ \ \ \ \ \textcolor{comment}{//\ are\ likely\ facing\ a\ pathological\ single-\/producer-\/multiple-\/consumers}}
\DoxyCodeLine{00463\ \ \ \ \ \textcolor{comment}{//\ scenario,\ and\ thus\ it's\ better\ to\ expand\ the\ task\ pool}}
\DoxyCodeLine{00464\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{allocator_8c_a3a4fc1fa103fa3a33fc168de4cd6703e}{allocate}}\ =\ \mbox{\hyperlink{ittnotify__static_8h_a0ff2395a84e0714023e69b0ff3d7363b}{new\_size}}\ >\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>my\_task\_pool\_size\ -\/\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1190ee0529a9280846bd50c4f50c8398}{min\_task\_pool\_size}}/4;}
\DoxyCodeLine{00465\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{allocator_8c_a3a4fc1fa103fa3a33fc168de4cd6703e}{allocate}}\ )\ \{}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Grow\ task\ pool.\ As\ this\ operation\ is\ rare,\ and\ its\ cost\ is\ asymptotically}}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ amortizable,\ we\ can\ tolerate\ new\ task\ pool\ allocation\ done\ under\ the\ lock.}}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{ittnotify__static_8h_a0ff2395a84e0714023e69b0ff3d7363b}{new\_size\ <\ 2\ *\ my\_arena\_slot-\/>}}my\_task\_pool\_size\ )}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ittnotify__static_8h_a0ff2395a84e0714023e69b0ff3d7363b}{new\_size}}\ =\ 2\ *\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>my\_task\_pool\_size;}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>allocate\_task\_pool(\ \mbox{\hyperlink{ittnotify__static_8h_a0ff2395a84e0714023e69b0ff3d7363b}{new\_size}}\ );\ \textcolor{comment}{//\ updates\ my\_task\_pool\_size}}
\DoxyCodeLine{00471\ \ \ \ \ \}}
\DoxyCodeLine{00472\ \ \ \ \ \textcolor{comment}{//\ Filter\ out\ skipped\ tasks.\ Consider\ using\ std::copy\_if.}}
\DoxyCodeLine{00473\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ T1\ =\ 0;}
\DoxyCodeLine{00474\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ \mbox{\hyperlink{gnuplot__common__settings_8hh_a1312167399d185be316962d53af87c87}{H}};\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}};\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ )}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ task\_pool[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]\ )}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr[T1++]\ =\ task\_pool[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}];}
\DoxyCodeLine{00477\ \ \ \ \ \textcolor{comment}{//\ Deallocate\ the\ previous\ task\ pool\ if\ a\ new\ one\ has\ been\ allocated.}}
\DoxyCodeLine{00478\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{allocator_8c_a3a4fc1fa103fa3a33fc168de4cd6703e}{allocate}}\ )}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_abd3fdd42ea716867fc95116354481b4e}{NFS\_Free}}(\ task\_pool\ );}
\DoxyCodeLine{00480\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>fill\_with\_canary\_pattern(\ T1,\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>tail\ );}
\DoxyCodeLine{00482\ \ \ \ \ \textcolor{comment}{//\ Publish\ the\ new\ state.}}
\DoxyCodeLine{00483\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_aecf34e6a9902af76bbbeab1fd3851df8}{commit\_relocated\_tasks}}(\ T1\ );}
\DoxyCodeLine{00484\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_adc904ecbeb053f061c66edd8e85ac704}{assert\_task\_pool\_valid}}();}
\DoxyCodeLine{00485\ \ \ \ \ \textcolor{keywordflow}{return}\ T1;}
\DoxyCodeLine{00486\ \}}
\DoxyCodeLine{00487\ }
\DoxyCodeLine{00493\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ae1cf7dda46c2687a1ea7edacbea10da1}{generic\_scheduler::acquire\_task\_pool}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00494\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1f221aa79878e3962ea2b3eaa7429fe1}{is\_task\_pool\_published}}()\ )}
\DoxyCodeLine{00495\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ we\ are\ not\ in\ arena\ -\/\ nothing\ to\ lock}}
\DoxyCodeLine{00496\ \ \ \ \ \textcolor{keywordtype}{bool}\ sync\_prepare\_done\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00497\ \ \ \ \ \textcolor{keywordflow}{for}(\ atomic\_backoff\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}};;\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}.pause()\ )\ \{}
\DoxyCodeLine{00498\ \textcolor{preprocessor}{\#if\ TBB\_USE\_ASSERT}}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}\ ==\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>my\_slots\ +\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a35aa72cfdda3b500e908925a3d6da747}{my\_arena\_index}},\ \textcolor{stringliteral}{"{}invalid\ arena\ slot\ index"{}}\ );}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Local\ copy\ of\ the\ arena\ slot\ task\ pool\ pointer\ is\ necessary\ for\ the\ next}}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ assertion\ to\ work\ correctly\ to\ exclude\ asynchronous\ state\ transition\ effect.}}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ task**\ tp\ =\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool;}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ tp\ ==\ \mbox{\hyperlink{scheduler_8h_a096a309d24c5ac85036e8970880e5efd}{LockedTaskPool}}\ ||\ tp\ ==\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr,\ \textcolor{stringliteral}{"{}slot\ ownership\ corrupt?"{}}\ );}
\DoxyCodeLine{00504\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\ !=\ \mbox{\hyperlink{scheduler_8h_a096a309d24c5ac85036e8970880e5efd}{LockedTaskPool}}\ \&\&}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a958f482f9d5f3476ca70610af5336040}{as\_atomic}}(\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool).compare\_and\_swap(\mbox{\hyperlink{scheduler_8h_a096a309d24c5ac85036e8970880e5efd}{LockedTaskPool}},\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr\ )\ ==\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr\ )}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ acquired\ our\ own\ slot}}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{itt__notify_8h_adf75d9635323cc786c012fe69ceef418}{ITT\_NOTIFY}}(sync\_acquired,\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}});}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ !sync\_prepare\_done\ )\ \{}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Start\ waiting}}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{itt__notify_8h_adf75d9635323cc786c012fe69ceef418}{ITT\_NOTIFY}}(sync\_prepare,\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}});}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \ \ \ \ \ \ sync\_prepare\_done\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Someone\ else\ acquired\ a\ lock,\ so\ pause\ and\ do\ exponential\ backoff.}}
\DoxyCodeLine{00518\ \ \ \ \ \}}
\DoxyCodeLine{00519\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\ ==\ \mbox{\hyperlink{scheduler_8h_a096a309d24c5ac85036e8970880e5efd}{LockedTaskPool}},\ \textcolor{stringliteral}{"{}not\ really\ acquired\ task\ pool"{}}\ );}
\DoxyCodeLine{00520\ \}\ \textcolor{comment}{//\ generic\_scheduler::acquire\_task\_pool}}
\DoxyCodeLine{00521\ }
\DoxyCodeLine{00522\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a6ff28eab04933075791b16075ceb5950}{generic\_scheduler::release\_task\_pool}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00523\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1f221aa79878e3962ea2b3eaa7429fe1}{is\_task\_pool\_published}}()\ )}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ we\ are\ not\ in\ arena\ -\/\ nothing\ to\ unlock}}
\DoxyCodeLine{00525\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}},\ \textcolor{stringliteral}{"{}we\ are\ not\ in\ arena"{}}\ );}
\DoxyCodeLine{00526\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\ ==\ \mbox{\hyperlink{scheduler_8h_a096a309d24c5ac85036e8970880e5efd}{LockedTaskPool}},\ \textcolor{stringliteral}{"{}arena\ slot\ is\ not\ locked"{}}\ );}
\DoxyCodeLine{00527\ \ \ \ \ \mbox{\hyperlink{itt__notify_8h_adf75d9635323cc786c012fe69ceef418}{ITT\_NOTIFY}}(\mbox{\hyperlink{ittnotify__static_8h_ac5a347b47a5603a1f30f6fbf790724b7}{sync\_releasing}},\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}});}
\DoxyCodeLine{00528\ \ \ \ \ \_\_TBB\_store\_with\_release(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool,\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr\ );}
\DoxyCodeLine{00529\ \}}
\DoxyCodeLine{00530\ }
\DoxyCodeLine{00537\ \textcolor{keyword}{inline}\ task**\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a3def047033ef29c77c43db170a38df2c}{generic\_scheduler::lock\_task\_pool}}(\ \mbox{\hyperlink{structtbb_1_1internal_1_1arena__slot}{arena\_slot}}*\ victim\_arena\_slot\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00538\ \ \ \ \ task**\ victim\_task\_pool;}
\DoxyCodeLine{00539\ \ \ \ \ \textcolor{keywordtype}{bool}\ sync\_prepare\_done\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00540\ \ \ \ \ \textcolor{keywordflow}{for}(\ atomic\_backoff\ backoff;;\ \textcolor{comment}{/*backoff\ pause\ embedded\ in\ the\ loop*/})\ \{}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \ \ victim\_task\_pool\ =\ victim\_arena\_slot-\/>task\_pool;}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ NOTE:\ Do\ not\ use\ comparison\ of\ head\ and\ tail\ indices\ to\ check\ for}}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ presence\ of\ work\ in\ the\ victim's\ task\ pool,\ as\ they\ may\ give}}
\DoxyCodeLine{00544\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ incorrect\ indication\ because\ of\ task\ pool\ relocations\ and\ resizes.}}
\DoxyCodeLine{00545\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ victim\_task\_pool\ ==\ \mbox{\hyperlink{scheduler_8h_a6f1c5fa8b2e50a1a91282165c7a9dae2}{EmptyTaskPool}}\ )\ \{}
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ victim\ thread\ emptied\ its\ task\ pool\ -\/\ nothing\ to\ lock}}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ sync\_prepare\_done\ )}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{itt__notify_8h_adf75d9635323cc786c012fe69ceef418}{ITT\_NOTIFY}}(\mbox{\hyperlink{ittnotify__static_8h_a209ab745dc4b55d55acb64a82cb8c9b6}{sync\_cancel}},\ victim\_arena\_slot);}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00551\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ victim\_task\_pool\ !=\ \mbox{\hyperlink{scheduler_8h_a096a309d24c5ac85036e8970880e5efd}{LockedTaskPool}}\ \&\&}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a958f482f9d5f3476ca70610af5336040}{as\_atomic}}(victim\_arena\_slot-\/>task\_pool).compare\_and\_swap(\mbox{\hyperlink{scheduler_8h_a096a309d24c5ac85036e8970880e5efd}{LockedTaskPool}},\ victim\_task\_pool\ )\ ==\ victim\_task\_pool\ )}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We've\ locked\ victim's\ task\ pool}}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{itt__notify_8h_adf75d9635323cc786c012fe69ceef418}{ITT\_NOTIFY}}(sync\_acquired,\ victim\_arena\_slot);}
\DoxyCodeLine{00556\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00557\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\ !sync\_prepare\_done\ )\ \{}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Start\ waiting}}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{itt__notify_8h_adf75d9635323cc786c012fe69ceef418}{ITT\_NOTIFY}}(sync\_prepare,\ victim\_arena\_slot);}
\DoxyCodeLine{00561\ \ \ \ \ \ \ \ \ \ \ \ \ sync\_prepare\_done\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00562\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__statistics_8h_a08f1e46bb511c63da3ce07aa9c897bc4}{GATHER\_STATISTIC}}(\ ++my\_counters.thieves\_conflicts\ );}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Someone\ else\ acquired\ a\ lock,\ so\ pause\ and\ do\ exponential\ backoff.}}
\DoxyCodeLine{00565\ \textcolor{preprocessor}{\#if\ \_\_TBB\_STEALING\_ABORT\_ON\_CONTENTION}}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!backoff.bounded\_pause())\ \{}
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ 16\ was\ acquired\ empirically\ and\ a\ theory\ behind\ it\ supposes}}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ that\ number\ of\ threads\ becomes\ much\ bigger\ than\ number\ of}}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ tasks\ which\ can\ be\ spawned\ by\ one\ thread\ causing\ excessive\ contention.}}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ However\ even\ small\ arenas\ can\ benefit\ from\ the\ abort\ on\ contention}}
\DoxyCodeLine{00571\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ if\ preemption\ of\ a\ thief\ is\ a\ problem}}
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>my\_limit\ >=\ 16)}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{scheduler_8h_a6f1c5fa8b2e50a1a91282165c7a9dae2}{EmptyTaskPool}};}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ibm__aix51_8h_a2b17e6e4504bddf60a920f609fc46ea6}{\_\_TBB\_Yield}}();}
\DoxyCodeLine{00575\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00576\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \ \ backoff.pause();}
\DoxyCodeLine{00578\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00579\ \ \ \ \ \}}
\DoxyCodeLine{00580\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ victim\_task\_pool\ ==\ \mbox{\hyperlink{scheduler_8h_a6f1c5fa8b2e50a1a91282165c7a9dae2}{EmptyTaskPool}}\ ||}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (victim\_arena\_slot-\/>task\_pool\ ==\ \mbox{\hyperlink{scheduler_8h_a096a309d24c5ac85036e8970880e5efd}{LockedTaskPool}}\ \&\&\ victim\_task\_pool\ !=\ \mbox{\hyperlink{scheduler_8h_a096a309d24c5ac85036e8970880e5efd}{LockedTaskPool}}),}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}not\ really\ locked\ victim's\ task\ pool?"{}}\ );}
\DoxyCodeLine{00583\ \ \ \ \ \textcolor{keywordflow}{return}\ victim\_task\_pool;}
\DoxyCodeLine{00584\ \}\ \textcolor{comment}{//\ generic\_scheduler::lock\_task\_pool}}
\DoxyCodeLine{00585\ }
\DoxyCodeLine{00586\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a9deee19e39b49b7e1f44c87533600b46}{generic\_scheduler::unlock\_task\_pool}}(\ \mbox{\hyperlink{structtbb_1_1internal_1_1arena__slot}{arena\_slot}}*\ victim\_arena\_slot,}
\DoxyCodeLine{00587\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task**\ victim\_task\_pool\ )\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00588\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ victim\_arena\_slot,\ \textcolor{stringliteral}{"{}empty\ victim\ arena\ slot\ pointer"{}}\ );}
\DoxyCodeLine{00589\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ victim\_arena\_slot-\/>task\_pool\ ==\ \mbox{\hyperlink{scheduler_8h_a096a309d24c5ac85036e8970880e5efd}{LockedTaskPool}},\ \textcolor{stringliteral}{"{}victim\ arena\ slot\ is\ not\ locked"{}}\ );}
\DoxyCodeLine{00590\ \ \ \ \ \mbox{\hyperlink{itt__notify_8h_adf75d9635323cc786c012fe69ceef418}{ITT\_NOTIFY}}(\mbox{\hyperlink{ittnotify__static_8h_ac5a347b47a5603a1f30f6fbf790724b7}{sync\_releasing}},\ victim\_arena\_slot);}
\DoxyCodeLine{00591\ \ \ \ \ \_\_TBB\_store\_with\_release(\ victim\_arena\_slot-\/>task\_pool,\ victim\_task\_pool\ );}
\DoxyCodeLine{00592\ \}}
\DoxyCodeLine{00593\ }
\DoxyCodeLine{00594\ }
\DoxyCodeLine{00595\ \textcolor{keyword}{inline}\ task*\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a8a62642cb4b1ba391b8d3b9a00dca541}{generic\_scheduler::prepare\_for\_spawning}}(\ task*\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ )\ \{}
\DoxyCodeLine{00596\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>state()==task::allocated,\ \textcolor{stringliteral}{"{}attempt\ to\ spawn\ task\ that\ is\ not\ in\ 'allocated'\ state"{}}\ );}
\DoxyCodeLine{00597\ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().state\ =\ task::ready;}
\DoxyCodeLine{00598\ \textcolor{preprocessor}{\#if\ TBB\_USE\_ASSERT}}
\DoxyCodeLine{00599\ \ \ \ \ \textcolor{keywordflow}{if}(\ task*\ \mbox{\hyperlink{ittnotify__static_8h_ab242ec323769be8fbbf53617a69d14ff}{parent}}\ =\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>parent()\ )\ \{}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \ \ internal::reference\_count\ ref\_count\ =\ \mbox{\hyperlink{ittnotify__static_8h_ab242ec323769be8fbbf53617a69d14ff}{parent}}-\/>prefix().ref\_count;}
\DoxyCodeLine{00601\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ ref\_count>=0,\ \textcolor{stringliteral}{"{}attempt\ to\ spawn\ task\ whose\ parent\ has\ a\ ref\_count<0"{}}\ );}
\DoxyCodeLine{00602\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ ref\_count!=0,\ \textcolor{stringliteral}{"{}attempt\ to\ spawn\ task\ whose\ parent\ has\ a\ ref\_count==0\ (forgot\ to\ set\_ref\_count?)"{}}\ );}
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ittnotify__static_8h_ab242ec323769be8fbbf53617a69d14ff}{parent}}-\/>prefix().extra\_state\ |=\ \mbox{\hyperlink{namespacetbb_1_1internal_a5fb219223e38c8bbcc47d7c943f48e54a2bde1985fd0827baf5dbfa4a9bc33a7f}{es\_ref\_count\_active}};}
\DoxyCodeLine{00604\ \ \ \ \ \}}
\DoxyCodeLine{00605\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ TBB\_USE\_ASSERT\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00606\ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a3e3837fb3ca7bbf4cf4752c58cbed886}{affinity\_id}}\ dst\_thread\ =\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().affinity;}
\DoxyCodeLine{00607\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ dst\_thread\ ==\ 0\ ||\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a33519b4cf710f8c46129672f79fb6ec4}{is\_version\_3\_task}}(*\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}),}
\DoxyCodeLine{00608\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}backwards\ compatibility\ to\ TBB\ 2.0\ tasks\ is\ broken"{}}\ );}
\DoxyCodeLine{00609\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_ISOLATION}}
\DoxyCodeLine{00610\ \ \ \ \ isolation\_tag\ isolation\ =\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_aac9af4d8baddbbc2af433e11297be8a5}{my\_innermost\_running\_task}}-\/>prefix().isolation;}
\DoxyCodeLine{00611\ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().isolation\ =\ isolation;}
\DoxyCodeLine{00612\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_ISOLATION\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00613\ \ \ \ \ \textcolor{keywordflow}{if}(\ dst\_thread\ !=\ 0\ \&\&\ dst\_thread\ !=\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a3a635bad42d492013d4a06d1af0c452b}{my\_affinity\_id}}\ )\ \{}
\DoxyCodeLine{00614\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy}{task\_proxy}}\&\ proxy\ =\ (\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy}{task\_proxy}}\&)\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_aa0d316e9f3063c6b57fa21e0716d4d77}{allocate\_task}}(\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy}{task\_proxy}}),}
\DoxyCodeLine{00615\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{scheduler__common_8h_a0ef18fbe7aa93b76fd4136a153bc2e44}{\_\_TBB\_CONTEXT\_ARG}}(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ );}
\DoxyCodeLine{00616\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Mark\ as\ a\ proxy}}
\DoxyCodeLine{00617\ \ \ \ \ \ \ \ \ proxy.prefix().extra\_state\ =\ \mbox{\hyperlink{namespacetbb_1_1internal_a5fb219223e38c8bbcc47d7c943f48e54a2b1c67cc200577a0b07649fdb00bec49}{es\_task\_proxy}};}
\DoxyCodeLine{00618\ \ \ \ \ \ \ \ \ proxy.\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a32d3a7685efa9cf073409277295091a8}{outbox}}\ =\ \&\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>mailbox(dst\_thread);}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Mark\ proxy\ as\ present\ in\ both\ locations\ (sender's\ task\ pool\ and\ destination\ mailbox)}}
\DoxyCodeLine{00620\ \ \ \ \ \ \ \ \ proxy.\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_abedfdfcd6048685cf9aa032ca2380adf}{task\_and\_tag}}\ =\ intptr\_t(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}})\ |\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_af6bc227aa29feead34c16e8012d634e0}{task\_proxy::location\_mask}};}
\DoxyCodeLine{00621\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_PRIORITY}}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ poison\_pointer(\ proxy.prefix().context\ );}
\DoxyCodeLine{00623\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_PRIORITY\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{scheduler__common_8h_a63e9a35b6d2bfbfb21b3199dc03acc6d}{\_\_TBB\_ISOLATION\_EXPR}}(\ proxy.prefix().isolation\ =\ isolation\ );}
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{itt__notify_8h_adf75d9635323cc786c012fe69ceef418}{ITT\_NOTIFY}}(\ \mbox{\hyperlink{ittnotify__static_8h_ac5a347b47a5603a1f30f6fbf790724b7}{sync\_releasing}},\ proxy.\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a32d3a7685efa9cf073409277295091a8}{outbox}}\ );}
\DoxyCodeLine{00626\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Mail\ the\ proxy,\ if\ success,\ it\ may\ be\ destroyed\ by\ another\ thread\ at\ any\ moment\ after\ this\ point.}}
\DoxyCodeLine{00627\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ proxy.\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a32d3a7685efa9cf073409277295091a8}{outbox}}-\/>\mbox{\hyperlink{classtbb_1_1internal_1_1mail__outbox_ae76e3bce668baf6c313d8ea0b5110c45}{push}}(\&proxy)\ )}
\DoxyCodeLine{00628\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \&proxy;}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ mailbox\ is\ overfilled,\ deallocate\ the\ proxy\ and\ return\ the\ initial\ task.}}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a12dd37171af77214add72a973e6b71ba}{free\_task<small\_task>}}(proxy);}
\DoxyCodeLine{00631\ \ \ \ \ \}}
\DoxyCodeLine{00632\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}};}
\DoxyCodeLine{00633\ \}}
\DoxyCodeLine{00634\ }
\DoxyCodeLine{00635\ \textcolor{preprocessor}{\#if\ \_\_TBB\_PREVIEW\_CRITICAL\_TASKS}}
\DoxyCodeLine{00636\ \textcolor{keywordtype}{bool}\ generic\_scheduler::handled\_as\_critical(\ task\&\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ )\ \{}
\DoxyCodeLine{00637\ \ \ \ \ \textcolor{keywordflow}{if}(\ !internal::is\_critical(\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ )\ )}
\DoxyCodeLine{00638\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00639\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_ISOLATION}}
\DoxyCodeLine{00640\ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}.prefix().isolation\ =\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_aac9af4d8baddbbc2af433e11297be8a5}{my\_innermost\_running\_task}}-\/>prefix().isolation;}
\DoxyCodeLine{00641\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00642\ \ \ \ \ \mbox{\hyperlink{itt__notify_8h_adf75d9635323cc786c012fe69ceef418}{ITT\_NOTIFY}}(\mbox{\hyperlink{ittnotify__static_8h_ac5a347b47a5603a1f30f6fbf790724b7}{sync\_releasing}},\ \&\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>my\_critical\_task\_stream);}
\DoxyCodeLine{00643\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}},\ \textcolor{stringliteral}{"{}Must\ be\ attached\ to\ the\ arena."{}}\ );}
\DoxyCodeLine{00644\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}},\ \textcolor{stringliteral}{"{}Must\ occupy\ a\ slot\ in\ the\ attached\ arena"{}}\ );}
\DoxyCodeLine{00645\ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>my\_critical\_task\_stream.push(}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ \&\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}},\ 0,\ \mbox{\hyperlink{structtbb_1_1internal_1_1subsequent__lane__selector}{tbb::internal::subsequent\_lane\_selector}}(\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>hint\_for\_critical)\ );}
\DoxyCodeLine{00647\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00648\ \}}
\DoxyCodeLine{00649\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_PREVIEW\_CRITICAL\_TASKS\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00650\ }
\DoxyCodeLine{00653\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ae43166ffd9d7fb624158872394832f17}{generic\_scheduler::local\_spawn}}(\ task*\ \mbox{\hyperlink{namespacetbb_1_1internal_ab9f93f2f0b5a50bfec5f8ebbfbe9b9db}{first}},\ task*\&\ next\ )\ \{}
\DoxyCodeLine{00654\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{namespacetbb_1_1internal_ab9f93f2f0b5a50bfec5f8ebbfbe9b9db}{first}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00655\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_a14d4453f34a770b1c983c2ed38570e31}{governor::is\_set}}(\textcolor{keyword}{this}),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00656\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TODO}}
\DoxyCodeLine{00657\ \ \ \ \ \textcolor{comment}{//\ We\ need\ to\ consider\ capping\ the\ max\ task\ pool\ size\ and\ switching}}
\DoxyCodeLine{00658\ \ \ \ \ \textcolor{comment}{//\ to\ in-\/place\ task\ execution\ whenever\ it\ is\ reached.}}
\DoxyCodeLine{00659\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00660\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \&\mbox{\hyperlink{namespacetbb_1_1internal_ab9f93f2f0b5a50bfec5f8ebbfbe9b9db}{first}}-\/>prefix().next\ ==\ \&next\ )\ \{}
\DoxyCodeLine{00661\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Single\ task\ is\ being\ spawned}}
\DoxyCodeLine{00662\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TODO}}
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:}}
\DoxyCodeLine{00664\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ In\ the\ future\ we\ need\ to\ add\ overloaded\ spawn\ method\ for\ a\ single\ task,}}
\DoxyCodeLine{00665\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ and\ a\ method\ accepting\ an\ array\ of\ task\ pointers\ (we\ may\ also\ want\ to}}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ change\ the\ implementation\ of\ the\ task\_list\ class).\ But\ since\ such\ changes}}
\DoxyCodeLine{00667\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ may\ affect\ the\ binary\ compatibility,\ we\ postpone\ them\ for\ a\ while.}}
\DoxyCodeLine{00668\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00669\ \textcolor{preprocessor}{\#if\ \_\_TBB\_PREVIEW\_CRITICAL\_TASKS}}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !handled\_as\_critical(\ *\mbox{\hyperlink{namespacetbb_1_1internal_ab9f93f2f0b5a50bfec5f8ebbfbe9b9db}{first}}\ )\ )}
\DoxyCodeLine{00671\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00672\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00673\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a0460616fb84af745b12688927ff1bb7d}{prepare\_task\_pool}}(\ 1\ );}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr[\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}]\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a8a62642cb4b1ba391b8d3b9a00dca541}{prepare\_for\_spawning}}(\ \mbox{\hyperlink{namespacetbb_1_1internal_ab9f93f2f0b5a50bfec5f8ebbfbe9b9db}{first}}\ );}
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a7f7d3a75d44d62525c8b31c32917d242}{commit\_spawned\_tasks}}(\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ +\ 1\ );}
\DoxyCodeLine{00676\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1f221aa79878e3962ea2b3eaa7429fe1}{is\_task\_pool\_published}}()\ )}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_af222cccbf09e91c9c9caaad81f8d993d}{publish\_task\_pool}}();}
\DoxyCodeLine{00678\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00679\ \ \ \ \ \}}
\DoxyCodeLine{00680\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Task\ list\ is\ being\ spawned}}
\DoxyCodeLine{00682\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TODO}}
\DoxyCodeLine{00683\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ add\ task\_list::front()\ and\ implement\&document\ the\ local\ execution\ ordering\ which\ is}}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ opposite\ to\ the\ current\ implementation.\ The\ idea\ is\ to\ remove\ hackish\ fast\_reverse\_vector}}
\DoxyCodeLine{00685\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ and\ use\ push\_back/push\_front\ when\ accordingly\ LIFO\ and\ FIFO\ order\ of\ local\ execution\ is}}
\DoxyCodeLine{00686\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ desired.\ It\ also\ requires\ refactoring\ of\ the\ reload\_tasks\ method\ and\ my\_offloaded\_tasks\ list.}}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Additional\ benefit\ may\ come\ from\ adding\ counter\ to\ the\ task\_list\ so\ that\ it\ can\ reserve\ enough}}
\DoxyCodeLine{00688\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ space\ in\ the\ task\ pool\ in\ advance\ and\ move\ all\ the\ tasks\ directly\ without\ any\ intermediate}}
\DoxyCodeLine{00689\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ storages.\ But\ it\ requires\ dealing\ with\ backward\ compatibility\ issues\ and\ still\ supporting}}
\DoxyCodeLine{00690\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ counter-\/less\ variant\ (though\ not\ necessarily\ fast\ implementation).}}
\DoxyCodeLine{00691\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00692\ \ \ \ \ \ \ \ \ task\ *arr[\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1190ee0529a9280846bd50c4f50c8398}{min\_task\_pool\_size}}];}
\DoxyCodeLine{00693\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1fast__reverse__vector}{fast\_reverse\_vector<task*>}}\ tasks(arr,\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1190ee0529a9280846bd50c4f50c8398}{min\_task\_pool\_size}});}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \ \ task\ *t\_next\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00695\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\ task*\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{namespacetbb_1_1internal_ab9f93f2f0b5a50bfec5f8ebbfbe9b9db}{first}};\ ;\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ t\_next\ )\ \{}
\DoxyCodeLine{00696\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ t\ is\ affinitized\ to\ another\ thread,\ it\ may\ already\ be\ executed}}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ and\ destroyed\ by\ the\ time\ prepare\_for\_spawning\ returns.}}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ So\ milk\ it\ while\ it\ is\ alive.}}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{ittnotify__static_8h_a30bf4ccd4623b7a8276bbc7f99e491c7}{end}}\ =\ \&\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().next\ ==\ \&next;}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ \ \ \ \ t\_next\ =\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().next;}
\DoxyCodeLine{00701\ \textcolor{preprocessor}{\#if\ \_\_TBB\_PREVIEW\_CRITICAL\_TASKS}}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !handled\_as\_critical(\ *\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ )\ )}
\DoxyCodeLine{00703\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tasks.\mbox{\hyperlink{classtbb_1_1internal_1_1fast__reverse__vector_ae533cd1ab5be44deaa0ee7ad7ece6f4b}{push\_back}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a8a62642cb4b1ba391b8d3b9a00dca541}{prepare\_for\_spawning}}(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}})\ );}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{ittnotify__static_8h_a30bf4ccd4623b7a8276bbc7f99e491c7}{end}}\ )}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00707\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00708\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \textcolor{keywordtype}{size\_t}\ num\_tasks\ =\ tasks.\mbox{\hyperlink{classtbb_1_1internal_1_1fast__reverse__vector_af4bf3e062e3f758eb10dffd1af199f93}{size}}()\ )\ \{}
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a0460616fb84af745b12688927ff1bb7d}{prepare\_task\_pool}}(\ num\_tasks\ );}
\DoxyCodeLine{00710\ \ \ \ \ \ \ \ \ \ \ \ \ tasks.\mbox{\hyperlink{classtbb_1_1internal_1_1fast__reverse__vector_ac812b1f549c217466d6d92f0033f3aee}{copy\_memory}}(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr\ +\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ );}
\DoxyCodeLine{00711\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a7f7d3a75d44d62525c8b31c32917d242}{commit\_spawned\_tasks}}(\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ +\ num\_tasks\ );}
\DoxyCodeLine{00712\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1f221aa79878e3962ea2b3eaa7429fe1}{is\_task\_pool\_published}}()\ )}
\DoxyCodeLine{00713\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_af222cccbf09e91c9c9caaad81f8d993d}{publish\_task\_pool}}();}
\DoxyCodeLine{00714\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00715\ \ \ \ \ \}}
\DoxyCodeLine{00716\ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>advertise\_new\_work<\mbox{\hyperlink{classtbb_1_1internal_1_1arena_a2380e7751924d1199ffab7b2ee29ddeea2109ea81736367212fa797959b4b4381}{arena::work\_spawned}}>();}
\DoxyCodeLine{00717\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_adc904ecbeb053f061c66edd8e85ac704}{assert\_task\_pool\_valid}}();}
\DoxyCodeLine{00718\ \}}
\DoxyCodeLine{00719\ }
\DoxyCodeLine{00720\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a9dacb8fead5795de1011018b83d68d61}{generic\_scheduler::local\_spawn\_root\_and\_wait}}(\ task*\ \mbox{\hyperlink{namespacetbb_1_1internal_ab9f93f2f0b5a50bfec5f8ebbfbe9b9db}{first}},\ task*\&\ next\ )\ \{}
\DoxyCodeLine{00721\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_a14d4453f34a770b1c983c2ed38570e31}{governor::is\_set}}(\textcolor{keyword}{this}),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00722\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{namespacetbb_1_1internal_ab9f93f2f0b5a50bfec5f8ebbfbe9b9db}{first}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00723\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1auto__empty__task}{auto\_empty\_task}}\ dummy(\ \mbox{\hyperlink{scheduler__common_8h_a0ef18fbe7aa93b76fd4136a153bc2e44}{\_\_TBB\_CONTEXT\_ARG}}(\textcolor{keyword}{this},\ \mbox{\hyperlink{namespacetbb_1_1internal_ab9f93f2f0b5a50bfec5f8ebbfbe9b9db}{first}}-\/>prefix().context)\ );}
\DoxyCodeLine{00724\ \ \ \ \ internal::reference\_count\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ =\ 0;}
\DoxyCodeLine{00725\ \ \ \ \ \textcolor{keywordflow}{for}(\ task*\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}=\mbox{\hyperlink{namespacetbb_1_1internal_ab9f93f2f0b5a50bfec5f8ebbfbe9b9db}{first}};\ ;\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}=\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().next\ )\ \{}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}};}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().parent,\ \textcolor{stringliteral}{"{}not\ a\ root\ task,\ or\ already\ running"{}}\ );}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().parent\ =\ \&dummy;}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \&\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().next==\&next\ )\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00730\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_GROUP\_CONTEXT}}
\DoxyCodeLine{00731\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().context\ ==\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().next-\/>prefix().context,}
\DoxyCodeLine{00732\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}all\ the\ root\ tasks\ in\ list\ must\ share\ the\ same\ context"{}});}
\DoxyCodeLine{00733\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_GROUP\_CONTEXT\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00734\ \ \ \ \ \}}
\DoxyCodeLine{00735\ \ \ \ \ dummy.prefix().ref\_count\ =\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}+1;}
\DoxyCodeLine{00736\ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}>1\ )}
\DoxyCodeLine{00737\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ae43166ffd9d7fb624158872394832f17}{local\_spawn}}(\ \mbox{\hyperlink{namespacetbb_1_1internal_ab9f93f2f0b5a50bfec5f8ebbfbe9b9db}{first}}-\/>prefix().next,\ next\ );}
\DoxyCodeLine{00738\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a509997dbb9b97ad2cca0a3af76c04e90}{local\_wait\_for\_all}}(\ dummy,\ \mbox{\hyperlink{namespacetbb_1_1internal_ab9f93f2f0b5a50bfec5f8ebbfbe9b9db}{first}}\ );}
\DoxyCodeLine{00739\ \}}
\DoxyCodeLine{00740\ }
\DoxyCodeLine{00741\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a4d51eca32dc45cba3e0ec161240bfaca}{tbb::internal::generic\_scheduler::spawn}}(\ task\&\ \mbox{\hyperlink{namespacetbb_1_1internal_ab9f93f2f0b5a50bfec5f8ebbfbe9b9db}{first}},\ task*\&\ next\ )\ \{}
\DoxyCodeLine{00742\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_a3ee947910b77e9ab2f3c02f0d2d63c32}{governor::local\_scheduler}}()-\/>\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ae43166ffd9d7fb624158872394832f17}{local\_spawn}}(\ \&\mbox{\hyperlink{namespacetbb_1_1internal_ab9f93f2f0b5a50bfec5f8ebbfbe9b9db}{first}},\ next\ );}
\DoxyCodeLine{00743\ \}}
\DoxyCodeLine{00744\ }
\DoxyCodeLine{00745\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a6e0b5fdf74860259585e55f7bf2edb8e}{tbb::internal::generic\_scheduler::spawn\_root\_and\_wait}}(\ task\&\ \mbox{\hyperlink{namespacetbb_1_1internal_ab9f93f2f0b5a50bfec5f8ebbfbe9b9db}{first}},\ task*\&\ next\ )\ \{}
\DoxyCodeLine{00746\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_a3ee947910b77e9ab2f3c02f0d2d63c32}{governor::local\_scheduler}}()-\/>\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a9dacb8fead5795de1011018b83d68d61}{local\_spawn\_root\_and\_wait}}(\ \&\mbox{\hyperlink{namespacetbb_1_1internal_ab9f93f2f0b5a50bfec5f8ebbfbe9b9db}{first}},\ next\ );}
\DoxyCodeLine{00747\ \}}
\DoxyCodeLine{00748\ }
\DoxyCodeLine{00749\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a21fedf3ec39056fdd7b7718f2421e229}{tbb::internal::generic\_scheduler::enqueue}}(\ task\&\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}},\ \textcolor{keywordtype}{void}*\ prio\ )\ \{}
\DoxyCodeLine{00750\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a838f6ccf79d7ee8a55843de2f8004759}{generic\_scheduler}}\ *\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_a3ee947910b77e9ab2f3c02f0d2d63c32}{governor::local\_scheduler}}();}
\DoxyCodeLine{00751\ \ \ \ \ \textcolor{comment}{//\ these\ redirections\ are\ due\ to\ bw-\/compatibility,\ consider\ reworking\ some\ day}}
\DoxyCodeLine{00752\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>my\_arena,\ \textcolor{stringliteral}{"{}thread\ is\ not\ in\ any\ arena"{}}\ );}
\DoxyCodeLine{00753\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>my\_arena-\/>enqueue\_task(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}},\ (intptr\_t)prio,\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>my\_random\ );}
\DoxyCodeLine{00754\ \}}
\DoxyCodeLine{00755\ }
\DoxyCodeLine{00756\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_PRIORITY}}
\DoxyCodeLine{00757\ \textcolor{keyword}{class\ }auto\_indicator\ :\ no\_copy\ \{}
\DoxyCodeLine{00758\ \ \ \ \ \textcolor{keyword}{volatile}\ \textcolor{keywordtype}{bool}\&\ my\_indicator;}
\DoxyCodeLine{00759\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00760\ \ \ \ \ auto\_indicator\ (\ \textcolor{keyword}{volatile}\ \textcolor{keywordtype}{bool}\&\ indicator\ )\ :\ my\_indicator(indicator)\ \{\ my\_indicator\ =\ \mbox{\hyperlink{yyjson_8h_a41f9c5fb8b08eb5dc3edce4dcb37fee7}{true}}\ ;\}}
\DoxyCodeLine{00761\ \ \ \ \ \string~auto\_indicator\ ()\ \{\ my\_indicator\ =\ \textcolor{keyword}{false};\ \}}
\DoxyCodeLine{00762\ \};}
\DoxyCodeLine{00763\ }
\DoxyCodeLine{00764\ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}\ *generic\_scheduler::get\_task\_and\_activate\_task\_pool(\ \textcolor{keywordtype}{size\_t}\ H0,\ \mbox{\hyperlink{scheduler__common_8h_ae8bf2edd69c1485ce30d4e88cc7e27d2}{\_\_TBB\_ISOLATION\_ARG}}(\ \textcolor{keywordtype}{size\_t}\ T0,\ isolation\_tag\ isolation\ )\ )\ \{}
\DoxyCodeLine{00765\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a74b022285a6ff04a9ea2957999d4def3}{is\_local\_task\_pool\_quiescent}}(),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00766\ }
\DoxyCodeLine{00767\ \ \ \ \ \textcolor{comment}{//\ Go\ through\ the\ task\ pool\ to\ find\ an\ available\ task\ for\ execution.}}
\DoxyCodeLine{00768\ \ \ \ \ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}\ *\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00769\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_ISOLATION}}
\DoxyCodeLine{00770\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ =\ T0;}
\DoxyCodeLine{00771\ \ \ \ \ \textcolor{keywordtype}{bool}\ tasks\_omitted\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00772\ \ \ \ \ \textcolor{keywordflow}{while}\ (\ !\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ \&\&\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}>H0\ )\ \{}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a10c72a4aad7308d944cef26502ece55e}{get\_task}}(\ -\/-\/\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ isolation,\ tasks\_omitted\ );}
\DoxyCodeLine{00774\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !tasks\_omitted\ )\ \{}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \ \ \ \ \ \ poison\_pointer(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr[\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}]\ );}
\DoxyCodeLine{00776\ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/T0;}
\DoxyCodeLine{00777\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00778\ \ \ \ \ \}}
\DoxyCodeLine{00779\ \ \ \ \ \textcolor{comment}{//\ Make\ a\ hole\ if\ some\ tasks\ have\ been\ skipped.}}
\DoxyCodeLine{00780\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ \&\&\ tasks\_omitted\ )\ \{}
\DoxyCodeLine{00781\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr[\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}]\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00782\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ ==\ H0\ )\ \{}
\DoxyCodeLine{00783\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ obtained\ task\ is\ on\ the\ head.\ So\ we\ can\ move\ the\ head\ instead\ of\ making\ a\ hole.}}
\DoxyCodeLine{00784\ \ \ \ \ \ \ \ \ \ \ \ \ ++H0;}
\DoxyCodeLine{00785\ \ \ \ \ \ \ \ \ \ \ \ \ poison\_pointer(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr[\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}]\ );}
\DoxyCodeLine{00786\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00787\ \ \ \ \ \}}
\DoxyCodeLine{00788\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00789\ \ \ \ \ \textcolor{keywordflow}{while}\ (\ !\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ \&\&\ T0\ )\ \{}
\DoxyCodeLine{00790\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a10c72a4aad7308d944cef26502ece55e}{get\_task}}(\ -\/-\/T0\ );}
\DoxyCodeLine{00791\ \ \ \ \ \ \ \ \ poison\_pointer(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr[T0]\ );}
\DoxyCodeLine{00792\ \ \ \ \ \}}
\DoxyCodeLine{00793\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_ISOLATION\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00794\ }
\DoxyCodeLine{00795\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ H0\ <\ T0\ )\ \{}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ There\ are\ some\ tasks\ in\ the\ task\ pool.\ Publish\ them.}}
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ \_\_TBB\_store\_relaxed(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>head,\ H0\ );}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \ \ \_\_TBB\_store\_relaxed(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>tail,\ T0\ );}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1f221aa79878e3962ea2b3eaa7429fe1}{is\_task\_pool\_published}}()\ )}
\DoxyCodeLine{00800\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a6ff28eab04933075791b16075ceb5950}{release\_task\_pool}}();}
\DoxyCodeLine{00801\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_af222cccbf09e91c9c9caaad81f8d993d}{publish\_task\_pool}}();}
\DoxyCodeLine{00803\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00804\ \ \ \ \ \ \ \ \ \_\_TBB\_store\_relaxed(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>head,\ 0\ );}
\DoxyCodeLine{00805\ \ \ \ \ \ \ \ \ \_\_TBB\_store\_relaxed(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>tail,\ 0\ );}
\DoxyCodeLine{00806\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1f221aa79878e3962ea2b3eaa7429fe1}{is\_task\_pool\_published}}()\ )}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_aad4a3aef975ca2516a81640654a65717}{leave\_task\_pool}}();}
\DoxyCodeLine{00808\ \ \ \ \ \}}
\DoxyCodeLine{00809\ }
\DoxyCodeLine{00810\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_ISOLATION}}
\DoxyCodeLine{00811\ \ \ \ \ \textcolor{comment}{//\ Now\ it\ is\ safe\ to\ call\ note\_affinity\ because\ the\ task\ pool\ is\ restored.}}
\DoxyCodeLine{00812\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ tasks\_omitted\ \&\&\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_aac9af4d8baddbbc2af433e11297be8a5}{my\_innermost\_running\_task}}\ ==\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ )\ \{}
\DoxyCodeLine{00813\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a35e1c039fac0fa1b7d8b4f491d557a86}{assert\_task\_valid}}(\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ );}
\DoxyCodeLine{00814\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>note\_affinity(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a3a635bad42d492013d4a06d1af0c452b}{my\_affinity\_id}}\ );}
\DoxyCodeLine{00815\ \ \ \ \ \}}
\DoxyCodeLine{00816\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_ISOLATION\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00817\ }
\DoxyCodeLine{00818\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_adc904ecbeb053f061c66edd8e85ac704}{assert\_task\_pool\_valid}}();}
\DoxyCodeLine{00819\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}};}
\DoxyCodeLine{00820\ \}}
\DoxyCodeLine{00821\ }
\DoxyCodeLine{00822\ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}*\ generic\_scheduler::winnow\_task\_pool(\ \mbox{\hyperlink{scheduler__common_8h_a63e9a35b6d2bfbfb21b3199dc03acc6d}{\_\_TBB\_ISOLATION\_EXPR}}(\ isolation\_tag\ isolation\ )\ )\ \{}
\DoxyCodeLine{00823\ \ \ \ \ \mbox{\hyperlink{tbb__statistics_8h_a08f1e46bb511c63da3ce07aa9c897bc4}{GATHER\_STATISTIC}}(\ ++my\_counters.prio\_winnowings\ );}
\DoxyCodeLine{00824\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1f221aa79878e3962ea2b3eaa7429fe1}{is\_task\_pool\_published}}(),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00825\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ my\_offloaded\_tasks,\ \textcolor{stringliteral}{"{}At\ least\ one\ task\ is\ expected\ to\ be\ already\ offloaded"{}}\ );}
\DoxyCodeLine{00826\ \ \ \ \ \textcolor{comment}{//\ To\ eliminate\ possible\ sinking\ of\ the\ store\ to\ the\ indicator\ below\ the\ subsequent}}
\DoxyCodeLine{00827\ \ \ \ \ \textcolor{comment}{//\ store\ to\ my\_arena\_slot-\/>tail,\ the\ stores\ should\ have\ either\ been\ separated}}
\DoxyCodeLine{00828\ \ \ \ \ \textcolor{comment}{//\ by\ full\ fence\ or\ both\ use\ release\ fences.\ And\ resetting\ indicator\ should\ have}}
\DoxyCodeLine{00829\ \ \ \ \ \textcolor{comment}{//\ been\ done\ with\ release\ fence.\ But\ since\ this\ is\ just\ an\ optimization,\ and}}
\DoxyCodeLine{00830\ \ \ \ \ \textcolor{comment}{//\ the\ corresponding\ checking\ sequence\ in\ arena::is\_out\_of\_work()\ is\ not\ atomic}}
\DoxyCodeLine{00831\ \ \ \ \ \textcolor{comment}{//\ anyway,\ fences\ aren't\ used,\ so\ that\ not\ to\ penalize\ warmer\ path.}}
\DoxyCodeLine{00832\ \ \ \ \ auto\_indicator\ indicator(\ my\_pool\_reshuffling\_pending\ );}
\DoxyCodeLine{00833\ }
\DoxyCodeLine{00834\ \ \ \ \ \textcolor{comment}{//\ Locking\ the\ task\ pool\ unconditionally\ produces\ simpler\ code,}}
\DoxyCodeLine{00835\ \ \ \ \ \textcolor{comment}{//\ scalability\ of\ which\ should\ not\ suffer\ unless\ priority\ jitter\ takes\ place.}}
\DoxyCodeLine{00836\ \ \ \ \ \textcolor{comment}{//\ TODO:\ consider\ the\ synchronization\ algorithm\ here\ is\ for\ the\ owner\ thread}}
\DoxyCodeLine{00837\ \ \ \ \ \textcolor{comment}{//\ to\ avoid\ locking\ task\ pool\ most\ of\ the\ time.}}
\DoxyCodeLine{00838\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ae1cf7dda46c2687a1ea7edacbea10da1}{acquire\_task\_pool}}();}
\DoxyCodeLine{00839\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ T0\ =\ \_\_TBB\_load\_relaxed(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>tail\ );}
\DoxyCodeLine{00840\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ H0\ =\ \_\_TBB\_load\_relaxed(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>head\ );}
\DoxyCodeLine{00841\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ T1\ =\ 0;}
\DoxyCodeLine{00842\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{shortpath_8cpp_a8648ffe7342bea77e2698690589da3c1}{src}}\ =\ H0;\ \mbox{\hyperlink{shortpath_8cpp_a8648ffe7342bea77e2698690589da3c1}{src}}<T0;\ ++\mbox{\hyperlink{shortpath_8cpp_a8648ffe7342bea77e2698690589da3c1}{src}}\ )\ \{}
\DoxyCodeLine{00843\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}\ *\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr[\mbox{\hyperlink{shortpath_8cpp_a8648ffe7342bea77e2698690589da3c1}{src}}]\ )\ \{}
\DoxyCodeLine{00844\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ cannot\ offload\ a\ proxy\ task\ (check\ the\ priority\ of\ it)\ because\ it\ can\ be\ already\ consumed.}}
\DoxyCodeLine{00845\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a868812dd8d875a225a6f589fdbaafe54}{is\_proxy}}(\ *\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ )\ )\ \{}
\DoxyCodeLine{00846\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ intptr\_t\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ priority(\ *\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ );}
\DoxyCodeLine{00847\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}<*my\_ref\_top\_priority\ )\ \{}
\DoxyCodeLine{00848\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ offload\_task(\ *\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}},\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ );}
\DoxyCodeLine{00849\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00850\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00851\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00852\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr[T1++]\ =\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}};}
\DoxyCodeLine{00853\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00854\ \ \ \ \ \}}
\DoxyCodeLine{00855\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ T1<=T0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00856\ }
\DoxyCodeLine{00857\ \ \ \ \ \textcolor{comment}{//\ Choose\ max(T1,\ H0)\ because\ ranges\ [0,\ T1)\ and\ [H0,\ T0)\ can\ overlap.}}
\DoxyCodeLine{00858\ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>fill\_with\_canary\_pattern(\ \mbox{\hyperlink{datatypes_8h_affe776513b24d84b39af8ab0930fef7f}{max}}(\ T1,\ H0\ ),\ T0\ );}
\DoxyCodeLine{00859\ \ \ \ \ \textcolor{keywordflow}{return}\ get\_task\_and\_activate\_task\_pool(\ 0,\ \mbox{\hyperlink{scheduler__common_8h_ae8bf2edd69c1485ce30d4e88cc7e27d2}{\_\_TBB\_ISOLATION\_ARG}}(\ T1,\ isolation\ )\ );}
\DoxyCodeLine{00860\ \}}
\DoxyCodeLine{00861\ }
\DoxyCodeLine{00862\ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}*\ generic\_scheduler::reload\_tasks\ (\ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}*\&\ offloaded\_tasks,\ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}**\&\ offloaded\_task\_list\_link,\ \mbox{\hyperlink{scheduler__common_8h_ae8bf2edd69c1485ce30d4e88cc7e27d2}{\_\_TBB\_ISOLATION\_ARG}}(\ intptr\_t\ top\_priority,\ isolation\_tag\ isolation\ )\ )\ \{}
\DoxyCodeLine{00863\ \ \ \ \ \mbox{\hyperlink{tbb__statistics_8h_a08f1e46bb511c63da3ce07aa9c897bc4}{GATHER\_STATISTIC}}(\ ++my\_counters.prio\_reloads\ );}
\DoxyCodeLine{00864\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_ISOLATION}}
\DoxyCodeLine{00865\ \ \ \ \ \textcolor{comment}{//\ In\ many\ cases,\ locking\ the\ task\ pool\ is\ no-\/op\ here\ because\ the\ task\ pool\ is\ in\ the\ empty}}
\DoxyCodeLine{00866\ \ \ \ \ \textcolor{comment}{//\ state.\ However,\ isolation\ allows\ entering\ stealing\ loop\ with\ non-\/empty\ task\ pool.}}
\DoxyCodeLine{00867\ \ \ \ \ \textcolor{comment}{//\ In\ principle,\ it\ is\ possible\ to\ process\ reloaded\ tasks\ without\ locking\ but\ it\ will}}
\DoxyCodeLine{00868\ \ \ \ \ \textcolor{comment}{//\ complicate\ the\ logic\ of\ get\_task\_and\_activate\_task\_pool\ (TODO:\ evaluate).}}
\DoxyCodeLine{00869\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ae1cf7dda46c2687a1ea7edacbea10da1}{acquire\_task\_pool}}();}
\DoxyCodeLine{00870\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00871\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1f221aa79878e3962ea2b3eaa7429fe1}{is\_task\_pool\_published}}(),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00872\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00873\ \ \ \ \ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}\ *arr[\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1190ee0529a9280846bd50c4f50c8398}{min\_task\_pool\_size}}];}
\DoxyCodeLine{00874\ \ \ \ \ fast\_reverse\_vector<task*>\ tasks(arr,\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1190ee0529a9280846bd50c4f50c8398}{min\_task\_pool\_size}});}
\DoxyCodeLine{00875\ \ \ \ \ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}\ **link\ =\ \&offloaded\_tasks;}
\DoxyCodeLine{00876\ \ \ \ \ \textcolor{keywordflow}{while}\ (\ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}\ *\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ *link\ )\ \{}
\DoxyCodeLine{00877\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}**\ next\_ptr\ =\ \&\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().next\_offloaded;}
\DoxyCodeLine{00878\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a868812dd8d875a225a6f589fdbaafe54}{is\_proxy}}(*\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}),\ \textcolor{stringliteral}{"{}The\ proxy\ tasks\ cannot\ be\ offloaded"{}}\ );}
\DoxyCodeLine{00879\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ priority(*\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}})\ >=\ top\_priority\ )\ \{}
\DoxyCodeLine{00880\ \ \ \ \ \ \ \ \ \ \ \ \ tasks.push\_back(\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ );}
\DoxyCodeLine{00881\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Note\ that\ owner\ is\ an\ alias\ of\ next\_offloaded.\ Thus\ the\ following}}
\DoxyCodeLine{00882\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ assignment\ overwrites\ *next\_ptr}}
\DoxyCodeLine{00883\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}*\ \mbox{\hyperlink{namespaceeastl_a4e92bbac38652d0b6a6b9882c003fd43}{next}}\ =\ *next\_ptr;}
\DoxyCodeLine{00884\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().owner\ =\ \textcolor{keyword}{this};}
\DoxyCodeLine{00885\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().state\ ==\ task::ready,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00886\ \ \ \ \ \ \ \ \ \ \ \ \ *link\ =\ \mbox{\hyperlink{namespaceeastl_a4e92bbac38652d0b6a6b9882c003fd43}{next}};}
\DoxyCodeLine{00887\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00888\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00889\ \ \ \ \ \ \ \ \ \ \ \ \ link\ =\ next\_ptr;}
\DoxyCodeLine{00890\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00891\ \ \ \ \ \}}
\DoxyCodeLine{00892\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ link\ ==\ \&offloaded\_tasks\ )\ \{}
\DoxyCodeLine{00893\ \ \ \ \ \ \ \ \ offloaded\_tasks\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00894\ \textcolor{preprocessor}{\#if\ TBB\_USE\_ASSERT}}
\DoxyCodeLine{00895\ \ \ \ \ \ \ \ \ offloaded\_task\_list\_link\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00896\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ TBB\_USE\_ASSERT\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00897\ \ \ \ \ \}}
\DoxyCodeLine{00898\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00899\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ link,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00900\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Mark\ end\ of\ list}}
\DoxyCodeLine{00901\ \ \ \ \ \ \ \ \ *link\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00902\ \ \ \ \ \ \ \ \ offloaded\_task\_list\_link\ =\ link;}
\DoxyCodeLine{00903\ \ \ \ \ \}}
\DoxyCodeLine{00904\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ link,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00905\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ num\_tasks\ =\ tasks.size();}
\DoxyCodeLine{00906\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !num\_tasks\ )\ \{}
\DoxyCodeLine{00907\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{scheduler__common_8h_a63e9a35b6d2bfbfb21b3199dc03acc6d}{\_\_TBB\_ISOLATION\_EXPR}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a6ff28eab04933075791b16075ceb5950}{release\_task\_pool}}()\ );}
\DoxyCodeLine{00908\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00909\ \ \ \ \ \}}
\DoxyCodeLine{00910\ }
\DoxyCodeLine{00911\ \ \ \ \ \textcolor{comment}{//\ Copy\ found\ tasks\ into\ the\ task\ pool.}}
\DoxyCodeLine{00912\ \ \ \ \ \mbox{\hyperlink{tbb__statistics_8h_a08f1e46bb511c63da3ce07aa9c897bc4}{GATHER\_STATISTIC}}(\ ++my\_counters.prio\_tasks\_reloaded\ );}
\DoxyCodeLine{00913\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a0460616fb84af745b12688927ff1bb7d}{prepare\_task\_pool}}(\ num\_tasks\ );}
\DoxyCodeLine{00914\ \ \ \ \ tasks.copy\_memory(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr\ +\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ );}
\DoxyCodeLine{00915\ }
\DoxyCodeLine{00916\ \ \ \ \ \textcolor{comment}{//\ Find\ a\ task\ available\ for\ execution.}}
\DoxyCodeLine{00917\ \ \ \ \ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}\ *\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ get\_task\_and\_activate\_task\_pool(\ \_\_TBB\_load\_relaxed(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>head\ ),\ \mbox{\hyperlink{scheduler__common_8h_ae8bf2edd69c1485ce30d4e88cc7e27d2}{\_\_TBB\_ISOLATION\_ARG}}(\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ +\ num\_tasks,\ isolation\ )\ );}
\DoxyCodeLine{00918\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ )\ -\/-\/num\_tasks;}
\DoxyCodeLine{00919\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ num\_tasks\ )}
\DoxyCodeLine{00920\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>advertise\_new\_work<\mbox{\hyperlink{classtbb_1_1internal_1_1arena_a2380e7751924d1199ffab7b2ee29ddeea2109ea81736367212fa797959b4b4381}{arena::work\_spawned}}>();}
\DoxyCodeLine{00921\ }
\DoxyCodeLine{00922\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}};}
\DoxyCodeLine{00923\ \}}
\DoxyCodeLine{00924\ }
\DoxyCodeLine{00925\ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}*\ generic\_scheduler::reload\_tasks(\ \mbox{\hyperlink{scheduler__common_8h_a63e9a35b6d2bfbfb21b3199dc03acc6d}{\_\_TBB\_ISOLATION\_EXPR}}(\ isolation\_tag\ isolation\ )\ )\ \{}
\DoxyCodeLine{00926\ \ \ \ \ \mbox{\hyperlink{namespacedetail_a0414a8c27708e113938314ad3b0dbe4c}{uintptr\_t}}\ reload\_epoch\ =\ *my\_ref\_reload\_epoch;}
\DoxyCodeLine{00927\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ my\_offloaded\_tasks,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00928\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ my\_local\_reload\_epoch\ <=\ reload\_epoch}
\DoxyCodeLine{00929\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ||\ my\_local\_reload\_epoch\ -\/\ reload\_epoch\ >\ \mbox{\hyperlink{namespacedetail_a0414a8c27708e113938314ad3b0dbe4c}{uintptr\_t}}(-\/1)/2,}
\DoxyCodeLine{00930\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Reload\ epoch\ counter\ overflow?"{}}\ );}
\DoxyCodeLine{00931\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ my\_local\_reload\_epoch\ ==\ reload\_epoch\ )}
\DoxyCodeLine{00932\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00933\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ my\_offloaded\_tasks,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00934\ \ \ \ \ intptr\_t\ top\_priority\ =\ effective\_reference\_priority();}
\DoxyCodeLine{00935\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ (uintptr\_t)top\_priority\ <\ (uintptr\_t)\mbox{\hyperlink{namespacetbb_1_1internal_ae1dadab9152ec72bebfb2827c03846e6}{num\_priority\_levels}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00936\ \ \ \ \ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}\ *\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ reload\_tasks(\ my\_offloaded\_tasks,\ my\_offloaded\_task\_list\_tail\_link,\ \mbox{\hyperlink{scheduler__common_8h_ae8bf2edd69c1485ce30d4e88cc7e27d2}{\_\_TBB\_ISOLATION\_ARG}}(\ top\_priority,\ isolation\ )\ );}
\DoxyCodeLine{00937\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ my\_offloaded\_tasks\ \&\&\ (\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>my\_bottom\_priority\ >=\ top\_priority\ ||\ !\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>my\_num\_workers\_requested)\ )\ \{}
\DoxyCodeLine{00938\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Safeguard\ against\ deliberately\ relaxed\ synchronization\ while\ checking}}
\DoxyCodeLine{00939\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ the\ presence\ of\ work\ in\ arena\ (so\ that\ not\ to\ impact\ hot\ paths).}}
\DoxyCodeLine{00940\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Arena\ may\ be\ reset\ to\ empty\ state\ when\ offloaded\ low\ priority\ tasks}}
\DoxyCodeLine{00941\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ are\ still\ present.\ This\ results\ in\ both\ bottom\ and\ top\ priority\ bounds}}
\DoxyCodeLine{00942\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ becoming\ 'normal',\ which\ makes\ offloaded\ low\ priority\ tasks\ unreachable.}}
\DoxyCodeLine{00943\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ arena's\ bottom\ priority\ to\ accommodate\ them.}}
\DoxyCodeLine{00944\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ NOTE:\ \ \ \ If\ the\ number\ of\ priority\ levels\ is\ increased,\ we\ may\ want}}
\DoxyCodeLine{00945\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ to\ calculate\ minimum\ of\ priorities\ in\ my\_offloaded\_tasks.}}
\DoxyCodeLine{00946\ }
\DoxyCodeLine{00947\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ First\ indicate\ the\ presence\ of\ lower-\/priority\ tasks}}
\DoxyCodeLine{00948\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ac652e4a610353888a31352e678955e1b}{my\_market}}-\/>update\_arena\_priority(\ *\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}},\ priority(*my\_offloaded\_tasks)\ );}
\DoxyCodeLine{00949\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Then\ mark\ arena\ as\ full\ to\ unlock\ arena\ priority\ level\ adjustment}}
\DoxyCodeLine{00950\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ by\ arena::is\_out\_of\_work(),\ and\ ensure\ worker's\ presence}}
\DoxyCodeLine{00951\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>advertise\_new\_work<\mbox{\hyperlink{classtbb_1_1internal_1_1arena_a2380e7751924d1199ffab7b2ee29ddeeac92fe41bfa3a02ea67d83232c9f88b90}{arena::wakeup}}>();}
\DoxyCodeLine{00952\ \ \ \ \ \}}
\DoxyCodeLine{00953\ \ \ \ \ my\_local\_reload\_epoch\ =\ reload\_epoch;}
\DoxyCodeLine{00954\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}};}
\DoxyCodeLine{00955\ \}}
\DoxyCodeLine{00956\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_PRIORITY\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00957\ }
\DoxyCodeLine{00958\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_ISOLATION}}
\DoxyCodeLine{00959\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}*\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a10c72a4aad7308d944cef26502ece55e}{generic\_scheduler::get\_task}}(\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ isolation\_tag\ isolation,\ \textcolor{keywordtype}{bool}\&\ tasks\_omitted\ )}
\DoxyCodeLine{00960\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00961\ \textcolor{keyword}{inline}\ task*\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a10c72a4aad7308d944cef26502ece55e}{generic\_scheduler::get\_task}}(\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ )}
\DoxyCodeLine{00962\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_ISOLATION\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00963\ \{}
\DoxyCodeLine{00964\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \_\_TBB\_load\_relaxed(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>tail\ )\ <=\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}}
\DoxyCodeLine{00965\ \ \ \ \ \ \ \ \ ||\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a74b022285a6ff04a9ea2957999d4def3}{is\_local\_task\_pool\_quiescent}}(),\ \textcolor{stringliteral}{"{}Is\ it\ safe\ to\ get\ a\ task\ at\ position\ T?"{}}\ );}
\DoxyCodeLine{00966\ }
\DoxyCodeLine{00967\ \ \ \ \ task*\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ =\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr[\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}];}
\DoxyCodeLine{00968\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !is\_poisoned(\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ ),\ \textcolor{stringliteral}{"{}The\ poisoned\ task\ is\ going\ to\ be\ processed"{}}\ );}
\DoxyCodeLine{00969\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_ISOLATION}}
\DoxyCodeLine{00970\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ )}
\DoxyCodeLine{00971\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00972\ }
\DoxyCodeLine{00973\ \ \ \ \ \textcolor{keywordtype}{bool}\ omit\ =\ isolation\ !=\ no\_isolation\ \&\&\ isolation\ !=\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}-\/>prefix().isolation;}
\DoxyCodeLine{00974\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !omit\ \&\&\ !\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a868812dd8d875a225a6f589fdbaafe54}{is\_proxy}}(\ *\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ )\ )}
\DoxyCodeLine{00975\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}};}
\DoxyCodeLine{00976\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ omit\ )\ \{}
\DoxyCodeLine{00977\ \ \ \ \ \ \ \ \ tasks\_omitted\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00978\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00979\ \ \ \ \ \}}
\DoxyCodeLine{00980\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00981\ \ \ \ \ poison\_pointer(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr[\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}]\ );}
\DoxyCodeLine{00982\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ ||\ !\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a868812dd8d875a225a6f589fdbaafe54}{is\_proxy}}(\ *\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ )\ )}
\DoxyCodeLine{00983\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}};}
\DoxyCodeLine{00984\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_ISOLATION\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00985\ }
\DoxyCodeLine{00986\ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy}{task\_proxy}}\&\ tp\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy}{task\_proxy}}\&\textcolor{keyword}{>}(*result);}
\DoxyCodeLine{00987\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ task\ *\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ tp.\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a40da3f9c1cf3a45264946dac05f7b9b6}{extract\_task}}<\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a6339e879ab7b6576df404a749f603c51}{task\_proxy::pool\_bit}}>()\ )\ \{}
\DoxyCodeLine{00988\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__statistics_8h_a08f1e46bb511c63da3ce07aa9c897bc4}{GATHER\_STATISTIC}}(\ ++my\_counters.proxies\_executed\ );}
\DoxyCodeLine{00989\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Following\ assertion\ should\ be\ true\ because\ TBB\ 2.0\ tasks\ never\ specify\ affinity,\ and\ hence\ are\ not\ proxied.}}
\DoxyCodeLine{00990\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a33519b4cf710f8c46129672f79fb6ec4}{is\_version\_3\_task}}(\ *\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ ),\ \textcolor{stringliteral}{"{}backwards\ compatibility\ with\ TBB\ 2.0\ broken"{}}\ );}
\DoxyCodeLine{00991\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_aac9af4d8baddbbc2af433e11297be8a5}{my\_innermost\_running\_task}}\ =\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}};\ \textcolor{comment}{//\ prepare\ for\ calling\ note\_affinity()}}
\DoxyCodeLine{00992\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_ISOLATION}}
\DoxyCodeLine{00993\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Task\ affinity\ has\ changed.\ Postpone\ calling\ note\_affinity\ because\ the\ task\ pool\ is\ in\ invalid\ state.}}
\DoxyCodeLine{00994\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !tasks\_omitted\ )}
\DoxyCodeLine{00995\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_ISOLATION\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00996\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00997\ \ \ \ \ \ \ \ \ \ \ \ \ poison\_pointer(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr[\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}]\ );}
\DoxyCodeLine{00998\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>note\_affinity(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a3a635bad42d492013d4a06d1af0c452b}{my\_affinity\_id}}\ );}
\DoxyCodeLine{00999\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01000\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}};}
\DoxyCodeLine{01001\ \ \ \ \ \}}
\DoxyCodeLine{01002\ }
\DoxyCodeLine{01003\ \ \ \ \ \textcolor{comment}{//\ Proxy\ was\ empty,\ so\ it's\ our\ responsibility\ to\ free\ it}}
\DoxyCodeLine{01004\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a12dd37171af77214add72a973e6b71ba}{free\_task<small\_task>}}(\ tp\ );}
\DoxyCodeLine{01005\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_ISOLATION}}
\DoxyCodeLine{01006\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ tasks\_omitted\ )}
\DoxyCodeLine{01007\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr[\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}]\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01008\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_ISOLATION\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{01009\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01010\ \}}
\DoxyCodeLine{01011\ }
\DoxyCodeLine{01012\ \textcolor{keyword}{inline}\ task*\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a10c72a4aad7308d944cef26502ece55e}{generic\_scheduler::get\_task}}(\ \mbox{\hyperlink{scheduler__common_8h_a63e9a35b6d2bfbfb21b3199dc03acc6d}{\_\_TBB\_ISOLATION\_EXPR}}(\ isolation\_tag\ isolation\ )\ )\ \{}
\DoxyCodeLine{01013\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1f221aa79878e3962ea2b3eaa7429fe1}{is\_task\_pool\_published}}(),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{01014\ \ \ \ \ \textcolor{comment}{//\ The\ current\ task\ position\ in\ the\ task\ pool.}}
\DoxyCodeLine{01015\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ T0\ =\ \_\_TBB\_load\_relaxed(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>tail\ );}
\DoxyCodeLine{01016\ \ \ \ \ \textcolor{comment}{//\ The\ bounds\ of\ available\ tasks\ in\ the\ task\ pool.\ H0\ is\ only\ used\ when\ the\ head\ bound\ is\ reached.}}
\DoxyCodeLine{01017\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ H0\ =\ (size\_t)-\/1,\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ =\ T0;}
\DoxyCodeLine{01018\ \ \ \ \ task*\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01019\ \ \ \ \ \textcolor{keywordtype}{bool}\ task\_pool\_empty\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01020\ \ \ \ \ \mbox{\hyperlink{scheduler__common_8h_a63e9a35b6d2bfbfb21b3199dc03acc6d}{\_\_TBB\_ISOLATION\_EXPR}}(\ \textcolor{keywordtype}{bool}\ tasks\_omitted\ =\ \textcolor{keyword}{false}\ );}
\DoxyCodeLine{01021\ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{01022\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{01023\ \ \ \ \ \ \ \ \ \_\_TBB\_store\_relaxed(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>tail,\ -\/-\/\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ );}
\DoxyCodeLine{01024\ \ \ \ \ \ \ \ \ atomic\_fence();}
\DoxyCodeLine{01025\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ (intptr\_t)\_\_TBB\_load\_relaxed(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>head\ )\ >\ (intptr\_t)\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ )\ \{}
\DoxyCodeLine{01026\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ae1cf7dda46c2687a1ea7edacbea10da1}{acquire\_task\_pool}}();}
\DoxyCodeLine{01027\ \ \ \ \ \ \ \ \ \ \ \ \ H0\ =\ \_\_TBB\_load\_relaxed(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>head\ );}
\DoxyCodeLine{01028\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ (intptr\_t)H0\ >\ (intptr\_t)\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ )\ \{}
\DoxyCodeLine{01029\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ thief\ has\ not\ backed\ off\ -\/\ nothing\ to\ grab.}}
\DoxyCodeLine{01030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ H0\ ==\ \_\_TBB\_load\_relaxed(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>head\ )}
\DoxyCodeLine{01031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ ==\ \_\_TBB\_load\_relaxed(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>tail\ )}
\DoxyCodeLine{01032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\&\ H0\ ==\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ +\ 1,\ \textcolor{stringliteral}{"{}victim/thief\ arbitration\ algorithm\ failure"{}}\ );}
\DoxyCodeLine{01033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ad8f6a6793961db84240434fffd7b50f3}{reset\_task\_pool\_and\_leave}}();}
\DoxyCodeLine{01034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ tasks\ in\ the\ task\ pool.}}
\DoxyCodeLine{01035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task\_pool\_empty\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01037\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ H0\ ==\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ )\ \{}
\DoxyCodeLine{01038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ There\ is\ only\ one\ task\ in\ the\ task\ pool.}}
\DoxyCodeLine{01039\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ad8f6a6793961db84240434fffd7b50f3}{reset\_task\_pool\_and\_leave}}();}
\DoxyCodeLine{01040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ task\_pool\_empty\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01041\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01042\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Release\ task\ pool\ if\ there\ are\ still\ some\ tasks.}}
\DoxyCodeLine{01043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ After\ the\ release,\ the\ tail\ will\ be\ less\ than\ T,\ thus\ a\ thief}}
\DoxyCodeLine{01044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ will\ not\ attempt\ to\ get\ a\ task\ at\ position\ T.}}
\DoxyCodeLine{01045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a6ff28eab04933075791b16075ceb5950}{release\_task\_pool}}();}
\DoxyCodeLine{01046\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01047\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01048\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{gcc__generic_8h_a739e3f9cf251b0c785e86fba7c8f8c7c}{\_\_TBB\_control\_consistency\_helper}}();\ \textcolor{comment}{//\ on\ my\_arena\_slot-\/>head}}
\DoxyCodeLine{01049\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_ISOLATION}}
\DoxyCodeLine{01050\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a10c72a4aad7308d944cef26502ece55e}{get\_task}}(\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ isolation,\ tasks\_omitted\ );}
\DoxyCodeLine{01051\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ )\ \{}
\DoxyCodeLine{01052\ \ \ \ \ \ \ \ \ \ \ \ \ poison\_pointer(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr[\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}]\ );}
\DoxyCodeLine{01053\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01054\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ !tasks\_omitted\ )\ \{}
\DoxyCodeLine{01055\ \ \ \ \ \ \ \ \ \ \ \ \ poison\_pointer(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr[\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}]\ );}
\DoxyCodeLine{01056\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ T0\ ==\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}+1,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{01057\ \ \ \ \ \ \ \ \ \ \ \ \ T0\ =\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}};}
\DoxyCodeLine{01058\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01059\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{01060\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a10c72a4aad7308d944cef26502ece55e}{get\_task}}(\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ );}
\DoxyCodeLine{01061\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_ISOLATION\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{01062\ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ (\ !\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ \&\&\ !task\_pool\_empty\ );}
\DoxyCodeLine{01063\ }
\DoxyCodeLine{01064\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_ISOLATION}}
\DoxyCodeLine{01065\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ tasks\_omitted\ )\ \{}
\DoxyCodeLine{01066\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ task\_pool\_empty\ )\ \{}
\DoxyCodeLine{01067\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ All\ tasks\ have\ been\ checked.\ The\ task\ pool\ should\ be\ \ in\ reset\ state.}}
\DoxyCodeLine{01068\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ just\ restore\ the\ bounds\ for\ the\ available\ tasks.}}
\DoxyCodeLine{01069\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ Does\ it\ have\ sense\ to\ move\ them\ to\ the\ beginning\ of\ the\ task\ pool?}}
\DoxyCodeLine{01070\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a089d1ca7efe019834cc06e82b4f3d883}{is\_quiescent\_local\_task\_pool\_reset}}(),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{01071\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ )\ \{}
\DoxyCodeLine{01072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ a\ task,\ it\ should\ be\ at\ H0\ position.}}
\DoxyCodeLine{01073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ H0\ ==\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{01074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++H0;}
\DoxyCodeLine{01075\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01076\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ H0\ <=\ T0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{01077\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ H0\ <\ T0\ )\ \{}
\DoxyCodeLine{01078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Restore\ the\ task\ pool\ if\ there\ are\ some\ tasks.}}
\DoxyCodeLine{01079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_\_TBB\_store\_relaxed(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>head,\ H0\ );}
\DoxyCodeLine{01080\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_\_TBB\_store\_relaxed(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>tail,\ T0\ );}
\DoxyCodeLine{01081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ release\ fence\ is\ used\ in\ publish\_task\_pool.}}
\DoxyCodeLine{01082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_af222cccbf09e91c9c9caaad81f8d993d}{publish\_task\_pool}}();}
\DoxyCodeLine{01083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Synchronize\ with\ snapshot\ as\ we\ published\ some\ tasks.}}
\DoxyCodeLine{01084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>advertise\_new\_work<\mbox{\hyperlink{classtbb_1_1internal_1_1arena_a2380e7751924d1199ffab7b2ee29ddeeac92fe41bfa3a02ea67d83232c9f88b90}{arena::wakeup}}>();}
\DoxyCodeLine{01085\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01086\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01087\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ A\ task\ has\ been\ obtained.\ We\ need\ to\ make\ a\ hole\ in\ position\ T.}}
\DoxyCodeLine{01088\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1f221aa79878e3962ea2b3eaa7429fe1}{is\_task\_pool\_published}}(),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{01089\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{01090\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr[\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}]\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01091\ \ \ \ \ \ \ \ \ \ \ \ \ \_\_TBB\_store\_with\_release(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>tail,\ T0\ );}
\DoxyCodeLine{01092\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Synchronize\ with\ snapshot\ as\ we\ published\ some\ tasks.}}
\DoxyCodeLine{01093\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ consider\ some\ approach\ not\ to\ call\ wakeup\ for\ each\ time.\ E.g.\ check\ if\ the\ tail\ reached\ the\ head.}}
\DoxyCodeLine{01094\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>advertise\_new\_work<\mbox{\hyperlink{classtbb_1_1internal_1_1arena_a2380e7751924d1199ffab7b2ee29ddeeac92fe41bfa3a02ea67d83232c9f88b90}{arena::wakeup}}>();}
\DoxyCodeLine{01095\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01096\ }
\DoxyCodeLine{01097\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ it\ is\ safe\ to\ call\ note\_affinity\ because\ the\ task\ pool\ is\ restored.}}
\DoxyCodeLine{01098\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_aac9af4d8baddbbc2af433e11297be8a5}{my\_innermost\_running\_task}}\ ==\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ )\ \{}
\DoxyCodeLine{01099\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a35e1c039fac0fa1b7d8b4f491d557a86}{assert\_task\_valid}}(\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ );}
\DoxyCodeLine{01100\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}-\/>note\_affinity(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a3a635bad42d492013d4a06d1af0c452b}{my\_affinity\_id}}\ );}
\DoxyCodeLine{01101\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01102\ \ \ \ \ \}}
\DoxyCodeLine{01103\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_ISOLATION\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{01104\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ (intptr\_t)\_\_TBB\_load\_relaxed(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>tail\ )\ >=\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{01105\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ ||\ \mbox{\hyperlink{scheduler__common_8h_a63e9a35b6d2bfbfb21b3199dc03acc6d}{\_\_TBB\_ISOLATION\_EXPR}}(\ tasks\_omitted\ ||\ )\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a089d1ca7efe019834cc06e82b4f3d883}{is\_quiescent\_local\_task\_pool\_reset}}(),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{01106\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}};}
\DoxyCodeLine{01107\ \}\ \textcolor{comment}{//\ generic\_scheduler::get\_task}}
\DoxyCodeLine{01108\ }
\DoxyCodeLine{01109\ task*\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_abb8f3f3967170ca9398e55b90220c3cb}{generic\_scheduler::steal\_task}}(\ \mbox{\hyperlink{scheduler__common_8h_a63e9a35b6d2bfbfb21b3199dc03acc6d}{\_\_TBB\_ISOLATION\_EXPR}}(isolation\_tag\ isolation)\ )\ \{}
\DoxyCodeLine{01110\ \ \ \ \ \textcolor{comment}{//\ Try\ to\ steal\ a\ task\ from\ a\ random\ victim.}}
\DoxyCodeLine{01111\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ k\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_aee56a8b51b71d3f96f9c8cacf00fe845}{my\_random}}.get()\ \%\ (\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>my\_limit-\/1);}
\DoxyCodeLine{01112\ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1arena__slot}{arena\_slot}}*\ victim\ =\ \&\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>my\_slots[k];}
\DoxyCodeLine{01113\ \ \ \ \ \textcolor{comment}{//\ The\ following\ condition\ excludes\ the\ master\ that\ might\ have}}
\DoxyCodeLine{01114\ \ \ \ \ \textcolor{comment}{//\ already\ taken\ our\ previous\ place\ in\ the\ arena\ from\ the\ list\ .}}
\DoxyCodeLine{01115\ \ \ \ \ \textcolor{comment}{//\ of\ potential\ victims.\ But\ since\ such\ a\ situation\ can\ take}}
\DoxyCodeLine{01116\ \ \ \ \ \textcolor{comment}{//\ place\ only\ in\ case\ of\ significant\ oversubscription,\ keeping}}
\DoxyCodeLine{01117\ \ \ \ \ \textcolor{comment}{//\ the\ checks\ simple\ seems\ to\ be\ preferable\ to\ complicating\ the\ code.}}
\DoxyCodeLine{01118\ \ \ \ \ \textcolor{keywordflow}{if}(\ k\ >=\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a35aa72cfdda3b500e908925a3d6da747}{my\_arena\_index}}\ )}
\DoxyCodeLine{01119\ \ \ \ \ \ \ \ \ ++victim;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Adjusts\ random\ distribution\ to\ exclude\ self}}
\DoxyCodeLine{01120\ \ \ \ \ task\ **\mbox{\hyperlink{namespacetbb_1_1pool}{pool}}\ =\ victim-\/>task\_pool;}
\DoxyCodeLine{01121\ \ \ \ \ task\ *\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01122\ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{namespacetbb_1_1pool}{pool}}\ ==\ \mbox{\hyperlink{scheduler_8h_a6f1c5fa8b2e50a1a91282165c7a9dae2}{EmptyTaskPool}}\ ||\ !(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a15b506cb1b1da8e37255fc2fcdf250f0}{steal\_task\_from}}(\ \mbox{\hyperlink{scheduler__common_8h_ae8bf2edd69c1485ce30d4e88cc7e27d2}{\_\_TBB\_ISOLATION\_ARG}}(*victim,\ isolation)\ ))\ )}
\DoxyCodeLine{01123\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01124\ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a868812dd8d875a225a6f589fdbaafe54}{is\_proxy}}(*\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}})\ )\ \{}
\DoxyCodeLine{01125\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy}{task\_proxy}}\ \&tp\ =\ *(\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy}{task\_proxy}}*)\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}};}
\DoxyCodeLine{01126\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ tp.\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a40da3f9c1cf3a45264946dac05f7b9b6}{extract\_task}}<\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a6339e879ab7b6576df404a749f603c51}{task\_proxy::pool\_bit}}>();}
\DoxyCodeLine{01127\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ )\ \{}
\DoxyCodeLine{01128\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Proxy\ was\ empty,\ so\ it's\ our\ responsibility\ to\ free\ it}}
\DoxyCodeLine{01129\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a12dd37171af77214add72a973e6b71ba}{free\_task<no\_cache\_small\_task>}}(tp);}
\DoxyCodeLine{01130\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01131\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01132\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__statistics_8h_a08f1e46bb511c63da3ce07aa9c897bc4}{GATHER\_STATISTIC}}(\ ++my\_counters.proxies\_stolen\ );}
\DoxyCodeLine{01133\ \ \ \ \ \}}
\DoxyCodeLine{01134\ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().extra\_state\ |=\ \mbox{\hyperlink{namespacetbb_1_1internal_a5fb219223e38c8bbcc47d7c943f48e54a2e086a4d594002615b167ab481fa32fe}{es\_task\_is\_stolen}};}
\DoxyCodeLine{01135\ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a33519b4cf710f8c46129672f79fb6ec4}{is\_version\_3\_task}}(*\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}})\ )\ \{}
\DoxyCodeLine{01136\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_aac9af4d8baddbbc2af433e11297be8a5}{my\_innermost\_running\_task}}\ =\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}};}
\DoxyCodeLine{01137\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>prefix().owner\ =\ \textcolor{keyword}{this};}
\DoxyCodeLine{01138\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}-\/>note\_affinity(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a3a635bad42d492013d4a06d1af0c452b}{my\_affinity\_id}}\ );}
\DoxyCodeLine{01139\ \ \ \ \ \}}
\DoxyCodeLine{01140\ \ \ \ \ \mbox{\hyperlink{tbb__statistics_8h_a08f1e46bb511c63da3ce07aa9c897bc4}{GATHER\_STATISTIC}}(\ ++my\_counters.steals\_committed\ );}
\DoxyCodeLine{01141\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}};}
\DoxyCodeLine{01142\ \}}
\DoxyCodeLine{01143\ }
\DoxyCodeLine{01144\ task*\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a15b506cb1b1da8e37255fc2fcdf250f0}{generic\_scheduler::steal\_task\_from}}(\ \mbox{\hyperlink{scheduler__common_8h_ae8bf2edd69c1485ce30d4e88cc7e27d2}{\_\_TBB\_ISOLATION\_ARG}}(\ \mbox{\hyperlink{structtbb_1_1internal_1_1arena__slot}{arena\_slot}}\&\ victim\_slot,\ isolation\_tag\ isolation\ )\ )\ \{}
\DoxyCodeLine{01145\ \ \ \ \ task**\ victim\_pool\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a3def047033ef29c77c43db170a38df2c}{lock\_task\_pool}}(\ \&victim\_slot\ );}
\DoxyCodeLine{01146\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !victim\_pool\ )}
\DoxyCodeLine{01147\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01148\ \ \ \ \ task*\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01149\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{gnuplot__common__settings_8hh_a1312167399d185be316962d53af87c87}{H}}\ =\ \_\_TBB\_load\_relaxed(victim\_slot.head);\ \textcolor{comment}{//\ mirror}}
\DoxyCodeLine{01150\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ H0\ =\ \mbox{\hyperlink{gnuplot__common__settings_8hh_a1312167399d185be316962d53af87c87}{H}};}
\DoxyCodeLine{01151\ \ \ \ \ \textcolor{keywordtype}{bool}\ tasks\_omitted\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01152\ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{01153\ \ \ \ \ \ \ \ \ \_\_TBB\_store\_relaxed(\ victim\_slot.head,\ ++\mbox{\hyperlink{gnuplot__common__settings_8hh_a1312167399d185be316962d53af87c87}{H}}\ );}
\DoxyCodeLine{01154\ \ \ \ \ \ \ \ \ atomic\_fence();}
\DoxyCodeLine{01155\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ (intptr\_t)\mbox{\hyperlink{gnuplot__common__settings_8hh_a1312167399d185be316962d53af87c87}{H}}\ >\ (intptr\_t)\_\_TBB\_load\_relaxed(\ victim\_slot.tail\ )\ )\ \{}
\DoxyCodeLine{01156\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Stealing\ attempt\ failed,\ deque\ contents\ has\ not\ been\ changed\ by\ us}}
\DoxyCodeLine{01157\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__statistics_8h_a08f1e46bb511c63da3ce07aa9c897bc4}{GATHER\_STATISTIC}}(\ ++my\_counters.thief\_backoffs\ );}
\DoxyCodeLine{01158\ \ \ \ \ \ \ \ \ \ \ \ \ \_\_TBB\_store\_relaxed(\ victim\_slot.head,\ \textcolor{comment}{/*dead:\ H\ =\ */}\ H0\ );}
\DoxyCodeLine{01159\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{01160\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{goto}\ unlock;}
\DoxyCodeLine{01161\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01162\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{gcc__generic_8h_a739e3f9cf251b0c785e86fba7c8f8c7c}{\_\_TBB\_control\_consistency\_helper}}();\ \textcolor{comment}{//\ on\ victim\_slot.tail}}
\DoxyCodeLine{01163\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ =\ victim\_pool[\mbox{\hyperlink{gnuplot__common__settings_8hh_a1312167399d185be316962d53af87c87}{H}}-\/1];}
\DoxyCodeLine{01164\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !is\_poisoned(\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ ),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{01165\ }
\DoxyCodeLine{01166\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ )\ \{}
\DoxyCodeLine{01167\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{scheduler__common_8h_a63e9a35b6d2bfbfb21b3199dc03acc6d}{\_\_TBB\_ISOLATION\_EXPR}}(\ \textcolor{keywordflow}{if}\ (\ isolation\ ==\ no\_isolation\ ||\ isolation\ ==\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}-\/>prefix().isolation\ )\ )}
\DoxyCodeLine{01168\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a868812dd8d875a225a6f589fdbaafe54}{is\_proxy}}(\ *\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ )\ )}
\DoxyCodeLine{01170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy}{task\_proxy}}\&\ tp\ =\ *\textcolor{keyword}{static\_cast<}\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy}{task\_proxy}}*\textcolor{keyword}{>}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}});}
\DoxyCodeLine{01172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ mailed\ task\ is\ likely\ to\ be\ grabbed\ by\ its\ destination\ thread,\ skip\ it.}}
\DoxyCodeLine{01173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !(\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a364254f54e3817ee490eab693b9ee916}{task\_proxy::is\_shared}}(\ tp.\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_abedfdfcd6048685cf9aa032ca2380adf}{task\_and\_tag}}\ )\ \&\&\ tp.\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a32d3a7685efa9cf073409277295091a8}{outbox}}-\/>\mbox{\hyperlink{classtbb_1_1internal_1_1mail__outbox_acaf8c50736e4d27b6755f006f1a5a38e}{recipient\_is\_idle}}())\ )}
\DoxyCodeLine{01174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__statistics_8h_a08f1e46bb511c63da3ce07aa9c897bc4}{GATHER\_STATISTIC}}(\ ++my\_counters.proxies\_bypassed\ );}
\DoxyCodeLine{01176\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01177\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ task\ cannot\ be\ executed\ either\ due\ to\ isolation\ or\ proxy\ constraints.}}
\DoxyCodeLine{01178\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01179\ \ \ \ \ \ \ \ \ \ \ \ \ tasks\_omitted\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01180\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ !tasks\_omitted\ )\ \{}
\DoxyCodeLine{01181\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Cleanup\ the\ task\ pool\ from\ holes\ until\ a\ task\ is\ skipped.}}
\DoxyCodeLine{01182\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ H0\ ==\ \mbox{\hyperlink{gnuplot__common__settings_8hh_a1312167399d185be316962d53af87c87}{H}}-\/1,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{01183\ \ \ \ \ \ \ \ \ \ \ \ \ poison\_pointer(\ victim\_pool[H0]\ );}
\DoxyCodeLine{01184\ \ \ \ \ \ \ \ \ \ \ \ \ H0\ =\ \mbox{\hyperlink{gnuplot__common__settings_8hh_a1312167399d185be316962d53af87c87}{H}};}
\DoxyCodeLine{01185\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01186\ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ (\ !\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ );}
\DoxyCodeLine{01187\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{01188\ }
\DoxyCodeLine{01189\ \ \ \ \ \textcolor{comment}{//\ emit\ "{}task\ was\ consumed"{}\ signal}}
\DoxyCodeLine{01190\ \ \ \ \ \mbox{\hyperlink{itt__notify_8h_adf75d9635323cc786c012fe69ceef418}{ITT\_NOTIFY}}(\ sync\_acquired,\ (\textcolor{keywordtype}{void}*)((uintptr\_t)\&victim\_slot+\textcolor{keyword}{sizeof}(\ uintptr\_t\ ))\ );}
\DoxyCodeLine{01191\ \ \ \ \ poison\_pointer(\ victim\_pool[\mbox{\hyperlink{gnuplot__common__settings_8hh_a1312167399d185be316962d53af87c87}{H}}-\/1]\ );}
\DoxyCodeLine{01192\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ tasks\_omitted\ )\ \{}
\DoxyCodeLine{01193\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Some\ proxies\ in\ the\ task\ pool\ have\ been\ omitted.\ Set\ the\ stolen\ task\ to\ NULL.}}
\DoxyCodeLine{01194\ \ \ \ \ \ \ \ \ victim\_pool[\mbox{\hyperlink{gnuplot__common__settings_8hh_a1312167399d185be316962d53af87c87}{H}}-\/1]\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01195\ \ \ \ \ \ \ \ \ \_\_TBB\_store\_relaxed(\ victim\_slot.head,\ \textcolor{comment}{/*dead:\ H\ =\ */}\ H0\ );}
\DoxyCodeLine{01196\ \ \ \ \ \}}
\DoxyCodeLine{01197\ unlock:}
\DoxyCodeLine{01198\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a9deee19e39b49b7e1f44c87533600b46}{unlock\_task\_pool}}(\ \&victim\_slot,\ victim\_pool\ );}
\DoxyCodeLine{01199\ \textcolor{preprocessor}{\#if\ \_\_TBB\_PREFETCHING}}
\DoxyCodeLine{01200\ \ \ \ \ \mbox{\hyperlink{mic__common_8h_a644c0db3feb5f77ad8bc19a1b775a2a3}{\_\_TBB\_cl\_evict}}(\&victim\_slot.head);}
\DoxyCodeLine{01201\ \ \ \ \ \mbox{\hyperlink{mic__common_8h_a644c0db3feb5f77ad8bc19a1b775a2a3}{\_\_TBB\_cl\_evict}}(\&victim\_slot.tail);}
\DoxyCodeLine{01202\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01203\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ tasks\_omitted\ )}
\DoxyCodeLine{01204\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Synchronize\ with\ snapshot\ as\ the\ head\ and\ tail\ can\ be\ bumped\ which\ can\ falsely\ trigger\ EMPTY\ state}}
\DoxyCodeLine{01205\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>advertise\_new\_work<\mbox{\hyperlink{classtbb_1_1internal_1_1arena_a2380e7751924d1199ffab7b2ee29ddeeac92fe41bfa3a02ea67d83232c9f88b90}{arena::wakeup}}>();}
\DoxyCodeLine{01206\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}};}
\DoxyCodeLine{01207\ \}}
\DoxyCodeLine{01208\ }
\DoxyCodeLine{01209\ \textcolor{preprocessor}{\#if\ \_\_TBB\_PREVIEW\_CRITICAL\_TASKS}}
\DoxyCodeLine{01210\ \textcolor{comment}{//\ Retrieves\ critical\ task\ respecting\ isolation\ level,\ if\ provided.\ The\ rule\ is:}}
\DoxyCodeLine{01211\ \textcolor{comment}{//\ 1)\ If\ no\ outer\ critical\ task\ and\ no\ isolation\ =>\ take\ any\ critical\ task}}
\DoxyCodeLine{01212\ \textcolor{comment}{//\ 2)\ If\ working\ on\ an\ outer\ critical\ task\ and\ no\ isolation\ =>\ cannot\ take\ any\ critical\ task}}
\DoxyCodeLine{01213\ \textcolor{comment}{//\ 3)\ If\ no\ outer\ critical\ task\ but\ isolated\ =>\ respect\ isolation}}
\DoxyCodeLine{01214\ \textcolor{comment}{//\ 4)\ If\ working\ on\ an\ outer\ critical\ task\ and\ isolated\ =>\ respect\ isolation}}
\DoxyCodeLine{01215\ task*\ generic\_scheduler::get\_critical\_task(\ \mbox{\hyperlink{scheduler__common_8h_a63e9a35b6d2bfbfb21b3199dc03acc6d}{\_\_TBB\_ISOLATION\_EXPR}}(isolation\_tag\ isolation)\ )\ \{}
\DoxyCodeLine{01216\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}\ \&\&\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}},\ \textcolor{stringliteral}{"{}Must\ be\ attached\ to\ arena"{}}\ );}
\DoxyCodeLine{01217\ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>my\_critical\_task\_stream.empty(0)\ )}
\DoxyCodeLine{01218\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01219\ \ \ \ \ task*\ critical\_task\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01220\ \ \ \ \ \textcolor{comment}{//\ To\ keep\ some\ LIFO-\/ness,\ start\ search\ with\ the\ lane\ that\ was\ used\ during\ push\ operation.}}
\DoxyCodeLine{01221\ \ \ \ \ \textcolor{keywordtype}{unsigned}\&\ start\_lane\ =\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>hint\_for\_critical;}
\DoxyCodeLine{01222\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_ISOLATION}}
\DoxyCodeLine{01223\ \ \ \ \ \textcolor{keywordflow}{if}(\ isolation\ !=\ no\_isolation\ )\ \{}
\DoxyCodeLine{01224\ \ \ \ \ \ \ \ \ critical\_task\ =\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>my\_critical\_task\_stream.pop\_specific(\ 0,\ start\_lane,\ isolation\ );}
\DoxyCodeLine{01225\ \ \ \ \ \}\ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01226\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01227\ \ \ \ \ \textcolor{keywordflow}{if}(\ !\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_aed181c52b8462c43272d45e625cd31fa}{my\_properties}}.has\_taken\_critical\_task\ )\ \{}
\DoxyCodeLine{01228\ \ \ \ \ \ \ \ \ critical\_task\ =\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>my\_critical\_task\_stream.pop(\ 0,\ \mbox{\hyperlink{structtbb_1_1internal_1_1preceding__lane__selector}{preceding\_lane\_selector}}(start\_lane)\ );}
\DoxyCodeLine{01229\ \ \ \ \ \}}
\DoxyCodeLine{01230\ \ \ \ \ \textcolor{keywordflow}{return}\ critical\_task;}
\DoxyCodeLine{01231\ \}}
\DoxyCodeLine{01232\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01233\ }
\DoxyCodeLine{01234\ task*\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a5657ac6c517d9bbf59a424ef330640bb}{generic\_scheduler::get\_mailbox\_task}}(\ \mbox{\hyperlink{scheduler__common_8h_a63e9a35b6d2bfbfb21b3199dc03acc6d}{\_\_TBB\_ISOLATION\_EXPR}}(\ isolation\_tag\ isolation\ )\ )\ \{}
\DoxyCodeLine{01235\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a3a635bad42d492013d4a06d1af0c452b}{my\_affinity\_id}}>0,\ \textcolor{stringliteral}{"{}not\ in\ arena"{}}\ );}
\DoxyCodeLine{01236\ \ \ \ \ \textcolor{keywordflow}{while}\ (\ \mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy}{task\_proxy}}*\ \textcolor{keyword}{const}\ tp\ =\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a5b120ea3121cd82f578eef2c1319f9fe}{my\_inbox}}.pop(\ \mbox{\hyperlink{scheduler__common_8h_a63e9a35b6d2bfbfb21b3199dc03acc6d}{\_\_TBB\_ISOLATION\_EXPR}}(\ isolation\ )\ )\ )\ \{}
\DoxyCodeLine{01237\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ task*\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}\ =\ tp-\/>extract\_task<\mbox{\hyperlink{structtbb_1_1internal_1_1task__proxy_a7b7339255177d3817844a39271e20484}{task\_proxy::mailbox\_bit}}>()\ )\ \{}
\DoxyCodeLine{01238\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{itt__notify_8h_adf75d9635323cc786c012fe69ceef418}{ITT\_NOTIFY}}(\ sync\_acquired,\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a5b120ea3121cd82f578eef2c1319f9fe}{my\_inbox}}.outbox()\ );}
\DoxyCodeLine{01239\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}}-\/>prefix().extra\_state\ |=\ \mbox{\hyperlink{namespacetbb_1_1internal_a5fb219223e38c8bbcc47d7c943f48e54a2e086a4d594002615b167ab481fa32fe}{es\_task\_is\_stolen}};}
\DoxyCodeLine{01240\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}};}
\DoxyCodeLine{01241\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01242\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ have\ exclusive\ access\ to\ the\ proxy,\ and\ can\ destroy\ it.}}
\DoxyCodeLine{01243\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a12dd37171af77214add72a973e6b71ba}{free\_task<no\_cache\_small\_task>}}(*tp);}
\DoxyCodeLine{01244\ \ \ \ \ \}}
\DoxyCodeLine{01245\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01246\ \}}
\DoxyCodeLine{01247\ }
\DoxyCodeLine{01248\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_af222cccbf09e91c9c9caaad81f8d993d}{generic\_scheduler::publish\_task\_pool}}()\ \{}
\DoxyCodeLine{01249\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}\ (\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}},\ \textcolor{stringliteral}{"{}no\ arena:\ initialization\ not\ completed?"{}}\ );}
\DoxyCodeLine{01250\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}\ (\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a35aa72cfdda3b500e908925a3d6da747}{my\_arena\_index\ <\ my\_arena-\/>}}my\_num\_slots,\ \textcolor{stringliteral}{"{}arena\ slot\ index\ is\ out-\/of-\/bound"{}}\ );}
\DoxyCodeLine{01251\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}\ (\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}\ ==\ \&\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>my\_slots[\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a35aa72cfdda3b500e908925a3d6da747}{my\_arena\_index}}],\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{01252\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}\ (\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\ ==\ \mbox{\hyperlink{scheduler_8h_a6f1c5fa8b2e50a1a91282165c7a9dae2}{EmptyTaskPool}},\ \textcolor{stringliteral}{"{}someone\ else\ grabbed\ my\ arena\ slot?"{}}\ );}
\DoxyCodeLine{01253\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}\ (\ \_\_TBB\_load\_relaxed(\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>head)\ <\ \_\_TBB\_load\_relaxed(\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>tail),}
\DoxyCodeLine{01254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}entering\ arena\ without\ tasks\ to\ share"{}}\ );}
\DoxyCodeLine{01255\ \ \ \ \ \textcolor{comment}{//\ Release\ signal\ on\ behalf\ of\ previously\ spawned\ tasks\ (when\ this\ thread\ was\ not\ in\ arena\ yet)}}
\DoxyCodeLine{01256\ \ \ \ \ \mbox{\hyperlink{itt__notify_8h_adf75d9635323cc786c012fe69ceef418}{ITT\_NOTIFY}}(\mbox{\hyperlink{ittnotify__static_8h_ac5a347b47a5603a1f30f6fbf790724b7}{sync\_releasing}},\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}});}
\DoxyCodeLine{01257\ \ \ \ \ \_\_TBB\_store\_with\_release(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool,\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\_ptr\ );}
\DoxyCodeLine{01258\ \}}
\DoxyCodeLine{01259\ }
\DoxyCodeLine{01260\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_aad4a3aef975ca2516a81640654a65717}{generic\_scheduler::leave\_task\_pool}}()\ \{}
\DoxyCodeLine{01261\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1f221aa79878e3962ea2b3eaa7429fe1}{is\_task\_pool\_published}}(),\ \textcolor{stringliteral}{"{}Not\ in\ arena"{}}\ );}
\DoxyCodeLine{01262\ \ \ \ \ \textcolor{comment}{//\ Do\ not\ reset\ my\_arena\_index.\ It\ will\ be\ used\ to\ (attempt\ to)\ re-\/acquire\ the\ slot\ next\ time}}
\DoxyCodeLine{01263\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \&\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>my\_slots[\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a35aa72cfdda3b500e908925a3d6da747}{my\_arena\_index}}]\ ==\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}},\ \textcolor{stringliteral}{"{}arena\ slot\ and\ slot\ index\ mismatch"{}}\ );}
\DoxyCodeLine{01264\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}\ (\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\ ==\ \mbox{\hyperlink{scheduler_8h_a096a309d24c5ac85036e8970880e5efd}{LockedTaskPool}},\ \textcolor{stringliteral}{"{}Task\ pool\ must\ be\ locked\ when\ leaving\ arena"{}}\ );}
\DoxyCodeLine{01265\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a52f9f2d835b4d68680887253a597f779}{is\_quiescent\_local\_task\_pool\_empty}}(),\ \textcolor{stringliteral}{"{}Cannot\ leave\ arena\ when\ the\ task\ pool\ is\ not\ empty"{}}\ );}
\DoxyCodeLine{01266\ \ \ \ \ \mbox{\hyperlink{itt__notify_8h_adf75d9635323cc786c012fe69ceef418}{ITT\_NOTIFY}}(\mbox{\hyperlink{ittnotify__static_8h_ac5a347b47a5603a1f30f6fbf790724b7}{sync\_releasing}},\ \&\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}}-\/>my\_slots[\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a35aa72cfdda3b500e908925a3d6da747}{my\_arena\_index}}]);}
\DoxyCodeLine{01267\ \ \ \ \ \textcolor{comment}{//\ No\ release\ fence\ is\ necessary\ here\ as\ this\ assignment\ precludes\ external}}
\DoxyCodeLine{01268\ \ \ \ \ \textcolor{comment}{//\ accesses\ to\ the\ local\ task\ pool\ when\ becomes\ visible.\ Thus\ it\ is\ harmless}}
\DoxyCodeLine{01269\ \ \ \ \ \textcolor{comment}{//\ if\ it\ gets\ hoisted\ above\ preceding\ local\ bookkeeping\ manipulations.}}
\DoxyCodeLine{01270\ \ \ \ \ \_\_TBB\_store\_relaxed(\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool,\ \mbox{\hyperlink{scheduler_8h_a6f1c5fa8b2e50a1a91282165c7a9dae2}{EmptyTaskPool}}\ );}
\DoxyCodeLine{01271\ \}}
\DoxyCodeLine{01272\ }
\DoxyCodeLine{01273\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a838f6ccf79d7ee8a55843de2f8004759}{generic\_scheduler}}*\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a556929cfad4b9daef4950dfdb6cee485}{generic\_scheduler::create\_worker}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market}{market}}\&\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}},\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}},\ \textcolor{keywordtype}{bool}\ genuine\ )\ \{}
\DoxyCodeLine{01274\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a838f6ccf79d7ee8a55843de2f8004759}{generic\_scheduler}}*\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ =\ \mbox{\hyperlink{namespacetbb_1_1internal_a92d3a8ab5ddffa18bed996f6ae90b614}{allocate\_scheduler}}(\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}},\ genuine\ );}
\DoxyCodeLine{01275\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(!genuine\ ||\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}},\ \textcolor{stringliteral}{"{}workers\ should\ have\ index\ >\ 0"{}});}
\DoxyCodeLine{01276\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>my\_arena\_index\ =\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}};\ \textcolor{comment}{//\ index\ is\ not\ a\ real\ slot\ in\ arena\ yet}}
\DoxyCodeLine{01277\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>my\_dummy\_task-\/>prefix().ref\_count\ =\ 2;}
\DoxyCodeLine{01278\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>my\_properties.type\ =\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__properties_a03ff24546f54200460068dbb28e0374d}{scheduler\_properties::worker}};}
\DoxyCodeLine{01279\ \ \ \ \ \textcolor{comment}{//\ Do\ not\ call\ init\_stack\_info\ before\ the\ scheduler\ is\ set\ as\ master\ or\ worker.}}
\DoxyCodeLine{01280\ \ \ \ \ \textcolor{keywordflow}{if}\ (genuine)}
\DoxyCodeLine{01281\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>init\_stack\_info();}
\DoxyCodeLine{01282\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_ab6b7ba04ea2b541819b659219fc42ae7}{governor::sign\_on}}(\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}});}
\DoxyCodeLine{01283\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}};}
\DoxyCodeLine{01284\ \}}
\DoxyCodeLine{01285\ }
\DoxyCodeLine{01286\ \textcolor{comment}{//\ TODO:\ make\ it\ a\ member\ method}}
\DoxyCodeLine{01287\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a838f6ccf79d7ee8a55843de2f8004759}{generic\_scheduler}}*\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ac7fb04a73dbb75dd8db5c9637bfadeae}{generic\_scheduler::create\_master}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1arena}{arena}}*\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ )\ \{}
\DoxyCodeLine{01288\ \ \ \ \ \textcolor{comment}{//\ add\ an\ internal\ market\ reference;\ the\ public\ reference\ is\ possibly\ added\ in\ create\_arena}}
\DoxyCodeLine{01289\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a838f6ccf79d7ee8a55843de2f8004759}{generic\_scheduler}}*\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ =\ \mbox{\hyperlink{namespacetbb_1_1internal_a92d3a8ab5ddffa18bed996f6ae90b614}{allocate\_scheduler}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1market_a08ccaf89d501a9e56912eb5bd624066f}{market::global\_market}}(\textcolor{comment}{/*is\_public=*/}\textcolor{keyword}{false}),\ \textcolor{comment}{/*\ genuine\ =\ */}\ \textcolor{keyword}{true}\ );}
\DoxyCodeLine{01290\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>my\_arena,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{01291\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>my\_market,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{01292\ \ \ \ \ task\&\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ *\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>my\_dummy\_task;}
\DoxyCodeLine{01293\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>my\_properties.type\ =\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__properties_a8c128998273256972a99230b367a044c}{scheduler\_properties::master}};}
\DoxyCodeLine{01294\ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}.prefix().ref\_count\ =\ 1;}
\DoxyCodeLine{01295\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_GROUP\_CONTEXT}}
\DoxyCodeLine{01296\ \ \ \ \ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}.prefix().context\ =\ \textcolor{keyword}{new}\ (\ \mbox{\hyperlink{namespacetbb_1_1internal_a395611542e21705f49de2a06e2c88f59}{NFS\_Allocate}}(1,\ \textcolor{keyword}{sizeof}(task\_group\_context),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ )}
\DoxyCodeLine{01297\ \ \ \ \ \ \ \ \ \ \ \ \ task\_group\_context(\ task\_group\_context::isolated,\ task\_group\_context::default\_traits\ );}
\DoxyCodeLine{01298\ \textcolor{preprocessor}{\#if\ \_\_TBB\_FP\_CONTEXT}}
\DoxyCodeLine{01299\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>default\_context()-\/>capture\_fp\_settings();}
\DoxyCodeLine{01300\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01301\ \ \ \ \ \textcolor{comment}{//\ Do\ not\ call\ init\_stack\_info\ before\ the\ scheduler\ is\ set\ as\ master\ or\ worker.}}
\DoxyCodeLine{01302\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>init\_stack\_info();}
\DoxyCodeLine{01303\ \ \ \ \ context\_state\_propagation\_mutex\_type::scoped\_lock\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(the\_context\_state\_propagation\_mutex);}
\DoxyCodeLine{01304\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>my\_market-\/>my\_masters.push\_front(\ *\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ );}
\DoxyCodeLine{01305\ \ \ \ \ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}.release();}
\DoxyCodeLine{01306\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_GROUP\_CONTEXT\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{01307\ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ )\ \{}
\DoxyCodeLine{01308\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Master\ thread\ always\ occupies\ the\ first\ slot}}
\DoxyCodeLine{01309\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>attach\_arena(\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}},\ \textcolor{comment}{/*index*/}0,\ \textcolor{comment}{/*is\_master*/}\textcolor{keyword}{true}\ );}
\DoxyCodeLine{01310\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>my\_arena\_slot-\/>my\_scheduler\ =\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}};}
\DoxyCodeLine{01311\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_GROUP\_CONTEXT}}
\DoxyCodeLine{01312\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>my\_default\_ctx\ =\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>default\_context();\ \textcolor{comment}{//\ also\ transfers\ implied\ ownership}}
\DoxyCodeLine{01313\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01314\ \ \ \ \ \}}
\DoxyCodeLine{01315\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>my\_arena\_index\ ==\ 0,\ \textcolor{stringliteral}{"{}Master\ thread\ must\ occupy\ the\ first\ slot\ in\ its\ arena"{}}\ );}
\DoxyCodeLine{01316\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_ab6b7ba04ea2b541819b659219fc42ae7}{governor::sign\_on}}(\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}});}
\DoxyCodeLine{01317\ }
\DoxyCodeLine{01318\ \textcolor{preprocessor}{\#if\ \_WIN32||\_WIN64}}
\DoxyCodeLine{01319\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>my\_market-\/>register\_master(\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>master\_exec\_resource\ );}
\DoxyCodeLine{01320\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_WIN32||\_WIN64\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{01321\ \ \ \ \ \textcolor{comment}{//\ Process\ any\ existing\ observers.}}
\DoxyCodeLine{01322\ \textcolor{preprocessor}{\#if\ \_\_TBB\_ARENA\_OBSERVER}}
\DoxyCodeLine{01323\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ ||\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>my\_observers.empty(),\ \textcolor{stringliteral}{"{}Just\ created\ arena\ cannot\ have\ any\ observers\ associated\ with\ it"{}}\ );}
\DoxyCodeLine{01324\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01325\ \textcolor{preprocessor}{\#if\ \_\_TBB\_SCHEDULER\_OBSERVER}}
\DoxyCodeLine{01326\ \ \ \ \ the\_global\_observer\_list.notify\_entry\_observers(\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}-\/>my\_last\_global\_observer,\ \textcolor{comment}{/*worker=*/}\textcolor{keyword}{false}\ );}
\DoxyCodeLine{01327\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_SCHEDULER\_OBSERVER\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{01328\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}};}
\DoxyCodeLine{01329\ \}}
\DoxyCodeLine{01330\ }
\DoxyCodeLine{01331\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ae6a0b659589202963562cbdb23465807}{generic\_scheduler::cleanup\_worker}}(\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}},\ \textcolor{keywordtype}{bool}\ worker\ )\ \{}
\DoxyCodeLine{01332\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a838f6ccf79d7ee8a55843de2f8004759}{generic\_scheduler}}\&\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ =\ *(\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a838f6ccf79d7ee8a55843de2f8004759}{generic\_scheduler}}*)\mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}};}
\DoxyCodeLine{01333\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}.my\_arena\_slot,\ \textcolor{stringliteral}{"{}cleaning\ up\ attached\ worker"{}}\ );}
\DoxyCodeLine{01334\ \textcolor{preprocessor}{\#if\ \_\_TBB\_SCHEDULER\_OBSERVER}}
\DoxyCodeLine{01335\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ worker\ )\ \textcolor{comment}{//\ can\ be\ called\ by\ master\ for\ worker,\ do\ not\ notify\ master\ twice}}
\DoxyCodeLine{01336\ \ \ \ \ \ \ \ \ the\_global\_observer\_list.notify\_exit\_observers(\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}.my\_last\_global\_observer,\ \textcolor{comment}{/*worker=*/}\textcolor{keyword}{true}\ );}
\DoxyCodeLine{01337\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_SCHEDULER\_OBSERVER\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{01338\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}.cleanup\_scheduler();}
\DoxyCodeLine{01339\ \}}
\DoxyCodeLine{01340\ }
\DoxyCodeLine{01341\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ac223f7892d65e496c37190c4009ea1f7}{generic\_scheduler::cleanup\_master}}(\ \textcolor{keywordtype}{bool}\ blocking\_terminate\ )\ \{}
\DoxyCodeLine{01342\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1arena}{arena}}*\ \textcolor{keyword}{const}\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ =\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6b830853cb0386a2b8744d4c7dff3a80}{my\_arena}};}
\DoxyCodeLine{01343\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1market}{market}}\ *\ \textcolor{keyword}{const}\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}\ =\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ac652e4a610353888a31352e678955e1b}{my\_market}};}
\DoxyCodeLine{01344\ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ac652e4a610353888a31352e678955e1b}{my\_market}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{01345\ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ \&\&\ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1f221aa79878e3962ea2b3eaa7429fe1}{is\_task\_pool\_published}}()\ )\ \{}
\DoxyCodeLine{01346\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ae1cf7dda46c2687a1ea7edacbea10da1}{acquire\_task\_pool}}();}
\DoxyCodeLine{01347\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>task\_pool\ ==\ \mbox{\hyperlink{scheduler_8h_a6f1c5fa8b2e50a1a91282165c7a9dae2}{EmptyTaskPool}}\ ||}
\DoxyCodeLine{01348\ \ \ \ \ \ \ \ \ \ \ \ \ \ \_\_TBB\_load\_relaxed(\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>head)\ >=\ \_\_TBB\_load\_relaxed(\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>tail)\ )}
\DoxyCodeLine{01349\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01350\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Local\ task\ pool\ is\ empty}}
\DoxyCodeLine{01351\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_aad4a3aef975ca2516a81640654a65717}{leave\_task\_pool}}();}
\DoxyCodeLine{01352\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01353\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01354\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Master's\ local\ task\ pool\ may\ e.g.\ contain\ proxies\ of\ affinitized\ tasks.}}
\DoxyCodeLine{01355\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a6ff28eab04933075791b16075ceb5950}{release\_task\_pool}}();}
\DoxyCodeLine{01356\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_a14d4453f34a770b1c983c2ed38570e31}{governor::is\_set}}(\textcolor{keyword}{this}),\ \textcolor{stringliteral}{"{}TLS\ slot\ is\ cleared\ before\ the\ task\ pool\ cleanup"{}}\ );}
\DoxyCodeLine{01357\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Set\ refcount\ to\ make\ the\ following\ dispach\ loop\ infinite\ (it\ is\ interrupted\ by\ the\ cleanup\ logic).}}
\DoxyCodeLine{01358\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_abc495d5b077a2ef1b05e15e820555d90}{my\_dummy\_task}}-\/>set\_ref\_count(2);}
\DoxyCodeLine{01359\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a509997dbb9b97ad2cca0a3af76c04e90}{local\_wait\_for\_all}}(\ *\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_abc495d5b077a2ef1b05e15e820555d90}{my\_dummy\_task}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{01360\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a1f221aa79878e3962ea2b3eaa7429fe1}{is\_task\_pool\_published}}(),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{01361\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}\ (\ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_a14d4453f34a770b1c983c2ed38570e31}{governor::is\_set}}(\textcolor{keyword}{this}),\ \textcolor{stringliteral}{"{}Other\ thread\ reused\ our\ TLS\ key\ during\ the\ task\ pool\ cleanup"{}}\ );}
\DoxyCodeLine{01362\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01363\ \ \ \ \ \}}
\DoxyCodeLine{01364\ \textcolor{preprocessor}{\#if\ \_\_TBB\_ARENA\_OBSERVER}}
\DoxyCodeLine{01365\ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ )}
\DoxyCodeLine{01366\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>my\_observers.notify\_exit\_observers(\ my\_last\_local\_observer,\ \textcolor{comment}{/*worker=*/}\textcolor{keyword}{false}\ );}
\DoxyCodeLine{01367\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01368\ \textcolor{preprocessor}{\#if\ \_\_TBB\_SCHEDULER\_OBSERVER}}
\DoxyCodeLine{01369\ \ \ \ \ the\_global\_observer\_list.notify\_exit\_observers(\ my\_last\_global\_observer,\ \textcolor{comment}{/*worker=*/}\textcolor{keyword}{false}\ );}
\DoxyCodeLine{01370\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_SCHEDULER\_OBSERVER\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{01371\ \textcolor{preprocessor}{\#if\ \_WIN32||\_WIN64}}
\DoxyCodeLine{01372\ \ \ \ \ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>unregister\_master(\ master\_exec\_resource\ );}
\DoxyCodeLine{01373\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_WIN32||\_WIN64\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{01374\ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ )\ \{}
\DoxyCodeLine{01375\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>my\_slots+0\ ==\ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{01376\ \textcolor{preprocessor}{\#if\ \_\_TBB\_STATISTICS}}
\DoxyCodeLine{01377\ \ \ \ \ \ \ \ \ *\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>my\_counters\ +=\ my\_counters;}
\DoxyCodeLine{01378\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_STATISTICS\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{01379\ \ \ \ \ \ \ \ \ \_\_TBB\_store\_with\_release(\mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}-\/>my\_scheduler,\ (\mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a838f6ccf79d7ee8a55843de2f8004759}{generic\_scheduler}}*)\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{01380\ \ \ \ \ \}}
\DoxyCodeLine{01381\ \textcolor{preprocessor}{\#if\ \_\_TBB\_TASK\_GROUP\_CONTEXT}}
\DoxyCodeLine{01382\ \ \ \ \ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ task\_group\_context\ ownership\ was\ not\ transferred\ to\ arena}}
\DoxyCodeLine{01383\ \ \ \ \ \ \ \ \ default\_context()-\/>\string~task\_group\_context();}
\DoxyCodeLine{01384\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_abd3fdd42ea716867fc95116354481b4e}{NFS\_Free}}(default\_context());}
\DoxyCodeLine{01385\ \ \ \ \ \}}
\DoxyCodeLine{01386\ \ \ \ \ context\_state\_propagation\_mutex\_type::scoped\_lock\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(the\_context\_state\_propagation\_mutex);}
\DoxyCodeLine{01387\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_ac652e4a610353888a31352e678955e1b}{my\_market}}-\/>my\_masters.remove(\ *\textcolor{keyword}{this}\ );}
\DoxyCodeLine{01388\ \ \ \ \ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}.release();}
\DoxyCodeLine{01389\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_TASK\_GROUP\_CONTEXT\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{01390\ \ \ \ \ \mbox{\hyperlink{structtbb_1_1internal_1_1scheduler__state_a6f2fdcecd347bf767e89fda580545c1a}{my\_arena\_slot}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};\ \textcolor{comment}{//\ detached\ from\ slot}}
\DoxyCodeLine{01391\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1generic__scheduler_a9ad40233836bbb816156a5dacf206089}{cleanup\_scheduler}}();\ \textcolor{comment}{//\ do\ not\ use\ scheduler\ state\ after\ this\ point}}
\DoxyCodeLine{01392\ }
\DoxyCodeLine{01393\ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ )}
\DoxyCodeLine{01394\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>on\_thread\_leaving<\mbox{\hyperlink{classtbb_1_1internal_1_1arena_a0b9c64f0781f7c6337bc109d9867829a}{arena::ref\_external}}>();}
\DoxyCodeLine{01395\ \ \ \ \ \textcolor{comment}{//\ If\ there\ was\ an\ associated\ arena,\ it\ added\ a\ public\ market\ reference}}
\DoxyCodeLine{01396\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}-\/>release(\ \textcolor{comment}{/*is\_public*/}\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ blocking\_terminate\ );}
\DoxyCodeLine{01397\ \}}
\DoxyCodeLine{01398\ }
\DoxyCodeLine{01399\ \}\ \textcolor{comment}{//\ namespace\ internal}}
\DoxyCodeLine{01400\ \}\ \textcolor{comment}{//\ namespace\ tbb}}
\DoxyCodeLine{01401\ }
\DoxyCodeLine{01402\ \textcolor{comment}{/*}}
\DoxyCodeLine{01403\ \textcolor{comment}{\ \ \ \ Comments:}}
\DoxyCodeLine{01404\ \textcolor{comment}{}}
\DoxyCodeLine{01405\ \textcolor{comment}{1.\ \ The\ premise\ of\ the\ cancellation\ support\ implementation\ is\ that\ cancellations\ are}}
\DoxyCodeLine{01406\ \textcolor{comment}{\ \ \ \ not\ part\ of\ the\ hot\ path\ of\ the\ program\ execution.\ Therefore\ all\ changes\ in\ its}}
\DoxyCodeLine{01407\ \textcolor{comment}{\ \ \ \ implementation\ in\ order\ to\ reduce\ the\ overhead\ of\ the\ cancellation\ control\ flow}}
\DoxyCodeLine{01408\ \textcolor{comment}{\ \ \ \ should\ be\ done\ only\ in\ ways\ that\ do\ not\ increase\ overhead\ of\ the\ normal\ execution.}}
\DoxyCodeLine{01409\ \textcolor{comment}{}}
\DoxyCodeLine{01410\ \textcolor{comment}{\ \ \ \ In\ general\ contexts\ are\ used\ by\ all\ threads\ and\ their\ descendants\ are\ created\ in}}
\DoxyCodeLine{01411\ \textcolor{comment}{\ \ \ \ different\ threads\ as\ well.\ In\ order\ to\ minimize\ impact\ of\ the\ cross-\/thread\ tree}}
\DoxyCodeLine{01412\ \textcolor{comment}{\ \ \ \ maintenance\ (first\ of\ all\ because\ of\ the\ synchronization),\ the\ tree\ of\ contexts}}
\DoxyCodeLine{01413\ \textcolor{comment}{\ \ \ \ is\ split\ into\ pieces,\ each\ of\ which\ is\ handled\ by\ the\ only\ thread.\ Such\ pieces}}
\DoxyCodeLine{01414\ \textcolor{comment}{\ \ \ \ are\ represented\ as\ lists\ of\ contexts,\ members\ of\ which\ are\ contexts\ that\ were}}
\DoxyCodeLine{01415\ \textcolor{comment}{\ \ \ \ bound\ to\ their\ parents\ in\ the\ given\ thread.}}
\DoxyCodeLine{01416\ \textcolor{comment}{}}
\DoxyCodeLine{01417\ \textcolor{comment}{\ \ \ \ The\ context\ tree\ maintenance\ and\ cancellation\ propagation\ algorithms\ is\ designed}}
\DoxyCodeLine{01418\ \textcolor{comment}{\ \ \ \ in\ such\ a\ manner\ that\ cross-\/thread\ access\ to\ a\ context\ list\ will\ take\ place\ only}}
\DoxyCodeLine{01419\ \textcolor{comment}{\ \ \ \ when\ cancellation\ signal\ is\ sent\ (by\ user\ or\ when\ an\ exception\ happens),\ and}}
\DoxyCodeLine{01420\ \textcolor{comment}{\ \ \ \ synchronization\ is\ necessary\ only\ then.\ Thus\ the\ normal\ execution\ flow\ (without}}
\DoxyCodeLine{01421\ \textcolor{comment}{\ \ \ \ exceptions\ and\ cancellation)\ remains\ free\ from\ any\ synchronization\ done\ on}}
\DoxyCodeLine{01422\ \textcolor{comment}{\ \ \ \ behalf\ of\ exception\ handling\ and\ cancellation\ support.}}
\DoxyCodeLine{01423\ \textcolor{comment}{}}
\DoxyCodeLine{01424\ \textcolor{comment}{2.\ \ Consider\ parallel\ cancellations\ at\ the\ different\ levels\ of\ the\ context\ tree:}}
\DoxyCodeLine{01425\ \textcolor{comment}{}}
\DoxyCodeLine{01426\ \textcolor{comment}{\ \ \ \ \ \ \ \ Ctx1\ <-\/\ Cancelled\ by\ Thread1\ \ \ \ \ \ \ \ \ \ \ \ |-\/\ Thread2\ started\ processing}}
\DoxyCodeLine{01427\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{01428\ \textcolor{comment}{\ \ \ \ \ \ \ \ Ctx2\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |-\/\ Thread1\ started\ processing}}
\DoxyCodeLine{01429\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ T1\ |-\/\ Thread2\ finishes\ and\ syncs\ up\ local\ counters}}
\DoxyCodeLine{01430\ \textcolor{comment}{\ \ \ \ \ \ \ \ Ctx3\ <-\/\ Cancelled\ by\ Thread2\ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{01431\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |-\/\ Ctx5\ is\ bound\ to\ Ctx2}}
\DoxyCodeLine{01432\ \textcolor{comment}{\ \ \ \ \ \ \ \ Ctx4\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{01433\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ T2\ |-\/\ Thread1\ reaches\ Ctx2}}
\DoxyCodeLine{01434\ \textcolor{comment}{}}
\DoxyCodeLine{01435\ \textcolor{comment}{\ \ \ \ Thread-\/propagator\ of\ each\ cancellation\ increments\ global\ counter.\ However\ the\ thread}}
\DoxyCodeLine{01436\ \textcolor{comment}{\ \ \ \ propagating\ the\ cancellation\ from\ the\ outermost\ context\ (Thread1)\ may\ be\ the\ last}}
\DoxyCodeLine{01437\ \textcolor{comment}{\ \ \ \ to\ finish.\ Which\ means\ that\ the\ local\ counters\ may\ be\ synchronized\ earlier\ (by\ Thread2,}}
\DoxyCodeLine{01438\ \textcolor{comment}{\ \ \ \ at\ Time1)\ than\ it\ propagated\ cancellation\ into\ Ctx2\ (at\ time\ Time2).\ If\ a\ new\ context}}
\DoxyCodeLine{01439\ \textcolor{comment}{\ \ \ \ (Ctx5)\ is\ created\ and\ bound\ to\ Ctx2\ between\ Time1\ and\ Time2,\ checking\ its\ parent\ only}}
\DoxyCodeLine{01440\ \textcolor{comment}{\ \ \ \ (Ctx2)\ may\ result\ in\ cancellation\ request\ being\ lost.}}
\DoxyCodeLine{01441\ \textcolor{comment}{}}
\DoxyCodeLine{01442\ \textcolor{comment}{\ \ \ \ This\ issue\ is\ solved\ by\ doing\ the\ whole\ propagation\ under\ the\ lock.}}
\DoxyCodeLine{01443\ \textcolor{comment}{}}
\DoxyCodeLine{01444\ \textcolor{comment}{\ \ \ \ If\ we\ need\ more\ concurrency\ while\ processing\ parallel\ cancellations,\ we\ could\ try}}
\DoxyCodeLine{01445\ \textcolor{comment}{\ \ \ \ the\ following\ modification\ of\ the\ propagation\ algorithm:}}
\DoxyCodeLine{01446\ \textcolor{comment}{}}
\DoxyCodeLine{01447\ \textcolor{comment}{\ \ \ \ advance\ global\ counter\ and\ remember\ it}}
\DoxyCodeLine{01448\ \textcolor{comment}{\ \ \ \ for\ each\ thread:}}
\DoxyCodeLine{01449\ \textcolor{comment}{\ \ \ \ \ \ \ \ scan\ thread's\ list\ of\ contexts}}
\DoxyCodeLine{01450\ \textcolor{comment}{\ \ \ \ for\ each\ thread:}}
\DoxyCodeLine{01451\ \textcolor{comment}{\ \ \ \ \ \ \ \ sync\ up\ its\ local\ counter\ only\ if\ the\ global\ counter\ has\ not\ been\ changed}}
\DoxyCodeLine{01452\ \textcolor{comment}{}}
\DoxyCodeLine{01453\ \textcolor{comment}{\ \ \ \ However\ this\ version\ of\ the\ algorithm\ requires\ more\ analysis\ and\ verification.}}
\DoxyCodeLine{01454\ \textcolor{comment}{}}
\DoxyCodeLine{01455\ \textcolor{comment}{3.\ \ There\ is\ no\ portable\ way\ to\ get\ stack\ base\ address\ in\ Posix,\ however\ the\ modern}}
\DoxyCodeLine{01456\ \textcolor{comment}{\ \ \ \ Linux\ versions\ provide\ pthread\_attr\_np\ API\ that\ can\ be\ used\ \ to\ obtain\ thread's}}
\DoxyCodeLine{01457\ \textcolor{comment}{\ \ \ \ stack\ size\ and\ base\ address.\ Unfortunately\ even\ this\ function\ does\ not\ provide}}
\DoxyCodeLine{01458\ \textcolor{comment}{\ \ \ \ enough\ information\ for\ the\ main\ thread\ on\ IA-\/64\ architecture\ (RSE\ spill\ area}}
\DoxyCodeLine{01459\ \textcolor{comment}{\ \ \ \ and\ memory\ stack\ are\ allocated\ as\ two\ separate\ discontinuous\ chunks\ of\ memory),}}
\DoxyCodeLine{01460\ \textcolor{comment}{\ \ \ \ and\ there\ is\ no\ portable\ way\ to\ discern\ the\ main\ and\ the\ secondary\ threads.}}
\DoxyCodeLine{01461\ \textcolor{comment}{\ \ \ \ Thus\ for\ macOS*\ and\ IA-\/64\ architecture\ for\ Linux*\ OS\ we\ use\ the\ TBB\ worker\ stack\ size\ for}}
\DoxyCodeLine{01462\ \textcolor{comment}{\ \ \ \ all\ threads\ and\ use\ the\ current\ stack\ top\ as\ the\ stack\ base.\ This\ simplified}}
\DoxyCodeLine{01463\ \textcolor{comment}{\ \ \ \ approach\ is\ based\ on\ the\ following\ assumptions:}}
\DoxyCodeLine{01464\ \textcolor{comment}{\ \ \ \ 1)\ If\ the\ default\ stack\ size\ is\ insufficient\ for\ the\ user\ app\ needs,\ the}}
\DoxyCodeLine{01465\ \textcolor{comment}{\ \ \ \ required\ amount\ will\ be\ explicitly\ specified\ by\ the\ user\ at\ the\ point\ of\ the}}
\DoxyCodeLine{01466\ \textcolor{comment}{\ \ \ \ TBB\ scheduler\ initialization\ (as\ an\ argument\ to\ tbb::task\_scheduler\_init}}
\DoxyCodeLine{01467\ \textcolor{comment}{\ \ \ \ constructor).}}
\DoxyCodeLine{01468\ \textcolor{comment}{\ \ \ \ 2)\ When\ a\ master\ thread\ initializes\ the\ scheduler,\ it\ has\ enough\ space\ on\ its}}
\DoxyCodeLine{01469\ \textcolor{comment}{\ \ \ \ stack.\ Here\ "{}enough"{}\ means\ "{}at\ least\ as\ much\ as\ worker\ threads\ have"{}.}}
\DoxyCodeLine{01470\ \textcolor{comment}{\ \ \ \ 3)\ If\ the\ user\ app\ strives\ to\ conserve\ the\ memory\ by\ cutting\ stack\ size,\ it}}
\DoxyCodeLine{01471\ \textcolor{comment}{\ \ \ \ should\ do\ this\ for\ TBB\ workers\ too\ (as\ in\ the\ \#1).}}
\DoxyCodeLine{01472\ \textcolor{comment}{*/}}

\end{DoxyCode}
