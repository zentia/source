\doxysection{tsq.\+hpp}
\hypertarget{tsq_8hpp_source}{}\label{tsq_8hpp_source}\index{external/taskflow/taskflow/core/tsq.hpp@{external/taskflow/taskflow/core/tsq.hpp}}
\mbox{\hyperlink{tsq_8hpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{macros_8hpp}{../utility/macros.hpp}}"{}}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{taskflow_2utility_2traits_8hpp}{../utility/traits.hpp}}"{}}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#ifndef\ TF\_DEFAULT\_BOUNDED\_TASK\_QUEUE\_LOG\_SIZE\ }\textcolor{preprocessor}{}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\ \ \#define\ TF\_DEFAULT\_BOUNDED\_TASK\_QUEUE\_LOG\_SIZE\ 8}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#ifndef\ TF\_DEFAULT\_UNBOUNDED\_TASK\_QUEUE\_LOG\_SIZE\ }\textcolor{preprocessor}{}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\ \ \#define\ TF\_DEFAULT\_UNBOUNDED\_TASK\_QUEUE\_LOG\_SIZE\ 10}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetf}{tf}}\ \{}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00034\ \textcolor{comment}{//\ Task\ Queue}}
\DoxyCodeLine{00035\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00052\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00053\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtf_1_1_unbounded_task_queue_accc811a0a5d692a3cda366378367d7b6}{UnboundedTaskQueue}}\ \{}
\DoxyCodeLine{00054\ \ \ }
\DoxyCodeLine{00055\ \ \ \textcolor{keyword}{static\_assert}(std::is\_pointer\_v<T>,\ \textcolor{stringliteral}{"{}T\ must\ be\ a\ pointer\ type"{}});}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a6d928f82f712a68167a9bcc0b9a92302}{Array}}\ \{}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a4aa0afbaf4c1bc0755b6da3ea6df3914}{C}};}
\DoxyCodeLine{00060\ \ \ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a0b1b87427355534a661de7061042dc20}{M}};}
\DoxyCodeLine{00061\ \ \ \ \ std::atomic<T>*\ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a1e6b66b7175c0efadeaf586b6d8ddf1e}{S}};}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a6d928f82f712a68167a9bcc0b9a92302}{Array}}(\mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{bench_vec_add_8cpp_a41689956983587b085f9da3e48f31d99}{c}})\ :}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a4aa0afbaf4c1bc0755b6da3ea6df3914}{C}}\ \{\mbox{\hyperlink{bench_vec_add_8cpp_a41689956983587b085f9da3e48f31d99}{c}}\},}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a0b1b87427355534a661de7061042dc20}{M}}\ \{\mbox{\hyperlink{bench_vec_add_8cpp_a41689956983587b085f9da3e48f31d99}{c}}-\/1\},}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a1e6b66b7175c0efadeaf586b6d8ddf1e}{S}}\ \{new\ \mbox{\hyperlink{namespacestd}{std}}::\mbox{\hyperlink{sugar_8h_a48f1c51623545bd4f58fbab2fa6091d0}{atomic}}<\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}>[static\_cast<size\_t>(\mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a4aa0afbaf4c1bc0755b6da3ea6df3914}{C}})]\}\ \{}
\DoxyCodeLine{00067\ \ \ \ \ \}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a972575b02a5806c6cf1d521282cdceec}{\string~Array}}()\ \{}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \textcolor{keyword}{delete}\ []\ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a1e6b66b7175c0efadeaf586b6d8ddf1e}{S}};}
\DoxyCodeLine{00071\ \ \ \ \ \}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_abdba46e97c74434105d40b9d5d239049}{capacity}}()\ const\ noexcept\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a4aa0afbaf4c1bc0755b6da3ea6df3914}{C}};}
\DoxyCodeLine{00075\ \ \ \ \ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a4d703ed34e1b6ab4a23c4ccfa04028f7}{push}}(\mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}},\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ o)\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a1e6b66b7175c0efadeaf586b6d8ddf1e}{S}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ \&\ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a0b1b87427355534a661de7061042dc20}{M}}].store(o,\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00079\ \ \ \ \ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a72665ccf0d39de3dd5c75d856a5ea68a}{pop}}(\mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a1e6b66b7175c0efadeaf586b6d8ddf1e}{S}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ \&\ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a0b1b87427355534a661de7061042dc20}{M}}].load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00083\ \ \ \ \ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a6d928f82f712a68167a9bcc0b9a92302}{Array}}*\ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_af31638a12ec124ae453313d149f9e6e5}{resize}}(\mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}},\ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}})\ \{}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a6d928f82f712a68167a9bcc0b9a92302}{Array}}*\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a6d928f82f712a68167a9bcc0b9a92302}{Array}}\ \{2*\mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array_a4aa0afbaf4c1bc0755b6da3ea6df3914}{C}}\};}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}};\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}!=\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}};\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}-\/>push(\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}},\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a169eee6096445fe32ae0e34cae629c38}{pop}}(\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}));}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}};}
\DoxyCodeLine{00091\ \ \ \ \ \}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \};}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \textcolor{comment}{//\ Doubling\ the\ alignment\ by\ 2\ seems\ to\ generate\ the\ most}}
\DoxyCodeLine{00096\ \ \ \textcolor{comment}{//\ decent\ performance.}}
\DoxyCodeLine{00097\ \ \ \textcolor{keyword}{alignas}(2*\mbox{\hyperlink{os_8hpp_a2f7ab3bdbd7b17f081cbb69422b3bf0b}{TF\_CACHELINE\_SIZE}})\ std::atomic<int64\_t>\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a7d91028a58dff5e905d58aeacdbe17ef}{\_top}};}
\DoxyCodeLine{00098\ \ \ \textcolor{keyword}{alignas}(2*\mbox{\hyperlink{os_8hpp_a2f7ab3bdbd7b17f081cbb69422b3bf0b}{TF\_CACHELINE\_SIZE}})\ std::atomic<int64\_t>\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_ac5998bba9d23eafbf9d98efed82af5e0}{\_bottom}};}
\DoxyCodeLine{00099\ \ \ std::atomic<Array*>\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a0d29082bff41b8c94e9de565d3c4c970}{\_array}};}
\DoxyCodeLine{00100\ \ \ std::vector<Array*>\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a35bad5d9923949883d9c1a22aa89690f}{\_garbage}};}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00109\ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_accc811a0a5d692a3cda366378367d7b6}{UnboundedTaskQueue}}(\mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ LogSize\ =\ \mbox{\hyperlink{tsq_8hpp_a45e25b85f72dd5c43f2c9010205c3e37}{TF\_DEFAULT\_UNBOUNDED\_TASK\_QUEUE\_LOG\_SIZE}});}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00114\ \ \ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a72babe096da4ffc72a68b9ff76134e95}{\string~UnboundedTaskQueue}}();}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00119\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a625c75d38982b8eb5d6e6d6f2aa49dec}{empty}}()\ const\ noexcept;}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00124\ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_aa701e0781b063a889ee77f71d3b68d3d}{size}}()\ const\ noexcept;}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00129\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a54eb8fe122dd783c486c683e7c50c5e5}{capacity}}()\ const\ noexcept;}
\DoxyCodeLine{00130\ \ \ }
\DoxyCodeLine{00140\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a3d077fbe105a2712c1b22696edfbf061}{push}}(\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ item);}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00148\ \ \ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a169eee6096445fe32ae0e34cae629c38}{pop}}();}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00156\ \ \ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a038400d9c48a421d3e27379cf319e2ff}{steal}}();}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00169\ \ \ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a1e73bc73447fa1d60b0957348c987d38}{steal\_with\_hint}}(\textcolor{keywordtype}{size\_t}\&\ num\_empty\_steals);}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \mbox{\hyperlink{rml__server_8cpp_a6a1d6e1a12975a4e9a0b5b952e79eaad}{private}}:}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ Array*\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a7925cbfb4473f5bd4b2dcf52da4985f7}{resize\_array}}(Array*\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}},\ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}},\ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}});}
\DoxyCodeLine{00174\ \};}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \textcolor{comment}{//\ Constructor}}
\DoxyCodeLine{00177\ template\ <typename\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}>}
\DoxyCodeLine{00178\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_accc811a0a5d692a3cda366378367d7b6}{UnboundedTaskQueue}}<\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}>::\mbox{\hyperlink{classtf_1_1_unbounded_task_queue_accc811a0a5d692a3cda366378367d7b6}{UnboundedTaskQueue}}(\mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ LogSize)\ \{}
\DoxyCodeLine{00179\ \ \ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a7d91028a58dff5e905d58aeacdbe17ef}{\_top}}.store(0,\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00180\ \ \ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_ac5998bba9d23eafbf9d98efed82af5e0}{\_bottom}}.store(0,\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00181\ \ \ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a0d29082bff41b8c94e9de565d3c4c970}{\_array}}.store(\textcolor{keyword}{new}\ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array}{Array}}\{(\mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\{1\}\ <<\ LogSize)\},\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00182\ \ \ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a35bad5d9923949883d9c1a22aa89690f}{\_garbage}}.reserve(32);}
\DoxyCodeLine{00183\ \}}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \textcolor{comment}{//\ Destructor}}
\DoxyCodeLine{00186\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00187\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a72babe096da4ffc72a68b9ff76134e95}{UnboundedTaskQueue<T>::\string~UnboundedTaskQueue}}()\ \{}
\DoxyCodeLine{00188\ \ \ \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ :\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a35bad5d9923949883d9c1a22aa89690f}{\_garbage}})\ \{}
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{keyword}{delete}\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}};}
\DoxyCodeLine{00190\ \ \ \}}
\DoxyCodeLine{00191\ \ \ \textcolor{keyword}{delete}\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a0d29082bff41b8c94e9de565d3c4c970}{\_array}}.load();}
\DoxyCodeLine{00192\ \}}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \textcolor{comment}{//\ Function:\ empty}}
\DoxyCodeLine{00195\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00196\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a625c75d38982b8eb5d6e6d6f2aa49dec}{UnboundedTaskQueue<T>::empty}}()\ const\ noexcept\ \{}
\DoxyCodeLine{00197\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ =\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_ac5998bba9d23eafbf9d98efed82af5e0}{\_bottom}}.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00198\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a7d91028a58dff5e905d58aeacdbe17ef}{\_top}}.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00199\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ <=\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}});}
\DoxyCodeLine{00200\ \}}
\DoxyCodeLine{00201\ }
\DoxyCodeLine{00202\ \textcolor{comment}{//\ Function:\ size}}
\DoxyCodeLine{00203\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00204\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_aa701e0781b063a889ee77f71d3b68d3d}{UnboundedTaskQueue<T>::size}}()\ const\ noexcept\ \{}
\DoxyCodeLine{00205\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ =\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_ac5998bba9d23eafbf9d98efed82af5e0}{\_bottom}}.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00206\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a7d91028a58dff5e905d58aeacdbe17ef}{\_top}}.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00207\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ >=\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ ?\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ -\/\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ :\ 0);}
\DoxyCodeLine{00208\ \}}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \textcolor{comment}{//\ Function:\ push}}
\DoxyCodeLine{00211\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00212\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a3d077fbe105a2712c1b22696edfbf061}{UnboundedTaskQueue<T>::push}}(\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ o)\ \{}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ =\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_ac5998bba9d23eafbf9d98efed82af5e0}{\_bottom}}.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00215\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a7d91028a58dff5e905d58aeacdbe17ef}{\_top}}.load(std::memory\_order\_acquire);}
\DoxyCodeLine{00216\ \ \ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array}{Array}}*\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ =\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a0d29082bff41b8c94e9de565d3c4c970}{\_array}}.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \ \ \textcolor{comment}{//\ queue\ is\ full\ with\ one\ additional\ item\ (b-\/t+1)}}
\DoxyCodeLine{00219\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{macros_8hpp_a4feec43418b365f045f440667d66cec1}{TF\_UNLIKELY}}(\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>capacity()\ -\/\ 1\ <\ (\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ -\/\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}))\ \{}
\DoxyCodeLine{00220\ \ \ \ \ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ =\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a7925cbfb4473f5bd4b2dcf52da4985f7}{resize\_array}}(\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}},\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}},\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}});}
\DoxyCodeLine{00221\ \ \ \}}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ \ \ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>push(\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}},\ o);}
\DoxyCodeLine{00224\ \ \ std::atomic\_thread\_fence(std::memory\_order\_release);}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \ \ \textcolor{comment}{//\ original\ paper\ uses\ relaxed\ here\ but\ tsa\ complains}}
\DoxyCodeLine{00227\ \ \ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_ac5998bba9d23eafbf9d98efed82af5e0}{\_bottom}}.store(\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ +\ 1,\ std::memory\_order\_release);}
\DoxyCodeLine{00228\ \}}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \textcolor{comment}{//\ Function:\ pop}}
\DoxyCodeLine{00231\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00232\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a169eee6096445fe32ae0e34cae629c38}{UnboundedTaskQueue<T>::pop}}()\ \{}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ =\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_ac5998bba9d23eafbf9d98efed82af5e0}{\_bottom}}.load(std::memory\_order\_relaxed)\ -\/\ 1;}
\DoxyCodeLine{00235\ \ \ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array}{Array}}*\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ =\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a0d29082bff41b8c94e9de565d3c4c970}{\_array}}.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00236\ \ \ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_ac5998bba9d23eafbf9d98efed82af5e0}{\_bottom}}.store(\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}},\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00237\ \ \ std::atomic\_thread\_fence(std::memory\_order\_seq\_cst);}
\DoxyCodeLine{00238\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a7d91028a58dff5e905d58aeacdbe17ef}{\_top}}.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ \ \ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ item\ \{\textcolor{keyword}{nullptr}\};}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ <=\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})\ \{}
\DoxyCodeLine{00243\ \ \ \ \ item\ =\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>pop(\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}});}
\DoxyCodeLine{00244\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ ==\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})\ \{}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \textcolor{comment}{//\ the\ last\ item\ just\ got\ stolen}}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!\mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a7d91028a58dff5e905d58aeacdbe17ef}{\_top}}.compare\_exchange\_strong(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}},\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}+1,}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_seq\_cst,}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_relaxed))\ \{}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ item\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_ac5998bba9d23eafbf9d98efed82af5e0}{\_bottom}}.store(\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ +\ 1,\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00252\ \ \ \ \ \}}
\DoxyCodeLine{00253\ \ \ \}}
\DoxyCodeLine{00254\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00255\ \ \ \ \ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_ac5998bba9d23eafbf9d98efed82af5e0}{\_bottom}}.store(\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ +\ 1,\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00256\ \ \ \}}
\DoxyCodeLine{00257\ }
\DoxyCodeLine{00258\ \ \ \textcolor{keywordflow}{return}\ item;}
\DoxyCodeLine{00259\ \}}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \textcolor{comment}{//\ Function:\ steal}}
\DoxyCodeLine{00262\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00263\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a038400d9c48a421d3e27379cf319e2ff}{UnboundedTaskQueue<T>::steal}}()\ \{}
\DoxyCodeLine{00264\ \ \ }
\DoxyCodeLine{00265\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a7d91028a58dff5e905d58aeacdbe17ef}{\_top}}.load(std::memory\_order\_acquire);}
\DoxyCodeLine{00266\ \ \ std::atomic\_thread\_fence(std::memory\_order\_seq\_cst);}
\DoxyCodeLine{00267\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ =\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_ac5998bba9d23eafbf9d98efed82af5e0}{\_bottom}}.load(std::memory\_order\_acquire);}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \ \ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ item\ \{\textcolor{keyword}{nullptr}\};}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ <\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})\ \{}
\DoxyCodeLine{00272\ \ \ \ \ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array}{Array}}*\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ =\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a0d29082bff41b8c94e9de565d3c4c970}{\_array}}.load(std::memory\_order\_consume);}
\DoxyCodeLine{00273\ \ \ \ \ item\ =\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>pop(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}});}
\DoxyCodeLine{00274\ \ \ \ \ \textcolor{keywordflow}{if}(!\mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a7d91028a58dff5e905d58aeacdbe17ef}{\_top}}.compare\_exchange\_strong(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}},\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}+1,}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_seq\_cst,}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_relaxed))\ \{}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00278\ \ \ \ \ \}}
\DoxyCodeLine{00279\ \ \ \}}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \textcolor{keywordflow}{return}\ item;}
\DoxyCodeLine{00282\ \}}
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00284\ \textcolor{comment}{//\ Function:\ steal}}
\DoxyCodeLine{00285\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00286\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a1e73bc73447fa1d60b0957348c987d38}{UnboundedTaskQueue<T>::steal\_with\_hint}}(\textcolor{keywordtype}{size\_t}\&\ num\_empty\_steals)\ \{}
\DoxyCodeLine{00287\ \ \ }
\DoxyCodeLine{00288\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a7d91028a58dff5e905d58aeacdbe17ef}{\_top}}.load(std::memory\_order\_acquire);}
\DoxyCodeLine{00289\ \ \ std::atomic\_thread\_fence(std::memory\_order\_seq\_cst);}
\DoxyCodeLine{00290\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ =\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_ac5998bba9d23eafbf9d98efed82af5e0}{\_bottom}}.load(std::memory\_order\_acquire);}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \ \ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ item\ \{\textcolor{keyword}{nullptr}\};}
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00294\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ <\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})\ \{}
\DoxyCodeLine{00295\ \ \ \ \ num\_empty\_steals\ =\ 0;}
\DoxyCodeLine{00296\ \ \ \ \ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array}{Array}}*\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}\ =\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a0d29082bff41b8c94e9de565d3c4c970}{\_array}}.load(std::memory\_order\_consume);}
\DoxyCodeLine{00297\ \ \ \ \ item\ =\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>pop(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}});}
\DoxyCodeLine{00298\ \ \ \ \ \textcolor{keywordflow}{if}(!\mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a7d91028a58dff5e905d58aeacdbe17ef}{\_top}}.compare\_exchange\_strong(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}},\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}+1,}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_seq\_cst,}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_relaxed))\ \{}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00302\ \ \ \ \ \}}
\DoxyCodeLine{00303\ \ \ \}}
\DoxyCodeLine{00304\ \ \ ++num\_empty\_steals;}
\DoxyCodeLine{00305\ \ \ \textcolor{keywordflow}{return}\ item;}
\DoxyCodeLine{00306\ \}}
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00308\ \textcolor{comment}{//\ Function:\ capacity}}
\DoxyCodeLine{00309\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00310\ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a54eb8fe122dd783c486c683e7c50c5e5}{UnboundedTaskQueue<T>::capacity}}()\ const\ noexcept\ \{}
\DoxyCodeLine{00311\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a0d29082bff41b8c94e9de565d3c4c970}{\_array}}.load(std::memory\_order\_relaxed)-\/>capacity();}
\DoxyCodeLine{00312\ \}}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00315\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array}{UnboundedTaskQueue<T>::Array}}*}
\DoxyCodeLine{00316\ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a7925cbfb4473f5bd4b2dcf52da4985f7}{UnboundedTaskQueue<T>::resize\_array}}(\mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array}{Array}}*\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}},\ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}},\ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}})\ \{}
\DoxyCodeLine{00317\ }
\DoxyCodeLine{00318\ \ \ \textcolor{comment}{//Array*\ tmp\ =\ a-\/>resize(b,\ t);}}
\DoxyCodeLine{00319\ \ \ \textcolor{comment}{//\_garbage.push\_back(a);}}
\DoxyCodeLine{00320\ \ \ \textcolor{comment}{//std::swap(a,\ tmp);}}
\DoxyCodeLine{00321\ \ \ \textcolor{comment}{//\_array.store(a,\ std::memory\_order\_release);}}
\DoxyCodeLine{00324\ \ \ \textcolor{comment}{//return\ a;}}
\DoxyCodeLine{00325\ \ \ }
\DoxyCodeLine{00326\ }
\DoxyCodeLine{00327\ \ \ \mbox{\hyperlink{structtf_1_1_unbounded_task_queue_1_1_array}{Array}}*\ tmp\ =\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}}-\/>resize(\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}},\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}});}
\DoxyCodeLine{00328\ \ \ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a35bad5d9923949883d9c1a22aa89690f}{\_garbage}}.push\_back(\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}});}
\DoxyCodeLine{00329\ \ \ \mbox{\hyperlink{classtf_1_1_unbounded_task_queue_a0d29082bff41b8c94e9de565d3c4c970}{\_array}}.store(tmp,\ std::memory\_order\_release);}
\DoxyCodeLine{00330\ \ \ \textcolor{comment}{//\ Note:\ the\ original\ paper\ using\ relaxed\ causes\ t-\/san\ to\ complain}}
\DoxyCodeLine{00331\ \ \ \textcolor{comment}{//\_array.store(a,\ std::memory\_order\_relaxed);}}
\DoxyCodeLine{00332\ \ \ \textcolor{keywordflow}{return}\ tmp;}
\DoxyCodeLine{00333\ \}}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00335\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00336\ \textcolor{comment}{//\ BoundedTaskQueue}}
\DoxyCodeLine{00337\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00354\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T,\ \textcolor{keywordtype}{size\_t}\ LogSize\ =\ TF\_DEFAULT\_BOUNDED\_TASK\_QUEUE\_LOG\_SIZE>}
\DoxyCodeLine{00355\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtf_1_1_bounded_task_queue_a4160bb42036d75bc60f95cc189792a3d}{BoundedTaskQueue}}\ \{}
\DoxyCodeLine{00356\ \ \ }
\DoxyCodeLine{00357\ \ \ \textcolor{keyword}{static\_assert}(std::is\_pointer\_v<T>,\ \textcolor{stringliteral}{"{}T\ must\ be\ a\ pointer\ type"{}});}
\DoxyCodeLine{00358\ \ \ }
\DoxyCodeLine{00359\ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a3e4656c989b63e3d58b98019890c192d}{BufferSize}}\ =\ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\{1\}\ <<\ LogSize;}
\DoxyCodeLine{00360\ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{static}\ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a79d98ee5818a71f7240352e8b454039c}{BufferMask}}\ =\ (\mbox{\hyperlink{classtf_1_1_bounded_task_queue_a3e4656c989b63e3d58b98019890c192d}{BufferSize}}\ -\/\ 1);}
\DoxyCodeLine{00361\ }
\DoxyCodeLine{00362\ \ \ \textcolor{keyword}{static\_assert}((\mbox{\hyperlink{classtf_1_1_bounded_task_queue_a3e4656c989b63e3d58b98019890c192d}{BufferSize}}\ >=\ 2)\ \&\&\ ((\mbox{\hyperlink{classtf_1_1_bounded_task_queue_a3e4656c989b63e3d58b98019890c192d}{BufferSize}}\ \&\ (\mbox{\hyperlink{classtf_1_1_bounded_task_queue_a3e4656c989b63e3d58b98019890c192d}{BufferSize}}\ -\/\ 1))\ ==\ 0));}
\DoxyCodeLine{00363\ }
\DoxyCodeLine{00364\ \ \ \textcolor{keyword}{alignas}(2*\mbox{\hyperlink{os_8hpp_a2f7ab3bdbd7b17f081cbb69422b3bf0b}{TF\_CACHELINE\_SIZE}})\ std::atomic<int64\_t>\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a51e4f79ae1957cde7b1208b2119246c6}{\_top}}\ \{0\};}
\DoxyCodeLine{00365\ \ \ \textcolor{keyword}{alignas}(2*\mbox{\hyperlink{os_8hpp_a2f7ab3bdbd7b17f081cbb69422b3bf0b}{TF\_CACHELINE\_SIZE}})\ std::atomic<int64\_t>\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a4f6a86178138cff2f95243c2cc6b01e4}{\_bottom}}\ \{0\};}
\DoxyCodeLine{00366\ \ \ \textcolor{keyword}{alignas}(2*\mbox{\hyperlink{os_8hpp_a2f7ab3bdbd7b17f081cbb69422b3bf0b}{TF\_CACHELINE\_SIZE}})\ std::atomic<T>\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_ae1871b739c04078d56e2031c6cda8f59}{\_buffer}}[\mbox{\hyperlink{classtf_1_1_bounded_task_queue_a3e4656c989b63e3d58b98019890c192d}{BufferSize}}];}
\DoxyCodeLine{00367\ }
\DoxyCodeLine{00368\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00369\ \ \ \ \ }
\DoxyCodeLine{00373\ \ \ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a4160bb42036d75bc60f95cc189792a3d}{BoundedTaskQueue}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00374\ }
\DoxyCodeLine{00378\ \ \ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a5811b32810d0e70a1572a8ef594eba7e}{\string~BoundedTaskQueue}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00379\ \ \ }
\DoxyCodeLine{00383\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_ae64ab051e9ce597482cb602ce967d459}{empty}}()\ const\ noexcept;}
\DoxyCodeLine{00384\ \ \ }
\DoxyCodeLine{00388\ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a76620d4f4a85eae9e4626b9d83c61cb3}{size}}()\ const\ noexcept;}
\DoxyCodeLine{00389\ }
\DoxyCodeLine{00393\ \ \ constexpr\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_ae3c7315f59e60f806225ee9cf8d55229}{capacity}}()\ const;}
\DoxyCodeLine{00394\ \ \ }
\DoxyCodeLine{00405\ \ \ template\ <typename\ O>}
\DoxyCodeLine{00406\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_af52edec086b5e1a9c090eff6a6a76dae}{try\_push}}(O\&\&\ item);}
\DoxyCodeLine{00407\ \ \ }
\DoxyCodeLine{00419\ \ \ template\ <typename\ O,\ typename\ \mbox{\hyperlink{test__buffer__node_8cpp_ac4cf4b2ab929bd23951a8676eeac086b}{C}}>}
\DoxyCodeLine{00420\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a9b0c93adcdeb0a876869027a211fdf62}{push}}(O\&\&\ item,\ \mbox{\hyperlink{test__buffer__node_8cpp_ac4cf4b2ab929bd23951a8676eeac086b}{C}}\&\&\ on\_full);}
\DoxyCodeLine{00421\ \ \ }
\DoxyCodeLine{00428\ \ \ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a2b9e1d2502b489656b89cb505e95e71b}{pop}}();}
\DoxyCodeLine{00429\ \ \ }
\DoxyCodeLine{00436\ \ \ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_ad2b4f8d262b0093ce08dea92c00fae1b}{steal}}();}
\DoxyCodeLine{00437\ }
\DoxyCodeLine{00448\ \ \ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a8dfccb6523bc07fe9955ddda5136836a}{steal\_with\_hint}}(\textcolor{keywordtype}{size\_t}\&\ num\_empty\_steals);}
\DoxyCodeLine{00449\ \};}
\DoxyCodeLine{00450\ }
\DoxyCodeLine{00451\ \textcolor{comment}{//\ Function:\ empty}}
\DoxyCodeLine{00452\ template\ <typename\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ \textcolor{keywordtype}{size\_t}\ LogSize>}
\DoxyCodeLine{00453\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a4160bb42036d75bc60f95cc189792a3d}{BoundedTaskQueue}}<\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ LogSize>::\mbox{\hyperlink{classtf_1_1_bounded_task_queue_ae64ab051e9ce597482cb602ce967d459}{empty}}()\ const\ noexcept\ \{}
\DoxyCodeLine{00454\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ =\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a4f6a86178138cff2f95243c2cc6b01e4}{\_bottom}}.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00455\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a51e4f79ae1957cde7b1208b2119246c6}{\_top}}.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00456\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ <=\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}};}
\DoxyCodeLine{00457\ \}}
\DoxyCodeLine{00458\ }
\DoxyCodeLine{00459\ \textcolor{comment}{//\ Function:\ size}}
\DoxyCodeLine{00460\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T,\ \textcolor{keywordtype}{size\_t}\ LogSize>}
\DoxyCodeLine{00461\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a76620d4f4a85eae9e4626b9d83c61cb3}{BoundedTaskQueue<T,\ LogSize>::size}}()\ const\ noexcept\ \{}
\DoxyCodeLine{00462\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ =\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a4f6a86178138cff2f95243c2cc6b01e4}{\_bottom}}.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00463\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a51e4f79ae1957cde7b1208b2119246c6}{\_top}}.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00464\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ >=\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ ?\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ -\/\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ :\ 0);}
\DoxyCodeLine{00465\ \}}
\DoxyCodeLine{00466\ }
\DoxyCodeLine{00467\ \textcolor{comment}{//\ Function:\ try\_push}}
\DoxyCodeLine{00468\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T,\ \textcolor{keywordtype}{size\_t}\ LogSize>}
\DoxyCodeLine{00469\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ O>}
\DoxyCodeLine{00470\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_af52edec086b5e1a9c090eff6a6a76dae}{BoundedTaskQueue<T,\ LogSize>::try\_push}}(O\&\&\ o)\ \{}
\DoxyCodeLine{00471\ }
\DoxyCodeLine{00472\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ =\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a4f6a86178138cff2f95243c2cc6b01e4}{\_bottom}}.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00473\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a51e4f79ae1957cde7b1208b2119246c6}{\_top}}.load(std::memory\_order\_acquire);}
\DoxyCodeLine{00474\ }
\DoxyCodeLine{00475\ \ \ \textcolor{comment}{//\ queue\ is\ full\ with\ one\ additional\ item\ (b-\/t+1)}}
\DoxyCodeLine{00476\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{macros_8hpp_a4feec43418b365f045f440667d66cec1}{TF\_UNLIKELY}}((\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ -\/\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}})\ >\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a3e4656c989b63e3d58b98019890c192d}{BufferSize}}\ -\/\ 1)\ \{}
\DoxyCodeLine{00477\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00478\ \ \ \}}
\DoxyCodeLine{00479\ \ \ }
\DoxyCodeLine{00480\ \ \ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_ae1871b739c04078d56e2031c6cda8f59}{\_buffer}}[\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ \&\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a79d98ee5818a71f7240352e8b454039c}{BufferMask}}].store(std::forward<O>(o),\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00481\ }
\DoxyCodeLine{00482\ \ \ std::atomic\_thread\_fence(std::memory\_order\_release);}
\DoxyCodeLine{00483\ \ \ }
\DoxyCodeLine{00484\ \ \ \textcolor{comment}{//\ original\ paper\ uses\ relaxed\ here\ but\ tsa\ complains}}
\DoxyCodeLine{00485\ \ \ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a4f6a86178138cff2f95243c2cc6b01e4}{\_bottom}}.store(\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ +\ 1,\ std::memory\_order\_release);}
\DoxyCodeLine{00486\ }
\DoxyCodeLine{00487\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00488\ \}}
\DoxyCodeLine{00489\ }
\DoxyCodeLine{00490\ \textcolor{comment}{//\ Function:\ push}}
\DoxyCodeLine{00491\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T,\ \textcolor{keywordtype}{size\_t}\ LogSize>}
\DoxyCodeLine{00492\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ O,\ \textcolor{keyword}{typename}\ C>}
\DoxyCodeLine{00493\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a9b0c93adcdeb0a876869027a211fdf62}{BoundedTaskQueue<T,\ LogSize>::push}}(O\&\&\ o,\ \mbox{\hyperlink{test__buffer__node_8cpp_ac4cf4b2ab929bd23951a8676eeac086b}{C}}\&\&\ on\_full)\ \{}
\DoxyCodeLine{00494\ }
\DoxyCodeLine{00495\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ =\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a4f6a86178138cff2f95243c2cc6b01e4}{\_bottom}}.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00496\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a51e4f79ae1957cde7b1208b2119246c6}{\_top}}.load(std::memory\_order\_acquire);}
\DoxyCodeLine{00497\ }
\DoxyCodeLine{00498\ \ \ \textcolor{comment}{//\ queue\ is\ full\ with\ one\ additional\ item\ (b-\/t+1)}}
\DoxyCodeLine{00499\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{macros_8hpp_a4feec43418b365f045f440667d66cec1}{TF\_UNLIKELY}}((\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ -\/\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}})\ >\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a3e4656c989b63e3d58b98019890c192d}{BufferSize}}\ -\/\ 1)\ \{}
\DoxyCodeLine{00500\ \ \ \ \ on\_full();}
\DoxyCodeLine{00501\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00502\ \ \ \}}
\DoxyCodeLine{00503\ \ \ }
\DoxyCodeLine{00504\ \ \ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_ae1871b739c04078d56e2031c6cda8f59}{\_buffer}}[\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ \&\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a79d98ee5818a71f7240352e8b454039c}{BufferMask}}].store(std::forward<O>(o),\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00505\ }
\DoxyCodeLine{00506\ \ \ std::atomic\_thread\_fence(std::memory\_order\_release);}
\DoxyCodeLine{00507\ \ \ }
\DoxyCodeLine{00508\ \ \ \textcolor{comment}{//\ original\ paper\ uses\ relaxed\ here\ but\ tsa\ complains}}
\DoxyCodeLine{00509\ \ \ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a4f6a86178138cff2f95243c2cc6b01e4}{\_bottom}}.store(\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ +\ 1,\ std::memory\_order\_release);}
\DoxyCodeLine{00510\ \}}
\DoxyCodeLine{00511\ }
\DoxyCodeLine{00512\ \textcolor{comment}{//\ Function:\ pop}}
\DoxyCodeLine{00513\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T,\ \textcolor{keywordtype}{size\_t}\ LogSize>}
\DoxyCodeLine{00514\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a2b9e1d2502b489656b89cb505e95e71b}{BoundedTaskQueue<T,\ LogSize>::pop}}()\ \{}
\DoxyCodeLine{00515\ }
\DoxyCodeLine{00516\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ =\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a4f6a86178138cff2f95243c2cc6b01e4}{\_bottom}}.load(std::memory\_order\_relaxed)\ -\/\ 1;}
\DoxyCodeLine{00517\ \ \ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a4f6a86178138cff2f95243c2cc6b01e4}{\_bottom}}.store(\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}},\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00518\ \ \ std::atomic\_thread\_fence(std::memory\_order\_seq\_cst);}
\DoxyCodeLine{00519\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a51e4f79ae1957cde7b1208b2119246c6}{\_top}}.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00520\ }
\DoxyCodeLine{00521\ \ \ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ item\ \{\textcolor{keyword}{nullptr}\};}
\DoxyCodeLine{00522\ }
\DoxyCodeLine{00523\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ <=\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})\ \{}
\DoxyCodeLine{00524\ \ \ \ \ item\ =\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_ae1871b739c04078d56e2031c6cda8f59}{\_buffer}}[\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ \&\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a79d98ee5818a71f7240352e8b454039c}{BufferMask}}].load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00525\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ ==\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})\ \{}
\DoxyCodeLine{00526\ \ \ \ \ \ \ \textcolor{comment}{//\ the\ last\ item\ just\ got\ stolen}}
\DoxyCodeLine{00527\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!\mbox{\hyperlink{classtf_1_1_bounded_task_queue_a51e4f79ae1957cde7b1208b2119246c6}{\_top}}.compare\_exchange\_strong(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}},\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}+1,\ }
\DoxyCodeLine{00528\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_seq\_cst,\ }
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_relaxed))\ \{}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \ \ item\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a4f6a86178138cff2f95243c2cc6b01e4}{\_bottom}}.store(\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ +\ 1,\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00533\ \ \ \ \ \}}
\DoxyCodeLine{00534\ \ \ \}}
\DoxyCodeLine{00535\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00536\ \ \ \ \ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a4f6a86178138cff2f95243c2cc6b01e4}{\_bottom}}.store(\mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ +\ 1,\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00537\ \ \ \}}
\DoxyCodeLine{00538\ }
\DoxyCodeLine{00539\ \ \ \textcolor{keywordflow}{return}\ item;}
\DoxyCodeLine{00540\ \}}
\DoxyCodeLine{00541\ }
\DoxyCodeLine{00542\ \textcolor{comment}{//\ Function:\ steal}}
\DoxyCodeLine{00543\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T,\ \textcolor{keywordtype}{size\_t}\ LogSize>}
\DoxyCodeLine{00544\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_ad2b4f8d262b0093ce08dea92c00fae1b}{BoundedTaskQueue<T,\ LogSize>::steal}}()\ \{}
\DoxyCodeLine{00545\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a51e4f79ae1957cde7b1208b2119246c6}{\_top}}.load(std::memory\_order\_acquire);}
\DoxyCodeLine{00546\ \ \ std::atomic\_thread\_fence(std::memory\_order\_seq\_cst);}
\DoxyCodeLine{00547\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ =\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a4f6a86178138cff2f95243c2cc6b01e4}{\_bottom}}.load(std::memory\_order\_acquire);}
\DoxyCodeLine{00548\ \ \ }
\DoxyCodeLine{00549\ \ \ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ item\{\textcolor{keyword}{nullptr}\};}
\DoxyCodeLine{00550\ }
\DoxyCodeLine{00551\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ <\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})\ \{}
\DoxyCodeLine{00552\ \ \ \ \ item\ =\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_ae1871b739c04078d56e2031c6cda8f59}{\_buffer}}[\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ \&\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a79d98ee5818a71f7240352e8b454039c}{BufferMask}}].load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00553\ \ \ \ \ \textcolor{keywordflow}{if}(!\mbox{\hyperlink{classtf_1_1_bounded_task_queue_a51e4f79ae1957cde7b1208b2119246c6}{\_top}}.compare\_exchange\_strong(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}},\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}+1,}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_seq\_cst,}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_relaxed))\ \{}
\DoxyCodeLine{00556\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00557\ \ \ \ \ \}}
\DoxyCodeLine{00558\ \ \ \}}
\DoxyCodeLine{00559\ }
\DoxyCodeLine{00560\ \ \ \textcolor{keywordflow}{return}\ item;}
\DoxyCodeLine{00561\ \}}
\DoxyCodeLine{00562\ }
\DoxyCodeLine{00563\ \textcolor{comment}{//\ Function:\ steal}}
\DoxyCodeLine{00564\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T,\ \textcolor{keywordtype}{size\_t}\ LogSize>}
\DoxyCodeLine{00565\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a8dfccb6523bc07fe9955ddda5136836a}{BoundedTaskQueue<T,\ LogSize>::steal\_with\_hint}}(\textcolor{keywordtype}{size\_t}\&\ num\_empty\_steals)\ \{}
\DoxyCodeLine{00566\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a51e4f79ae1957cde7b1208b2119246c6}{\_top}}.load(std::memory\_order\_acquire);}
\DoxyCodeLine{00567\ \ \ std::atomic\_thread\_fence(std::memory\_order\_seq\_cst);}
\DoxyCodeLine{00568\ \ \ \mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}}\ =\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a4f6a86178138cff2f95243c2cc6b01e4}{\_bottom}}.load(std::memory\_order\_acquire);}
\DoxyCodeLine{00569\ \ \ }
\DoxyCodeLine{00570\ \ \ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ item\ \{\textcolor{keyword}{nullptr}\};}
\DoxyCodeLine{00571\ }
\DoxyCodeLine{00572\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ <\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})\ \{}
\DoxyCodeLine{00573\ \ \ \ \ num\_empty\_steals\ =\ 0;}
\DoxyCodeLine{00574\ \ \ \ \ item\ =\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_ae1871b739c04078d56e2031c6cda8f59}{\_buffer}}[\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ \&\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_a79d98ee5818a71f7240352e8b454039c}{BufferMask}}].load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00575\ \ \ \ \ \textcolor{keywordflow}{if}(!\mbox{\hyperlink{classtf_1_1_bounded_task_queue_a51e4f79ae1957cde7b1208b2119246c6}{\_top}}.compare\_exchange\_strong(\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}},\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}+1,}
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_seq\_cst,}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_relaxed))\ \{}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00579\ \ \ \ \ \}}
\DoxyCodeLine{00580\ \ \ \}}
\DoxyCodeLine{00581\ \ \ ++num\_empty\_steals;}
\DoxyCodeLine{00582\ \ \ \textcolor{keywordflow}{return}\ item;}
\DoxyCodeLine{00583\ \}}
\DoxyCodeLine{00584\ }
\DoxyCodeLine{00585\ \textcolor{comment}{//\ Function:\ capacity}}
\DoxyCodeLine{00586\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ T,\ \textcolor{keywordtype}{size\_t}\ LogSize>}
\DoxyCodeLine{00587\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtf_1_1_bounded_task_queue_ae3c7315f59e60f806225ee9cf8d55229}{BoundedTaskQueue<T,\ LogSize>::capacity}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00588\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(\mbox{\hyperlink{classtf_1_1_bounded_task_queue_a3e4656c989b63e3d58b98019890c192d}{BufferSize}});}
\DoxyCodeLine{00589\ \}}
\DoxyCodeLine{00590\ }
\DoxyCodeLine{00591\ }
\DoxyCodeLine{00592\ }
\DoxyCodeLine{00593\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00594\ }
\DoxyCodeLine{00595\ \textcolor{comment}{//template\ <typename\ T>}}
\DoxyCodeLine{00596\ \textcolor{comment}{//class\ UnboundedTaskQueue2\ \{}}
\DoxyCodeLine{00597\ \textcolor{comment}{//\ \ }}
\DoxyCodeLine{00598\ \textcolor{comment}{//\ \ static\_assert(std::is\_pointer\_v<T>,\ "{}T\ must\ be\ a\ pointer\ type"{});}}
\DoxyCodeLine{00599\ \textcolor{comment}{//}}
\DoxyCodeLine{00600\ \textcolor{comment}{//\ \ struct\ Array\ \{}}
\DoxyCodeLine{00601\ \textcolor{comment}{//}}
\DoxyCodeLine{00602\ \textcolor{comment}{//\ \ \ \ int64\_t\ C;}}
\DoxyCodeLine{00603\ \textcolor{comment}{//\ \ \ \ int64\_t\ M;}}
\DoxyCodeLine{00604\ \textcolor{comment}{//\ \ \ \ std::atomic<T>*\ S;}}
\DoxyCodeLine{00605\ \textcolor{comment}{//}}
\DoxyCodeLine{00606\ \textcolor{comment}{//\ \ \ \ explicit\ Array(int64\_t\ c)\ :}}
\DoxyCodeLine{00607\ \textcolor{comment}{//\ \ \ \ \ \ C\ \{c\},}}
\DoxyCodeLine{00608\ \textcolor{comment}{//\ \ \ \ \ \ M\ \{c-\/1\},}}
\DoxyCodeLine{00609\ \textcolor{comment}{//\ \ \ \ \ \ S\ \{new\ std::atomic<T>[static\_cast<size\_t>(C)]\}\ \{}}
\DoxyCodeLine{00610\ \textcolor{comment}{//\ \ \ \ \}}}
\DoxyCodeLine{00611\ \textcolor{comment}{//}}
\DoxyCodeLine{00612\ \textcolor{comment}{//\ \ \ \ \string~Array()\ \{}}
\DoxyCodeLine{00613\ \textcolor{comment}{//\ \ \ \ \ \ delete\ []\ S;}}
\DoxyCodeLine{00614\ \textcolor{comment}{//\ \ \ \ \}}}
\DoxyCodeLine{00615\ \textcolor{comment}{//}}
\DoxyCodeLine{00616\ \textcolor{comment}{//\ \ \ \ int64\_t\ capacity()\ const\ noexcept\ \{}}
\DoxyCodeLine{00617\ \textcolor{comment}{//\ \ \ \ \ \ return\ C;}}
\DoxyCodeLine{00618\ \textcolor{comment}{//\ \ \ \ \}}}
\DoxyCodeLine{00619\ \textcolor{comment}{//}}
\DoxyCodeLine{00620\ \textcolor{comment}{//\ \ \ \ void\ push(int64\_t\ i,\ T\ o)\ noexcept\ \{}}
\DoxyCodeLine{00621\ \textcolor{comment}{//\ \ \ \ \ \ S[i\ \&\ M].store(o,\ std::memory\_order\_relaxed);}}
\DoxyCodeLine{00622\ \textcolor{comment}{//\ \ \ \ \}}}
\DoxyCodeLine{00623\ \textcolor{comment}{//}}
\DoxyCodeLine{00624\ \textcolor{comment}{//\ \ \ \ T\ pop(int64\_t\ i)\ noexcept\ \{}}
\DoxyCodeLine{00625\ \textcolor{comment}{//\ \ \ \ \ \ return\ S[i\ \&\ M].load(std::memory\_order\_relaxed);}}
\DoxyCodeLine{00626\ \textcolor{comment}{//\ \ \ \ \}}}
\DoxyCodeLine{00627\ \textcolor{comment}{//}}
\DoxyCodeLine{00628\ \textcolor{comment}{//\ \ \ \ Array*\ resize(int64\_t\ b,\ int64\_t\ t)\ \{}}
\DoxyCodeLine{00629\ \textcolor{comment}{//\ \ \ \ \ \ Array*\ ptr\ =\ new\ Array\ \{2*C\};}}
\DoxyCodeLine{00630\ \textcolor{comment}{//\ \ \ \ \ \ for(int64\_t\ i=t;\ i!=b;\ ++i)\ \{}}
\DoxyCodeLine{00631\ \textcolor{comment}{//\ \ \ \ \ \ \ \ ptr-\/>push(i,\ pop(i));}}
\DoxyCodeLine{00632\ \textcolor{comment}{//\ \ \ \ \ \ \}}}
\DoxyCodeLine{00633\ \textcolor{comment}{//\ \ \ \ \ \ return\ ptr;}}
\DoxyCodeLine{00634\ \textcolor{comment}{//\ \ \ \ \}}}
\DoxyCodeLine{00635\ \textcolor{comment}{//}}
\DoxyCodeLine{00636\ \textcolor{comment}{//\ \ \};}}
\DoxyCodeLine{00637\ \textcolor{comment}{//}}
\DoxyCodeLine{00638\ \textcolor{comment}{//\ \ //\ Doubling\ the\ alignment\ by\ 2\ seems\ to\ generate\ the\ most}}
\DoxyCodeLine{00639\ \textcolor{comment}{//\ \ //\ decent\ performance.}}
\DoxyCodeLine{00640\ \textcolor{comment}{//\ \ alignas(2*TF\_CACHELINE\_SIZE)\ std::atomic<int64\_t>\ \_top;}}
\DoxyCodeLine{00641\ \textcolor{comment}{//\ \ alignas(2*TF\_CACHELINE\_SIZE)\ std::atomic<int64\_t>\ \_bottom;}}
\DoxyCodeLine{00642\ \textcolor{comment}{//\ \ std::atomic<Array*>\ \_array;}}
\DoxyCodeLine{00643\ \textcolor{comment}{//\ \ std::vector<Array*>\ \_garbage;}}
\DoxyCodeLine{00644\ \textcolor{comment}{//}}
\DoxyCodeLine{00645\ \textcolor{comment}{//\ \ static\ constexpr\ int64\_t\ BOTTOM\_LOCK\ =\ std::numeric\_limits<int64\_t>::min();}}
\DoxyCodeLine{00646\ \textcolor{comment}{//\ \ static\ constexpr\ int64\_t\ BOTTOM\_MASK\ =\ std::numeric\_limits<int64\_t>::max();}}
\DoxyCodeLine{00647\ \textcolor{comment}{//}}
\DoxyCodeLine{00648\ \textcolor{comment}{//\ \ public:}}
\DoxyCodeLine{00649\ \textcolor{comment}{//}}
\DoxyCodeLine{00650\ \textcolor{comment}{//\ \ /**}}
\DoxyCodeLine{00651\ \textcolor{comment}{//\ \ @brief\ constructs\ the\ queue\ with\ the\ given\ size\ in\ the\ base-\/2\ logarithm}}
\DoxyCodeLine{00652\ \textcolor{comment}{//}}
\DoxyCodeLine{00653\ \textcolor{comment}{//\ \ @param\ LogSize\ the\ base-\/2\ logarithm\ of\ the\ queue\ size}}
\DoxyCodeLine{00654\ \textcolor{comment}{//\ \ */}}
\DoxyCodeLine{00655\ \textcolor{comment}{//\ \ explicit\ UnboundedTaskQueue2(int64\_t\ LogSize\ =\ TF\_DEFAULT\_UNBOUNDED\_TASK\_QUEUE\_LOG\_SIZE);}}
\DoxyCodeLine{00656\ \textcolor{comment}{//}}
\DoxyCodeLine{00657\ \textcolor{comment}{//\ \ /**}}
\DoxyCodeLine{00658\ \textcolor{comment}{//\ \ @brief\ destructs\ the\ queue}}
\DoxyCodeLine{00659\ \textcolor{comment}{//\ \ */}}
\DoxyCodeLine{00660\ \textcolor{comment}{//\ \ \string~UnboundedTaskQueue2();}}
\DoxyCodeLine{00661\ \textcolor{comment}{//}}
\DoxyCodeLine{00662\ \textcolor{comment}{//\ \ /**}}
\DoxyCodeLine{00663\ \textcolor{comment}{//\ \ @brief\ queries\ if\ the\ queue\ is\ empty\ at\ the\ time\ of\ this\ call}}
\DoxyCodeLine{00664\ \textcolor{comment}{//\ \ */}}
\DoxyCodeLine{00665\ \textcolor{comment}{//\ \ bool\ empty()\ const\ noexcept;}}
\DoxyCodeLine{00666\ \textcolor{comment}{//}}
\DoxyCodeLine{00667\ \textcolor{comment}{//\ \ /**}}
\DoxyCodeLine{00668\ \textcolor{comment}{//\ \ @brief\ queries\ the\ number\ of\ items\ at\ the\ time\ of\ this\ call}}
\DoxyCodeLine{00669\ \textcolor{comment}{//\ \ */}}
\DoxyCodeLine{00670\ \textcolor{comment}{//\ \ size\_t\ size()\ const\ noexcept;}}
\DoxyCodeLine{00671\ \textcolor{comment}{//}}
\DoxyCodeLine{00672\ \textcolor{comment}{//\ \ /**}}
\DoxyCodeLine{00673\ \textcolor{comment}{//\ \ @brief\ queries\ the\ capacity\ of\ the\ queue}}
\DoxyCodeLine{00674\ \textcolor{comment}{//\ \ */}}
\DoxyCodeLine{00675\ \textcolor{comment}{//\ \ int64\_t\ capacity()\ const\ noexcept;}}
\DoxyCodeLine{00676\ \textcolor{comment}{//\ \ }}
\DoxyCodeLine{00677\ \textcolor{comment}{//\ \ /**}}
\DoxyCodeLine{00678\ \textcolor{comment}{//\ \ @brief\ inserts\ an\ item\ to\ the\ queue}}
\DoxyCodeLine{00679\ \textcolor{comment}{//}}
\DoxyCodeLine{00680\ \textcolor{comment}{//\ \ @param\ item\ the\ item\ to\ push\ to\ the\ queue}}
\DoxyCodeLine{00681\ \textcolor{comment}{//\ \ }}
\DoxyCodeLine{00682\ \textcolor{comment}{//\ \ Only\ the\ owner\ thread\ can\ insert\ an\ item\ to\ the\ queue.}}
\DoxyCodeLine{00683\ \textcolor{comment}{//\ \ The\ operation\ can\ trigger\ the\ queue\ to\ resize\ its\ capacity}}
\DoxyCodeLine{00684\ \textcolor{comment}{//\ \ if\ more\ space\ is\ required.}}
\DoxyCodeLine{00685\ \textcolor{comment}{//\ \ */}}
\DoxyCodeLine{00686\ \textcolor{comment}{//\ \ void\ push(T\ item);}}
\DoxyCodeLine{00687\ \textcolor{comment}{//}}
\DoxyCodeLine{00688\ \textcolor{comment}{//\ \ /**}}
\DoxyCodeLine{00689\ \textcolor{comment}{//\ \ @brief\ steals\ an\ item\ from\ the\ queue}}
\DoxyCodeLine{00690\ \textcolor{comment}{//}}
\DoxyCodeLine{00691\ \textcolor{comment}{//\ \ Any\ threads\ can\ try\ to\ steal\ an\ item\ from\ the\ queue.}}
\DoxyCodeLine{00692\ \textcolor{comment}{//\ \ The\ return\ can\ be\ a\ @c\ nullptr\ if\ this\ operation\ failed\ (not\ necessary\ empty).}}
\DoxyCodeLine{00693\ \textcolor{comment}{//\ \ */}}
\DoxyCodeLine{00694\ \textcolor{comment}{//\ \ T\ steal();}}
\DoxyCodeLine{00695\ \textcolor{comment}{//}}
\DoxyCodeLine{00696\ \textcolor{comment}{//\ \ private:}}
\DoxyCodeLine{00697\ \textcolor{comment}{//}}
\DoxyCodeLine{00698\ \textcolor{comment}{//\ \ Array*\ resize\_array(Array*\ a,\ int64\_t\ b,\ int64\_t\ t);}}
\DoxyCodeLine{00699\ \textcolor{comment}{//\};}}
\DoxyCodeLine{00700\ \textcolor{comment}{//}}
\DoxyCodeLine{00702\ \textcolor{comment}{//template\ <typename\ T>}}
\DoxyCodeLine{00703\ \textcolor{comment}{//UnboundedTaskQueue2<T>::UnboundedTaskQueue2(int64\_t\ LogSize)\ \{}}
\DoxyCodeLine{00704\ \textcolor{comment}{//\ \ \_top.store(0,\ std::memory\_order\_relaxed);}}
\DoxyCodeLine{00705\ \textcolor{comment}{//\ \ \_bottom.store(0,\ std::memory\_order\_relaxed);}}
\DoxyCodeLine{00706\ \textcolor{comment}{//\ \ \_array.store(new\ Array\{(int64\_t\{1\}\ <<\ LogSize)\},\ std::memory\_order\_relaxed);}}
\DoxyCodeLine{00707\ \textcolor{comment}{//\ \ \_garbage.reserve(32);}}
\DoxyCodeLine{00708\ \textcolor{comment}{//\}}}
\DoxyCodeLine{00709\ \textcolor{comment}{//}}
\DoxyCodeLine{00711\ \textcolor{comment}{//template\ <typename\ T>}}
\DoxyCodeLine{00712\ \textcolor{comment}{//UnboundedTaskQueue2<T>::\string~UnboundedTaskQueue2()\ \{}}
\DoxyCodeLine{00713\ \textcolor{comment}{//\ \ for(auto\ a\ :\ \_garbage)\ \{}}
\DoxyCodeLine{00714\ \textcolor{comment}{//\ \ \ \ delete\ a;}}
\DoxyCodeLine{00715\ \textcolor{comment}{//\ \ \}}}
\DoxyCodeLine{00716\ \textcolor{comment}{//\ \ delete\ \_array.load();}}
\DoxyCodeLine{00717\ \textcolor{comment}{//\}}}
\DoxyCodeLine{00718\ \textcolor{comment}{//}}
\DoxyCodeLine{00720\ \textcolor{comment}{//template\ <typename\ T>}}
\DoxyCodeLine{00721\ \textcolor{comment}{//bool\ UnboundedTaskQueue2<T>::empty()\ const\ noexcept\ \{}}
\DoxyCodeLine{00722\ \textcolor{comment}{//\ \ int64\_t\ b\ =\ \_bottom.load(std::memory\_order\_relaxed)\ \&\ BOTTOM\_MASK;}}
\DoxyCodeLine{00723\ \textcolor{comment}{//\ \ int64\_t\ t\ =\ \_top.load(std::memory\_order\_relaxed);}}
\DoxyCodeLine{00724\ \textcolor{comment}{//\ \ return\ (b\ <=\ t);}}
\DoxyCodeLine{00725\ \textcolor{comment}{//\}}}
\DoxyCodeLine{00726\ \textcolor{comment}{//}}
\DoxyCodeLine{00728\ \textcolor{comment}{//template\ <typename\ T>}}
\DoxyCodeLine{00729\ \textcolor{comment}{//size\_t\ UnboundedTaskQueue2<T>::size()\ const\ noexcept\ \{}}
\DoxyCodeLine{00730\ \textcolor{comment}{//\ \ int64\_t\ b\ =\ \_bottom.load(std::memory\_order\_relaxed)\ \&\ BOTTOM\_MASK;}}
\DoxyCodeLine{00731\ \textcolor{comment}{//\ \ int64\_t\ t\ =\ \_top.load(std::memory\_order\_relaxed);}}
\DoxyCodeLine{00732\ \textcolor{comment}{//\ \ return\ static\_cast<size\_t>(b\ >=\ t\ ?\ b\ -\/\ t\ :\ 0);}}
\DoxyCodeLine{00733\ \textcolor{comment}{//\}}}
\DoxyCodeLine{00734\ \textcolor{comment}{//}}
\DoxyCodeLine{00736\ \textcolor{comment}{//template\ <typename\ T>}}
\DoxyCodeLine{00737\ \textcolor{comment}{//void\ UnboundedTaskQueue2<T>::push(T\ o)\ \{}}
\DoxyCodeLine{00738\ \textcolor{comment}{//\ \ }}
\DoxyCodeLine{00739\ \textcolor{comment}{//\ \ //\ spin\ until\ getting\ an\ exclusive\ access\ to\ b}}
\DoxyCodeLine{00740\ \textcolor{comment}{//\ \ int64\_t\ b\ =\ \_bottom.load(std::memory\_order\_acquire)\ \&\ BOTTOM\_MASK;}}
\DoxyCodeLine{00741\ \textcolor{comment}{//\ \ while(!\_bottom.compare\_exchange\_weak(b,\ b\ |\ BOTTOM\_LOCK,\ std::memory\_order\_acquire,}}
\DoxyCodeLine{00742\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_relaxed))\ \{}}
\DoxyCodeLine{00743\ \textcolor{comment}{//\ \ \ \ b\ =\ b\ \&\ BOTTOM\_MASK;}}
\DoxyCodeLine{00744\ \textcolor{comment}{//\ \ \}}}
\DoxyCodeLine{00745\ \textcolor{comment}{//}}
\DoxyCodeLine{00746\ \textcolor{comment}{//\ \ //\ critical\ region}}
\DoxyCodeLine{00747\ \textcolor{comment}{//\ \ int64\_t\ t\ =\ \_top.load(std::memory\_order\_acquire);}}
\DoxyCodeLine{00748\ \textcolor{comment}{//\ \ Array*\ a\ =\ \_array.load(std::memory\_order\_relaxed);}}
\DoxyCodeLine{00749\ \textcolor{comment}{//}}
\DoxyCodeLine{00750\ \textcolor{comment}{//\ \ //\ queue\ is\ full}}
\DoxyCodeLine{00751\ \textcolor{comment}{//\ \ if\ TF\_UNLIKELY(a-\/>capacity()\ -\/\ 1\ <\ (b\ -\/\ t))\ \{}}
\DoxyCodeLine{00752\ \textcolor{comment}{//\ \ \ \ a\ =\ resize\_array(a,\ b,\ t);}}
\DoxyCodeLine{00753\ \textcolor{comment}{//\ \ \}}}
\DoxyCodeLine{00754\ \textcolor{comment}{//}}
\DoxyCodeLine{00755\ \textcolor{comment}{//\ \ a-\/>push(b,\ o);}}
\DoxyCodeLine{00756\ \textcolor{comment}{//\ \ std::atomic\_thread\_fence(std::memory\_order\_release);}}
\DoxyCodeLine{00757\ \textcolor{comment}{//}}
\DoxyCodeLine{00758\ \textcolor{comment}{//\ \ //\ original\ paper\ uses\ relaxed\ here\ but\ tsa\ complains}}
\DoxyCodeLine{00759\ \textcolor{comment}{//\ \ \_bottom.store(b\ +\ 1,\ std::memory\_order\_release);}}
\DoxyCodeLine{00760\ \textcolor{comment}{//\}}}
\DoxyCodeLine{00761\ \textcolor{comment}{//}}
\DoxyCodeLine{00763\ \textcolor{comment}{//template\ <typename\ T>}}
\DoxyCodeLine{00764\ \textcolor{comment}{//T\ UnboundedTaskQueue2<T>::steal()\ \{}}
\DoxyCodeLine{00765\ \textcolor{comment}{//\ \ }}
\DoxyCodeLine{00766\ \textcolor{comment}{//\ \ int64\_t\ t\ =\ \_top.load(std::memory\_order\_acquire);}}
\DoxyCodeLine{00767\ \textcolor{comment}{//\ \ std::atomic\_thread\_fence(std::memory\_order\_seq\_cst);}}
\DoxyCodeLine{00768\ \textcolor{comment}{//\ \ int64\_t\ b\ =\ \_bottom.load(std::memory\_order\_acquire)\ \&\ BOTTOM\_MASK;}}
\DoxyCodeLine{00769\ \textcolor{comment}{//}}
\DoxyCodeLine{00770\ \textcolor{comment}{//\ \ T\ item\ \{nullptr\};}}
\DoxyCodeLine{00771\ \textcolor{comment}{//}}
\DoxyCodeLine{00772\ \textcolor{comment}{//\ \ if(t\ <\ b)\ \{}}
\DoxyCodeLine{00773\ \textcolor{comment}{//\ \ \ \ Array*\ a\ =\ \_array.load(std::memory\_order\_consume);}}
\DoxyCodeLine{00774\ \textcolor{comment}{//\ \ \ \ item\ =\ a-\/>pop(t);}}
\DoxyCodeLine{00775\ \textcolor{comment}{//\ \ \ \ if(!\_top.compare\_exchange\_strong(t,\ t+1,}}
\DoxyCodeLine{00776\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_seq\_cst,}}
\DoxyCodeLine{00777\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_relaxed))\ \{}}
\DoxyCodeLine{00778\ \textcolor{comment}{//\ \ \ \ \ \ return\ nullptr;}}
\DoxyCodeLine{00779\ \textcolor{comment}{//\ \ \ \ \}}}
\DoxyCodeLine{00780\ \textcolor{comment}{//\ \ \}}}
\DoxyCodeLine{00781\ \textcolor{comment}{//}}
\DoxyCodeLine{00782\ \textcolor{comment}{//\ \ return\ item;}}
\DoxyCodeLine{00783\ \textcolor{comment}{//\}}}
\DoxyCodeLine{00784\ \textcolor{comment}{//}}
\DoxyCodeLine{00786\ \textcolor{comment}{//template\ <typename\ T>}}
\DoxyCodeLine{00787\ \textcolor{comment}{//int64\_t\ UnboundedTaskQueue2<T>::capacity()\ const\ noexcept\ \{}}
\DoxyCodeLine{00788\ \textcolor{comment}{//\ \ return\ \_array.load(std::memory\_order\_relaxed)-\/>capacity();}}
\DoxyCodeLine{00789\ \textcolor{comment}{//\}}}
\DoxyCodeLine{00790\ \textcolor{comment}{//}}
\DoxyCodeLine{00791\ \textcolor{comment}{//template\ <typename\ T>}}
\DoxyCodeLine{00792\ \textcolor{comment}{//typename\ UnboundedTaskQueue2<T>::Array*}}
\DoxyCodeLine{00793\ \textcolor{comment}{//UnboundedTaskQueue2<T>::resize\_array(Array*\ a,\ int64\_t\ b,\ int64\_t\ t)\ \{}}
\DoxyCodeLine{00794\ \textcolor{comment}{//}}
\DoxyCodeLine{00795\ \textcolor{comment}{//\ \ Array*\ tmp\ =\ a-\/>resize(b,\ t);}}
\DoxyCodeLine{00796\ \textcolor{comment}{//\ \ \_garbage.push\_back(a);}}
\DoxyCodeLine{00797\ \textcolor{comment}{//\ \ std::swap(a,\ tmp);}}
\DoxyCodeLine{00798\ \textcolor{comment}{//\ \ \_array.store(a,\ std::memory\_order\_release);}}
\DoxyCodeLine{00799\ \textcolor{comment}{//\ \ //\ Note:\ the\ original\ paper\ using\ relaxed\ causes\ t-\/san\ to\ complain}}
\DoxyCodeLine{00800\ \textcolor{comment}{//\ \ //\_array.store(a,\ std::memory\_order\_relaxed);}}
\DoxyCodeLine{00801\ \textcolor{comment}{//\ \ return\ a;}}
\DoxyCodeLine{00802\ \textcolor{comment}{//\}}}
\DoxyCodeLine{00803\ }
\DoxyCodeLine{00804\ \}\ \ \textcolor{comment}{//\ end\ of\ namespace\ tf\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00805\ }
\DoxyCodeLine{00806\ }
\DoxyCodeLine{00807\ }

\end{DoxyCode}
