\doxysection{test\+\_\+cilk\+\_\+common.\+h}
\hypertarget{test__cilk__common_8h_source}{}\label{test__cilk__common_8h_source}\index{external/taskflow/3rd-\/party/tbb/src/test/test\_cilk\_common.h@{external/taskflow/3rd-\/party/tbb/src/test/test\_cilk\_common.h}}
\mbox{\hyperlink{test__cilk__common_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ \ \ \ Copyright\ (c)\ 2005-\/2020\ Intel\ Corporation}}
\DoxyCodeLine{00003\ \textcolor{comment}{}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ \ \ \ Licensed\ under\ the\ Apache\ License,\ Version\ 2.0\ (the\ "{}License"{});}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ \ \ \ you\ may\ not\ use\ this\ file\ except\ in\ compliance\ with\ the\ License.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ \ \ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00007\ \textcolor{comment}{}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ \ \ \ \ \ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00009\ \textcolor{comment}{}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ \ \ \ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,\ software}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ \ \ \ distributed\ under\ the\ License\ is\ distributed\ on\ an\ "{}AS\ IS"{}\ BASIS,}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ \ \ \ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY\ KIND,\ either\ express\ or\ implied.}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ \ \ \ See\ the\ License\ for\ the\ specific\ language\ governing\ permissions\ and}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ \ \ \ limitations\ under\ the\ License.}}
\DoxyCodeLine{00015\ \textcolor{comment}{*/}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{comment}{//\ This\ file\ is\ a\ common\ part\ of\ test\_cilk\_interop\ and\ test\_cilk\_dynamic\_load\ tests}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{test__cilk__common_8h_ae8a58338f92a073d07a59f80d81a199f}{TBB\_Fib}}(\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ );}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_fib_cilk_subtask_a33b42d6b69e7e07a6d9707ede973a164}{FibCilkSubtask}}:\ \textcolor{keyword}{public}\ tbb::task\ \{}
\DoxyCodeLine{00022\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{class_fib_cilk_subtask_a7236e1bc03cfe9d80460efe489217aae}{n}};}
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{keywordtype}{int}\&\ \mbox{\hyperlink{class_fib_cilk_subtask_a55b1bc0438885e88a69b70065cb1d08f}{result}};}
\DoxyCodeLine{00024\ \ \ \ \ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}*\ \mbox{\hyperlink{class_fib_cilk_subtask_afe6d090941a533bd16b299df258e448b}{execute}}()\ \_\_TBB\_override\ \{}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{class_fib_cilk_subtask_a7236e1bc03cfe9d80460efe489217aae}{n}}<2\ )\ \{}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_fib_cilk_subtask_a55b1bc0438885e88a69b70065cb1d08f}{result}}\ =\ \mbox{\hyperlink{class_fib_cilk_subtask_a7236e1bc03cfe9d80460efe489217aae}{n}};}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}},\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a5e247fc24ceb70d83f6ad59149b8910a}{y}};}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}}\ =\ cilk\_spawn\ \mbox{\hyperlink{test__cilk__common_8h_ae8a58338f92a073d07a59f80d81a199f}{TBB\_Fib}}(\mbox{\hyperlink{class_fib_cilk_subtask_a7236e1bc03cfe9d80460efe489217aae}{n}}-\/2);}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a5e247fc24ceb70d83f6ad59149b8910a}{y}}\ =\ cilk\_spawn\ \mbox{\hyperlink{test__cilk__common_8h_ae8a58338f92a073d07a59f80d81a199f}{TBB\_Fib}}(\mbox{\hyperlink{class_fib_cilk_subtask_a7236e1bc03cfe9d80460efe489217aae}{n}}-\/1);}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \ \ \ \ cilk\_sync;}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_fib_cilk_subtask_a55b1bc0438885e88a69b70065cb1d08f}{result}}\ =\ \mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}}+\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a5e247fc24ceb70d83f6ad59149b8910a}{y}};}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00035\ \ \ \ \ \}}
\DoxyCodeLine{00036\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00037\ \ \ \ \ \mbox{\hyperlink{class_fib_cilk_subtask_a33b42d6b69e7e07a6d9707ede973a164}{FibCilkSubtask}}(\ \textcolor{keywordtype}{int}\&\ result\_,\ \textcolor{keywordtype}{int}\ n\_\ )\ :\ \mbox{\hyperlink{class_fib_cilk_subtask_a55b1bc0438885e88a69b70065cb1d08f}{result}}(result\_),\ \mbox{\hyperlink{class_fib_cilk_subtask_a7236e1bc03cfe9d80460efe489217aae}{n}}(n\_)\ \{\}}
\DoxyCodeLine{00038\ \};}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \textcolor{keyword}{class\ }\mbox{\hyperlink{struct_fib_task}{FibTask}}:\ \textcolor{keyword}{public}\ tbb::task\ \{}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{struct_fib_task_aae95f5d1a71b3ba8f7416e9f3013dc8e}{n}};}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keywordtype}{int}\&\ \mbox{\hyperlink{struct_fib_task_ae64cee85b90f507082fd9223f429e0c5}{result}};}
\DoxyCodeLine{00043\ \ \ \ \ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}*\ \mbox{\hyperlink{struct_fib_task_a8dfc43a49cbdaef09e8d8e43244f13cd}{execute}}()\ \_\_TBB\_override\ \{}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !g\_sandwich\ \&\&\ \mbox{\hyperlink{struct_fib_task_aae95f5d1a71b3ba8f7416e9f3013dc8e}{n}}<2\ )\ \{}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_fib_task_ae64cee85b90f507082fd9223f429e0c5}{result}}\ =\ \mbox{\hyperlink{struct_fib_task_aae95f5d1a71b3ba8f7416e9f3013dc8e}{n}};}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{struct_fib_task_a8bb077d6150c36cf25ebc53826311c29}{x}},\mbox{\hyperlink{struct_fib_task_ae316a1e2a54bad3d1d1d79478fbf84ff}{y}};}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1task__scheduler__init}{tbb::task\_scheduler\_init}}\ \mbox{\hyperlink{boing_8c_a2858154e2009b0e6e616f313177762bc}{init}}(P\_nested);}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}*\ self0\ =\ \&task::self();}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ set\_ref\_count(\ 3\ );}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ g\_sandwich\ )\ \{}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__scalable__pipelines_8cpp_a28d67ed972e7388aae4da7bffe20d7b2}{spawn}}\ (*\textcolor{keyword}{new}(\ allocate\_child()\ )\ \mbox{\hyperlink{class_fib_cilk_subtask}{FibCilkSubtask}}(\mbox{\hyperlink{struct_fib_task_a8bb077d6150c36cf25ebc53826311c29}{x}},\mbox{\hyperlink{struct_fib_task_aae95f5d1a71b3ba8f7416e9f3013dc8e}{n}}-\/1));}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__scalable__pipelines_8cpp_a28d67ed972e7388aae4da7bffe20d7b2}{spawn}}\ (*\textcolor{keyword}{new}(\ allocate\_child()\ )\ \mbox{\hyperlink{class_fib_cilk_subtask}{FibCilkSubtask}}(\mbox{\hyperlink{struct_fib_task_ae316a1e2a54bad3d1d1d79478fbf84ff}{y}},\mbox{\hyperlink{struct_fib_task_aae95f5d1a71b3ba8f7416e9f3013dc8e}{n}}-\/2));}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__scalable__pipelines_8cpp_a28d67ed972e7388aae4da7bffe20d7b2}{spawn}}\ (*\textcolor{keyword}{new}(\ allocate\_child()\ )\ \mbox{\hyperlink{struct_fib_task_a9ab1716b36ad254af188cb46322fbb3a}{FibTask}}(\mbox{\hyperlink{struct_fib_task_a8bb077d6150c36cf25ebc53826311c29}{x}},\mbox{\hyperlink{struct_fib_task_aae95f5d1a71b3ba8f7416e9f3013dc8e}{n}}-\/1));}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__scalable__pipelines_8cpp_a28d67ed972e7388aae4da7bffe20d7b2}{spawn}}\ (*\textcolor{keyword}{new}(\ allocate\_child()\ )\ \mbox{\hyperlink{struct_fib_task_a9ab1716b36ad254af188cb46322fbb3a}{FibTask}}(\mbox{\hyperlink{struct_fib_task_ae316a1e2a54bad3d1d1d79478fbf84ff}{y}},\mbox{\hyperlink{struct_fib_task_aae95f5d1a71b3ba8f7416e9f3013dc8e}{n}}-\/2));}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ wait\_for\_all();}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}*\ self1\ =\ \&task::self();}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ self0\ ==\ self1,\ \textcolor{stringliteral}{"{}failed\ to\ preserve\ TBB\ TLS"{}}\ );}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_fib_task_ae64cee85b90f507082fd9223f429e0c5}{result}}\ =\ \mbox{\hyperlink{struct_fib_task_a8bb077d6150c36cf25ebc53826311c29}{x}}+\mbox{\hyperlink{struct_fib_task_ae316a1e2a54bad3d1d1d79478fbf84ff}{y}};}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00065\ \ \ \ \ \}}
\DoxyCodeLine{00066\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00067\ \ \ \ \ \mbox{\hyperlink{struct_fib_task_a44b2ff4c70791320d333054c7c90493b}{FibTask}}(\ \textcolor{keywordtype}{int}\&\ result\_,\ \textcolor{keywordtype}{int}\ n\_\ )\ :\ \mbox{\hyperlink{struct_fib_task_ae64cee85b90f507082fd9223f429e0c5}{result}}(result\_),\ \mbox{\hyperlink{struct_fib_task_aae95f5d1a71b3ba8f7416e9f3013dc8e}{n}}(n\_)\ \{\}}
\DoxyCodeLine{00068\ \};}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{test__cilk__common_8h_ae8a58338f92a073d07a59f80d81a199f}{TBB\_Fib}}(\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ )\ \{}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}<2\ )\ \{}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}};}
\DoxyCodeLine{00073\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}};}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1task__scheduler__init}{tbb::task\_scheduler\_init}}\ \mbox{\hyperlink{boing_8c_a2858154e2009b0e6e616f313177762bc}{init}}(P\_nested);}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ tbb::task::spawn\_root\_and\_wait(*\textcolor{keyword}{new}(\ tbb::task::allocate\_root())\ \mbox{\hyperlink{struct_fib_task}{FibTask}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}},\mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}})\ );}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}};}
\DoxyCodeLine{00078\ \ \ \ \ \}}
\DoxyCodeLine{00079\ \}}

\end{DoxyCode}
