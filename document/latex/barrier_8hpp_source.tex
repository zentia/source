\doxysection{barrier.\+hpp}
\hypertarget{barrier_8hpp_source}{}\label{barrier_8hpp_source}\index{external/taskflow/3rd-\/party/ff/barrier.hpp@{external/taskflow/3rd-\/party/ff/barrier.hpp}}
\mbox{\hyperlink{barrier_8hpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*\ -\/*-\/\ Mode:\ C++;\ tab-\/width:\ 4;\ c-\/basic-\/offset:\ 4;\ indent-\/tabs-\/mode:\ nil\ -\/*-\/\ */}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#ifndef\ FF\_BARRIER\_HPP}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#define\ FF\_BARRIER\_HPP}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{comment}{/*\ ***************************************************************************}}
\DoxyCodeLine{00015\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00016\ \textcolor{comment}{\ *\ \ FastFlow\ is\ free\ software;\ you\ can\ redistribute\ it\ and/or\ modify\ it}}
\DoxyCodeLine{00017\ \textcolor{comment}{\ *\ \ under\ the\ terms\ of\ the\ GNU\ Lesser\ General\ Public\ License\ version\ 3\ as}}
\DoxyCodeLine{00018\ \textcolor{comment}{\ *\ \ published\ by\ the\ Free\ Software\ Foundation.}}
\DoxyCodeLine{00019\ \textcolor{comment}{\ *\ \ Starting\ from\ version\ 3.0.1\ FastFlow\ is\ dual\ licensed\ under\ the\ GNU\ LGPLv3}}
\DoxyCodeLine{00020\ \textcolor{comment}{\ *\ \ or\ MIT\ License\ (https://github.com/ParaGroup/WindFlow/blob/vers3.x/LICENSE.MIT)}}
\DoxyCodeLine{00021\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00022\ \textcolor{comment}{\ *\ \ This\ program\ is\ distributed\ in\ the\ hope\ that\ it\ will\ be\ useful,\ but\ WITHOUT}}
\DoxyCodeLine{00023\ \textcolor{comment}{\ *\ \ ANY\ WARRANTY;\ without\ even\ the\ implied\ warranty\ of\ MERCHANTABILITY\ or}}
\DoxyCodeLine{00024\ \textcolor{comment}{\ *\ \ FITNESS\ FOR\ A\ PARTICULAR\ PURPOSE.\ \ See\ the\ GNU\ Lesser\ General\ Public}}
\DoxyCodeLine{00025\ \textcolor{comment}{\ *\ \ License\ for\ more\ details.}}
\DoxyCodeLine{00026\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00027\ \textcolor{comment}{\ *\ \ You\ should\ have\ received\ a\ copy\ of\ the\ GNU\ Lesser\ General\ Public\ License}}
\DoxyCodeLine{00028\ \textcolor{comment}{\ *\ \ along\ with\ this\ program;\ if\ not,\ write\ to\ the\ Free\ Software\ Foundation,}}
\DoxyCodeLine{00029\ \textcolor{comment}{\ *\ \ Inc.,\ 59\ Temple\ Place\ -\/\ Suite\ 330,\ Boston,\ MA\ 02111-\/1307,\ USA.}}
\DoxyCodeLine{00030\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00031\ \textcolor{comment}{\ ****************************************************************************}}
\DoxyCodeLine{00032\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ <stdlib.h>}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{external_2taskflow_23rd-party_2ff_2platforms_2_platform_8h}{ff/platforms/platform.h}}>}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{utils_8hpp}{ff/utils.hpp}}>}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{config_8hpp}{ff/config.hpp}}>}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \textcolor{comment}{//\ }}
\DoxyCodeLine{00040\ \textcolor{comment}{//\ Inside\ FastFlow\ barriers\ are\ used\ only\ for:}}
\DoxyCodeLine{00041\ \textcolor{comment}{//\ \ \ -\/\ to\ start\ all\ nodes\ synchronously\ (just\ for\ convinience\ could\ be\ avoided)}}
\DoxyCodeLine{00042\ \textcolor{comment}{//\ \ \ -\/\ inside\ the\ ParallelFor*\ to\ implement\ the\ barrier\ at\ the\ end\ of\ each\ }}
\DoxyCodeLine{00043\ \textcolor{comment}{//\ \ \ \ \ loop\ iteration.}}
\DoxyCodeLine{00044\ \textcolor{comment}{//}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceff}{ff}}\ \{}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00055\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structff_1_1ff_barrier}{ffBarrier}}\ \{}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{structff_1_1ff_barrier_a6f4e7eaceb593a63d587735e89eff711}{\string~ffBarrier}}()\ \{\}}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \ \mbox{\hyperlink{structff_1_1ff_barrier_a0fd3cb0ebd44444dbbc13cd5a9a82f08}{barrierSetup}}(\textcolor{keywordtype}{size\_t})\ \{\ \textcolor{keywordflow}{return}\ 0;\}}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structff_1_1ff_barrier_abfa8367d0c18603b84b8820ee31520ab}{doBarrier}}(\textcolor{keywordtype}{size\_t})\ \{\ \};}
\DoxyCodeLine{00059\ \};}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \textcolor{preprocessor}{\#if\ (defined(\_\_APPLE\_\_)\ ||\ defined(\_MSC\_VER))}\textcolor{preprocessor}{\ }}
\DoxyCodeLine{00074\ \textcolor{keyword}{class\ }Barrier:\ \textcolor{keyword}{public}\ ffBarrier\ \{}
\DoxyCodeLine{00075\ \textcolor{keyword}{public}:\ \ \ }
\DoxyCodeLine{00076\ \ \ \ \ \mbox{\hyperlink{classff_1_1_barrier_a16e279cb16b7160ebe1afebb6bcb6f6d}{Barrier}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}=\mbox{\hyperlink{config_8hpp_a5747ce5beae65002b9ee2c4a4cf8c329}{MAX\_NUM\_THREADS}}):\mbox{\hyperlink{classff_1_1_barrier_adf08cb2c76bb244876b4e8be68176c7a}{\_barrier}}(0)\ \{}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{pthread__minport__windows_8h_a06769b1c0f650377fed34ef94ac2a01c}{pthread\_mutex\_init}}(\&bLock,\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})!=0)\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceff_a27d926d29b55e019eba5b70672301d82}{error}}(\textcolor{stringliteral}{"{}FATAL\ ERROR:\ Barrier:\ pthread\_mutex\_init\ fails!\(\backslash\)n"{}});}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ abort();}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{pthread__minport__windows_8h_a71bdb8a20eb782047e084c27fcf7aa65}{pthread\_cond\_init}}(\&bCond,\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})!=0)\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceff_a27d926d29b55e019eba5b70672301d82}{error}}(\textcolor{stringliteral}{"{}FATAL\ ERROR:\ Barrier:\ pthread\_cond\_init\ fails!\(\backslash\)n"{}});}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacedetail_a619f3502677571222147bfadcc64392ea5bb94a1c12413a2e5d14deabab29f2aa}{abort}}();}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00085\ \ \ \ \ \}}
\DoxyCodeLine{00086\ \ \ \ \ \ \ }
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff_1_1_barrier_a4d41f86a97aaf47562ef37b051a021f0}{barrierSetup}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{boing_8c_a2858154e2009b0e6e616f313177762bc}{init}})\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{boing_8c_a2858154e2009b0e6e616f313177762bc}{init}}>0);}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1_barrier_adf08cb2c76bb244876b4e8be68176c7a}{\_barrier}}\ ==\ \mbox{\hyperlink{boing_8c_a2858154e2009b0e6e616f313177762bc}{init}})\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_barrier_adf08cb2c76bb244876b4e8be68176c7a}{\_barrier}}\ =\ \mbox{\hyperlink{boing_8c_a2858154e2009b0e6e616f313177762bc}{init}};\ }
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{events_8c_ac6c464b0a83a481fee26175f6229c5cc}{counter}}\ =\ 0;}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00099\ \ \ \ \ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff_1_1_barrier_a42b4eab398b10c00a7dd2c44980d4b89}{doBarrier}}(\textcolor{keywordtype}{size\_t}\ \textcolor{keywordtype}{id})\ \{}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pthread__minport__windows_8h_ac24005266439bc710f8d85235c0c9213}{pthread\_mutex\_lock}}(\&bLock);}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (++\mbox{\hyperlink{events_8c_ac6c464b0a83a481fee26175f6229c5cc}{counter}}\ ==\ \mbox{\hyperlink{classff_1_1_barrier_adf08cb2c76bb244876b4e8be68176c7a}{\_barrier}})\ \{}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pthread__minport__windows_8h_a38ac5cf73f6fc412aa3c843782dd0b68}{pthread\_cond\_broadcast}}(\&bCond);}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{events_8c_ac6c464b0a83a481fee26175f6229c5cc}{counter}}\ =\ 0;}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \mbox{\hyperlink{pthread__minport__windows_8h_af9530616ca0356931235e064a7063c59}{pthread\_cond\_wait}}(\&bCond,\ \&bLock);}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pthread__minport__windows_8h_a9ebcb4bbf90f780d17be7acd63b0e92f}{pthread\_mutex\_unlock}}(\&bLock);}
\DoxyCodeLine{00109\ \ \ \ \ \}}
\DoxyCodeLine{00110\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{comment}{//\ it\ is\ the\ number\ of\ threads\ in\ the\ barrier.\ }}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classff_1_1_barrier_adf08cb2c76bb244876b4e8be68176c7a}{\_barrier}},\ \mbox{\hyperlink{events_8c_ac6c464b0a83a481fee26175f6229c5cc}{counter}};}
\DoxyCodeLine{00113\ \ \ \ \ \mbox{\hyperlink{pthread__minport__windows_8h_a572a3762cb738984c3957ba91426b08d}{pthread\_mutex\_t}}\ bLock;\ \ \textcolor{comment}{//\ Mutex\ variable}}
\DoxyCodeLine{00114\ \ \ \ \ \mbox{\hyperlink{pthread__minport__windows_8h_a9d2915aaebc50f5522abbf7687c32836}{pthread\_cond\_t}}\ \ bCond;\ \ \textcolor{comment}{//\ Condition\ variable}}
\DoxyCodeLine{00115\ \};}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \textcolor{preprocessor}{\#else}\textcolor{preprocessor}{\ }}
\DoxyCodeLine{00122\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classff_1_1_barrier_a16e279cb16b7160ebe1afebb6bcb6f6d}{Barrier}}:\ \textcolor{keyword}{public}\ \mbox{\hyperlink{structff_1_1ff_barrier}{ffBarrier}}\ \{}
\DoxyCodeLine{00123\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00124\ \ \ \ \ \mbox{\hyperlink{classff_1_1_barrier_a16e279cb16b7160ebe1afebb6bcb6f6d}{Barrier}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}=\mbox{\hyperlink{config_8hpp_a5747ce5beae65002b9ee2c4a4cf8c329}{MAX\_NUM\_THREADS}}):\mbox{\hyperlink{classff_1_1_barrier_adf08cb2c76bb244876b4e8be68176c7a}{\_barrier}}(0)\ \{\ \}}
\DoxyCodeLine{00125\ \ \ \ \ \mbox{\hyperlink{classff_1_1_barrier_a6516b2c4d25560c8c91dd4cf61f01df8}{\string~Barrier}}()\ \{\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1_barrier_adf08cb2c76bb244876b4e8be68176c7a}{\_barrier}}>0)\ pthread\_barrier\_destroy(\&\mbox{\hyperlink{classff_1_1_barrier_a8ebcc87433ae16948bb0e31a8c27bc2a}{bar}});\ \}}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff_1_1_barrier_a4d41f86a97aaf47562ef37b051a021f0}{barrierSetup}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structinit}{init}})\ \{}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{structinit}{init}}>0);}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1_barrier_adf08cb2c76bb244876b4e8be68176c7a}{\_barrier}}\ ==\ \mbox{\hyperlink{structinit}{init}})\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1_barrier_adf08cb2c76bb244876b4e8be68176c7a}{\_barrier}}==0)\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pthread\_barrier\_init(\&\mbox{\hyperlink{classff_1_1_barrier_a8ebcc87433ae16948bb0e31a8c27bc2a}{bar}},\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\mbox{\hyperlink{structinit}{init}})\ !=\ 0)\ \{}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceff_a27d926d29b55e019eba5b70672301d82}{error}}(\textcolor{stringliteral}{"{}ERROR:\ pthread\_barrier\_init\ failed\(\backslash\)n"{}});}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_barrier_adf08cb2c76bb244876b4e8be68176c7a}{\_barrier}}\ =\ \mbox{\hyperlink{structinit}{init}};}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pthread\_barrier\_destroy(\&\mbox{\hyperlink{classff_1_1_barrier_a8ebcc87433ae16948bb0e31a8c27bc2a}{bar}})\ !=\ 0)\ \{}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceff_a27d926d29b55e019eba5b70672301d82}{error}}(\textcolor{stringliteral}{"{}ERROR:\ pthread\_barrier\_destroy\ failed\(\backslash\)n"{}});}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pthread\_barrier\_init(\&\mbox{\hyperlink{classff_1_1_barrier_a8ebcc87433ae16948bb0e31a8c27bc2a}{bar}},\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\mbox{\hyperlink{structinit}{init}})\ ==\ 0)\ \{}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1_barrier_adf08cb2c76bb244876b4e8be68176c7a}{\_barrier}}\ =\ \mbox{\hyperlink{structinit}{init}};}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceff_a27d926d29b55e019eba5b70672301d82}{error}}(\textcolor{stringliteral}{"{}ERROR:\ pthread\_barrier\_init\ failed\(\backslash\)n"{}});}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00148\ \ \ \ \ \}}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff_1_1_barrier_a42b4eab398b10c00a7dd2c44980d4b89}{doBarrier}}(\textcolor{keywordtype}{size\_t})\ \{\ \ }
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ pthread\_barrier\_wait(\&\mbox{\hyperlink{classff_1_1_barrier_a8ebcc87433ae16948bb0e31a8c27bc2a}{bar}});\ }
\DoxyCodeLine{00152\ \ \ \ \ \}}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{comment}{//\ it\ is\ the\ number\ of\ threads\ in\ the\ barrier.\ }}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classff_1_1_barrier_adf08cb2c76bb244876b4e8be68176c7a}{\_barrier}};}
\DoxyCodeLine{00157\ \ \ \ \ pthread\_barrier\_t\ \mbox{\hyperlink{classff_1_1_barrier_a8ebcc87433ae16948bb0e31a8c27bc2a}{bar}};}
\DoxyCodeLine{00158\ \};}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \textcolor{preprocessor}{\#endif\ }}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00169\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classff_1_1spin_barrier_a5f985ce7f5259e543db614c638ccf1fc}{spinBarrier}}:\ \textcolor{keyword}{public}\ \mbox{\hyperlink{structff_1_1ff_barrier}{ffBarrier}}\ \{}
\DoxyCodeLine{00170\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00171\ \ \ \ }
\DoxyCodeLine{00172\ \ \ \ \ \mbox{\hyperlink{classff_1_1spin_barrier_a5f985ce7f5259e543db614c638ccf1fc}{spinBarrier}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \_maxNThreads=\mbox{\hyperlink{config_8hpp_a5747ce5beae65002b9ee2c4a4cf8c329}{MAX\_NUM\_THREADS}}):\mbox{\hyperlink{classff_1_1spin_barrier_ac869dfdb95ae2c378bcd6e00e9cb42e6}{maxNThreads}}(\_maxNThreads),\ \mbox{\hyperlink{classff_1_1spin_barrier_a0c6d24a1196445088fa0b01248ac0aea}{\_barrier}}(0)\ \{}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1spin_barrier_a3e5bfec9e89cc39b3bdd1e74207d966c}{barArray}}=\textcolor{keyword}{new}\ \textcolor{keywordtype}{bool}[\mbox{\hyperlink{classff_1_1spin_barrier_ac869dfdb95ae2c378bcd6e00e9cb42e6}{maxNThreads}}];}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{classff_1_1spin_barrier_a3e5bfec9e89cc39b3bdd1e74207d966c}{barArray}}!=\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00175\ \ \ \ \ \}}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \ \ \mbox{\hyperlink{classff_1_1spin_barrier_a061760abc0d638f4a99679c8e6c2444f}{\string~spinBarrier}}()\ \{}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1spin_barrier_a3e5bfec9e89cc39b3bdd1e74207d966c}{barArray}}\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \textcolor{keyword}{delete}\ []\ \mbox{\hyperlink{classff_1_1spin_barrier_a3e5bfec9e89cc39b3bdd1e74207d966c}{barArray}};}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1spin_barrier_a3e5bfec9e89cc39b3bdd1e74207d966c}{barArray}}=\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00180\ \ \ \ \ \}}
\DoxyCodeLine{00181\ \ \ \ \ }
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff_1_1spin_barrier_a258ac0dc6c838bad7b61546edab6385b}{barrierSetup}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structinit}{init}})\ \{}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{structinit}{init}}>0);}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structinit}{init}}\ ==\ \mbox{\hyperlink{classff_1_1spin_barrier_a0c6d24a1196445088fa0b01248ac0aea}{\_barrier}})\ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{classff_1_1spin_barrier_ac869dfdb95ae2c378bcd6e00e9cb42e6}{maxNThreads}};\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \mbox{\hyperlink{classff_1_1spin_barrier_a3e5bfec9e89cc39b3bdd1e74207d966c}{barArray}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]=\textcolor{keyword}{false};}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1spin_barrier_afb6de20b7b9d6b455c2c1d786396b0a2}{B}}[0]=0;\ \mbox{\hyperlink{classff_1_1spin_barrier_afb6de20b7b9d6b455c2c1d786396b0a2}{B}}[1]=0;}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1spin_barrier_a0c6d24a1196445088fa0b01248ac0aea}{\_barrier}}\ =\ \mbox{\hyperlink{structinit}{init}};\ }
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00189\ \ \ \ \ \}}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff_1_1spin_barrier_a10ebf400a0077b6ca269d9d1b06dbc30}{doBarrier}}(\textcolor{keywordtype}{size\_t}\ tid)\ \{}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ assert(tid<\mbox{\hyperlink{classff_1_1spin_barrier_ac869dfdb95ae2c378bcd6e00e9cb42e6}{maxNThreads}});}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ whichBar\ =\ (\mbox{\hyperlink{classff_1_1spin_barrier_a3e5bfec9e89cc39b3bdd1e74207d966c}{barArray}}[tid]\ \string^=\ \textcolor{keyword}{true});\ \textcolor{comment}{//\ computes\ \%\ 2}}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{bench_vec_add_8cpp_a41689956983587b085f9da3e48f31d99}{c}}\ =\ ++\mbox{\hyperlink{classff_1_1spin_barrier_afb6de20b7b9d6b455c2c1d786396b0a2}{B}}[whichBar];}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((\textcolor{keywordtype}{size\_t})\mbox{\hyperlink{bench_vec_add_8cpp_a41689956983587b085f9da3e48f31d99}{c}}\ ==\ \mbox{\hyperlink{classff_1_1spin_barrier_a0c6d24a1196445088fa0b01248ac0aea}{\_barrier}})\ \{}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1spin_barrier_afb6de20b7b9d6b455c2c1d786396b0a2}{B}}[whichBar]=0;}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ spin-\/wait}}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\mbox{\hyperlink{bench_vec_add_8cpp_a41689956983587b085f9da3e48f31d99}{c}})\ \{}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bench_vec_add_8cpp_a41689956983587b085f9da3e48f31d99}{c}}\ =\ \mbox{\hyperlink{classff_1_1spin_barrier_afb6de20b7b9d6b455c2c1d786396b0a2}{B}}[whichBar];}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ PAUSE();\ \ \textcolor{comment}{//\ TODO:\ define\ a\ spin\ policy\ !}}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00204\ \ \ \ \ \}\ \ \ \ }
\DoxyCodeLine{00205\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00206\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classff_1_1spin_barrier_ac869dfdb95ae2c378bcd6e00e9cb42e6}{maxNThreads}};}
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classff_1_1spin_barrier_a0c6d24a1196445088fa0b01248ac0aea}{\_barrier}};}
\DoxyCodeLine{00208\ \ \ \ \ \textcolor{keywordtype}{bool}*\ \mbox{\hyperlink{classff_1_1spin_barrier_a3e5bfec9e89cc39b3bdd1e74207d966c}{barArray}};}
\DoxyCodeLine{00209\ \ \ \ \ std::atomic<long>\ \mbox{\hyperlink{classff_1_1spin_barrier_afb6de20b7b9d6b455c2c1d786396b0a2}{B}}[2];}
\DoxyCodeLine{00210\ \};}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00213\ \textcolor{keyword}{template}<\textcolor{keywordtype}{bool}\ spin>}
\DoxyCodeLine{00214\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structff_1_1bar_helper}{barHelper}}\ \{}
\DoxyCodeLine{00215\ \ \ \ \ \mbox{\hyperlink{classff_1_1_barrier}{Barrier}}\ \mbox{\hyperlink{structff_1_1bar_helper_a2a6abdc686eb14e38ac8e1d50d2cd7ca}{bar}};}
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structff_1_1bar_helper_a06187780658b2dcb90e69d8ad177895d}{barrierSetup}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structinit}{init}})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structff_1_1bar_helper_a2a6abdc686eb14e38ac8e1d50d2cd7ca}{bar}}.barrierSetup(\mbox{\hyperlink{structinit}{init}});\ \}}
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structff_1_1bar_helper_a16792274459061b36c428e9af39a4c17}{doBarrier}}(\textcolor{keywordtype}{size\_t}\ tid)\ \ \ \ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structff_1_1bar_helper_a2a6abdc686eb14e38ac8e1d50d2cd7ca}{bar}}.doBarrier(tid);\ \}}
\DoxyCodeLine{00218\ \};}
\DoxyCodeLine{00219\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{00220\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structff_1_1bar_helper}{barHelper}}<\mbox{\hyperlink{yyjson_8h_a41f9c5fb8b08eb5dc3edce4dcb37fee7}{true}}>\ \{}
\DoxyCodeLine{00221\ \ \ \ \ \mbox{\hyperlink{classff_1_1spin_barrier}{spinBarrier}}\ \mbox{\hyperlink{structff_1_1bar_helper_3_01true_01_4_a9dab49e86fed5e753dbae0d5f1dcaf45}{bar}};}
\DoxyCodeLine{00222\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structff_1_1bar_helper_3_01true_01_4_a5498a62b53f7d2b77ef6c8e4345e393c}{barrierSetup}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{structinit}{init}})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structff_1_1bar_helper_3_01true_01_4_a9dab49e86fed5e753dbae0d5f1dcaf45}{bar}}.barrierSetup(\mbox{\hyperlink{structinit}{init}});\ \}}
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structff_1_1bar_helper_3_01true_01_4_ae2ba2e28b4e8dc24479fbe566f8582d9}{doBarrier}}(\textcolor{keywordtype}{size\_t}\ tid)\ \ \ \ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{structff_1_1bar_helper_3_01true_01_4_a9dab49e86fed5e753dbae0d5f1dcaf45}{bar}}.doBarrier(tid);\ \}}
\DoxyCodeLine{00224\ \};}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00233\ \textcolor{keyword}{template}<\textcolor{keywordtype}{bool}\ whichone>}
\DoxyCodeLine{00234\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structff_1_1barrier_selector}{barrierSelector}}:\ \textcolor{keyword}{public}\ \mbox{\hyperlink{structff_1_1bar_helper}{barHelper}}<whichone>\ \{\};}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \}\ \textcolor{comment}{//\ namespace\ ff}}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ FF\_BARRIER\_HPP\ */}\textcolor{preprocessor}{}}

\end{DoxyCode}
