\doxysection{semaphore.\+hpp}
\hypertarget{semaphore_8hpp_source}{}\label{semaphore_8hpp_source}\index{external/taskflow/taskflow/core/semaphore.hpp@{external/taskflow/taskflow/core/semaphore.hpp}}
\mbox{\hyperlink{semaphore_8hpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <mutex>}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{declarations_8hpp}{declarations.hpp}}"{}}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{small__vector_8hpp}{../utility/small\_vector.hpp}}"{}}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetf}{tf}}\ \{}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ Semaphore}}
\DoxyCodeLine{00017\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00068\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtf_1_1_semaphore_a6c5eda744df63aabf30398142a8c73c2}{Semaphore}}\ \{}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtf_1_1_semaphore_a6db9d28bd448a131448276ee03de1e6d}{Node}};}
\DoxyCodeLine{00071\ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtf_1_1_semaphore_a763b2f90bc53f92d680a635fe28e858e}{Executor}};}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00081\ \ \ \ \ \mbox{\hyperlink{classtf_1_1_semaphore_a6c5eda744df63aabf30398142a8c73c2}{Semaphore}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classtf_1_1_semaphore_a6c5eda744df63aabf30398142a8c73c2}{Semaphore}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtf_1_1_semaphore_a2871b5f5d7527c822abe871d99a482b3}{max\_value}});}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtf_1_1_semaphore_a8ba4d8f7a70fe36b883eb0ad1aa8dcd1}{value}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtf_1_1_semaphore_a2871b5f5d7527c822abe871d99a482b3}{max\_value}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_semaphore_ad0f7801055550b20b8c2ae6d6099f220}{reset}}();}
\DoxyCodeLine{00109\ \ \ \ \ }
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_semaphore_ad0f7801055550b20b8c2ae6d6099f220}{reset}}(\textcolor{keywordtype}{size\_t}\ new\_max\_value);}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keyword}{mutable}\ std::mutex\ \mbox{\hyperlink{classtf_1_1_semaphore_a329424188b5287ca596f1af3f6db58f1}{\_mtx}};}
\DoxyCodeLine{00118\ \ \ \ \ }
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtf_1_1_semaphore_a3e58194192dcfdac92d186b67c96498d}{\_max\_value}}\{0\};}
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtf_1_1_semaphore_af749214114dbfccd36adffa337eb44ca}{\_cur\_value}}\{0\};}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \mbox{\hyperlink{classtf_1_1_small_vector}{SmallVector<Node*>}}\ \mbox{\hyperlink{classtf_1_1_semaphore_a2c266637822af51b6ea77a47e35ad3fd}{\_waiters}};}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtf_1_1_semaphore_aeb12ad1db7794e13829a0a62549d157b}{\_try\_acquire\_or\_wait}}(\mbox{\hyperlink{classtf_1_1_semaphore_a6db9d28bd448a131448276ee03de1e6d}{Node}}*);}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_semaphore_a066258fab2fa8c2ee123b22f77a64ccf}{\_release}}(\mbox{\hyperlink{classtf_1_1_small_vector}{SmallVector<Node*>}}\&);}
\DoxyCodeLine{00127\ \};}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{classtf_1_1_semaphore_a6c5eda744df63aabf30398142a8c73c2}{Semaphore::Semaphore}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtf_1_1_semaphore_a2871b5f5d7527c822abe871d99a482b3}{max\_value}})\ :}
\DoxyCodeLine{00130\ \ \ \mbox{\hyperlink{classtf_1_1_semaphore_a3e58194192dcfdac92d186b67c96498d}{\_max\_value}}(\mbox{\hyperlink{classtf_1_1_semaphore_a2871b5f5d7527c822abe871d99a482b3}{max\_value}}),}
\DoxyCodeLine{00131\ \ \ \mbox{\hyperlink{classtf_1_1_semaphore_af749214114dbfccd36adffa337eb44ca}{\_cur\_value}}(\mbox{\hyperlink{classtf_1_1_semaphore_a2871b5f5d7527c822abe871d99a482b3}{max\_value}})\ \{}
\DoxyCodeLine{00132\ \}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtf_1_1_semaphore_aeb12ad1db7794e13829a0a62549d157b}{Semaphore::\_try\_acquire\_or\_wait}}(\mbox{\hyperlink{classtf_1_1_semaphore_a6db9d28bd448a131448276ee03de1e6d}{Node}}*\ me)\ \{}
\DoxyCodeLine{00135\ \ \ std::lock\_guard<std::mutex>\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\mbox{\hyperlink{classtf_1_1_semaphore_a329424188b5287ca596f1af3f6db58f1}{\_mtx}});}
\DoxyCodeLine{00136\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classtf_1_1_semaphore_af749214114dbfccd36adffa337eb44ca}{\_cur\_value}}\ >\ 0)\ \{}
\DoxyCodeLine{00137\ \ \ \ \ -\/-\/\mbox{\hyperlink{classtf_1_1_semaphore_af749214114dbfccd36adffa337eb44ca}{\_cur\_value}};}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00139\ \ \ \}}
\DoxyCodeLine{00140\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00141\ \ \ \ \ \mbox{\hyperlink{classtf_1_1_semaphore_a2c266637822af51b6ea77a47e35ad3fd}{\_waiters}}.push\_back(me);}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00143\ \ \ \}}
\DoxyCodeLine{00144\ \}}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_semaphore_a066258fab2fa8c2ee123b22f77a64ccf}{Semaphore::\_release}}(\mbox{\hyperlink{classtf_1_1_small_vector}{SmallVector<Node*>}}\&\ \mbox{\hyperlink{shortpath_8cpp_a720827d53e80d32b23f708768099d331}{dst}})\ \{}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ std::lock\_guard<std::mutex>\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\mbox{\hyperlink{classtf_1_1_semaphore_a329424188b5287ca596f1af3f6db58f1}{\_mtx}});}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classtf_1_1_semaphore_af749214114dbfccd36adffa337eb44ca}{\_cur\_value}}\ >=\ \mbox{\hyperlink{classtf_1_1_semaphore_a3e58194192dcfdac92d186b67c96498d}{\_max\_value}})\ \{}
\DoxyCodeLine{00151\ \ \ \ \ \mbox{\hyperlink{error_8hpp_aecd66f17d01de60aeb9cae992c9dd4bf}{TF\_THROW}}(\textcolor{stringliteral}{"{}can't\ release\ the\ semaphore\ more\ than\ its\ maximum\ value:\ "{}},\ \mbox{\hyperlink{classtf_1_1_semaphore_a3e58194192dcfdac92d186b67c96498d}{\_max\_value}});}
\DoxyCodeLine{00152\ \ \ \}}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ ++\mbox{\hyperlink{classtf_1_1_semaphore_af749214114dbfccd36adffa337eb44ca}{\_cur\_value}};}
\DoxyCodeLine{00155\ \ \ }
\DoxyCodeLine{00156\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{shortpath_8cpp_a720827d53e80d32b23f708768099d331}{dst}}.empty())\ \{}
\DoxyCodeLine{00157\ \ \ \ \ \mbox{\hyperlink{shortpath_8cpp_a720827d53e80d32b23f708768099d331}{dst}}.swap(\mbox{\hyperlink{classtf_1_1_semaphore_a2c266637822af51b6ea77a47e35ad3fd}{\_waiters}});}
\DoxyCodeLine{00158\ \ \ \}}
\DoxyCodeLine{00159\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00160\ \ \ \ \ \mbox{\hyperlink{shortpath_8cpp_a720827d53e80d32b23f708768099d331}{dst}}.reserve(\mbox{\hyperlink{shortpath_8cpp_a720827d53e80d32b23f708768099d331}{dst}}.size()\ +\ \mbox{\hyperlink{classtf_1_1_semaphore_a2c266637822af51b6ea77a47e35ad3fd}{\_waiters}}.size());}
\DoxyCodeLine{00161\ \ \ \ \ \mbox{\hyperlink{shortpath_8cpp_a720827d53e80d32b23f708768099d331}{dst}}.insert(\mbox{\hyperlink{shortpath_8cpp_a720827d53e80d32b23f708768099d331}{dst}}.end(),\ \mbox{\hyperlink{classtf_1_1_semaphore_a2c266637822af51b6ea77a47e35ad3fd}{\_waiters}}.begin(),\ \mbox{\hyperlink{classtf_1_1_semaphore_a2c266637822af51b6ea77a47e35ad3fd}{\_waiters}}.end());}
\DoxyCodeLine{00162\ \ \ \ \ \mbox{\hyperlink{classtf_1_1_semaphore_a2c266637822af51b6ea77a47e35ad3fd}{\_waiters}}.clear();}
\DoxyCodeLine{00163\ \ \ \}}
\DoxyCodeLine{00164\ \}}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtf_1_1_semaphore_a2871b5f5d7527c822abe871d99a482b3}{Semaphore::max\_value}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00167\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classtf_1_1_semaphore_a3e58194192dcfdac92d186b67c96498d}{\_max\_value}};\ }
\DoxyCodeLine{00168\ \}}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtf_1_1_semaphore_a8ba4d8f7a70fe36b883eb0ad1aa8dcd1}{Semaphore::value}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00171\ \ \ std::lock\_guard<std::mutex>\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\mbox{\hyperlink{classtf_1_1_semaphore_a329424188b5287ca596f1af3f6db58f1}{\_mtx}});}
\DoxyCodeLine{00172\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classtf_1_1_semaphore_af749214114dbfccd36adffa337eb44ca}{\_cur\_value}};}
\DoxyCodeLine{00173\ \}}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_semaphore_ad0f7801055550b20b8c2ae6d6099f220}{Semaphore::reset}}()\ \{}
\DoxyCodeLine{00176\ \ \ std::lock\_guard<std::mutex>\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\mbox{\hyperlink{classtf_1_1_semaphore_a329424188b5287ca596f1af3f6db58f1}{\_mtx}});}
\DoxyCodeLine{00177\ \ \ \mbox{\hyperlink{classtf_1_1_semaphore_af749214114dbfccd36adffa337eb44ca}{\_cur\_value}}\ =\ \mbox{\hyperlink{classtf_1_1_semaphore_a3e58194192dcfdac92d186b67c96498d}{\_max\_value}};}
\DoxyCodeLine{00178\ \ \ \mbox{\hyperlink{classtf_1_1_semaphore_a2c266637822af51b6ea77a47e35ad3fd}{\_waiters}}.clear();}
\DoxyCodeLine{00179\ \}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_semaphore_ad0f7801055550b20b8c2ae6d6099f220}{Semaphore::reset}}(\textcolor{keywordtype}{size\_t}\ new\_max\_value)\ \{}
\DoxyCodeLine{00182\ \ \ std::lock\_guard<std::mutex>\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\mbox{\hyperlink{classtf_1_1_semaphore_a329424188b5287ca596f1af3f6db58f1}{\_mtx}});}
\DoxyCodeLine{00183\ \ \ \mbox{\hyperlink{classtf_1_1_semaphore_af749214114dbfccd36adffa337eb44ca}{\_cur\_value}}\ =\ (\mbox{\hyperlink{classtf_1_1_semaphore_a3e58194192dcfdac92d186b67c96498d}{\_max\_value}}\ =\ new\_max\_value);}
\DoxyCodeLine{00184\ \ \ \mbox{\hyperlink{classtf_1_1_semaphore_a2c266637822af51b6ea77a47e35ad3fd}{\_waiters}}.clear();}
\DoxyCodeLine{00185\ \}}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \}\ \ \textcolor{comment}{//\ end\ of\ namespace\ tf.\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00188\ }

\end{DoxyCode}
