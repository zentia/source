\doxysection{runtime/xx\+Hash/tests/collisions 目录参考}
\hypertarget{dir_22ff950d1fb8bf0f9690866ef46d9bcc}{}\label{dir_22ff950d1fb8bf0f9690866ef46d9bcc}\index{runtime/xxHash/tests/collisions 目录参考@{runtime/xxHash/tests/collisions 目录参考}}
collisions 的目录依赖关系图
% FIG 0
\doxysubsubsection*{目录}
\begin{DoxyCompactItemize}
\item 
目录 \mbox{\hyperlink{dir_fc4c24158d639a2f3939265424b22b83}{allcodecs}}
\end{DoxyCompactItemize}
\doxysubsubsection*{文件}
\begin{DoxyCompactItemize}
\item 
文件 \mbox{\hyperlink{collisions_2hashes_8h}{hashes.\+h}}
\item 
文件 \mbox{\hyperlink{xx_hash_2tests_2collisions_2main_8c}{main.\+c}}
\item 
文件 \mbox{\hyperlink{pool_8c}{pool.\+c}}
\item 
文件 \mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h}{pool.\+h}}
\item 
文件 \mbox{\hyperlink{sort_8cc}{sort.\+cc}}
\item 
文件 \mbox{\hyperlink{sort_8hh}{sort.\+hh}}
\item 
文件 \mbox{\hyperlink{threading_8c}{threading.\+c}}
\item 
文件 \mbox{\hyperlink{threading_8h}{threading.\+h}}
\end{DoxyCompactItemize}


\doxysubsection{详细描述}
{\bfseries{collisions\+Test}} is a brute force hash analyzer which will measure a 64-\/bit hash algorithm\textquotesingle{}s collision rate by generating billions of hashes, and comparing the result to an "{}ideal"{} target.

The test requires a very large amount of memory. By default, it will generate 24 billion of 64-\/bit hashes, requiring {\bfseries{192 GB of RAM}} for their storage. The number of hashes can be modified using command {\ttfamily -\/-\/nbh=}. Be aware that testing the collision ratio of 64-\/bit hashes requires a very large amount of hashes (several billion) for meaningful measurements.

To reduce RAM usage, an optional filter can be requested, with {\ttfamily -\/-\/filter}. It reduces the nb of candidates to analyze, hence associated RAM budget. Note that the filter itself requires a lot of RAM (32 GB by default, can be modified using {\ttfamily -\/-\/filterlog=}, a too small filter will not be efficient, aim at \texorpdfstring{$\sim$}{\string~}2 bytes per hash), and reading and writing into filter cost a significant CPU budget, so this method is slower. It also doesn\textquotesingle{}t allow advanced analysis of partial bitfields, since most hashes will be discarded and not stored.

When using the filter, the RAM budget consists of the filter and a list of candidates, which will be a fraction of the original hash list. Using default settings (24 billion hashes, 32 GB filter), the number of potential candidates should be reduced to less than 2 billion, requiring \texorpdfstring{$\sim$}{\string~}14 GB for their storage. Such a result also depends on hash algorithm\textquotesingle{}s efficiency. The number of effective candidates is likely to be lower, at \texorpdfstring{$\sim$}{\string~} 1 billion, but storage must allocate an upper bound.

For the default test, the expected "{}optimal"{} collision rate for a 64-\/bit hash function is \texorpdfstring{$\sim$}{\string~}18 collisions.\hypertarget{README.md_autotoc_md458}{}\doxysubsubsubsubsection{\texorpdfstring{How to build}{How to build}}\label{README.md_autotoc_md458}

\begin{DoxyCode}{0}
\DoxyCodeLine{make}

\end{DoxyCode}


Note\+: the code is a mix of C99 and C++14, it\textquotesingle{}s not compatible with a C90-\/only compiler.\hypertarget{README.md_autotoc_md459}{}\doxysubsubsubsubsection{\texorpdfstring{Build modifier}{Build modifier}}\label{README.md_autotoc_md459}

\begin{DoxyItemize}
\item {\ttfamily SLAB5}\+: use alternative pattern generator, friendlier for weak hash algorithms
\item {\ttfamily POOL\+\_\+\+MT}\+: if {\ttfamily =0}, disable multi-\/threading code (enabled by default)
\end{DoxyItemize}\hypertarget{README.md_autotoc_md460}{}\doxysubsubsubsubsection{\texorpdfstring{How to integrate any hash in the tester}{How to integrate any hash in the tester}}\label{README.md_autotoc_md460}
The build script will compile files found in {\ttfamily ./allcodecs}. Put the source code here. This also works if the hash is a single {\ttfamily \texorpdfstring{$\ast$}{*}.h} file.

The glue happens in {\ttfamily hashes.\+h}. In this file, there are 2 sections\+:
\begin{DoxyItemize}
\item Adds the required {\ttfamily \#include "{}header.\+h"{}}, and creates a wrapper to respect the format expected by the function pointer.
\item Adds the wrapper, along with the name and an indication of the output width, to the table, at the end of {\ttfamily hashes.\+h}
\end{DoxyItemize}

Build with {\ttfamily make}. Locate your new hash with {\ttfamily ./collisions\+Test -\/h}, it should be listed.\hypertarget{README.md_autotoc_md461}{}\doxysubsubsubsubsection{\texorpdfstring{Usage}{Usage}}\label{README.md_autotoc_md461}

\begin{DoxyCode}{0}
\DoxyCodeLine{usage:\ ./collisionsTest\ [hashName]\ [opt]}
\DoxyCodeLine{}
\DoxyCodeLine{list\ of\ hashNames:\ (...)}
\DoxyCodeLine{}
\DoxyCodeLine{Optional\ parameters:}
\DoxyCodeLine{\ \ -\/-\/nbh=NB\ \ \ \ \ \ \ Select\ nb\ of\ hashes\ to\ generate\ (25769803776\ by\ default)}
\DoxyCodeLine{\ \ -\/-\/filter\ \ \ \ \ \ \ Enable\ the\ filter.\ Slower,\ but\ reduces\ memory\ usage\ for\ same\ nb\ of\ hashes.}
\DoxyCodeLine{\ \ -\/-\/threadlog=NB\ Use\ 2\string^NB\ threads}
\DoxyCodeLine{\ \ -\/-\/len=NB\ \ \ \ \ \ \ Select\ length\ of\ input\ (255\ bytes\ by\ default)}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md462}{}\doxysubsubsubsubsection{\texorpdfstring{Some advises on how to setup a collisions test}{Some advises on how to setup a collisions test}}\label{README.md_autotoc_md462}
Most tests are primarily driven by the amount of RAM available. Here\textquotesingle{}s a method to decide the size of the test.

Presuming that RAM budget is not plentiful, for this example 32 GB, the {\ttfamily -\/-\/filter} mode is actually compulsory to measure anything meaningful. Let\textquotesingle{}s plan 50\% of memory for the filter, that\textquotesingle{}s 16 GB. This will be good enough to filter about 10\% less hashes than this size. Let\textquotesingle{}s round down to 14 G.

By requesting 14G, the expectation is that the program will automatically size the filter to 16 GB, and expect to store \texorpdfstring{$\sim$}{\string~}1G candidates, leaving enough room to breeze for the system.

The command line becomes\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{./collisionsTest\ -\/-\/nbh=14G\ -\/-\/filter\ NameOfHash}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md463}{}\doxysubsubsubsubsection{\texorpdfstring{Examples\+:}{Examples\+:}}\label{README.md_autotoc_md463}
Here are a few results produced with this tester\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{6}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Algorithm   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Input Len   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nb Hashes   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Expected   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nb Collisions   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Notes    }\\\cline{1-6}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Algorithm   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Input Len   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nb Hashes   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Expected   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nb Collisions   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Notes    }\\\cline{1-6}
\endhead
{\bfseries{XXH3}}   &255   &100 Gi   &312.\+5   &326   &\\\cline{1-6}
{\bfseries{XXH64}}   &255   &100 Gi   &312.\+5   &294   &\\\cline{1-6}
{\bfseries{XXH128}} low64   &512   &100 Gi   &312.\+5   &321   &\\\cline{1-6}
{\bfseries{XXH128}} high64   &512   &100 Gi   &312.\+5   &325   &\\\cline{1-6}
{\bfseries{XXH128}}   &255   &100 Gi   &0.\+0   &0   &a 128-\/bit hash is expected to generate 0 collisions   \\\cline{1-6}
\end{longtabu}


\doxylink{class_test}{Test} on small inputs\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{6}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Algorithm   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Input Len   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nb Hashes   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Expected   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nb Collisions   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Notes    }\\\cline{1-6}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Algorithm   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Input Len   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nb Hashes   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Expected   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Nb Collisions   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Notes    }\\\cline{1-6}
\endhead
{\bfseries{XXH64}}   &8   &100 Gi   &312.\+5   &{\bfseries{0}}   &{\ttfamily XXH64} is bijective for {\ttfamily len==8}    \\\cline{1-6}
{\bfseries{XXH3}}   &8   &100 Gi   &312.\+5   &{\bfseries{0}}   &{\ttfamily XXH3} is also bijective for {\ttfamily len==8}    \\\cline{1-6}
{\bfseries{XXH3}}   &16   &100 Gi   &312.\+5   &332   &\\\cline{1-6}
{\bfseries{XXH3}}   &32   &14 Gi   &6.\+1   &3   &\\\cline{1-6}
{\bfseries{XXH128}}   &16   &25 Gi   &0.\+0   &0   &test range 9-\/16    \\\cline{1-6}
{\bfseries{XXH128}}   &32   &25 Gi   &0.\+0   &0   &test range 17-\/128    \\\cline{1-6}
{\bfseries{XXH128}}   &100   &13 Gi   &0.\+0   &0   &test range 17-\/128    \\\cline{1-6}
{\bfseries{XXH128}}   &200   &13 Gi   &0.\+0   &0   &test range 129-\/240   \\\cline{1-6}
\end{longtabu}
