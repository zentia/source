\doxysection{prim.\+c}
\hypertarget{prim_8c_source}{}\label{prim_8c_source}\index{runtime/EASTL/packages/mimalloc/src/prim/prim.c@{runtime/EASTL/packages/mimalloc/src/prim/prim.c}}
\mbox{\hyperlink{prim_8c}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00002\ \textcolor{comment}{Copyright\ (c)\ 2018-\/2023,\ Microsoft\ Research,\ Daan\ Leijen}}
\DoxyCodeLine{00003\ \textcolor{comment}{This\ is\ free\ software;\ you\ can\ redistribute\ it\ and/or\ modify\ it\ under\ the}}
\DoxyCodeLine{00004\ \textcolor{comment}{terms\ of\ the\ MIT\ license.\ A\ copy\ of\ the\ license\ can\ be\ found\ in\ the\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{"{}LICENSE"{}\ at\ the\ root\ of\ this\ distribution.}}
\DoxyCodeLine{00006\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{comment}{//\ Select\ the\ implementation\ of\ the\ primitives}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ depending\ on\ the\ OS.}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#if\ defined(\_WIN32)}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{windows_2prim_8c}{windows/prim.c}}"{}}\ \ \textcolor{comment}{//\ VirtualAlloc\ (Windows)}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#elif\ defined(\_\_APPLE\_\_)}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{osx_2prim_8c}{osx/prim.c}}"{}}\ \ \ \ \ \ \textcolor{comment}{//\ macOSX\ (actually\ defers\ to\ mmap\ in\ unix/prim.c)}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#elif\ defined(\_\_wasi\_\_)}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#define\ MI\_USE\_SBRK}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{wasi_2prim_8c}{wasi/prim.c}}"{}}\ \ \ \ \ \textcolor{comment}{//\ memory-\/grow\ or\ sbrk\ (Wasm)}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#elif\ defined(\_\_EMSCRIPTEN\_\_)}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{emscripten_2prim_8c}{emscripten/prim.c}}"{}}\ \textcolor{comment}{//\ emmalloc\_*,\ +\ pthread\ support}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{unix_2prim_8c}{unix/prim.c}}"{}}\ \ \ \ \ \textcolor{comment}{//\ mmap()\ (Linux,\ macOSX,\ BSD,\ Illumnos,\ Haiku,\ DragonFly,\ etc.)}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \textcolor{comment}{//\ Generic\ process\ initialization}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#ifndef\ MI\_PRIM\_HAS\_PROCESS\_ATTACH}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#if\ defined(\_\_GNUC\_\_)\ ||\ defined(\_\_clang\_\_)}}
\DoxyCodeLine{00032\ \ \ \textcolor{comment}{//\ gcc,clang:\ use\ the\ constructor/destructor\ attribute}}
\DoxyCodeLine{00033\ \ \ \textcolor{comment}{//\ which\ for\ both\ seem\ to\ run\ before\ regular\ constructors/destructors}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\ \ \#if\ defined(\_\_clang\_\_)}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\ \ \ \ \#define\ mi\_attr\_constructor\ \_\_attribute\_\_((constructor(101)))}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\ \ \ \ \#define\ mi\_attr\_destructor\ \ \_\_attribute\_\_((destructor(101)))}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\ \ \ \ \#define\ mi\_attr\_constructor\ \_\_attribute\_\_((constructor))}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\ \ \ \ \#define\ mi\_attr\_destructor\ \ \_\_attribute\_\_((destructor))}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00041\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ mi\_attr\_constructor\ mi\_process\_attach(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00042\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a482a417323e1329ddf36dae4417a710a}{\_mi\_process\_load}}();}
\DoxyCodeLine{00043\ \ \ \}}
\DoxyCodeLine{00044\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ mi\_attr\_destructor\ mi\_process\_detach(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00045\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a9c16ccb2903fdc96b751be27a3026b85}{\_mi\_process\_done}}();}
\DoxyCodeLine{00046\ \ \ \}}
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\#elif\ defined(\_\_cplusplus)}}
\DoxyCodeLine{00048\ \ \ \textcolor{comment}{//\ C++:\ use\ static\ initialization\ to\ detect\ process\ start/end}}
\DoxyCodeLine{00049\ \ \ \textcolor{comment}{//\ This\ is\ not\ guaranteed\ to\ be\ first/last\ but\ the\ best\ we\ can\ generally\ do?}}
\DoxyCodeLine{00050\ \ \ \textcolor{keyword}{struct\ }mi\_init\_done\_t\ \{}
\DoxyCodeLine{00051\ \ \ \ \ mi\_init\_done\_t()\ \{}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a482a417323e1329ddf36dae4417a710a}{\_mi\_process\_load}}();}
\DoxyCodeLine{00053\ \ \ \ \ \}}
\DoxyCodeLine{00054\ \ \ \ \ \string~mi\_init\_done\_t()\ \{}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a9c16ccb2903fdc96b751be27a3026b85}{\_mi\_process\_done}}();}
\DoxyCodeLine{00056\ \ \ \ \ \}}
\DoxyCodeLine{00057\ \ \ \};}
\DoxyCodeLine{00058\ \ \ \textcolor{keyword}{static}\ mi\_init\_done\_t\ mi\_init\_done;}
\DoxyCodeLine{00059\ \textcolor{preprocessor}{\ \#else}}
\DoxyCodeLine{00060\ \textcolor{preprocessor}{\ \ \#pragma\ message("{}define\ a\ way\ to\ call\ \_mi\_process\_load/done\ on\ your\ platform"{})}}
\DoxyCodeLine{00061\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00062\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \textcolor{comment}{//\ Generic\ allocator\ init/done\ callback\ }}
\DoxyCodeLine{00065\ \textcolor{preprocessor}{\#ifndef\ MI\_PRIM\_HAS\_ALLOCATOR\_INIT}}
\DoxyCodeLine{00066\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{prim_8c_a5ba84f92c517c2064f1a27291e805cde}{\_mi\_is\_redirected}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00067\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00068\ \}}
\DoxyCodeLine{00069\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{prim_8c_ae337a54314cd4e9d1732d1f5b0d793d8}{\_mi\_allocator\_init}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}**\ message)\ \{}
\DoxyCodeLine{00070\ \ \ \textcolor{keywordflow}{if}\ (message\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\ *message\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};\ \}}
\DoxyCodeLine{00071\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00072\ \}}
\DoxyCodeLine{00073\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{prim_8c_a7e136e91a5d610c8d4b0beb0e6c4b47b}{\_mi\_allocator\_done}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00074\ \ \ \textcolor{comment}{//\ nothing\ to\ do}}
\DoxyCodeLine{00075\ \}}
\DoxyCodeLine{00076\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
