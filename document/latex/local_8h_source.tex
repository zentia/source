\doxysection{local.\+h}
\hypertarget{local_8h_source}{}\label{local_8h_source}\index{runtime/dsl/local.h@{runtime/dsl/local.h}}
\mbox{\hyperlink{local_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{var_8h}{runtime/dsl/var.h}}>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{operators_8h}{runtime/dsl/operators.h}}>}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceluisa_1_1compute}{luisa::compute}}\ \{}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceluisa_1_1compute_1_1detail}{detail}}\ \{}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \mbox{\hyperlink{dll__export_8h_a0f23f409f57fcf93535a1f02ca7586b9}{LC\_DSL\_API}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceluisa_1_1compute_1_1detail_aaa862e1e7307b47d6b37b868a60a9e4a}{local\_array\_error\_sizes\_missmatch}}(\textcolor{keywordtype}{size\_t}\ lhs,\ \textcolor{keywordtype}{size\_t}\ rhs)\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00013\ [[nodiscard]]\ \textcolor{keyword}{inline}\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{namespaceluisa_1_1compute_1_1detail_a36651bf6c7f7e083849f95c21f3c763f}{local\_array\_choose\_type}}(\textcolor{keywordtype}{size\_t}\ n)\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00014\ \ \ \ \ \textcolor{keyword}{auto}\ elem\ =\ Type::of<T>();}
\DoxyCodeLine{00015\ \ \ \ \ \textcolor{keywordflow}{if}\ (n\ <=\ 1u)\ \{\ \textcolor{keywordflow}{return}\ elem;\ \}}
\DoxyCodeLine{00016\ \ \ \ \ \textcolor{keywordflow}{return}\ elem-\/>is\_scalar()\ \&\&\ n\ <=\ 4u\ ?}
\DoxyCodeLine{00017\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Type::vector(elem,\ n)\ :}
\DoxyCodeLine{00018\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Type::array(elem,\ n);}
\DoxyCodeLine{00019\ \}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \}\textcolor{comment}{//\ namespace\ detail}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00024\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classluisa_1_1compute_1_1_local_a4803e96db71521cbdad853a3cfc5bc53}{Local}}\ \{}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_ref_expr}{RefExpr}}\ *\mbox{\hyperlink{classluisa_1_1compute_1_1_local_a6859ee357dbfa4b6c81dae069d7144dc}{\_expression}};}
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_a1810f85937ecfeb172208132861376bf}{\_size}};}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_a4803e96db71521cbdad853a3cfc5bc53}{Local}}(\textcolor{keywordtype}{size\_t}\ n)\ noexcept}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_a6859ee357dbfa4b6c81dae069d7144dc}{\_expression}}\{\mbox{\hyperlink{classluisa_1_1compute_1_1detail_1_1_function_builder_a4590ef89abb9497192eb36510caf0384}{detail::FunctionBuilder::current}}()-\/>local(}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceluisa_1_1compute_1_1detail_a36651bf6c7f7e083849f95c21f3c763f}{detail::local\_array\_choose\_type<T>}}(n))\},}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \ \ \_size\{n\}\ \{\}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_a93b2a9a7b30fa1ed765867702b824c08}{Local}}(\mbox{\hyperlink{classluisa_1_1compute_1_1_local_a4803e96db71521cbdad853a3cfc5bc53}{Local}}\ \&\&)\ noexcept\ =\ \mbox{\hyperlink{sugar_8h_a6face89e97cccad5464dd9bb9c7efd23}{default}};}
\DoxyCodeLine{00037\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_a4803e96db71521cbdad853a3cfc5bc53}{Local}}(const\ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_a4803e96db71521cbdad853a3cfc5bc53}{Local}}\ \&another)\ noexcept}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_a1810f85937ecfeb172208132861376bf}{\_size}}\{another.\_size\}\ \{}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ fb\ =\ \mbox{\hyperlink{classluisa_1_1compute_1_1detail_1_1_function_builder_a4590ef89abb9497192eb36510caf0384}{detail::FunctionBuilder::current}}();}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \_expression\ =\ fb-\/>local(\mbox{\hyperlink{namespaceluisa_1_1compute_1_1detail_a36651bf6c7f7e083849f95c21f3c763f}{detail::local\_array\_choose\_type<T>}}(\_size));}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ fb-\/>assign(\_expression,\ another.\_expression);}
\DoxyCodeLine{00042\ \ \ \ \ \}}
\DoxyCodeLine{00043\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_a4803e96db71521cbdad853a3cfc5bc53}{Local}}\ \&\mbox{\hyperlink{classluisa_1_1compute_1_1_local_adef23e0e21a90e115e9c2cfc92d0896b}{operator=}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_a4803e96db71521cbdad853a3cfc5bc53}{Local}}\ \&rhs)\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::addressof(rhs)\ !=\ \textcolor{keyword}{this})\ [[likely]]\ \{}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classluisa_1_1compute_1_1_local_a1810f85937ecfeb172208132861376bf}{\_size}}\ !=\ rhs.\_size)\ [[unlikely]]\ \{}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceluisa_1_1compute_1_1detail_aaa862e1e7307b47d6b37b868a60a9e4a}{detail::local\_array\_error\_sizes\_missmatch}}(\mbox{\hyperlink{classluisa_1_1compute_1_1_local_a1810f85937ecfeb172208132861376bf}{\_size}},\ rhs.\_size);}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1detail_1_1_function_builder_a4590ef89abb9497192eb36510caf0384}{detail::FunctionBuilder::current}}()-\/>assign(}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_a6859ee357dbfa4b6c81dae069d7144dc}{\_expression}},\ rhs.\_expression);}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00052\ \ \ \ \ \}}
\DoxyCodeLine{00053\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_a4803e96db71521cbdad853a3cfc5bc53}{Local}}\ \&\mbox{\hyperlink{classluisa_1_1compute_1_1_local_aac3aae636f185ab951dad57de20269b8}{operator=}}(\mbox{\hyperlink{classluisa_1_1compute_1_1_local_a4803e96db71521cbdad853a3cfc5bc53}{Local}}\ \&\&rhs)\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ *\textcolor{keyword}{this}\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{classluisa_1_1compute_1_1_local_a4803e96db71521cbdad853a3cfc5bc53}{Local}}\ \&\textcolor{keyword}{>}(rhs);}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00056\ \ \ \ \ \}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_a03a5f731601a036ce24fd1aa3e95330b}{expression}}()\ const\ noexcept\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_a6859ee357dbfa4b6c81dae069d7144dc}{\_expression}};\ \}}
\DoxyCodeLine{00059\ \ \ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_a4497bce4e1fdb96d7aa843bca6e6ea64}{size}}()\ const\ noexcept\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_a1810f85937ecfeb172208132861376bf}{\_size}};\ \}}
\DoxyCodeLine{00060\ \ \ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_a8b822572bcee9ef79a88a787f4ddd8dc}{type}}()\ const\ noexcept\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_a6859ee357dbfa4b6c81dae069d7144dc}{\_expression}}-\/>type();\ \}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ U>}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \textcolor{keyword}{requires}\ \mbox{\hyperlink{namespaceluisa_1_1compute_a2e4127befb5af9644bdabcf03206d9a0}{is\_integral\_expr\_v<U>}}}
\DoxyCodeLine{00064\ \ \ \ \ [[nodiscard]]\ \mbox{\hyperlink{structluisa_1_1compute_1_1_var}{Var<T>}}\ \&\mbox{\hyperlink{classluisa_1_1compute_1_1_local_a37217fefa37d1476eb69fc5dd0705d2b}{operator[]}}(U\ \&\&\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}})\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ f\ =\ \mbox{\hyperlink{classluisa_1_1compute_1_1detail_1_1_function_builder_a4590ef89abb9497192eb36510caf0384}{detail::FunctionBuilder::current}}();}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classluisa_1_1compute_1_1_local_a1810f85937ecfeb172208132861376bf}{\_size}}\ ==\ 1u)\ \{\ \textcolor{keywordflow}{return}\ *f-\/>create\_temporary<\mbox{\hyperlink{structluisa_1_1compute_1_1_var}{Var<T>}}>(\mbox{\hyperlink{classluisa_1_1compute_1_1_local_a6859ee357dbfa4b6c81dae069d7144dc}{\_expression}});\ \}}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ i\ =\ \mbox{\hyperlink{namespaceluisa_1_1compute_1_1dsl_ac6894281f79600b83c401fbf77ec3727}{def}}(std::forward<U>(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}}));}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ expr\ =\ f-\/>access(}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ Type::of<T>(),\ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_a6859ee357dbfa4b6c81dae069d7144dc}{\_expression}},\ i.expression());}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *f-\/>create\_temporary<\mbox{\hyperlink{structluisa_1_1compute_1_1_var}{Var<T>}}>(expr);}
\DoxyCodeLine{00071\ \ \ \ \ \}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ I>}
\DoxyCodeLine{00074\ \ \ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_aad8bfcfa782a91514151ae02377b18b1}{read}}(I\ \&\&\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}})\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{\ \textcolor{keywordflow}{return}\ (*\textcolor{keyword}{this})[std::forward<I>(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}})];\ \}}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ I,\ \textcolor{keyword}{typename}\ U>}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_a0c23fdcf2a45a122f59ae02148ccbe10}{write}}(I\ \&\&i,\ U\ \&\&u)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{\ (*this)[std::forward<I>(i)]\ =\ std::forward<U>(u);\ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{comment}{//\ for\ autodiff;\ see\ definitions\ in\ dsl/builtin.h}}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceluisa_1_1compute_1_1dsl_a1a59055bd562a59e0a80e87665f6b72c}{requires\_grad}}()\ const\ noexcept;}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceluisa_1_1compute_1_1dsl_aac8853a85ca20918de04718a0fe569e2}{backward}}()\ const\ noexcept;}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceluisa_1_1compute_1_1dsl_aac8853a85ca20918de04718a0fe569e2}{backward}}(const\ \mbox{\hyperlink{classluisa_1_1compute_1_1_local}{Local}}<T>\ \&\mbox{\hyperlink{namespaceluisa_1_1compute_1_1dsl_afae738b2d54294e10b8e8df781fae19b}{grad}})\ const\ noexcept;}
\DoxyCodeLine{00083\ \ \ \ \ [[nodiscard]]\ \mbox{\hyperlink{classluisa_1_1compute_1_1_local}{Local}}<T>\ \mbox{\hyperlink{namespaceluisa_1_1compute_1_1dsl_afae738b2d54294e10b8e8df781fae19b}{grad}}()\ const\ noexcept;}
\DoxyCodeLine{00084\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_local}{Local}}<T>\ \mbox{\hyperlink{namespaceluisa_1_1compute_1_1dsl_abe597f8706042b9c112b931894e36099}{detach}}()\ const\ noexcept;}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \ \ [[nodiscard]]\ auto\ \mbox{\hyperlink{classluisa_1_1compute_1_1_local_a508778754db3b19a06be1ea5fcc719ba}{address}}()\ const\ noexcept\ \{}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespaceluisa_1_1compute_1_1dsl_ac6894281f79600b83c401fbf77ec3727}{def<uint64\_t>}}(\mbox{\hyperlink{classluisa_1_1compute_1_1detail_1_1_function_builder_a4590ef89abb9497192eb36510caf0384}{detail::FunctionBuilder::current}}()-\/>call(}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ Type::of<uint64\_t>(),\ \mbox{\hyperlink{namespaceluisa_1_1compute_ae06d2d95c37a4a56e1f650b9fabe3167a3f7548eddd59b4f15424b30933eb3cb2}{CallOp::ADDRESS\_OF}},\ \{\mbox{\hyperlink{classluisa_1_1compute_1_1_local_a6859ee357dbfa4b6c81dae069d7144dc}{\_expression}}\}));}
\DoxyCodeLine{00089\ \ \ \ \ \}}
\DoxyCodeLine{00090\ \};}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \}\textcolor{comment}{//\ namespace\ luisa::compute}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \textcolor{comment}{//\ disable\ address-\/of\ operators}}
\DoxyCodeLine{00095\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00096\ [[nodiscard]]\ inline\ ::luisa::compute::Local<T>\ *\mbox{\hyperlink{local_8h_aebeef78111814622edb7dd617a0c0426}{operator\&}}(::luisa::compute::Local<T>\ \&)\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keyword}{static\_assert}(::luisa::always\_false\_v<T>,}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{operators_8h_af66a2435321b88ca0089b72b34e3f686}{LUISA\_DISABLE\_DSL\_ADDRESS\_OF\_MESSAGE}});}
\DoxyCodeLine{00099\ \ \ \ \ std::abort();}
\DoxyCodeLine{00100\ \}}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00103\ [[nodiscard]]\ \textcolor{keyword}{inline}\ const\ ::luisa::compute::Local<T>\ *\mbox{\hyperlink{local_8h_aebeef78111814622edb7dd617a0c0426}{operator\&}}(const\ ::luisa::compute::Local<T>\ \&)\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{keyword}{static\_assert}(::luisa::always\_false\_v<T>,}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{operators_8h_af66a2435321b88ca0089b72b34e3f686}{LUISA\_DISABLE\_DSL\_ADDRESS\_OF\_MESSAGE}});}
\DoxyCodeLine{00106\ \ \ \ \ std::abort();}
\DoxyCodeLine{00107\ \}}

\end{DoxyCode}
