\doxysection{page-\/map.c}
\hypertarget{page-map_8c_source}{}\label{page-map_8c_source}\index{runtime/EASTL/packages/mimalloc/src/page-\/map.c@{runtime/EASTL/packages/mimalloc/src/page-\/map.c}}
\mbox{\hyperlink{page-map_8c}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00002\ \textcolor{comment}{Copyright\ (c)\ 2023-\/2024,\ Microsoft\ Research,\ Daan\ Leijen}}
\DoxyCodeLine{00003\ \textcolor{comment}{This\ is\ free\ software;\ you\ can\ redistribute\ it\ and/or\ modify\ it\ under\ the}}
\DoxyCodeLine{00004\ \textcolor{comment}{terms\ of\ the\ MIT\ license.\ A\ copy\ of\ the\ license\ can\ be\ found\ in\ the\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{"{}LICENSE"{}\ at\ the\ root\ of\ this\ distribution.}}
\DoxyCodeLine{00006\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mimalloc_8h}{mimalloc.h}}"{}}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h}{mimalloc/internal.h}}"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bitmap_8h}{bitmap.h}}"{}}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#if\ MI\_PAGE\_MAP\_FLAT\ }}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{comment}{//\ The\ page-\/map\ contains\ a\ byte\ for\ each\ 64kb\ slice\ in\ the\ address\ space.}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ For\ an\ address\ \`{}a`\ where\ \`{}ofs\ =\ \_mi\_page\_map[a\ >>\ 16]`:}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ 0\ =\ unused}}
\DoxyCodeLine{00017\ \textcolor{comment}{//\ 1\ =\ the\ slice\ at\ \`{}a\ \&\ \string~0xFFFF`\ is\ a\ mimalloc\ page.}}
\DoxyCodeLine{00018\ \textcolor{comment}{//\ 1\ <\ ofs\ <=\ 127\ =\ the\ slice\ is\ part\ of\ a\ page,\ starting\ at\ \`{}(((a>>16)\ -\/\ ofs\ -\/\ 1)\ <<\ 16)`.}}
\DoxyCodeLine{00019\ \textcolor{comment}{//}}
\DoxyCodeLine{00020\ \textcolor{comment}{//\ 1\ byte\ per\ slice\ =>\ 1\ TiB\ address\ space\ needs\ a\ 2\string^14\ *\ 2\string^16\ =\ 16\ MiB\ page\ map.}}
\DoxyCodeLine{00021\ \textcolor{comment}{//\ A\ full\ 256\ TiB\ address\ space\ (48\ bit)\ needs\ a\ 4\ GiB\ page\ map.}}
\DoxyCodeLine{00022\ \textcolor{comment}{//\ A\ full\ 4\ GiB\ address\ space\ (32\ bit)\ needs\ only\ a\ 64\ KiB\ page\ map.}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a20085eb7375f2a033238c2456b23e8b8}{mi\_decl\_cache\_align}}\ \mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00025\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}*\ \ \ \ \ \ \ \ \mbox{\hyperlink{page-map_8c_a5b04a3067e57da999dd20ce9bcea47c0}{mi\_page\_map\_max\_address}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00026\ \textcolor{keyword}{static}\ \mbox{\hyperlink{types_8h_a56a2cb6eed720cdd1fa4b9907c44d7d0}{mi\_memid\_t}}\ \ \ \mbox{\hyperlink{page-map_8c_a114816cbb8983dca0f6aae70cf14f366}{mi\_page\_map\_memid}};}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#define\ MI\_PAGE\_MAP\_ENTRIES\_PER\_COMMIT\_BIT\ \ \ MI\_ARENA\_SLICE\_SIZE}}
\DoxyCodeLine{00029\ \textcolor{keyword}{static}\ \mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ mi\_page\_map\_commit;\ \textcolor{comment}{//\ one\ bit\ per\ committed\ 64\ KiB\ entries}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{page-map_8c_ad88a09e9e1318e625ef9763489cd5789}{mi\_page\_map\_ensure\_committed}}(\textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ slice\_count);}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab1d5d43c1d7d0d4adfd96fdb7270ca4b}{\_mi\_page\_map\_init}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00034\ \ \ \textcolor{keywordtype}{size\_t}\ vbits\ =\ (size\_t)\mbox{\hyperlink{group__options_ga96ad9c406338bd314cfe878cfc9bf723}{mi\_option\_get\_clamp}}(\mbox{\hyperlink{mimalloc_8h_acf0af9f50d2fca76b4e158d611bc930baabf8c9793d421ce28361b6d93c432de9}{mi\_option\_max\_vabits}},\ 0,\ \mbox{\hyperlink{bits_8h_a23f1b7ccb5e7a348f2bd0abaf2664d0d}{MI\_SIZE\_BITS}});}
\DoxyCodeLine{00035\ \ \ \textcolor{keywordflow}{if}\ (vbits\ ==\ 0)\ \{}
\DoxyCodeLine{00036\ \ \ \ \ vbits\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a3625eaddd0c4f3dfeabb056283f70737}{\_mi\_os\_virtual\_address\_bits}}();}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\ \ \ \ \#if\ MI\_ARCH\_X64\ \ }\textcolor{comment}{//\ canonical\ address\ is\ limited\ to\ the\ first\ 128\ TiB}}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keywordflow}{if}\ (vbits\ >=\ 48)\ \{\ vbits\ =\ 47;\ \}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{00040\ \ \ \}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \textcolor{comment}{//\ Allocate\ the\ page\ map\ and\ commit\ bits}}
\DoxyCodeLine{00043\ \ \ \mbox{\hyperlink{page-map_8c_a5b04a3067e57da999dd20ce9bcea47c0}{mi\_page\_map\_max\_address}}\ =\ (\textcolor{keywordtype}{void}*)(vbits\ >=\ \mbox{\hyperlink{bits_8h_a23f1b7ccb5e7a348f2bd0abaf2664d0d}{MI\_SIZE\_BITS}}\ ?\ (SIZE\_MAX\ -\/\ \mbox{\hyperlink{types_8h_a6ed338e789aacda04b6656865139ebc2}{MI\_ARENA\_SLICE\_SIZE}}\ +\ 1)\ :\ (\mbox{\hyperlink{bits_8h_a793788c5805d17b5f292a93d381fb36e}{MI\_PU}}(1)\ <<\ vbits));}
\DoxyCodeLine{00044\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ page\_map\_size\ =\ (\mbox{\hyperlink{bits_8h_aacc53767e41c111dfc833ad94ebfccf6}{MI\_ZU}}(1)\ <<\ (vbits\ -\/\ \mbox{\hyperlink{types_8h_a879fd12500ec3414abeb337e9accbc5b}{MI\_ARENA\_SLICE\_SHIFT}}));}
\DoxyCodeLine{00045\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespaceluisa_1_1compute_acc76090eea346a8113c9db08f08880c7}{commit}}\ =\ (page\_map\_size\ <=\ 1*\mbox{\hyperlink{bits_8h_a2957d2f636a8bafeb4873446283d10bf}{MI\_MiB}}\ ||\ \mbox{\hyperlink{group__options_ga459ad98f18b3fc9275474807fe0ca188}{mi\_option\_is\_enabled}}(\mbox{\hyperlink{mimalloc_8h_acf0af9f50d2fca76b4e158d611bc930baa88f56e3bccce85542dc2b3297024236}{mi\_option\_pagemap\_commit}}));\ \textcolor{comment}{//\ \_mi\_os\_has\_overcommit();\ //\ commit\ on-\/access\ on\ Linux\ systems?}}
\DoxyCodeLine{00046\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ commit\_bits\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a693e5b64e9a4644c716974dda2395edc}{\_mi\_divide\_up}}(page\_map\_size,\ MI\_PAGE\_MAP\_ENTRIES\_PER\_COMMIT\_BIT);}
\DoxyCodeLine{00047\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ bitmap\_size\ =\ (\mbox{\hyperlink{namespaceluisa_1_1compute_acc76090eea346a8113c9db08f08880c7}{commit}}\ ?\ 0\ :\ \mbox{\hyperlink{bitmap_8c_ae5c77a2da37b33891902c131fbe5fac2}{mi\_bitmap\_size}}(commit\_bits,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}));}
\DoxyCodeLine{00048\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ reserve\_size\ =\ bitmap\_size\ +\ page\_map\_size;}
\DoxyCodeLine{00049\ \ \ \mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacegenerate__swizzles_a33071bf5d2c3f89ecf3c8ffc45fbac64}{base}}\ =\ (\mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*)\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_afce7c8636aa29141d98edb847cd6f859}{\_mi\_os\_alloc\_aligned}}(reserve\_size,\ 1,\ commit,\ \textcolor{keyword}{true}\ \textcolor{comment}{/*\ allow\ large\ */},\ \&\mbox{\hyperlink{page-map_8c_a114816cbb8983dca0f6aae70cf14f366}{mi\_page\_map\_memid}});}
\DoxyCodeLine{00050\ \ \ \textcolor{keywordflow}{if}\ (base==\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00051\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a2bebc073bcaac71658e57bb260c2e426}{\_mi\_error\_message}}(\mbox{\hyperlink{types_8h_a6a05c923dad0c1208043e9c20a58c8e5}{ENOMEM}},\ \textcolor{stringliteral}{"{}unable\ to\ reserve\ virtual\ memory\ for\ the\ page\ map\ (\%zu\ KiB)\(\backslash\)n"{}},\ page\_map\_size\ /\ \mbox{\hyperlink{bits_8h_adbafbf7fe5512b55fb47ea52426a2b63}{MI\_KiB}});}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00053\ \ \ \}}
\DoxyCodeLine{00054\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{page-map_8c_a114816cbb8983dca0f6aae70cf14f366}{mi\_page\_map\_memid}}.initially\_committed\ \&\&\ !\mbox{\hyperlink{page-map_8c_a114816cbb8983dca0f6aae70cf14f366}{mi\_page\_map\_memid}}.initially\_zero)\ \{}
\DoxyCodeLine{00055\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac253cac2ca24fb63be7f4937ac620dc4}{\_mi\_warning\_message}}(\textcolor{stringliteral}{"{}internal:\ the\ page\ map\ was\ committed\ but\ not\ zero\ initialized!\(\backslash\)n"{}});}
\DoxyCodeLine{00056\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa1d3beee9d492fc175ac2584e50fd8ea}{\_mi\_memzero\_aligned}}(base,\ reserve\_size);}
\DoxyCodeLine{00057\ \ \ \}}
\DoxyCodeLine{00058\ \ \ \textcolor{keywordflow}{if}\ (bitmap\_size\ >\ 0)\ \{}
\DoxyCodeLine{00059\ \ \ \ \ mi\_page\_map\_commit\ =\ (\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*)base;}
\DoxyCodeLine{00060\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a476563a6d982e688c7b3916b60c07b9b}{\_mi\_os\_commit}}(mi\_page\_map\_commit,\ bitmap\_size,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00061\ \ \ \ \ \mbox{\hyperlink{bitmap_8c_aed0bd8f290f3f1cc162df7b7ef95c35d}{mi\_bitmap\_init}}(mi\_page\_map\_commit,\ commit\_bits,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00062\ \ \ \}}
\DoxyCodeLine{00063\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}\ =\ \mbox{\hyperlink{namespacegenerate__swizzles_a33071bf5d2c3f89ecf3c8ffc45fbac64}{base}}\ +\ bitmap\_size;}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \textcolor{comment}{//\ commit\ the\ first\ part\ so\ NULL\ pointers\ get\ resolved\ without\ an\ access\ violation}}
\DoxyCodeLine{00066\ \ \ \textcolor{keywordflow}{if}\ (!commit)\ \{}
\DoxyCodeLine{00067\ \ \ \ \ \mbox{\hyperlink{page-map_8c_ad88a09e9e1318e625ef9763489cd5789}{mi\_page\_map\_ensure\_committed}}(0,\ 1);}
\DoxyCodeLine{00068\ \ \ \}}
\DoxyCodeLine{00069\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}[0]\ =\ 1;\ \textcolor{comment}{//\ so\ \_mi\_ptr\_page(NULL)\ ==\ NULL}}
\DoxyCodeLine{00070\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_acd84a462a2045538d19ecc56e6cc29f6}{\_mi\_ptr\_page}}(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})==\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00071\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00072\ \}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{page-map_8c_ad88a09e9e1318e625ef9763489cd5789}{mi\_page\_map\_ensure\_committed}}(\textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ slice\_count)\ \{}
\DoxyCodeLine{00075\ \ \ \textcolor{comment}{//\ is\ the\ page\ map\ area\ that\ contains\ the\ page\ address\ committed?}}
\DoxyCodeLine{00076\ \ \ \textcolor{comment}{//\ we\ always\ set\ the\ commit\ bits\ so\ we\ can\ track\ what\ ranges\ are\ in-\/use.}}
\DoxyCodeLine{00077\ \ \ \textcolor{comment}{//\ we\ only\ actually\ commit\ if\ the\ map\ wasn't\ committed\ fully\ already.}}
\DoxyCodeLine{00078\ \ \ \textcolor{keywordflow}{if}\ (mi\_page\_map\_commit\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ commit\_idx\ =\ idx\ /\ MI\_PAGE\_MAP\_ENTRIES\_PER\_COMMIT\_BIT;}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ commit\_idx\_hi\ =\ (idx\ +\ slice\_count\ -\/\ 1)\ /\ MI\_PAGE\_MAP\_ENTRIES\_PER\_COMMIT\_BIT;}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ commit\_idx;\ i\ <=\ commit\_idx\_hi;\ i++)\ \{\ \ \textcolor{comment}{//\ per\ bit\ to\ avoid\ crossing\ over\ bitmap\ chunks}}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bitmap_8h_a5410022f92ddd60d2d1800c3161a1c43}{mi\_bitmap\_is\_clear}}(mi\_page\_map\_commit,\ i))\ \{}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ this\ may\ race,\ in\ which\ case\ we\ do\ multiple\ commits\ (which\ is\ ok)\ \ \ \ \ \ \ \ }}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_zero;}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*\ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedetail_ac742e301ae0a908dc31e49ac3a31fcc5aea2b2676c28c0db26d39331a336c6b92}{start}}\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}\ +\ (i\ *\ MI\_PAGE\_MAP\_ENTRIES\_PER\_COMMIT\_BIT);}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \ \ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}}\ \ =\ MI\_PAGE\_MAP\_ENTRIES\_PER\_COMMIT\_BIT;}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a476563a6d982e688c7b3916b60c07b9b}{\_mi\_os\_commit}}(start,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ \&is\_zero);}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!is\_zero\ \&\&\ !\mbox{\hyperlink{page-map_8c_a114816cbb8983dca0f6aae70cf14f366}{mi\_page\_map\_memid}}.initially\_zero)\ \{\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a621a19b2339e1a1d23f8bc1a96eb3b54}{\_mi\_memzero}}(start,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}});\ \}\ \ \ \ \ \ \ \ }
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bitmap_8c_a929cc4a78e5271092ab20f25c10ba956}{mi\_bitmap\_set}}(mi\_page\_map\_commit,\ i);}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00091\ \ \ \ \ \}}
\DoxyCodeLine{00092\ \ \ \}}
\DoxyCodeLine{00093\ \textcolor{preprocessor}{\ \ \#if\ MI\_DEBUG\ >\ 0}}
\DoxyCodeLine{00094\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}[idx]\ =\ 0;}
\DoxyCodeLine{00095\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}[idx+slice\_count-\/1]\ =\ 0;}
\DoxyCodeLine{00096\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00097\ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{page-map_8c_a57cb024dd351df5f91e5372156cd191e}{mi\_page\_map\_get\_idx}}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}**\ page\_start,\ \textcolor{keywordtype}{size\_t}*\ slice\_count)\ \{}
\DoxyCodeLine{00101\ \ \ \textcolor{keywordtype}{size\_t}\ page\_size;}
\DoxyCodeLine{00102\ \ \ *page\_start\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab02bec7b56343136344cb9441cb889c7}{mi\_page\_area}}(page,\ \&page\_size);}
\DoxyCodeLine{00103\ \ \ \textcolor{keywordflow}{if}\ (page\_size\ >\ \mbox{\hyperlink{types_8h_ae58a91cbf52941f7526f2c954d4fcee3}{MI\_LARGE\_PAGE\_SIZE}})\ \{\ page\_size\ =\ \mbox{\hyperlink{types_8h_ae58a91cbf52941f7526f2c954d4fcee3}{MI\_LARGE\_PAGE\_SIZE}}\ -\/\ \mbox{\hyperlink{types_8h_a6ed338e789aacda04b6656865139ebc2}{MI\_ARENA\_SLICE\_SIZE}};\ \}\ \ \textcolor{comment}{//\ furthest\ interior\ pointer}}
\DoxyCodeLine{00104\ \ \ *slice\_count\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a9ad8412b6af23e1040840727a59cc9b5}{mi\_slice\_count\_of\_size}}(page\_size)\ +\ (((\mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*)*page\_start\ -\/\ (\mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*)page)/\mbox{\hyperlink{types_8h_a6ed338e789aacda04b6656865139ebc2}{MI\_ARENA\_SLICE\_SIZE}});\ \textcolor{comment}{//\ add\ for\ large\ aligned\ blocks}}
\DoxyCodeLine{00105\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac5fb64f98ad24fd3b47091a14425c3dc}{\_mi\_page\_map\_index}}(page);}
\DoxyCodeLine{00106\ \}}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{page-map_8c_a408efa9baa877e4ccfcf3e9429bcbc01}{\_mi\_page\_map\_register}}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page)\ \{}
\DoxyCodeLine{00109\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(page\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00110\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ad446ae4d82cbdbd78dfbe46fa2330555}{\_mi\_is\_aligned}}(page,\ \mbox{\hyperlink{types_8h_a8781001af23da7ff83732bc42002f385}{MI\_PAGE\_ALIGN}}));}
\DoxyCodeLine{00111\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});\ \ \textcolor{comment}{//\ should\ be\ initialized\ before\ multi-\/thread\ access!}}
\DoxyCodeLine{00112\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab1d5d43c1d7d0d4adfd96fdb7270ca4b}{\_mi\_page\_map\_init}}())\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00114\ \ \ \}}
\DoxyCodeLine{00115\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_af04c7a87bc1c69ef3e763a580f47a418}{mi\_assert}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}!=\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00116\ \ \ \mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*\ page\_start;}
\DoxyCodeLine{00117\ \ \ \textcolor{keywordtype}{size\_t}\ \ \ slice\_count;}
\DoxyCodeLine{00118\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx\ =\ \mbox{\hyperlink{page-map_8c_a57cb024dd351df5f91e5372156cd191e}{mi\_page\_map\_get\_idx}}(page,\ \&page\_start,\ \&slice\_count);}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \mbox{\hyperlink{page-map_8c_ad88a09e9e1318e625ef9763489cd5789}{mi\_page\_map\_ensure\_committed}}(idx,\ slice\_count);}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \textcolor{comment}{//\ set\ the\ offsets}}
\DoxyCodeLine{00123\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ slice\_count;\ i++)\ \{}
\DoxyCodeLine{00124\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(i\ <\ 128);}
\DoxyCodeLine{00125\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}[idx\ +\ i]\ =\ (\mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}})(i+1);}
\DoxyCodeLine{00126\ \ \ \}}
\DoxyCodeLine{00127\ \}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{page-map_8c_acaa462c1ea83f87793a85ca0046e6338}{\_mi\_page\_map\_unregister}}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page)\ \{}
\DoxyCodeLine{00130\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00131\ \ \ \textcolor{comment}{//\ get\ index\ and\ count}}
\DoxyCodeLine{00132\ \ \ \mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*\ page\_start;}
\DoxyCodeLine{00133\ \ \ \textcolor{keywordtype}{size\_t}\ \ \ slice\_count;}
\DoxyCodeLine{00134\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx\ =\ \mbox{\hyperlink{page-map_8c_a57cb024dd351df5f91e5372156cd191e}{mi\_page\_map\_get\_idx}}(page,\ \&page\_start,\ \&slice\_count);}
\DoxyCodeLine{00135\ \ \ \textcolor{comment}{//\ unset\ the\ offsets}}
\DoxyCodeLine{00136\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a621a19b2339e1a1d23f8bc1a96eb3b54}{\_mi\_memzero}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}\ +\ idx,\ slice\_count);}
\DoxyCodeLine{00137\ \}}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{page-map_8c_a8b9ed72e885fe05d2bb725740834e500}{\_mi\_page\_map\_unregister\_range}}(\textcolor{keywordtype}{void}*\ start,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}})\ \{}
\DoxyCodeLine{00140\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ slice\_count\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a693e5b64e9a4644c716974dda2395edc}{\_mi\_divide\_up}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ \mbox{\hyperlink{types_8h_a6ed338e789aacda04b6656865139ebc2}{MI\_ARENA\_SLICE\_SIZE}});}
\DoxyCodeLine{00141\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedetail_a2638ce12131bdd8c9b3c44aa6f37fb6e}{uintptr\_t}}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}}\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac5fb64f98ad24fd3b47091a14425c3dc}{\_mi\_page\_map\_index}}(start);}
\DoxyCodeLine{00142\ \ \ \mbox{\hyperlink{page-map_8c_ad88a09e9e1318e625ef9763489cd5789}{mi\_page\_map\_ensure\_committed}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}},\ slice\_count);\ \textcolor{comment}{//\ we\ commit\ the\ range\ in\ total;\ todo:\ scan\ the\ commit\ bits\ and\ clear\ only\ those\ ranges?}}
\DoxyCodeLine{00143\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a621a19b2339e1a1d23f8bc1a96eb3b54}{\_mi\_memzero}}(\&\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}[\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}}],\ slice\_count);}
\DoxyCodeLine{00144\ \}}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ \mbox{\hyperlink{page-map_8c_aa93d85305e51471aa1951ab818628a63}{\_mi\_safe\_ptr\_page}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \{}
\DoxyCodeLine{00148\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ >=\ \mbox{\hyperlink{page-map_8c_a5b04a3067e57da999dd20ce9bcea47c0}{mi\_page\_map\_max\_address}})\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00149\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedetail_a2638ce12131bdd8c9b3c44aa6f37fb6e}{uintptr\_t}}\ idx\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac5fb64f98ad24fd3b47091a14425c3dc}{\_mi\_page\_map\_index}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00150\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}(mi\_page\_map\_commit\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ \&\&\ !\mbox{\hyperlink{bitmap_8h_a16bfdf9334caeca0f356c0bdae1c7282}{mi\_bitmap\_is\_set}}(mi\_page\_map\_commit,\ idx/MI\_PAGE\_MAP\_ENTRIES\_PER\_COMMIT\_BIT))\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00151\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacedetail_a2638ce12131bdd8c9b3c44aa6f37fb6e}{uintptr\_t}}\ ofs\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}[idx];}
\DoxyCodeLine{00152\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}(ofs\ ==\ 0)\ \mbox{\hyperlink{sugar_8h_a6b8c693f1c0454a1128432b746966c17}{return}}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00153\ \ \ \mbox{\hyperlink{sugar_8h_a6b8c693f1c0454a1128432b746966c17}{return}}\ (\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*)((((uintptr\_t)\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ >>\ \mbox{\hyperlink{types_8h_a879fd12500ec3414abeb337e9accbc5b}{MI\_ARENA\_SLICE\_SHIFT}})\ -\/\ ofs\ +\ 1)\ <<\ \mbox{\hyperlink{types_8h_a879fd12500ec3414abeb337e9accbc5b}{MI\_ARENA\_SLICE\_SHIFT}});}
\DoxyCodeLine{00154\ \}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \mbox{\hyperlink{mimalloc_8h_acbaf5f4132fcfb51f0bf40e3b50f0981}{mi\_decl\_nodiscard}}\ \mbox{\hyperlink{mimalloc_8h_a19c83f9861b67bdf3a3229436d4dc366}{mi\_decl\_export}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{group__extended_ga5f071b10d4df1c3658e04e7fd67a94e6}{mi\_is\_in\_heap\_region}}(const\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \mbox{\hyperlink{mimalloc_8h_a2d1ca113437044da99abaaedd0b36ed8}{mi\_attr\_noexcept}}\ \{}
\DoxyCodeLine{00157\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{page-map_8c_aa93d85305e51471aa1951ab818628a63}{\_mi\_safe\_ptr\_page}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00158\ \}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \textcolor{comment}{//\ A\ 2-\/level\ page\ map}}
\DoxyCodeLine{00163\ \textcolor{preprocessor}{\#define\ MI\_PAGE\_MAP\_SUB\_SIZE\ \ \ \ (MI\_PAGE\_MAP\_SUB\_COUNT\ *\ sizeof(mi\_page\_t*))}}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a20085eb7375f2a033238c2456b23e8b8}{mi\_decl\_cache\_align}}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}***\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}};}
\DoxyCodeLine{00166\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}*\ \ \ \ \ \ \ \ \mbox{\hyperlink{page-map_8c_a5b04a3067e57da999dd20ce9bcea47c0}{mi\_page\_map\_max\_address}};}
\DoxyCodeLine{00167\ \textcolor{keyword}{static}\ \mbox{\hyperlink{types_8h_a56a2cb6eed720cdd1fa4b9907c44d7d0}{mi\_memid\_t}}\ \ \ \mbox{\hyperlink{page-map_8c_a114816cbb8983dca0f6aae70cf14f366}{mi\_page\_map\_memid}};}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \textcolor{keyword}{static}\ \mbox{\hyperlink{page-map_8c_a42ccb1dd40e7bab08278019bda752004}{\_Atomic}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})\ \ mi\_page\_map\_commit;\ }
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \textcolor{keyword}{static}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}**\ \mbox{\hyperlink{page-map_8c_ad88a09e9e1318e625ef9763489cd5789}{mi\_page\_map\_ensure\_committed}}(\textcolor{keywordtype}{size\_t}\ idx);}
\DoxyCodeLine{00172\ \textcolor{keyword}{static}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}**\ \mbox{\hyperlink{page-map_8c_a902d272cc23dc562664afd16b7789d47}{mi\_page\_map\_ensure\_at}}(\textcolor{keywordtype}{size\_t}\ idx);}
\DoxyCodeLine{00173\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{page-map_8c_a7b262e3370e545461603df2211f16f03}{mi\_page\_map\_set\_range}}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ sub\_idx,\ \textcolor{keywordtype}{size\_t}\ slice\_count);}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab1d5d43c1d7d0d4adfd96fdb7270ca4b}{\_mi\_page\_map\_init}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00176\ \ \ \textcolor{keywordtype}{size\_t}\ vbits\ =\ (size\_t)\mbox{\hyperlink{group__options_ga96ad9c406338bd314cfe878cfc9bf723}{mi\_option\_get\_clamp}}(\mbox{\hyperlink{mimalloc_8h_acf0af9f50d2fca76b4e158d611bc930baabf8c9793d421ce28361b6d93c432de9}{mi\_option\_max\_vabits}},\ 0,\ \mbox{\hyperlink{bits_8h_a23f1b7ccb5e7a348f2bd0abaf2664d0d}{MI\_SIZE\_BITS}});}
\DoxyCodeLine{00177\ \ \ \textcolor{keywordflow}{if}\ (vbits\ ==\ 0)\ \{}
\DoxyCodeLine{00178\ \ \ \ \ vbits\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a3625eaddd0c4f3dfeabb056283f70737}{\_mi\_os\_virtual\_address\_bits}}();}
\DoxyCodeLine{00179\ \textcolor{preprocessor}{\ \ \ \ \#if\ MI\_ARCH\_X64\ \ }\textcolor{comment}{//\ canonical\ address\ is\ limited\ to\ the\ first\ 128\ TiB}}
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{keywordflow}{if}\ (vbits\ >=\ 48)\ \{\ vbits\ =\ 47;\ \}}
\DoxyCodeLine{00181\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{00182\ \ \ \}}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \textcolor{comment}{//\ Allocate\ the\ page\ map\ and\ commit\ bits}}
\DoxyCodeLine{00185\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_af04c7a87bc1c69ef3e763a580f47a418}{mi\_assert}}(\mbox{\hyperlink{bits_8h_a190208470803b31accc591275a699228}{MI\_MAX\_VABITS}}\ >=\ vbits);}
\DoxyCodeLine{00186\ \ \ \mbox{\hyperlink{page-map_8c_a5b04a3067e57da999dd20ce9bcea47c0}{mi\_page\_map\_max\_address}}\ =\ (\textcolor{keywordtype}{void}*)(vbits\ >=\ \mbox{\hyperlink{bits_8h_a23f1b7ccb5e7a348f2bd0abaf2664d0d}{MI\_SIZE\_BITS}}\ ?\ (SIZE\_MAX\ -\/\ \mbox{\hyperlink{types_8h_a6ed338e789aacda04b6656865139ebc2}{MI\_ARENA\_SLICE\_SIZE}}\ +\ 1)\ :\ (\mbox{\hyperlink{bits_8h_a793788c5805d17b5f292a93d381fb36e}{MI\_PU}}(1)\ <<\ vbits));}
\DoxyCodeLine{00187\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ page\_map\_count\ =\ (\mbox{\hyperlink{bits_8h_aacc53767e41c111dfc833ad94ebfccf6}{MI\_ZU}}(1)\ <<\ (vbits\ -\/\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_abaa8ff88bc2e74a9428f1fd68523d5d0}{MI\_PAGE\_MAP\_SUB\_SHIFT}}\ -\/\ \mbox{\hyperlink{types_8h_a879fd12500ec3414abeb337e9accbc5b}{MI\_ARENA\_SLICE\_SHIFT}}));}
\DoxyCodeLine{00188\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_af04c7a87bc1c69ef3e763a580f47a418}{mi\_assert}}(page\_map\_count\ <=\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a0550f447d0b0d413e65ba4df86fb525e}{MI\_PAGE\_MAP\_COUNT}});}
\DoxyCodeLine{00189\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ os\_page\_size\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a723e4c95209d4c6282b53317473e83d5}{\_mi\_os\_page\_size}}();}
\DoxyCodeLine{00190\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ page\_map\_size\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a7f35944d44d8a16365072023dd19e0da}{\_mi\_align\_up}}(\ page\_map\_count\ *\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}**),\ os\_page\_size);}
\DoxyCodeLine{00191\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ reserve\_size\ =\ page\_map\_size\ +\ os\_page\_size;}
\DoxyCodeLine{00192\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespaceluisa_1_1compute_acc76090eea346a8113c9db08f08880c7}{commit}}\ =\ page\_map\_size\ <=\ 64*\mbox{\hyperlink{bits_8h_adbafbf7fe5512b55fb47ea52426a2b63}{MI\_KiB}}\ ||\ }
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{group__options_ga459ad98f18b3fc9275474807fe0ca188}{mi\_option\_is\_enabled}}(\mbox{\hyperlink{mimalloc_8h_acf0af9f50d2fca76b4e158d611bc930baa88f56e3bccce85542dc2b3297024236}{mi\_option\_pagemap\_commit}})\ ||\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab15bd169082d58502da1d18e7ae61044}{\_mi\_os\_has\_overcommit}}();\ }
\DoxyCodeLine{00194\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}\ =\ (\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}***)\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_afce7c8636aa29141d98edb847cd6f859}{\_mi\_os\_alloc\_aligned}}(reserve\_size,\ 1,\ commit,\ \textcolor{keyword}{true}\ \textcolor{comment}{/*\ allow\ large\ */},\ \&\mbox{\hyperlink{page-map_8c_a114816cbb8983dca0f6aae70cf14f366}{mi\_page\_map\_memid}});}
\DoxyCodeLine{00195\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}==\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00196\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a2bebc073bcaac71658e57bb260c2e426}{\_mi\_error\_message}}(\mbox{\hyperlink{types_8h_a6a05c923dad0c1208043e9c20a58c8e5}{ENOMEM}},\ \textcolor{stringliteral}{"{}unable\ to\ reserve\ virtual\ memory\ for\ the\ page\ map\ (\%zu\ KiB)\(\backslash\)n"{}},\ page\_map\_size\ /\ \mbox{\hyperlink{bits_8h_adbafbf7fe5512b55fb47ea52426a2b63}{MI\_KiB}});}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00198\ \ \ \}}
\DoxyCodeLine{00199\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{page-map_8c_a114816cbb8983dca0f6aae70cf14f366}{mi\_page\_map\_memid}}.initially\_committed\ \&\&\ !\mbox{\hyperlink{page-map_8c_a114816cbb8983dca0f6aae70cf14f366}{mi\_page\_map\_memid}}.initially\_zero)\ \{}
\DoxyCodeLine{00200\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac253cac2ca24fb63be7f4937ac620dc4}{\_mi\_warning\_message}}(\textcolor{stringliteral}{"{}internal:\ the\ page\ map\ was\ committed\ but\ not\ zero\ initialized!\(\backslash\)n"{}});}
\DoxyCodeLine{00201\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa1d3beee9d492fc175ac2584e50fd8ea}{\_mi\_memzero\_aligned}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}},\ page\_map\_size);}
\DoxyCodeLine{00202\ \ \ \}}
\DoxyCodeLine{00203\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a1ee5baaa0004b9c737a03d48d77a0194}{mi\_atomic\_store\_release}}(\&mi\_page\_map\_commit,\ (commit\ ?\ \string~\mbox{\hyperlink{bits_8h_aacc53767e41c111dfc833ad94ebfccf6}{MI\_ZU}}(0)\ :\ \mbox{\hyperlink{bits_8h_aacc53767e41c111dfc833ad94ebfccf6}{MI\_ZU}}(0)));}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ \textcolor{comment}{//\ note:\ for\ the\ NULL\ range\ we\ only\ commit\ one\ OS\ page\ (in\ the\ map\ and\ sub)}}
\DoxyCodeLine{00206\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{page-map_8c_a114816cbb8983dca0f6aae70cf14f366}{mi\_page\_map\_memid}}.initially\_committed)\ \{}
\DoxyCodeLine{00207\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a476563a6d982e688c7b3916b60c07b9b}{\_mi\_os\_commit}}(\&\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}[0],\ os\_page\_size,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});\ \ \textcolor{comment}{//\ commit\ first\ part\ of\ the\ map}}
\DoxyCodeLine{00208\ \ \ \}}
\DoxyCodeLine{00209\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}[0]\ =\ (\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}**)((\mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*)\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}\ +\ page\_map\_size);\ \ \textcolor{comment}{//\ we\ reserved\ 2\ sub\ maps\ at\ the\ end\ already}}
\DoxyCodeLine{00210\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{page-map_8c_a114816cbb8983dca0f6aae70cf14f366}{mi\_page\_map\_memid}}.initially\_committed)\ \{}
\DoxyCodeLine{00211\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a476563a6d982e688c7b3916b60c07b9b}{\_mi\_os\_commit}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}[0],\ os\_page\_size,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});\ \ \ \textcolor{comment}{//\ only\ first\ OS\ page}}
\DoxyCodeLine{00212\ \ \ \}}
\DoxyCodeLine{00213\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}[0][0]\ =\ (\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*)\&\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a40799c89ba077392c3973651035476aa}{\_mi\_page\_empty}};\ \ \ \ \ \ \ \textcolor{comment}{//\ caught\ in\ \`{}mi\_free`}}
\DoxyCodeLine{00214\ \ \ }
\DoxyCodeLine{00215\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_acd84a462a2045538d19ecc56e6cc29f6}{\_mi\_ptr\_page}}(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})==\&\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a40799c89ba077392c3973651035476aa}{\_mi\_page\_empty}});}
\DoxyCodeLine{00216\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00217\ \}}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \textcolor{preprocessor}{\#define\ MI\_PAGE\_MAP\_ENTRIES\_PER\_CBIT\ \ (MI\_PAGE\_MAP\_COUNT\ /\ MI\_BFIELD\_BITS)}}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{page-map_8c_a271749b52471483dcfa20040df00277e}{mi\_page\_map\_is\_committed}}(\textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}*\ pbit\_idx)\ \{}
\DoxyCodeLine{00223\ \ \ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ commit\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&mi\_page\_map\_commit);}
\DoxyCodeLine{00224\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ bit\_idx\ =\ idx/\mbox{\hyperlink{page-map_8c_ab342cebe2bf013ec6f72ecd34d52d151}{MI\_PAGE\_MAP\_ENTRIES\_PER\_CBIT}};\ }
\DoxyCodeLine{00225\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(bit\_idx\ <\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{00226\ \ \ \textcolor{keywordflow}{if}\ (pbit\_idx\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\ *pbit\_idx\ =\ bit\_idx;\ \}}
\DoxyCodeLine{00227\ \ \ \textcolor{keywordflow}{return}\ ((commit\ \&\ (\mbox{\hyperlink{bits_8h_aacc53767e41c111dfc833ad94ebfccf6}{MI\_ZU}}(1)\ <<\ bit\_idx))\ !=\ 0);}
\DoxyCodeLine{00228\ \}}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \textcolor{keyword}{static}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}**\ \mbox{\hyperlink{page-map_8c_ad88a09e9e1318e625ef9763489cd5789}{mi\_page\_map\_ensure\_committed}}(\textcolor{keywordtype}{size\_t}\ idx)\ \{}
\DoxyCodeLine{00231\ \ \ \textcolor{keywordtype}{size\_t}\ bit\_idx;}
\DoxyCodeLine{00232\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}(!\mbox{\hyperlink{page-map_8c_a271749b52471483dcfa20040df00277e}{mi\_page\_map\_is\_committed}}(idx,\ \&bit\_idx))\ \{}
\DoxyCodeLine{00233\ \ \ \ \ \mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*\ start\ =\ (\mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*)\&\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}[bit\_idx\ *\ \mbox{\hyperlink{page-map_8c_ab342cebe2bf013ec6f72ecd34d52d151}{MI\_PAGE\_MAP\_ENTRIES\_PER\_CBIT}}];}
\DoxyCodeLine{00234\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a476563a6d982e688c7b3916b60c07b9b}{\_mi\_os\_commit}}(start,\ \mbox{\hyperlink{page-map_8c_ab342cebe2bf013ec6f72ecd34d52d151}{MI\_PAGE\_MAP\_ENTRIES\_PER\_CBIT}}\ *\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}**),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00235\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a604b95458b4428f32710468937360be9}{mi\_atomic\_or\_acq\_rel}}(\&mi\_page\_map\_commit,\ \mbox{\hyperlink{bits_8h_aacc53767e41c111dfc833ad94ebfccf6}{MI\_ZU}}(1)\ <<\ bit\_idx);}
\DoxyCodeLine{00236\ \ \ \}}
\DoxyCodeLine{00237\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}[idx];}
\DoxyCodeLine{00238\ \}}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ \textcolor{keyword}{static}\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}**\ \mbox{\hyperlink{page-map_8c_a902d272cc23dc562664afd16b7789d47}{mi\_page\_map\_ensure\_at}}(\textcolor{keywordtype}{size\_t}\ idx)\ \{}
\DoxyCodeLine{00241\ \ \ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}**\ sub\ =\ \mbox{\hyperlink{page-map_8c_ad88a09e9e1318e625ef9763489cd5789}{mi\_page\_map\_ensure\_committed}}(idx);}
\DoxyCodeLine{00242\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}(sub\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00243\ \ \ \ \ \textcolor{comment}{//\ sub\ map\ not\ yet\ allocated,\ alloc\ now}}
\DoxyCodeLine{00244\ \ \ \ \ \mbox{\hyperlink{types_8h_a56a2cb6eed720cdd1fa4b9907c44d7d0}{mi\_memid\_t}}\ memid;}
\DoxyCodeLine{00245\ \ \ \ \ sub\ =\ (\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}**)\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_adda37bbacbf064719f3398bc4c8de08f}{\_mi\_os\_alloc}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa19f4a89ab09b808757f529d60897cee}{MI\_PAGE\_MAP\_SUB\_COUNT}}\ *\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*),\ \&memid);}
\DoxyCodeLine{00246\ \ \ \ \ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}**\ expect\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00247\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad2b681b3847687b6c6ce801d1673f81b}{mi\_atomic\_cas\_strong\_acq\_rel}}(((\mbox{\hyperlink{page-map_8c_a42ccb1dd40e7bab08278019bda752004}{\_Atomic}}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}**)*)\&\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}[idx]),\ \&expect,\ sub))\ \{}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \textcolor{comment}{//\ another\ thread\ already\ allocated\ it..\ free\ and\ continue}}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aef12a26764ff4aae64a1df9116452428}{\_mi\_os\_free}}(sub,\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa19f4a89ab09b808757f529d60897cee}{MI\_PAGE\_MAP\_SUB\_COUNT}}\ *\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*),\ memid);}
\DoxyCodeLine{00250\ \ \ \ \ \ \ sub\ =\ expect;}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(sub!=\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00252\ \ \ \ \ \}}
\DoxyCodeLine{00253\ \ \ \ \ \textcolor{keywordflow}{if}\ (sub\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a2bebc073bcaac71658e57bb260c2e426}{\_mi\_error\_message}}(\mbox{\hyperlink{types_8h_a3f317946e043623f9d6b93dbf60e6316}{EFAULT}},\ \textcolor{stringliteral}{"{}internal\ error:\ unable\ to\ extend\ the\ page\ map\(\backslash\)n"{}});}
\DoxyCodeLine{00255\ \ \ \ \ \}}
\DoxyCodeLine{00256\ \ \ \}}
\DoxyCodeLine{00257\ \ \ \textcolor{keywordflow}{return}\ sub;}
\DoxyCodeLine{00258\ \}}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00260\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{page-map_8c_a7b262e3370e545461603df2211f16f03}{mi\_page\_map\_set\_range}}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ sub\_idx,\ \textcolor{keywordtype}{size\_t}\ slice\_count)\ \{}
\DoxyCodeLine{00261\ \ \ \textcolor{comment}{//\ is\ the\ page\ map\ area\ that\ contains\ the\ page\ address\ committed?}}
\DoxyCodeLine{00262\ \ \ \textcolor{keywordflow}{while}\ (slice\_count\ >\ 0)\ \{}
\DoxyCodeLine{00263\ \ \ \ \ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}**\ sub\ =\ \mbox{\hyperlink{page-map_8c_a902d272cc23dc562664afd16b7789d47}{mi\_page\_map\_ensure\_at}}(idx);}
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{comment}{//\ set\ the\ offsets\ for\ the\ page}}
\DoxyCodeLine{00265\ \ \ \ \ \textcolor{keywordflow}{while}\ (sub\_idx\ <\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa19f4a89ab09b808757f529d60897cee}{MI\_PAGE\_MAP\_SUB\_COUNT}})\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \ \ sub[sub\_idx]\ =\ page;}
\DoxyCodeLine{00267\ \ \ \ \ \ \ slice\_count-\/-\/;\ \textcolor{keywordflow}{if}\ (slice\_count\ ==\ 0)\ \textcolor{keywordflow}{return};\ \ \ \ \ \ }
\DoxyCodeLine{00268\ \ \ \ \ \ \ sub\_idx++;\ \ \ \ \ \ }
\DoxyCodeLine{00269\ \ \ \ \ \}}
\DoxyCodeLine{00270\ \ \ \ \ idx++;\ \textcolor{comment}{//\ potentially\ wrap\ around\ to\ the\ next\ idx}}
\DoxyCodeLine{00271\ \ \ \ \ sub\_idx\ =\ 0;\ }
\DoxyCodeLine{00272\ \ \ \}}
\DoxyCodeLine{00273\ \}}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{page-map_8c_a57cb024dd351df5f91e5372156cd191e}{mi\_page\_map\_get\_idx}}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page,\ \textcolor{keywordtype}{size\_t}*\ sub\_idx,\ \textcolor{keywordtype}{size\_t}*\ slice\_count)\ \{}
\DoxyCodeLine{00276\ \ \ \textcolor{keywordtype}{size\_t}\ page\_size;}
\DoxyCodeLine{00277\ \ \ \mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*\ page\_start\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab02bec7b56343136344cb9441cb889c7}{mi\_page\_area}}(page,\ \&page\_size);}
\DoxyCodeLine{00278\ \ \ \textcolor{keywordflow}{if}\ (page\_size\ >\ \mbox{\hyperlink{types_8h_ae58a91cbf52941f7526f2c954d4fcee3}{MI\_LARGE\_PAGE\_SIZE}})\ \{\ page\_size\ =\ \mbox{\hyperlink{types_8h_ae58a91cbf52941f7526f2c954d4fcee3}{MI\_LARGE\_PAGE\_SIZE}}\ -\/\ \mbox{\hyperlink{types_8h_a6ed338e789aacda04b6656865139ebc2}{MI\_ARENA\_SLICE\_SIZE}};\ \}\ \ \textcolor{comment}{//\ furthest\ interior\ pointer}}
\DoxyCodeLine{00279\ \ \ *slice\_count\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a9ad8412b6af23e1040840727a59cc9b5}{mi\_slice\_count\_of\_size}}(page\_size)\ +\ ((page\_start\ -\/\ (\mbox{\hyperlink{eabase_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\_t}}*)page)/\mbox{\hyperlink{types_8h_a6ed338e789aacda04b6656865139ebc2}{MI\_ARENA\_SLICE\_SIZE}});\ \textcolor{comment}{//\ add\ for\ large\ aligned\ blocks}}
\DoxyCodeLine{00280\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac5fb64f98ad24fd3b47091a14425c3dc}{\_mi\_page\_map\_index}}(page,\ sub\_idx);}
\DoxyCodeLine{00281\ \}}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{page-map_8c_a408efa9baa877e4ccfcf3e9429bcbc01}{\_mi\_page\_map\_register}}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page)\ \{}
\DoxyCodeLine{00284\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(page\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00285\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ad446ae4d82cbdbd78dfbe46fa2330555}{\_mi\_is\_aligned}}(page,\ \mbox{\hyperlink{types_8h_a8781001af23da7ff83732bc42002f385}{MI\_PAGE\_ALIGN}}));}
\DoxyCodeLine{00286\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});\ \ \textcolor{comment}{//\ should\ be\ initialized\ before\ multi-\/thread\ access!}}
\DoxyCodeLine{00287\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00288\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab1d5d43c1d7d0d4adfd96fdb7270ca4b}{\_mi\_page\_map\_init}}())\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00289\ \ \ \}}
\DoxyCodeLine{00290\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_af04c7a87bc1c69ef3e763a580f47a418}{mi\_assert}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}!=\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00291\ \ \ \textcolor{keywordtype}{size\_t}\ \ \ slice\_count;}
\DoxyCodeLine{00292\ \ \ \textcolor{keywordtype}{size\_t}\ \ \ sub\_idx;}
\DoxyCodeLine{00293\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx\ =\ \mbox{\hyperlink{page-map_8c_a57cb024dd351df5f91e5372156cd191e}{mi\_page\_map\_get\_idx}}(page,\ \&sub\_idx,\ \&slice\_count);}
\DoxyCodeLine{00294\ \ \ \mbox{\hyperlink{page-map_8c_a7b262e3370e545461603df2211f16f03}{mi\_page\_map\_set\_range}}(page,\ idx,\ sub\_idx,\ slice\_count);}
\DoxyCodeLine{00295\ \}}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{page-map_8c_acaa462c1ea83f87793a85ca0046e6338}{\_mi\_page\_map\_unregister}}(\mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ page)\ \{}
\DoxyCodeLine{00298\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00299\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(page\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00300\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ad446ae4d82cbdbd78dfbe46fa2330555}{\_mi\_is\_aligned}}(page,\ \mbox{\hyperlink{types_8h_a8781001af23da7ff83732bc42002f385}{MI\_PAGE\_ALIGN}}));}
\DoxyCodeLine{00301\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00302\ \ \ \textcolor{comment}{//\ get\ index\ and\ count}}
\DoxyCodeLine{00303\ \ \ \textcolor{keywordtype}{size\_t}\ slice\_count;}
\DoxyCodeLine{00304\ \ \ \textcolor{keywordtype}{size\_t}\ sub\_idx;}
\DoxyCodeLine{00305\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx\ =\ \mbox{\hyperlink{page-map_8c_a57cb024dd351df5f91e5372156cd191e}{mi\_page\_map\_get\_idx}}(page,\ \&sub\_idx,\ \&slice\_count);}
\DoxyCodeLine{00306\ \ \ \textcolor{comment}{//\ unset\ the\ offsets}}
\DoxyCodeLine{00307\ \ \ \mbox{\hyperlink{page-map_8c_a7b262e3370e545461603df2211f16f03}{mi\_page\_map\_set\_range}}(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ idx,\ sub\_idx,\ slice\_count);}
\DoxyCodeLine{00308\ \}}
\DoxyCodeLine{00309\ }
\DoxyCodeLine{00310\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{page-map_8c_a8b9ed72e885fe05d2bb725740834e500}{\_mi\_page\_map\_unregister\_range}}(\textcolor{keywordtype}{void}*\ start,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}})\ \{}
\DoxyCodeLine{00311\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00312\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ slice\_count\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a693e5b64e9a4644c716974dda2395edc}{\_mi\_divide\_up}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ \mbox{\hyperlink{types_8h_a6ed338e789aacda04b6656865139ebc2}{MI\_ARENA\_SLICE\_SIZE}});}
\DoxyCodeLine{00313\ \ \ \textcolor{keywordtype}{size\_t}\ sub\_idx;}
\DoxyCodeLine{00314\ \ \ \textcolor{keyword}{const}\ uintptr\_t\ idx\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac5fb64f98ad24fd3b47091a14425c3dc}{\_mi\_page\_map\_index}}(start,\ \&sub\_idx);}
\DoxyCodeLine{00315\ \ \ \mbox{\hyperlink{page-map_8c_a7b262e3370e545461603df2211f16f03}{mi\_page\_map\_set\_range}}(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ idx,\ sub\_idx,\ slice\_count);\ \ \textcolor{comment}{//\ todo:\ avoid\ committing\ if\ not\ already\ committed?}}
\DoxyCodeLine{00316\ \}}
\DoxyCodeLine{00317\ }
\DoxyCodeLine{00318\ \textcolor{comment}{//\ Return\ NULL\ for\ invalid\ pointers}}
\DoxyCodeLine{00319\ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}*\ \mbox{\hyperlink{page-map_8c_aa93d85305e51471aa1951ab818628a63}{\_mi\_safe\_ptr\_page}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \{}
\DoxyCodeLine{00320\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}==\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00321\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ >=\ \mbox{\hyperlink{page-map_8c_a5b04a3067e57da999dd20ce9bcea47c0}{mi\_page\_map\_max\_address}})\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00322\ \ \ \textcolor{keywordtype}{size\_t}\ sub\_idx;}
\DoxyCodeLine{00323\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac5fb64f98ad24fd3b47091a14425c3dc}{\_mi\_page\_map\_index}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\&sub\_idx);}
\DoxyCodeLine{00324\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}(!\mbox{\hyperlink{page-map_8c_a271749b52471483dcfa20040df00277e}{mi\_page\_map\_is\_committed}}(idx,\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}))\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00325\ \ \ \mbox{\hyperlink{types_8h_a98e3d539b4113aac496ebe3d379ebe5b}{mi\_page\_t}}**\ \textcolor{keyword}{const}\ sub\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a63c2464b435121982ef03312145d44f1}{\_mi\_page\_map}}[idx];}
\DoxyCodeLine{00326\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}(sub==\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00327\ \ \ \textcolor{keywordflow}{return}\ sub[sub\_idx];}
\DoxyCodeLine{00328\ \}}
\DoxyCodeLine{00329\ }
\DoxyCodeLine{00330\ \mbox{\hyperlink{mimalloc_8h_acbaf5f4132fcfb51f0bf40e3b50f0981}{mi\_decl\_nodiscard}}\ \mbox{\hyperlink{mimalloc_8h_a19c83f9861b67bdf3a3229436d4dc366}{mi\_decl\_export}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{group__extended_ga5f071b10d4df1c3658e04e7fd67a94e6}{mi\_is\_in\_heap\_region}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \mbox{\hyperlink{mimalloc_8h_a2d1ca113437044da99abaaedd0b36ed8}{mi\_attr\_noexcept}}\ \{}
\DoxyCodeLine{00331\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{page-map_8c_aa93d85305e51471aa1951ab818628a63}{\_mi\_safe\_ptr\_page}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00332\ \}}
\DoxyCodeLine{00333\ }
\DoxyCodeLine{00334\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
