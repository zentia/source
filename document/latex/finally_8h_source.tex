\doxysection{finally.\+h}
\hypertarget{finally_8h_source}{}\label{finally_8h_source}\index{runtime/EASTL/include/EASTL/finally.h@{runtime/EASTL/include/EASTL/finally.h}}
\mbox{\hyperlink{finally_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Copyright\ (c)\ Electronic\ Arts\ Inc.\ All\ rights\ reserved.}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00006\ \textcolor{comment}{//\ eastl::finally\ is\ an\ implementation\ of\ the\ popular\ cpp\ idiom\ RAII\ -\/\ Resource}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ Acquisition\ Is\ Initialization.\ eastl::finally\ guarantees\ that\ the\ user}}
\DoxyCodeLine{00008\ \textcolor{comment}{//\ provided\ callable\ will\ be\ executed\ upon\ whatever\ mechanism\ is\ used\ to\ leave}}
\DoxyCodeLine{00009\ \textcolor{comment}{//\ the\ current\ scope.\ This\ can\ guard\ against\ user\ errors\ but\ this\ is\ a\ popular}}
\DoxyCodeLine{00010\ \textcolor{comment}{//\ technique\ to\ write\ robust\ code\ in\ execution\ environments\ that\ have\ exceptions}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ enabled.}}
\DoxyCodeLine{00012\ \textcolor{comment}{//}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ Example:}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ \ \ \ \ void\ foo()}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ \ \ \ \ \{}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ void*\ p\ =\ malloc(128);}}
\DoxyCodeLine{00017\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ auto\ \_\ =\ eastl::make\_finally([\&]\ \{\ free(p);\ \});}}
\DoxyCodeLine{00018\ \textcolor{comment}{//}}
\DoxyCodeLine{00019\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ //\ Code\ that\ may\ throw\ an\ exception...}}
\DoxyCodeLine{00020\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ }}
\DoxyCodeLine{00021\ \textcolor{comment}{//\ \ \ \ \ \}\ \ //\ eastl::finally\ guaranteed\ to\ call\ 'free'\ at\ scope\ exit.}}
\DoxyCodeLine{00022\ \textcolor{comment}{//}}
\DoxyCodeLine{00023\ \textcolor{comment}{//\ References:}}
\DoxyCodeLine{00024\ \textcolor{comment}{//\ *\ https://www.bfilipek.com/2017/04/finalact.html}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#ifndef\ EASTL\_FINALLY\_H}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#define\ EASTL\_FINALLY\_H}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#if\ defined(EA\_PRAGMA\_ONCE\_SUPPORTED)}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\ \ \ \ \#pragma\ once}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{config_8h}{EASTL/internal/config.h}}>}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{move__help_8h}{EASTL/internal/move\_help.h}}>}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{_e_a_s_t_l_2include_2_e_a_s_t_l_2type__traits_8h}{EASTL/type\_traits.h}}>}}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceeastl}{eastl}}}
\DoxyCodeLine{00039\ \{}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{comment}{//\ finally}}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{comment}{//\ finally\ is\ the\ type\ that\ calls\ the\ users\ callback\ on\ scope\ exit.}}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Functor>}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classeastl_1_1finally_ad1755dc0452f953c77d82896fba47d62}{finally}}}
\DoxyCodeLine{00047\ \ \ \ \ \{}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_assert}(!eastl::is\_lvalue\_reference\_v<Functor>,\ \textcolor{stringliteral}{"{}eastl::finally\ requires\ the\ callable\ is\ passed\ as\ an\ rvalue\ reference."{}});}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ Functor\ \mbox{\hyperlink{classeastl_1_1finally_a16d2561c339c27ab6b2fc4f39ddf5540}{m\_functor}};}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classeastl_1_1finally_a20d6811f711a1b0bce5a9b01f2e740b7}{m\_engaged}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{finally}(Functor\ f)\ :\ \mbox{\hyperlink{classeastl_1_1finally_a16d2561c339c27ab6b2fc4f39ddf5540}{m\_functor}}(\mbox{\hyperlink{namespaceeastl_a58ada88d74ffe16bba892a0ccccc8aba}{eastl::move}}(f)),\ \mbox{\hyperlink{classeastl_1_1finally_a20d6811f711a1b0bce5a9b01f2e740b7}{m\_engaged}}(\textcolor{keyword}{true})\ \{\}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{finally}(\textcolor{keywordflow}{finally}\&\&\ other)\ :\ \mbox{\hyperlink{classeastl_1_1finally_a16d2561c339c27ab6b2fc4f39ddf5540}{m\_functor}}(\mbox{\hyperlink{namespaceeastl_a58ada88d74ffe16bba892a0ccccc8aba}{eastl::move}}(other.m\_functor)),\ \mbox{\hyperlink{classeastl_1_1finally_a20d6811f711a1b0bce5a9b01f2e740b7}{m\_engaged}}(other.m\_engaged)}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ other.dismiss();}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classeastl_1_1finally_a336994f976ef07e07e412b96781c90a3}{\string~finally}}()\ \{\ \mbox{\hyperlink{classeastl_1_1finally_ac3194de0a61d1f51227226af8774bf40}{execute}}();\ \}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{finally}(\textcolor{keyword}{const}\ \textcolor{keywordflow}{finally}\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{finally}\&\ \mbox{\hyperlink{classeastl_1_1finally_a0a1c210765c1860e9d8ea911c4d496fa}{operator=}}(\textcolor{keyword}{const}\ \textcolor{keywordflow}{finally}\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{finally}\&\ \mbox{\hyperlink{classeastl_1_1finally_a5493b599c5f1de2bfb234acb6da33160}{operator=}}(\textcolor{keywordflow}{finally}\&\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classeastl_1_1finally_a9d6977b15456518d8d34c8ef30ab31b3}{dismiss}}()\ \{\ \mbox{\hyperlink{classeastl_1_1finally_a20d6811f711a1b0bce5a9b01f2e740b7}{m\_engaged}}\ =\ \textcolor{keyword}{false};\ \}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classeastl_1_1finally_ac3194de0a61d1f51227226af8774bf40}{execute}}()}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classeastl_1_1finally_a20d6811f711a1b0bce5a9b01f2e740b7}{m\_engaged}})}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classeastl_1_1finally_a16d2561c339c27ab6b2fc4f39ddf5540}{m\_functor}}();}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classeastl_1_1finally_a9d6977b15456518d8d34c8ef30ab31b3}{dismiss}}();}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00076\ \ \ \ \ \};}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{comment}{//\ make\_finally}}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{comment}{//\ this\ utility\ function\ is\ the\ standard\ mechansim\ to\ perform\ the\ required}}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{comment}{//\ type\ deduction\ on\ the\ users\ provided\ callback\ inorder\ to\ create\ a}}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{comment}{//\ 'finally'\ object.}}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ F>}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{namespaceeastl_ada9ec85c703645d96df522edcea2f1f2}{make\_finally}}(F\&\&\ f)}
\DoxyCodeLine{00088\ \ \ \ \ \{}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classeastl_1_1finally}{finally<F>}}(\mbox{\hyperlink{namespaceeastl_a36662e86289d74a927ced4b51496fce5}{eastl::forward<F>}}(f));}
\DoxyCodeLine{00090\ \ \ \ \ \}}
\DoxyCodeLine{00091\ \}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ EASTL\_FINALLY\_H}}

\end{DoxyCode}
