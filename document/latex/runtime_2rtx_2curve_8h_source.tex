\doxysection{curve.\+h}
\hypertarget{runtime_2rtx_2curve_8h_source}{}\label{runtime_2rtx_2curve_8h_source}\index{runtime/runtime/rtx/curve.h@{runtime/runtime/rtx/curve.h}}
\mbox{\hyperlink{runtime_2rtx_2curve_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <luisa/runtime/rhi/curve\_basis.h>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <luisa/runtime/rhi/resource.h>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <luisa/runtime/rhi/command.h>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <luisa/runtime/device.h>}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <luisa/runtime/buffer.h>}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceluisa_1_1compute}{luisa::compute}}\ \{}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceluisa_1_1compute_1_1detail}{detail}}\ \{}
\DoxyCodeLine{00012\ \mbox{\hyperlink{dll__export_8h_ad06d699c99cabff41979e596b53ac25a}{LC\_RUNTIME\_API}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceluisa_1_1compute_1_1detail_ac5f18d4a8a469b6a0935f45b5b10e99e}{check\_curve\_cp\_buffer\_motion\_keyframe\_count}}(\textcolor{keywordtype}{size\_t}\ total\_cp\_count,\ \mbox{\hyperlink{sugar_8h_ad46b2ebcd4c426b06cda147ddc1001e7}{uint}}\ motion\_keyframe\_count);}
\DoxyCodeLine{00013\ \}\textcolor{comment}{//\ namespace\ detail}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{keyword}{class\ }\mbox{\hyperlink{dll__export_8h_ad06d699c99cabff41979e596b53ac25a}{LC\_RUNTIME\_API}}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_ad733c30a55c2d7d28d97e9938293f197}{Curve}}\ final\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_resource_ad04c9df5461ad463bc3bfa340590a61a}{Resource}}\ \{}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00018\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classluisa_1_1compute_1_1_curve_a360c704789c96feef61842524fc65859}{BuildRequest}}\ =\ \mbox{\hyperlink{namespaceluisa_1_1compute_a64463a2984ce24f41388a1cf382ead11}{AccelBuildRequest}};}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00021\ \ \ \ \ \mbox{\hyperlink{namespaceluisa_1_1compute_ad708291ce805432adcafdef33aaaa307}{CurveBasis}}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_a511a4520038a828c939c9eff98cf9e2d}{\_basis}}\{\};}
\DoxyCodeLine{00022\ \ \ \ \ \mbox{\hyperlink{namespaceluisa_a70f466a8a407b18f0870c81f4bd3bf66}{uint}}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_aef595af7c0b4354addf1a95925ea74e6}{\_motion\_keyframe\_count}}\{\};}
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_a0abd86470043cdb541e126cc758997dc}{\_cp\_count\_total}}\{\};}
\DoxyCodeLine{00024\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_a8e74ff2f6367a538fb2ed1d4d3474066}{\_seg\_count}}\{\};}
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{comment}{//\ control\ point\ buffer}}
\DoxyCodeLine{00026\ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_a6871e6a9591542c152f25f0e444b476c}{\_cp\_buffer}}\{\};}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_a80cd2a704e26ba4b645e3e5d3ed92e4d}{\_cp\_buffer\_offset}}\{\};}
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_a032af9cd0f61718019eb5b2b21b64811}{\_cp\_stride}}\{\};}
\DoxyCodeLine{00029\ \ \ \ \ \textcolor{comment}{//\ segment\ buffer}}
\DoxyCodeLine{00030\ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_af60b6a2f90ba8a084e6e087f3a7b0f72}{\_seg\_buffer}}\{\};}
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_a81f60ef49c6f5b912207ea86b55b26ea}{\_seg\_buffer\_offset}}\{\};}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classluisa_1_1compute_1_1_curve_a520fa05e0bf58785da428f7a0241eee2}{Device}};}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ CPBuffer,\ \textcolor{keyword}{typename}\ SegBuffer>}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \textcolor{keyword}{requires}\ \mbox{\hyperlink{namespaceluisa_1_1compute_af90edbcad40e9bc117817242536c45ce}{is\_buffer\_or\_view\_v<CPBuffer>}}\ \&\&}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceluisa_1_1compute_af90edbcad40e9bc117817242536c45ce}{is\_buffer\_or\_view\_v<SegBuffer>}}\ \&\&}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keyword}{sizeof}(\mbox{\hyperlink{namespaceluisa_1_1compute_a46893e9b3f9007625be2150f208337a9}{buffer\_element\_t<CPBuffer>}})\ >=\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{sugar_8h_ada97ec01294ee3122f2f2c8f4058db0c}{float4}}))\ \&\&}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::same\_as<\mbox{\hyperlink{namespaceluisa_1_1compute_a46893e9b3f9007625be2150f208337a9}{buffer\_element\_t<SegBuffer>}},\ \mbox{\hyperlink{namespaceluisa_a70f466a8a407b18f0870c81f4bd3bf66}{uint}}>}
\DoxyCodeLine{00041\ \ \ \ \ [[nodiscard]]\ \textcolor{keyword}{static}\ \mbox{\hyperlink{structluisa_1_1compute_1_1_resource_creation_info}{ResourceCreationInfo}}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_a8d71aa195815e40a81ba4bcf069b9cb4}{\_create\_resource}}(}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_device_interface}{DeviceInterface}}\ *\mbox{\hyperlink{classluisa_1_1compute_1_1_resource_a80d70cb175660af12e01637de33f32bc}{device}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{structluisa_1_1compute_1_1_accel_option}{AccelOption}}\ \&\mbox{\hyperlink{structoption}{option}},}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CPBuffer\ \&control\_point\_buffer\ [[maybe\_unused]],}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ SegBuffer\ \&segment\_buffer\ [[maybe\_unused]])\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_resource_a80d70cb175660af12e01637de33f32bc}{device}}-\/>create\_curve(\mbox{\hyperlink{structoption}{option}});}
\DoxyCodeLine{00046\ \ \ \ \ \}}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ CPBuffer,\ \textcolor{keyword}{typename}\ SegBuffer>}
\DoxyCodeLine{00050\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_ad733c30a55c2d7d28d97e9938293f197}{Curve}}(\mbox{\hyperlink{classluisa_1_1compute_1_1_device_interface}{DeviceInterface}}\ *\mbox{\hyperlink{classluisa_1_1compute_1_1_resource_a80d70cb175660af12e01637de33f32bc}{device}},}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceluisa_1_1compute_ad708291ce805432adcafdef33aaaa307}{CurveBasis}}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_a4e14e4d2567227f3fd65d1fc95e60fcf}{basis}},}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CPBuffer\ \&control\_point\_buffer,}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ SegBuffer\ \&segment\_buffer,}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structluisa_1_1compute_1_1_accel_option}{AccelOption}}\ \&\mbox{\hyperlink{structoption}{option}})\ noexcept}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classluisa_1_1compute_1_1_resource_ad04c9df5461ad463bc3bfa340590a61a}{Resource}}\{\mbox{\hyperlink{classluisa_1_1compute_1_1_resource_a80d70cb175660af12e01637de33f32bc}{device}},\ \mbox{\hyperlink{classluisa_1_1compute_1_1_resource_a3d72fc24a13e8e17d2284bf4f59a19d6a01f76e0921f8cebe360cdc9621d7dd0d}{Resource::Tag::CURVE}},}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_a8d71aa195815e40a81ba4bcf069b9cb4}{\_create\_resource}}(\mbox{\hyperlink{classluisa_1_1compute_1_1_resource_a80d70cb175660af12e01637de33f32bc}{device}},\ \mbox{\hyperlink{structoption}{option}},}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ control\_point\_buffer,}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ segment\_buffer)\},}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \_basis\{basis\},}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \_motion\_keyframe\_count\{\mbox{\hyperlink{structoption}{option}}.motion.keyframe\_count\},}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \_cp\_count\_total\{control\_point\_buffer.size()\},}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \_seg\_count\{segment\_buffer.size()\},}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \_cp\_buffer\{\mbox{\hyperlink{namespaceluisa_1_1compute_a15f4ba3ed941fee887e13591b186c415}{BufferView}}\{control\_point\_buffer\}.handle()\},}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \_cp\_buffer\_offset\{\mbox{\hyperlink{namespaceluisa_1_1compute_a15f4ba3ed941fee887e13591b186c415}{BufferView}}\{control\_point\_buffer\}.offset\_bytes()\},}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \_cp\_stride\{control\_point\_buffer.stride()\},}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \_seg\_buffer\{\mbox{\hyperlink{namespaceluisa_1_1compute_a15f4ba3ed941fee887e13591b186c415}{BufferView}}\{segment\_buffer\}.handle()\},}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \_seg\_buffer\_offset\{\mbox{\hyperlink{namespaceluisa_1_1compute_a15f4ba3ed941fee887e13591b186c415}{BufferView}}\{segment\_buffer\}.offset\_bytes()\}\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ detail::check\_curve\_cp\_buffer\_motion\_keyframe\_count(\_cp\_count\_total,\ \_motion\_keyframe\_count);}
\DoxyCodeLine{00069\ \ \ \ \ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00072\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_ab7444b5ad8eeb1e03f938ee877fbe234}{Curve}}()\ noexcept\ =\ \mbox{\hyperlink{sugar_8h_a6face89e97cccad5464dd9bb9c7efd23}{default}};}
\DoxyCodeLine{00073\ \ \ \ \ \string~\mbox{\hyperlink{classluisa_1_1compute_1_1_curve_ad733c30a55c2d7d28d97e9938293f197}{Curve}}()\ noexcept\ override;}
\DoxyCodeLine{00074\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_ad733c30a55c2d7d28d97e9938293f197}{Curve}}(\mbox{\hyperlink{classluisa_1_1compute_1_1_curve_ad733c30a55c2d7d28d97e9938293f197}{Curve}}\ \&\&)\ noexcept\ =\ \mbox{\hyperlink{sugar_8h_a6face89e97cccad5464dd9bb9c7efd23}{default}};}
\DoxyCodeLine{00075\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_ad733c30a55c2d7d28d97e9938293f197}{Curve}}(const\ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_ad733c30a55c2d7d28d97e9938293f197}{Curve}}\ \&)\ noexcept\ =\ delete;}
\DoxyCodeLine{00076\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_ad733c30a55c2d7d28d97e9938293f197}{Curve}}\ \&operator=(\mbox{\hyperlink{classluisa_1_1compute_1_1_curve_ad733c30a55c2d7d28d97e9938293f197}{Curve}}\ \&\&rhs)\ noexcept\ \{}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_resource_ac8bd4f95e29f120931f646355e51323a}{\_move\_from}}(std::move(rhs));}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00079\ \ \ \ \ \}}
\DoxyCodeLine{00080\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_ad733c30a55c2d7d28d97e9938293f197}{Curve}}\ \&\mbox{\hyperlink{classluisa_1_1compute_1_1_curve_a4ffb872dc1273046a0ea3f8193fd0256}{operator=}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_ad733c30a55c2d7d28d97e9938293f197}{Curve}}\ \&)\ \textcolor{keyword}{noexcept}\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keyword}{using\ }Resource::operator\ \mbox{\hyperlink{sugar_8h_abb452686968e48b67397da5f97445f5b}{bool}};}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00084\ \ \ \ \ [[nodiscard]]\ \mbox{\hyperlink{namespaceluisa_1_1compute_ad708291ce805432adcafdef33aaaa307}{CurveBasis}}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_a4e14e4d2567227f3fd65d1fc95e60fcf}{basis}}()\ const\ noexcept;}
\DoxyCodeLine{00085\ \ \ \ \ [[nodiscard]]\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_af1e68d2fcdd0565fcf47ec5acf07994b}{control\_point\_count\_per\_motion\_keyframe}}()\ const\ noexcept;}
\DoxyCodeLine{00086\ \ \ \ \ [[nodiscard]]\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_a36da00ff07a1dd761ffbca437d7ef978}{segment\_count}}()\ const\ noexcept;}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ [[nodiscard]]\ auto\ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_a86817dbb76bb3ba98dee0e75c22d79cc}{motion\_keyframe\_count}}()\ const\ noexcept\ \{}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ std::max<uint>(1u,\ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve_aef595af7c0b4354addf1a95925ea74e6}{\_motion\_keyframe\_count}});}
\DoxyCodeLine{00090\ \ \ \ \ \}}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00093\ \ \ \ \ [[nodiscard]]\ luisa::unique\_ptr<Command>\ build(BuildRequest\ request\ =\ BuildRequest::PREFER\_UPDATE)\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{00094\ \};}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ CPBuffer,\ \textcolor{keyword}{typename}\ SegmentBuffer>}
\DoxyCodeLine{00097\ \mbox{\hyperlink{classluisa_1_1compute_1_1_curve}{Curve}}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_device_a3f1164ec86fc0e1c06b13e8c7ff086fe}{Device::create\_curve}}(\mbox{\hyperlink{namespaceluisa_1_1compute_ad708291ce805432adcafdef33aaaa307}{CurveBasis}}\ basis,}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CPBuffer\ \&\&control\_points,}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ SegmentBuffer\ \&\&segments,}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structluisa_1_1compute_1_1_accel_option}{AccelOption}}\ \&\mbox{\hyperlink{structoption}{option}})\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keywordflow}{return}\ this-\/>\mbox{\hyperlink{classluisa_1_1compute_1_1_device_a989b9aac0ea5d2b4e432c05b6fe821f5}{\_create<Curve>}}(basis,}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::forward<CPBuffer>(control\_points),}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::forward<SegmentBuffer>(segments),}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structoption}{option}});}
\DoxyCodeLine{00105\ \}}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \}\textcolor{comment}{//\ namespace\ luisa::compute}}

\end{DoxyCode}
