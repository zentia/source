\doxysection{Module Algorithm}
\hypertarget{_module_algorithm}{}\label{_module_algorithm}\index{Module Algorithm@{Module Algorithm}}
Taskflow provides template methods that let users create reusable building blocks called {\itshape modules}. Users can connect modules together to build more complex parallel algorithms.\hypertarget{_module_algorithm_ModuleAlgorithmInclude}{}\doxysubsection{\texorpdfstring{Include the Header}{Include the Header}}\label{_module_algorithm_ModuleAlgorithmInclude}
You need to include the header file, {\ttfamily \doxylink{module_8hpp}{taskflow/algorithm/module.\+hpp}}, for creating a module task over a schedulable graph target.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{module_8hpp}{taskflow/algorithm/module.hpp}}>}}

\end{DoxyCode}
\hypertarget{_module_algorithm_WhatIsAModuleTask}{}\doxysubsection{\texorpdfstring{What is a Module Task}{What is a Module Task}}\label{_module_algorithm_WhatIsAModuleTask}
Similar to \doxylink{ComposableTasking}{Composable Tasking}, but in a more generic setting, the template function, \doxylink{namespacetf_a767288f0f103fec9a849237865198627}{tf\+::make\+\_\+module\+\_\+task}, allows you to create a task over a taskflow graph that can be executed by an executor. This provides a flexible way to encapsulate and reuse complex task logic within your Taskflow applications. The example below demonstrates how to create and launch multiple taskflows in parallel using asynchronous tasking\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{classtf_1_1_executor}{tf::Executor}}\ \mbox{\hyperlink{thread__pool_8cpp_a543e564a8407bbeac15cb2d929fec755}{executor}};}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{classtf_1_1_taskflow}{tf::Taskflow}}\ \mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}};}
\DoxyCodeLine{\mbox{\hyperlink{classtf_1_1_taskflow}{tf::Taskflow}}\ \mbox{\hyperlink{bench__gemm_8cpp_a37a83060ac796961b44991c836f083f7}{B}};}
\DoxyCodeLine{\mbox{\hyperlink{classtf_1_1_taskflow}{tf::Taskflow}}\ \mbox{\hyperlink{test__buffer__node_8cpp_ac4cf4b2ab929bd23951a8676eeac086b}{C}};}
\DoxyCodeLine{\mbox{\hyperlink{classtf_1_1_taskflow}{tf::Taskflow}}\ \mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}};}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}}.emplace([]()\{\ \mbox{\hyperlink{printf_8h_aee3ed3a831f25f07e7be3919fff2203a}{printf}}(\textcolor{stringliteral}{"{}Taskflow\ A\(\backslash\)n"{}});\ \});\ }
\DoxyCodeLine{\mbox{\hyperlink{bench__gemm_8cpp_a37a83060ac796961b44991c836f083f7}{B}}.emplace([]()\{\ \mbox{\hyperlink{printf_8h_aee3ed3a831f25f07e7be3919fff2203a}{printf}}(\textcolor{stringliteral}{"{}Taskflow\ B\(\backslash\)n"{}});\ \});\ }
\DoxyCodeLine{\mbox{\hyperlink{test__buffer__node_8cpp_ac4cf4b2ab929bd23951a8676eeac086b}{C}}.emplace([]()\{\ \mbox{\hyperlink{printf_8h_aee3ed3a831f25f07e7be3919fff2203a}{printf}}(\textcolor{stringliteral}{"{}Taskflow\ C\(\backslash\)n"{}});\ \});\ }
\DoxyCodeLine{\mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}.emplace([]()\{\ \mbox{\hyperlink{printf_8h_aee3ed3a831f25f07e7be3919fff2203a}{printf}}(\textcolor{stringliteral}{"{}Taskflow\ D\(\backslash\)n"{}});\ \});\ }
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ launch\ the\ four\ taskflows\ using\ asynchronous\ tasking}}
\DoxyCodeLine{\mbox{\hyperlink{thread__pool_8cpp_a543e564a8407bbeac15cb2d929fec755}{executor}}.\mbox{\hyperlink{classtf_1_1_executor_af960048056f7c6b5bc71f4f526f05df7}{async}}(\mbox{\hyperlink{namespacetf_a767288f0f103fec9a849237865198627}{tf::make\_module\_task}}(\mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}}));}
\DoxyCodeLine{\mbox{\hyperlink{thread__pool_8cpp_a543e564a8407bbeac15cb2d929fec755}{executor}}.\mbox{\hyperlink{classtf_1_1_executor_af960048056f7c6b5bc71f4f526f05df7}{async}}(\mbox{\hyperlink{namespacetf_a767288f0f103fec9a849237865198627}{tf::make\_module\_task}}(\mbox{\hyperlink{bench__gemm_8cpp_a37a83060ac796961b44991c836f083f7}{B}}));}
\DoxyCodeLine{\mbox{\hyperlink{thread__pool_8cpp_a543e564a8407bbeac15cb2d929fec755}{executor}}.\mbox{\hyperlink{classtf_1_1_executor_af960048056f7c6b5bc71f4f526f05df7}{async}}(\mbox{\hyperlink{namespacetf_a767288f0f103fec9a849237865198627}{tf::make\_module\_task}}(\mbox{\hyperlink{test__buffer__node_8cpp_ac4cf4b2ab929bd23951a8676eeac086b}{C}}));}
\DoxyCodeLine{\mbox{\hyperlink{thread__pool_8cpp_a543e564a8407bbeac15cb2d929fec755}{executor}}.\mbox{\hyperlink{classtf_1_1_executor_af960048056f7c6b5bc71f4f526f05df7}{async}}(\mbox{\hyperlink{namespacetf_a767288f0f103fec9a849237865198627}{tf::make\_module\_task}}(\mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}));}
\DoxyCodeLine{\mbox{\hyperlink{thread__pool_8cpp_a543e564a8407bbeac15cb2d929fec755}{executor}}.\mbox{\hyperlink{classtf_1_1_executor_ab9aa252f70e9a40020a1e5a89d485b85}{wait\_for\_all}}();\ \ }

\end{DoxyCode}


Since the four taskflows are launched asynchronously without any dependencies between them, we can observe any order of the output message\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\{.shell-\/session\}\ }
\DoxyCodeLine{\textcolor{preprocessor}{\#\ one\ possible\ output}}
\DoxyCodeLine{Taskflow\ \mbox{\hyperlink{bench__gemm_8cpp_a37a83060ac796961b44991c836f083f7}{B}}}
\DoxyCodeLine{Taskflow\ \mbox{\hyperlink{test__buffer__node_8cpp_ac4cf4b2ab929bd23951a8676eeac086b}{C}}}
\DoxyCodeLine{Taskflow\ \mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}}}
\DoxyCodeLine{Taskflow\ \mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{preprocessor}{\#\ another\ possible\ output}}
\DoxyCodeLine{Taskflow\ \mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}}
\DoxyCodeLine{Taskflow\ \mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}}}
\DoxyCodeLine{Taskflow\ \mbox{\hyperlink{bench__gemm_8cpp_a37a83060ac796961b44991c836f083f7}{B}}}
\DoxyCodeLine{Taskflow\ \mbox{\hyperlink{test__buffer__node_8cpp_ac4cf4b2ab929bd23951a8676eeac086b}{C}}}

\end{DoxyCode}


If you need to enforce dependencies among these four taskflows, you can use dependent-\/async tasks. The example below launches the four taskflows one by one in sequential\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{classtf_1_1_executor}{tf::Executor}}\ \mbox{\hyperlink{thread__pool_8cpp_a543e564a8407bbeac15cb2d929fec755}{executor}};}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{classtf_1_1_taskflow}{tf::Taskflow}}\ \mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}};}
\DoxyCodeLine{\mbox{\hyperlink{classtf_1_1_taskflow}{tf::Taskflow}}\ \mbox{\hyperlink{bench__gemm_8cpp_a37a83060ac796961b44991c836f083f7}{B}};}
\DoxyCodeLine{\mbox{\hyperlink{classtf_1_1_taskflow}{tf::Taskflow}}\ \mbox{\hyperlink{test__buffer__node_8cpp_ac4cf4b2ab929bd23951a8676eeac086b}{C}};}
\DoxyCodeLine{\mbox{\hyperlink{classtf_1_1_taskflow}{tf::Taskflow}}\ \mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}};}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}}.emplace([]()\{\ \mbox{\hyperlink{printf_8h_aee3ed3a831f25f07e7be3919fff2203a}{printf}}(\textcolor{stringliteral}{"{}Taskflow\ A\(\backslash\)n"{}});\ \});\ }
\DoxyCodeLine{\mbox{\hyperlink{bench__gemm_8cpp_a37a83060ac796961b44991c836f083f7}{B}}.emplace([]()\{\ \mbox{\hyperlink{printf_8h_aee3ed3a831f25f07e7be3919fff2203a}{printf}}(\textcolor{stringliteral}{"{}Taskflow\ B\(\backslash\)n"{}});\ \});\ }
\DoxyCodeLine{\mbox{\hyperlink{test__buffer__node_8cpp_ac4cf4b2ab929bd23951a8676eeac086b}{C}}.emplace([]()\{\ \mbox{\hyperlink{printf_8h_aee3ed3a831f25f07e7be3919fff2203a}{printf}}(\textcolor{stringliteral}{"{}Taskflow\ C\(\backslash\)n"{}});\ \});\ }
\DoxyCodeLine{\mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}.emplace([]()\{\ \mbox{\hyperlink{printf_8h_aee3ed3a831f25f07e7be3919fff2203a}{printf}}(\textcolor{stringliteral}{"{}Taskflow\ D\(\backslash\)n"{}});\ \});\ }
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{auto}\ TA\ =\ \mbox{\hyperlink{thread__pool_8cpp_a543e564a8407bbeac15cb2d929fec755}{executor}}.\mbox{\hyperlink{classtf_1_1_executor_a0e2d792f28136b8227b413d0c27d5c7f}{silent\_dependent\_async}}(\mbox{\hyperlink{namespacetf_a767288f0f103fec9a849237865198627}{tf::make\_module\_task}}(\mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}}));}
\DoxyCodeLine{\textcolor{keyword}{auto}\ TB\ =\ \mbox{\hyperlink{thread__pool_8cpp_a543e564a8407bbeac15cb2d929fec755}{executor}}.\mbox{\hyperlink{classtf_1_1_executor_a0e2d792f28136b8227b413d0c27d5c7f}{silent\_dependent\_async}}(\mbox{\hyperlink{namespacetf_a767288f0f103fec9a849237865198627}{tf::make\_module\_task}}(\mbox{\hyperlink{bench__gemm_8cpp_a37a83060ac796961b44991c836f083f7}{B}}),\ TA);}
\DoxyCodeLine{\textcolor{keyword}{auto}\ TC\ =\ \mbox{\hyperlink{thread__pool_8cpp_a543e564a8407bbeac15cb2d929fec755}{executor}}.\mbox{\hyperlink{classtf_1_1_executor_a0e2d792f28136b8227b413d0c27d5c7f}{silent\_dependent\_async}}(\mbox{\hyperlink{namespacetf_a767288f0f103fec9a849237865198627}{tf::make\_module\_task}}(\mbox{\hyperlink{test__buffer__node_8cpp_ac4cf4b2ab929bd23951a8676eeac086b}{C}}),\ TB);}
\DoxyCodeLine{\textcolor{keyword}{auto}\ [TD,\ FD]\ =\ \mbox{\hyperlink{thread__pool_8cpp_a543e564a8407bbeac15cb2d929fec755}{executor}}.\mbox{\hyperlink{classtf_1_1_executor_aee02b63d3a91ad5ca5a1c0e71f3e128f}{dependent\_async}}(\mbox{\hyperlink{namespacetf_a767288f0f103fec9a849237865198627}{tf::make\_module\_task}}(\mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}),\ TC);}
\DoxyCodeLine{FD.get();}

\end{DoxyCode}



\begin{DoxyCode}{0}
\DoxyCodeLine{\{.shell-\/session\}\ }
\DoxyCodeLine{\textcolor{preprocessor}{\#\ dependent-\/async\ tasks\ enforce\ a\ sequential\ execution\ of\ the\ four\ taskflows}}
\DoxyCodeLine{Taskflow\ \mbox{\hyperlink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A}}}
\DoxyCodeLine{Taskflow\ \mbox{\hyperlink{bench__gemm_8cpp_a37a83060ac796961b44991c836f083f7}{B}}}
\DoxyCodeLine{Taskflow\ \mbox{\hyperlink{test__buffer__node_8cpp_ac4cf4b2ab929bd23951a8676eeac086b}{C}}}
\DoxyCodeLine{Taskflow\ \mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}}

\end{DoxyCode}


The module task maker, \doxylink{namespacetf_a767288f0f103fec9a849237865198627}{tf\+::make\+\_\+module\+\_\+task}, functions basically similar to \doxylink{classtf_1_1_flow_builder_ac6f22228d4c2ea2e643c4b0d42c0e92a}{tf\+::\+Taskflow\+::composed\+\_\+of} but provides a more generic interface that can be used beyond Taskflow. Specifically, the following two approaches achieve the same functionality.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ approach\ 1:\ composition\ using\ composed\_of}}
\DoxyCodeLine{\mbox{\hyperlink{classtf_1_1_task}{tf::Task}}\ \mbox{\hyperlink{_i_o_format_8cpp_ade6f22163da3c189aade978b48a8bb74}{m1}}\ =\ taskflow1.composed\_of(taskflow2);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ approach\ 2:\ composition\ using\ make\_module\_task}}
\DoxyCodeLine{\mbox{\hyperlink{classtf_1_1_task}{tf::Task}}\ \mbox{\hyperlink{_i_o_format_8cpp_ade6f22163da3c189aade978b48a8bb74}{m1}}\ =\ taskflow1.emplace(\mbox{\hyperlink{namespacetf_a767288f0f103fec9a849237865198627}{tf::make\_module\_task}}(taskflow2));}

\end{DoxyCode}


\begin{DoxyAttention}{注意}
Similar to \doxylink{classtf_1_1_flow_builder_ac6f22228d4c2ea2e643c4b0d42c0e92a}{tf\+::\+Taskflow\+::composed\+\_\+of}, \doxylink{namespacetf_a767288f0f103fec9a849237865198627}{tf\+::make\+\_\+module\+\_\+task} does not assume ownership of the provided taskflow but a soft reference. You are responsible for ensuring that the encapsulated taskflow remains valid throughout its execution.
\end{DoxyAttention}
\hypertarget{_module_algorithm_CreateAModuleTaskOverACustomGraph}{}\doxysubsection{\texorpdfstring{Create a Module Task over a Custom Graph}{Create a Module Task over a Custom Graph}}\label{_module_algorithm_CreateAModuleTaskOverACustomGraph}
In addition to encapsulate taskflow graphs, you can create a module task to schedule a custom graph target. \doxylink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A} schedulable target (of type {\ttfamily T}) must define the method {\ttfamily T\+::graph()} that returns a reference to the \doxylink{classtf_1_1_graph}{tf\+::\+Graph} object managed by {\ttfamily T}. The following example defines a custom graph that can be scheduled through making module tasks\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{struct\ }CustomGraph\ \{}
\DoxyCodeLine{\ \ \mbox{\hyperlink{classtf_1_1_graph}{tf::Graph}}\ graph;}
\DoxyCodeLine{\ \ CustomGraph()\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ use\ flow\ builder\ to\ inherit\ all\ task\ creation\ methods\ in\ tf::Taskflow}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{classtf_1_1_flow_builder}{tf::FlowBuilder}}\ builder(graph);}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{classtf_1_1_task}{tf::Task}}\ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}\ =\ builder.emplace([]()\{}
\DoxyCodeLine{\ \ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}a\ task\(\backslash\)n"{}};\ \ \textcolor{comment}{//\ static\ task}}
\DoxyCodeLine{\ \ \ \ \});}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\ \ \textcolor{comment}{//\ returns\ a\ reference\ to\ the\ graph\ for\ taskflow\ composition}}
\DoxyCodeLine{\ \ Graph\&\ graph()\ \{\ \textcolor{keywordflow}{return}\ graph;\ \}}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{CustomGraph\ target;}
\DoxyCodeLine{\mbox{\hyperlink{thread__pool_8cpp_a543e564a8407bbeac15cb2d929fec755}{executor}}.\mbox{\hyperlink{classtf_1_1_executor_af960048056f7c6b5bc71f4f526f05df7}{async}}(\mbox{\hyperlink{namespacetf_a767288f0f103fec9a849237865198627}{tf::make\_module\_task}}(target));}

\end{DoxyCode}


\begin{DoxyAttention}{注意}
Users are responsible for ensuring the given custom graph remains valid throughout its execution. The executor does not assume ownership of the custom graph. 
\end{DoxyAttention}
