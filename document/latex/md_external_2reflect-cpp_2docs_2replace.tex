\chapter{\texorpdfstring{$<$}{<}tt\texorpdfstring{$>$}{>}rfl\+::replace\texorpdfstring{$<$}{<}/tt\texorpdfstring{$>$}{>}}
\hypertarget{md_external_2reflect-cpp_2docs_2replace}{}\label{md_external_2reflect-cpp_2docs_2replace}\index{$<$tt$>$rfl::replace$<$/tt$>$@{$<$tt$>$rfl::replace$<$/tt$>$}}
\label{md_external_2reflect-cpp_2docs_2replace_autotoc_md618}%
\Hypertarget{md_external_2reflect-cpp_2docs_2replace_autotoc_md618}%


{\ttfamily \doxylink{namespacerfl_ac4bd3c990469707252d797a9d81a3680}{rfl\+::replace}} creates a deep copy of the original struct or moves the original struct, replacing one or several fields in the process.

This only works for the {\ttfamily \doxylink{structrfl_1_1_field}{rfl\+::\+Field}}-\/syntax.

In some cases, we really only want to change one or a few fields, to get from one struct to another\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ lisa\ =\ Person\{}
\DoxyCodeLine{\ \ \ \ .first\_name\ =\ \textcolor{stringliteral}{"{}Lisa"{}},}
\DoxyCodeLine{\ \ \ \ .last\_name\ =\ \textcolor{stringliteral}{"{}Simpson"{}},}
\DoxyCodeLine{\ \ \ \ .children\ =\ std::vector<Person>()}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Returns\ a\ deep\ copy\ of\ the\ original\ object,}}
\DoxyCodeLine{\textcolor{comment}{//\ replacing\ first\_name.}}
\DoxyCodeLine{\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ maggie\ =}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{namespacerfl_ac4bd3c990469707252d797a9d81a3680}{rfl::replace}}(lisa,\ \mbox{\hyperlink{namespacerfl_afb5f68a22d5b6a42a5b4477c35559ce9}{rfl::make\_field<"{}first\_name"{}>}}(std::string(\textcolor{stringliteral}{"{}Maggie"{}})));}

\end{DoxyCode}


{\ttfamily maggie} is now a deep copy of {\ttfamily lisa}, but with a new {\ttfamily first\+\_\+name}.

However, in some cases, we do not want or are unable to create a deep copy of a struct.

For instance, suppose we had put the field {\ttfamily children} into a {\ttfamily \doxylink{classrfl_1_1_box}{rfl\+::\+Box}}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{struct\ }Person\ \{}
\DoxyCodeLine{\ \ \ \ std::string\ first\_name;}
\DoxyCodeLine{\ \ \ \ std::string\ last\_name;}
\DoxyCodeLine{\ \ \ \ rfl::Box<std::vector<Person>>\ children;}
\DoxyCodeLine{\};}

\end{DoxyCode}


{\ttfamily \doxylink{classrfl_1_1_box}{rfl\+::\+Box}} cannot be copied, and if we naively try to apply {\ttfamily \doxylink{namespacerfl_ac4bd3c990469707252d797a9d81a3680}{rfl\+::replace}} to this, this will not compile (disabling copies is very much the point of {\ttfamily \doxylink{classrfl_1_1_box}{rfl\+::\+Box}}).

However, we can use {\ttfamily std\+::move}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{auto}\ lisa\ =\ Person\{.first\_name\ =\ \textcolor{stringliteral}{"{}Lisa"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .last\_name\ =\ \textcolor{stringliteral}{"{}Simpson"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .children\ =\ \mbox{\hyperlink{namespacerfl_abe491c0b107ed7c5e2c8baaf1a116b01}{rfl::make\_box<std::vector<Person>}}>()\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ maggie\ =\ \mbox{\hyperlink{namespacerfl_ac4bd3c990469707252d797a9d81a3680}{rfl::replace}}(}
\DoxyCodeLine{\ \ \ \ std::move(lisa),\ \mbox{\hyperlink{namespacerfl_afb5f68a22d5b6a42a5b4477c35559ce9}{rfl::make\_field<"{}firstName"{}>}}(std::string(\textcolor{stringliteral}{"{}Maggie"{}})));}

\end{DoxyCode}


The fields from {\ttfamily lisa} have now been moved into {\ttfamily maggie}.

We can also remove several fields using {\ttfamily replace}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{auto}\ lisa\ =\ Person\{.first\_name\ =\ \textcolor{stringliteral}{"{}Lisa"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .last\_name\ =\ \textcolor{stringliteral}{"{}Simpson"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .children\ =\ \mbox{\hyperlink{namespacerfl_abe491c0b107ed7c5e2c8baaf1a116b01}{rfl::make\_box<std::vector<Person>}}>()\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ milhouse\ =\ \mbox{\hyperlink{namespacerfl_ac4bd3c990469707252d797a9d81a3680}{rfl::replace}}(}
\DoxyCodeLine{\ \ \ \ std::move(lisa),}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{namespacerfl_afb5f68a22d5b6a42a5b4477c35559ce9}{rfl::make\_field<"{}firstName"{}>}}(std::string(\textcolor{stringliteral}{"{}Maggie"{}})),}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{namespacerfl_afb5f68a22d5b6a42a5b4477c35559ce9}{rfl::make\_field<"{}lastName"{}>}}(std::string(\textcolor{stringliteral}{"{}Van\ Houten"{}})));}

\end{DoxyCode}


If you have nested structs using {\ttfamily \doxylink{structrfl_1_1_flatten}{rfl\+::\+Flatten}}, you can treat the fields inside {\ttfamily \doxylink{structrfl_1_1_flatten}{rfl\+::\+Flatten}} as if they were on the main level\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{struct\ }Person\ \{}
\DoxyCodeLine{\ \ \ \ std::string\ first\_name;}
\DoxyCodeLine{\ \ \ \ rfl::Box<std::string>\ last\_name;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespacectre_af1ab492eac22f0bfaebe58d37347ce28a7d637d275668ed6d41a9b97e6ad3a556}{age}};}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{struct\ }Employee\ \{}
\DoxyCodeLine{\ \ \ \ rfl::Flatten<Person>\ person;}
\DoxyCodeLine{\ \ \ \ rfl::Box<std::string>\ employer;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{float}\ salary;}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{auto}\ employee\ =\ Employee\{}
\DoxyCodeLine{\ \ \ \ .person\ =\ Person\{.first\_name\ =\ \textcolor{stringliteral}{"{}Homer"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .last\_name\ =\ \mbox{\hyperlink{namespacerfl_abe491c0b107ed7c5e2c8baaf1a116b01}{rfl::make\_box<std::string>}}(\textcolor{stringliteral}{"{}Simpson"{}}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .age\ =\ 45\},}
\DoxyCodeLine{\ \ \ \ .employer\ =\ \mbox{\hyperlink{namespacerfl_abe491c0b107ed7c5e2c8baaf1a116b01}{rfl::make\_box<std::string>}}(\textcolor{stringliteral}{"{}Mr.\ Burns"{}}),}
\DoxyCodeLine{\ \ \ \ .salary\ =\ 60000.0\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{auto}\ employee2\ =}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{namespacerfl_ac4bd3c990469707252d797a9d81a3680}{rfl::replace}}(std::move(employee),\ \mbox{\hyperlink{namespacerfl_afb5f68a22d5b6a42a5b4477c35559ce9}{rfl::make\_field<"{}salary"{}>}}(70000.0),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacerfl_afb5f68a22d5b6a42a5b4477c35559ce9}{rfl::make\_field<"{}age"{}>}}(46));}

\end{DoxyCode}


In this case {\ttfamily age} is part of {\ttfamily Person} and {\ttfamily salary} part ot {\ttfamily Employee}, but because you have flattened them, you can treat them as if they were on the same level.

You can also replace structs with other structs. Consider the following example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{struct\ }Person\ \{}
\DoxyCodeLine{\ \ \ \ std::string\ first\_name;}
\DoxyCodeLine{\ \ \ \ std::string\ last\_name;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespacectre_af1ab492eac22f0bfaebe58d37347ce28a7d637d275668ed6d41a9b97e6ad3a556}{age}};}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{struct\ }Employee\ \{}
\DoxyCodeLine{\ \ \ \ rfl::Flatten<Person>\ person;}
\DoxyCodeLine{\ \ \ \ std::string\ employer;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{float}\ salary;}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ employee\ =\ Employee\{}
\DoxyCodeLine{\ \ \ \ .person\ =}
\DoxyCodeLine{\ \ \ \ \ \ \ \ Person\{.first\_name\ =\ \textcolor{stringliteral}{"{}Homer"{}},\ .last\_name\ =\ \textcolor{stringliteral}{"{}Simpson"{}},\ .age\ =\ 45\},}
\DoxyCodeLine{\ \ \ \ .employer\ =\ std::string(\textcolor{stringliteral}{"{}Mr.\ Burns"{}}),}
\DoxyCodeLine{\ \ \ \ .salary\ =\ 60000.0\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ carl\ =\ Person\{.first\_name\ =\ \textcolor{stringliteral}{"{}Carl"{}},\ .last\_name\ =\ \textcolor{stringliteral}{"{}"{}},\ .age\ =\ 45\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ employee2\ =\ \mbox{\hyperlink{namespacerfl_ac4bd3c990469707252d797a9d81a3680}{rfl::replace}}(employee,\ carl);}

\end{DoxyCode}


This code flattens the employee structs and then replaces all relevant fields with their counterparts contained in {\ttfamily carl}.

Finally, we get this JSON string\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\{"{}first\_name"{}:"{}Carl"{},"{}last\_name"{}:"{}"{},"{}age"{}:45,"{}employer"{}:"{}Mr.\ Burns"{},"{}salary"{}:60000.0\}}

\end{DoxyCode}


Don\textquotesingle{}t worry, this is fairly optimized and makes heavy use of forwarding. It does not make any copies than it absolutely has to. 