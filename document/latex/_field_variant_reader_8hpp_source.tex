\doxysection{Field\+Variant\+Reader.\+hpp}
\hypertarget{_field_variant_reader_8hpp_source}{}\label{_field_variant_reader_8hpp_source}\index{external/reflect-\/cpp/include/rfl/parsing/FieldVariantReader.hpp@{external/reflect-\/cpp/include/rfl/parsing/FieldVariantReader.hpp}}
\mbox{\hyperlink{_field_variant_reader_8hpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ RFL\_PARSING\_FIELDVARIANTREADER\_HPP\_}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ RFL\_PARSING\_FIELDVARIANTREADER\_HPP\_}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <array>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <optional>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <sstream>}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <string\_view>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <type\_traits>}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <utility>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_result_8hpp}{../Result.hpp}}"{}}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_variant_8hpp}{../Variant.hpp}}"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{is__array_8hpp}{../internal/is\_array.hpp}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nth__element__t_8hpp}{../internal/nth\_element\_t.hpp}}"{}}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacerfl_1_1parsing}{rfl::parsing}}\ \{}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class\ }\mbox{\hyperlink{test__broadcast__node_8cpp_a554e63228b946db0d44c4f398b18e212}{R}},\ \textcolor{keyword}{class\ }\mbox{\hyperlink{test__flow__graph_8cpp_ab21b528bc38899d04d3a7053e52fb797}{W}},\ \textcolor{keyword}{class\ }ProcessorsType,\ \textcolor{keyword}{class}...\ FieldTypes>}
\DoxyCodeLine{00020\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_aade4b0906e51647b469e17b5cb80fddc}{FieldVariantReader}}\ \{}
\DoxyCodeLine{00021\ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00022\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_a4f9895ae4c001de5da6baa2cbfe6b0a0}{InputVarType}}\ =\ \textcolor{keyword}{typename}\ R::InputVarType;}
\DoxyCodeLine{00023\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_a2c369ab83fd4985ad07cff9339c2aae7}{FieldVariantType}}\ =\ \mbox{\hyperlink{classrfl_1_1_variant}{rfl::Variant}}<FieldTypes...>;}
\DoxyCodeLine{00024\ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_adb6ddfeb22d277ddb3109dcb43e60fbf}{ResultType}}\ =\ \mbox{\hyperlink{classrfl_1_1_result}{Result<FieldVariantType>}};}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00027\ \ \ \mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_aade4b0906e51647b469e17b5cb80fddc}{FieldVariantReader}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{test__broadcast__node_8cpp_a554e63228b946db0d44c4f398b18e212}{R}}*\ \_r,}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::optional<\mbox{\hyperlink{classrfl_1_1_result}{Result<FieldVariantType>}}>*\ \_field\_variant)}
\DoxyCodeLine{00029\ \ \ \ \ \ \ :\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_a2399ec067b47f10ee7c78ba5d10ceddf}{r\_}}(\_r),\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_acd2195664049bc3833b127d692bcf176}{field\_variant\_}}(\_field\_variant)\ \{\}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \ \ \mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_a19e41c38cda835f996b096cb8830a975}{\string~FieldVariantReader}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_a009c99370b37e4d4f9f50bab1a8f31bc}{read}}(\textcolor{keyword}{const}\ std::string\_view\&\ \_disc\_value,}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_a4f9895ae4c001de5da6baa2cbfe6b0a0}{InputVarType}}\&\ \_var)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00035\ \ \ \ \ \mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_a1ef8e29a6bfbaeafe6858d965885d976}{try\_matching\_fields}}(}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \_disc\_value,\ \_var,}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ std::make\_integer\_sequence<\textcolor{keywordtype}{int},\ \textcolor{keyword}{sizeof}...(FieldTypes)>());}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keywordflow}{if}\ (!*\mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_acd2195664049bc3833b127d692bcf176}{field\_variant\_}})\ \{}
\DoxyCodeLine{00039\ \ \ \ \ \ \ std::stringstream\ stream;}
\DoxyCodeLine{00040\ \ \ \ \ \ \ stream\ <<\ \textcolor{stringliteral}{"{}Could\ not\ parse\ rfl::Variant,\ could\ not\ match\ field\ named\ "{}}}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}'"{}}}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \_disc\_value\ <<\ \textcolor{stringliteral}{"{}'."{}};}
\DoxyCodeLine{00043\ \ \ \ \ \ \ *\mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_acd2195664049bc3833b127d692bcf176}{field\_variant\_}}\ =\ \mbox{\hyperlink{namespacerfl_a6625864c6c297dfdc3d3c3ee3181dd8c}{error}}(stream.str());}
\DoxyCodeLine{00044\ \ \ \ \ \}}
\DoxyCodeLine{00045\ \ \ \}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00048\ \ \ \textcolor{keyword}{template}\ <\textcolor{keywordtype}{int}...\ \_is>}
\DoxyCodeLine{00049\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_a1ef8e29a6bfbaeafe6858d965885d976}{try\_matching\_fields}}(\textcolor{keyword}{const}\ std::string\_view\&\ \_disc\_value,}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_a4f9895ae4c001de5da6baa2cbfe6b0a0}{InputVarType}}\&\ \_var,}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::integer\_sequence<int,\ \_is...>)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00052\ \ \ \ \ (\mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_a884ad52b1dd793c56cd7c7ecd7ffe8bf}{try\_one<\_is>}}(\_disc\_value,\ \_var),\ ...);}
\DoxyCodeLine{00053\ \ \ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \textcolor{keyword}{template}\ <\textcolor{keywordtype}{int}\ \_i>}
\DoxyCodeLine{00056\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_a884ad52b1dd793c56cd7c7ecd7ffe8bf}{try\_one}}(\textcolor{keyword}{const}\ std::string\_view\&\ \_disc\_value,}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_a4f9895ae4c001de5da6baa2cbfe6b0a0}{InputVarType}}\&\ \_var)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keyword}{using\ }FieldType\ =}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ std::remove\_cvref\_t<\mbox{\hyperlink{namespacerfl_1_1internal_a3341722260850a89f1bce998f318ab95}{internal::nth\_element\_t}}<\_i,\ FieldTypes...>>;}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{test__parallel__reduce_8cpp_aac3e1a5e422a80a86b55a5c15b106ba9}{ValueType}}\ =\ std::remove\_cvref\_t<typename\ FieldType::Type>;}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keyword}{constexpr}\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{ittnotify__static_8h_aeeaf6235e69da2907f537f67e598fc9d}{key}}\ =\ FieldType::name\_.string\_view();}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ittnotify__static_8h_aeeaf6235e69da2907f537f67e598fc9d}{key}}\ ==\ \_disc\_value)\ \{}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ to\_variant\ =\ [](\mbox{\hyperlink{test__parallel__reduce_8cpp_aac3e1a5e422a80a86b55a5c15b106ba9}{ValueType}}\&\&\ \_val)\ \{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrfl_1_1_variant}{rfl::Variant}}<FieldTypes...>(FieldType(std::move(\_val)));}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \};}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ embellish\_error\ =\ [\&](\textcolor{keyword}{const}\ \mbox{\hyperlink{classrfl_1_1_error}{Error}}\&\ \_e)\ \{}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ std::stringstream\ stream;}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ stream\ <<\ \textcolor{stringliteral}{"{}Could\ not\ parse\ rfl::Variant\ with\ field\ '"{}}}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ std::string(\_disc\_value)\ <<\ \textcolor{stringliteral}{"{}':\ "{}}\ <<\ \_e.what();}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrfl_1_1_error}{Error}}(stream.str());}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \};}
\DoxyCodeLine{00072\ \ \ \ \ \ \ *\mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_acd2195664049bc3833b127d692bcf176}{field\_variant\_}}\ =\ \mbox{\hyperlink{structrfl_1_1parsing_1_1_parser_a905ccbbb3adb81bb18d9109df6613b72}{Parser<R,\ W,\ ValueType,\ ProcessorsType>::read}}(*\mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_a2399ec067b47f10ee7c78ba5d10ceddf}{r\_}},\ \_var)}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .transform(to\_variant)}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ .transform\_error(embellish\_error);}
\DoxyCodeLine{00075\ \ \ \ \ \}}
\DoxyCodeLine{00076\ \ \ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00080\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{test__broadcast__node_8cpp_a554e63228b946db0d44c4f398b18e212}{R}}*\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_a2399ec067b47f10ee7c78ba5d10ceddf}{r\_}};}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00083\ \ \ std::optional<Result<FieldVariantType>>*\ \mbox{\hyperlink{classrfl_1_1parsing_1_1_field_variant_reader_acd2195664049bc3833b127d692bcf176}{field\_variant\_}};}
\DoxyCodeLine{00084\ \};}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \}\ \ \textcolor{comment}{//\ namespace\ rfl::parsing}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
