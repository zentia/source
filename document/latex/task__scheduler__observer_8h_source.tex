\doxysection{task\+\_\+scheduler\+\_\+observer.\+h}
\hypertarget{task__scheduler__observer_8h_source}{}\label{task__scheduler__observer_8h_source}\index{external/taskflow/3rd-\/party/tbb/include/tbb/task\_scheduler\_observer.h@{external/taskflow/3rd-\/party/tbb/include/tbb/task\_scheduler\_observer.h}}
\mbox{\hyperlink{task__scheduler__observer_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ \ \ \ Copyright\ (c)\ 2005-\/2020\ Intel\ Corporation}}
\DoxyCodeLine{00003\ \textcolor{comment}{}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ \ \ \ Licensed\ under\ the\ Apache\ License,\ Version\ 2.0\ (the\ "{}License"{});}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ \ \ \ you\ may\ not\ use\ this\ file\ except\ in\ compliance\ with\ the\ License.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ \ \ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00007\ \textcolor{comment}{}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ \ \ \ \ \ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00009\ \textcolor{comment}{}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ \ \ \ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,\ software}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ \ \ \ distributed\ under\ the\ License\ is\ distributed\ on\ an\ "{}AS\ IS"{}\ BASIS,}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ \ \ \ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY\ KIND,\ either\ express\ or\ implied.}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ \ \ \ See\ the\ License\ for\ the\ specific\ language\ governing\ permissions\ and}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ \ \ \ limitations\ under\ the\ License.}}
\DoxyCodeLine{00015\ \textcolor{comment}{*/}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#ifndef\ \_\_TBB\_task\_scheduler\_observer\_H}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#define\ \_\_TBB\_task\_scheduler\_observer\_H}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#define\ \_\_TBB\_task\_scheduler\_observer\_H\_include\_area}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{__warning__suppress__enable__notice_8h}{internal/\_warning\_suppress\_enable\_notice.h}}"{}}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{external_2taskflow_23rd-party_2tbb_2include_2tbb_2atomic_8h}{atomic.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#if\ \_\_TBB\_ARENA\_OBSERVER}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{task__arena_8h}{task\_arena.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#if\ \_\_TBB\_SCHEDULER\_OBSERVER}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetbb}{tbb}}\ \{}
\DoxyCodeLine{00031\ \textcolor{keyword}{namespace\ }interface6\ \{}
\DoxyCodeLine{00032\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1task__scheduler__observer}{task\_scheduler\_observer}};}
\DoxyCodeLine{00033\ \}}
\DoxyCodeLine{00034\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceinternal}{internal}}\ \{}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \textcolor{keyword}{class\ }observer\_proxy;}
\DoxyCodeLine{00037\ \textcolor{keyword}{class\ }observer\_list;}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_a25bffb05efaaab36bc58590969e29745}{task\_scheduler\_observer\_v3}}\ \{}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_a897b52f8da750f35b9b2ef410eae7181}{observer\_proxy}};}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_a232d1ae378b2c82f9788c5611429298b}{observer\_list}};}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer}{interface6::task\_scheduler\_observer}};}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_a897b52f8da750f35b9b2ef410eae7181}{observer\_proxy}}*\ \mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_a84e937e0c1efc19522f2a34f7518df68}{my\_proxy}};}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \ \ \mbox{\hyperlink{sugar_8h_a48f1c51623545bd4f58fbab2fa6091d0}{atomic<intptr\_t>}}\ \mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_af27619a6dfe4b054fb3b9faca2922520}{my\_busy\_count}};}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{tbb__stddef_8h_a7a1df7e6f83415a1624716541dc4b741}{\_\_TBB\_EXPORTED\_METHOD}}\ \mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_a40209b347e3c82bb5bfda05941304309}{observe}}(\ \textcolor{keywordtype}{bool}\ state=\textcolor{keyword}{true}\ );}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_af6660648f58efcfa97301ec8283280b7}{is\_observing}}()\textcolor{keyword}{\ const\ }\{\textcolor{keywordflow}{return}\ \mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_a84e937e0c1efc19522f2a34f7518df68}{my\_proxy}}!=\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};\}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00064\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_a25bffb05efaaab36bc58590969e29745}{task\_scheduler\_observer\_v3}}()\ :\ \mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_a84e937e0c1efc19522f2a34f7518df68}{my\_proxy}}(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\ \mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_af27619a6dfe4b054fb3b9faca2922520}{my\_busy\_count}}.store<\mbox{\hyperlink{namespacetbb_adb86d08473679d6fe0eabcdc766ffe3aa73cb2e2bcb94442b8b2b72e93a76f2e5}{relaxed}}>(0);\ \}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_af4282a27725fbe86052bb785bdd9c5d3}{on\_scheduler\_entry}}(\ \textcolor{keywordtype}{bool}\ \textcolor{comment}{/*is\_worker*/}\ )\ \{\}}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_a657e90f833568e217b807d0122fa7668}{on\_scheduler\_exit}}(\ \textcolor{keywordtype}{bool}\ \textcolor{comment}{/*is\_worker*/}\ )\ \{\}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_a151e475ebba39172fcc13f43bed426cc}{\string~task\_scheduler\_observer\_v3}}()\ \{\ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_a84e937e0c1efc19522f2a34f7518df68}{my\_proxy}})\ \mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_a40209b347e3c82bb5bfda05941304309}{observe}}(\textcolor{keyword}{false});\}}
\DoxyCodeLine{00086\ \};}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \}\ \textcolor{comment}{//\ namespace\ internal}}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \textcolor{preprocessor}{\#if\ \_\_TBB\_ARENA\_OBSERVER}}
\DoxyCodeLine{00091\ \textcolor{keyword}{namespace\ }interface6\ \{}
\DoxyCodeLine{00092\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer_a89025b1e1d42e97d6fe114c0c331f730}{task\_scheduler\_observer}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3}{internal::task\_scheduler\_observer\_v3}}\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3}{internal::task\_scheduler\_observer\_v3}};}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer_ae3fb165cd890fab10c1d09823dcb0ac9}{internal::observer\_proxy}};}
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer_a5d0d193bf27a1606466663c68e05e1b3}{internal::observer\_list}};}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{comment}{//\ TODO:\ take\ more\ high\ bits\ for\ version\ number}}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ intptr\_t\ \mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer_a093b84f4557b062cd9ec761ae8a51801}{v6\_trait}}\ =\ (intptr\_t)((\string~(uintptr\_t)0\ >>\ 1)\ +\ 1);}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00103\ \ \ \ \ intptr\_t\ \mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer_a38756346ca5d83675a6d47428eeecb39}{my\_context\_tag}};}
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{keyword}{enum}\ \{\ \mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer_aeddabc6b57f6b18a4e1362ada9219814a42e65bc6bcc7973f6b651c30d9187fa4}{global\_tag}}\ =\ 0,\ \mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer_aeddabc6b57f6b18a4e1362ada9219814a520d3d4301c038f01fd40aa718f17351}{implicit\_tag}}\ =\ 1\ \};}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer_a89025b1e1d42e97d6fe114c0c331f730}{task\_scheduler\_observer}}(\ \textcolor{keywordtype}{bool}\ local\ =\ \textcolor{keyword}{false}\ )\ \{}
\DoxyCodeLine{00118\ \textcolor{preprocessor}{\#if\ \ \_\_TBB\_ARENA\_OBSERVER}}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer_a38756346ca5d83675a6d47428eeecb39}{my\_context\_tag}}\ =\ local?\ \mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer_aeddabc6b57f6b18a4e1362ada9219814a520d3d4301c038f01fd40aa718f17351}{implicit\_tag}}\ :\ \mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer_aeddabc6b57f6b18a4e1362ada9219814a42e65bc6bcc7973f6b651c30d9187fa4}{global\_tag}};}
\DoxyCodeLine{00120\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a643ae54febb34aa0f2543aa5385a606f}{\_\_TBB\_ASSERT\_EX}}(\ !local,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer_a38756346ca5d83675a6d47428eeecb39}{my\_context\_tag}}\ =\ \mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer_aeddabc6b57f6b18a4e1362ada9219814a42e65bc6bcc7973f6b651c30d9187fa4}{global\_tag}};}
\DoxyCodeLine{00123\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00124\ \ \ \ \ \}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \textcolor{preprocessor}{\#if\ \ \_\_TBB\_ARENA\_OBSERVER}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer_a36e7e0c466320029d5a3e50a573e04c1}{task\_scheduler\_observer}}(\ \mbox{\hyperlink{namespacetbb_1_1task__arena}{task\_arena}}\ \&\ \mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}})\ \{}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer_a38756346ca5d83675a6d47428eeecb39}{my\_context\_tag}}\ =\ (intptr\_t)\&\mbox{\hyperlink{_cwise__product_8cpp_ad2cbe4616e813eb9af81732dca777b24}{a}};}
\DoxyCodeLine{00133\ \ \ \ \ \}}
\DoxyCodeLine{00134\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_ARENA\_OBSERVER\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer_a9ef3f1853439b46e5a9db7fd1c0f9116}{\string~task\_scheduler\_observer}}()\ \{\ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_a84e937e0c1efc19522f2a34f7518df68}{my\_proxy}})\ \mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer_ad5b33790cea52c61e1fb004a8ed26365}{observe}}(\textcolor{keyword}{false});\ \}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer_ad5b33790cea52c61e1fb004a8ed26365}{observe}}(\ \textcolor{keywordtype}{bool}\ state=\textcolor{keyword}{true}\ )\ \{}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ state\ \&\&\ !\mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_a84e937e0c1efc19522f2a34f7518df68}{my\_proxy}}\ )\ \{}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ !\mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_af27619a6dfe4b054fb3b9faca2922520}{my\_busy\_count}},\ \textcolor{stringliteral}{"{}Inconsistent\ state\ of\ task\_scheduler\_observer\ instance"{}});}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_af27619a6dfe4b054fb3b9faca2922520}{my\_busy\_count}}.store<\mbox{\hyperlink{namespacetbb_adb86d08473679d6fe0eabcdc766ffe3aa73cb2e2bcb94442b8b2b72e93a76f2e5}{relaxed}}>(\mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer_a093b84f4557b062cd9ec761ae8a51801}{v6\_trait}});}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_a40209b347e3c82bb5bfda05941304309}{internal::task\_scheduler\_observer\_v3::observe}}(state);}
\DoxyCodeLine{00150\ \ \ \ \ \}}
\DoxyCodeLine{00151\ \};}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \}\ \textcolor{comment}{//namespace\ interface6}}
\DoxyCodeLine{00154\ \textcolor{keyword}{using\ }interface6::task\_scheduler\_observer;}
\DoxyCodeLine{00155\ \textcolor{preprocessor}{\#else\ }\textcolor{comment}{/*\_\_TBB\_ARENA\_OBSERVER*/}\textcolor{preprocessor}{}}
\DoxyCodeLine{00156\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3}{tbb::internal::task\_scheduler\_observer\_v3}}\ \mbox{\hyperlink{classtbb_1_1task__scheduler__observer}{task\_scheduler\_observer}};}
\DoxyCodeLine{00157\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\_\_TBB\_ARENA\_OBSERVER*/}\textcolor{preprocessor}{}}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \}\ \textcolor{comment}{//\ namespace\ tbb}}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_SCHEDULER\_OBSERVER\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{__warning__suppress__disable__notice_8h}{internal/\_warning\_suppress\_disable\_notice.h}}"{}}}
\DoxyCodeLine{00164\ \textcolor{preprocessor}{\#undef\ \_\_TBB\_task\_scheduler\_observer\_H\_include\_area}}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_TBB\_task\_scheduler\_observer\_H\ */}\textcolor{preprocessor}{}}

\end{DoxyCode}
