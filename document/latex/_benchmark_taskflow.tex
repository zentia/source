\doxysection{Benchmark Taskflow}
\hypertarget{_benchmark_taskflow}{}\label{_benchmark_taskflow}\index{Benchmark Taskflow@{Benchmark Taskflow}}
\hypertarget{_benchmark_taskflow_CompileAndRunBenchmarks}{}\doxysubsection{\texorpdfstring{Compile and Run Benchmarks}{Compile and Run Benchmarks}}\label{_benchmark_taskflow_CompileAndRunBenchmarks}
To build the benchmark code, enable the CMake option {\ttfamily TF\+\_\+\+BUILD\+\_\+\+BENCHMARKS} to {\ttfamily ON} as follows\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\{.shell-\/session\}\ }
\DoxyCodeLine{\textcolor{preprocessor}{\#\ under\ /taskflow/build}}
\DoxyCodeLine{\string~\$\ \mbox{\hyperlink{cblat2_8f_a02c505d1046fe3c18a9f17c1f1dc6b51}{cmake}}\ ../\ -\/DTF\_BUILD\_BENCHMARKS=ON}
\DoxyCodeLine{\string~\$\ make}

\end{DoxyCode}


After you successfully build the benchmark code, you can find all benchmark instances in the {\ttfamily benchmarks/} folder. You can run the executable of each instance in the corresponding folder.


\begin{DoxyCode}{0}
\DoxyCodeLine{\{.shell-\/session\}\ }
\DoxyCodeLine{\string~\$\ cd\ \mbox{\hyperlink{namespacebenchmarks}{benchmarks}}\ \&\ ls}
\DoxyCodeLine{bench\_black\_scholes\ bench\_binary\_tree\ bench\_graph\_traversal\ ...}
\DoxyCodeLine{\string~\$\ ./bench\_graph\_traversal}
\DoxyCodeLine{|\mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a77c224aa52b434918ce65c33175aa8ad}{V}}|+|\mbox{\hyperlink{sandbox_2strassen_2omp_8cpp_a4bfa035cad7c3258704669810cd5de5d}{E}}|\ \ \ \ \ Runtime}
\DoxyCodeLine{\ \ \ \ \ \ 2\ \ \ \ \ \ \ 0.197}
\DoxyCodeLine{\ \ \ \ 842\ \ \ \ \ \ \ 0.198}
\DoxyCodeLine{\ \ \ 3284\ \ \ \ \ \ \ 0.488}
\DoxyCodeLine{\ \ \ 7288\ \ \ \ \ \ \ 0.774}
\DoxyCodeLine{\ \ \ \ ...\ \ \ \ \ \ \ \ \ ...}
\DoxyCodeLine{\ \ \ \ ...\ \ \ \ \ \ \ \ \ ...}
\DoxyCodeLine{\ 619802\ \ \ \ \ \ 75.135}
\DoxyCodeLine{\ 664771\ \ \ \ \ \ 77.436}
\DoxyCodeLine{\ 711200\ \ \ \ \ \ 83.957}

\end{DoxyCode}


You can display the help message by giving the option {\ttfamily -\/-\/help}.


\begin{DoxyCode}{0}
\DoxyCodeLine{\{.shell-\/session\}\ }
\DoxyCodeLine{\string~\$\ ./bench\_graph\_traversal\ -\/-\/\mbox{\hyperlink{runtime_2xx_hash_2tests_2bench_2main_8c_ac4face814e17650939f9b68ff35b2866}{help}}}
\DoxyCodeLine{\mbox{\hyperlink{class_graph}{Graph}}\ Traversal}
\DoxyCodeLine{\mbox{\hyperlink{polymain_8cpp_a5b80af9316419761d9ee0e8fd53455fd}{Usage}}:\ ./bench\_graph\_traversal\ [OPTIONS]}
\DoxyCodeLine{}
\DoxyCodeLine{Options:}
\DoxyCodeLine{\ \ -\/\mbox{\hyperlink{ittnotify__static_8h_ae68700d2ebda197674e2fdd0f916f00c}{h}},-\/-\/\mbox{\hyperlink{runtime_2xx_hash_2tests_2bench_2main_8c_ac4face814e17650939f9b68ff35b2866}{help}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Print\ \textcolor{keyword}{this}\ \mbox{\hyperlink{runtime_2xx_hash_2tests_2bench_2main_8c_ac4face814e17650939f9b68ff35b2866}{help}}\ message\ and\ exit}
\DoxyCodeLine{\ \ -\/\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}},-\/-\/num\_threads\ \mbox{\hyperlink{test__malloc__compliance_8cpp_a36cb3b01d81ffd844bbbfb54003e06ec}{UINT}}\ \ \ \ \ \ \ \mbox{\hyperlink{test_8cpp_a8d6e50e84adba3fc984a0433cb254ea0}{number}}\ of\ threads\ (\textcolor{keywordflow}{default}=1)}
\DoxyCodeLine{\ \ -\/\mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}},-\/-\/num\_rounds\ \mbox{\hyperlink{test__malloc__compliance_8cpp_a36cb3b01d81ffd844bbbfb54003e06ec}{UINT}}\ \ \ \ \ \ \ \ \mbox{\hyperlink{test_8cpp_a8d6e50e84adba3fc984a0433cb254ea0}{number}}\ of\ \mbox{\hyperlink{time__hash__map__fill_8cpp_ab951ebd61b5fff7fb5c4212d7fc63254}{rounds}}\ (\textcolor{keywordflow}{default}=1)}
\DoxyCodeLine{\ \ -\/\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}},-\/-\/model\ \mbox{\hyperlink{_core_types_8h_a2978f60d40d64f3605b5a99f66f292a9}{TEXT}}\ \ \ \ \ \ \ \ \ \ \ \ \ model\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aab18cfce5ee7c6881ae04f18be70d94a}{name}}\ \mbox{\hyperlink{namespacetbb}{tbb}}|omp|\mbox{\hyperlink{namespacetf}{tf}}\ (\textcolor{keywordflow}{default}=\mbox{\hyperlink{namespacetf}{tf}})}

\end{DoxyCode}


We currently implement the following instances that are commonly used by the parallel computing community to evaluate the system performance.

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Instance   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Description    }\\\cline{1-2}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Instance   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Description    }\\\cline{1-2}
\endhead
\PBS\centering bench\+\_\+binary\+\_\+tree   &\PBS\centering traverses a complete binary tree    \\\cline{1-2}
\PBS\centering bench\+\_\+black\+\_\+scholes   &\PBS\centering computes option pricing with Black-\/\+Shcoles Models    \\\cline{1-2}
\PBS\centering bench\+\_\+graph\+\_\+traversal   &\PBS\centering traverses a randomly generated direct acyclic graph    \\\cline{1-2}
\PBS\centering bench\+\_\+linear\+\_\+chain   &\PBS\centering traverses a linear chain of tasks    \\\cline{1-2}
\PBS\centering bench\+\_\+mandelbrot   &\PBS\centering exploits imbalanced workloads in a Mandelbrot set    \\\cline{1-2}
\PBS\centering bench\+\_\+matrix\+\_\+multiplication   &\PBS\centering multiplies two 2D matrices    \\\cline{1-2}
\PBS\centering bench\+\_\+mnist   &\PBS\centering trains a neural network-\/based image classifier on the \doxylink{struct_m_n_i_s_t}{MNIST} dataset    \\\cline{1-2}
\PBS\centering bench\+\_\+parallel\+\_\+sort   &\PBS\centering sorts a range of items    \\\cline{1-2}
\PBS\centering bench\+\_\+reduce\+\_\+sum   &\PBS\centering sums a range of items using reduction    \\\cline{1-2}
\PBS\centering bench\+\_\+wavefront   &\PBS\centering propagates computations in a 2D grid    \\\cline{1-2}
\PBS\centering bench\+\_\+linear\+\_\+pipeline   &\PBS\centering pipeline scheduling on a linear chain of pipes    \\\cline{1-2}
\PBS\centering bench\+\_\+graph\+\_\+pipeline   &\PBS\centering pipeline scheduling on a graph of pipes   \\\cline{1-2}
\end{longtabu}
\hypertarget{_benchmark_taskflow_ConfigureRunOptions}{}\doxysubsection{\texorpdfstring{Configure Run Options}{Configure Run Options}}\label{_benchmark_taskflow_ConfigureRunOptions}
We implement consistent options for each benchmark instance. Common options are\+:

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ option   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ value   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ function    }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ option   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ value   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ function    }\\\cline{1-3}
\endhead
\PBS\centering {\ttfamily -\/h}   &\PBS\centering none   &\PBS\centering display the help message    \\\cline{1-3}
\PBS\centering {\ttfamily -\/t}   &\PBS\centering integer   &\PBS\centering configure the number of threads to run    \\\cline{1-3}
\PBS\centering {\ttfamily -\/r}   &\PBS\centering integer   &\PBS\centering configure the number of rounds to run    \\\cline{1-3}
\PBS\centering {\ttfamily -\/m}   &\PBS\centering string   &\PBS\centering configure the baseline models to run, tbb, omp, or tf   \\\cline{1-3}
\end{longtabu}


You can configure the benchmarking environment by giving different options.\hypertarget{_benchmark_taskflow_SpecifyTheRunModel}{}\doxysubsubsection{\texorpdfstring{Specify the Run Model}{Specify the Run Model}}\label{_benchmark_taskflow_SpecifyTheRunModel}
In addition to a Taskflow-\/based implementation for each benchmark instance, we have implemented two baseline models using the state-\/of-\/the-\/art parallel programming libraries, @\+Open\+MP and @\+TBB, to measure and evaluate the performance of Taskflow. You can select different implementations by passing the option {\ttfamily -\/m}.


\begin{DoxyCode}{0}
\DoxyCodeLine{\{.shell-\/session\}\ }
\DoxyCodeLine{\string~\$\ ./bench\_graph\_traversal\ -\/\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}\ \mbox{\hyperlink{namespacetf}{tf}}\ \ \ \#\ \mbox{\hyperlink{poisson_8cpp_ae12af222b820baf64e953be588c5bbbe}{run}}\ the\ Taskflow\ implementation\ (\textcolor{keywordflow}{default})}
\DoxyCodeLine{\string~\$\ ./bench\_graph\_traversal\ -\/\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}\ \mbox{\hyperlink{namespacetbb}{tbb}}\ \ \#\ \mbox{\hyperlink{poisson_8cpp_ae12af222b820baf64e953be588c5bbbe}{run}}\ the\ \mbox{\hyperlink{namespace_t_b_b}{TBB}}\ implementation}
\DoxyCodeLine{\string~\$\ ./bench\_graph\_traversal\ -\/\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}\ omp\ \ \#\ \mbox{\hyperlink{poisson_8cpp_ae12af222b820baf64e953be588c5bbbe}{run}}\ the\ OpenMP\ implementation}

\end{DoxyCode}
\hypertarget{_benchmark_taskflow_SpecifyTheNumberOfThreads}{}\doxysubsubsection{\texorpdfstring{Specify the Number of Threads}{Specify the Number of Threads}}\label{_benchmark_taskflow_SpecifyTheNumberOfThreads}
You can configure the number of threads to run a benchmark instance by passing the option {\ttfamily -\/t}. The default value is one.


\begin{DoxyCode}{0}
\DoxyCodeLine{\{.shell-\/session\}\ }
\DoxyCodeLine{\textcolor{preprocessor}{\#\ run\ the\ Taskflow\ implementation\ using\ 4\ threads}}
\DoxyCodeLine{\string~\$\ ./bench\_graph\_traversal\ -\/\mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}}\ \mbox{\hyperlink{namespacetf}{tf}}\ -\/\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ 4}

\end{DoxyCode}


Depending on your environment, you may need to use {\ttfamily taskset} to set the CPU affinity of the running process. This allows the OS scheduler to keep process on the same CPU(s) as long as practical for performance reason.


\begin{DoxyCode}{0}
\DoxyCodeLine{\{.shell-\/session\}\ }
\DoxyCodeLine{\textcolor{preprocessor}{\#\ affine\ the\ process\ to\ 4\ CPUs,\ CPU\ 0,\ CPU\ 1,\ CPU\ 2,\ and\ CPU\ 3}}
\DoxyCodeLine{\string~\$\ taskset\ -\/\mbox{\hyperlink{bench_vec_add_8cpp_a41689956983587b085f9da3e48f31d99}{c}}\ 0-\/3\ bench\_graph\_traversal\ -\/\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ 4\ \ }

\end{DoxyCode}
\hypertarget{_benchmark_taskflow_SpecifyTheNumberOfRounds}{}\doxysubsubsection{\texorpdfstring{Specify the Number of Rounds}{Specify the Number of Rounds}}\label{_benchmark_taskflow_SpecifyTheNumberOfRounds}
Each benchmark instance evaluates the runtime of the implementation at different problem sizes. Each problem size corresponds to one iteration. You can configure the number of rounds per iteration to average the runtime.


\begin{DoxyCode}{0}
\DoxyCodeLine{\{.shell-\/session\}\ }
\DoxyCodeLine{\textcolor{preprocessor}{\#\ measure\ the\ runtime\ in\ an\ average\ of\ 10\ runs}}
\DoxyCodeLine{\string~\$\ ./bench\_graph\_traversal\ -\/\mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}}\ 10}
\DoxyCodeLine{|\mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a77c224aa52b434918ce65c33175aa8ad}{V}}|+|\mbox{\hyperlink{sandbox_2strassen_2omp_8cpp_a4bfa035cad7c3258704669810cd5de5d}{E}}|\ \ \ \ \ Runtime}
\DoxyCodeLine{\ \ \ \ \ \ 2\ \ \ \ \ \ \ 0.109\ \ \ \#\ the\ \mbox{\hyperlink{runtime_2spdlog_2include_2spdlog_2fmt_2bundled_2base_8h_a8c5f2060819744fc66f8fbce25a480be}{runtime}}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_abe8e049f756b5ba547bda825af81b645}{value}}\ 0.109\ is\ an\ average\ of\ 10\ runs}
\DoxyCodeLine{\ \ \ \ 842\ \ \ \ \ \ \ 0.298}
\DoxyCodeLine{\ \ \ \ ...\ \ \ \ \ \ \ \ \ ...}
\DoxyCodeLine{\ 619802\ \ \ \ \ \ 73.135}
\DoxyCodeLine{\ 664771\ \ \ \ \ \ 74.436}

\end{DoxyCode}
 