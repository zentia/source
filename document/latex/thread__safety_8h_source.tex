\doxysection{thread\+\_\+safety.\+h}
\hypertarget{thread__safety_8h_source}{}\label{thread__safety_8h_source}\index{runtime/core/thread\_safety.h@{runtime/core/thread\_safety.h}}
\mbox{\hyperlink{thread__safety_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <mutex>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{core_2stl_2functional_8h}{runtime/core/stl/functional.h}}>}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceluisa}{luisa}}\ \{}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Mutex\ =\ std::mutex>}
\DoxyCodeLine{00009\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classluisa_1_1thread__safety}{thread\_safety}}\ \{}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00012\ \ \ \ \ \textcolor{keyword}{mutable}\ Mutex\ \mbox{\hyperlink{classluisa_1_1thread__safety_a56c3b93d4a568cdd645c014f015d6854}{\_mutex}};}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00015\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ F>}
\DoxyCodeLine{00016\ \ \ \ \ \textcolor{keyword}{decltype}(\textcolor{keyword}{auto})\ \mbox{\hyperlink{classluisa_1_1thread__safety_a7b7a3d302662ef2340722f07a6dac0cc}{with\_lock}}(F\ \&\&f)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00017\ \ \ \ \ \ \ \ \ std::lock\_guard\ lock\{\mbox{\hyperlink{classluisa_1_1thread__safety_a56c3b93d4a568cdd645c014f015d6854}{\_mutex}}\};}
\DoxyCodeLine{00018\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespaceluisa_afecc703e5abfd2fcd6f342e3e345249e}{luisa::invoke}}(std::forward<F>(f));}
\DoxyCodeLine{00019\ \ \ \ \ \}}
\DoxyCodeLine{00020\ \};}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{keyword}{template}<>}
\DoxyCodeLine{00023\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classluisa_1_1thread__safety}{thread\_safety}}<\mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}}>\ \{}
\DoxyCodeLine{00024\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ F>}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keyword}{decltype}(\textcolor{keyword}{auto})\ \mbox{\hyperlink{classluisa_1_1thread__safety_3_01void_01_4_ab575e5e91e79f1e8b8b3d5b29763f71f}{with\_lock}}(F\ \&\&f)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespaceluisa_afecc703e5abfd2fcd6f342e3e345249e}{luisa::invoke}}(std::forward<F>(f));}
\DoxyCodeLine{00028\ \ \ \ \ \}}
\DoxyCodeLine{00029\ \};}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{keyword}{template}<\textcolor{keywordtype}{bool}\ thread\_safe,\ \textcolor{keyword}{typename}\ Mutex\ =\ std::mutex>}
\DoxyCodeLine{00032\ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespaceluisa_a77844fbf4e3c9a0d6dd2aaa2265f4f5d}{conditional\_mutex}}\ =\ std::conditional<thread\_safe,\ Mutex,\ void>;}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{keyword}{template}<\textcolor{keywordtype}{bool}\ thread\_safe,\ \textcolor{keyword}{typename}\ Mutex\ =\ std::mutex>}
\DoxyCodeLine{00035\ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespaceluisa_a4e37421b7b6f5ca61b11cd6e88ffdaa2}{conditional\_mutex\_t}}\ =\ \textcolor{keyword}{typename}\ \mbox{\hyperlink{namespaceluisa_a77844fbf4e3c9a0d6dd2aaa2265f4f5d}{conditional\_mutex<thread\_safe,\ Mutex>::type}};}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \}\textcolor{comment}{//\ namespace\ luisa}}
\DoxyCodeLine{00038\ }

\end{DoxyCode}
