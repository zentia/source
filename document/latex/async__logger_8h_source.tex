\doxysection{async\+\_\+logger.\+h}
\hypertarget{async__logger_8h_source}{}\label{async__logger_8h_source}\index{runtime/spdlog/include/spdlog/async\_logger.h@{runtime/spdlog/include/spdlog/async\_logger.h}}
\mbox{\hyperlink{async__logger_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright(c)\ 2015-\/present,\ Gabi\ Melman\ \&\ spdlog\ contributors.}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Distributed\ under\ the\ MIT\ License\ (http://opensource.org/licenses/MIT)}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{comment}{//\ Fast\ asynchronous\ logger.}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ Uses\ pre\ allocated\ queue.}}
\DoxyCodeLine{00008\ \textcolor{comment}{//\ Creates\ a\ single\ back\ thread\ to\ pop\ messages\ from\ the\ queue\ and\ log\ them.}}
\DoxyCodeLine{00009\ \textcolor{comment}{//}}
\DoxyCodeLine{00010\ \textcolor{comment}{//\ Upon\ each\ log\ write\ the\ logger:}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ \ \ \ 1.\ Checks\ if\ its\ log\ level\ is\ enough\ to\ log\ the\ message}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ \ \ \ 2.\ Push\ a\ new\ copy\ of\ the\ message\ to\ a\ queue\ (or\ block\ the\ caller\ until}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ \ \ \ space\ is\ available\ in\ the\ queue)}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ Upon\ destruction,\ logs\ all\ remaining\ messages\ in\ the\ queue\ before}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ destructing..}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{logger_8h}{spdlog/logger.h}}>}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacespdlog}{spdlog}}\ \{}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{comment}{//\ Async\ overflow\ policy\ -\/\ block\ by\ default.}}
\DoxyCodeLine{00022\ \textcolor{keyword}{enum\ class}\ \mbox{\hyperlink{namespacespdlog_a42e109759a11c9514d3f6313a7709852}{async\_overflow\_policy}}\ \{}
\DoxyCodeLine{00023\ \ \ \ \ \mbox{\hyperlink{namespacespdlog_a42e109759a11c9514d3f6313a7709852a14511f2f5564650d129ca7cabc333278}{block}},\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Block\ until\ message\ can\ be\ enqueued}}
\DoxyCodeLine{00024\ \ \ \ \ \mbox{\hyperlink{namespacespdlog_a42e109759a11c9514d3f6313a7709852a6d09cc54ae10145444aa2f43fe46d9f2}{overrun\_oldest}},\ \ \textcolor{comment}{//\ Discard\ oldest\ message\ in\ the\ queue\ if\ full\ when\ trying\ to}}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ add\ new\ item.}}
\DoxyCodeLine{00026\ \ \ \ \ \mbox{\hyperlink{namespacespdlog_a42e109759a11c9514d3f6313a7709852a01d8a32c7a8e6fe0dcffb13a73b98392}{discard\_new}}\ \ \ \ \ \ \textcolor{comment}{//\ Discard\ new\ message\ if\ the\ queue\ is\ full\ when\ trying\ to\ add\ new\ item.}}
\DoxyCodeLine{00027\ \};}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \textcolor{keyword}{namespace\ }details\ \{}
\DoxyCodeLine{00030\ \textcolor{keyword}{class\ }\mbox{\hyperlink{namespacespdlog_a16a3355d0b9d9341212a9948bb9fa362}{thread\_pool}};}
\DoxyCodeLine{00031\ \}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{keyword}{class\ }\mbox{\hyperlink{common_8h_a52ddbd25f1bb074a1b09e10a3e5b177d}{SPDLOG\_API}}\ \mbox{\hyperlink{classspdlog_1_1async__logger_a2a74bf8d8d850ea760396ba8ae55d552}{async\_logger}}\ final\ :\ \textcolor{keyword}{public}\ std::enable\_shared\_from\_this<async\_logger>,}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}\ \mbox{\hyperlink{classspdlog_1_1logger_a441b6358c8df8fdc2367c9977b3c6fc2}{logger}}\ \{}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classspdlog_1_1details_1_1thread__pool}{details::thread\_pool}};}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ It>}
\DoxyCodeLine{00039\ \ \ \ \ \mbox{\hyperlink{classspdlog_1_1async__logger_a2a74bf8d8d850ea760396ba8ae55d552}{async\_logger}}(std::string\ logger\_name,}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ It\ begin,}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ It\ end,}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::weak\_ptr<details::thread\_pool>\ tp,}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacespdlog_a42e109759a11c9514d3f6313a7709852}{async\_overflow\_policy}}\ overflow\_policy\ =\ \mbox{\hyperlink{namespacespdlog_a42e109759a11c9514d3f6313a7709852a14511f2f5564650d129ca7cabc333278}{async\_overflow\_policy::block}})}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classspdlog_1_1logger_a441b6358c8df8fdc2367c9977b3c6fc2}{logger}}(\mbox{\hyperlink{namespacestd}{std}}::move(logger\_name),\ begin,\ end),}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classspdlog_1_1async__logger_a5886796bb52a4ec9a76a9229ad514886}{thread\_pool\_}}(\mbox{\hyperlink{namespacestd}{std}}::move(tp)),}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classspdlog_1_1async__logger_acda856f17834dbd0295271511c4fd64f}{overflow\_policy\_}}(overflow\_policy)\ \{\}}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \ \ \mbox{\hyperlink{classspdlog_1_1async__logger}{async\_logger}}(std::string\ logger\_name,}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacespdlog_acbc56e7c49e541842fd1592f80bcd694}{sinks\_init\_list}}\ sinks\_list,}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::weak\_ptr<details::thread\_pool>\ tp,}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacespdlog_a42e109759a11c9514d3f6313a7709852}{async\_overflow\_policy}}\ overflow\_policy\ =\ \mbox{\hyperlink{namespacespdlog_a42e109759a11c9514d3f6313a7709852a14511f2f5564650d129ca7cabc333278}{async\_overflow\_policy::block}});}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \mbox{\hyperlink{classspdlog_1_1async__logger}{async\_logger}}(std::string\ logger\_name,}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacespdlog_ace143432a1dd3e3ddde8949f014f90da}{sink\_ptr}}\ single\_sink,}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::weak\_ptr<details::thread\_pool>\ tp,}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacespdlog_a42e109759a11c9514d3f6313a7709852}{async\_overflow\_policy}}\ overflow\_policy\ =\ \mbox{\hyperlink{namespacespdlog_a42e109759a11c9514d3f6313a7709852a14511f2f5564650d129ca7cabc333278}{async\_overflow\_policy::block}});}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ std::shared\_ptr<logger>\ clone(std::string\ new\_name)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keywordtype}{void}\ sink\_it\_(\textcolor{keyword}{const}\ \mbox{\hyperlink{structspdlog_1_1details_1_1log__msg}{details::log\_msg}}\ \&msg)\ \textcolor{keyword}{override};}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keywordtype}{void}\ flush\_()\ \textcolor{keyword}{override};}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keywordtype}{void}\ backend\_sink\_it\_(\textcolor{keyword}{const}\ \mbox{\hyperlink{structspdlog_1_1details_1_1log__msg}{details::log\_msg}}\ \&incoming\_log\_msg);}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keywordtype}{void}\ backend\_flush\_();}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00067\ \ \ \ \ std::weak\_ptr<details::thread\_pool>\ \mbox{\hyperlink{classspdlog_1_1async__logger_a5886796bb52a4ec9a76a9229ad514886}{thread\_pool\_}};}
\DoxyCodeLine{00068\ \ \ \ \ \mbox{\hyperlink{namespacespdlog_a42e109759a11c9514d3f6313a7709852}{async\_overflow\_policy}}\ \mbox{\hyperlink{classspdlog_1_1async__logger_acda856f17834dbd0295271511c4fd64f}{overflow\_policy\_}};}
\DoxyCodeLine{00069\ \};}
\DoxyCodeLine{00070\ \}\ \ \textcolor{comment}{//\ namespace\ spdlog}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \textcolor{preprocessor}{\#ifdef\ SPDLOG\_HEADER\_ONLY}}
\DoxyCodeLine{00073\ \textcolor{preprocessor}{\ \ \ \ \#include\ "{}\mbox{\hyperlink{async__logger-inl_8h}{async\_logger-\/inl.h}}"{}}}
\DoxyCodeLine{00074\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
