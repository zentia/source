\doxysection{moir\+\_\+queue.\+h}
\hypertarget{intrusive_2moir__queue_8h_source}{}\label{intrusive_2moir__queue_8h_source}\index{external/libcds/cds/intrusive/moir\_queue.h@{external/libcds/cds/intrusive/moir\_queue.h}}
\mbox{\hyperlink{intrusive_2moir__queue_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Copyright\ (c)\ 2006-\/2018\ Maxim\ Khizhinsky}}
\DoxyCodeLine{00002\ \textcolor{comment}{//}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ Distributed\ under\ the\ Boost\ Software\ License,\ Version\ 1.0.\ (See\ accompanying}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ file\ LICENSE\ or\ copy\ at\ http://www.boost.org/LICENSE\_1\_0.txt)}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#ifndef\ CDSLIB\_INTRUSIVE\_MOIR\_QUEUE\_H}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#define\ CDSLIB\_INTRUSIVE\_MOIR\_QUEUE\_H}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{intrusive_2msqueue_8h}{cds/intrusive/msqueue.h}}>}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacecds}{cds}}\ \{\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacecds_1_1intrusive}{intrusive}}\ \{}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ GC,\ \textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ Traits\ =\ cds::\textcolor{keywordtype}{int}rusive::msqueue::traits>}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classcds_1_1intrusive_1_1_moir_queue}{MoirQueue}}:\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classcds_1_1intrusive_1_1_m_s_queue_a592c167532cb11f47da5cac01d5e7c85}{MSQueue}}<\ GC,\ T,\ Traits\ >}
\DoxyCodeLine{00087\ \ \ \ \ \{}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \textcolor{comment}{//@cond}}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classcds_1_1intrusive_1_1_m_s_queue_a592c167532cb11f47da5cac01d5e7c85}{MSQueue<\ GC,\ T,\ Traits\ >}}\ base\_class;}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ base\_class::node\_type\ \mbox{\hyperlink{classcds_1_1intrusive_1_1_m_s_queue_abbb857c44849eff8d26bd280bd8572f2}{node\_type}};}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \textcolor{comment}{//@endcond}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \textcolor{comment}{//@cond}}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ base\_class::value\_type\ \mbox{\hyperlink{classcds_1_1intrusive_1_1_m_s_queue_aa7a573590ee813bb066a63c862760193}{value\_type}};}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ base\_class::back\_off\ \ \ \mbox{\hyperlink{classcds_1_1intrusive_1_1_m_s_queue_a19f75b552b60516d8dd4847c127b3cc1}{back\_off}};}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ base\_class::gc\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcds_1_1intrusive_1_1_m_s_queue_aa3a20546d020a478a4942728533801d1}{gc}};}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ base\_class::node\_traits\ \mbox{\hyperlink{classcds_1_1intrusive_1_1_m_s_queue_a7da513814196d71f868b6cc227501cf9}{node\_traits}};}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ base\_class::memory\_model\ \ \ \mbox{\hyperlink{classcds_1_1intrusive_1_1_m_s_queue_a916ad5e018e31bda1f52b903f628a3ca}{memory\_model}};}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \textcolor{comment}{//@endcond}}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \textcolor{keyword}{template}\ <\ \textcolor{keyword}{typename}\ GC2,\ \textcolor{keyword}{typename}\ T2,\ \textcolor{keyword}{typename}\ Traits2\ >}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structcds_1_1intrusive_1_1_moir_queue_1_1rebind}{rebind}}\ \{}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classcds_1_1intrusive_1_1_moir_queue}{MoirQueue<\ GC2,\ T2,\ Traits2>}}\ \mbox{\hyperlink{structcds_1_1intrusive_1_1_moir_queue_1_1rebind_a391ec8c3d07b8d8071b1a1562517db7c}{other}}\ \ \ ;\ \ \ }
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \textcolor{comment}{//@cond}}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ base\_class::dequeue\_result\ dequeue\_result;}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ do\_dequeue(\ dequeue\_result\&\ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}\ )}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcds_1_1intrusive_1_1_m_s_queue_a19f75b552b60516d8dd4847c127b3cc1}{back\_off}}\ bkoff;}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcds_1_1intrusive_1_1_m_s_queue_abbb857c44849eff8d26bd280bd8572f2}{node\_type}}\ *\ pNext;}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcds_1_1intrusive_1_1_m_s_queue_abbb857c44849eff8d26bd280bd8572f2}{node\_type}}\ *\ \mbox{\hyperlink{ittnotify__static_8h_ae68700d2ebda197674e2fdd0f916f00c}{h}};}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\ \textcolor{keyword}{true}\ )\ \{}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ittnotify__static_8h_ae68700d2ebda197674e2fdd0f916f00c}{h}}\ =\ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}.guards.protect(\ 0,\ base\_class::m\_pHead,\ [](\ \mbox{\hyperlink{classcds_1_1intrusive_1_1_m_s_queue_abbb857c44849eff8d26bd280bd8572f2}{node\_type}}\ *\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ )\ -\/>\ \mbox{\hyperlink{classcds_1_1intrusive_1_1_m_s_queue_aa7a573590ee813bb066a63c862760193}{value\_type}}\ *\ \{\ \textcolor{keywordflow}{return}\ node\_traits::to\_value\_ptr(\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ );\});}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pNext\ =\ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}.guards.protect(\ 1,\ \mbox{\hyperlink{ittnotify__static_8h_ae68700d2ebda197674e2fdd0f916f00c}{h}}-\/>m\_pNext,\ [](\ \mbox{\hyperlink{classcds_1_1intrusive_1_1_m_s_queue_abbb857c44849eff8d26bd280bd8572f2}{node\_type}}\ *\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ )\ -\/>\ \mbox{\hyperlink{classcds_1_1intrusive_1_1_m_s_queue_aa7a573590ee813bb066a63c862760193}{value\_type}}\ *\ \{\ return\ node\_traits::to\_value\_ptr(\ p\ );\});}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ pNext\ ==\ \textcolor{keyword}{nullptr}\ )\ \{}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ base\_class::m\_Stat.onEmptyDequeue();}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \ \ \ \textcolor{comment}{//\ queue\ is\ empty}}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ base\_class::m\_pHead.compare\_exchange\_strong(\ \mbox{\hyperlink{ittnotify__static_8h_ae68700d2ebda197674e2fdd0f916f00c}{h}},\ pNext,\ memory\_model::memory\_order\_release,\ atomics::memory\_order\_relaxed\ ))\ \{}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcds_1_1intrusive_1_1_m_s_queue_abbb857c44849eff8d26bd280bd8572f2}{node\_type}}\ *\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ base\_class::m\_pTail.load(memory\_model::memory\_order\_acquire);}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{ittnotify__static_8h_ae68700d2ebda197674e2fdd0f916f00c}{h}}\ ==\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ )}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ base\_class::m\_pTail.compare\_exchange\_strong(\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}},\ pNext,\ memory\_model::memory\_order\_release,\ atomics::memory\_order\_relaxed\ );}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ base\_class::m\_Stat.onDequeueRace();}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bkoff();}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/base\_class::m\_ItemCounter;}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ base\_class::m\_Stat.onDequeue();}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}.pHead\ =\ \mbox{\hyperlink{ittnotify__static_8h_ae68700d2ebda197674e2fdd0f916f00c}{h}};}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}.pNext\ =\ pNext;}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \textcolor{comment}{//@endcond}}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcds_1_1intrusive_1_1_m_s_queue_aa7a573590ee813bb066a63c862760193}{value\_type}}\ *\ \mbox{\hyperlink{classcds_1_1intrusive_1_1_moir_queue_aa431c9143fabead79bd134de5a251c46}{dequeue}}()}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \ \ \ \ dequeue\_result\ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}};}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ do\_dequeue(\ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}\ ))\ \{}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ base\_class::dispose\_result(\ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}\ );}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ node\_traits::to\_value\_ptr(\ *\mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}.pNext\ );}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classcds_1_1intrusive_1_1_m_s_queue_aa7a573590ee813bb066a63c862760193}{value\_type}}\ *\ \mbox{\hyperlink{classcds_1_1intrusive_1_1_moir_queue_a0837edfd31980540e3407c217171aa82}{pop}}()}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classcds_1_1intrusive_1_1_moir_queue_aa431c9143fabead79bd134de5a251c46}{dequeue}}();}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00167\ \ \ \ \ \};}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \}\}\ \textcolor{comment}{//\ namespace\ cds::intrusive}}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ \#ifndef\ CDSLIB\_INTRUSIVE\_MOIR\_QUEUE\_H}}

\end{DoxyCode}
