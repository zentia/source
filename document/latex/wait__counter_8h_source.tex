\doxysection{wait\+\_\+counter.\+h}
\hypertarget{wait__counter_8h_source}{}\label{wait__counter_8h_source}\index{external/taskflow/3rd-\/party/tbb/src/rml/server/wait\_counter.h@{external/taskflow/3rd-\/party/tbb/src/rml/server/wait\_counter.h}}
\mbox{\hyperlink{wait__counter_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ \ \ \ Copyright\ (c)\ 2005-\/2020\ Intel\ Corporation}}
\DoxyCodeLine{00003\ \textcolor{comment}{}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ \ \ \ Licensed\ under\ the\ Apache\ License,\ Version\ 2.0\ (the\ "{}License"{});}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ \ \ \ you\ may\ not\ use\ this\ file\ except\ in\ compliance\ with\ the\ License.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ \ \ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00007\ \textcolor{comment}{}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ \ \ \ \ \ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00009\ \textcolor{comment}{}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ \ \ \ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,\ software}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ \ \ \ distributed\ under\ the\ License\ is\ distributed\ on\ an\ "{}AS\ IS"{}\ BASIS,}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ \ \ \ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY\ KIND,\ either\ express\ or\ implied.}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ \ \ \ See\ the\ License\ for\ the\ specific\ language\ governing\ permissions\ and}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ \ \ \ limitations\ under\ the\ License.}}
\DoxyCodeLine{00015\ \textcolor{comment}{*/}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#ifndef\ \_\_RML\_wait\_counter\_H}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#define\ \_\_RML\_wait\_counter\_H}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{thread__monitor_8h}{thread\_monitor.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{external_2taskflow_23rd-party_2tbb_2include_2tbb_2atomic_8h}{tbb/atomic.h}}"{}}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacerml}{rml}}\ \{}
\DoxyCodeLine{00024\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacerml_1_1internal}{internal}}\ \{}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_af1940b3cadd13ec388e8c75b359b177f}{wait\_counter}}\ \{}
\DoxyCodeLine{00027\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1thread__monitor}{thread\_monitor}}\ \mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_a6a85d764062df6445de08b7a5cc94b66}{my\_monitor}};}
\DoxyCodeLine{00028\ \ \ \ \ tbb::atomic<int>\ \mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_a854819b834176cfc0b15a439c29ed110}{my\_count}};}
\DoxyCodeLine{00029\ \ \ \ \ tbb::atomic<int>\ \mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_aea38763b0e8ef1c8dd80e5c3e11b8cc6}{n\_transients}};}
\DoxyCodeLine{00030\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00031\ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_af1940b3cadd13ec388e8c75b359b177f}{wait\_counter}}()\ \{\ }
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ "{}1"{}\ here\ is\ subtracted\ by\ the\ call\ to\ "{}wait"{}.}}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_a854819b834176cfc0b15a439c29ed110}{my\_count}}=1;}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_aea38763b0e8ef1c8dd80e5c3e11b8cc6}{n\_transients}}=0;}
\DoxyCodeLine{00035\ \ \ \ \ \}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_a5b71a7c925b1db60e227312d63f415a2}{wait}}()\ \{}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ k\ =\ -\/-\/\mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_a854819b834176cfc0b15a439c29ed110}{my\_count}};}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ k>=0,\ \textcolor{stringliteral}{"{}counter\ underflow"{}}\ );}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ k>0\ )\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1thread__monitor_1_1cookie}{thread\_monitor::cookie}}\ \mbox{\hyperlink{bench_vec_add_8cpp_a41689956983587b085f9da3e48f31d99}{c}};}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_a6a85d764062df6445de08b7a5cc94b66}{my\_monitor}}.prepare\_wait(\mbox{\hyperlink{bench_vec_add_8cpp_a41689956983587b085f9da3e48f31d99}{c}});}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_a854819b834176cfc0b15a439c29ed110}{my\_count}}\ )}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_a6a85d764062df6445de08b7a5cc94b66}{my\_monitor}}.commit\_wait(\mbox{\hyperlink{bench_vec_add_8cpp_a41689956983587b085f9da3e48f31d99}{c}});}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ }
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_a6a85d764062df6445de08b7a5cc94b66}{my\_monitor}}.cancel\_wait();}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ \mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_aea38763b0e8ef1c8dd80e5c3e11b8cc6}{n\_transients}}>0\ )}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ibm__aix51_8h_a2b17e6e4504bddf60a920f609fc46ea6}{\_\_TBB\_Yield}}();}
\DoxyCodeLine{00052\ \ \ \ \ \}}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_ac47d93ec64386be7aab9a495ffbb6242}{operator++}}()\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ ++\mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_a854819b834176cfc0b15a439c29ed110}{my\_count}};}
\DoxyCodeLine{00055\ \ \ \ \ \}}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_a805575a58599e3e31acb2c51d0257c01}{operator-\/-\/}}()\ \{}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ ++\mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_aea38763b0e8ef1c8dd80e5c3e11b8cc6}{n\_transients}};}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ k\ =\ -\/-\/\mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_a854819b834176cfc0b15a439c29ed110}{my\_count}};}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{tbb__stddef_8h_a7b58d28a34a1717e2ddb591f00658b10}{\_\_TBB\_ASSERT}}(\ k>=0,\ \textcolor{stringliteral}{"{}counter\ underflow"{}}\ );}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ k==0\ )\ }
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_a6a85d764062df6445de08b7a5cc94b66}{my\_monitor}}.notify();}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ -\/-\/\mbox{\hyperlink{classrml_1_1internal_1_1wait__counter_aea38763b0e8ef1c8dd80e5c3e11b8cc6}{n\_transients}};}
\DoxyCodeLine{00063\ \ \ \ \ \}}
\DoxyCodeLine{00064\ \};}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \}\ \textcolor{comment}{//\ namespace\ internal}}
\DoxyCodeLine{00067\ \}\ \textcolor{comment}{//\ namespace\ rml}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_\_RML\_wait\_counter\_H\ */}\textcolor{preprocessor}{}}

\end{DoxyCode}
