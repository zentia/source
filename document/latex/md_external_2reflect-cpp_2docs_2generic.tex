\chapter{\texorpdfstring{$<$}{<}tt\texorpdfstring{$>$}{>}rfl\+::Generic\texorpdfstring{$<$}{<}/tt\texorpdfstring{$>$}{>}}
\hypertarget{md_external_2reflect-cpp_2docs_2generic}{}\label{md_external_2reflect-cpp_2docs_2generic}\index{$<$tt$>$rfl::Generic$<$/tt$>$@{$<$tt$>$rfl::Generic$<$/tt$>$}}
\label{md_external_2reflect-cpp_2docs_2generic_autotoc_md580}%
\Hypertarget{md_external_2reflect-cpp_2docs_2generic_autotoc_md580}%


reflect-\/cpp is intended to be used to directly parse into structs. Doing this is more efficient, more convenient and also safer.

But in some cases, we simply cannot anticipate the complete structure of the data at compile time. For these cases, we have {\ttfamily \doxylink{classrfl_1_1_generic}{rfl\+::\+Generic}}.

Note that generics are not supported for Avro.

{\ttfamily \doxylink{classrfl_1_1_generic}{rfl\+::\+Generic}} is a convenience wrapper around the following type\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{std::variant<bool,\ int,\ double,\ std::string,\ Object,\ Array,\ std::nullopt\_t>;}

\end{DoxyCode}


{\ttfamily \doxylink{class_object}{Object}} and {\ttfamily Array} are defined as follows\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using\ }\mbox{\hyperlink{test__blocked__range_8cpp_a49d74db560180bce53e2fbea9d2f1f51}{Array}}\ =\ std::vector<Generic>;}
\DoxyCodeLine{\textcolor{keyword}{using\ }\mbox{\hyperlink{class_object}{Object}}\ =\ \mbox{\hyperlink{classrfl_1_1_object}{rfl::Object<Generic>}};}

\end{DoxyCode}


In other words, {\ttfamily \doxylink{classrfl_1_1_generic}{rfl\+::\+Generic}} encompasses all types that can be expressed in JSON.

It can be used as follows\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{auto}\ bart\ =\ \mbox{\hyperlink{classrfl_1_1_generic_a69cd2ced33f4a01c6c7f03feca869ed2}{rfl::Generic::Object}}();}
\DoxyCodeLine{bart[\textcolor{stringliteral}{"{}first\_name"{}}]\ =\ \textcolor{stringliteral}{"{}Bart"{}};}
\DoxyCodeLine{bart[\textcolor{stringliteral}{"{}last\_name"{}}]\ =\ \textcolor{stringliteral}{"{}Simpson"{}};}
\DoxyCodeLine{bart[\textcolor{stringliteral}{"{}age"{}}]\ =\ 10;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{auto}\ lisa\ =\ \mbox{\hyperlink{classrfl_1_1_generic_a69cd2ced33f4a01c6c7f03feca869ed2}{rfl::Generic::Object}}();}
\DoxyCodeLine{lisa[\textcolor{stringliteral}{"{}first\_name"{}}]\ =\ \textcolor{stringliteral}{"{}Lisa"{}};}
\DoxyCodeLine{lisa[\textcolor{stringliteral}{"{}last\_name"{}}]\ =\ \textcolor{stringliteral}{"{}Simpson"{}};}
\DoxyCodeLine{lisa[\textcolor{stringliteral}{"{}age"{}}]\ =\ 8;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{auto}\ maggie\ =\ \mbox{\hyperlink{classrfl_1_1_generic_a69cd2ced33f4a01c6c7f03feca869ed2}{rfl::Generic::Object}}();}
\DoxyCodeLine{maggie[\textcolor{stringliteral}{"{}first\_name"{}}]\ =\ \textcolor{stringliteral}{"{}Lisa"{}};}
\DoxyCodeLine{maggie[\textcolor{stringliteral}{"{}last\_name"{}}]\ =\ \textcolor{stringliteral}{"{}Simpson"{}};}
\DoxyCodeLine{maggie[\textcolor{stringliteral}{"{}age"{}}]\ =\ 0;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{auto}\ homer\ =\ \mbox{\hyperlink{classrfl_1_1_generic_a69cd2ced33f4a01c6c7f03feca869ed2}{rfl::Generic::Object}}();}
\DoxyCodeLine{homer[\textcolor{stringliteral}{"{}first\_name"{}}]\ =\ \textcolor{stringliteral}{"{}Homer"{}};}
\DoxyCodeLine{homer[\textcolor{stringliteral}{"{}last\_name"{}}]\ =\ \textcolor{stringliteral}{"{}Simpson"{}};}
\DoxyCodeLine{homer[\textcolor{stringliteral}{"{}age"{}}]\ =\ 45;}
\DoxyCodeLine{homer[\textcolor{stringliteral}{"{}children"{}}]\ =\ \mbox{\hyperlink{classrfl_1_1_generic_a5f2e53b8d7361b7ef76f10cd4f5a69c0}{rfl::Generic::Array}}(\{bart,\ lisa,\ maggie\});}

\end{DoxyCode}


The resulting JSON strings looks as follows\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\{"{}first\_name"{}:"{}Homer"{},"{}last\_name"{}:"{}Simpson"{},"{}age"{}:45,"{}children"{}:[\{"{}first\_name"{}:"{}Bart"{},"{}last\_name"{}:"{}Simpson"{},"{}age"{}:10\},\{"{}first\_name"{}:"{}Lisa"{},"{}last\_name"{}:"{}Simpson"{},"{}age"{}:8\},\{"{}first\_name"{}:"{}Lisa"{},"{}last\_name"{}:"{}Simpson"{},"{}age"{}:0\}]\}}

\end{DoxyCode}


{\ttfamily \doxylink{classrfl_1_1_generic}{rfl\+::\+Generic}} contains some convenience methods that allow you to handle parsed data\+:

You can retrieve the underlying {\ttfamily std\+::variant} using {\ttfamily .\doxylink{stdlist__overload_8cpp_a120a90058439faee14791b33f94c0693}{get()}}. This then allows you to handle allow possible seven cases using the \href{https://en.cppreference.com/w/cpp/utility/variant/visit}{\texttt{ visitor pattern}}.

If you have a guess what the types of a particular field might be, you can use any of the seven convenience methods {\ttfamily .to\+\_\+array()}, {\ttfamily .to\+\_\+bool()}, {\ttfamily .to\+\_\+double()}, {\ttfamily .to\+\_\+int()}, {\ttfamily .to\+\_\+null()}, {\ttfamily .to\+\_\+object()}, {\ttfamily .\doxylink{spdlog_2include_2spdlog_2fmt_2bundled_2format_8h_a5aca7e9d14d858d6f3fdc063d66840f8}{to\+\_\+string()}}. Each of these methods will return an {\ttfamily \doxylink{classrfl_1_1_result}{rfl\+::\+Result}\texorpdfstring{$<$}{<}...\texorpdfstring{$>$}{>}} with the corresponding type, if the {\ttfamily \doxylink{classrfl_1_1_generic}{rfl\+::\+Generic}} does indeed contain such a type.

If you prefer, you can also use the following seven convenience {\itshape functions}\+:

{\ttfamily rfl\+::to\+\_\+array(...)}, {\ttfamily rfl\+::to\+\_\+bool(...)}, {\ttfamily rfl\+::to\+\_\+double(...)}, {\ttfamily rfl\+::to\+\_\+int(...)}, {\ttfamily \doxylink{namespacerfl_a058699e865d1b833264ae9c799108ddb}{rfl\+::to\+\_\+null}}, {\ttfamily rfl\+::to\+\_\+object(...)}, {\ttfamily rfl\+::to\+\_\+string(...)}.

These functions are particularly useful for monadic error handling\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{auto}\ homer\ =\ \mbox{\hyperlink{classrfl_1_1_generic_a69cd2ced33f4a01c6c7f03feca869ed2}{rfl::Generic::Object}}();}
\DoxyCodeLine{...}
\DoxyCodeLine{rfl::Result<\textcolor{keywordtype}{int}>\ \mbox{\hyperlink{namespacectre_af1ab492eac22f0bfaebe58d37347ce28a7d637d275668ed6d41a9b97e6ad3a556}{age}}\ =\ homer.get(\textcolor{stringliteral}{"{}age"{}}).and\_then(\mbox{\hyperlink{namespacerfl_a86e7d46de9fc0c171f48e6d078d1597e}{rfl::to\_int}});}

\end{DoxyCode}


In this particular instance, we know that {\ttfamily homer} is an {\ttfamily \doxylink{classrfl_1_1_generic_a69cd2ced33f4a01c6c7f03feca869ed2}{rfl\+::\+Generic\+::\+Object}}. We assume that it has a field named {\ttfamily age} which we also assume is an integer. In the end, we will get an {\ttfamily \doxylink{classrfl_1_1_result}{rfl\+::\+Result}\texorpdfstring{$<$}{<}int\texorpdfstring{$>$}{>}} which will contain an integer, if both of our assumptions are correct and an error otherwise.

If we want to retrieve the age, we can use the {\ttfamily .\doxylink{imgui__impl__opengl3__loader_8h_abe8e049f756b5ba547bda825af81b645}{value()}} method\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{auto}\ homer\ =\ \mbox{\hyperlink{classrfl_1_1_generic_a69cd2ced33f4a01c6c7f03feca869ed2}{rfl::Generic::Object}}();}
\DoxyCodeLine{...}
\DoxyCodeLine{int\ \mbox{\hyperlink{namespacectre_af1ab492eac22f0bfaebe58d37347ce28a7d637d275668ed6d41a9b97e6ad3a556}{age}}\ =\ homer.get(\textcolor{stringliteral}{"{}age"{}}).and\_then(\mbox{\hyperlink{namespacerfl_a86e7d46de9fc0c171f48e6d078d1597e}{rfl::to\_int}}).value();}

\end{DoxyCode}


This will throw an exception if any of our assumptions are false.

Please refer to the part of the documentation on {\ttfamily \doxylink{classrfl_1_1_result}{rfl\+::\+Result}} to learn more about monadic error handling.\hypertarget{md_external_2reflect-cpp_2docs_2generic_autotoc_md581}{}\doxysection{\texorpdfstring{{\ttfamily rfl\+::to\+\_\+generic} and {\ttfamily rfl\+::from\+\_\+generic}}{{\ttfamily rfl\+::to\+\_\+generic} and {\ttfamily rfl\+::from\+\_\+generic}}}\label{md_external_2reflect-cpp_2docs_2generic_autotoc_md581}
You can transform any struct that can be converted to a JSON to the equivalent generic instead.

In other words\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{assert(\mbox{\hyperlink{namespacerfl_1_1json_af39a23539424555b8c970d12a58e547f}{rfl::json::write}}(my\_struct)\ ==\ \mbox{\hyperlink{namespacerfl_1_1json_af39a23539424555b8c970d12a58e547f}{rfl::json::write}}(\mbox{\hyperlink{namespacerfl_adbb735d9363cf89e3f4ec8ed12089775}{rfl::to\_generic}}(my\_struct)));}

\end{DoxyCode}


And\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{assert(\mbox{\hyperlink{namespacerfl_1_1json_a905573518eca04a9c269d1bb32de7dd1}{rfl::json::read<rfl::Generic>}}(\mbox{\hyperlink{namespacerfl_1_1json_af39a23539424555b8c970d12a58e547f}{rfl::json::write}}(my\_struct)).\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_abe8e049f756b5ba547bda825af81b645}{value}}()\ ==\ \mbox{\hyperlink{namespacerfl_adbb735d9363cf89e3f4ec8ed12089775}{rfl::to\_generic}}(my\_struct));}

\end{DoxyCode}


What is more, you can apply any processors you want to\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{assert(\mbox{\hyperlink{namespacerfl_1_1json_af39a23539424555b8c970d12a58e547f}{rfl::json::write<rfl::SnakeCaseToCamelCase>}}(my\_struct)\ ==\ \mbox{\hyperlink{namespacerfl_1_1json_af39a23539424555b8c970d12a58e547f}{rfl::json::write}}(\mbox{\hyperlink{namespacerfl_adbb735d9363cf89e3f4ec8ed12089775}{rfl::to\_generic<rfl::SnakeCaseToCamelCase>}}(my\_struct)));}
\DoxyCodeLine{}
\DoxyCodeLine{assert(\mbox{\hyperlink{namespacerfl_1_1json_a905573518eca04a9c269d1bb32de7dd1}{rfl::json::read<rfl::Generic>}}(\mbox{\hyperlink{namespacerfl_1_1json_af39a23539424555b8c970d12a58e547f}{rfl::json::write<rfl::SnakeCaseToCamelCase>}}(my\_struct)).\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_abe8e049f756b5ba547bda825af81b645}{value}}()\ ==\ \mbox{\hyperlink{namespacerfl_adbb735d9363cf89e3f4ec8ed12089775}{rfl::to\_generic<rfl::SnakeCaseToCamelCase>}}(my\_struct));}

\end{DoxyCode}


Conversely, the same statements hold for reading. In other words\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{assert(\mbox{\hyperlink{namespacerfl_1_1json_a905573518eca04a9c269d1bb32de7dd1}{rfl::json::read<MyStruct>}}(my\_json\_string).\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_abe8e049f756b5ba547bda825af81b645}{value}}()\ ==\ \mbox{\hyperlink{namespacerfl_ad12b2a86e9ca1552b57d8c16341e51b6}{rfl::from\_generic<MyStruct>}}(\mbox{\hyperlink{namespacerfl_1_1json_a905573518eca04a9c269d1bb32de7dd1}{rfl::json::read<rfl::Generic>}}(my\_json\_string).\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_abe8e049f756b5ba547bda825af81b645}{value}}()).\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_abe8e049f756b5ba547bda825af81b645}{value}}());}

\end{DoxyCode}


Likewise, you can apply processors\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{assert(\mbox{\hyperlink{namespacerfl_1_1json_a905573518eca04a9c269d1bb32de7dd1}{rfl::json::read<MyStruct,\ rfl::SnakeCaseToCamelCase>}}(my\_json\_string).\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_abe8e049f756b5ba547bda825af81b645}{value}}()\ ==\ \mbox{\hyperlink{namespacerfl_ad12b2a86e9ca1552b57d8c16341e51b6}{rfl::from\_generic<MyStruct,\ rfl::SnakeCaseToCamelCase>}}(\mbox{\hyperlink{namespacerfl_1_1json_a905573518eca04a9c269d1bb32de7dd1}{rfl::json::read<rfl::Generic>}}(my\_json\_string).\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_abe8e049f756b5ba547bda825af81b645}{value}}()).\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_abe8e049f756b5ba547bda825af81b645}{value}}());}

\end{DoxyCode}


In fact, you can think of {\ttfamily \doxylink{namespacerfl_ad12b2a86e9ca1552b57d8c16341e51b6}{rfl\+::from\+\_\+generic}} and {\ttfamily \doxylink{namespacerfl_adbb735d9363cf89e3f4ec8ed12089775}{rfl\+::to\+\_\+generic}} as manifestations of the reader and writer interface. You could as well write {\ttfamily \doxylink{namespacerfl_1_1generic_ac1f914f269a30b5403e13c131b905108}{rfl\+::generic\+::read}\texorpdfstring{$<$}{<}...\texorpdfstring{$>$}{>}(...)} and {\ttfamily rfl\+::generic\+::write(...)}.

This can be used to dynamically build structs\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{struct\ }Person\ \{}
\DoxyCodeLine{\ \ \ \ std::string\ first\_name;}
\DoxyCodeLine{\ \ \ \ std::string\ last\_name;}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{namespacectre_af1ab492eac22f0bfaebe58d37347ce28a7d637d275668ed6d41a9b97e6ad3a556}{age}};}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{auto}\ bart\ =\ \mbox{\hyperlink{classrfl_1_1_generic_a69cd2ced33f4a01c6c7f03feca869ed2}{rfl::Generic::Object}}();}
\DoxyCodeLine{bart[\textcolor{stringliteral}{"{}first\_name"{}}]\ =\ \textcolor{stringliteral}{"{}Bart"{}};}
\DoxyCodeLine{bart[\textcolor{stringliteral}{"{}last\_name"{}}]\ =\ \textcolor{stringliteral}{"{}Simpson"{}};}
\DoxyCodeLine{bart[\textcolor{stringliteral}{"{}age"{}}]\ =\ 10;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ person\ =\ \mbox{\hyperlink{namespacerfl_ad12b2a86e9ca1552b57d8c16341e51b6}{rfl::from\_generic<Person>}}(bart).value();}

\end{DoxyCode}
 