\doxysection{tbb\+\_\+thread.\+cpp}
\hypertarget{tbb__thread_8cpp_source}{}\label{tbb__thread_8cpp_source}\index{external/taskflow/3rd-\/party/tbb/src/tbb/tbb\_thread.cpp@{external/taskflow/3rd-\/party/tbb/src/tbb/tbb\_thread.cpp}}
\mbox{\hyperlink{tbb__thread_8cpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ \ \ \ Copyright\ (c)\ 2005-\/2020\ Intel\ Corporation}}
\DoxyCodeLine{00003\ \textcolor{comment}{}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ \ \ \ Licensed\ under\ the\ Apache\ License,\ Version\ 2.0\ (the\ "{}License"{});}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ \ \ \ you\ may\ not\ use\ this\ file\ except\ in\ compliance\ with\ the\ License.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ \ \ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00007\ \textcolor{comment}{}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ \ \ \ \ \ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00009\ \textcolor{comment}{}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ \ \ \ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,\ software}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ \ \ \ distributed\ under\ the\ License\ is\ distributed\ on\ an\ "{}AS\ IS"{}\ BASIS,}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ \ \ \ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY\ KIND,\ either\ express\ or\ implied.}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ \ \ \ See\ the\ License\ for\ the\ specific\ language\ governing\ permissions\ and}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ \ \ \ limitations\ under\ the\ License.}}
\DoxyCodeLine{00015\ \textcolor{comment}{*/}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#if\ \_WIN32||\_WIN64}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ <process.h>}\ \ \ \ \ \ \ \ \textcolor{comment}{//\ \_beginthreadex()}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <errno.h>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tbb__misc_8h}{tbb\_misc.h}}"{}}\ \ \ \ \ \ \ \textcolor{comment}{//\ handle\_win\_error()}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tbb__stddef_8h}{tbb/tbb\_stddef.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tbb__thread_8h}{tbb/tbb\_thread.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tbb__allocator_8h}{tbb/tbb\_allocator.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{global__control_8h}{tbb/global\_control.h}}"{}}\ \textcolor{comment}{//\ thread\_stack\_size}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{governor_8h}{governor.h}}"{}}\ \ \ \ \ \ \ \textcolor{comment}{//\ default\_num\_threads()}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#if\ \_\_TBB\_WIN8UI\_SUPPORT}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ <thread>}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetbb}{tbb}}\ \{}
\DoxyCodeLine{00032\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetbb_1_1internal}{internal}}\ \{}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00035\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{namespacetbb_1_1internal_a858f99e1aa372076223cc923fb8c4914}{allocate\_closure\_v3}}(\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}}\ )}
\DoxyCodeLine{00036\ \{}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacetbb_1_1internal_a9f226bc3212761202602d0198c587b12}{allocate\_via\_handler\_v3}}(\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}}\ );}
\DoxyCodeLine{00038\ \}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00041\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacetbb_1_1internal_a1a803fb20d0d24abe173dad9b506d37d}{free\_closure\_v3}}(\ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}\ )}
\DoxyCodeLine{00042\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a09c594367453cbf1ac040fc9ff8396da}{deallocate\_via\_handler\_v3}}(\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}\ );}
\DoxyCodeLine{00044\ \}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_ab312527ce3848c27e18eedbf881fb943}{tbb\_thread\_v3::join}}()}
\DoxyCodeLine{00047\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_a4ddee0e2030f8fa947fd93f403178104}{joinable}}())}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a63370f16962aa553990e43ad197231b9}{handle\_perror}}(\ \mbox{\hyperlink{runtime_2_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2types_8h_a2d1678d5a7cc8ce499643f3b8957def4}{EINVAL}},\ \textcolor{stringliteral}{"{}tbb\_thread::join"{}}\ );\ \textcolor{comment}{//\ Invalid\ argument}}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{namespacetbb_1_1this__tbb__thread_aca0255d2952986275a6f2575118f822f}{this\_tbb\_thread::get\_id}}()\ ==\ \mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_ae98915bfeccaa90d6f13add0ee1ab33a}{get\_id}}())}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a63370f16962aa553990e43ad197231b9}{handle\_perror}}(\ EDEADLK,\ \textcolor{stringliteral}{"{}tbb\_thread::join"{}}\ );\ \textcolor{comment}{//\ Resource\ deadlock\ avoided}}
\DoxyCodeLine{00052\ \textcolor{preprocessor}{\#if\ \_WIN32||\_WIN64}}
\DoxyCodeLine{00053\ \textcolor{preprocessor}{\#if\ \_\_TBB\_WIN8UI\_SUPPORT}}
\DoxyCodeLine{00054\ \ \ \ \ std::thread*\ thread\_tmp=(std::thread*)my\_thread\_id;}
\DoxyCodeLine{00055\ \ \ \ \ thread\_tmp-\/>join();}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keyword}{delete}\ thread\_tmp;}
\DoxyCodeLine{00057\ \textcolor{preprocessor}{\#else\ }\textcolor{comment}{//\ \_\_TBB\_WIN8UI\_SUPPORT}}
\DoxyCodeLine{00058\ \ \ \ \ \mbox{\hyperlink{test__malloc__compliance_8cpp_ad342ac907eb044443153a22f964bf0af}{DWORD}}\ status\ =\ WaitForSingleObjectEx(\ \mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_a1c780ce0b3de1ac771bdad2a05e2cd60}{my\_handle}},\ INFINITE,\ \mbox{\hyperlink{tinycthread_8c_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}}\ );}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ status\ ==\ WAIT\_FAILED\ )}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_ab4841a5edb13e2982963a55e900a4812}{handle\_win\_error}}(\ GetLastError()\ );}
\DoxyCodeLine{00061\ \ \ \ \ BOOL\ close\_stat\ =\ CloseHandle(\ \mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_a1c780ce0b3de1ac771bdad2a05e2cd60}{my\_handle}}\ );}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ close\_stat\ ==\ 0\ )}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_ab4841a5edb13e2982963a55e900a4812}{handle\_win\_error}}(\ GetLastError()\ );}
\DoxyCodeLine{00064\ \ \ \ \ my\_thread\_id\ =\ 0;}
\DoxyCodeLine{00065\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ \_\_TBB\_WIN8UI\_SUPPORT}}
\DoxyCodeLine{00066\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keywordtype}{int}\ status\ =\ \mbox{\hyperlink{pthread__minport__windows_8h_ab55b290bca62946e18d5eb3c7a1c5114}{pthread\_join}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_a1c780ce0b3de1ac771bdad2a05e2cd60}{my\_handle}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordflow}{if}(\ status\ )}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a63370f16962aa553990e43ad197231b9}{handle\_perror}}(\ status,\ \textcolor{stringliteral}{"{}pthread\_join"{}}\ );}
\DoxyCodeLine{00070\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ \_WIN32||\_WIN64}}
\DoxyCodeLine{00071\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_a1c780ce0b3de1ac771bdad2a05e2cd60}{my\_handle}}\ =\ 0;}
\DoxyCodeLine{00072\ \}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_aed1dc35a70fc537682452a1c7bd77faf}{tbb\_thread\_v3::detach}}()\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_a4ddee0e2030f8fa947fd93f403178104}{joinable}}())}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a63370f16962aa553990e43ad197231b9}{handle\_perror}}(\ \mbox{\hyperlink{runtime_2_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2types_8h_a2d1678d5a7cc8ce499643f3b8957def4}{EINVAL}},\ \textcolor{stringliteral}{"{}tbb\_thread::detach"{}}\ );\ \textcolor{comment}{//\ Invalid\ argument}}
\DoxyCodeLine{00077\ \textcolor{preprocessor}{\#if\ \_WIN32||\_WIN64}}
\DoxyCodeLine{00078\ \ \ \ \ BOOL\ status\ =\ CloseHandle(\ \mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_a1c780ce0b3de1ac771bdad2a05e2cd60}{my\_handle}}\ );}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ status\ ==\ 0\ )}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_ab4841a5edb13e2982963a55e900a4812}{handle\_win\_error}}(\ GetLastError()\ );}
\DoxyCodeLine{00081\ \ \ \ \ my\_thread\_id\ =\ 0;}
\DoxyCodeLine{00082\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keywordtype}{int}\ status\ =\ pthread\_detach(\ \mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_a1c780ce0b3de1ac771bdad2a05e2cd60}{my\_handle}}\ );}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keywordflow}{if}(\ status\ )}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a63370f16962aa553990e43ad197231b9}{handle\_perror}}(\ status,\ \textcolor{stringliteral}{"{}pthread\_detach"{}}\ );}
\DoxyCodeLine{00086\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ \_WIN32||\_WIN64}}
\DoxyCodeLine{00087\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_a1c780ce0b3de1ac771bdad2a05e2cd60}{my\_handle}}\ =\ 0;}
\DoxyCodeLine{00088\ \}}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_a6c3adaab97c52bce29cb446752d05fe5}{tbb\_thread\_v3::internal\_start}}(\ \mbox{\hyperlink{tbb__thread_8h_ac40500cd2e6bda12237dc61749fee549}{\_\_TBB\_NATIVE\_THREAD\_ROUTINE\_PTR}}(start\_routine),}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ closure\ )\ \{}
\DoxyCodeLine{00092\ \textcolor{preprocessor}{\#if\ \_WIN32||\_WIN64}}
\DoxyCodeLine{00093\ \textcolor{preprocessor}{\#if\ \_\_TBB\_WIN8UI\_SUPPORT}}
\DoxyCodeLine{00094\ \ \ \ \ std::thread*\ thread\_tmp=\textcolor{keyword}{new}\ std::thread(start\_routine,\ closure);}
\DoxyCodeLine{00095\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_a1c780ce0b3de1ac771bdad2a05e2cd60}{my\_handle}}\ \ =\ thread\_tmp-\/>native\_handle();}
\DoxyCodeLine{00096\ \textcolor{comment}{//\ \ TODO:\ to\ find\ out\ the\ way\ to\ find\ thread\_id\ without\ GetThreadId\ and\ other}}
\DoxyCodeLine{00097\ \textcolor{comment}{//\ \ desktop\ functions.}}
\DoxyCodeLine{00098\ \textcolor{comment}{//\ \ Now\ tbb\_thread\ does\ have\ its\ own\ thread\_id\ that\ stores\ std::thread\ object}}
\DoxyCodeLine{00099\ \ \ \ \ my\_thread\_id\ =\ (size\_t)thread\_tmp;}
\DoxyCodeLine{00100\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{sugar_8h_a67af2cba5d35997524b2d5adb0a0e40a}{thread\_id}};}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{comment}{//\ The\ return\ type\ of\ \_beginthreadex\ is\ "{}uintptr\_t"{}\ on\ new\ MS\ compilers,}}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{comment}{//\ and\ 'unsigned\ long'\ on\ old\ MS\ compilers.\ \ uintptr\_t\ works\ for\ both.}}
\DoxyCodeLine{00104\ \ \ \ \ uintptr\_t\ status\ =\ \_beginthreadex(\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ (\textcolor{keywordtype}{unsigned})\mbox{\hyperlink{classtbb_1_1global__control_a8451d931cfc205d896ca2da26fe123ff}{global\_control::active\_value}}(\mbox{\hyperlink{classtbb_1_1global__control_a04221b8e619bef332234db90d31f3e5eabbf02a674a9e7175b8038166c5d47a12}{global\_control::thread\_stack\_size}}),}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ start\_routine,\ closure,\ 0,\ \&\mbox{\hyperlink{sugar_8h_a67af2cba5d35997524b2d5adb0a0e40a}{thread\_id}}\ );}
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{keywordflow}{if}(\ status==0\ )}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a63370f16962aa553990e43ad197231b9}{handle\_perror}}(errno,\textcolor{stringliteral}{"{}\_\_beginthreadex"{}});}
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_a1c780ce0b3de1ac771bdad2a05e2cd60}{my\_handle}}\ =\ (HANDLE)status;}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ my\_thread\_id\ =\ \mbox{\hyperlink{sugar_8h_a67af2cba5d35997524b2d5adb0a0e40a}{thread\_id}};}
\DoxyCodeLine{00111\ \ \ \ \ \}}
\DoxyCodeLine{00112\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00113\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00114\ \ \ \ \ \mbox{\hyperlink{pthread__minport__windows_8h_ad665cf4bf4a61dd23aab712d9c5e9d81}{pthread\_t}}\ thread\_handle;}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keywordtype}{int}\ status;}
\DoxyCodeLine{00116\ \ \ \ \ \mbox{\hyperlink{pthread__minport__windows_8h_ad1483d9532e78abdc68abd50693a3bb6}{pthread\_attr\_t}}\ stack\_size;}
\DoxyCodeLine{00117\ \ \ \ \ status\ =\ \mbox{\hyperlink{pthread__minport__windows_8h_a5c66c9042370b9d9220428bbd0108da0}{pthread\_attr\_init}}(\ \&stack\_size\ );}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keywordflow}{if}(\ status\ )}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a63370f16962aa553990e43ad197231b9}{handle\_perror}}(\ status,\ \textcolor{stringliteral}{"{}pthread\_attr\_init"{}}\ );}
\DoxyCodeLine{00120\ \ \ \ \ status\ =\ pthread\_attr\_setstacksize(\ \&stack\_size,\ \mbox{\hyperlink{classtbb_1_1global__control_a8451d931cfc205d896ca2da26fe123ff}{global\_control::active\_value}}(\mbox{\hyperlink{classtbb_1_1global__control_a04221b8e619bef332234db90d31f3e5eabbf02a674a9e7175b8038166c5d47a12}{global\_control::thread\_stack\_size}})\ );}
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{keywordflow}{if}(\ status\ )}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a63370f16962aa553990e43ad197231b9}{handle\_perror}}(\ status,\ \textcolor{stringliteral}{"{}pthread\_attr\_setstacksize"{}}\ );}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \ \ status\ =\ \mbox{\hyperlink{pthread__minport__windows_8h_a6afb84a81a45d337464674b9ff88d41e}{pthread\_create}}(\ \&thread\_handle,\ \&stack\_size,\ start\_routine,\ closure\ );}
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{keywordflow}{if}(\ status\ )}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a63370f16962aa553990e43ad197231b9}{handle\_perror}}(\ status,\ \textcolor{stringliteral}{"{}pthread\_create"{}}\ );}
\DoxyCodeLine{00127\ \ \ \ \ status\ =\ \mbox{\hyperlink{pthread__minport__windows_8h_a2836afab79bfa407e60adab6001b0c73}{pthread\_attr\_destroy}}(\ \&stack\_size\ );}
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{keywordflow}{if}(\ status\ )}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacetbb_1_1internal_a63370f16962aa553990e43ad197231b9}{handle\_perror}}(\ status,\ \textcolor{stringliteral}{"{}pthread\_attr\_destroy"{}}\ );}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \ \ \mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_a1c780ce0b3de1ac771bdad2a05e2cd60}{my\_handle}}\ =\ thread\_handle;}
\DoxyCodeLine{00132\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ \_WIN32||\_WIN64}}
\DoxyCodeLine{00133\ \}}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_a8a4400580483a912df7b793ce1dfc711}{tbb\_thread\_v3::hardware\_concurrency}}()\ \mbox{\hyperlink{tbb__stddef_8h_a44fc319ff56fa8ec000270ae97d91c51}{\_\_TBB\_NOEXCEPT}}(\mbox{\hyperlink{yyjson_8h_a41f9c5fb8b08eb5dc3edce4dcb37fee7}{true}})\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classtbb_1_1internal_1_1governor_a87ef607c22c347eb97ddafa4384b4f1d}{governor::default\_num\_threads}}();}
\DoxyCodeLine{00137\ \}}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_1_1id}{tbb\_thread\_v3::id}}\ \mbox{\hyperlink{namespacetbb_1_1internal_a7444a8c52dd26ba57c04aa00482b9ef9}{thread\_get\_id\_v3}}()\ \{}
\DoxyCodeLine{00140\ \textcolor{preprocessor}{\#if\ \_WIN32||\_WIN64}}
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_1_1id}{tbb\_thread\_v3::id}}(\ GetCurrentThreadId()\ );}
\DoxyCodeLine{00142\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_1_1id}{tbb\_thread\_v3::id}}(\ \mbox{\hyperlink{pthread__minport__windows_8h_a31ffbf449d7404f9bb088564190c6bce}{pthread\_self}}()\ );}
\DoxyCodeLine{00144\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ \_WIN32||\_WIN64}}
\DoxyCodeLine{00145\ \}}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacetbb_1_1internal_abb11c7c316e44b5f97962d62e9ea5f70}{move\_v3}}(\ \mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_ad9acae61c47fad5cf88869061ead3022}{tbb\_thread\_v3}}\&\ t1,\ \mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_ad9acae61c47fad5cf88869061ead3022}{tbb\_thread\_v3}}\&\ t2\ )}
\DoxyCodeLine{00148\ \{}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordflow}{if}\ (t1.\mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_a4ddee0e2030f8fa947fd93f403178104}{joinable}}())}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ t1.\mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_aed1dc35a70fc537682452a1c7bd77faf}{detach}}();}
\DoxyCodeLine{00151\ \ \ \ \ t1.\mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_a1c780ce0b3de1ac771bdad2a05e2cd60}{my\_handle}}\ =\ t2.\mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_a1c780ce0b3de1ac771bdad2a05e2cd60}{my\_handle}};}
\DoxyCodeLine{00152\ \ \ \ \ t2.\mbox{\hyperlink{classtbb_1_1internal_1_1tbb__thread__v3_a1c780ce0b3de1ac771bdad2a05e2cd60}{my\_handle}}\ =\ 0;}
\DoxyCodeLine{00153\ \textcolor{preprocessor}{\#if\ \_WIN32||\_WIN64}}
\DoxyCodeLine{00154\ \ \ \ \ t1.my\_thread\_id\ =\ t2.my\_thread\_id;}
\DoxyCodeLine{00155\ \ \ \ \ t2.my\_thread\_id\ =\ 0;}
\DoxyCodeLine{00156\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ \_WIN32||\_WIN64}}
\DoxyCodeLine{00157\ \}}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacetbb_1_1internal_a3b5beaaa035b83681452350540629f8f}{thread\_yield\_v3}}()}
\DoxyCodeLine{00160\ \{}
\DoxyCodeLine{00161\ \ \ \ \ \mbox{\hyperlink{ibm__aix51_8h_a2b17e6e4504bddf60a920f609fc46ea6}{\_\_TBB\_Yield}}();}
\DoxyCodeLine{00162\ \}}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespacetbb_1_1internal_ae4d0319f7c4e03cb63e4744873868e4b}{thread\_sleep\_v3}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classtbb_1_1tick__count_1_1interval__t}{tick\_count::interval\_t}}\ \&\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{00165\ \{}
\DoxyCodeLine{00166\ \textcolor{preprocessor}{\#if\ \_WIN32||\_WIN64}}
\DoxyCodeLine{00167\ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1tick__count}{tick\_count}}\ \mbox{\hyperlink{dining__philosophers_8cpp_acaabb53c59c5d280a13be2cf359335a9}{t0}}\ =\ \mbox{\hyperlink{classtbb_1_1tick__count_a74dcecde7431ff4591d7c46fc1d50d7e}{tick\_count::now}}();}
\DoxyCodeLine{00168\ \ \ \ \ \ \mbox{\hyperlink{classtbb_1_1tick__count}{tick\_count}}\ t1\ =\ \mbox{\hyperlink{dining__philosophers_8cpp_acaabb53c59c5d280a13be2cf359335a9}{t0}};}
\DoxyCodeLine{00169\ \ \ \ \ \ \textcolor{keywordflow}{for}(;;)\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ remainder\ =\ (\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}-\/(t1-\/\mbox{\hyperlink{dining__philosophers_8cpp_acaabb53c59c5d280a13be2cf359335a9}{t0}})).seconds()*1e3;\ \ \textcolor{comment}{//\ milliseconds\ remaining\ to\ sleep}}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ remainder<=0\ )\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__malloc__compliance_8cpp_ad342ac907eb044443153a22f964bf0af}{DWORD}}\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ =\ remainder>=INFINITE\ ?\ INFINITE-\/1\ :\ \mbox{\hyperlink{test__malloc__compliance_8cpp_ad342ac907eb044443153a22f964bf0af}{DWORD}}(remainder);}
\DoxyCodeLine{00173\ \textcolor{preprocessor}{\#if\ !\_\_TBB\_WIN8UI\_SUPPORT}}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ Sleep(\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ );}
\DoxyCodeLine{00175\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ std::chrono::milliseconds\ sleep\_time(\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}\ );}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ std::this\_thread::sleep\_for(\ sleep\_time\ );}
\DoxyCodeLine{00178\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ t1\ =\ \mbox{\hyperlink{classtbb_1_1tick__count_a74dcecde7431ff4591d7c46fc1d50d7e}{tick\_count::now}}();}
\DoxyCodeLine{00180\ \ \ \ \ \}}
\DoxyCodeLine{00181\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{keyword}{struct\ }timespec\ req;}
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{keywordtype}{double}\ sec\ =\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}.seconds();}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \ \ req.tv\_sec\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{long}\textcolor{keyword}{>}(sec);}
\DoxyCodeLine{00186\ \ \ \ \ req.tv\_nsec\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{long}\textcolor{keyword}{>}(\ (sec\ -\/\ req.tv\_sec)*1e9\ );}
\DoxyCodeLine{00187\ \ \ \ \ nanosleep(\&req,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00188\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ \_WIN32||\_WIN64}}
\DoxyCodeLine{00189\ \}}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \}\ \textcolor{comment}{//\ internal}}
\DoxyCodeLine{00192\ \}\ \textcolor{comment}{//\ tbb}}

\end{DoxyCode}
