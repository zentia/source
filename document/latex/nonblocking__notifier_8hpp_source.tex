\doxysection{nonblocking\+\_\+notifier.\+hpp}
\hypertarget{nonblocking__notifier_8hpp_source}{}\label{nonblocking__notifier_8hpp_source}\index{external/taskflow/taskflow/core/nonblocking\_notifier.hpp@{external/taskflow/taskflow/core/nonblocking\_notifier.hpp}}
\mbox{\hyperlink{nonblocking__notifier_8hpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <vector>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <cstdlib>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <cstdio>}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <atomic>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <memory>}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ <deque>}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <mutex>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <condition\_variable>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <thread>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <algorithm>}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <numeric>}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <cassert>}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{comment}{//\ This\ file\ is\ part\ of\ Eigen,\ a\ lightweight\ C++\ template\ library}}
\DoxyCodeLine{00018\ \textcolor{comment}{//\ for\ linear\ algebra.}}
\DoxyCodeLine{00019\ \textcolor{comment}{//}}
\DoxyCodeLine{00020\ \textcolor{comment}{//\ Copyright\ (C)\ 2016\ Dmitry\ Vyukov\ <dvyukov@google.com>}}
\DoxyCodeLine{00021\ \textcolor{comment}{//}}
\DoxyCodeLine{00022\ \textcolor{comment}{//\ This\ Source\ Code\ Form\ is\ subject\ to\ the\ terms\ of\ the\ Mozilla}}
\DoxyCodeLine{00023\ \textcolor{comment}{//\ Public\ License\ v.\ 2.0.\ If\ a\ copy\ of\ the\ MPL\ was\ not\ distributed}}
\DoxyCodeLine{00024\ \textcolor{comment}{//\ with\ this\ file,\ You\ can\ obtain\ one\ at\ http://mozilla.org/MPL/2.0/.}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacetf}{tf}}\ \{}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{comment}{//\ Notifier\ allows\ to\ wait\ for\ arbitrary\ predicates\ in\ non-\/blocking}}
\DoxyCodeLine{00029\ \textcolor{comment}{//\ algorithms.\ Think\ of\ condition\ variable,\ but\ wait\ predicate\ does\ not\ need\ to}}
\DoxyCodeLine{00030\ \textcolor{comment}{//\ be\ protected\ by\ a\ mutex.\ Usage:}}
\DoxyCodeLine{00031\ \textcolor{comment}{//\ Waiting\ thread\ does:}}
\DoxyCodeLine{00032\ \textcolor{comment}{//}}
\DoxyCodeLine{00033\ \textcolor{comment}{//\ \ \ if\ (predicate)}}
\DoxyCodeLine{00034\ \textcolor{comment}{//\ \ \ \ \ return\ act();}}
\DoxyCodeLine{00035\ \textcolor{comment}{//\ \ \ Notifier::Waiter\&\ w\ =\ waiters[my\_index];}}
\DoxyCodeLine{00036\ \textcolor{comment}{//\ \ \ ec.prepare\_wait(\&w);}}
\DoxyCodeLine{00037\ \textcolor{comment}{//\ \ \ if\ (predicate)\ \{}}
\DoxyCodeLine{00038\ \textcolor{comment}{//\ \ \ \ \ ec.cancel\_wait(\&w);}}
\DoxyCodeLine{00039\ \textcolor{comment}{//\ \ \ \ \ return\ act();}}
\DoxyCodeLine{00040\ \textcolor{comment}{//\ \ \ \}}}
\DoxyCodeLine{00041\ \textcolor{comment}{//\ \ \ ec.commit\_wait(\&w);}}
\DoxyCodeLine{00042\ \textcolor{comment}{//}}
\DoxyCodeLine{00043\ \textcolor{comment}{//\ Notifying\ thread\ does:}}
\DoxyCodeLine{00044\ \textcolor{comment}{//}}
\DoxyCodeLine{00045\ \textcolor{comment}{//\ \ \ predicate\ =\ true;}}
\DoxyCodeLine{00046\ \textcolor{comment}{//\ \ \ ec.notify(true);}}
\DoxyCodeLine{00047\ \textcolor{comment}{//}}
\DoxyCodeLine{00048\ \textcolor{comment}{//\ notify\ is\ cheap\ if\ there\ are\ no\ waiting\ threads.\ prepare\_wait/commit\_wait\ are\ not}}
\DoxyCodeLine{00049\ \textcolor{comment}{//\ cheap,\ but\ they\ are\ executed\ only\ if\ the\ preceding\ predicate\ check\ has}}
\DoxyCodeLine{00050\ \textcolor{comment}{//\ failed.}}
\DoxyCodeLine{00051\ \textcolor{comment}{//}}
\DoxyCodeLine{00052\ \textcolor{comment}{//\ Algorithm\ outline:}}
\DoxyCodeLine{00053\ \textcolor{comment}{//\ There\ are\ two\ main\ variables:\ predicate\ (managed\ by\ user)\ and\ \_state.}}
\DoxyCodeLine{00054\ \textcolor{comment}{//\ Operation\ closely\ resembles\ Dekker\ mutual\ algorithm:}}
\DoxyCodeLine{00055\ \textcolor{comment}{//\ https://en.wikipedia.org/wiki/Dekker\%27s\_algorithm}}
\DoxyCodeLine{00056\ \textcolor{comment}{//\ Waiting\ thread\ sets\ \_state\ then\ checks\ predicate,\ Notifying\ thread\ sets}}
\DoxyCodeLine{00057\ \textcolor{comment}{//\ predicate\ then\ checks\ \_state.\ Due\ to\ seq\_cst\ fences\ in\ between\ these}}
\DoxyCodeLine{00058\ \textcolor{comment}{//\ operations\ it\ is\ guaranteed\ than\ either\ waiter\ will\ see\ predicate\ change}}
\DoxyCodeLine{00059\ \textcolor{comment}{//\ and\ won't\ block,\ or\ notifying\ thread\ will\ see\ \_state\ change\ and\ will\ unblock}}
\DoxyCodeLine{00060\ \textcolor{comment}{//\ the\ waiter,\ or\ both.\ But\ it\ can't\ happen\ that\ both\ threads\ don't\ see\ each}}
\DoxyCodeLine{00061\ \textcolor{comment}{//\ other\ changes,\ which\ would\ lead\ to\ deadlock.}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_ab043948ce13bad27b76a967eab267290}{NonblockingNotifierV1}}\ \{}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a763b2f90bc53f92d680a635fe28e858e}{Executor}};}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter}{Waiter}}\ \{}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keyword}{alignas}\ (2*\mbox{\hyperlink{os_8hpp_a2f7ab3bdbd7b17f081cbb69422b3bf0b}{TF\_CACHELINE\_SIZE}})\ std::atomic<Waiter*>\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter_a52dc892a60477dd92fff758599f1b674}{next}};}
\DoxyCodeLine{00071\ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter_a6330562955d2e648bfbd5f75908269ef}{epoch}};}
\DoxyCodeLine{00072\ \ \ \ \ enum\ :\ \textcolor{keywordtype}{unsigned}\ \{}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter_a80bab3311732a5c5f8ba9af0d8f29b43a15ffc66117ba7e4b63451c17cb31980e}{kNotSignaled}}\ =\ 0,}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter_a80bab3311732a5c5f8ba9af0d8f29b43a64f59aa72add91b7c4e0018595d6f871}{kWaiting}},}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter_a80bab3311732a5c5f8ba9af0d8f29b43a748f10156da2ebd6e8464402f0b0aada}{kSignaled}},}
\DoxyCodeLine{00076\ \ \ \ \ \};}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \textcolor{preprocessor}{\#if\ \_\_cplusplus\ >=\ TF\_CPP20}}
\DoxyCodeLine{00079\ \ \ \ \ std::atomic<unsigned>\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter_ab1b211b9d53278c0a1f204b0e9d4feb7}{state}}\ \{0\};}
\DoxyCodeLine{00080\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00081\ \ \ \ \ std::mutex\ mu;}
\DoxyCodeLine{00082\ \ \ \ \ std::condition\_variable\ cv;}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter_ab1b211b9d53278c0a1f204b0e9d4feb7}{state}};}
\DoxyCodeLine{00084\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00085\ \ \ \};}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_ab043948ce13bad27b76a967eab267290}{NonblockingNotifierV1}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}})\ :\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a5c173bc82843768d1895f0408a352939}{\_state}}(\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a359d18e2bde5e990a8eb813419fbb9c5}{kStackMask}}),\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a2a174f09c01ea6de9f4602afa2ef4722}{\_waiters}}(\mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}})\ \{}
\DoxyCodeLine{00088\ \ \ \ \ assert(\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a2a174f09c01ea6de9f4602afa2ef4722}{\_waiters}}.size()\ <\ (1\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_ab9884d1d8e6ad9c13246bb714ae4c823}{kWaiterBits}})\ -\/\ 1);}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{comment}{//\ Initialize\ epoch\ to\ something\ close\ to\ overflow\ to\ test\ overflow.}}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{comment}{//\_state\ =\ kStackMask\ |\ (kEpochMask\ -\/\ kEpochInc\ *\ \_waiters.size()\ *\ 2);}}
\DoxyCodeLine{00091\ \ \ \}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_abe069467514bf25aebf28177c9c98d18}{\string~NonblockingNotifierV1}}()\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{comment}{//\ Ensure\ there\ are\ no\ waiters.}}
\DoxyCodeLine{00095\ \ \ \ \ assert((\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a5c173bc82843768d1895f0408a352939}{\_state}}.load()\ \&\ (\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a359d18e2bde5e990a8eb813419fbb9c5}{kStackMask}}\ |\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a62b84236ef779a3aaa4f1fab9e08e485}{kWaiterMask}}))\ ==\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a359d18e2bde5e990a8eb813419fbb9c5}{kStackMask}});}
\DoxyCodeLine{00096\ \ \ \}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \textcolor{comment}{//\ prepare\_wait\ prepares\ for\ waiting.}}
\DoxyCodeLine{00099\ \ \ \textcolor{comment}{//\ After\ calling\ this\ function\ the\ thread\ must\ re-\/check\ the\ wait\ predicate}}
\DoxyCodeLine{00100\ \ \ \textcolor{comment}{//\ and\ call\ either\ cancel\_wait\ or\ commit\_wait\ passing\ the\ same\ Waiter\ object.}}
\DoxyCodeLine{00101\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a0e1a853bd31377ad689ed59d8c2ed812}{prepare\_wait}}(\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter}{Waiter}}*\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}})\ \{}
\DoxyCodeLine{00102\ \ \ \ \ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>epoch\ =\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a5c173bc82843768d1895f0408a352939}{\_state}}.fetch\_add(\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a8dfcc33f90fe5458ed2823cda25ddac7}{kWaiterInc}},\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00103\ \ \ \ \ std::atomic\_thread\_fence(std::memory\_order\_seq\_cst);}
\DoxyCodeLine{00104\ \ \ \}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \textcolor{comment}{//\ commit\_wait\ commits\ waiting.}}
\DoxyCodeLine{00107\ \ \ \textcolor{comment}{//\ only\ the\ waiter\ itself\ can\ call}}
\DoxyCodeLine{00108\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a333aa678bb764a47b0bd7e80ac36dafb}{commit\_wait}}(\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter}{Waiter}}*\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}})\ \{}
\DoxyCodeLine{00109\ \textcolor{preprocessor}{\#if\ \_\_cplusplus\ >=\ TF\_CPP20}}
\DoxyCodeLine{00110\ \ \ \ \ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>state.store(\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter_a80bab3311732a5c5f8ba9af0d8f29b43a15ffc66117ba7e4b63451c17cb31980e}{Waiter::kNotSignaled}},\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00111\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00112\ \ \ \ \ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>state\ =\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter_a80bab3311732a5c5f8ba9af0d8f29b43a15ffc66117ba7e4b63451c17cb31980e}{Waiter::kNotSignaled}};}
\DoxyCodeLine{00113\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{comment}{//\ Modification\ epoch\ of\ this\ waiter.}}
\DoxyCodeLine{00115\ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ epoch\ =}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>epoch\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a16d986f1b35f4e5a3f53ce68c921234b}{kEpochMask}})\ +}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ (((\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>epoch\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a62b84236ef779a3aaa4f1fab9e08e485}{kWaiterMask}})\ >>\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a596d39522977c1a99a2957b86d38081b}{kWaiterShift}})\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a722596917a9c8a3c7c1b079b02e9391f}{kEpochShift}});}
\DoxyCodeLine{00118\ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ state\ =\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a5c173bc82843768d1895f0408a352939}{\_state}}.load(std::memory\_order\_seq\_cst);}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keywordflow}{for}\ (;;)\ \{}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}((state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a16d986f1b35f4e5a3f53ce68c921234b}{kEpochMask}})\ -\/\ epoch)\ <\ 0)\ \{}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ preceding\ waiter\ has\ not\ decided\ on\ its\ fate.\ Wait\ until\ it}}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ calls\ either\ cancel\_wait\ or\ commit\_wait,\ or\ is\ notified.}}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ std::this\_thread::yield();}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ state\ =\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a5c173bc82843768d1895f0408a352939}{\_state}}.load(std::memory\_order\_seq\_cst);}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \textcolor{comment}{//\ We've\ already\ been\ notified.}}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}((state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a16d986f1b35f4e5a3f53ce68c921234b}{kEpochMask}})\ -\/\ epoch)\ >\ 0)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \textcolor{comment}{//\ Remove\ this\ thread\ from\ prewait\ counter\ and\ add\ it\ to\ the\ waiter\ list.}}
\DoxyCodeLine{00130\ \ \ \ \ \ \ assert((state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a62b84236ef779a3aaa4f1fab9e08e485}{kWaiterMask}})\ !=\ 0);}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ newstate\ =\ state\ -\/\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a8dfcc33f90fe5458ed2823cda25ddac7}{kWaiterInc}}\ +\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_af7151df9839430cd6871bf06456076f5}{kEpochInc}};}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \textcolor{comment}{//newstate\ =\ (newstate\ \&\ \string~kStackMask)\ |\ (w\ -\/\ \&\_waiters[0]);}}
\DoxyCodeLine{00133\ \ \ \ \ \ \ newstate\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\textcolor{keyword}{>}((newstate\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a359d18e2bde5e990a8eb813419fbb9c5}{\string~kStackMask}})\ |\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\textcolor{keyword}{>}(\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}\ -\/\ \&\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a2a174f09c01ea6de9f4602afa2ef4722}{\_waiters}}[0]));}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a359d18e2bde5e990a8eb813419fbb9c5}{kStackMask}})\ ==\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a359d18e2bde5e990a8eb813419fbb9c5}{kStackMask}})}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>next.store(\textcolor{keyword}{nullptr},\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>next.store(\&\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a2a174f09c01ea6de9f4602afa2ef4722}{\_waiters}}[state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a359d18e2bde5e990a8eb813419fbb9c5}{kStackMask}}],\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a5c173bc82843768d1895f0408a352939}{\_state}}.compare\_exchange\_weak(state,\ newstate,}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_release))}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00141\ \ \ \ \ \}}
\DoxyCodeLine{00142\ \ \ \ \ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_ae74b69e4e9016e27e06ec235bb7ccee2}{\_park}}(\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}});}
\DoxyCodeLine{00143\ \ \ \}}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \textcolor{comment}{//\ cancel\_wait\ cancels\ effects\ of\ the\ previous\ prepare\_wait\ call.}}
\DoxyCodeLine{00146\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_ade5cd5d2da85a5e47ee0fa3c123ba463}{cancel\_wait}}(\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter}{Waiter}}*\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}})\ \{}
\DoxyCodeLine{00147\ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ epoch\ =}
\DoxyCodeLine{00148\ \ \ \ \ \ \ (\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>epoch\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a16d986f1b35f4e5a3f53ce68c921234b}{kEpochMask}})\ +}
\DoxyCodeLine{00149\ \ \ \ \ \ \ (((\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>epoch\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a62b84236ef779a3aaa4f1fab9e08e485}{kWaiterMask}})\ >>\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a596d39522977c1a99a2957b86d38081b}{kWaiterShift}})\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a722596917a9c8a3c7c1b079b02e9391f}{kEpochShift}});}
\DoxyCodeLine{00150\ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ state\ =\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a5c173bc82843768d1895f0408a352939}{\_state}}.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keywordflow}{for}\ (;;)\ \{}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}((state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a16d986f1b35f4e5a3f53ce68c921234b}{kEpochMask}})\ -\/\ epoch)\ <\ 0)\ \{}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ preceding\ waiter\ has\ not\ decided\ on\ its\ fate.\ Wait\ until\ it}}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ calls\ either\ cancel\_wait\ or\ commit\_wait,\ or\ is\ notified.}}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ std::this\_thread::yield();}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ state\ =\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a5c173bc82843768d1895f0408a352939}{\_state}}.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \textcolor{comment}{//\ We've\ already\ been\ notified.}}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{eabase_8h_adec1df1b8b51cb32b77e5b86fff46471}{int64\_t}}((state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a16d986f1b35f4e5a3f53ce68c921234b}{kEpochMask}})\ -\/\ epoch)\ >\ 0)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \textcolor{comment}{//\ Remove\ this\ thread\ from\ prewait\ counter.}}
\DoxyCodeLine{00162\ \ \ \ \ \ \ assert((state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a62b84236ef779a3aaa4f1fab9e08e485}{kWaiterMask}})\ !=\ 0);}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a5c173bc82843768d1895f0408a352939}{\_state}}.compare\_exchange\_weak(state,\ state\ -\/\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a8dfcc33f90fe5458ed2823cda25ddac7}{kWaiterInc}}\ +\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_af7151df9839430cd6871bf06456076f5}{kEpochInc}},}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_relaxed))}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00166\ \ \ \ \ \}}
\DoxyCodeLine{00167\ \ \ \}}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_ab261883f14cef21b3a249b5d356e6cb3}{notify\_one}}()\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a7668051b2fbf6cb0d9e8bd10a6099c17}{\_notify<false>}}();}
\DoxyCodeLine{00171\ \ \ \}}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a8f4cb88b5077d7c4ac7b251b72aba559}{notify\_all}}()\ \{}
\DoxyCodeLine{00174\ \ \ \ \ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a7668051b2fbf6cb0d9e8bd10a6099c17}{\_notify<true>}}();}
\DoxyCodeLine{00175\ \ \ \}}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \textcolor{comment}{//\ notify\ n\ workers}}
\DoxyCodeLine{00178\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_afec798b9cbb1057c0289e247bab15e6f}{notify\_n}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}})\ \{}
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ >=\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a2a174f09c01ea6de9f4602afa2ef4722}{\_waiters}}.size())\ \{}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a7668051b2fbf6cb0d9e8bd10a6099c17}{\_notify<true>}}();}
\DoxyCodeLine{00181\ \ \ \ \ \}}
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ k=0;\ k<\mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}};\ ++k)\ \{}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a7668051b2fbf6cb0d9e8bd10a6099c17}{\_notify<false>}}();}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00186\ \ \ \ \ \}}
\DoxyCodeLine{00187\ \ \ \}}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a5e0ea469d6c249777f65a55e0975fb02}{size}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a2a174f09c01ea6de9f4602afa2ef4722}{\_waiters}}.size();}
\DoxyCodeLine{00191\ \ \ \}}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \textcolor{comment}{//\ State\_\ layout:}}
\DoxyCodeLine{00196\ \ \ \textcolor{comment}{//\ -\/\ low\ kStackBits\ is\ a\ stack\ of\ waiters\ committed\ wait.}}
\DoxyCodeLine{00197\ \ \ \textcolor{comment}{//\ -\/\ next\ kWaiterBits\ is\ count\ of\ waiters\ in\ prewait\ state.}}
\DoxyCodeLine{00198\ \ \ \textcolor{comment}{//\ -\/\ next\ kEpochBits\ is\ modification\ counter.}}
\DoxyCodeLine{00199\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a091ce365ccc19982124fad043e66a468}{kStackBits}}\ =\ 16;}
\DoxyCodeLine{00200\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a359d18e2bde5e990a8eb813419fbb9c5}{kStackMask}}\ =\ (1ull\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a091ce365ccc19982124fad043e66a468}{kStackBits}})\ -\/\ 1;}
\DoxyCodeLine{00201\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_ab9884d1d8e6ad9c13246bb714ae4c823}{kWaiterBits}}\ =\ 16;}
\DoxyCodeLine{00202\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a596d39522977c1a99a2957b86d38081b}{kWaiterShift}}\ =\ 16;}
\DoxyCodeLine{00203\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a62b84236ef779a3aaa4f1fab9e08e485}{kWaiterMask}}\ =\ ((1ull\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_ab9884d1d8e6ad9c13246bb714ae4c823}{kWaiterBits}})\ -\/\ 1)}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a596d39522977c1a99a2957b86d38081b}{kWaiterShift}};}
\DoxyCodeLine{00205\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a8dfcc33f90fe5458ed2823cda25ddac7}{kWaiterInc}}\ =\ 1ull\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_ab9884d1d8e6ad9c13246bb714ae4c823}{kWaiterBits}};}
\DoxyCodeLine{00206\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_afaaaeb37729a985795239a5859523b4c}{kEpochBits}}\ =\ 32;}
\DoxyCodeLine{00207\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a722596917a9c8a3c7c1b079b02e9391f}{kEpochShift}}\ =\ 32;}
\DoxyCodeLine{00208\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a16d986f1b35f4e5a3f53ce68c921234b}{kEpochMask}}\ =\ ((1ull\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_afaaaeb37729a985795239a5859523b4c}{kEpochBits}})\ -\/\ 1)\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a722596917a9c8a3c7c1b079b02e9391f}{kEpochShift}};}
\DoxyCodeLine{00209\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_af7151df9839430cd6871bf06456076f5}{kEpochInc}}\ =\ 1ull\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a722596917a9c8a3c7c1b079b02e9391f}{kEpochShift}};}
\DoxyCodeLine{00210\ \ \ std::atomic<uint64\_t>\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a5c173bc82843768d1895f0408a352939}{\_state}};}
\DoxyCodeLine{00211\ \ \ std::vector<Waiter>\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a2a174f09c01ea6de9f4602afa2ef4722}{\_waiters}};}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00213\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_ae74b69e4e9016e27e06ec235bb7ccee2}{\_park}}(\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter}{Waiter}}*\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}})\ \{}
\DoxyCodeLine{00214\ \textcolor{preprocessor}{\#if\ \_\_cplusplus\ >=\ TF\_CPP20}}
\DoxyCodeLine{00215\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ target\ =\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter_a80bab3311732a5c5f8ba9af0d8f29b43a15ffc66117ba7e4b63451c17cb31980e}{Waiter::kNotSignaled}};}
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>state.compare\_exchange\_strong(target,\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter_a80bab3311732a5c5f8ba9af0d8f29b43a64f59aa72add91b7c4e0018595d6f871}{Waiter::kWaiting}},}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_relaxed,}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_relaxed))\ \{}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>state.wait(\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter_a80bab3311732a5c5f8ba9af0d8f29b43a64f59aa72add91b7c4e0018595d6f871}{Waiter::kWaiting}},\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00220\ \ \ \ \ \}}
\DoxyCodeLine{00221\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00222\ \ \ \ \ std::unique\_lock<std::mutex>\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>mu);}
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>state\ !=\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter_a80bab3311732a5c5f8ba9af0d8f29b43a748f10156da2ebd6e8464402f0b0aada}{Waiter::kSignaled}})\ \{}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>state\ =\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter_a80bab3311732a5c5f8ba9af0d8f29b43a64f59aa72add91b7c4e0018595d6f871}{Waiter::kWaiting}};}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>cv.wait(\mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}});}
\DoxyCodeLine{00226\ \ \ \ \ \}}
\DoxyCodeLine{00227\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00228\ \ \ \}}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a3797bbc06df0dc779bbb66c7a32559f8}{\_unpark}}(\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter}{Waiter}}*\ waiters)\ \{}
\DoxyCodeLine{00231\ \ \ \ \ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter}{Waiter}}*\ next\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00232\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter}{Waiter}}*\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}\ =\ waiters;\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}};\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}\ =\ next)\ \{}
\DoxyCodeLine{00233\ \ \ \ \ \ \ next\ =\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>next.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00234\ \textcolor{preprocessor}{\#if\ \_\_cplusplus\ >=\ TF\_CPP20}}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ only\ notify\ if\ the\ other\ is\ waiting\ -\/\ this\ is\ why\ we\ use\ tri-\/state}}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \textcolor{comment}{//\ variable\ instead\ of\ binary-\/state\ variable\ (i.e.,\ atomic\_flag)}}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \textcolor{comment}{//\ Performance\ is\ about\ 0.1\%\ faster}}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>state.exchange(\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter_a80bab3311732a5c5f8ba9af0d8f29b43a748f10156da2ebd6e8464402f0b0aada}{Waiter::kSignaled}},\ std::memory\_order\_relaxed)\ ==\ }
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter_a80bab3311732a5c5f8ba9af0d8f29b43a64f59aa72add91b7c4e0018595d6f871}{Waiter::kWaiting}})\ \{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>state.notify\_one();}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00242\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ state;}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ std::unique\_lock<std::mutex>\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>mu);}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ state\ =\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>state;}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>state\ =\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter_a80bab3311732a5c5f8ba9af0d8f29b43a748f10156da2ebd6e8464402f0b0aada}{Waiter::kSignaled}};}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \textcolor{comment}{//\ Avoid\ notifying\ if\ it\ wasn't\ waiting.}}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (state\ ==\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter_a80bab3311732a5c5f8ba9af0d8f29b43a64f59aa72add91b7c4e0018595d6f871}{Waiter::kWaiting}})\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>cv.notify\_one();}
\DoxyCodeLine{00251\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00252\ \ \ \ \ \}}
\DoxyCodeLine{00253\ \ \ \}}
\DoxyCodeLine{00254\ \ \ }
\DoxyCodeLine{00255\ \ \ \textcolor{comment}{//\ notify\ wakes\ one\ or\ all\ waiting\ threads.}}
\DoxyCodeLine{00256\ \ \ \textcolor{comment}{//\ Must\ be\ called\ after\ changing\ the\ associated\ wait\ predicate.}}
\DoxyCodeLine{00257\ \ \ \textcolor{keyword}{template}\ <\textcolor{keywordtype}{bool}\ all>}
\DoxyCodeLine{00258\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a7668051b2fbf6cb0d9e8bd10a6099c17}{\_notify}}()\ \{}
\DoxyCodeLine{00259\ \ \ \ \ std::atomic\_thread\_fence(std::memory\_order\_seq\_cst);}
\DoxyCodeLine{00260\ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ state\ =\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a5c173bc82843768d1895f0408a352939}{\_state}}.load(std::memory\_order\_acquire);}
\DoxyCodeLine{00261\ \ \ \ \ \textcolor{keywordflow}{for}\ (;;)\ \{}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \textcolor{comment}{//\ Easy\ case:\ no\ waiters.}}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a359d18e2bde5e990a8eb813419fbb9c5}{kStackMask}})\ ==\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a359d18e2bde5e990a8eb813419fbb9c5}{kStackMask}}\ \&\&\ (state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a62b84236ef779a3aaa4f1fab9e08e485}{kWaiterMask}})\ ==\ 0)\ \{}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ waiters\ =\ (state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a62b84236ef779a3aaa4f1fab9e08e485}{kWaiterMask}})\ >>\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a596d39522977c1a99a2957b86d38081b}{kWaiterShift}};}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ newstate;}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (all)\ \{}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ prewait\ counter\ and\ empty\ wait\ list.}}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ newstate\ =\ (state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a16d986f1b35f4e5a3f53ce68c921234b}{kEpochMask}})\ +\ (\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_af7151df9839430cd6871bf06456076f5}{kEpochInc}}\ *\ waiters)\ +\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a359d18e2bde5e990a8eb813419fbb9c5}{kStackMask}};}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (waiters)\ \{}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ There\ is\ a\ thread\ in\ pre-\/wait\ state,\ unblock\ it.}}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ newstate\ =\ state\ +\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_af7151df9839430cd6871bf06456076f5}{kEpochInc}}\ -\/\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a8dfcc33f90fe5458ed2823cda25ddac7}{kWaiterInc}};}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pop\ a\ waiter\ from\ list\ and\ unpark\ it.}}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter}{Waiter}}*\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}\ =\ \&\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a2a174f09c01ea6de9f4602afa2ef4722}{\_waiters}}[state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a359d18e2bde5e990a8eb813419fbb9c5}{kStackMask}}];}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter}{Waiter}}*\ wnext\ =\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>next.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ next\ =\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a359d18e2bde5e990a8eb813419fbb9c5}{kStackMask}};}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \textcolor{comment}{//if\ (wnext\ !=\ nullptr)\ next\ =\ wnext\ -\/\ \&\_waiters[0];}}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (wnext\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \ \ next\ =\ \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\textcolor{keyword}{>}(wnext\ -\/\ \&\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a2a174f09c01ea6de9f4602afa2ef4722}{\_waiters}}[0]);}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Note:\ we\ don't\ add\ kEpochInc\ here.\ ABA\ problem\ on\ the\ lock-\/free\ stack}}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ can't\ happen\ because\ a\ waiter\ is\ re-\/pushed\ onto\ the\ stack\ only\ after}}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ it\ was\ in\ the\ pre-\/wait\ state\ which\ inevitably\ leads\ to\ epoch}}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ increment.}}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ newstate\ =\ (state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a16d986f1b35f4e5a3f53ce68c921234b}{kEpochMask}})\ +\ next;}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a5c173bc82843768d1895f0408a352939}{\_state}}.compare\_exchange\_weak(state,\ newstate,}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_acquire))\ \{}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!all\ \&\&\ waiters)\ \textcolor{keywordflow}{return};\ \ \textcolor{comment}{//\ unblocked\ pre-\/wait\ thread}}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a359d18e2bde5e990a8eb813419fbb9c5}{kStackMask}})\ ==\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a359d18e2bde5e990a8eb813419fbb9c5}{kStackMask}})\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v1_1_1_waiter}{Waiter}}*\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}\ =\ \&\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a2a174f09c01ea6de9f4602afa2ef4722}{\_waiters}}[state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a359d18e2bde5e990a8eb813419fbb9c5}{kStackMask}}];}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!all)\ \{}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>next.store(\textcolor{keyword}{nullptr},\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v1_a3797bbc06df0dc779bbb66c7a32559f8}{\_unpark}}(\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}});}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00300\ \ \ \ \ \}}
\DoxyCodeLine{00301\ \ \ \}}
\DoxyCodeLine{00302\ \};}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00306\ \textcolor{comment}{//\ NonblockingNotifierV2}}
\DoxyCodeLine{00307\ \textcolor{comment}{//\ reference:\ https://gitlab.com/libeigen/eigen/-\//blob/master/Eigen/src/ThreadPool/EventCount.h}}
\DoxyCodeLine{00308\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00309\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a8c27449987934fa4526b0c304fd598e6}{NonblockingNotifierV2}}\ \{}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a763b2f90bc53f92d680a635fe28e858e}{Executor}};}
\DoxyCodeLine{00312\ \ \ }
\DoxyCodeLine{00313\ \ \ \textcolor{comment}{//\ State\_\ layout:}}
\DoxyCodeLine{00314\ \ \ \textcolor{comment}{//\ -\/\ low\ kWaiterBits\ is\ a\ stack\ of\ waiters\ committed\ wait}}
\DoxyCodeLine{00315\ \ \ \textcolor{comment}{//\ \ \ (indexes\ in\ \_waiters\ array\ are\ used\ as\ stack\ elements,}}
\DoxyCodeLine{00316\ \ \ \textcolor{comment}{//\ \ \ kStackMask\ means\ empty\ stack).}}
\DoxyCodeLine{00317\ \ \ \textcolor{comment}{//\ -\/\ next\ kWaiterBits\ is\ count\ of\ waiters\ in\ prewait\ state.}}
\DoxyCodeLine{00318\ \ \ \textcolor{comment}{//\ -\/\ next\ kWaiterBits\ is\ count\ of\ pending\ signals.}}
\DoxyCodeLine{00319\ \ \ \textcolor{comment}{//\ -\/\ remaining\ bits\ are\ ABA\ counter\ for\ the\ stack.}}
\DoxyCodeLine{00320\ \ \ \textcolor{comment}{//\ \ \ (stored\ in\ Waiter\ node\ and\ incremented\ on\ push).}}
\DoxyCodeLine{00321\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a2f4ff4da15731e433c62e0e6c1d6ba43}{kWaiterBits}}\ =\ 14;}
\DoxyCodeLine{00322\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a18b4271b2cff3b7e95785604ee094ba0}{kStackMask}}\ =\ (1ull\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a2f4ff4da15731e433c62e0e6c1d6ba43}{kWaiterBits}})\ -\/\ 1;}
\DoxyCodeLine{00323\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_af840fa6260467db4649e95a4e7e8b34a}{kWaiterShift}}\ =\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a2f4ff4da15731e433c62e0e6c1d6ba43}{kWaiterBits}};}
\DoxyCodeLine{00324\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_abb22b562246bf3a486f33465e0af7df9}{kWaiterMask}}\ =\ ((1ull\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a2f4ff4da15731e433c62e0e6c1d6ba43}{kWaiterBits}})\ -\/\ 1)\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_af840fa6260467db4649e95a4e7e8b34a}{kWaiterShift}};}
\DoxyCodeLine{00325\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a6784ad404e47c455f901f3392313561e}{kWaiterInc}}\ =\ 1ull\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_af840fa6260467db4649e95a4e7e8b34a}{kWaiterShift}};}
\DoxyCodeLine{00326\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a41f1f65adb22ebb12bc5f171540f5c22}{kSignalShift}}\ =\ 2\ *\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a2f4ff4da15731e433c62e0e6c1d6ba43}{kWaiterBits}};}
\DoxyCodeLine{00327\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a3a2118672e13fa288608d106cc2ffc10}{kSignalMask}}\ =\ ((1ull\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a2f4ff4da15731e433c62e0e6c1d6ba43}{kWaiterBits}})\ -\/\ 1)\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a41f1f65adb22ebb12bc5f171540f5c22}{kSignalShift}};}
\DoxyCodeLine{00328\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a8cdbae658db294c269431b4f5ecc5a0e}{kSignalInc}}\ =\ 1ull\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a41f1f65adb22ebb12bc5f171540f5c22}{kSignalShift}};}
\DoxyCodeLine{00329\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a8ac3d2f93979eae0e54214868f6049d6}{kEpochShift}}\ =\ 3\ *\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a2f4ff4da15731e433c62e0e6c1d6ba43}{kWaiterBits}};}
\DoxyCodeLine{00330\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a236476d695572b3f7c4feb5c6f8228f6}{kEpochBits}}\ =\ 64\ -\/\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a8ac3d2f93979eae0e54214868f6049d6}{kEpochShift}};}
\DoxyCodeLine{00331\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_ac920d120b2ad53ee655cbf82ae9813f3}{kEpochMask}}\ =\ ((1ull\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a236476d695572b3f7c4feb5c6f8228f6}{kEpochBits}})\ -\/\ 1)\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a8ac3d2f93979eae0e54214868f6049d6}{kEpochShift}};}
\DoxyCodeLine{00332\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_abc052e7db91b2be98cbd9e04fb3d0e6c}{kEpochInc}}\ =\ 1ull\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a8ac3d2f93979eae0e54214868f6049d6}{kEpochShift}};}
\DoxyCodeLine{00333\ \ \ }
\DoxyCodeLine{00334\ \ \ \textcolor{keyword}{static\_assert}(\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a236476d695572b3f7c4feb5c6f8228f6}{kEpochBits}}\ >=\ 20,\ \textcolor{stringliteral}{"{}not\ enough\ bits\ to\ prevent\ ABA\ problem"{}});}
\DoxyCodeLine{00335\ }
\DoxyCodeLine{00336\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00337\ \ \ }
\DoxyCodeLine{00338\ \ \ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter}{Waiter}}\ \{}
\DoxyCodeLine{00339\ \ \ \ \ \textcolor{keyword}{alignas}\ (2*\mbox{\hyperlink{os_8hpp_a2f7ab3bdbd7b17f081cbb69422b3bf0b}{TF\_CACHELINE\_SIZE}})\ std::atomic<uint64\_t>\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter_a5f52302abdd8c422de1539fb0dd7431f}{next}}\{\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a18b4271b2cff3b7e95785604ee094ba0}{kStackMask}}\};}
\DoxyCodeLine{00340\ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter_a020391a45a481ca9484a7d498c7fdfce}{epoch}}\{0\};}
\DoxyCodeLine{00341\ \ \ \ \ enum\ :\ \textcolor{keywordtype}{unsigned}\ \{}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter_af531fdf01fc1ad10b7615f3e8cd806caaf1e89e639a5af88e20f4735b3f34ebdb}{kNotSignaled}}\ =\ 0,}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter_af531fdf01fc1ad10b7615f3e8cd806caa627fec371a96354ff7c5d331d78a7708}{kWaiting}},}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter_af531fdf01fc1ad10b7615f3e8cd806caa0a867e509bc52dc110e1afdaaa1e7dfe}{kSignaled}},}
\DoxyCodeLine{00345\ \ \ \ \ \};}
\DoxyCodeLine{00346\ }
\DoxyCodeLine{00347\ \textcolor{preprocessor}{\#if\ \_\_cplusplus\ >=\ TF\_CPP20}}
\DoxyCodeLine{00348\ \ \ \ \ std::atomic<unsigned>\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter_a6eb77ad5a90200b9eedfdd76915a7e9f}{state}}\ \{\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter_af531fdf01fc1ad10b7615f3e8cd806caaf1e89e639a5af88e20f4735b3f34ebdb}{kNotSignaled}}\};}
\DoxyCodeLine{00349\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00350\ \ \ \ \ std::mutex\ mu;}
\DoxyCodeLine{00351\ \ \ \ \ std::condition\_variable\ cv;}
\DoxyCodeLine{00352\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter_a6eb77ad5a90200b9eedfdd76915a7e9f}{state}}\ \{\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter_af531fdf01fc1ad10b7615f3e8cd806caaf1e89e639a5af88e20f4735b3f34ebdb}{kNotSignaled}}\};}
\DoxyCodeLine{00353\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00354\ \ \ \};}
\DoxyCodeLine{00355\ }
\DoxyCodeLine{00356\ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a8c27449987934fa4526b0c304fd598e6}{NonblockingNotifierV2}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}})\ :\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a00b086cd37998f6bc317f6169b7233c0}{\_state}}(\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a18b4271b2cff3b7e95785604ee094ba0}{kStackMask}}),\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_ab9a6466e4fbdeb4b961a71f597bed573}{\_waiters}}(\mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}})\ \{}
\DoxyCodeLine{00357\ \ \ \ \ assert(\mbox{\hyperlink{main-override-static_8c_a0240ac851181b84ac374872dc5434ee4}{N}}\ <\ ((1\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a2f4ff4da15731e433c62e0e6c1d6ba43}{kWaiterBits}})\ -\/\ 1));}
\DoxyCodeLine{00358\ \ \ \}}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \ \ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a32ec542bd17bc4e0796bdb746ad1efb6}{\string~NonblockingNotifierV2}}()\ \{}
\DoxyCodeLine{00361\ \ \ \ \ \textcolor{comment}{//\ Ensure\ there\ are\ no\ waiters.}}
\DoxyCodeLine{00362\ \ \ \ \ assert(\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a00b086cd37998f6bc317f6169b7233c0}{\_state}}.load()\ ==\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a18b4271b2cff3b7e95785604ee094ba0}{kStackMask}});}
\DoxyCodeLine{00363\ \ \ \}}
\DoxyCodeLine{00364\ }
\DoxyCodeLine{00365\ \ \ \textcolor{comment}{//\ prepare\_wait\ prepares\ for\ waiting.}}
\DoxyCodeLine{00366\ \ \ \textcolor{comment}{//\ After\ calling\ prepare\_wait,\ the\ thread\ must\ re-\/check\ the\ wait\ predicate}}
\DoxyCodeLine{00367\ \ \ \textcolor{comment}{//\ and\ then\ call\ either\ cancel\_wait\ or\ commit\_wait.}}
\DoxyCodeLine{00368\ \ \ \textcolor{comment}{//void\ prepare\_wait(Waiter*)\ \{}}
\DoxyCodeLine{00369\ \ \ \textcolor{comment}{//\ \ uint64\_t\ state\ =\ \_state.load(std::memory\_order\_relaxed);}}
\DoxyCodeLine{00370\ \ \ \textcolor{comment}{//\ \ for\ (;;)\ \{}}
\DoxyCodeLine{00371\ \ \ \textcolor{comment}{//\ \ \ \ //\_check\_state(state);}}
\DoxyCodeLine{00372\ \ \ \textcolor{comment}{//\ \ \ \ uint64\_t\ newstate\ =\ state\ +\ kWaiterInc;}}
\DoxyCodeLine{00373\ \ \ \textcolor{comment}{//\ \ \ \ //\_check\_state(newstate);}}
\DoxyCodeLine{00374\ \ \ \textcolor{comment}{//\ \ \ \ if\ (\_state.compare\_exchange\_weak(state,\ newstate,\ std::memory\_order\_seq\_cst))\ return;}}
\DoxyCodeLine{00375\ \ \ \textcolor{comment}{//\ \ \}}}
\DoxyCodeLine{00376\ \ \ \textcolor{comment}{//\}}}
\DoxyCodeLine{00377\ \ \ }
\DoxyCodeLine{00378\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a931cea5789c1f92f7a2b4fcecca7cb91}{prepare\_wait}}(\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter}{Waiter}}*)\ \{}
\DoxyCodeLine{00379\ \ \ \ \ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a00b086cd37998f6bc317f6169b7233c0}{\_state}}.fetch\_add(\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a6784ad404e47c455f901f3392313561e}{kWaiterInc}},\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00380\ \ \ \ \ std::atomic\_thread\_fence(std::memory\_order\_seq\_cst);}
\DoxyCodeLine{00381\ \ \ \}}
\DoxyCodeLine{00382\ }
\DoxyCodeLine{00383\ \ \ \textcolor{comment}{//\ commit\_wait\ commits\ waiting\ after\ prepare\_wait.}}
\DoxyCodeLine{00384\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_afac95b8994215aa408609bf1aa303b4e}{commit\_wait}}(\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter}{Waiter}}*\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}})\ \{}
\DoxyCodeLine{00385\ \textcolor{preprocessor}{\#if\ \_\_cplusplus\ >=\ TF\_CPP20}}
\DoxyCodeLine{00386\ \ \ \ \ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>state.store(\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter_af531fdf01fc1ad10b7615f3e8cd806caaf1e89e639a5af88e20f4735b3f34ebdb}{Waiter::kNotSignaled}},\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00387\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00388\ \ \ \ \ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>state\ =\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter_af531fdf01fc1ad10b7615f3e8cd806caaf1e89e639a5af88e20f4735b3f34ebdb}{Waiter::kNotSignaled}};}
\DoxyCodeLine{00389\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00390\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ me\ =\ (\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}\ -\/\ \&\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_ab9a6466e4fbdeb4b961a71f597bed573}{\_waiters}}[0])\ |\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>epoch;}
\DoxyCodeLine{00391\ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ state\ =\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a00b086cd37998f6bc317f6169b7233c0}{\_state}}.load(std::memory\_order\_seq\_cst);}
\DoxyCodeLine{00392\ \ \ \ \ \textcolor{keywordflow}{for}\ (;;)\ \{}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \textcolor{comment}{//\_check\_state(state,\ true);}}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ newstate;}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a3a2118672e13fa288608d106cc2ffc10}{kSignalMask}})\ !=\ 0)\ \{}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Consume\ the\ signal\ and\ return\ immediately.}}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ newstate\ =\ state\ -\/\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a6784ad404e47c455f901f3392313561e}{kWaiterInc}}\ -\/\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a8cdbae658db294c269431b4f5ecc5a0e}{kSignalInc}};}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Remove\ this\ thread\ from\ pre-\/wait\ counter\ and\ add\ to\ the\ waiter\ stack.}}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ newstate\ =\ ((state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_abb22b562246bf3a486f33465e0af7df9}{kWaiterMask}})\ -\/\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a6784ad404e47c455f901f3392313561e}{kWaiterInc}})\ |\ me;}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>next.store(state\ \&\ (\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a18b4271b2cff3b7e95785604ee094ba0}{kStackMask}}\ |\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_ac920d120b2ad53ee655cbf82ae9813f3}{kEpochMask}}),\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \textcolor{comment}{//\_check\_state(newstate);}}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a00b086cd37998f6bc317f6169b7233c0}{\_state}}.compare\_exchange\_weak(state,\ newstate,\ std::memory\_order\_acq\_rel))\ \{}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a3a2118672e13fa288608d106cc2ffc10}{kSignalMask}})\ ==\ 0)\ \{}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>epoch\ +=\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_abc052e7db91b2be98cbd9e04fb3d0e6c}{kEpochInc}};}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a24701c99af44044f0600deac1161c8e0}{\_park}}(\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}});}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00411\ \ \ \ \ \}}
\DoxyCodeLine{00412\ \ \ \}}
\DoxyCodeLine{00413\ }
\DoxyCodeLine{00414\ \ \ \textcolor{comment}{//\ cancel\_wait\ cancels\ effects\ of\ the\ previous\ prepare\_wait\ call.}}
\DoxyCodeLine{00415\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a32818863b12ca8e629731dd8dd3f5583}{cancel\_wait}}(\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter}{Waiter}}*)\ \{}
\DoxyCodeLine{00416\ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ state\ =\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a00b086cd37998f6bc317f6169b7233c0}{\_state}}.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00417\ \ \ \ \ \textcolor{keywordflow}{for}\ (;;)\ \{}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \textcolor{comment}{//\_check\_state(state,\ true);}}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ newstate\ =\ state\ -\/\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a6784ad404e47c455f901f3392313561e}{kWaiterInc}};}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ don't\ know\ if\ the\ thread\ was\ also\ notified\ or\ not,}}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \textcolor{comment}{//\ so\ we\ should\ not\ consume\ a\ signal\ unconditionally.}}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \textcolor{comment}{//\ Only\ if\ number\ of\ waiters\ is\ equal\ to\ number\ of\ signals,}}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \textcolor{comment}{//\ we\ know\ that\ the\ thread\ was\ notified\ and\ we\ must\ take\ away\ the\ signal.}}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (((state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_abb22b562246bf3a486f33465e0af7df9}{kWaiterMask}})\ >>\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_af840fa6260467db4649e95a4e7e8b34a}{kWaiterShift}})\ ==\ ((state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a3a2118672e13fa288608d106cc2ffc10}{kSignalMask}})\ >>\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a41f1f65adb22ebb12bc5f171540f5c22}{kSignalShift}}))\ newstate\ -\/=\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a8cdbae658db294c269431b4f5ecc5a0e}{kSignalInc}};}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \textcolor{comment}{//\_check\_state(newstate);}}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a00b086cd37998f6bc317f6169b7233c0}{\_state}}.compare\_exchange\_weak(state,\ newstate,\ std::memory\_order\_acq\_rel))\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00427\ \ \ \ \ \}}
\DoxyCodeLine{00428\ \ \ \}}
\DoxyCodeLine{00429\ }
\DoxyCodeLine{00430\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a1c47eb3a2324941e6d7f561fe1ee79f7}{notify\_one}}()\ \{}
\DoxyCodeLine{00431\ \ \ \ \ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a7015c4fc985248a8b8e1f5f782881608}{\_notify<false>}}();}
\DoxyCodeLine{00432\ \ \ \}}
\DoxyCodeLine{00433\ }
\DoxyCodeLine{00434\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_af0f0218fb79ac6fd2645370d78d776a0}{notify\_all}}()\ \{}
\DoxyCodeLine{00435\ \ \ \ \ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a7015c4fc985248a8b8e1f5f782881608}{\_notify<true>}}();}
\DoxyCodeLine{00436\ \ \ \}}
\DoxyCodeLine{00437\ \ \ }
\DoxyCodeLine{00438\ \ \ \textcolor{comment}{//\ notify\ n\ workers}}
\DoxyCodeLine{00439\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a6e5c393615bcb15295877c67c0fbba97}{notify\_n}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}})\ \{}
\DoxyCodeLine{00440\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ >=\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_ab9a6466e4fbdeb4b961a71f597bed573}{\_waiters}}.size())\ \{}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a7015c4fc985248a8b8e1f5f782881608}{\_notify<true>}}();}
\DoxyCodeLine{00442\ \ \ \ \ \}}
\DoxyCodeLine{00443\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00444\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ k=0;\ k<\mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}};\ ++k)\ \{}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a7015c4fc985248a8b8e1f5f782881608}{\_notify<false>}}();}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00447\ \ \ \ \ \}}
\DoxyCodeLine{00448\ \ \ \}}
\DoxyCodeLine{00449\ }
\DoxyCodeLine{00450\ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_aa15b3a9e170142a0f66eb571eba5f02f}{size}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00451\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_ab9a6466e4fbdeb4b961a71f597bed573}{\_waiters}}.size();}
\DoxyCodeLine{00452\ \ \ \}}
\DoxyCodeLine{00453\ }
\DoxyCodeLine{00454\ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00455\ }
\DoxyCodeLine{00456\ }
\DoxyCodeLine{00457\ \ \ std::atomic<uint64\_t>\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a00b086cd37998f6bc317f6169b7233c0}{\_state}};}
\DoxyCodeLine{00458\ \ \ std::vector<Waiter>\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_ab9a6466e4fbdeb4b961a71f597bed573}{\_waiters}};}
\DoxyCodeLine{00459\ }
\DoxyCodeLine{00460\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a24701c99af44044f0600deac1161c8e0}{\_park}}(\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter}{Waiter}}*\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}})\ \{}
\DoxyCodeLine{00461\ \textcolor{preprocessor}{\#if\ \_\_cplusplus\ >=\ TF\_CPP20}}
\DoxyCodeLine{00462\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ target\ =\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter_af531fdf01fc1ad10b7615f3e8cd806caaf1e89e639a5af88e20f4735b3f34ebdb}{Waiter::kNotSignaled}};}
\DoxyCodeLine{00463\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>state.compare\_exchange\_strong(target,\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter_af531fdf01fc1ad10b7615f3e8cd806caa627fec371a96354ff7c5d331d78a7708}{Waiter::kWaiting}},}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_relaxed,}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::memory\_order\_relaxed))\ \{}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>state.wait(\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter_af531fdf01fc1ad10b7615f3e8cd806caa627fec371a96354ff7c5d331d78a7708}{Waiter::kWaiting}},\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00467\ \ \ \ \ \}}
\DoxyCodeLine{00468\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00469\ \ \ \ \ std::unique\_lock<std::mutex>\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>mu);}
\DoxyCodeLine{00470\ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>state\ !=\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter_af531fdf01fc1ad10b7615f3e8cd806caa0a867e509bc52dc110e1afdaaa1e7dfe}{Waiter::kSignaled}})\ \{}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>state\ =\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter_af531fdf01fc1ad10b7615f3e8cd806caa627fec371a96354ff7c5d331d78a7708}{Waiter::kWaiting}};}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>cv.wait(\mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}});}
\DoxyCodeLine{00473\ \ \ \ \ \}}
\DoxyCodeLine{00474\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00475\ \ \ \}}
\DoxyCodeLine{00476\ }
\DoxyCodeLine{00477\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a115e6457bc06bfb8a71a9cae06b75ef5}{\_unpark}}(\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter}{Waiter}}*\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}})\ \{}
\DoxyCodeLine{00478\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter}{Waiter}}*\ next;\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}};\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}\ =\ next)\ \{}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ wnext\ =\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>next.load(std::memory\_order\_relaxed)\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a18b4271b2cff3b7e95785604ee094ba0}{kStackMask}};}
\DoxyCodeLine{00480\ \ \ \ \ \ \ next\ =\ (wnext\ ==\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a18b4271b2cff3b7e95785604ee094ba0}{kStackMask}})\ ?\ \textcolor{keyword}{nullptr}\ :\ \&\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_ab9a6466e4fbdeb4b961a71f597bed573}{\_waiters}}[\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{size\_t}\textcolor{keyword}{>}(wnext)];}
\DoxyCodeLine{00481\ \textcolor{preprocessor}{\#if\ \_\_cplusplus\ >=\ TF\_CPP20}}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>state.exchange(\mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter_af531fdf01fc1ad10b7615f3e8cd806caa0a867e509bc52dc110e1afdaaa1e7dfe}{Waiter::kSignaled}},\ std::memory\_order\_relaxed)\ ==\ }
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter_af531fdf01fc1ad10b7615f3e8cd806caa627fec371a96354ff7c5d331d78a7708}{Waiter::kWaiting}})\ \{}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>state.notify\_one();}
\DoxyCodeLine{00485\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00486\ \textcolor{preprocessor}{\#else\ \ \ \ \ \ }}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ state;}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00489\ \ \ \ \ \ \ \ \ std::unique\_lock<std::mutex>\ \mbox{\hyperlink{ittnotify__static_8h_a46e8be2e3aadb2f6ee62e762a36b9243}{lock}}(\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>mu);}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ state\ =\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>state;}
\DoxyCodeLine{00491\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>state\ =\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter_af531fdf01fc1ad10b7615f3e8cd806caa0a867e509bc52dc110e1afdaaa1e7dfe}{Waiter::kSignaled}};}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00493\ \ \ \ \ \ \ \textcolor{comment}{//\ Avoid\ notifying\ if\ it\ wasn't\ waiting.}}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (state\ ==\ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter_af531fdf01fc1ad10b7615f3e8cd806caa627fec371a96354ff7c5d331d78a7708}{Waiter::kWaiting}})\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>cv.notify\_one();}
\DoxyCodeLine{00495\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00496\ \ \ \ \ \}}
\DoxyCodeLine{00497\ \ \ \}}
\DoxyCodeLine{00498\ \ \ }
\DoxyCodeLine{00499\ \ \ \textcolor{comment}{//\ Notify\ wakes\ one\ or\ all\ waiting\ threads.}}
\DoxyCodeLine{00500\ \ \ \textcolor{comment}{//\ Must\ be\ called\ after\ changing\ the\ associated\ wait\ predicate.}}
\DoxyCodeLine{00501\ \ \ \textcolor{keyword}{template}\ <\textcolor{keywordtype}{bool}\ notifyAll>}
\DoxyCodeLine{00502\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a7015c4fc985248a8b8e1f5f782881608}{\_notify}}()\ \{}
\DoxyCodeLine{00503\ \ \ \ \ std::atomic\_thread\_fence(std::memory\_order\_seq\_cst);}
\DoxyCodeLine{00504\ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ state\ =\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a00b086cd37998f6bc317f6169b7233c0}{\_state}}.load(std::memory\_order\_acquire);}
\DoxyCodeLine{00505\ \ \ \ \ \textcolor{keywordflow}{for}\ (;;)\ \{}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \textcolor{comment}{//\_check\_state(state);}}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ waiters\ =\ (state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_abb22b562246bf3a486f33465e0af7df9}{kWaiterMask}})\ >>\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_af840fa6260467db4649e95a4e7e8b34a}{kWaiterShift}};}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ signals\ =\ (state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a3a2118672e13fa288608d106cc2ffc10}{kSignalMask}})\ >>\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a41f1f65adb22ebb12bc5f171540f5c22}{kSignalShift}};}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \textcolor{comment}{//\ Easy\ case:\ no\ waiters.}}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a18b4271b2cff3b7e95785604ee094ba0}{kStackMask}})\ ==\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a18b4271b2cff3b7e95785604ee094ba0}{kStackMask}}\ \&\&\ waiters\ ==\ signals)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ newstate;}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (notifyAll)\ \{}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Empty\ wait\ stack\ and\ set\ signal\ to\ number\ of\ pre-\/wait\ threads.}}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \ \ newstate\ =\ (state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_abb22b562246bf3a486f33465e0af7df9}{kWaiterMask}})\ |\ (waiters\ <<\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a41f1f65adb22ebb12bc5f171540f5c22}{kSignalShift}})\ |\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a18b4271b2cff3b7e95785604ee094ba0}{kStackMask}};}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (signals\ <\ waiters)\ \{}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ There\ is\ a\ thread\ in\ pre-\/wait\ state,\ unblock\ it.}}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ newstate\ =\ state\ +\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a8cdbae658db294c269431b4f5ecc5a0e}{kSignalInc}};}
\DoxyCodeLine{00518\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00519\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pop\ a\ waiter\ from\ list\ and\ unpark\ it.}}
\DoxyCodeLine{00520\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter}{Waiter}}*\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}\ =\ \&\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_ab9a6466e4fbdeb4b961a71f597bed573}{\_waiters}}[state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a18b4271b2cff3b7e95785604ee094ba0}{kStackMask}}];}
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ next\ =\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>next.load(std::memory\_order\_relaxed);}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ newstate\ =\ (state\ \&\ (\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_abb22b562246bf3a486f33465e0af7df9}{kWaiterMask}}\ |\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a3a2118672e13fa288608d106cc2ffc10}{kSignalMask}}))\ |\ next;}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \textcolor{comment}{//\_check\_state(newstate);}}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a00b086cd37998f6bc317f6169b7233c0}{\_state}}.compare\_exchange\_weak(state,\ newstate,\ std::memory\_order\_acq\_rel))\ \{}
\DoxyCodeLine{00526\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!notifyAll\ \&\&\ (signals\ <\ waiters))\ \textcolor{keywordflow}{return};\ \ \textcolor{comment}{//\ unblocked\ pre-\/wait\ thread}}
\DoxyCodeLine{00527\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a18b4271b2cff3b7e95785604ee094ba0}{kStackMask}})\ ==\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a18b4271b2cff3b7e95785604ee094ba0}{kStackMask}})\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00528\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structtf_1_1_nonblocking_notifier_v2_1_1_waiter}{Waiter}}*\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}\ =\ \&\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_ab9a6466e4fbdeb4b961a71f597bed573}{\_waiters}}[state\ \&\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a18b4271b2cff3b7e95785604ee094ba0}{kStackMask}}];}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!notifyAll)\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}-\/>next.store(\mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a18b4271b2cff3b7e95785604ee094ba0}{kStackMask}},\ std::memory\_order\_relaxed);}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a115e6457bc06bfb8a71a9cae06b75ef5}{\_unpark}}(\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}});}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00533\ \ \ \ \ \}}
\DoxyCodeLine{00534\ \ \ \}}
\DoxyCodeLine{00535\ }
\DoxyCodeLine{00536\ \ \ \textcolor{comment}{//static\ void\ \_check\_state(uint64\_t\ state,\ bool\ waiter\ =\ false)\ \{}}
\DoxyCodeLine{00537\ \ \ \textcolor{comment}{//\ \ const\ uint64\_t\ waiters\ =\ (state\ \&\ kWaiterMask)\ >>\ kWaiterShift;}}
\DoxyCodeLine{00538\ \ \ \textcolor{comment}{//\ \ const\ uint64\_t\ signals\ =\ (state\ \&\ kSignalMask)\ >>\ kSignalShift;}}
\DoxyCodeLine{00539\ \ \ \textcolor{comment}{//\ \ assert(waiters\ >=\ signals);}}
\DoxyCodeLine{00540\ \ \ \textcolor{comment}{//\ \ assert(waiters\ <\ (1\ <<\ kWaiterBits)\ -\/\ 1);}}
\DoxyCodeLine{00541\ \ \ \textcolor{comment}{//\ \ assert(!waiter\ ||\ waiters\ >\ 0);}}
\DoxyCodeLine{00542\ \ \ \textcolor{comment}{//\ \ (void)waiters;}}
\DoxyCodeLine{00543\ \ \ \textcolor{comment}{//\ \ (void)signals;}}
\DoxyCodeLine{00544\ \ \ \textcolor{comment}{//\}}}
\DoxyCodeLine{00545\ }
\DoxyCodeLine{00546\ }
\DoxyCodeLine{00547\ \ \ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_aa01485f25129adf4c52ec5f531955ed0}{NonblockingNotifierV2}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a8c27449987934fa4526b0c304fd598e6}{NonblockingNotifierV2}}\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00548\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_aef3503c5fa42063375d1b074596088af}{operator=}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classtf_1_1_nonblocking_notifier_v2_a8c27449987934fa4526b0c304fd598e6}{NonblockingNotifierV2}}\&)\ =\ \textcolor{keyword}{delete};}
\DoxyCodeLine{00549\ \};}
\DoxyCodeLine{00550\ }
\DoxyCodeLine{00551\ }
\DoxyCodeLine{00552\ \}\ \ \textcolor{comment}{//\ namespace\ tf\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00553\ }

\end{DoxyCode}
