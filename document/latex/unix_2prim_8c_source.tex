\doxysection{prim.\+c}
\hypertarget{unix_2prim_8c_source}{}\label{unix_2prim_8c_source}\index{runtime/EASTL/packages/mimalloc/src/prim/unix/prim.c@{runtime/EASTL/packages/mimalloc/src/prim/unix/prim.c}}
\mbox{\hyperlink{unix_2prim_8c}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00002\ \textcolor{comment}{Copyright\ (c)\ 2018-\/2023,\ Microsoft\ Research,\ Daan\ Leijen}}
\DoxyCodeLine{00003\ \textcolor{comment}{This\ is\ free\ software;\ you\ can\ redistribute\ it\ and/or\ modify\ it\ under\ the}}
\DoxyCodeLine{00004\ \textcolor{comment}{terms\ of\ the\ MIT\ license.\ A\ copy\ of\ the\ license\ can\ be\ found\ in\ the\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{"{}LICENSE"{}\ at\ the\ root\ of\ this\ distribution.}}
\DoxyCodeLine{00006\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{comment}{//\ This\ file\ is\ included\ in\ \`{}src/prim/prim.c`}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#ifndef\ \_DEFAULT\_SOURCE}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#define\ \_DEFAULT\_SOURCE\ \ \ }\textcolor{comment}{//\ ensure\ mmap\ flags\ and\ syscall\ are\ defined}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#if\ defined(\_\_sun)}}
\DoxyCodeLine{00015\ \textcolor{comment}{//\ illumos\ provides\ new\ mman.h\ api\ when\ any\ of\ these\ are\ defined}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ otherwise\ the\ old\ api\ based\ on\ caddr\_t\ which\ predates\ the\ void\ pointers\ one.}}
\DoxyCodeLine{00017\ \textcolor{comment}{//\ stock\ solaris\ provides\ only\ the\ former,\ chose\ to\ atomically\ to\ discard\ those}}
\DoxyCodeLine{00018\ \textcolor{comment}{//\ flags\ only\ here\ rather\ than\ project\ wide\ tough.}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#undef\ \_XOPEN\_SOURCE}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#undef\ \_POSIX\_C\_SOURCE}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mimalloc_8h}{mimalloc.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h}{mimalloc/internal.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{prim_8h}{mimalloc/prim.h}}"{}}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ <sys/mman.h>}\ \ \textcolor{comment}{//\ mmap}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ <unistd.h>}\ \ \ \ \textcolor{comment}{//\ sysconf}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ <fcntl.h>}\ \ \ \ \ \textcolor{comment}{//\ open,\ close,\ read,\ access}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ <stdlib.h>}\ \ \ \ \textcolor{comment}{//\ getenv,\ arc4random\_buf}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#if\ defined(\_\_linux\_\_)}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\ \ \#include\ <features.h>}}
\DoxyCodeLine{00034\ \ \ \textcolor{comment}{//\#if\ defined(MI\_NO\_THP)}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\ \ \#include\ <sys/prctl.h>}\ \ \textcolor{comment}{//\ THP\ disable}}
\DoxyCodeLine{00036\ \ \ \textcolor{comment}{//\#endif}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\ \ \#if\ defined(\_\_GLIBC\_\_)}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\ \ \#include\ <linux/mman.h>}\ \textcolor{comment}{//\ linux\ mmap\ flags}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\ \ \#include\ <sys/mman.h>}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\#elif\ defined(\_\_APPLE\_\_)}}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\ \ \#include\ <AvailabilityMacros.h>}}
\DoxyCodeLine{00044\ \textcolor{preprocessor}{\ \ \#include\ <TargetConditionals.h>}}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\ \ \#if\ !defined(TARGET\_OS\_OSX)\ ||\ TARGET\_OS\_OSX\ \ \ }\textcolor{comment}{//\ see\ issue\ \#879,\ used\ to\ be\ (!TARGET\_IOS\_IPHONE\ \&\&\ !TARGET\_IOS\_SIMULATOR)}}
\DoxyCodeLine{00046\ \textcolor{preprocessor}{\ \ \#include\ <mach/vm\_statistics.h>}\ \ \ \ \textcolor{comment}{//\ VM\_MAKE\_TAG,\ VM\_FLAGS\_SUPERPAGE\_SIZE\_2MB,\ etc.}}
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00048\ \textcolor{preprocessor}{\ \ \#if\ !defined(MAC\_OS\_X\_VERSION\_10\_7)}}
\DoxyCodeLine{00049\ \textcolor{preprocessor}{\ \ \#define\ MAC\_OS\_X\_VERSION\_10\_7\ \ \ 1070}}
\DoxyCodeLine{00050\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00051\ \textcolor{preprocessor}{\#elif\ defined(\_\_FreeBSD\_\_)\ ||\ defined(\_\_DragonFly\_\_)}}
\DoxyCodeLine{00052\ \textcolor{preprocessor}{\ \ \#include\ <sys/param.h>}}
\DoxyCodeLine{00053\ \textcolor{preprocessor}{\ \ \#if\ \_\_FreeBSD\_version\ >=\ 1200000}}
\DoxyCodeLine{00054\ \textcolor{preprocessor}{\ \ \#include\ <sys/cpuset.h>}}
\DoxyCodeLine{00055\ \textcolor{preprocessor}{\ \ \#include\ <sys/domainset.h>}}
\DoxyCodeLine{00056\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00057\ \textcolor{preprocessor}{\ \ \#include\ <sys/sysctl.h>}}
\DoxyCodeLine{00058\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \textcolor{preprocessor}{\#if\ (defined(\_\_linux\_\_)\ \&\&\ !defined(\_\_ANDROID\_\_))\ ||\ defined(\_\_FreeBSD\_\_)}}
\DoxyCodeLine{00061\ \textcolor{preprocessor}{\ \ \#define\ MI\_HAS\_SYSCALL\_H}}
\DoxyCodeLine{00062\ \textcolor{preprocessor}{\ \ \#include\ <sys/syscall.h>}}
\DoxyCodeLine{00063\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \textcolor{preprocessor}{\#if\ !defined(MADV\_DONTNEED)\ \&\&\ defined(POSIX\_MADV\_DONTNEED)\ \ }\textcolor{comment}{//\ QNX}}
\DoxyCodeLine{00066\ \textcolor{preprocessor}{\#define\ MADV\_DONTNEED\ \ POSIX\_MADV\_DONTNEED}}
\DoxyCodeLine{00067\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00068\ \textcolor{preprocessor}{\#if\ !defined(MADV\_FREE)\ \&\&\ defined(POSIX\_MADV\_FREE)\ \ }\textcolor{comment}{//\ QNX}}
\DoxyCodeLine{00069\ \textcolor{preprocessor}{\#define\ MADV\_FREE\ \ POSIX\_MADV\_FREE}}
\DoxyCodeLine{00070\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \textcolor{preprocessor}{\#define\ MI\_UNIX\_LARGE\_PAGE\_SIZE\ (2*MI\_MiB)\ }\textcolor{comment}{//\ TODO:\ can\ we\ query\ the\ OS\ for\ this?}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ }
\DoxyCodeLine{00075\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00076\ \textcolor{comment}{//\ Use\ syscalls\ for\ some\ primitives\ to\ allow\ for\ libraries\ that\ override\ open/read/close\ etc.}}
\DoxyCodeLine{00077\ \textcolor{comment}{//\ and\ do\ allocation\ themselves;\ using\ syscalls\ prevents\ recursion\ when\ mimalloc\ is}}
\DoxyCodeLine{00078\ \textcolor{comment}{//\ still\ initializing\ (issue\ \#713)}}
\DoxyCodeLine{00079\ \textcolor{comment}{//\ Declare\ inline\ to\ avoid\ unused\ function\ warnings.}}
\DoxyCodeLine{00080\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \textcolor{preprocessor}{\#if\ defined(MI\_HAS\_SYSCALL\_H)\ \&\&\ defined(SYS\_open)\ \&\&\ defined(SYS\_close)\ \&\&\ defined(SYS\_read)\ \&\&\ defined(SYS\_access)}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{unix_2prim_8c_a0860bd7d20380405ebe50dc48e9996e4}{mi\_prim\_open}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ fpath,\ \textcolor{keywordtype}{int}\ open\_flags)\ \{}
\DoxyCodeLine{00085\ \ \ \textcolor{keywordflow}{return}\ syscall(SYS\_open,fpath,open\_flags,0);}
\DoxyCodeLine{00086\ \}}
\DoxyCodeLine{00087\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{eabase_8h_a831c6b6852c6d34448e30a88c34539fd}{ssize\_t}}\ \mbox{\hyperlink{unix_2prim_8c_ae77fe82ffa9c3ceedea9d71d1a62438b}{mi\_prim\_read}}(\textcolor{keywordtype}{int}\ fd,\ \textcolor{keywordtype}{void}*\ buf,\ \textcolor{keywordtype}{size\_t}\ bufsize)\ \{}
\DoxyCodeLine{00088\ \ \ \textcolor{keywordflow}{return}\ syscall(SYS\_read,fd,buf,bufsize);}
\DoxyCodeLine{00089\ \}}
\DoxyCodeLine{00090\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{unix_2prim_8c_a1bf67c8e43c8df4cefd984bee41c81a9}{mi\_prim\_close}}(\textcolor{keywordtype}{int}\ fd)\ \{}
\DoxyCodeLine{00091\ \ \ \textcolor{keywordflow}{return}\ syscall(SYS\_close,fd);}
\DoxyCodeLine{00092\ \}}
\DoxyCodeLine{00093\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{unix_2prim_8c_af87cfabacad5bf46cd34930bcc9b6c67}{mi\_prim\_access}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *fpath,\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a1e71d9c196e4683cc06c4b54d53f7ef5}{mode}})\ \{}
\DoxyCodeLine{00094\ \ \ \textcolor{keywordflow}{return}\ syscall(SYS\_access,fpath,\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a1e71d9c196e4683cc06c4b54d53f7ef5}{mode}});}
\DoxyCodeLine{00095\ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{unix_2prim_8c_a0860bd7d20380405ebe50dc48e9996e4}{mi\_prim\_open}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ fpath,\ \textcolor{keywordtype}{int}\ open\_flags)\ \{}
\DoxyCodeLine{00100\ \ \ \textcolor{keywordflow}{return}\ open(fpath,open\_flags);}
\DoxyCodeLine{00101\ \}}
\DoxyCodeLine{00102\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{eabase_8h_a831c6b6852c6d34448e30a88c34539fd}{ssize\_t}}\ \mbox{\hyperlink{unix_2prim_8c_ae77fe82ffa9c3ceedea9d71d1a62438b}{mi\_prim\_read}}(\textcolor{keywordtype}{int}\ fd,\ \textcolor{keywordtype}{void}*\ buf,\ \textcolor{keywordtype}{size\_t}\ bufsize)\ \{}
\DoxyCodeLine{00103\ \ \ \textcolor{keywordflow}{return}\ read(fd,buf,bufsize);}
\DoxyCodeLine{00104\ \}}
\DoxyCodeLine{00105\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{unix_2prim_8c_a1bf67c8e43c8df4cefd984bee41c81a9}{mi\_prim\_close}}(\textcolor{keywordtype}{int}\ fd)\ \{}
\DoxyCodeLine{00106\ \ \ \textcolor{keywordflow}{return}\ close(fd);}
\DoxyCodeLine{00107\ \}}
\DoxyCodeLine{00108\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{unix_2prim_8c_af87cfabacad5bf46cd34930bcc9b6c67}{mi\_prim\_access}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *fpath,\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a1e71d9c196e4683cc06c4b54d53f7ef5}{mode}})\ \{}
\DoxyCodeLine{00109\ \ \ \textcolor{keywordflow}{return}\ access(fpath,\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a1e71d9c196e4683cc06c4b54d53f7ef5}{mode}});}
\DoxyCodeLine{00110\ \}}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00117\ \textcolor{comment}{//\ init}}
\DoxyCodeLine{00118\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{unix_2prim_8c_a1a5253b60c9ac22c51eaa623d8df1a53}{unix\_detect\_overcommit}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00121\ \ \ \textcolor{keywordtype}{bool}\ os\_overcommit\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00122\ \textcolor{preprocessor}{\#if\ defined(\_\_linux\_\_)}}
\DoxyCodeLine{00123\ \ \ \textcolor{keywordtype}{int}\ fd\ =\ \mbox{\hyperlink{unix_2prim_8c_a0860bd7d20380405ebe50dc48e9996e4}{mi\_prim\_open}}(\textcolor{stringliteral}{"{}/proc/sys/vm/overcommit\_memory"{}},\ O\_RDONLY);}
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{keywordflow}{if}\ (fd\ >=\ 0)\ \{}
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{keywordtype}{char}\ buf[32];}
\DoxyCodeLine{00126\ \ \ \ \ \mbox{\hyperlink{eabase_8h_a831c6b6852c6d34448e30a88c34539fd}{ssize\_t}}\ nread\ =\ \mbox{\hyperlink{unix_2prim_8c_ae77fe82ffa9c3ceedea9d71d1a62438b}{mi\_prim\_read}}(fd,\ \&buf,\ \textcolor{keyword}{sizeof}(buf));}
\DoxyCodeLine{00127\ \ \ \ \ \mbox{\hyperlink{unix_2prim_8c_a1bf67c8e43c8df4cefd984bee41c81a9}{mi\_prim\_close}}(fd);}
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{comment}{//\ <https://www.kernel.org/doc/Documentation/vm/overcommit-\/accounting>}}
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{comment}{//\ 0:\ heuristic\ overcommit,\ 1:\ always\ overcommit,\ 2:\ never\ overcommit\ (ignore\ NORESERVE)}}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keywordflow}{if}\ (nread\ >=\ 1)\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ os\_overcommit\ =\ (buf[0]\ ==\ \textcolor{charliteral}{'0'}\ ||\ buf[0]\ ==\ \textcolor{charliteral}{'1'});}
\DoxyCodeLine{00132\ \ \ \ \ \}}
\DoxyCodeLine{00133\ \ \ \}}
\DoxyCodeLine{00134\ \textcolor{preprocessor}{\#elif\ defined(\_\_FreeBSD\_\_)}}
\DoxyCodeLine{00135\ \ \ \textcolor{keywordtype}{int}\ val\ =\ 0;}
\DoxyCodeLine{00136\ \ \ \textcolor{keywordtype}{size\_t}\ olen\ =\ \textcolor{keyword}{sizeof}(val);}
\DoxyCodeLine{00137\ \ \ \textcolor{keywordflow}{if}\ (sysctlbyname(\textcolor{stringliteral}{"{}vm.overcommit"{}},\ \&val,\ \&olen,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ 0)\ ==\ 0)\ \{}
\DoxyCodeLine{00138\ \ \ \ \ os\_overcommit\ =\ (val\ !=\ 0);}
\DoxyCodeLine{00139\ \ \ \}}
\DoxyCodeLine{00140\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00141\ \ \ \textcolor{comment}{//\ default:\ overcommit\ is\ true}}
\DoxyCodeLine{00142\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00143\ \ \ \textcolor{keywordflow}{return}\ os\_overcommit;}
\DoxyCodeLine{00144\ \}}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{emscripten_2prim_8c_a5f95deaa4c625e888392c68c62b5b8de}{\_mi\_prim\_mem\_init}}(\ \mbox{\hyperlink{prim_8h_a1eff7306f3d00df9d9b62d3d8a6a26f1}{mi\_os\_mem\_config\_t}}*\ config\ )}
\DoxyCodeLine{00147\ \{}
\DoxyCodeLine{00148\ \ \ \textcolor{keywordtype}{long}\ psize\ =\ sysconf(\_SC\_PAGESIZE);}
\DoxyCodeLine{00149\ \ \ \textcolor{keywordflow}{if}\ (psize\ >\ 0)\ \{}
\DoxyCodeLine{00150\ \ \ \ \ config-\/>\mbox{\hyperlink{structmi__os__mem__config__s_aafaac041180aa100b423bb76e7fe5735}{page\_size}}\ =\ (size\_t)psize;}
\DoxyCodeLine{00151\ \ \ \ \ config-\/>\mbox{\hyperlink{structmi__os__mem__config__s_acfe90f9051568d5c8278f926152477ca}{alloc\_granularity}}\ =\ (size\_t)psize;}
\DoxyCodeLine{00152\ \textcolor{preprocessor}{\ \ \ \ \#if\ defined(\_SC\_PHYS\_PAGES)}}
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{keywordtype}{long}\ pphys\ =\ sysconf(\_SC\_PHYS\_PAGES);}
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ psize\_in\_kib\ =\ (size\_t)psize\ /\ \mbox{\hyperlink{bits_8h_adbafbf7fe5512b55fb47ea52426a2b63}{MI\_KiB}};}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keywordflow}{if}\ (psize\_in\_kib\ >\ 0\ \&\&\ pphys\ >\ 0\ \&\&\ (\textcolor{keywordtype}{size\_t})pphys\ <=\ (SIZE\_MAX/psize\_in\_kib))\ \{}
\DoxyCodeLine{00156\ \ \ \ \ \ \ config-\/>\mbox{\hyperlink{structmi__os__mem__config__s_a973d009d82510a872df5bb623e26a2f7}{physical\_memory\_in\_kib}}\ =\ (size\_t)pphys\ *\ psize\_in\_kib;}
\DoxyCodeLine{00157\ \ \ \ \ \}}
\DoxyCodeLine{00158\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{00159\ \ \ \}}
\DoxyCodeLine{00160\ \ \ config-\/>\mbox{\hyperlink{structmi__os__mem__config__s_a01e20af43bfd37b904d5c4af705e74e7}{large\_page\_size}}\ =\ \mbox{\hyperlink{unix_2prim_8c_a46cfc2de4b53956beb7460b2f44ef63d}{MI\_UNIX\_LARGE\_PAGE\_SIZE}};}
\DoxyCodeLine{00161\ \ \ config-\/>\mbox{\hyperlink{structmi__os__mem__config__s_a2a318ac7722f5c09a1ee295e369c2c6a}{has\_overcommit}}\ =\ \mbox{\hyperlink{unix_2prim_8c_a1a5253b60c9ac22c51eaa623d8df1a53}{unix\_detect\_overcommit}}();}
\DoxyCodeLine{00162\ \ \ config-\/>\mbox{\hyperlink{structmi__os__mem__config__s_a152a5a28172d7ada8902a030d0164331}{has\_partial\_free}}\ =\ \textcolor{keyword}{true};\ \ \ \ \textcolor{comment}{//\ mmap\ can\ free\ in\ parts}}
\DoxyCodeLine{00163\ \ \ config-\/>\mbox{\hyperlink{structmi__os__mem__config__s_a727caa055141f3bba998bcfd455f431a}{has\_virtual\_reserve}}\ =\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ todo:\ check\ if\ this\ true\ for\ NetBSD?\ \ (for\ anonymous\ mmap\ with\ PROT\_NONE)}}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \textcolor{comment}{//\ disable\ transparent\ huge\ pages\ for\ this\ process?}}
\DoxyCodeLine{00166\ \textcolor{preprocessor}{\ \ \#if\ (defined(\_\_linux\_\_)\ ||\ defined(\_\_ANDROID\_\_))\ \&\&\ defined(PR\_GET\_THP\_DISABLE)}}
\DoxyCodeLine{00167\ \textcolor{preprocessor}{\ \ \#if\ defined(MI\_NO\_THP)}}
\DoxyCodeLine{00168\ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{true})}
\DoxyCodeLine{00169\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00170\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{group__options_ga459ad98f18b3fc9275474807fe0ca188}{mi\_option\_is\_enabled}}(\mbox{\hyperlink{group__options_ggacf0af9f50d2fca76b4e158d611bc930ba7cc4804ced69004fa42a9a136a9ba556}{mi\_option\_allow\_large\_os\_pages}}))\ \textcolor{comment}{//\ disable\ THP\ also\ if\ large\ OS\ pages\ are\ not\ allowed\ in\ the\ options}}
\DoxyCodeLine{00171\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00172\ \ \ \{}
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{keywordtype}{int}\ val\ =\ 0;}
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{keywordflow}{if}\ (prctl(PR\_GET\_THP\_DISABLE,\ \&val,\ 0,\ 0,\ 0)\ !=\ 0)\ \{}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \textcolor{comment}{//\ Most\ likely\ since\ distros\ often\ come\ with\ always/madvise\ settings.}}
\DoxyCodeLine{00176\ \ \ \ \ \ \ val\ =\ 1;}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \textcolor{comment}{//\ Disabling\ only\ for\ mimalloc\ process\ rather\ than\ touching\ system\ wide\ settings}}
\DoxyCodeLine{00178\ \ \ \ \ \ \ (\mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}})prctl(PR\_SET\_THP\_DISABLE,\ \&val,\ 0,\ 0,\ 0);}
\DoxyCodeLine{00179\ \ \ \ \ \}}
\DoxyCodeLine{00180\ \ \ \}}
\DoxyCodeLine{00181\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00182\ \}}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00186\ \textcolor{comment}{//\ free}}
\DoxyCodeLine{00187\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{emscripten_2prim_8c_a709e08e93548cbede90a196d306ab4f9}{\_mi\_prim\_free}}(\textcolor{keywordtype}{void}*\ addr,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}}\ )\ \{}
\DoxyCodeLine{00190\ \ \ \textcolor{keywordtype}{bool}\ err\ =\ (munmap(addr,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}})\ ==\ -\/1);}
\DoxyCodeLine{00191\ \ \ \textcolor{keywordflow}{return}\ (err\ ?\ errno\ :\ 0);}
\DoxyCodeLine{00192\ \}}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00196\ \textcolor{comment}{//\ mmap}}
\DoxyCodeLine{00197\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{unix_2prim_8c_a61020908ba889442fa111a46d9d59a0f}{unix\_madvise}}(\textcolor{keywordtype}{void}*\ addr,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ \textcolor{keywordtype}{int}\ advice)\ \{}
\DoxyCodeLine{00200\ \textcolor{preprocessor}{\ \ \#if\ defined(\_\_sun)}}
\DoxyCodeLine{00201\ \ \ \textcolor{keywordtype}{int}\ res\ =\ madvise((caddr\_t)addr,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ advice);\ \ \textcolor{comment}{//\ Solaris\ needs\ cast\ (issue\ \#520)}}
\DoxyCodeLine{00202\ \textcolor{preprocessor}{\ \ \#elif\ defined(\_\_QNX\_\_)}}
\DoxyCodeLine{00203\ \ \ \textcolor{keywordtype}{int}\ res\ =\ posix\_madvise(addr,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ advice);}
\DoxyCodeLine{00204\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00205\ \ \ \textcolor{keywordtype}{int}\ res\ =\ madvise(addr,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ advice);}
\DoxyCodeLine{00206\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00207\ \ \ \textcolor{keywordflow}{return}\ (res==0\ ?\ 0\ :\ errno);}
\DoxyCodeLine{00208\ \}}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{unix_2prim_8c_a3af6442dcb3d5160c0b46e8c55dc138a}{unix\_mmap\_prim}}(\textcolor{keywordtype}{void}*\ addr,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ \textcolor{keywordtype}{size\_t}\ try\_alignment,\ \textcolor{keywordtype}{int}\ protect\_flags,\ \textcolor{keywordtype}{int}\ flags,\ \textcolor{keywordtype}{int}\ fd)\ \{}
\DoxyCodeLine{00211\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(try\_alignment);}
\DoxyCodeLine{00212\ \ \ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00213\ \textcolor{preprocessor}{\ \ \#if\ defined(MAP\_ALIGNED)\ \ }\textcolor{comment}{//\ BSD}}
\DoxyCodeLine{00214\ \ \ \textcolor{keywordflow}{if}\ (addr\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ \&\&\ try\_alignment\ >\ 1\ \&\&\ (try\_alignment\ \%\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a723e4c95209d4c6282b53317473e83d5}{\_mi\_os\_page\_size}}())\ ==\ 0)\ \{}
\DoxyCodeLine{00215\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ idx;}
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ n\ =\ \mbox{\hyperlink{bits_8h_ae1a375404b8024ab419cfc537db20741}{mi\_bsr}}(try\_alignment,\ \&idx);}
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{keywordflow}{if}\ (((\textcolor{keywordtype}{size\_t})1\ <<\ n)\ ==\ try\_alignment\ \&\&\ n\ >=\ 12\ \&\&\ n\ <=\ 30)\ \{\ \ \textcolor{comment}{//\ alignment\ is\ a\ power\ of\ 2\ and\ 4096\ <=\ alignment\ <=\ 1GiB}}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ mmap(addr,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ protect\_flags,\ flags\ |\ MAP\_ALIGNED(n),\ fd,\ 0);}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}==MAP\_FAILED\ ||\ !\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ad446ae4d82cbdbd78dfbe46fa2330555}{\_mi\_is\_aligned}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},try\_alignment))\ \{}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ err\ =\ errno;}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a39ef30e22895c4ec5fa3ca58922412f5}{\_mi\_trace\_message}}(\textcolor{stringliteral}{"{}unable\ to\ directly\ request\ aligned\ OS\ memory\ (error:\ \%d\ (0x\%x),\ size:\ 0x\%zx\ bytes,\ alignment:\ 0x\%zx,\ hint\ address:\ \%p)\(\backslash\)n"{}},\ err,\ err,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ try\_alignment,\ addr);}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}!=MAP\_FAILED)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}};}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \textcolor{comment}{//\ fall\ back\ to\ regular\ mmap}}
\DoxyCodeLine{00225\ \ \ \ \ \}}
\DoxyCodeLine{00226\ \ \ \}}
\DoxyCodeLine{00227\ \textcolor{preprocessor}{\ \ \#elif\ defined(MAP\_ALIGN)\ \ }\textcolor{comment}{//\ Solaris}}
\DoxyCodeLine{00228\ \ \ \textcolor{keywordflow}{if}\ (addr\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ \&\&\ try\_alignment\ >\ 1\ \&\&\ (try\_alignment\ \%\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a723e4c95209d4c6282b53317473e83d5}{\_mi\_os\_page\_size}}())\ ==\ 0)\ \{}
\DoxyCodeLine{00229\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ mmap((\textcolor{keywordtype}{void}*)try\_alignment,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ protect\_flags,\ flags\ |\ MAP\_ALIGN,\ fd,\ 0);\ \ \textcolor{comment}{//\ addr\ parameter\ is\ the\ required\ alignment}}
\DoxyCodeLine{00230\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}!=MAP\_FAILED)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}};}
\DoxyCodeLine{00231\ \ \ \ \ \textcolor{comment}{//\ fall\ back\ to\ regular\ mmap}}
\DoxyCodeLine{00232\ \ \ \}}
\DoxyCodeLine{00233\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00234\ \textcolor{preprocessor}{\ \ \#if\ (MI\_INTPTR\_SIZE\ >=\ 8)\ \&\&\ !defined(MAP\_ALIGNED)}}
\DoxyCodeLine{00235\ \ \ \textcolor{comment}{//\ on\ 64-\/bit\ systems,\ use\ the\ virtual\ address\ area\ after\ 2TiB\ for\ 4MiB\ aligned\ allocations}}
\DoxyCodeLine{00236\ \ \ \textcolor{keywordflow}{if}\ (addr\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00237\ \ \ \ \ \textcolor{keywordtype}{void}*\ hint\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a91db0c766bc3be65860971d827244f70}{\_mi\_os\_get\_aligned\_hint}}(try\_alignment,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}});}
\DoxyCodeLine{00238\ \ \ \ \ \textcolor{keywordflow}{if}\ (hint\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ mmap(hint,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ protect\_flags,\ flags,\ fd,\ 0);}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}==MAP\_FAILED\ ||\ !\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ad446ae4d82cbdbd78dfbe46fa2330555}{\_mi\_is\_aligned}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},try\_alignment))\ \{}
\DoxyCodeLine{00241\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#if\ MI\_TRACK\_ENABLED\ \ }\textcolor{comment}{//\ asan\ sometimes\ does\ not\ instrument\ errno\ correctly?}}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ err\ =\ 0;}
\DoxyCodeLine{00243\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#else}}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ err\ =\ errno;}
\DoxyCodeLine{00245\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a39ef30e22895c4ec5fa3ca58922412f5}{\_mi\_trace\_message}}(\textcolor{stringliteral}{"{}unable\ to\ directly\ request\ hinted\ aligned\ OS\ memory\ (error:\ \%d\ (0x\%x),\ size:\ 0x\%zx\ bytes,\ alignment:\ 0x\%zx,\ hint\ address:\ \%p)\(\backslash\)n"{}},\ err,\ err,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ try\_alignment,\ hint);}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}!=MAP\_FAILED)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}};}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \textcolor{comment}{//\ fall\ back\ to\ regular\ mmap}}
\DoxyCodeLine{00250\ \ \ \ \ \}}
\DoxyCodeLine{00251\ \ \ \}}
\DoxyCodeLine{00252\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00253\ \ \ \textcolor{comment}{//\ regular\ mmap}}
\DoxyCodeLine{00254\ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ mmap(addr,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ protect\_flags,\ flags,\ fd,\ 0);}
\DoxyCodeLine{00255\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}!=MAP\_FAILED)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}};}
\DoxyCodeLine{00256\ \ \ \textcolor{comment}{//\ failed\ to\ allocate}}
\DoxyCodeLine{00257\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00258\ \}}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00260\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{unix_2prim_8c_a69a6883e0ea3f1decbe81c9d6983658e}{unix\_mmap\_fd}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00261\ \textcolor{preprocessor}{\ \ \#if\ defined(VM\_MAKE\_TAG)}}
\DoxyCodeLine{00262\ \ \ \textcolor{comment}{//\ macOS:\ tracking\ anonymous\ page\ with\ a\ specific\ ID.\ (All\ up\ to\ 98\ are\ taken\ officially\ but\ LLVM\ sanitizers\ had\ taken\ 99)}}
\DoxyCodeLine{00263\ \ \ \textcolor{keywordtype}{int}\ os\_tag\ =\ (\mbox{\hyperlink{sugar_8h_ae88a82478e3818cade3f598c25437904}{int}})\mbox{\hyperlink{group__options_ga7e8af195cc81d3fa64ccf2662caa565a}{mi\_option\_get}}(\mbox{\hyperlink{group__options_ggacf0af9f50d2fca76b4e158d611bc930ba4b74ae2a69e445de6c2361b73c1d14bf}{mi\_option\_os\_tag}});}
\DoxyCodeLine{00264\ \ \ \textcolor{keywordflow}{if}\ (os\_tag\ <\ 100\ ||\ os\_tag\ >\ 255)\ \{\ os\_tag\ =\ 254;\ \}}
\DoxyCodeLine{00265\ \ \ \textcolor{keywordflow}{return}\ VM\_MAKE\_TAG(os\_tag);}
\DoxyCodeLine{00266\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00267\ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00268\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00269\ \}}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{unix_2prim_8c_aa3051fdf833061d1d03f43ad2a30a05e}{unix\_mmap}}(\textcolor{keywordtype}{void}*\ addr,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ \textcolor{keywordtype}{size\_t}\ try\_alignment,\ \textcolor{keywordtype}{int}\ protect\_flags,\ \textcolor{keywordtype}{bool}\ large\_only,\ \textcolor{keywordtype}{bool}\ allow\_large,\ \textcolor{keywordtype}{bool}*\ is\_large)\ \{}
\DoxyCodeLine{00272\ \textcolor{preprocessor}{\ \ \#if\ !defined(MAP\_ANONYMOUS)}}
\DoxyCodeLine{00273\ \textcolor{preprocessor}{\ \ \#define\ MAP\_ANONYMOUS\ \ MAP\_ANON}}
\DoxyCodeLine{00274\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00275\ \textcolor{preprocessor}{\ \ \#if\ !defined(MAP\_NORESERVE)}}
\DoxyCodeLine{00276\ \textcolor{preprocessor}{\ \ \#define\ MAP\_NORESERVE\ \ 0}}
\DoxyCodeLine{00277\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00278\ \ \ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00279\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ fd\ =\ \mbox{\hyperlink{unix_2prim_8c_a69a6883e0ea3f1decbe81c9d6983658e}{unix\_mmap\_fd}}();}
\DoxyCodeLine{00280\ \ \ \textcolor{keywordtype}{int}\ flags\ =\ MAP\_PRIVATE\ |\ \mbox{\hyperlink{unix_2prim_8c_ae4f86bff73414c5fc08c058f957212f0}{MAP\_ANONYMOUS}};}
\DoxyCodeLine{00281\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab15bd169082d58502da1d18e7ae61044}{\_mi\_os\_has\_overcommit}}())\ \{}
\DoxyCodeLine{00282\ \ \ \ \ flags\ |=\ \mbox{\hyperlink{unix_2prim_8c_ad1c6c22db4e0baa46eea82f3170c1e79}{MAP\_NORESERVE}};}
\DoxyCodeLine{00283\ \ \ \}}
\DoxyCodeLine{00284\ \textcolor{preprocessor}{\ \ \#if\ defined(PROT\_MAX)}}
\DoxyCodeLine{00285\ \ \ protect\_flags\ |=\ PROT\_MAX(PROT\_READ\ |\ PROT\_WRITE);\ \textcolor{comment}{//\ BSD}}
\DoxyCodeLine{00286\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00287\ \ \ \textcolor{comment}{//\ huge\ page\ allocation}}
\DoxyCodeLine{00288\ \ \ \textcolor{keywordflow}{if}\ (allow\_large\ \&\&\ (large\_only\ ||\ (\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a6b00bb2f9c5d978099d20ddbd439d153}{\_mi\_os\_use\_large\_page}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ try\_alignment)\ \&\&\ \mbox{\hyperlink{group__options_ga7e8af195cc81d3fa64ccf2662caa565a}{mi\_option\_get}}(\mbox{\hyperlink{group__options_ggacf0af9f50d2fca76b4e158d611bc930ba7cc4804ced69004fa42a9a136a9ba556}{mi\_option\_allow\_large\_os\_pages}})\ ==\ 1)))\ \{}
\DoxyCodeLine{00289\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\textcolor{keywordtype}{size\_t})\ large\_page\_try\_ok;\ \textcolor{comment}{//\ =\ 0;}}
\DoxyCodeLine{00290\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ try\_ok\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_afd6e6e0fbd3a1be232115b5617ca2f65}{mi\_atomic\_load\_acquire}}(\&large\_page\_try\_ok);}
\DoxyCodeLine{00291\ \ \ \ \ \textcolor{keywordflow}{if}\ (!large\_only\ \&\&\ try\_ok\ >\ 0)\ \{}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ OS\ is\ not\ configured\ for\ large\ OS\ pages,\ or\ the\ user\ does\ not\ have}}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \textcolor{comment}{//\ enough\ permission,\ the\ \`{}mmap`\ will\ always\ fail\ (but\ it\ might\ also\ fail\ for\ other\ reasons).}}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \textcolor{comment}{//\ Therefore,\ once\ a\ large\ page\ allocation\ failed,\ we\ don't\ try\ again\ for\ \`{}large\_page\_try\_ok`\ times}}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \textcolor{comment}{//\ to\ avoid\ too\ many\ failing\ calls\ to\ mmap.}}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad2b681b3847687b6c6ce801d1673f81b}{mi\_atomic\_cas\_strong\_acq\_rel}}(\&large\_page\_try\_ok,\ \&try\_ok,\ try\_ok\ -\/\ 1);}
\DoxyCodeLine{00297\ \ \ \ \ \}}
\DoxyCodeLine{00298\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ lflags\ =\ flags\ \&\ \mbox{\hyperlink{unix_2prim_8c_ad1c6c22db4e0baa46eea82f3170c1e79}{\string~MAP\_NORESERVE}};\ \ \textcolor{comment}{//\ using\ NORESERVE\ on\ huge\ pages\ seems\ to\ fail\ on\ Linux}}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ lfd\ =\ fd;}
\DoxyCodeLine{00301\ \textcolor{preprocessor}{\ \ \ \ \ \ \#ifdef\ MAP\_ALIGNED\_SUPER}}
\DoxyCodeLine{00302\ \ \ \ \ \ \ lflags\ |=\ MAP\_ALIGNED\_SUPER;}
\DoxyCodeLine{00303\ \textcolor{preprocessor}{\ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00304\ \textcolor{preprocessor}{\ \ \ \ \ \ \#ifdef\ MAP\_HUGETLB}}
\DoxyCodeLine{00305\ \ \ \ \ \ \ lflags\ |=\ MAP\_HUGETLB;}
\DoxyCodeLine{00306\ \textcolor{preprocessor}{\ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00307\ \textcolor{preprocessor}{\ \ \ \ \ \ \#ifdef\ MAP\_HUGE\_1GB}}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ mi\_huge\_pages\_available\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (large\_only\ \&\&\ (\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}}\ \%\ \mbox{\hyperlink{bits_8h_a5d0d221f27b912f5fc202d2b0367468f}{MI\_GiB}})\ ==\ 0\ \&\&\ mi\_huge\_pages\_available)\ \{}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ lflags\ |=\ MAP\_HUGE\_1GB;}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00313\ \textcolor{preprocessor}{\ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00315\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#ifdef\ MAP\_HUGE\_2MB}}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ lflags\ |=\ MAP\_HUGE\_2MB;}
\DoxyCodeLine{00317\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00319\ \textcolor{preprocessor}{\ \ \ \ \ \ \#ifdef\ VM\_FLAGS\_SUPERPAGE\_SIZE\_2MB}}
\DoxyCodeLine{00320\ \ \ \ \ \ \ lfd\ |=\ VM\_FLAGS\_SUPERPAGE\_SIZE\_2MB;}
\DoxyCodeLine{00321\ \textcolor{preprocessor}{\ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (large\_only\ ||\ lflags\ !=\ flags)\ \{}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ try\ large\ OS\ page\ allocation}}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ *is\_large\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ \mbox{\hyperlink{unix_2prim_8c_a3af6442dcb3d5160c0b46e8c55dc138a}{unix\_mmap\_prim}}(addr,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ try\_alignment,\ protect\_flags,\ lflags,\ lfd);}
\DoxyCodeLine{00326\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#ifdef\ MAP\_HUGE\_1GB}}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ \&\&\ (lflags\ \&\ MAP\_HUGE\_1GB)\ ==\ MAP\_HUGE\_1GB)\ \{}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \ \ mi\_huge\_pages\_available\ =\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ don't\ try\ huge\ 1GiB\ pages\ again}}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (large\_only)\ \{}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac253cac2ca24fb63be7f4937ac620dc4}{\_mi\_warning\_message}}(\textcolor{stringliteral}{"{}unable\ to\ allocate\ huge\ (1GiB)\ page,\ trying\ large\ (2MiB)\ pages\ instead\ (errno:\ \%i)\(\backslash\)n"{}},\ errno);}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \ \ lflags\ =\ ((lflags\ \&\ \string~MAP\_HUGE\_1GB)\ |\ MAP\_HUGE\_2MB);}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ \mbox{\hyperlink{unix_2prim_8c_a3af6442dcb3d5160c0b46e8c55dc138a}{unix\_mmap\_prim}}(addr,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ try\_alignment,\ protect\_flags,\ lflags,\ lfd);}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00335\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (large\_only)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}};}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a1ee5baaa0004b9c737a03d48d77a0194}{mi\_atomic\_store\_release}}(\&large\_page\_try\_ok,\ (\textcolor{keywordtype}{size\_t})8);\ \ \textcolor{comment}{//\ on\ error,\ don't\ try\ again\ for\ the\ next\ N\ allocations}}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00341\ \ \ \ \ \}}
\DoxyCodeLine{00342\ \ \ \}}
\DoxyCodeLine{00343\ \ \ \textcolor{comment}{//\ regular\ allocation}}
\DoxyCodeLine{00344\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00345\ \ \ \ \ *is\_large\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00346\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ \mbox{\hyperlink{unix_2prim_8c_a3af6442dcb3d5160c0b46e8c55dc138a}{unix\_mmap\_prim}}(addr,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ try\_alignment,\ protect\_flags,\ flags,\ fd);}
\DoxyCodeLine{00347\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00348\ \textcolor{preprocessor}{\ \ \ \ \ \ \#if\ defined(MADV\_HUGEPAGE)}}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \textcolor{comment}{//\ Many\ Linux\ systems\ don't\ allow\ MAP\_HUGETLB\ but\ they\ support\ instead}}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \textcolor{comment}{//\ transparent\ huge\ pages\ (THP).\ Generally,\ it\ is\ not\ required\ to\ call\ \`{}madvise`\ with\ MADV\_HUGE}}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \textcolor{comment}{//\ though\ since\ properly\ aligned\ allocations\ will\ already\ use\ large\ pages\ if\ available}}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \textcolor{comment}{//\ in\ that\ case\ -\/-\/\ in\ particular\ for\ our\ large\ regions\ (in\ \`{}memory.c`).}}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \textcolor{comment}{//\ However,\ some\ systems\ only\ allow\ THP\ if\ called\ with\ explicit\ \`{}madvise`,\ so}}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \textcolor{comment}{//\ when\ large\ OS\ pages\ are\ enabled\ for\ mimalloc,\ we\ call\ \`{}madvise`\ anyways.}}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (allow\_large\ \&\&\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a6b00bb2f9c5d978099d20ddbd439d153}{\_mi\_os\_use\_large\_page}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ try\_alignment))\ \{}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{unix_2prim_8c_a61020908ba889442fa111a46d9d59a0f}{unix\_madvise}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ MADV\_HUGEPAGE)\ ==\ 0)\ \{}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ *is\_large\ =\ true;\ //\ possibly}}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \};}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00360\ \textcolor{preprocessor}{\ \ \ \ \ \ \#elif\ defined(\_\_sun)}}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (allow\_large\ \&\&\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a6b00bb2f9c5d978099d20ddbd439d153}{\_mi\_os\_use\_large\_page}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ try\_alignment))\ \{}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }memcntl\_mha\ cmd\ =\ \{0\};}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ cmd.mha\_pagesize\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a7dcadbfdf83d72eca344f128fca39fd8}{\_mi\_os\_large\_page\_size}}();}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ cmd.mha\_cmd\ =\ MHA\_MAPSIZE\_VA;}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (memcntl((caddr\_t)\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ MC\_HAT\_ADVISE,\ (caddr\_t)\&cmd,\ 0,\ 0)\ ==\ 0)\ \{}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ *is\_large\ =\ true;\ //\ possibly}}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00369\ \textcolor{preprocessor}{\ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00370\ \ \ \ \ \}}
\DoxyCodeLine{00371\ \ \ \}}
\DoxyCodeLine{00372\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}};}
\DoxyCodeLine{00373\ \}}
\DoxyCodeLine{00374\ }
\DoxyCodeLine{00375\ \textcolor{comment}{//\ Note:\ the\ \`{}try\_alignment`\ is\ just\ a\ hint\ and\ the\ returned\ pointer\ is\ not\ guaranteed\ to\ be\ aligned.}}
\DoxyCodeLine{00376\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{emscripten_2prim_8c_af6b664f566e88b730b416f6d7cc715ae}{\_mi\_prim\_alloc}}(\textcolor{keywordtype}{void}*\ hint\_addr,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ \textcolor{keywordtype}{size\_t}\ try\_alignment,\ \textcolor{keywordtype}{bool}\ commit,\ \textcolor{keywordtype}{bool}\ allow\_large,\ \textcolor{keywordtype}{bool}*\ is\_large,\ \textcolor{keywordtype}{bool}*\ is\_zero,\ \textcolor{keywordtype}{void}**\ addr)\ \{}
\DoxyCodeLine{00377\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}}\ >\ 0\ \&\&\ (\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}}\ \%\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a723e4c95209d4c6282b53317473e83d5}{\_mi\_os\_page\_size}}())\ ==\ 0);}
\DoxyCodeLine{00378\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(commit\ ||\ !allow\_large);}
\DoxyCodeLine{00379\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(try\_alignment\ >\ 0);}
\DoxyCodeLine{00380\ \ \ \textcolor{keywordflow}{if}\ (hint\_addr\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ \&\&\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}}\ >=\ 8*\mbox{\hyperlink{unix_2prim_8c_a46cfc2de4b53956beb7460b2f44ef63d}{MI\_UNIX\_LARGE\_PAGE\_SIZE}}\ \&\&\ try\_alignment\ >\ 1\ \&\&\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac46068515202fb9642f6b2610836bd82}{\_mi\_is\_power\_of\_two}}(try\_alignment)\ \&\&\ try\_alignment\ <\ \mbox{\hyperlink{unix_2prim_8c_a46cfc2de4b53956beb7460b2f44ef63d}{MI\_UNIX\_LARGE\_PAGE\_SIZE}})\ \{}
\DoxyCodeLine{00381\ \ \ \ \ try\_alignment\ =\ \mbox{\hyperlink{unix_2prim_8c_a46cfc2de4b53956beb7460b2f44ef63d}{MI\_UNIX\_LARGE\_PAGE\_SIZE}};\ \textcolor{comment}{//\ try\ to\ align\ along\ large\ page\ size\ for\ larger\ allocations}}
\DoxyCodeLine{00382\ \ \ \}}
\DoxyCodeLine{00383\ }
\DoxyCodeLine{00384\ \ \ *is\_zero\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00385\ \ \ \textcolor{keywordtype}{int}\ protect\_flags\ =\ (commit\ ?\ (PROT\_WRITE\ |\ PROT\_READ)\ :\ PROT\_NONE);}
\DoxyCodeLine{00386\ \ \ *addr\ =\ \mbox{\hyperlink{unix_2prim_8c_aa3051fdf833061d1d03f43ad2a30a05e}{unix\_mmap}}(hint\_addr,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ try\_alignment,\ protect\_flags,\ \textcolor{keyword}{false},\ allow\_large,\ is\_large);}
\DoxyCodeLine{00387\ \ \ \textcolor{keywordflow}{return}\ (*addr\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ ?\ 0\ :\ errno);}
\DoxyCodeLine{00388\ \}}
\DoxyCodeLine{00389\ }
\DoxyCodeLine{00390\ }
\DoxyCodeLine{00391\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00392\ \textcolor{comment}{//\ Commit/Reset}}
\DoxyCodeLine{00393\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00394\ }
\DoxyCodeLine{00395\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{unix_2prim_8c_a7729d7cf0976d9e9fdc1d344d80e7d14}{unix\_mprotect\_hint}}(\textcolor{keywordtype}{int}\ err)\ \{}
\DoxyCodeLine{00396\ \textcolor{preprocessor}{\ \ \#if\ defined(\_\_linux\_\_)\ \&\&\ (MI\_SECURE>=2)\ }\textcolor{comment}{//\ guard\ page\ around\ every\ mimalloc\ page}}
\DoxyCodeLine{00397\ \ \ \textcolor{keywordflow}{if}\ (err\ ==\ \mbox{\hyperlink{types_8h_a6a05c923dad0c1208043e9c20a58c8e5}{ENOMEM}})\ \{}
\DoxyCodeLine{00398\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac253cac2ca24fb63be7f4937ac620dc4}{\_mi\_warning\_message}}(\textcolor{stringliteral}{"{}The\ next\ warning\ may\ be\ caused\ by\ a\ low\ memory\ map\ limit.\(\backslash\)n"{}}}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ On\ Linux\ this\ is\ controlled\ by\ the\ vm.max\_map\_count\ -\/-\/\ maybe\ increase\ it?\(\backslash\)n"{}}}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\ \ For\ example:\ sudo\ sysctl\ -\/w\ vm.max\_map\_count=262144\(\backslash\)n"{}});}
\DoxyCodeLine{00401\ \ \ \}}
\DoxyCodeLine{00402\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00403\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(err);}
\DoxyCodeLine{00404\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00405\ \}}
\DoxyCodeLine{00406\ }
\DoxyCodeLine{00407\ }
\DoxyCodeLine{00408\ }
\DoxyCodeLine{00409\ }
\DoxyCodeLine{00410\ }
\DoxyCodeLine{00411\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{emscripten_2prim_8c_a723c63d8d2b51281ab1ef2bf7e7395d0}{\_mi\_prim\_commit}}(\textcolor{keywordtype}{void}*\ start,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ \textcolor{keywordtype}{bool}*\ is\_zero)\ \{}
\DoxyCodeLine{00412\ \ \ \textcolor{comment}{//\ commit:\ ensure\ we\ can\ access\ the\ area}}
\DoxyCodeLine{00413\ \ \ \textcolor{comment}{//\ note:\ we\ may\ think\ that\ *is\_zero\ can\ be\ true\ since\ the\ memory}}
\DoxyCodeLine{00414\ \ \ \textcolor{comment}{//\ was\ either\ from\ mmap\ PROT\_NONE,\ or\ from\ decommit\ MADV\_DONTNEED,\ but}}
\DoxyCodeLine{00415\ \ \ \textcolor{comment}{//\ we\ sometimes\ call\ commit\ on\ a\ range\ with\ still\ partially\ committed}}
\DoxyCodeLine{00416\ \ \ \textcolor{comment}{//\ memory\ and\ \`{}mprotect`\ does\ not\ zero\ the\ range.}}
\DoxyCodeLine{00417\ \ \ *is\_zero\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00418\ \ \ \textcolor{keywordtype}{int}\ err\ =\ mprotect(start,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ (PROT\_READ\ |\ PROT\_WRITE));}
\DoxyCodeLine{00419\ \ \ \textcolor{keywordflow}{if}\ (err\ !=\ 0)\ \{}
\DoxyCodeLine{00420\ \ \ \ \ err\ =\ errno;}
\DoxyCodeLine{00421\ \ \ \ \ \mbox{\hyperlink{unix_2prim_8c_a7729d7cf0976d9e9fdc1d344d80e7d14}{unix\_mprotect\_hint}}(err);}
\DoxyCodeLine{00422\ \ \ \}}
\DoxyCodeLine{00423\ \ \ \textcolor{keywordflow}{return}\ err;}
\DoxyCodeLine{00424\ \}}
\DoxyCodeLine{00425\ }
\DoxyCodeLine{00426\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{emscripten_2prim_8c_a2acc81743909f52f06f690457ea3dfcb}{\_mi\_prim\_decommit}}(\textcolor{keywordtype}{void}*\ start,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ \textcolor{keywordtype}{bool}*\ needs\_recommit)\ \{}
\DoxyCodeLine{00427\ \ \ \textcolor{keywordtype}{int}\ err\ =\ 0;}
\DoxyCodeLine{00428\ \ \ \textcolor{comment}{//\ decommit:\ use\ MADV\_DONTNEED\ as\ it\ decreases\ rss\ immediately\ (unlike\ MADV\_FREE)}}
\DoxyCodeLine{00429\ \ \ err\ =\ \mbox{\hyperlink{unix_2prim_8c_a61020908ba889442fa111a46d9d59a0f}{unix\_madvise}}(start,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ MADV\_DONTNEED);}
\DoxyCodeLine{00430\ \textcolor{preprocessor}{\ \ \#if\ !MI\_DEBUG\ \&\&\ MI\_SECURE<=2}}
\DoxyCodeLine{00431\ \ \ \ \ *needs\_recommit\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00432\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00433\ \ \ \ \ *needs\_recommit\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00434\ \ \ \ \ mprotect(start,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ PROT\_NONE);}
\DoxyCodeLine{00435\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00436\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00437\ \textcolor{comment}{\ \ //\ decommit:\ use\ mmap\ with\ MAP\_FIXED\ and\ PROT\_NONE\ to\ discard\ the\ existing\ memory\ (and\ reduce\ rss)}}
\DoxyCodeLine{00438\ \textcolor{comment}{\ \ *needs\_recommit\ =\ true;}}
\DoxyCodeLine{00439\ \textcolor{comment}{\ \ const\ int\ fd\ =\ unix\_mmap\_fd();}}
\DoxyCodeLine{00440\ \textcolor{comment}{\ \ void*\ p\ =\ mmap(start,\ size,\ PROT\_NONE,\ (MAP\_FIXED\ |\ MAP\_PRIVATE\ |\ MAP\_ANONYMOUS\ |\ MAP\_NORESERVE),\ fd,\ 0);}}
\DoxyCodeLine{00441\ \textcolor{comment}{\ \ if\ (p\ !=\ start)\ \{\ err\ =\ errno;\ \}}}
\DoxyCodeLine{00442\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00443\ \ \ \textcolor{keywordflow}{return}\ err;}
\DoxyCodeLine{00444\ \}}
\DoxyCodeLine{00445\ }
\DoxyCodeLine{00446\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{emscripten_2prim_8c_abe3f45858d8d0aa2a4a7deb0c8a49c10}{\_mi\_prim\_reset}}(\textcolor{keywordtype}{void}*\ start,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}})\ \{}
\DoxyCodeLine{00447\ \ \ \textcolor{comment}{//\ We\ try\ to\ use\ \`{}MADV\_FREE`\ as\ that\ is\ the\ fastest.\ A\ drawback\ though\ is\ that\ it}}
\DoxyCodeLine{00448\ \ \ \textcolor{comment}{//\ will\ not\ reduce\ the\ \`{}rss`\ stats\ in\ tools\ like\ \`{}top`\ even\ though\ the\ memory\ is\ available}}
\DoxyCodeLine{00449\ \ \ \textcolor{comment}{//\ to\ other\ processes.\ With\ the\ default\ \`{}MIMALLOC\_PURGE\_DECOMMITS=1`\ we\ ensure\ that\ by}}
\DoxyCodeLine{00450\ \ \ \textcolor{comment}{//\ default\ \`{}MADV\_DONTNEED`\ is\ used\ though.}}
\DoxyCodeLine{00451\ \textcolor{preprocessor}{\ \ \#if\ defined(MADV\_FREE)}}
\DoxyCodeLine{00452\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\textcolor{keywordtype}{size\_t})\ advice\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a033180eba618dcf49a5a3f0ad6bfdeb9}{MI\_ATOMIC\_VAR\_INIT}}(MADV\_FREE);}
\DoxyCodeLine{00453\ \ \ \textcolor{keywordtype}{int}\ oadvice\ =\ (\mbox{\hyperlink{sugar_8h_ae88a82478e3818cade3f598c25437904}{int}})\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&advice);}
\DoxyCodeLine{00454\ \ \ \textcolor{keywordtype}{int}\ err;}
\DoxyCodeLine{00455\ \ \ \textcolor{keywordflow}{while}\ ((err\ =\ \mbox{\hyperlink{unix_2prim_8c_a61020908ba889442fa111a46d9d59a0f}{unix\_madvise}}(start,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ oadvice))\ !=\ 0\ \&\&\ errno\ ==\ \mbox{\hyperlink{types_8h_af0fac1cea1165b4debec7f686edf3313}{EAGAIN}})\ \{\ errno\ =\ 0;\ \ \};}
\DoxyCodeLine{00456\ \ \ \textcolor{keywordflow}{if}\ (err\ !=\ 0\ \&\&\ errno\ ==\ \mbox{\hyperlink{types_8h_a2d1678d5a7cc8ce499643f3b8957def4}{EINVAL}}\ \&\&\ oadvice\ ==\ MADV\_FREE)\ \{}
\DoxyCodeLine{00457\ \ \ \ \ \textcolor{comment}{//\ if\ MADV\_FREE\ is\ not\ supported,\ fall\ back\ to\ MADV\_DONTNEED\ from\ now\ on}}
\DoxyCodeLine{00458\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a1ee5baaa0004b9c737a03d48d77a0194}{mi\_atomic\_store\_release}}(\&advice,\ (\textcolor{keywordtype}{size\_t})MADV\_DONTNEED);}
\DoxyCodeLine{00459\ \ \ \ \ err\ =\ \mbox{\hyperlink{unix_2prim_8c_a61020908ba889442fa111a46d9d59a0f}{unix\_madvise}}(start,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ MADV\_DONTNEED);}
\DoxyCodeLine{00460\ \ \ \}}
\DoxyCodeLine{00461\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00462\ \ \ \textcolor{keywordtype}{int}\ err\ =\ \mbox{\hyperlink{unix_2prim_8c_a61020908ba889442fa111a46d9d59a0f}{unix\_madvise}}(start,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ MADV\_DONTNEED);}
\DoxyCodeLine{00463\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00464\ \ \ \textcolor{keywordflow}{return}\ err;}
\DoxyCodeLine{00465\ \}}
\DoxyCodeLine{00466\ }
\DoxyCodeLine{00467\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{emscripten_2prim_8c_a26d6836cdf59dd0534f1a348fb5bfeb0}{\_mi\_prim\_protect}}(\textcolor{keywordtype}{void}*\ start,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ \textcolor{keywordtype}{bool}\ protect)\ \{}
\DoxyCodeLine{00468\ \ \ \textcolor{keywordtype}{int}\ err\ =\ mprotect(start,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ protect\ ?\ PROT\_NONE\ :\ (PROT\_READ\ |\ PROT\_WRITE));}
\DoxyCodeLine{00469\ \ \ \textcolor{keywordflow}{if}\ (err\ !=\ 0)\ \{\ err\ =\ errno;\ \}}
\DoxyCodeLine{00470\ \ \ \mbox{\hyperlink{unix_2prim_8c_a7729d7cf0976d9e9fdc1d344d80e7d14}{unix\_mprotect\_hint}}(err);}
\DoxyCodeLine{00471\ \ \ \textcolor{keywordflow}{return}\ err;}
\DoxyCodeLine{00472\ \}}
\DoxyCodeLine{00473\ }
\DoxyCodeLine{00474\ }
\DoxyCodeLine{00475\ }
\DoxyCodeLine{00476\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00477\ \textcolor{comment}{//\ Huge\ page\ allocation}}
\DoxyCodeLine{00478\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00479\ }
\DoxyCodeLine{00480\ \textcolor{preprocessor}{\#if\ (MI\_INTPTR\_SIZE\ >=\ 8)\ \&\&\ !defined(\_\_HAIKU\_\_)\ \&\&\ !defined(\_\_CYGWIN\_\_)}}
\DoxyCodeLine{00481\ }
\DoxyCodeLine{00482\ \textcolor{preprocessor}{\#ifndef\ MPOL\_PREFERRED}}
\DoxyCodeLine{00483\ \textcolor{preprocessor}{\#define\ MPOL\_PREFERRED\ 1}}
\DoxyCodeLine{00484\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00485\ }
\DoxyCodeLine{00486\ \textcolor{preprocessor}{\#if\ defined(MI\_HAS\_SYSCALL\_H)\ \&\&\ defined(SYS\_mbind)}}
\DoxyCodeLine{00487\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{long}\ mi\_prim\_mbind(\textcolor{keywordtype}{void}*\ start,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ len,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a1e71d9c196e4683cc06c4b54d53f7ef5}{mode}},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}*\ nmask,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ maxnode,\ \textcolor{keywordtype}{unsigned}\ flags)\ \{}
\DoxyCodeLine{00488\ \ \ \textcolor{keywordflow}{return}\ syscall(SYS\_mbind,\ start,\ len,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a1e71d9c196e4683cc06c4b54d53f7ef5}{mode}},\ nmask,\ maxnode,\ flags);}
\DoxyCodeLine{00489\ \}}
\DoxyCodeLine{00490\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00491\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{long}\ mi\_prim\_mbind(\textcolor{keywordtype}{void}*\ start,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ len,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a1e71d9c196e4683cc06c4b54d53f7ef5}{mode}},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}*\ nmask,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ maxnode,\ \textcolor{keywordtype}{unsigned}\ flags)\ \{}
\DoxyCodeLine{00492\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(start);\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(len);\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a1e71d9c196e4683cc06c4b54d53f7ef5}{mode}});\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(nmask);\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(maxnode);\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(flags);}
\DoxyCodeLine{00493\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00494\ \}}
\DoxyCodeLine{00495\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00496\ }
\DoxyCodeLine{00497\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{emscripten_2prim_8c_a13fac5d38adde1e627f69b7ad9123d5e}{\_mi\_prim\_alloc\_huge\_os\_pages}}(\textcolor{keywordtype}{void}*\ hint\_addr,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ \textcolor{keywordtype}{int}\ numa\_node,\ \textcolor{keywordtype}{bool}*\ is\_zero,\ \textcolor{keywordtype}{void}**\ addr)\ \{}
\DoxyCodeLine{00498\ \ \ \textcolor{keywordtype}{bool}\ is\_large\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00499\ \ \ *is\_zero\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00500\ \ \ *addr\ =\ \mbox{\hyperlink{unix_2prim_8c_aa3051fdf833061d1d03f43ad2a30a05e}{unix\_mmap}}(hint\_addr,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ \mbox{\hyperlink{types_8h_afc49bf695fd66cb4c4572fc7972b28ad}{MI\_ARENA\_SLICE\_ALIGN}},\ PROT\_READ\ |\ PROT\_WRITE,\ \textcolor{keyword}{true},\ \textcolor{keyword}{true},\ \&is\_large);}
\DoxyCodeLine{00501\ \ \ \textcolor{keywordflow}{if}\ (*addr\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ \&\&\ numa\_node\ >=\ 0\ \&\&\ numa\_node\ <\ 8*\mbox{\hyperlink{bits_8h_af8a1f49c3ca95474d8fc5fdb53874026}{MI\_INTPTR\_SIZE}})\ \{\ \textcolor{comment}{//\ at\ most\ 64\ nodes}}
\DoxyCodeLine{00502\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ numa\_mask\ =\ (1UL\ <<\ numa\_node);}
\DoxyCodeLine{00503\ \ \ \ \ \textcolor{comment}{//\ TODO:\ does\ \`{}mbind`\ work\ correctly\ for\ huge\ OS\ pages?\ should\ we}}
\DoxyCodeLine{00504\ \ \ \ \ \textcolor{comment}{//\ use\ \`{}set\_mempolicy`\ before\ calling\ mmap\ instead?}}
\DoxyCodeLine{00505\ \ \ \ \ \textcolor{comment}{//\ see:\ <https://lkml.org/lkml/2017/2/9/875>}}
\DoxyCodeLine{00506\ \ \ \ \ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{namespacespdlog_1_1level_a335eabf5eff13482903eb26be08f3861a4d723e295b98a75c1263d85fc165045f}{err}}\ =\ mi\_prim\_mbind(*addr,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ MPOL\_PREFERRED,\ \&numa\_mask,\ 8*\mbox{\hyperlink{bits_8h_af8a1f49c3ca95474d8fc5fdb53874026}{MI\_INTPTR\_SIZE}},\ 0);}
\DoxyCodeLine{00507\ \ \ \ \ \textcolor{keywordflow}{if}\ (err\ !=\ 0)\ \{}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \mbox{\hyperlink{namespacespdlog_1_1level_a335eabf5eff13482903eb26be08f3861a4d723e295b98a75c1263d85fc165045f}{err}}\ =\ errno;}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac253cac2ca24fb63be7f4937ac620dc4}{\_mi\_warning\_message}}(\textcolor{stringliteral}{"{}failed\ to\ bind\ huge\ (1GiB)\ pages\ to\ numa\ node\ \%d\ (error:\ \%d\ (0x\%x))\(\backslash\)n"{}},\ numa\_node,\ err,\ err);}
\DoxyCodeLine{00510\ \ \ \ \ \}}
\DoxyCodeLine{00511\ \ \ \}}
\DoxyCodeLine{00512\ \ \ \textcolor{keywordflow}{return}\ (*addr\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ ?\ 0\ :\ errno);}
\DoxyCodeLine{00513\ \}}
\DoxyCodeLine{00514\ }
\DoxyCodeLine{00515\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00516\ }
\DoxyCodeLine{00517\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{emscripten_2prim_8c_a13fac5d38adde1e627f69b7ad9123d5e}{\_mi\_prim\_alloc\_huge\_os\_pages}}(\textcolor{keywordtype}{void}*\ hint\_addr,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}},\ \textcolor{keywordtype}{int}\ numa\_node,\ \textcolor{keywordtype}{bool}*\ is\_zero,\ \textcolor{keywordtype}{void}**\ addr)\ \{}
\DoxyCodeLine{00518\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(hint\_addr);\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}});\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(numa\_node);}
\DoxyCodeLine{00519\ \ \ *is\_zero\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00520\ \ \ *addr\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00521\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{types_8h_a6a05c923dad0c1208043e9c20a58c8e5}{ENOMEM}};}
\DoxyCodeLine{00522\ \}}
\DoxyCodeLine{00523\ }
\DoxyCodeLine{00524\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00525\ }
\DoxyCodeLine{00526\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00527\ \textcolor{comment}{//\ NUMA\ nodes}}
\DoxyCodeLine{00528\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00529\ }
\DoxyCodeLine{00530\ \textcolor{preprocessor}{\#if\ defined(\_\_linux\_\_)}}
\DoxyCodeLine{00531\ }
\DoxyCodeLine{00532\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{emscripten_2prim_8c_a933262d22f5d4ebb70599b45c3104236}{\_mi\_prim\_numa\_node}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00533\ \textcolor{preprocessor}{\ \ \#if\ defined(MI\_HAS\_SYSCALL\_H)\ \&\&\ defined(SYS\_getcpu)}}
\DoxyCodeLine{00534\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ node\ =\ 0;}
\DoxyCodeLine{00535\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ ncpu\ =\ 0;}
\DoxyCodeLine{00536\ \ \ \ \ \textcolor{keywordtype}{long}\ \mbox{\hyperlink{namespacespdlog_1_1level_a335eabf5eff13482903eb26be08f3861a4d723e295b98a75c1263d85fc165045f}{err}}\ =\ syscall(SYS\_getcpu,\ \&ncpu,\ \&node,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00537\ \ \ \ \ \textcolor{keywordflow}{if}\ (err\ !=\ 0)\ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00538\ \ \ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{00539\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00540\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00541\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00542\ \}}
\DoxyCodeLine{00543\ }
\DoxyCodeLine{00544\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{emscripten_2prim_8c_a82cc1dc0b2e542453248153dfbff0ef1}{\_mi\_prim\_numa\_node\_count}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00545\ \ \ \textcolor{keywordtype}{char}\ buf[128];}
\DoxyCodeLine{00546\ \ \ \textcolor{keywordtype}{unsigned}\ node\ =\ 0;}
\DoxyCodeLine{00547\ \ \ \textcolor{keywordflow}{for}(node\ =\ 0;\ node\ <\ 256;\ node++)\ \{}
\DoxyCodeLine{00548\ \ \ \ \ \textcolor{comment}{//\ enumerate\ node\ entries\ -\/-\/\ todo:\ it\ there\ a\ more\ efficient\ way\ to\ do\ this?\ (but\ ensure\ there\ is\ no\ allocation)}}
\DoxyCodeLine{00549\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a6c2f4673e3317f332571bc1bec18c49b}{\_mi\_snprintf}}(buf,\ 127,\ \textcolor{stringliteral}{"{}/sys/devices/system/node/node\%u"{}},\ node\ +\ 1);}
\DoxyCodeLine{00550\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{unix_2prim_8c_af87cfabacad5bf46cd34930bcc9b6c67}{mi\_prim\_access}}(buf,R\_OK)\ !=\ 0)\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00551\ \ \ \}}
\DoxyCodeLine{00552\ \ \ \textcolor{keywordflow}{return}\ (node+1);}
\DoxyCodeLine{00553\ \}}
\DoxyCodeLine{00554\ }
\DoxyCodeLine{00555\ \textcolor{preprocessor}{\#elif\ defined(\_\_FreeBSD\_\_)\ \&\&\ \_\_FreeBSD\_version\ >=\ 1200000}}
\DoxyCodeLine{00556\ }
\DoxyCodeLine{00557\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{emscripten_2prim_8c_a933262d22f5d4ebb70599b45c3104236}{\_mi\_prim\_numa\_node}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00558\ \ \ domainset\_t\ dom;}
\DoxyCodeLine{00559\ \ \ \textcolor{keywordtype}{size\_t}\ node;}
\DoxyCodeLine{00560\ \ \ \textcolor{keywordtype}{int}\ policy;}
\DoxyCodeLine{00561\ \ \ \textcolor{keywordflow}{if}\ (cpuset\_getdomain(CPU\_LEVEL\_CPUSET,\ CPU\_WHICH\_PID,\ -\/1,\ \textcolor{keyword}{sizeof}(dom),\ \&dom,\ \&policy)\ ==\ -\/1)\ \textcolor{keywordflow}{return}\ 0ul;}
\DoxyCodeLine{00562\ \ \ \textcolor{keywordflow}{for}\ (node\ =\ 0;\ node\ <\ MAXMEMDOM;\ node++)\ \{}
\DoxyCodeLine{00563\ \ \ \ \ \textcolor{keywordflow}{if}\ (DOMAINSET\_ISSET(node,\ \&dom))\ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{00564\ \ \ \}}
\DoxyCodeLine{00565\ \ \ \textcolor{keywordflow}{return}\ 0ul;}
\DoxyCodeLine{00566\ \}}
\DoxyCodeLine{00567\ }
\DoxyCodeLine{00568\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{emscripten_2prim_8c_a82cc1dc0b2e542453248153dfbff0ef1}{\_mi\_prim\_numa\_node\_count}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00569\ \ \ \textcolor{keywordtype}{size\_t}\ ndomains\ =\ 0;}
\DoxyCodeLine{00570\ \ \ \textcolor{keywordtype}{size\_t}\ len\ =\ \textcolor{keyword}{sizeof}(ndomains);}
\DoxyCodeLine{00571\ \ \ \textcolor{keywordflow}{if}\ (sysctlbyname(\textcolor{stringliteral}{"{}vm.ndomains"{}},\ \&ndomains,\ \&len,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ 0)\ ==\ -\/1)\ \textcolor{keywordflow}{return}\ 0ul;}
\DoxyCodeLine{00572\ \ \ \textcolor{keywordflow}{return}\ ndomains;}
\DoxyCodeLine{00573\ \}}
\DoxyCodeLine{00574\ }
\DoxyCodeLine{00575\ \textcolor{preprocessor}{\#elif\ defined(\_\_DragonFly\_\_)}}
\DoxyCodeLine{00576\ }
\DoxyCodeLine{00577\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{emscripten_2prim_8c_a933262d22f5d4ebb70599b45c3104236}{\_mi\_prim\_numa\_node}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00578\ \ \ \textcolor{comment}{//\ TODO:\ DragonFly\ does\ not\ seem\ to\ provide\ any\ userland\ means\ to\ get\ this\ information.}}
\DoxyCodeLine{00579\ \ \ \textcolor{keywordflow}{return}\ 0ul;}
\DoxyCodeLine{00580\ \}}
\DoxyCodeLine{00581\ }
\DoxyCodeLine{00582\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{emscripten_2prim_8c_a82cc1dc0b2e542453248153dfbff0ef1}{\_mi\_prim\_numa\_node\_count}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00583\ \ \ \textcolor{keywordtype}{size\_t}\ ncpus\ =\ 0,\ nvirtcoresperphys\ =\ 0;}
\DoxyCodeLine{00584\ \ \ \textcolor{keywordtype}{size\_t}\ len\ =\ \textcolor{keyword}{sizeof}(size\_t);}
\DoxyCodeLine{00585\ \ \ \textcolor{keywordflow}{if}\ (sysctlbyname(\textcolor{stringliteral}{"{}hw.ncpu"{}},\ \&ncpus,\ \&len,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ 0)\ ==\ -\/1)\ \textcolor{keywordflow}{return}\ 0ul;}
\DoxyCodeLine{00586\ \ \ \textcolor{keywordflow}{if}\ (sysctlbyname(\textcolor{stringliteral}{"{}hw.cpu\_topology\_ht\_ids"{}},\ \&nvirtcoresperphys,\ \&len,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ 0)\ ==\ -\/1)\ \textcolor{keywordflow}{return}\ 0ul;}
\DoxyCodeLine{00587\ \ \ \textcolor{keywordflow}{return}\ nvirtcoresperphys\ *\ ncpus;}
\DoxyCodeLine{00588\ \}}
\DoxyCodeLine{00589\ }
\DoxyCodeLine{00590\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00591\ }
\DoxyCodeLine{00592\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{emscripten_2prim_8c_a933262d22f5d4ebb70599b45c3104236}{\_mi\_prim\_numa\_node}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00593\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00594\ \}}
\DoxyCodeLine{00595\ }
\DoxyCodeLine{00596\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{emscripten_2prim_8c_a82cc1dc0b2e542453248153dfbff0ef1}{\_mi\_prim\_numa\_node\_count}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00597\ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00598\ \}}
\DoxyCodeLine{00599\ }
\DoxyCodeLine{00600\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00601\ }
\DoxyCodeLine{00602\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00603\ \textcolor{comment}{//\ Clock}}
\DoxyCodeLine{00604\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00605\ }
\DoxyCodeLine{00606\ \textcolor{preprocessor}{\#include\ <time.h>}}
\DoxyCodeLine{00607\ }
\DoxyCodeLine{00608\ \textcolor{preprocessor}{\#if\ defined(CLOCK\_REALTIME)\ ||\ defined(CLOCK\_MONOTONIC)}}
\DoxyCodeLine{00609\ }
\DoxyCodeLine{00610\ \mbox{\hyperlink{types_8h_af67e75b6480efa6e87b2a3a118e58031}{mi\_msecs\_t}}\ \mbox{\hyperlink{emscripten_2prim_8c_a9a1effe54aac3a8c248f0eceea1d5b63}{\_mi\_prim\_clock\_now}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00611\ \ \ \textcolor{keyword}{struct\ }timespec\ \mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}};}
\DoxyCodeLine{00612\ \textcolor{preprocessor}{\ \ \#ifdef\ CLOCK\_MONOTONIC}}
\DoxyCodeLine{00613\ \ \ clock\_gettime(CLOCK\_MONOTONIC,\ \&\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}});}
\DoxyCodeLine{00614\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00615\ \ \ clock\_gettime(CLOCK\_REALTIME,\ \&\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}});}
\DoxyCodeLine{00616\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00617\ \ \ \textcolor{keywordflow}{return}\ ((\mbox{\hyperlink{types_8h_af67e75b6480efa6e87b2a3a118e58031}{mi\_msecs\_t}})\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}.tv\_sec\ *\ 1000)\ +\ ((\mbox{\hyperlink{types_8h_af67e75b6480efa6e87b2a3a118e58031}{mi\_msecs\_t}})\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}}.tv\_nsec\ /\ 1000000);}
\DoxyCodeLine{00618\ \}}
\DoxyCodeLine{00619\ }
\DoxyCodeLine{00620\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00621\ }
\DoxyCodeLine{00622\ \textcolor{comment}{//\ low\ resolution\ timer}}
\DoxyCodeLine{00623\ \mbox{\hyperlink{types_8h_af67e75b6480efa6e87b2a3a118e58031}{mi\_msecs\_t}}\ \mbox{\hyperlink{emscripten_2prim_8c_a9a1effe54aac3a8c248f0eceea1d5b63}{\_mi\_prim\_clock\_now}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00624\ \textcolor{preprocessor}{\ \ \#if\ !defined(CLOCKS\_PER\_SEC)\ ||\ (CLOCKS\_PER\_SEC\ ==\ 1000)\ ||\ (CLOCKS\_PER\_SEC\ ==\ 0)}}
\DoxyCodeLine{00625\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{types_8h_af67e75b6480efa6e87b2a3a118e58031}{mi\_msecs\_t}})clock();}
\DoxyCodeLine{00626\ \textcolor{preprocessor}{\ \ \#elif\ (CLOCKS\_PER\_SEC\ <\ 1000)}}
\DoxyCodeLine{00627\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{types_8h_af67e75b6480efa6e87b2a3a118e58031}{mi\_msecs\_t}})clock()\ *\ (1000\ /\ (\mbox{\hyperlink{types_8h_af67e75b6480efa6e87b2a3a118e58031}{mi\_msecs\_t}})CLOCKS\_PER\_SEC);}
\DoxyCodeLine{00628\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00629\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{types_8h_af67e75b6480efa6e87b2a3a118e58031}{mi\_msecs\_t}})clock()\ /\ ((\mbox{\hyperlink{types_8h_af67e75b6480efa6e87b2a3a118e58031}{mi\_msecs\_t}})CLOCKS\_PER\_SEC\ /\ 1000);}
\DoxyCodeLine{00630\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00631\ \}}
\DoxyCodeLine{00632\ }
\DoxyCodeLine{00633\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00634\ }
\DoxyCodeLine{00635\ }
\DoxyCodeLine{00636\ }
\DoxyCodeLine{00637\ }
\DoxyCodeLine{00638\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00639\ \textcolor{comment}{//\ Process\ info}}
\DoxyCodeLine{00640\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00641\ }
\DoxyCodeLine{00642\ \textcolor{preprocessor}{\#if\ defined(\_\_unix\_\_)\ ||\ defined(\_\_unix)\ ||\ defined(unix)\ ||\ defined(\_\_APPLE\_\_)\ ||\ defined(\_\_HAIKU\_\_)}}
\DoxyCodeLine{00643\ \textcolor{preprocessor}{\#include\ <stdio.h>}}
\DoxyCodeLine{00644\ \textcolor{preprocessor}{\#include\ <unistd.h>}}
\DoxyCodeLine{00645\ \textcolor{preprocessor}{\#include\ <sys/resource.h>}}
\DoxyCodeLine{00646\ }
\DoxyCodeLine{00647\ \textcolor{preprocessor}{\#if\ defined(\_\_APPLE\_\_)}}
\DoxyCodeLine{00648\ \textcolor{preprocessor}{\#include\ <mach/mach.h>}}
\DoxyCodeLine{00649\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00650\ }
\DoxyCodeLine{00651\ \textcolor{preprocessor}{\#if\ defined(\_\_HAIKU\_\_)}}
\DoxyCodeLine{00652\ \textcolor{preprocessor}{\#include\ <kernel/OS.h>}}
\DoxyCodeLine{00653\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00654\ }
\DoxyCodeLine{00655\ \textcolor{keyword}{static}\ \mbox{\hyperlink{types_8h_af67e75b6480efa6e87b2a3a118e58031}{mi\_msecs\_t}}\ timeval\_secs(\textcolor{keyword}{const}\ \textcolor{keyword}{struct}\ timeval*\ tv)\ \{}
\DoxyCodeLine{00656\ \ \ \textcolor{keywordflow}{return}\ ((\mbox{\hyperlink{types_8h_af67e75b6480efa6e87b2a3a118e58031}{mi\_msecs\_t}})tv-\/>tv\_sec\ *\ 1000L)\ +\ ((\mbox{\hyperlink{types_8h_af67e75b6480efa6e87b2a3a118e58031}{mi\_msecs\_t}})tv-\/>tv\_usec\ /\ 1000L);}
\DoxyCodeLine{00657\ \}}
\DoxyCodeLine{00658\ }
\DoxyCodeLine{00659\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{emscripten_2prim_8c_ad65bd45985b81b70a9c95edc22b81edc}{\_mi\_prim\_process\_info}}(\mbox{\hyperlink{prim_8h_acb020c93049ef91e7a72c527e0082f74}{mi\_process\_info\_t}}*\ pinfo)}
\DoxyCodeLine{00660\ \{}
\DoxyCodeLine{00661\ \ \ \textcolor{keyword}{struct\ }rusage\ rusage;}
\DoxyCodeLine{00662\ \ \ getrusage(RUSAGE\_SELF,\ \&rusage);}
\DoxyCodeLine{00663\ \ \ pinfo-\/>\mbox{\hyperlink{structmi__process__info__s_a4abf4b4fb5a8261ce501f3966c349c84}{utime}}\ =\ timeval\_secs(\&rusage.ru\_utime);}
\DoxyCodeLine{00664\ \ \ pinfo-\/>\mbox{\hyperlink{structmi__process__info__s_a6b808da77c194dc969013143f659d8ce}{stime}}\ =\ timeval\_secs(\&rusage.ru\_stime);}
\DoxyCodeLine{00665\ \textcolor{preprocessor}{\#if\ !defined(\_\_HAIKU\_\_)}}
\DoxyCodeLine{00666\ \ \ pinfo-\/>\mbox{\hyperlink{structmi__process__info__s_ab88976f8e5949694860a902f220c856f}{page\_faults}}\ =\ rusage.ru\_majflt;}
\DoxyCodeLine{00667\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00668\ \textcolor{preprocessor}{\#if\ defined(\_\_HAIKU\_\_)}}
\DoxyCodeLine{00669\ \ \ \textcolor{comment}{//\ Haiku\ does\ not\ have\ (yet?)\ a\ way\ to}}
\DoxyCodeLine{00670\ \ \ \textcolor{comment}{//\ get\ these\ stats\ per\ process}}
\DoxyCodeLine{00671\ \ \ thread\_info\ tid;}
\DoxyCodeLine{00672\ \ \ area\_info\ mem;}
\DoxyCodeLine{00673\ \ \ \mbox{\hyperlink{eabase_8h_a831c6b6852c6d34448e30a88c34539fd}{ssize\_t}}\ c;}
\DoxyCodeLine{00674\ \ \ get\_thread\_info(find\_thread(0),\ \&tid);}
\DoxyCodeLine{00675\ \ \ \textcolor{keywordflow}{while}\ (get\_next\_area\_info(tid.team,\ \&c,\ \&mem)\ ==\ B\_OK)\ \{}
\DoxyCodeLine{00676\ \ \ \ \ pinfo-\/>\mbox{\hyperlink{structmi__process__info__s_a075be43615ff32dae94c9fda7e0219a6}{peak\_rss}}\ +=\ mem.ram\_size;}
\DoxyCodeLine{00677\ \ \ \}}
\DoxyCodeLine{00678\ \ \ pinfo-\/>\mbox{\hyperlink{structmi__process__info__s_ab88976f8e5949694860a902f220c856f}{page\_faults}}\ =\ 0;}
\DoxyCodeLine{00679\ \textcolor{preprocessor}{\#elif\ defined(\_\_APPLE\_\_)}}
\DoxyCodeLine{00680\ \ \ pinfo-\/>\mbox{\hyperlink{structmi__process__info__s_a075be43615ff32dae94c9fda7e0219a6}{peak\_rss}}\ =\ rusage.ru\_maxrss;\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ macos\ reports\ in\ bytes}}
\DoxyCodeLine{00681\ \textcolor{preprocessor}{\ \ \#ifdef\ MACH\_TASK\_BASIC\_INFO}}
\DoxyCodeLine{00682\ \ \ \textcolor{keyword}{struct\ }mach\_task\_basic\_info\ \mbox{\hyperlink{namespacespdlog_1_1level_a335eabf5eff13482903eb26be08f3861a7f09db55ad64d87e4124f10582cb016f}{info}};}
\DoxyCodeLine{00683\ \ \ mach\_msg\_type\_number\_t\ infoCount\ =\ MACH\_TASK\_BASIC\_INFO\_COUNT;}
\DoxyCodeLine{00684\ \ \ \textcolor{keywordflow}{if}\ (task\_info(mach\_task\_self(),\ MACH\_TASK\_BASIC\_INFO,\ (task\_info\_t)\&info,\ \&infoCount)\ ==\ KERN\_SUCCESS)\ \{}
\DoxyCodeLine{00685\ \ \ \ \ pinfo-\/>\mbox{\hyperlink{structmi__process__info__s_a13d6fa31fe7212a83c02323efcf21138}{current\_rss}}\ =\ (size\_t)\mbox{\hyperlink{namespacespdlog_1_1level_a335eabf5eff13482903eb26be08f3861a7f09db55ad64d87e4124f10582cb016f}{info}}.resident\_size;}
\DoxyCodeLine{00686\ \ \ \}}
\DoxyCodeLine{00687\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00688\ \ \ \textcolor{keyword}{struct\ }task\_basic\_info\ \mbox{\hyperlink{namespacespdlog_1_1level_a335eabf5eff13482903eb26be08f3861a7f09db55ad64d87e4124f10582cb016f}{info}};}
\DoxyCodeLine{00689\ \ \ mach\_msg\_type\_number\_t\ infoCount\ =\ TASK\_BASIC\_INFO\_COUNT;}
\DoxyCodeLine{00690\ \ \ \textcolor{keywordflow}{if}\ (task\_info(mach\_task\_self(),\ TASK\_BASIC\_INFO,\ (task\_info\_t)\&info,\ \&infoCount)\ ==\ KERN\_SUCCESS)\ \{}
\DoxyCodeLine{00691\ \ \ \ \ pinfo-\/>\mbox{\hyperlink{structmi__process__info__s_a13d6fa31fe7212a83c02323efcf21138}{current\_rss}}\ =\ (size\_t)\mbox{\hyperlink{namespacespdlog_1_1level_a335eabf5eff13482903eb26be08f3861a7f09db55ad64d87e4124f10582cb016f}{info}}.resident\_size;}
\DoxyCodeLine{00692\ \ \ \}}
\DoxyCodeLine{00693\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00694\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00695\ \ \ pinfo-\/>\mbox{\hyperlink{structmi__process__info__s_a075be43615ff32dae94c9fda7e0219a6}{peak\_rss}}\ =\ rusage.ru\_maxrss\ *\ 1024;\ \ \textcolor{comment}{//\ Linux/BSD\ report\ in\ KiB}}
\DoxyCodeLine{00696\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00697\ \ \ \textcolor{comment}{//\ use\ defaults\ for\ commit}}
\DoxyCodeLine{00698\ \}}
\DoxyCodeLine{00699\ }
\DoxyCodeLine{00700\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00701\ }
\DoxyCodeLine{00702\ \textcolor{preprocessor}{\#ifndef\ \_\_wasi\_\_}}
\DoxyCodeLine{00703\ \textcolor{comment}{//\ WebAssembly\ instances\ are\ not\ processes}}
\DoxyCodeLine{00704\ \textcolor{preprocessor}{\#pragma\ message("{}define\ a\ way\ to\ get\ process\ info"{})}}
\DoxyCodeLine{00705\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00706\ }
\DoxyCodeLine{00707\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{emscripten_2prim_8c_ad65bd45985b81b70a9c95edc22b81edc}{\_mi\_prim\_process\_info}}(\mbox{\hyperlink{prim_8h_acb020c93049ef91e7a72c527e0082f74}{mi\_process\_info\_t}}*\ pinfo)}
\DoxyCodeLine{00708\ \{}
\DoxyCodeLine{00709\ \ \ \textcolor{comment}{//\ use\ defaults}}
\DoxyCodeLine{00710\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(pinfo);}
\DoxyCodeLine{00711\ \}}
\DoxyCodeLine{00712\ }
\DoxyCodeLine{00713\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00714\ }
\DoxyCodeLine{00715\ }
\DoxyCodeLine{00716\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00717\ \textcolor{comment}{//\ Output}}
\DoxyCodeLine{00718\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00719\ }
\DoxyCodeLine{00720\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{emscripten_2prim_8c_a93a12757acc4f401fd4619057fdd209f}{\_mi\_prim\_out\_stderr}}(\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ msg\ )\ \{}
\DoxyCodeLine{00721\ \ \ fputs(msg,stderr);}
\DoxyCodeLine{00722\ \}}
\DoxyCodeLine{00723\ }
\DoxyCodeLine{00724\ }
\DoxyCodeLine{00725\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00726\ \textcolor{comment}{//\ Environment}}
\DoxyCodeLine{00727\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00728\ }
\DoxyCodeLine{00729\ \textcolor{preprocessor}{\#if\ !defined(MI\_USE\_ENVIRON)\ ||\ (MI\_USE\_ENVIRON!=0)}}
\DoxyCodeLine{00730\ \textcolor{comment}{//\ On\ Posix\ systemsr\ use\ \`{}environ`\ to\ access\ environment\ variables}}
\DoxyCodeLine{00731\ \textcolor{comment}{//\ even\ before\ the\ C\ runtime\ is\ initialized.}}
\DoxyCodeLine{00732\ \textcolor{preprocessor}{\#if\ defined(\_\_APPLE\_\_)\ \&\&\ defined(\_\_has\_include)\ \&\&\ \_\_has\_include(<crt\_externs.h>)}}
\DoxyCodeLine{00733\ \textcolor{preprocessor}{\#include\ <crt\_externs.h>}}
\DoxyCodeLine{00734\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{char}**\ \mbox{\hyperlink{unix_2prim_8c_a11e720e003c887e5028665097ce7735f}{mi\_get\_environ}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00735\ \ \ \textcolor{keywordflow}{return}\ (*\_NSGetEnviron());}
\DoxyCodeLine{00736\ \}}
\DoxyCodeLine{00737\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00738\ \textcolor{keyword}{extern}\ \textcolor{keywordtype}{char}**\ \mbox{\hyperlink{unix_2prim_8c_aa006daaf11f1e2e45a6ababaf463212b}{environ}};}
\DoxyCodeLine{00739\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{char}**\ \mbox{\hyperlink{unix_2prim_8c_a11e720e003c887e5028665097ce7735f}{mi\_get\_environ}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00740\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{unix_2prim_8c_aa006daaf11f1e2e45a6ababaf463212b}{environ}};}
\DoxyCodeLine{00741\ \}}
\DoxyCodeLine{00742\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00743\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{emscripten_2prim_8c_a83ac99612f318532560ffc033ee18d59}{\_mi\_prim\_getenv}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a5c4947d4516dd7cfa3505ce3a648a4ef}{name}},\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}},\ \textcolor{keywordtype}{size\_t}\ result\_size)\ \{}
\DoxyCodeLine{00744\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a5c4947d4516dd7cfa3505ce3a648a4ef}{name}}==\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00745\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ len\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a70fc9bbb723b024221706d118be42bfc}{\_mi\_strlen}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a5c4947d4516dd7cfa3505ce3a648a4ef}{name}});}
\DoxyCodeLine{00746\ \ \ \textcolor{keywordflow}{if}\ (len\ ==\ 0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00747\ \ \ \textcolor{keywordtype}{char}**\ env\ =\ \mbox{\hyperlink{unix_2prim_8c_a11e720e003c887e5028665097ce7735f}{mi\_get\_environ}}();}
\DoxyCodeLine{00748\ \ \ \textcolor{keywordflow}{if}\ (env\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00749\ \ \ \textcolor{comment}{//\ compare\ up\ to\ 10000\ entries}}
\DoxyCodeLine{00750\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 10000\ \&\&\ env[i]\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};\ i++)\ \{}
\DoxyCodeLine{00751\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ =\ env[i];}
\DoxyCodeLine{00752\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a0263a76ab329c76a3e9dd758126389d5}{\_mi\_strnicmp}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a5c4947d4516dd7cfa3505ce3a648a4ef}{name}},\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}},\ len)\ ==\ 0\ \&\&\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}[len]\ ==\ \textcolor{charliteral}{'='})\ \{\ \textcolor{comment}{//\ case\ insensitive}}
\DoxyCodeLine{00753\ \ \ \ \ \ \ \textcolor{comment}{//\ found\ it}}
\DoxyCodeLine{00754\ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a17a9534829be8a086014bf2a2792154f}{\_mi\_strlcpy}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}},\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ +\ len\ +\ 1,\ result\_size);}
\DoxyCodeLine{00755\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00756\ \ \ \ \ \}}
\DoxyCodeLine{00757\ \ \ \}}
\DoxyCodeLine{00758\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00759\ \}}
\DoxyCodeLine{00760\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00761\ \textcolor{comment}{//\ fallback:\ use\ standard\ C\ \`{}getenv`\ but\ this\ cannot\ be\ used\ while\ initializing\ the\ C\ runtime}}
\DoxyCodeLine{00762\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{emscripten_2prim_8c_a83ac99612f318532560ffc033ee18d59}{\_mi\_prim\_getenv}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a5c4947d4516dd7cfa3505ce3a648a4ef}{name}},\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}},\ \textcolor{keywordtype}{size\_t}\ result\_size)\ \{}
\DoxyCodeLine{00763\ \ \ \textcolor{comment}{//\ cannot\ call\ getenv()\ when\ still\ initializing\ the\ C\ runtime.}}
\DoxyCodeLine{00764\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_abe10bbb84d6109e4b0a5fcc92cb0cb0e}{\_mi\_preloading}}())\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00765\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ =\ \mbox{\hyperlink{namespacespdlog_1_1details_1_1os_a92fad51c7be81e35538b9bb540b4f85a}{getenv}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a5c4947d4516dd7cfa3505ce3a648a4ef}{name}});}
\DoxyCodeLine{00766\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00767\ \ \ \ \ \textcolor{comment}{//\ we\ check\ the\ upper\ case\ name\ too.}}
\DoxyCodeLine{00768\ \ \ \ \ \textcolor{keywordtype}{char}\ buf[64+1];}
\DoxyCodeLine{00769\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ len\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ae8577fe0d9bbe3fb90d2169caa1af943}{\_mi\_strnlen}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a5c4947d4516dd7cfa3505ce3a648a4ef}{name}},\textcolor{keyword}{sizeof}(buf)-\/1);}
\DoxyCodeLine{00770\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ len;\ i++)\ \{}
\DoxyCodeLine{00771\ \ \ \ \ \ \ buf[i]\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a0d811385427149f1ea8637c8fab1fd07}{\_mi\_toupper}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a5c4947d4516dd7cfa3505ce3a648a4ef}{name}}[i]);}
\DoxyCodeLine{00772\ \ \ \ \ \}}
\DoxyCodeLine{00773\ \ \ \ \ buf[len]\ =\ 0;}
\DoxyCodeLine{00774\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ =\ \mbox{\hyperlink{namespacespdlog_1_1details_1_1os_a92fad51c7be81e35538b9bb540b4f85a}{getenv}}(buf);}
\DoxyCodeLine{00775\ \ \ \}}
\DoxyCodeLine{00776\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ ==\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ ||\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ae8577fe0d9bbe3fb90d2169caa1af943}{\_mi\_strnlen}}(\mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}},result\_size)\ >=\ result\_size)\ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00777\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a17a9534829be8a086014bf2a2792154f}{\_mi\_strlcpy}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa7f56a70231ed8bc64f97aa7c37fcb19}{result}},\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}},\ result\_size);}
\DoxyCodeLine{00778\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00779\ \}}
\DoxyCodeLine{00780\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ !MI\_USE\_ENVIRON}}
\DoxyCodeLine{00781\ }
\DoxyCodeLine{00782\ }
\DoxyCodeLine{00783\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00784\ \textcolor{comment}{//\ Random}}
\DoxyCodeLine{00785\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00786\ }
\DoxyCodeLine{00787\ \textcolor{preprocessor}{\#if\ defined(\_\_APPLE\_\_)\ \&\&\ defined(MAC\_OS\_X\_VERSION\_10\_15)\ \&\&\ (MAC\_OS\_X\_VERSION\_MIN\_REQUIRED\ >=\ MAC\_OS\_X\_VERSION\_10\_15)}}
\DoxyCodeLine{00788\ \textcolor{preprocessor}{\#include\ <CommonCrypto/CommonCryptoError.h>}}
\DoxyCodeLine{00789\ \textcolor{preprocessor}{\#include\ <CommonCrypto/CommonRandom.h>}}
\DoxyCodeLine{00790\ }
\DoxyCodeLine{00791\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{emscripten_2prim_8c_a4d9172e2503d3616115ff0bc8a6a908d}{\_mi\_prim\_random\_buf}}(\textcolor{keywordtype}{void}*\ buf,\ \textcolor{keywordtype}{size\_t}\ buf\_len)\ \{}
\DoxyCodeLine{00792\ \ \ \textcolor{comment}{//\ We\ prefer\ CCRandomGenerateBytes\ as\ it\ returns\ an\ error\ code\ while\ arc4random\_buf}}
\DoxyCodeLine{00793\ \ \ \textcolor{comment}{//\ may\ fail\ silently\ on\ macOS.\ See\ PR\ \#390,\ and\ <https://opensource.apple.com/source/Libc/Libc-\/1439.40.11/gen/FreeBSD/arc4random.c.auto.html>}}
\DoxyCodeLine{00794\ \ \ \textcolor{keywordflow}{return}\ (CCRandomGenerateBytes(buf,\ buf\_len)\ ==\ kCCSuccess);}
\DoxyCodeLine{00795\ \}}
\DoxyCodeLine{00796\ }
\DoxyCodeLine{00797\ \textcolor{preprocessor}{\#elif\ defined(\_\_ANDROID\_\_)\ ||\ defined(\_\_DragonFly\_\_)\ ||\ \(\backslash\)}}
\DoxyCodeLine{00798\ \textcolor{preprocessor}{\ \ \ \ \ \ defined(\_\_FreeBSD\_\_)\ ||\ defined(\_\_NetBSD\_\_)\ ||\ defined(\_\_OpenBSD\_\_)\ ||\ \(\backslash\)}}
\DoxyCodeLine{00799\ \textcolor{preprocessor}{\ \ \ \ \ \ defined(\_\_sun)\ ||\ \(\backslash\)}}
\DoxyCodeLine{00800\ \textcolor{preprocessor}{\ \ \ \ \ \ (defined(\_\_APPLE\_\_)\ \&\&\ (MAC\_OS\_X\_VERSION\_MIN\_REQUIRED\ >=\ MAC\_OS\_X\_VERSION\_10\_7))}}
\DoxyCodeLine{00801\ }
\DoxyCodeLine{00802\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{emscripten_2prim_8c_a4d9172e2503d3616115ff0bc8a6a908d}{\_mi\_prim\_random\_buf}}(\textcolor{keywordtype}{void}*\ buf,\ \textcolor{keywordtype}{size\_t}\ buf\_len)\ \{}
\DoxyCodeLine{00803\ \ \ arc4random\_buf(buf,\ buf\_len);}
\DoxyCodeLine{00804\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00805\ \}}
\DoxyCodeLine{00806\ }
\DoxyCodeLine{00807\ \textcolor{preprocessor}{\#elif\ defined(\_\_APPLE\_\_)\ ||\ defined(\_\_linux\_\_)\ ||\ defined(\_\_HAIKU\_\_)\ \ \ }\textcolor{comment}{//\ also\ for\ old\ apple\ versions\ <\ 10.7\ (issue\ \#829)}}
\DoxyCodeLine{00808\ }
\DoxyCodeLine{00809\ \textcolor{preprocessor}{\#include\ <sys/types.h>}}
\DoxyCodeLine{00810\ \textcolor{preprocessor}{\#include\ <sys/stat.h>}}
\DoxyCodeLine{00811\ \textcolor{preprocessor}{\#include\ <errno.h>}}
\DoxyCodeLine{00812\ }
\DoxyCodeLine{00813\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{emscripten_2prim_8c_a4d9172e2503d3616115ff0bc8a6a908d}{\_mi\_prim\_random\_buf}}(\textcolor{keywordtype}{void}*\ buf,\ \textcolor{keywordtype}{size\_t}\ buf\_len)\ \{}
\DoxyCodeLine{00814\ \ \ \textcolor{comment}{//\ Modern\ Linux\ provides\ \`{}getrandom`\ but\ different\ distributions\ either\ use\ \`{}sys/random.h`\ or\ \`{}linux/random.h`}}
\DoxyCodeLine{00815\ \ \ \textcolor{comment}{//\ and\ for\ the\ latter\ the\ actual\ \`{}getrandom`\ call\ is\ not\ always\ defined.}}
\DoxyCodeLine{00816\ \ \ \textcolor{comment}{//\ (see\ <https://stackoverflow.com/questions/45237324/why-\/doesnt-\/getrandom-\/compile>)}}
\DoxyCodeLine{00817\ \ \ \textcolor{comment}{//\ We\ therefore\ use\ a\ syscall\ directly\ and\ fall\ back\ dynamically\ to\ /dev/urandom\ when\ needed.}}
\DoxyCodeLine{00818\ \textcolor{preprocessor}{\ \ \#if\ defined(MI\_HAS\_SYSCALL\_H)\ \&\&\ defined(SYS\_getrandom)}}
\DoxyCodeLine{00819\ \textcolor{preprocessor}{\ \ \ \ \#ifndef\ GRND\_NONBLOCK}}
\DoxyCodeLine{00820\ \textcolor{preprocessor}{\ \ \ \ \#define\ GRND\_NONBLOCK\ (1)}}
\DoxyCodeLine{00821\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{00822\ \ \ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(uintptr\_t)\ no\_getrandom;\ \textcolor{comment}{//\ =\ 0}}
\DoxyCodeLine{00823\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_afd6e6e0fbd3a1be232115b5617ca2f65}{mi\_atomic\_load\_acquire}}(\&no\_getrandom)==0)\ \{}
\DoxyCodeLine{00824\ \ \ \ \ \ \ \mbox{\hyperlink{eabase_8h_a831c6b6852c6d34448e30a88c34539fd}{ssize\_t}}\ ret\ =\ syscall(SYS\_getrandom,\ buf,\ buf\_len,\ GRND\_NONBLOCK);}
\DoxyCodeLine{00825\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ret\ >=\ 0)\ \textcolor{keywordflow}{return}\ (buf\_len\ ==\ (\textcolor{keywordtype}{size\_t})ret);}
\DoxyCodeLine{00826\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (errno\ !=\ ENOSYS)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00827\ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a1ee5baaa0004b9c737a03d48d77a0194}{mi\_atomic\_store\_release}}(\&no\_getrandom,\ (uintptr\_t)1);\ \textcolor{comment}{//\ don't\ call\ again,\ and\ fall\ back\ to\ /dev/urandom}}
\DoxyCodeLine{00828\ \ \ \ \ \}}
\DoxyCodeLine{00829\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00830\ \ \ \textcolor{keywordtype}{int}\ flags\ =\ O\_RDONLY;}
\DoxyCodeLine{00831\ \textcolor{preprocessor}{\ \ \#if\ defined(O\_CLOEXEC)}}
\DoxyCodeLine{00832\ \ \ flags\ |=\ O\_CLOEXEC;}
\DoxyCodeLine{00833\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00834\ \ \ \textcolor{keywordtype}{int}\ fd\ =\ \mbox{\hyperlink{unix_2prim_8c_a0860bd7d20380405ebe50dc48e9996e4}{mi\_prim\_open}}(\textcolor{stringliteral}{"{}/dev/urandom"{}},\ flags);}
\DoxyCodeLine{00835\ \ \ \textcolor{keywordflow}{if}\ (fd\ <\ 0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00836\ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a619bc20e8198de3bd3f3d7fc34de66b2}{count}}\ =\ 0;}
\DoxyCodeLine{00837\ \ \ \textcolor{keywordflow}{while}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a619bc20e8198de3bd3f3d7fc34de66b2}{count}}\ <\ buf\_len)\ \{}
\DoxyCodeLine{00838\ \ \ \ \ \mbox{\hyperlink{eabase_8h_a831c6b6852c6d34448e30a88c34539fd}{ssize\_t}}\ ret\ =\ \mbox{\hyperlink{unix_2prim_8c_ae77fe82ffa9c3ceedea9d71d1a62438b}{mi\_prim\_read}}(fd,\ (\textcolor{keywordtype}{char}*)buf\ +\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a619bc20e8198de3bd3f3d7fc34de66b2}{count}},\ buf\_len\ -\/\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a619bc20e8198de3bd3f3d7fc34de66b2}{count}});}
\DoxyCodeLine{00839\ \ \ \ \ \textcolor{keywordflow}{if}\ (ret<=0)\ \{}
\DoxyCodeLine{00840\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (errno!=\mbox{\hyperlink{types_8h_af0fac1cea1165b4debec7f686edf3313}{EAGAIN}}\ \&\&\ errno!=EINTR)\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00841\ \ \ \ \ \}}
\DoxyCodeLine{00842\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00843\ \ \ \ \ \ \ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a619bc20e8198de3bd3f3d7fc34de66b2}{count}}\ +=\ ret;}
\DoxyCodeLine{00844\ \ \ \ \ \}}
\DoxyCodeLine{00845\ \ \ \}}
\DoxyCodeLine{00846\ \ \ \mbox{\hyperlink{unix_2prim_8c_a1bf67c8e43c8df4cefd984bee41c81a9}{mi\_prim\_close}}(fd);}
\DoxyCodeLine{00847\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a619bc20e8198de3bd3f3d7fc34de66b2}{count}}==buf\_len);}
\DoxyCodeLine{00848\ \}}
\DoxyCodeLine{00849\ }
\DoxyCodeLine{00850\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00851\ }
\DoxyCodeLine{00852\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{emscripten_2prim_8c_a4d9172e2503d3616115ff0bc8a6a908d}{\_mi\_prim\_random\_buf}}(\textcolor{keywordtype}{void}*\ buf,\ \textcolor{keywordtype}{size\_t}\ buf\_len)\ \{}
\DoxyCodeLine{00853\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00854\ \}}
\DoxyCodeLine{00855\ }
\DoxyCodeLine{00856\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00857\ }
\DoxyCodeLine{00858\ }
\DoxyCodeLine{00859\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00860\ \textcolor{comment}{//\ Thread\ init/done}}
\DoxyCodeLine{00861\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00862\ }
\DoxyCodeLine{00863\ \textcolor{preprocessor}{\#if\ defined(MI\_USE\_PTHREADS)}}
\DoxyCodeLine{00864\ }
\DoxyCodeLine{00865\ \textcolor{comment}{//\ use\ pthread\ local\ storage\ keys\ to\ detect\ thread\ ending}}
\DoxyCodeLine{00866\ \textcolor{comment}{//\ (and\ used\ with\ MI\_TLS\_PTHREADS\ for\ the\ default\ heap)}}
\DoxyCodeLine{00867\ pthread\_key\_t\ \_mi\_heap\_default\_key\ =\ (pthread\_key\_t)(-\/1);}
\DoxyCodeLine{00868\ }
\DoxyCodeLine{00869\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ mi\_pthread\_done(\textcolor{keywordtype}{void}*\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a1b2be7bfa84f129a2690a62f3ad82d62}{value}})\ \{}
\DoxyCodeLine{00870\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a1b2be7bfa84f129a2690a62f3ad82d62}{value}}!=\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00871\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_af603ae2ea01234391a55cf27457ae925}{\_mi\_thread\_done}}((\mbox{\hyperlink{group__heap_ga34a47cde5a5b38c29f1aa3c5e76943c2}{mi\_heap\_t}}*)\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a1b2be7bfa84f129a2690a62f3ad82d62}{value}});}
\DoxyCodeLine{00872\ \ \ \}}
\DoxyCodeLine{00873\ \}}
\DoxyCodeLine{00874\ }
\DoxyCodeLine{00875\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{emscripten_2prim_8c_a2017bda86f22f7ce43e72fed224bb030}{\_mi\_prim\_thread\_init\_auto\_done}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00876\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\_mi\_heap\_default\_key\ ==\ (pthread\_key\_t)(-\/1));}
\DoxyCodeLine{00877\ \ \ pthread\_key\_create(\&\_mi\_heap\_default\_key,\ \&mi\_pthread\_done);}
\DoxyCodeLine{00878\ \}}
\DoxyCodeLine{00879\ }
\DoxyCodeLine{00880\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{emscripten_2prim_8c_a46efc702aefc032dfa0abf324d30cfd8}{\_mi\_prim\_thread\_done\_auto\_done}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00881\ \ \ \textcolor{keywordflow}{if}\ (\_mi\_heap\_default\_key\ !=\ (pthread\_key\_t)(-\/1))\ \{\ \ \textcolor{comment}{//\ do\ not\ leak\ the\ key,\ see\ issue\ \#809}}
\DoxyCodeLine{00882\ \ \ \ \ pthread\_key\_delete(\_mi\_heap\_default\_key);}
\DoxyCodeLine{00883\ \ \ \}}
\DoxyCodeLine{00884\ \}}
\DoxyCodeLine{00885\ }
\DoxyCodeLine{00886\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{emscripten_2prim_8c_a14b6be498e17cdf74c6b5cb38c2ec306}{\_mi\_prim\_thread\_associate\_default\_heap}}(\mbox{\hyperlink{group__heap_ga34a47cde5a5b38c29f1aa3c5e76943c2}{mi\_heap\_t}}*\ heap)\ \{}
\DoxyCodeLine{00887\ \ \ \textcolor{keywordflow}{if}\ (\_mi\_heap\_default\_key\ !=\ (pthread\_key\_t)(-\/1))\ \{\ \ \textcolor{comment}{//\ can\ happen\ during\ recursive\ invocation\ on\ freeBSD}}
\DoxyCodeLine{00888\ \ \ \ \ pthread\_setspecific(\_mi\_heap\_default\_key,\ heap);}
\DoxyCodeLine{00889\ \ \ \}}
\DoxyCodeLine{00890\ \}}
\DoxyCodeLine{00891\ }
\DoxyCodeLine{00892\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00893\ }
\DoxyCodeLine{00894\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{emscripten_2prim_8c_a2017bda86f22f7ce43e72fed224bb030}{\_mi\_prim\_thread\_init\_auto\_done}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00895\ \ \ \textcolor{comment}{//\ nothing}}
\DoxyCodeLine{00896\ \}}
\DoxyCodeLine{00897\ }
\DoxyCodeLine{00898\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{emscripten_2prim_8c_a46efc702aefc032dfa0abf324d30cfd8}{\_mi\_prim\_thread\_done\_auto\_done}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00899\ \ \ \textcolor{comment}{//\ nothing}}
\DoxyCodeLine{00900\ \}}
\DoxyCodeLine{00901\ }
\DoxyCodeLine{00902\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{emscripten_2prim_8c_a14b6be498e17cdf74c6b5cb38c2ec306}{\_mi\_prim\_thread\_associate\_default\_heap}}(\mbox{\hyperlink{group__heap_ga34a47cde5a5b38c29f1aa3c5e76943c2}{mi\_heap\_t}}*\ heap)\ \{}
\DoxyCodeLine{00903\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(heap);}
\DoxyCodeLine{00904\ \}}
\DoxyCodeLine{00905\ }
\DoxyCodeLine{00906\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00907\ }
\DoxyCodeLine{00908\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{emscripten_2prim_8c_aeb1429fbac0d95c6d38a018007360ba4}{\_mi\_prim\_thread\_is\_in\_threadpool}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00909\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00910\ \}}

\end{DoxyCode}
