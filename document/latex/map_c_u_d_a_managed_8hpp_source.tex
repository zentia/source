\doxysection{map\+CUDAManaged.\+hpp}
\hypertarget{map_c_u_d_a_managed_8hpp_source}{}\label{map_c_u_d_a_managed_8hpp_source}\index{external/taskflow/3rd-\/party/ff/mapCUDAManaged.hpp@{external/taskflow/3rd-\/party/ff/mapCUDAManaged.hpp}}
\mbox{\hyperlink{map_c_u_d_a_managed_8hpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*\ -\/*-\/\ Mode:\ C++;\ tab-\/width:\ 4;\ c-\/basic-\/offset:\ 4;\ indent-\/tabs-\/mode:\ nil\ -\/*-\/\ */}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#ifndef\ \_FF\_MAPCUDAMANAGED\_HPP\_}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#define\ \_FF\_MAPCUDAMANAGED\_HPP\_}}
\DoxyCodeLine{00016\ \textcolor{comment}{/*\ ***************************************************************************}}
\DoxyCodeLine{00017\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00018\ \textcolor{comment}{\ *\ \ FastFlow\ is\ free\ software;\ you\ can\ redistribute\ it\ and/or\ modify\ it}}
\DoxyCodeLine{00019\ \textcolor{comment}{\ *\ \ under\ the\ terms\ of\ the\ GNU\ Lesser\ General\ Public\ License\ version\ 3\ as}}
\DoxyCodeLine{00020\ \textcolor{comment}{\ *\ \ published\ by\ the\ Free\ Software\ Foundation.}}
\DoxyCodeLine{00021\ \textcolor{comment}{\ *\ \ Starting\ from\ version\ 3.0.1\ FastFlow\ is\ dual\ licensed\ under\ the\ GNU\ LGPLv3}}
\DoxyCodeLine{00022\ \textcolor{comment}{\ *\ \ or\ MIT\ License\ (https://github.com/ParaGroup/WindFlow/blob/vers3.x/LICENSE.MIT)}}
\DoxyCodeLine{00023\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00024\ \textcolor{comment}{\ *\ \ This\ program\ is\ distributed\ in\ the\ hope\ that\ it\ will\ be\ useful,\ but\ WITHOUT}}
\DoxyCodeLine{00025\ \textcolor{comment}{\ *\ \ ANY\ WARRANTY;\ without\ even\ the\ implied\ warranty\ of\ MERCHANTABILITY\ or}}
\DoxyCodeLine{00026\ \textcolor{comment}{\ *\ \ FITNESS\ FOR\ A\ PARTICULAR\ PURPOSE.\ \ See\ the\ GNU\ Lesser\ General\ Public}}
\DoxyCodeLine{00027\ \textcolor{comment}{\ *\ \ License\ for\ more\ details.}}
\DoxyCodeLine{00028\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00029\ \textcolor{comment}{\ *\ \ You\ should\ have\ received\ a\ copy\ of\ the\ GNU\ Lesser\ General\ Public\ License}}
\DoxyCodeLine{00030\ \textcolor{comment}{\ *\ \ along\ with\ this\ program;\ if\ not,\ write\ to\ the\ Free\ Software\ Foundation,}}
\DoxyCodeLine{00031\ \textcolor{comment}{\ *\ \ Inc.,\ 59\ Temple\ Place\ -\/\ Suite\ 330,\ Boston,\ MA\ 02111-\/1307,\ USA.}}
\DoxyCodeLine{00032\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00033\ \textcolor{comment}{\ ****************************************************************************}}
\DoxyCodeLine{00034\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{map_8hpp}{ff/map.hpp}}>}}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceff}{ff}}\ \{}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00044\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classff_1_1ff__cuda__managed}{ff\_cuda\_managed}}\ \{}
\DoxyCodeLine{00045\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordtype}{void}\ *\textcolor{keyword}{operator}\ \textcolor{keyword}{new}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{yyjson_8h_ac16e956eac9f5c3180afa8e80d4f098c}{len}})\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}};}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ cudaMallocManaged(\&\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}},\ \mbox{\hyperlink{yyjson_8h_ac16e956eac9f5c3180afa8e80d4f098c}{len}});}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}};}
\DoxyCodeLine{00050\ \ \ \ \ \}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordtype}{void}\ \textcolor{keyword}{operator}\ \textcolor{keyword}{delete}(\textcolor{keywordtype}{void}\ *\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\ \{}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ cudaFree(\mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}});}
\DoxyCodeLine{00054\ \ \ \ \ \}}
\DoxyCodeLine{00055\ \};}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00060\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_a13884db79e721d818317ce47b3450b7e}{baseCUDATaskManaged}}\ \{}
\DoxyCodeLine{00061\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00062\ \ \ \ \ \mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_a13884db79e721d818317ce47b3450b7e}{baseCUDATaskManaged}}():\ \mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_af50df36bcc3baee0548fd0d13b5e47a1}{envPtr}}(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}),\ \mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_a97847c49bbde8d295d8b60846d202293}{inPtr}}(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}),\ \mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_ad5e942adcbaf4700f62177f7d7f343bc}{outPtr}}(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\};}
\DoxyCodeLine{00063\ \ \ \ \ \mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_a22f67ff58899ed058d277535c543b168}{baseCUDATaskManaged}}(\textcolor{keywordtype}{void}\ *\ env,\ \textcolor{keywordtype}{void}\ *\ in,\ \textcolor{keywordtype}{void}\ *\ out)\ :\ \mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_af50df36bcc3baee0548fd0d13b5e47a1}{envPtr}}(env),\ \mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_a97847c49bbde8d295d8b60846d202293}{inPtr}}(in),\ \mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_ad5e942adcbaf4700f62177f7d7f343bc}{outPtr}}(out)\ \{\}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{comment}{//user\ may\ override\ this\ code\ -\/\ BEGIN}}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_a3aae19a43300a549850d2cc6b659366c}{setTask}}(\textcolor{keywordtype}{void}\ *\ in)\ \{\ \textcolor{keywordflow}{if}\ (in)\ \mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_a97847c49bbde8d295d8b60846d202293}{inPtr}}=in;\}}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}*\ \ \mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_ae86cc8be5d46ed8d1d89ea2f895b20d7}{getEnvPtr}}()\ \ \ \ \ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_af50df36bcc3baee0548fd0d13b5e47a1}{envPtr}};\}}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}*\ \ \mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_ad92bc4a5c9030db362627d29f71da46b}{getInPtr}}()\ \ \ \ \ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_a97847c49bbde8d295d8b60846d202293}{inPtr}};\}}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{comment}{//\ by\ default\ the\ map\ works\ in-\/place}}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}*\ \ \mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_a9df7d47671b7311defd16b852e4da701}{newOutPtr}}()\ \ \ \ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_ad5e942adcbaf4700f62177f7d7f343bc}{outPtr}};\ \}}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \ \ \mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_a5ee10278dd0d8cfb9e7537b56155a263}{deleteOutPtr}}()\ \{\}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_a5771ba70c532ed067092a209788dcc61}{beforeMR}}()\ \{\}}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_a7c83f505f7adf436c599ea968c6ab85d}{afterMR}}()\ \{\}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{comment}{//user\ may\ override\ this\ code\ -\/\ END}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_af7b1995a3b70571c1c18f68d8ef07ab0}{\string~baseCUDATaskManaged}}()\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_af50df36bcc3baee0548fd0d13b5e47a1}{envPtr}};}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_a97847c49bbde8d295d8b60846d202293}{inPtr}};}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{classff_1_1base_c_u_d_a_task_managed_ad5e942adcbaf4700f62177f7d7f343bc}{outPtr}};}
\DoxyCodeLine{00086\ \};}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Tenv,\ \textcolor{keyword}{typename}\ Tinout,\ \textcolor{keyword}{typename}\ kernelF>}
\DoxyCodeLine{00089\ \_\_global\_\_\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespaceff_a71ca07da18f599be5a84a85f8bbc49a3}{mapCUDAKernelManaged}}(kernelF\ K,\ Tenv\ *\ env,\ Tinout\ *\ in,\ Tinout*\ out,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}})\ \{}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ \mbox{\hyperlink{cuda__common_8h_ab30e5f6958c9264d3c5235d463eb2b57}{blockIdx}}.x\ *\ \mbox{\hyperlink{cuda__common_8h_a1a2cdcc50d7e1505a058c5832ebe5702}{blockDim}}.x\ +\ \mbox{\hyperlink{cuda__common_8h_a0a680a9519f7aaccce02a4bb4c0a0b52}{threadIdx}}.x;}
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ gridSize\ =\ \mbox{\hyperlink{cuda__common_8h_a1a2cdcc50d7e1505a058c5832ebe5702}{blockDim}}.x*gridDim.x;}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}})}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ out[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]=\ K.K(env,\ in[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]);}
\DoxyCodeLine{00095\ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \textcolor{preprocessor}{\#define\ FFMAPFUNCMANAGED(name,\ basictype,\ Tenv,\ env,\ Tinout,\ in,\ code\ )\ \ \(\backslash\)}}
\DoxyCodeLine{00098\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ struct\ name\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00099\ \textcolor{preprocessor}{\ \ \ \ \_\_device\_\_\ basictype\ K(Tenv\ env,\ Tinout\ in)\ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00100\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ code\ ;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00101\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00102\ \textcolor{preprocessor}{\}}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00113\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ kernelF>}
\DoxyCodeLine{00114\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_aa85e45875aadfcfcbd754b45de2d4684}{ff\_mapCUDAManaged}}:\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classff_1_1ff__node_a53ab8b2244539766bdea3eb65cb04f9b}{ff\_node}}\ \{}
\DoxyCodeLine{00115\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_aa85e45875aadfcfcbd754b45de2d4684}{ff\_mapCUDAManaged}}(kernelF\ *mapF,\ \textcolor{keywordtype}{void}\ *\ env,\ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{classff_1_1ff__node_a4d7ba3bf29d7cbf82cf3d355692b874d}{in}},\ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{classff_1_1ff__node_a06adec50580f200b0edde2e66ae5152a}{out}},\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}):}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_ad3180d4a9b6145392cffbf214ca50e3d}{oneshot}}(\mbox{\hyperlink{yyjson_8h_a41f9c5fb8b08eb5dc3edce4dcb37fee7}{true}}),}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a2972a3c6c651be133a114245a852bea4}{Task}}(\ (typename\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}::env\_type\ *)env,\ (typename\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}::inout\_type\ *)\mbox{\hyperlink{classff_1_1ff__node_a4d7ba3bf29d7cbf82cf3d355692b874d}{in}},\ (typename\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}::inout\_type\ *)\mbox{\hyperlink{classff_1_1ff__node_a06adec50580f200b0edde2e66ae5152a}{out}},\ \mbox{\hyperlink{main-override_8cpp_a1384e7608274313a9433fa573868557b}{s}}\ ),}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a5ce8e6fdad38f9c750e9ad435cd229f2}{kernel}}(mapF)\ \{}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{classff_1_1ff__node_a4d7ba3bf29d7cbf82cf3d355692b874d}{in}});}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__node_a71789627f48cb9f466c50601a881c7bc}{ff\_node::skipfirstpop}}(\textcolor{keyword}{true});}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a77ffe23b05a7d3c8312c381db8d6ef27}{maxThreads}}=\mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a5e5058466f4c6784ba2691390aef3b5e}{maxBlocks}}=0;}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_ae1c4244af972d5f9ef11fa2659ab4caf}{oldSize}}=0;}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a113fe472e4d19d9aee2496c6cc43a56e}{inPtr}}\ =\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a013b47c6b7b132c5cb3150afc2dac543}{outPtr}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_af387d820d113fc18e2dd500f3ac61acc}{envPtr}}\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00127\ \ \ \ \ \}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{keywordtype}{int}\ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a41b459bbe23a25c996d0c4d97225aee4}{run}}(\textcolor{keywordtype}{bool}=\textcolor{keyword}{false})\ \{\ \textcolor{keywordflow}{return}\ \ \mbox{\hyperlink{classff_1_1ff__node_aec4506dc3946ff9e6ce5bb5370545864}{ff\_node::run}}();\ \}}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keywordtype}{int}\ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a145b4cd87bd75f34920ce3c3b1a6dddc}{wait}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff_1_1ff__node_a060b15e97e9fdc8d50fd10c0dd141a0f}{ff\_node::wait}}();\ \}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a5e3f0db8b95b7e8213a45b12e812b0cc}{run\_and\_wait\_end}}()\ \{}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a41b459bbe23a25c996d0c4d97225aee4}{run}}()<0)\ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a145b4cd87bd75f34920ce3c3b1a6dddc}{wait}}()<0)\ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00136\ \ \ \ \ \}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a34521eb12b785e3b0bab293e65a490d2}{ffTime}}()\ \ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff_1_1ff__node_aae04163f91c23bef4cf6faea5a534962}{ff\_node::ffTime}}();\ \ \}}
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_ac9a0056cbda79db64b76705758d315f4}{ffwTime}}()\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classff_1_1ff__node_aa3eaacc8f4f13e976d1214f23a14afb8}{ff\_node::wffTime}}();\ \}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a435ffc16175f335af3dba5e3278f45a3}{getTask}}()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \&\mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a2972a3c6c651be133a114245a852bea4}{Task}};\ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_ab374ab76acb8c4666b59747364dd334b}{cleanup}}()\ \{\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a5ce8e6fdad38f9c750e9ad435cd229f2}{kernel}})\ \textcolor{keyword}{delete}\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a5ce8e6fdad38f9c750e9ad435cd229f2}{kernel}};\ \}}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a83c1ed2a8f0c65b4e68b0e448ca17e0d}{svc\_init}}()\ \{}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ deviceID\ =\ 0;\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ FIX:\ \ we\ have\ to\ manage\ multiple\ devices}}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ cudaDeviceProp\ deviceProp;}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ cudaSetDevice(deviceID);}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cudaGetDeviceProperties(\&deviceProp,\ deviceID)\ !=\ cudaSuccess)}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceff_a27d926d29b55e019eba5b70672301d82}{error}}(\textcolor{stringliteral}{"{}mapCUDA,\ error\ getting\ device\ properties\(\backslash\)n"{}});}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(deviceProp.major\ ==\ 1\ \&\&\ deviceProp.minor\ <\ 2)}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a77ffe23b05a7d3c8312c381db8d6ef27}{maxThreads}}\ =\ 256;}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a77ffe23b05a7d3c8312c381db8d6ef27}{maxThreads}}\ =\ deviceProp.maxThreadsPerBlock;}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a5e5058466f4c6784ba2691390aef3b5e}{maxBlocks}}\ =\ deviceProp.maxGridSize[0];}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(cudaStreamCreate(\&\mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_ab1238f15d6b64d0830f383cc90e65027}{stream}})\ !=\ cudaSuccess)}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceff_a27d926d29b55e019eba5b70672301d82}{error}}(\textcolor{stringliteral}{"{}mapCUDA,\ error\ creating\ stream\(\backslash\)n"{}});}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00165\ \ \ \ \ \}}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{keywordtype}{void}\ *\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_ab32590de2b4bf127b0305e8ca2b327dc}{svc}}(\textcolor{keywordtype}{void}*\ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}})\ \{}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a2972a3c6c651be133a114245a852bea4}{Task}}.setTask(\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}});}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}}\ =\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a2972a3c6c651be133a114245a852bea4}{Task}}.size();}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a113fe472e4d19d9aee2496c6cc43a56e}{inPtr}}\ \ =\ (\textcolor{keyword}{typename}\ T::inout\_type*)\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a2972a3c6c651be133a114245a852bea4}{Task}}.getInPtr();}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a013b47c6b7b132c5cb3150afc2dac543}{outPtr}}\ =\ (\textcolor{keyword}{typename}\ T::inout\_type*)\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a2972a3c6c651be133a114245a852bea4}{Task}}.newOutPtr();}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_af387d820d113fc18e2dd500f3ac61acc}{envPtr}}\ =\ (\textcolor{keyword}{typename}\ T::env\_type*)\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a2972a3c6c651be133a114245a852bea4}{Task}}.getEnvPtr();}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ thxblock\ =\ \mbox{\hyperlink{namespacestd_ac7b9885417769949d76890454b6d072e}{std::min}}(\mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a77ffe23b05a7d3c8312c381db8d6ef27}{maxThreads}},\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}});}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ blockcnt\ =\ \mbox{\hyperlink{namespacestd_ac7b9885417769949d76890454b6d072e}{std::min}}(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}}/thxblock\ +\ (\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}}\%thxblock\ ==\ 0\ ?0:1),\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a5e5058466f4c6784ba2691390aef3b5e}{maxBlocks}});}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceff_a71ca07da18f599be5a84a85f8bbc49a3}{mapCUDAKernelManaged<typename\ T::env\_type,\ typename\ T::inout\_type,\ kernelF>}}}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ <<<blockcnt,thxblock,0,\mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_ab1238f15d6b64d0830f383cc90e65027}{stream}}>>>(*\mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a5ce8e6fdad38f9c750e9ad435cd229f2}{kernel}},\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_af387d820d113fc18e2dd500f3ac61acc}{envPtr}},\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a113fe472e4d19d9aee2496c6cc43a56e}{inPtr}},\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a013b47c6b7b132c5cb3150afc2dac543}{outPtr}},\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}});}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ cudaStreamSynchronize(\mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_ab1238f15d6b64d0830f383cc90e65027}{stream}});}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ return\ (NULL);}}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_ad3180d4a9b6145392cffbf214ca50e3d}{oneshot}}?\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}:\mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a013b47c6b7b132c5cb3150afc2dac543}{outPtr}});}
\DoxyCodeLine{00184\ \ \ \ \ \}}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a773a14c9c42b6abea7b2734f87cbd2d8}{svc\_end}}()\ \{}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(cudaStreamDestroy(\mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_ab1238f15d6b64d0830f383cc90e65027}{stream}})\ !=\ cudaSuccess)}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespaceff_a27d926d29b55e019eba5b70672301d82}{error}}(\textcolor{stringliteral}{"{}mapCUDA,\ error\ destroying\ stream\(\backslash\)n"{}});}
\DoxyCodeLine{00190\ \ \ \ \ \}}
\DoxyCodeLine{00191\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ \ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_ad3180d4a9b6145392cffbf214ca50e3d}{oneshot}};}
\DoxyCodeLine{00193\ \ \ \ \ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a2972a3c6c651be133a114245a852bea4}{Task}};}
\DoxyCodeLine{00194\ \ \ \ \ kernelF\ \ \ \ \ *\mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a5ce8e6fdad38f9c750e9ad435cd229f2}{kernel}};\ \ \ \ \ \textcolor{comment}{//\ user\ function}}
\DoxyCodeLine{00195\ \ \ \ \ cudaStream\_t\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_ab1238f15d6b64d0830f383cc90e65027}{stream}};}
\DoxyCodeLine{00196\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a77ffe23b05a7d3c8312c381db8d6ef27}{maxThreads}};}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a5e5058466f4c6784ba2691390aef3b5e}{maxBlocks}};}
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \ \ \ \ \ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_ae1c4244af972d5f9ef11fa2659ab4caf}{oldSize}};}
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keyword}{typename}\ T::inout\_type*\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a113fe472e4d19d9aee2496c6cc43a56e}{inPtr}};}
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{keyword}{typename}\ T::inout\_type*\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_a013b47c6b7b132c5cb3150afc2dac543}{outPtr}};}
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{keyword}{typename}\ T::env\_type*\ \mbox{\hyperlink{classff_1_1ff__map_c_u_d_a_managed_af387d820d113fc18e2dd500f3ac61acc}{envPtr}};}
\DoxyCodeLine{00202\ \};}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \textcolor{preprocessor}{\#define\ NEWMAPMANAGED(name,\ task\_t,\ f,\ env,\ input,\ output,\ size)\ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00205\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ ff\_mapCUDAManaged<task\_t,\ mapf>\ *name\ =\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00206\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ new\ ff\_mapCUDAManaged<task\_t,\ f>(\ new\ f,\ env,\ input,\ output,\ size)}}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00213\ \}\ \textcolor{comment}{//\ namespace\ ff}}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ \_FF\_MAPCUDAMANAGED\_HPP\_\ */}\textcolor{preprocessor}{}}

\end{DoxyCode}
