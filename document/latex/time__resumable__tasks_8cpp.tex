\doxysection{external/taskflow/3rd-\/party/tbb/src/perf/time\+\_\+resumable\+\_\+tasks.cpp 文件参考}
\hypertarget{time__resumable__tasks_8cpp}{}\label{time__resumable__tasks_8cpp}\index{external/taskflow/3rd-\/party/tbb/src/perf/time\_resumable\_tasks.cpp@{external/taskflow/3rd-\/party/tbb/src/perf/time\_resumable\_tasks.cpp}}
{\ttfamily \#include "{}tbb/tbb\+\_\+config.\+h"{}}\newline
{\ttfamily \#include "{}tbb/task.\+h"{}}\newline
{\ttfamily \#include "{}tbb/task\+\_\+group.\+h"{}}\newline
{\ttfamily \#include "{}tbb/task\+\_\+scheduler\+\_\+init.\+h"{}}\newline
{\ttfamily \#include "{}tbb/tick\+\_\+count.\+h"{}}\newline
{\ttfamily \#include "{}tbb/parallel\+\_\+for.\+h"{}}\newline
{\ttfamily \#include $<$vector$>$}\newline
{\ttfamily \#include $<$stack$>$}\newline
{\ttfamily \#include $<$functional$>$}\newline
{\ttfamily \#include $<$numeric$>$}\newline
{\ttfamily \#include $<$algorithm$>$}\newline
{\ttfamily \#include "{}harness\+\_\+perf.\+h"{}}\newline
{\ttfamily \#include $<$unistd.\+h$>$}\newline
{\ttfamily \#include "{}../tbb/co\+\_\+context.\+h"{}}\newline
{\ttfamily \#include "{}../test/harness.\+h"{}}\newline
time\+\_\+resumable\+\_\+tasks.\+cpp 的引用(Include)关系图\+:
% FIG 0
\doxysubsubsection*{类}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{classtbb_1_1internal_1_1governor}{tbb\+::internal\+::governor}}
\begin{DoxyCompactList}\small\item\em The class handles access to the single instance of market, and to TLS to keep scheduler instances. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{命名空间}
\begin{DoxyCompactItemize}
\item 
namespace \mbox{\hyperlink{namespacetbb}{tbb}}
\begin{DoxyCompactList}\small\item\em The graph class \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespacetbb_1_1internal}{tbb\+::internal}}
\end{DoxyCompactItemize}
\doxysubsubsection*{宏定义}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{time__resumable__tasks_8cpp_a469b4a1d5924f0d12668f5663713d59e}{TBB\+\_\+\+PREVIEW\+\_\+\+RESUMABLE\+\_\+\+TASKS}}~1
\item 
\#define \mbox{\hyperlink{time__resumable__tasks_8cpp_a7b58d28a34a1717e2ddb591f00658b10}{\+\_\+\+\_\+\+TBB\+\_\+\+ASSERT}}(predicate,  \mbox{\hyperlink{sugar_8h_a0c23ad0ad5cb6105679214f4d0442b0b}{comment}})
\item 
\#define \mbox{\hyperlink{time__resumable__tasks_8cpp_a643ae54febb34aa0f2543aa5385a606f}{\+\_\+\+\_\+\+TBB\+\_\+\+ASSERT\+\_\+\+EX}}(predicate,  \mbox{\hyperlink{sugar_8h_a0c23ad0ad5cb6105679214f4d0442b0b}{comment}})
\item 
\#define \mbox{\hyperlink{time__resumable__tasks_8cpp_abbc551e67d4eaef9c182b99aa291ef4d}{\+\_\+\+TBB\+\_\+governor\+\_\+H}}
\item 
\#define \mbox{\hyperlink{time__resumable__tasks_8cpp_a6d018e7442718f1436f37b210108c292}{HARNESS\+\_\+\+CUSTOM\+\_\+\+MAIN}}~1
\end{DoxyCompactItemize}
\doxysubsubsection*{函数}
\begin{DoxyCompactItemize}
\item 
{\footnotesize template$<$typename \mbox{\hyperlink{_tutorial__sparse__example_8cpp_af639fb96631ba0018f0b2259fc95edfb}{T}}$>$ }\\\mbox{\hyperlink{_tutorial__sparse__example_8cpp_af639fb96631ba0018f0b2259fc95edfb}{T}} \mbox{\hyperlink{time__resumable__tasks_8cpp_aa8559fbb9c26fb8ad6e57e16c4d25da5}{get\+\_\+median}} (std\+::vector$<$ \mbox{\hyperlink{_tutorial__sparse__example_8cpp_af639fb96631ba0018f0b2259fc95edfb}{T}} $>$ \&times)
\item 
\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}} \mbox{\hyperlink{time__resumable__tasks_8cpp_a890af2fb1f37b78c34807251977eeb74}{Bench\+Coroutines\+Allocation}} ()
\item 
\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}} \mbox{\hyperlink{time__resumable__tasks_8cpp_ae3afc9b97c8ab75f299a6320059ef295}{Bench\+Reusage}} ()
\begin{DoxyCompactList}\small\item\em Create a task, which suspends and resumes intself, thus reusing once created coroutine \end{DoxyCompactList}\item 
\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}} \mbox{\hyperlink{time__resumable__tasks_8cpp_aba639629227412f99b3b06c74b822b98}{Bench\+Context\+Switch}} ()
\item 
{\footnotesize template$<$\mbox{\hyperlink{sugar_8h_abb452686968e48b67397da5f97445f5b}{bool}} Use\+Resumable\+Tasks$>$ }\\\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}} \mbox{\hyperlink{time__resumable__tasks_8cpp_ad572e7443003ecc643a5c3845620e8b4}{Scalability\+Benchmark}} (const size\+\_\+t work\+\_\+size)
\item 
size\+\_\+t \mbox{\hyperlink{namespacetbb_1_1internal_a95a4c026015eb6d42c8f75142d505346}{tbb\+::internal\+::\+Get\+Default\+System\+Page\+Size}} ()
\begin{DoxyCompactList}\small\item\em System dependent impl \end{DoxyCompactList}\item 
\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}} \mbox{\hyperlink{namespacetbb_1_1internal_aee46eccf72845b4f36744d96cd0d359f}{tbb\+::internal\+::co\+\_\+local\+\_\+wait\+\_\+for\+\_\+all}} (\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}})
\item 
\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}} \mbox{\hyperlink{time__resumable__tasks_8cpp_a9a31bcaf6d9755374dc29ebe09466cad}{Bench\+Native\+Impl}} (const size\+\_\+t work\+\_\+size)
\item 
\mbox{\hyperlink{sugar_8h_ae4f82344f573c70aa1066a2394bba345}{int}} \mbox{\hyperlink{time__resumable__tasks_8cpp_ae66f6b31b5ad750f1fe042a706a4e3d4}{main}} ()
\end{DoxyCompactItemize}
\doxysubsubsection*{变量}
\begin{DoxyCompactItemize}
\item 
const \mbox{\hyperlink{sugar_8h_ae4f82344f573c70aa1066a2394bba345}{int}} \mbox{\hyperlink{time__resumable__tasks_8cpp_aefbfce63395b6dd1eda292588c4a3dae}{DEF\+\_\+\+BENCH\+\_\+\+RUNS}} = 1000
\end{DoxyCompactItemize}


\doxysubsection{宏定义说明}
\Hypertarget{time__resumable__tasks_8cpp_a7b58d28a34a1717e2ddb591f00658b10}\index{time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}!\_\_TBB\_ASSERT@{\_\_TBB\_ASSERT}}
\index{\_\_TBB\_ASSERT@{\_\_TBB\_ASSERT}!time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}}
\doxysubsubsection{\texorpdfstring{\_\_TBB\_ASSERT}{\_\_TBB\_ASSERT}}
{\footnotesize\ttfamily \label{time__resumable__tasks_8cpp_a7b58d28a34a1717e2ddb591f00658b10} 
\#define \+\_\+\+\_\+\+TBB\+\_\+\+ASSERT(\begin{DoxyParamCaption}\item[{}]{predicate}{, }\item[{}]{\mbox{\hyperlink{sugar_8h_a0c23ad0ad5cb6105679214f4d0442b0b}{comment}}}{}\end{DoxyParamCaption})}

{\bfseries 值\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{((\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}})0)}

\end{DoxyCode}
\Hypertarget{time__resumable__tasks_8cpp_a643ae54febb34aa0f2543aa5385a606f}\index{time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}!\_\_TBB\_ASSERT\_EX@{\_\_TBB\_ASSERT\_EX}}
\index{\_\_TBB\_ASSERT\_EX@{\_\_TBB\_ASSERT\_EX}!time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}}
\doxysubsubsection{\texorpdfstring{\_\_TBB\_ASSERT\_EX}{\_\_TBB\_ASSERT\_EX}}
{\footnotesize\ttfamily \label{time__resumable__tasks_8cpp_a643ae54febb34aa0f2543aa5385a606f} 
\#define \+\_\+\+\_\+\+TBB\+\_\+\+ASSERT\+\_\+\+EX(\begin{DoxyParamCaption}\item[{}]{predicate}{, }\item[{}]{\mbox{\hyperlink{sugar_8h_a0c23ad0ad5cb6105679214f4d0442b0b}{comment}}}{}\end{DoxyParamCaption})}

{\bfseries 值\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{((\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}})(1\ \&\&\ (predicate)))}

\end{DoxyCode}
\Hypertarget{time__resumable__tasks_8cpp_abbc551e67d4eaef9c182b99aa291ef4d}\index{time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}!\_TBB\_governor\_H@{\_TBB\_governor\_H}}
\index{\_TBB\_governor\_H@{\_TBB\_governor\_H}!time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}}
\doxysubsubsection{\texorpdfstring{\_TBB\_governor\_H}{\_TBB\_governor\_H}}
{\footnotesize\ttfamily \label{time__resumable__tasks_8cpp_abbc551e67d4eaef9c182b99aa291ef4d} 
\#define \+\_\+\+TBB\+\_\+governor\+\_\+H}

\Hypertarget{time__resumable__tasks_8cpp_a6d018e7442718f1436f37b210108c292}\index{time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}!HARNESS\_CUSTOM\_MAIN@{HARNESS\_CUSTOM\_MAIN}}
\index{HARNESS\_CUSTOM\_MAIN@{HARNESS\_CUSTOM\_MAIN}!time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}}
\doxysubsubsection{\texorpdfstring{HARNESS\_CUSTOM\_MAIN}{HARNESS\_CUSTOM\_MAIN}}
{\footnotesize\ttfamily \label{time__resumable__tasks_8cpp_a6d018e7442718f1436f37b210108c292} 
\#define HARNESS\+\_\+\+CUSTOM\+\_\+\+MAIN~1}

\Hypertarget{time__resumable__tasks_8cpp_a469b4a1d5924f0d12668f5663713d59e}\index{time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}!TBB\_PREVIEW\_RESUMABLE\_TASKS@{TBB\_PREVIEW\_RESUMABLE\_TASKS}}
\index{TBB\_PREVIEW\_RESUMABLE\_TASKS@{TBB\_PREVIEW\_RESUMABLE\_TASKS}!time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}}
\doxysubsubsection{\texorpdfstring{TBB\_PREVIEW\_RESUMABLE\_TASKS}{TBB\_PREVIEW\_RESUMABLE\_TASKS}}
{\footnotesize\ttfamily \label{time__resumable__tasks_8cpp_a469b4a1d5924f0d12668f5663713d59e} 
\#define TBB\+\_\+\+PREVIEW\+\_\+\+RESUMABLE\+\_\+\+TASKS~1}



\doxysubsection{函数说明}
\Hypertarget{time__resumable__tasks_8cpp_aba639629227412f99b3b06c74b822b98}\index{time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}!BenchContextSwitch@{BenchContextSwitch}}
\index{BenchContextSwitch@{BenchContextSwitch}!time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}}
\doxysubsubsection{\texorpdfstring{BenchContextSwitch()}{BenchContextSwitch()}}
{\footnotesize\ttfamily \label{time__resumable__tasks_8cpp_aba639629227412f99b3b06c74b822b98} 
\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}} Bench\+Context\+Switch (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

Create two tasks and switch between them (suspend current and resume previously suspended coroutine) Measure an average time of the context switch 函数调用图\+:
% FIG 1
\Hypertarget{time__resumable__tasks_8cpp_a890af2fb1f37b78c34807251977eeb74}\index{time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}!BenchCoroutinesAllocation@{BenchCoroutinesAllocation}}
\index{BenchCoroutinesAllocation@{BenchCoroutinesAllocation}!time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}}
\doxysubsubsection{\texorpdfstring{BenchCoroutinesAllocation()}{BenchCoroutinesAllocation()}}
{\footnotesize\ttfamily \label{time__resumable__tasks_8cpp_a890af2fb1f37b78c34807251977eeb74} 
\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}} Bench\+Coroutines\+Allocation (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}

Allocate COROUTINES\+\_\+\+NUM fibers in a row (suspend) in a recursive manner and then swith back (resume) unwinding the ctx\+\_\+stack. 函数调用图\+:
% FIG 2
\Hypertarget{time__resumable__tasks_8cpp_a9a31bcaf6d9755374dc29ebe09466cad}\index{time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}!BenchNativeImpl@{BenchNativeImpl}}
\index{BenchNativeImpl@{BenchNativeImpl}!time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}}
\doxysubsubsection{\texorpdfstring{BenchNativeImpl()}{BenchNativeImpl()}}
{\footnotesize\ttfamily \label{time__resumable__tasks_8cpp_a9a31bcaf6d9755374dc29ebe09466cad} 
\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}} Bench\+Native\+Impl (\begin{DoxyParamCaption}\item[{const size\+\_\+t}]{work\+\_\+size}{}\end{DoxyParamCaption})}

函数调用图\+:
% FIG 3
\Hypertarget{time__resumable__tasks_8cpp_ae3afc9b97c8ab75f299a6320059ef295}\index{time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}!BenchReusage@{BenchReusage}}
\index{BenchReusage@{BenchReusage}!time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}}
\doxysubsubsection{\texorpdfstring{BenchReusage()}{BenchReusage()}}
{\footnotesize\ttfamily \label{time__resumable__tasks_8cpp_ae3afc9b97c8ab75f299a6320059ef295} 
\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}} Bench\+Reusage (\begin{DoxyParamCaption}{}{}\end{DoxyParamCaption})}



Create a task, which suspends and resumes intself, thus reusing once created coroutine 

函数调用图\+:
% FIG 4
\Hypertarget{time__resumable__tasks_8cpp_aa8559fbb9c26fb8ad6e57e16c4d25da5}\index{time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}!get\_median@{get\_median}}
\index{get\_median@{get\_median}!time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}}
\doxysubsubsection{\texorpdfstring{get\_median()}{get\_median()}}
{\footnotesize\ttfamily \label{time__resumable__tasks_8cpp_aa8559fbb9c26fb8ad6e57e16c4d25da5} 
template$<$typename \mbox{\hyperlink{_tutorial__sparse__example_8cpp_af639fb96631ba0018f0b2259fc95edfb}{T}}$>$ \\
\mbox{\hyperlink{_tutorial__sparse__example_8cpp_af639fb96631ba0018f0b2259fc95edfb}{T}} get\+\_\+median (\begin{DoxyParamCaption}\item[{std\+::vector$<$ \mbox{\hyperlink{_tutorial__sparse__example_8cpp_af639fb96631ba0018f0b2259fc95edfb}{T}} $>$ \&}]{times}{}\end{DoxyParamCaption})}

函数调用图\+:
% FIG 5
\Hypertarget{time__resumable__tasks_8cpp_ae66f6b31b5ad750f1fe042a706a4e3d4}\index{time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}!main@{main}}
\index{main@{main}!time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily \label{time__resumable__tasks_8cpp_ae66f6b31b5ad750f1fe042a706a4e3d4} 
\mbox{\hyperlink{sugar_8h_ae4f82344f573c70aa1066a2394bba345}{int}} main (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}}}]{}{}\end{DoxyParamCaption})}

函数调用图\+:
% FIG 6
\Hypertarget{time__resumable__tasks_8cpp_ad572e7443003ecc643a5c3845620e8b4}\index{time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}!ScalabilityBenchmark@{ScalabilityBenchmark}}
\index{ScalabilityBenchmark@{ScalabilityBenchmark}!time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}}
\doxysubsubsection{\texorpdfstring{ScalabilityBenchmark()}{ScalabilityBenchmark()}}
{\footnotesize\ttfamily \label{time__resumable__tasks_8cpp_ad572e7443003ecc643a5c3845620e8b4} 
template$<$\mbox{\hyperlink{sugar_8h_abb452686968e48b67397da5f97445f5b}{bool}} Use\+Resumable\+Tasks$>$ \\
\mbox{\hyperlink{ittnotify__static_8h_a61af67d9d838a9497ca5b188dabc1aa0}{void}} Scalability\+Benchmark (\begin{DoxyParamCaption}\item[{const size\+\_\+t}]{work\+\_\+size}{}\end{DoxyParamCaption})}

Strong scaling benchmark with predefined number of iterations (N), each parallel\+\_\+for task suspends and resumes itself with a predefined busy-\/waiting iterations (work size). Reports 3 numbers\+: serial, half of the machine, and full available concurrency 函数调用图\+:
% FIG 7


\doxysubsection{变量说明}
\Hypertarget{time__resumable__tasks_8cpp_aefbfce63395b6dd1eda292588c4a3dae}\index{time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}!DEF\_BENCH\_RUNS@{DEF\_BENCH\_RUNS}}
\index{DEF\_BENCH\_RUNS@{DEF\_BENCH\_RUNS}!time\_resumable\_tasks.cpp@{time\_resumable\_tasks.cpp}}
\doxysubsubsection{\texorpdfstring{DEF\_BENCH\_RUNS}{DEF\_BENCH\_RUNS}}
{\footnotesize\ttfamily \label{time__resumable__tasks_8cpp_aefbfce63395b6dd1eda292588c4a3dae} 
const \mbox{\hyperlink{sugar_8h_ae4f82344f573c70aa1066a2394bba345}{int}} DEF\+\_\+\+BENCH\+\_\+\+RUNS = 1000}

