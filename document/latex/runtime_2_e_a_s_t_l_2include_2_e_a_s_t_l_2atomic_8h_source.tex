\doxysection{atomic.\+h}
\hypertarget{runtime_2_e_a_s_t_l_2include_2_e_a_s_t_l_2atomic_8h_source}{}\label{runtime_2_e_a_s_t_l_2include_2_e_a_s_t_l_2atomic_8h_source}\index{runtime/EASTL/include/EASTL/atomic.h@{runtime/EASTL/include/EASTL/atomic.h}}
\mbox{\hyperlink{runtime_2_e_a_s_t_l_2include_2_e_a_s_t_l_2atomic_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Copyright\ (c)\ Electronic\ Arts\ Inc.\ All\ rights\ reserved.}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#ifndef\ EASTL\_ATOMIC\_H}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#define\ EASTL\_ATOMIC\_H}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#if\ defined(EA\_PRAGMA\_ONCE\_SUPPORTED)}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\ \ \ \ \#pragma\ once}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00015\ \textcolor{comment}{//}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ \ Below\ is\ the\ documentation\ of\ the\ API\ of\ the\ eastl::atomic<T>\ library.}}
\DoxyCodeLine{00017\ \textcolor{comment}{//\ \ This\ includes\ class\ and\ free\ functions.}}
\DoxyCodeLine{00018\ \textcolor{comment}{//\ \ Anything\ marked\ with\ a\ '+'\ in\ front\ of\ the\ name\ is\ an\ extension\ to\ the\ std\ API.}}
\DoxyCodeLine{00019\ \textcolor{comment}{//}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00023\ \textcolor{comment}{//}}
\DoxyCodeLine{00024\ \textcolor{comment}{//\ eastl::atomic<T>\ memory\_order\ API}}
\DoxyCodeLine{00025\ \textcolor{comment}{//}}
\DoxyCodeLine{00026\ \textcolor{comment}{//\ \ See\ below\ for\ full\ explanations\ on\ the\ memory\ orders\ and\ their\ guarantees.}}
\DoxyCodeLine{00027\ \textcolor{comment}{//}}
\DoxyCodeLine{00028\ \textcolor{comment}{//\ \ -\/\ eastl::memory\_order\_relaxed}}
\DoxyCodeLine{00029\ \textcolor{comment}{//\ \ -\/\ eastl::memory\_order\_acquire}}
\DoxyCodeLine{00030\ \textcolor{comment}{//\ \ -\/\ eastl::memory\_order\_release}}
\DoxyCodeLine{00031\ \textcolor{comment}{//\ \ -\/\ eastl::memory\_order\_acq\_rel}}
\DoxyCodeLine{00032\ \textcolor{comment}{//\ \ -\/\ eastl::memory\_order\_seq\_cst}}
\DoxyCodeLine{00033\ \textcolor{comment}{//\ \ -\/\ +eastl::memory\_order\_read\_depends}}
\DoxyCodeLine{00034\ \textcolor{comment}{//}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00038\ \textcolor{comment}{//}}
\DoxyCodeLine{00039\ \textcolor{comment}{//\ eastl::atomic<T>\ class\ API}}
\DoxyCodeLine{00040\ \textcolor{comment}{//}}
\DoxyCodeLine{00041\ \textcolor{comment}{//\ \ \ All\ jargon\ and\ prerequisite\ knowledge\ is\ explained\ below.}}
\DoxyCodeLine{00042\ \textcolor{comment}{//}}
\DoxyCodeLine{00043\ \textcolor{comment}{//\ \ \ Unless\ otherwise\ specified\ all\ orders\ except\ read\_depends\ is\ a\ valid\ order}}
\DoxyCodeLine{00044\ \textcolor{comment}{//\ \ \ on\ the\ given\ operation.}}
\DoxyCodeLine{00045\ \textcolor{comment}{//\ \ \ Unless\ otherwise\ specified\ all\ operations\ are\ valid\ on\ all\ types\ T.}}
\DoxyCodeLine{00046\ \textcolor{comment}{//\ \ \ If\ no\ order\ is\ provided,\ seq\_cst\ memory\ ordering\ is\ used\ for\ the\ operation.}}
\DoxyCodeLine{00047\ \textcolor{comment}{//}}
\DoxyCodeLine{00048\ \textcolor{comment}{//\ \ \ -\/\ atomic()\ \ \ \ \ \ \ \ :\ Value-\/initializes\ the\ underlying\ object\ as\ T\{\}.}}
\DoxyCodeLine{00049\ \textcolor{comment}{//}}
\DoxyCodeLine{00050\ \textcolor{comment}{//\ \ \ -\/\ atomic(T)\ \ \ \ \ \ \ :\ Initializes\ the\ underlying\ object\ with\ a\ copy\ of\ T.}}
\DoxyCodeLine{00051\ \textcolor{comment}{//}}
\DoxyCodeLine{00052\ \textcolor{comment}{//\ \ \ -\/\ T\ operator=(T)\ \ :\ Atomically\ assigns\ T\ as\ store(T,\ seq\_cst).}}
\DoxyCodeLine{00053\ \textcolor{comment}{//}}
\DoxyCodeLine{00054\ \textcolor{comment}{//\ \ \ -\/\ is\_lock\_free()\ \ :\ true\ if\ the\ operations\ are\ lockfree.\ Always\ true\ for\ eastl.}}
\DoxyCodeLine{00055\ \textcolor{comment}{//}}
\DoxyCodeLine{00056\ \textcolor{comment}{//\ \ \ -\/\ store(T,\ order)\ :\ Atomically\ stores\ T\ affecting\ memory\ according\ to\ order.}}
\DoxyCodeLine{00057\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ Valid\ orders\ are\ relaxed,\ release,\ and\ seq\_cst.}}
\DoxyCodeLine{00058\ \textcolor{comment}{//}}
\DoxyCodeLine{00059\ \textcolor{comment}{//\ \ \ -\/\ T\ load(order)\ \ \ :\ Atomically\ loads\ T\ affecting\ memory\ according\ to\ order.}}
\DoxyCodeLine{00060\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ Valid\ orders\ are\ relaxed,\ acquire,\ and\ seq\_cst.}}
\DoxyCodeLine{00061\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ If\ T\ is\ a\ pointer\ type,\ read\_depends\ is\ another\ valid\ order.}}
\DoxyCodeLine{00062\ \textcolor{comment}{//}}
\DoxyCodeLine{00063\ \textcolor{comment}{//\ \ \ -\/\ operator\ T()\ \ \ \ :\ Atomically\ loads\ T\ as\ load(T,\ seq\_cst).}}
\DoxyCodeLine{00064\ \textcolor{comment}{//}}
\DoxyCodeLine{00065\ \textcolor{comment}{//\ \ \ -\/\ T\ exchange(T,\ order)\ :\ Atomically\ performs\ a\ RMW\ that\ replaces\ the\ current\ value\ with\ T.}}
\DoxyCodeLine{00066\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ Memory\ is\ affected\ according\ to\ order.}}
\DoxyCodeLine{00067\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ Returns\ the\ previous\ value\ stored\ before\ the\ RMW\ operation.}}
\DoxyCodeLine{00068\ \textcolor{comment}{//}}
\DoxyCodeLine{00069\ \textcolor{comment}{//\ \ \ -\/\ bool\ compare\_exchange\_weak(T\&,\ T,\ successOrder,\ failOrder)}}
\DoxyCodeLine{00070\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Atomically\ compares\ the\ value\ stored\ with\ that\ of\ T\&\ and\ if\ equal\ replaces\ it\ with\ T.}}
\DoxyCodeLine{00071\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ This\ is\ a\ RMW\ operation.}}
\DoxyCodeLine{00072\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ If\ the\ comparison\ fails,\ loads\ the\ observed\ value\ into\ T\&.\ This\ is\ a\ load\ operation.}}
\DoxyCodeLine{00073\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Memory\ is\ affected\ in\ the\ RMW\ operation\ according\ to\ successOrder.}}
\DoxyCodeLine{00074\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Memory\ is\ affected\ in\ the\ load\ operation\ according\ to\ failOrder.}}
\DoxyCodeLine{00075\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ failOrder\ cannot\ be\ a\ stronger\ order\ than\ successOrder.}}
\DoxyCodeLine{00076\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Returns\ true\ or\ false\ if\ the\ comparison\ succeeded\ and\ T\ was\ stored\ into\ the\ atomic\ object.}}
\DoxyCodeLine{00077\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :}}
\DoxyCodeLine{00078\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ The\ weak\ variant\ may\ fail\ even\ if\ the\ observed\ value\ of\ the\ atomic\ object\ equals\ T\&.}}
\DoxyCodeLine{00079\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ This\ can\ yield\ performance\ gains\ on\ platforms\ with\ ld/str\ exclusive\ pair\ instructions\ especially}}
\DoxyCodeLine{00080\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ when\ the\ compare\_exchange\ operation\ is\ done\ in\ a\ loop.}}
\DoxyCodeLine{00081\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Only\ the\ bool\ return\ value\ can\ be\ used\ to\ determine\ if\ the\ operation\ was\ successful.}}
\DoxyCodeLine{00082\ \textcolor{comment}{//}}
\DoxyCodeLine{00083\ \textcolor{comment}{//\ \ \ -\/\ bool\ compare\_exchange\_weak(T\&,\ T,\ order)}}
\DoxyCodeLine{00084\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Same\ as\ the\ above\ except\ that\ order\ is\ used\ for\ both\ the\ RMW\ and\ the\ load\ operation.}}
\DoxyCodeLine{00085\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ If\ order\ ==\ acq\_rel\ then\ the\ order\ of\ the\ load\ operation\ equals\ acquire.}}
\DoxyCodeLine{00086\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ If\ order\ ==\ release\ then\ the\ order\ of\ the\ load\ operation\ equals\ relaxed.}}
\DoxyCodeLine{00087\ \textcolor{comment}{//}}
\DoxyCodeLine{00088\ \textcolor{comment}{//\ \ \ -\/\ bool\ compare\_exchange\_strong(T\&,\ T,\ successOrder,\ failOrder)}}
\DoxyCodeLine{00089\ \textcolor{comment}{//\ \ \ -\/\ bool\ compare\_exchange\_strong(T\&,\ T,\ order)}}
\DoxyCodeLine{00090\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ This\ operation\ is\ the\ same\ as\ the\ above\ weak\ variants}}
\DoxyCodeLine{00091\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ expect\ that\ it\ will\ not\ fail\ spuriously\ if\ the\ value\ stored\ equals\ T\&.}}
\DoxyCodeLine{00092\ \textcolor{comment}{//}}
\DoxyCodeLine{00093\ \textcolor{comment}{//\ \ \ The\ below\ operations\ are\ only\ valid\ for\ Integral\ types.}}
\DoxyCodeLine{00094\ \textcolor{comment}{//}}
\DoxyCodeLine{00095\ \textcolor{comment}{//\ \ \ -\/\ T\ fetch\_add(T,\ order)}}
\DoxyCodeLine{00096\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Atomically\ performs\ a\ RMW\ that\ increments\ the\ value\ stored\ with\ T.}}
\DoxyCodeLine{00097\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Returns\ the\ previous\ value\ stored\ before\ the\ RMW\ operation.}}
\DoxyCodeLine{00098\ \textcolor{comment}{//\ \ \ -\/\ T\ fetch\_sub(T,\ order)}}
\DoxyCodeLine{00099\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Atomically\ performs\ a\ RMW\ that\ decrements\ the\ value\ stored\ with\ T.}}
\DoxyCodeLine{00100\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Returns\ the\ previous\ value\ stored\ before\ the\ RMW\ operation.}}
\DoxyCodeLine{00101\ \textcolor{comment}{//\ \ \ -\/\ T\ fetch\_and(T,\ order)}}
\DoxyCodeLine{00102\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Atomically\ performs\ a\ RMW\ that\ bit-\/wise\ and's\ the\ value\ stored\ with\ T.}}
\DoxyCodeLine{00103\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Returns\ the\ previous\ value\ stored\ before\ the\ RMW\ operation.}}
\DoxyCodeLine{00104\ \textcolor{comment}{//\ \ \ -\/\ T\ fetch\_or(T,\ order)}}
\DoxyCodeLine{00105\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Atomically\ performs\ a\ RMW\ that\ bit-\/wise\ or's\ the\ value\ stored\ with\ T.}}
\DoxyCodeLine{00106\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Returns\ the\ previous\ value\ stored\ before\ the\ RMW\ operation.}}
\DoxyCodeLine{00107\ \textcolor{comment}{//\ \ \ -\/\ T\ fetch\_xor(T,\ order)}}
\DoxyCodeLine{00108\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Atomically\ performs\ a\ RMW\ that\ bit-\/wise\ xor's\ the\ value\ stored\ with\ T.}}
\DoxyCodeLine{00109\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Returns\ the\ previous\ value\ stored\ before\ the\ RMW\ operation.}}
\DoxyCodeLine{00110\ \textcolor{comment}{//}}
\DoxyCodeLine{00111\ \textcolor{comment}{//\ \ \ -\/\ +T\ add\_fetch(T,\ order)}}
\DoxyCodeLine{00112\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Atomically\ performs\ a\ RMW\ that\ increments\ the\ value\ stored\ with\ T.}}
\DoxyCodeLine{00113\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Returns\ the\ new\ updated\ value\ after\ the\ operation.}}
\DoxyCodeLine{00114\ \textcolor{comment}{//\ \ \ -\/\ +T\ sub\_fetch(T,\ order)}}
\DoxyCodeLine{00115\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Atomically\ performs\ a\ RMW\ that\ decrements\ the\ value\ stored\ with\ T.}}
\DoxyCodeLine{00116\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Returns\ the\ new\ updated\ value\ after\ the\ operation.}}
\DoxyCodeLine{00117\ \textcolor{comment}{//\ \ \ -\/\ +T\ and\_fetch(T,\ order)}}
\DoxyCodeLine{00118\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Atomically\ performs\ a\ RMW\ that\ bit-\/wise\ and's\ the\ value\ stored\ with\ T.}}
\DoxyCodeLine{00119\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Returns\ the\ new\ updated\ value\ after\ the\ operation.}}
\DoxyCodeLine{00120\ \textcolor{comment}{//\ \ \ -\/\ +T\ or\_fetch(T,\ order)}}
\DoxyCodeLine{00121\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Atomically\ performs\ a\ RMW\ that\ bit-\/wise\ or's\ the\ value\ stored\ with\ T.}}
\DoxyCodeLine{00122\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Returns\ the\ new\ updated\ value\ after\ the\ operation.}}
\DoxyCodeLine{00123\ \textcolor{comment}{//\ \ \ -\/\ +T\ xor\_fetch(T,\ order)}}
\DoxyCodeLine{00124\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Atomically\ performs\ a\ RMW\ that\ bit-\/wise\ xor's\ the\ value\ stored\ with\ T.}}
\DoxyCodeLine{00125\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Returns\ the\ new\ updated\ value\ after\ the\ operation.}}
\DoxyCodeLine{00126\ \textcolor{comment}{//}}
\DoxyCodeLine{00127\ \textcolor{comment}{//\ \ \ -\/\ T\ operator++/-\/-\/()}}
\DoxyCodeLine{00128\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Atomically\ increments\ or\ decrements\ the\ atomic\ value\ by\ one.}}
\DoxyCodeLine{00129\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Returns\ the\ previous\ value\ stored\ before\ the\ RMW\ operation.}}
\DoxyCodeLine{00130\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Memory\ is\ affected\ according\ to\ seq\_cst\ ordering.}}
\DoxyCodeLine{00131\ \textcolor{comment}{//}}
\DoxyCodeLine{00132\ \textcolor{comment}{//\ \ \ -\/\ T\ ++/-\/-\/operator()}}
\DoxyCodeLine{00133\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Atomically\ increments\ or\ decrements\ the\ atomic\ value\ by\ one.}}
\DoxyCodeLine{00134\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Returns\ the\ new\ updated\ value\ after\ the\ RMW\ operation.}}
\DoxyCodeLine{00135\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Memory\ is\ affected\ according\ to\ seq\_cst\ ordering.}}
\DoxyCodeLine{00136\ \textcolor{comment}{//}}
\DoxyCodeLine{00137\ \textcolor{comment}{//\ \ \ -\/\ T\ operator+=/-\/=/\&=/|=/\string^=(T)}}
\DoxyCodeLine{00138\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Atomically\ adds,\ subtracts,\ bitwise\ and/or/xor\ the\ atomic\ object\ with\ T.}}
\DoxyCodeLine{00139\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Returns\ the\ new\ updated\ value\ after\ the\ operation.}}
\DoxyCodeLine{00140\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Memory\ is\ affected\ according\ to\ seq\_cst\ ordering.}}
\DoxyCodeLine{00141\ \textcolor{comment}{//}}
\DoxyCodeLine{00142\ \textcolor{comment}{//}}
\DoxyCodeLine{00143\ \textcolor{comment}{//\ \ \ The\ below\ operations\ are\ only\ valid\ for\ Pointer\ types}}
\DoxyCodeLine{00144\ \textcolor{comment}{//}}
\DoxyCodeLine{00145\ \textcolor{comment}{//\ \ \ -\/\ T*\ fetch\_add(ptrdiff\_t\ val,\ order)}}
\DoxyCodeLine{00146\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Atomically\ performs\ a\ RMW\ that\ increments\ the\ value\ store\ with\ sizeof(T)\ *\ val}}
\DoxyCodeLine{00147\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Returns\ the\ previous\ value\ stored\ before\ the\ RMW\ operation.}}
\DoxyCodeLine{00148\ \textcolor{comment}{//\ \ \ -\/\ T*\ fetch\_sub(ptrdiff\_t\ val,\ order)}}
\DoxyCodeLine{00149\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Atomically\ performs\ a\ RMW\ that\ decrements\ the\ value\ store\ with\ sizeof(T)\ *\ val}}
\DoxyCodeLine{00150\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Returns\ the\ previous\ value\ stored\ before\ the\ RMW\ operation.}}
\DoxyCodeLine{00151\ \textcolor{comment}{//}}
\DoxyCodeLine{00152\ \textcolor{comment}{//\ \ \ -\/\ +T*\ add\_fetch(ptrdiff\_t\ val,\ order)}}
\DoxyCodeLine{00153\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Atomically\ performs\ a\ RMW\ that\ increments\ the\ value\ store\ with\ sizeof(T)\ *\ val}}
\DoxyCodeLine{00154\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Returns\ the\ new\ updated\ value\ after\ the\ operation.}}
\DoxyCodeLine{00155\ \textcolor{comment}{//\ \ \ -\/\ +T*\ sub\_fetch(ptrdiff\_t\ val,\ order)}}
\DoxyCodeLine{00156\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Atomically\ performs\ a\ RMW\ that\ decrements\ the\ value\ store\ with\ sizeof(T)\ *\ val}}
\DoxyCodeLine{00157\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Returns\ the\ new\ updated\ value\ after\ the\ operation.}}
\DoxyCodeLine{00158\ \textcolor{comment}{//}}
\DoxyCodeLine{00159\ \textcolor{comment}{//\ \ \ -\/\ T*\ operator++/-\/-\/()}}
\DoxyCodeLine{00160\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Atomically\ increments\ or\ decrements\ the\ atomic\ value\ by\ sizeof(T)\ *\ 1.}}
\DoxyCodeLine{00161\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Returns\ the\ previous\ value\ stored\ before\ the\ RMW\ operation.}}
\DoxyCodeLine{00162\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Memory\ is\ affected\ according\ to\ seq\_cst\ ordering.}}
\DoxyCodeLine{00163\ \textcolor{comment}{//}}
\DoxyCodeLine{00164\ \textcolor{comment}{//\ \ \ -\/\ T*\ ++/-\/-\/operator()}}
\DoxyCodeLine{00165\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Atomically\ increments\ or\ decrements\ the\ atomic\ value\ by\ sizeof(T)\ *\ 1.}}
\DoxyCodeLine{00166\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Returns\ the\ new\ updated\ value\ after\ the\ RMW\ operation.}}
\DoxyCodeLine{00167\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Memory\ is\ affected\ according\ to\ seq\_cst\ ordering.}}
\DoxyCodeLine{00168\ \textcolor{comment}{//}}
\DoxyCodeLine{00169\ \textcolor{comment}{//}}
\DoxyCodeLine{00170\ \textcolor{comment}{//\ \ \ -\/\ +EASTL\_ATOMIC\_HAS\_[len]BIT\ Macro\ Definitions}}
\DoxyCodeLine{00171\ \textcolor{comment}{//\ \ \ \ \ \ \ \ These\ macros\ provide\ the\ ability\ to\ compile-\/time\ switch\ on\ the\ availability\ of\ support\ for\ the\ specific}}
\DoxyCodeLine{00172\ \textcolor{comment}{//\ \ \ \ \ \ \ \ bit\ width\ of\ an\ atomic\ object.}}
\DoxyCodeLine{00173\ \textcolor{comment}{//\ \ \ Example:}}
\DoxyCodeLine{00174\ \textcolor{comment}{//}}
\DoxyCodeLine{00175\ \textcolor{comment}{//\ \ \ \#if\ defined(EASTL\_ATOMIC\_HAS\_128BIT)}}
\DoxyCodeLine{00176\ \textcolor{comment}{//\ \ \ \#endif}}
\DoxyCodeLine{00177\ \textcolor{comment}{//}}
\DoxyCodeLine{00178\ \textcolor{comment}{//\ \ \ Indicates\ the\ support\ for\ 128-\/bit\ atomic\ operations\ on\ an\ eastl::atomic<T>\ object.}}
\DoxyCodeLine{00179\ \textcolor{comment}{//}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00183\ \textcolor{comment}{//}}
\DoxyCodeLine{00184\ \textcolor{comment}{//\ eastl::atomic\_flag\ class\ API}}
\DoxyCodeLine{00185\ \textcolor{comment}{//}}
\DoxyCodeLine{00186\ \textcolor{comment}{//\ \ \ Unless\ otherwise\ specified\ all\ orders\ except\ read\_depends\ is\ a\ valid\ order}}
\DoxyCodeLine{00187\ \textcolor{comment}{//\ \ \ on\ the\ given\ operation.}}
\DoxyCodeLine{00188\ \textcolor{comment}{//}}
\DoxyCodeLine{00189\ \textcolor{comment}{//\ \ \ -\/\ atomic\_flag()\ \ \ \ \ :\ Initializes\ the\ flag\ to\ false.}}
\DoxyCodeLine{00190\ \textcolor{comment}{//}}
\DoxyCodeLine{00191\ \textcolor{comment}{//\ \ \ -\/\ clear(order)}}
\DoxyCodeLine{00192\ \textcolor{comment}{//\ \ \ \ \ \ \ :\ Atomically\ stores\ the\ value\ false\ to\ the\ flag.}}
\DoxyCodeLine{00193\ \textcolor{comment}{//\ \ \ \ \ \ \ :\ Valid\ orders\ are\ relaxed,\ release,\ and\ seq\_cst.}}
\DoxyCodeLine{00194\ \textcolor{comment}{//}}
\DoxyCodeLine{00195\ \textcolor{comment}{//\ \ \ -\/\ bool\ test\_and\_set(order)}}
\DoxyCodeLine{00196\ \textcolor{comment}{//\ \ \ \ \ \ \ :\ Atomically\ exchanges\ flag\ with\ true\ and\ returns\ the\ previous\ value\ that\ was\ held.}}
\DoxyCodeLine{00197\ \textcolor{comment}{//}}
\DoxyCodeLine{00198\ \textcolor{comment}{//\ \ \ -\/\ bool\ test(order)}}
\DoxyCodeLine{00199\ \textcolor{comment}{//\ \ \ \ \ \ \ :\ Atomically\ loads\ the\ flag\ value.}}
\DoxyCodeLine{00200\ \textcolor{comment}{//\ \ \ \ \ \ \ :\ Valid\ orders\ are\ relaxed,\ acquire,\ and\ seq\_cst.}}
\DoxyCodeLine{00201\ \textcolor{comment}{//}}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00205\ \textcolor{comment}{//}}
\DoxyCodeLine{00206\ \textcolor{comment}{//\ eastl::atomic\ standalone\ free\ function\ API}}
\DoxyCodeLine{00207\ \textcolor{comment}{//}}
\DoxyCodeLine{00208\ \textcolor{comment}{//\ \ \ All\ class\ methods\ have\ a\ standalone\ free\ function\ that\ takes\ a\ pointer\ to\ the}}
\DoxyCodeLine{00209\ \textcolor{comment}{//\ \ \ atomic\ object\ as\ the\ first\ argument.\ These\ functions\ just\ call\ the\ correct\ method}}
\DoxyCodeLine{00210\ \textcolor{comment}{//\ \ \ on\ the\ atomic\ object\ for\ the\ given\ operation.}}
\DoxyCodeLine{00211\ \textcolor{comment}{//\ \ \ These\ functions\ come\ in\ two\ variants,\ a\ non-\/explicit\ and\ an\ explicit\ variant}}
\DoxyCodeLine{00212\ \textcolor{comment}{//\ \ \ that\ take\ on\ the\ form\ atomic\_op()\ and\ atomic\_op\_explicit()\ respectively.}}
\DoxyCodeLine{00213\ \textcolor{comment}{//\ \ \ The\ non-\/explicit\ variants\ take\ no\ order\ arguments\ and\ thus\ are\ all\ seq\_cst.}}
\DoxyCodeLine{00214\ \textcolor{comment}{//\ \ \ The\ explicit\ variants\ take\ an\ order\ argument.}}
\DoxyCodeLine{00215\ \textcolor{comment}{//\ \ \ Only\ the\ standalone\ functions\ that\ do\ not\ have\ a\ class\ method\ equivalent\ pair\ will\ be}}
\DoxyCodeLine{00216\ \textcolor{comment}{//\ \ \ documented\ here\ which\ includes\ all\ new\ extensions\ to\ the\ std\ API.}}
\DoxyCodeLine{00217\ \textcolor{comment}{//}}
\DoxyCodeLine{00218\ \textcolor{comment}{//\ \ \ -\/\ +compiler\_barrier()}}
\DoxyCodeLine{00219\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Read-\/Write\ Compiler\ Barrier.}}
\DoxyCodeLine{00220\ \textcolor{comment}{//\ \ \ -\/\ +compiler\_barrier\_data\_dependency(const\ T\&)}}
\DoxyCodeLine{00221\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Read-\/Write\ Compiler\ Barrier.}}
\DoxyCodeLine{00222\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Applies\ a\ fake\ input\ dependency\ on\ const\ T\&\ so\ the\ compiler\ believes\ said\ variable\ is\ used.}}
\DoxyCodeLine{00223\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Useful\ for\ example\ when\ writing\ benchmark\ or\ testing\ code\ with\ local\ variables\ that\ must\ not\ get\ dead-\/store\ eliminated.}}
\DoxyCodeLine{00224\ \textcolor{comment}{//\ \ \ -\/\ +cpu\_pause()}}
\DoxyCodeLine{00225\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Prevents\ speculative\ memory\ order\ violations\ in\ spin-\/wait\ loops.}}
\DoxyCodeLine{00226\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Allows\ giving\ up\ core\ resources,\ execution\ units,\ to\ other\ threads\ while\ in\ spin-\/wait\ loops.}}
\DoxyCodeLine{00227\ \textcolor{comment}{//\ \ \ -\/\ atomic\_thread\_fence(order)}}
\DoxyCodeLine{00228\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Read\ docs\ below.}}
\DoxyCodeLine{00229\ \textcolor{comment}{//\ \ \ -\/\ atomic\_signal\_fence(order)}}
\DoxyCodeLine{00230\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Prevents\ reordering\ with\ a\ signal\ handler.}}
\DoxyCodeLine{00231\ \textcolor{comment}{//\ \ \ -\/\ +atomic\_load\_cond(const\ eastl::atomic<T>*,\ Predicate)}}
\DoxyCodeLine{00232\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ continuously\ loads\ the\ atomic\ object\ until\ Predicate\ is\ true}}
\DoxyCodeLine{00233\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ will\ properly\ ensure\ the\ spin-\/wait\ loop\ is\ optimal}}
\DoxyCodeLine{00234\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ very\ useful\ when\ needing\ to\ spin-\/wait\ for\ some\ condition\ to\ be\ true\ which\ is\ common\ is\ many\ lock-\/free\ algorithms}}
\DoxyCodeLine{00235\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Memory\ is\ affected\ according\ to\ seq\_cst\ ordering.}}
\DoxyCodeLine{00236\ \textcolor{comment}{//\ \ \ -\/\ +atomic\_load\_cond\_explicit(const\ eastl::atomic<T>*,\ Predicate,\ Order)}}
\DoxyCodeLine{00237\ \textcolor{comment}{//\ \ \ \ \ \ \ \ :\ Same\ as\ above\ but\ takes\ an\ order\ for\ how\ memory\ is\ affected}}
\DoxyCodeLine{00238\ \textcolor{comment}{//}}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00242\ \textcolor{comment}{//}}
\DoxyCodeLine{00243\ \textcolor{comment}{//\ \ \ Deviations\ from\ the\ standard.\ This\ does\ not\ include\ new\ features\ added:}}
\DoxyCodeLine{00244\ \textcolor{comment}{//}}
\DoxyCodeLine{00245\ \textcolor{comment}{//\ 1.}}
\DoxyCodeLine{00246\ \textcolor{comment}{//\ \ \ Description:\ Atomics\ are\ always\ lock\ free}}
\DoxyCodeLine{00247\ \textcolor{comment}{//\ \ \ Reasoning\ \ :\ We\ don't\ want\ people\ to\ fall\ into\ performance\ traps\ where\ implicit\ locking}}
\DoxyCodeLine{00248\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ is\ done.\ If\ your\ user\ defined\ type\ is\ large\ enough\ to\ not\ support\ atomic}}
\DoxyCodeLine{00249\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ instructions\ then\ your\ user\ code\ should\ do\ the\ locking.}}
\DoxyCodeLine{00250\ \textcolor{comment}{//}}
\DoxyCodeLine{00251\ \textcolor{comment}{//\ 2.}}
\DoxyCodeLine{00252\ \textcolor{comment}{//\ \ \ Description:\ Atomic\ objects\ can\ not\ be\ volatile}}
\DoxyCodeLine{00253\ \textcolor{comment}{//\ \ \ Reasoning\ \ :\ Volatile\ objects\ do\ not\ make\ sense\ in\ the\ context\ of\ eastl::atomic<T>.}}
\DoxyCodeLine{00254\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Use\ the\ given\ memory\ orders\ to\ get\ the\ ordering\ you\ need.}}
\DoxyCodeLine{00255\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Atomic\ objects\ have\ to\ become\ visible\ on\ the\ bus.\ See\ below\ for\ details.}}
\DoxyCodeLine{00256\ \textcolor{comment}{//}}
\DoxyCodeLine{00257\ \textcolor{comment}{//\ 3.}}
\DoxyCodeLine{00258\ \textcolor{comment}{//\ \ \ Description:\ Consume\ memory\ order\ is\ not\ supported}}
\DoxyCodeLine{00259\ \textcolor{comment}{//\ \ \ Reasoning\ \ :\ See\ below\ for\ the\ reasoning.}}
\DoxyCodeLine{00260\ \textcolor{comment}{//}}
\DoxyCodeLine{00261\ \textcolor{comment}{//\ 4.}}
\DoxyCodeLine{00262\ \textcolor{comment}{//\ \ \ Description:\ ATOMIC\_INIT()\ macros\ and\ the\ ATOMIC\_LOCK\_FREE\ macros\ are\ not\ implemented}}
\DoxyCodeLine{00263\ \textcolor{comment}{//\ \ \ Reasoning\ \ :\ Use\ the\ is\_lock\_free()\ method\ instead\ of\ the\ macros.}}
\DoxyCodeLine{00264\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ATOMIC\_INIT()\ macros\ aren't\ needed\ since\ the\ default\ constructor\ value\ initializes.}}
\DoxyCodeLine{00265\ \textcolor{comment}{//}}
\DoxyCodeLine{00266\ \textcolor{comment}{//\ 5.}}
\DoxyCodeLine{00267\ \textcolor{comment}{//\ \ \ Description:\ compare\_exchange\ failure\ memory\ order\ cannot\ be\ stronger\ than\ success\ memory\ order}}
\DoxyCodeLine{00268\ \textcolor{comment}{//\ \ \ Reasoning\ \ :\ Besides\ the\ argument\ that\ it\ ideologically\ does\ not\ make\ sense\ that\ a\ failure}}
\DoxyCodeLine{00269\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ of\ the\ atomic\ operation\ shouldn't\ have\ a\ stricter\ ordering\ guarantee\ than\ the}}
\DoxyCodeLine{00270\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ success\ of\ it;\ if\ that\ is\ required\ then\ just\ make\ the\ whole\ operation\ stronger.}}
\DoxyCodeLine{00271\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ This\ ability\ was\ added\ and\ allowed\ in\ C++17\ only\ which\ makes\ supporting\ multiple}}
\DoxyCodeLine{00272\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ C++\ versions\ harder\ when\ using\ the\ compiler\ provided\ intrinsics\ since\ their\ behaviour}}
\DoxyCodeLine{00273\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ is\ reliant\ on\ the\ C++\ version\ being\ compiled.\ Also\ makes\ it\ harder\ to\ reason\ about\ code}}
\DoxyCodeLine{00274\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ using\ these\ atomic\ ops\ since\ C++\ versions\ vary\ the\ behaviour.\ We\ have\ also\ noticed}}
\DoxyCodeLine{00275\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ that\ versions\ of\ compilers\ that\ say\ they\ support\ C++17\ do\ not\ properly\ adhere\ to\ this}}
\DoxyCodeLine{00276\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ new\ requirement\ in\ their\ intrinsics.\ Thus\ we\ will\ not\ support\ this.}}
\DoxyCodeLine{00277\ \textcolor{comment}{//}}
\DoxyCodeLine{00278\ \textcolor{comment}{//\ 6.}}
\DoxyCodeLine{00279\ \textcolor{comment}{//\ \ \ Description:\ All\ memory\ orders\ are\ distinct\ types\ instead\ of\ enum\ values}}
\DoxyCodeLine{00280\ \textcolor{comment}{//\ \ \ Reasoning\ \ :\ This\ will\ not\ affect\ how\ the\ API\ is\ used\ in\ user\ code.}}
\DoxyCodeLine{00281\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ It\ allows\ us\ to\ statically\ assert\ on\ invalid\ memory\ orders\ since\ they\ are\ compile-\/time\ types}}
\DoxyCodeLine{00282\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ instead\ of\ potentially\ runtime\ enum\ values.}}
\DoxyCodeLine{00283\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Allows\ for\ more\ efficient\ code\ gen\ without\ the\ use\ of\ switch\ statements\ or\ if-\/else\ conditionals}}
\DoxyCodeLine{00284\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ on\ the\ memory\ order\ enum\ values\ on\ compilers\ that\ do\ not\ provide\ intrinsics\ that\ take\ in\ a}}
\DoxyCodeLine{00285\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ memory\ order,\ such\ as\ MSVC,\ especially\ in\ debug\ and\ debug-\/opt\ builds.}}
\DoxyCodeLine{00286\ \textcolor{comment}{//}}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00290\ \textcolor{comment}{//}}
\DoxyCodeLine{00291\ \textcolor{comment}{//\ \ \ ********\ DISCLAIMER\ ********}}
\DoxyCodeLine{00292\ \textcolor{comment}{//}}
\DoxyCodeLine{00293\ \textcolor{comment}{//\ \ \ This\ documentation\ is\ not\ meant\ to\ provide\ rigorous\ proofs\ on\ the\ memory\ models}}
\DoxyCodeLine{00294\ \textcolor{comment}{//\ \ \ of\ specific\ architectures\ or\ the\ C++\ memory\ model\ introduced\ in\ C++11.\ It\ is\ not}}
\DoxyCodeLine{00295\ \textcolor{comment}{//\ \ \ meant\ to\ provide\ formal\ mathematical\ definitions\ and\ logic\ that\ shows\ that\ a\ given}}
\DoxyCodeLine{00296\ \textcolor{comment}{//\ \ \ implementation\ adheres\ to\ the\ C++\ memory\ model.\ This\ isn't\ meant\ to\ be\ some\ infallible}}
\DoxyCodeLine{00297\ \textcolor{comment}{//\ \ \ oracle\ on\ memory\ models,\ barriers,\ observers,\ and\ architecture\ implementation\ details.}}
\DoxyCodeLine{00298\ \textcolor{comment}{//\ \ \ What\ I\ do\ hope\ a\ reader\ gets\ out\ of\ this\ is\ the\ following.\ An\ understanding\ of\ the\ C++}}
\DoxyCodeLine{00299\ \textcolor{comment}{//\ \ \ memory\ model\ and\ how\ that\ relates\ to\ implementations\ on\ various\ architectures.\ Various}}
\DoxyCodeLine{00300\ \textcolor{comment}{//\ \ \ phenomena\ and\ ways\ that\ compilers\ and\ architectures\ can\ steer\ away\ from\ a\ sequentially}}
\DoxyCodeLine{00301\ \textcolor{comment}{//\ \ \ consistent\ system.\ To\ provide\ examples\ on\ how\ to\ use\ this\ library\ with\ common\ patterns}}
\DoxyCodeLine{00302\ \textcolor{comment}{//\ \ \ that\ will\ be\ seen\ in\ many\ code\ bases.\ Lastly\ I\ would\ like\ to\ provide\ insight\ and}}
\DoxyCodeLine{00303\ \textcolor{comment}{//\ \ \ further\ readings\ into\ the\ lesser\ known\ topics\ that\ aren't\ shared\ outside\ people}}
\DoxyCodeLine{00304\ \textcolor{comment}{//\ \ \ who\ live\ in\ this\ space\ and\ why\ certain\ things\ are\ done\ the\ way\ they\ are}}
\DoxyCodeLine{00305\ \textcolor{comment}{//\ \ \ such\ as\ cumulativity\ of\ memory\ barriers\ as\ one\ example.\ Sometimes\ specifying\ barriers}}
\DoxyCodeLine{00306\ \textcolor{comment}{//\ \ \ as\ LDLD/LDST/STST/STLD\ doesn't\ actually\ cut\ it,\ and\ finer\ grain\ semantics\ are\ needed}}
\DoxyCodeLine{00307\ \textcolor{comment}{//\ \ \ to\ describe\ cumulativity\ of\ memory\ barriers.}}
\DoxyCodeLine{00308\ \textcolor{comment}{//}}
\DoxyCodeLine{00309\ \textcolor{comment}{//\ \ \ ********\ Layout\ of\ the\ Documentation\ ********}}
\DoxyCodeLine{00310\ \textcolor{comment}{//}}
\DoxyCodeLine{00311\ \textcolor{comment}{//\ \ \ This\ document\ will\ first\ go\ through\ a\ variety\ of\ different\ hardware\ architectures\ with\ examples\ of\ the\ various\ kinds\ of}}
\DoxyCodeLine{00312\ \textcolor{comment}{//\ \ \ reordering\ that\ is\ allowed\ by\ these\ architectures.\ We\ will\ use\ the\ memory\ barriers\ provided\ by\ the\ hardware\ to\ "{}fix"{}\ these}}
\DoxyCodeLine{00313\ \textcolor{comment}{//\ \ \ examples.}}
\DoxyCodeLine{00314\ \textcolor{comment}{//\ \ \ Then\ we\ will\ introduce\ the\ C++\ memory\ model\ and\ revisit\ the\ examples\ using\ the\ platform\ agnostic\ abstract\ memory\ model\ to\ "{}fix"{}}}
\DoxyCodeLine{00315\ \textcolor{comment}{//\ \ \ them.}}
\DoxyCodeLine{00316\ \textcolor{comment}{//\ \ \ The\ hope\ here\ is\ that\ we\ get\ a\ sense\ of\ the\ various\ types\ of\ architectures\ and\ weak\ memory\ consistency\ provided\ by\ them\ and\ thus}}
\DoxyCodeLine{00317\ \textcolor{comment}{//\ \ \ an\ appreciation\ for\ the\ design\ of\ the\ C++\ abstract\ memory\ model.}}
\DoxyCodeLine{00318\ \textcolor{comment}{//}}
\DoxyCodeLine{00319\ \textcolor{comment}{//\ \ \ ********\ REFERENCES\ ********}}
\DoxyCodeLine{00320\ \textcolor{comment}{//\ \ \ [1]\ Dekker's\ mutual\ exclusion\ algorithm\ made\ RW-\/safe}}
\DoxyCodeLine{00321\ \textcolor{comment}{//\ \ \ [2]\ Handling\ Memory\ Ordering\ in\ Multithreaded\ Applications\ with\ Oracle\ Solaris}}
\DoxyCodeLine{00322\ \textcolor{comment}{//\ \ \ [3]\ Evaluating\ the\ Cost\ of\ Atomic\ Operations\ on\ Modern\ Architectures}}
\DoxyCodeLine{00323\ \textcolor{comment}{//\ \ \ [4]\ A\ Tutorial\ Introduction\ to\ the\ ARM\ and\ POWER\ Relaxed\ Memory\ Models}}
\DoxyCodeLine{00324\ \textcolor{comment}{//\ \ \ [5]\ Memory\ Barriers:\ a\ Hardware\ View\ for\ Software\ Hackers}}
\DoxyCodeLine{00325\ \textcolor{comment}{//\ \ \ [6]\ Memory\ Model\ =\ Instruction\ Reordering\ +\ Store\ Atomicity}}
\DoxyCodeLine{00326\ \textcolor{comment}{//\ \ \ [7]\ ArMOR:\ Defending\ Against\ Memory\ Consistency\ Model\ Mismatches\ in\ Heterogeneous\ Architectures}}
\DoxyCodeLine{00327\ \textcolor{comment}{//\ \ \ [8]\ Weak\ Memory\ Models:\ Balancing\ Definitional\ Simplicity\ and\ Implementation\ Flexibility}}
\DoxyCodeLine{00328\ \textcolor{comment}{//\ \ \ [9]\ Repairing\ Sequential\ Consistency\ in\ C/C++11}}
\DoxyCodeLine{00329\ \textcolor{comment}{//\ \ \ [10]\ A\ high-\/level\ operational\ semantics\ for\ hardware\ weak\ memory\ models}}
\DoxyCodeLine{00330\ \textcolor{comment}{//\ \ \ [11]\ x86-\/TSO:\ A\ Rigorous\ and\ Usable\ Programmer's\ Model\ for\ x86\ Multiprocessors}}
\DoxyCodeLine{00331\ \textcolor{comment}{//\ \ \ [12]\ Simplifying\ ARM\ Concurrency:\ Multicopy-\/Atomic\ Axiomatic\ and\ Operational\ Models\ for\ ARMv8}}
\DoxyCodeLine{00332\ \textcolor{comment}{//\ \ \ [13]\ Mixed-\/size\ Concurrency:\ ARM,\ POWER,\ C/C++11,\ and\ SC}}
\DoxyCodeLine{00333\ \textcolor{comment}{//\ \ \ [14]\ P0668R4:\ Revising\ the\ C++\ memory\ model}}
\DoxyCodeLine{00334\ \textcolor{comment}{//\ \ \ [15]\ Constructing\ a\ Weak\ Memory\ Model}}
\DoxyCodeLine{00335\ \textcolor{comment}{//\ \ \ [16]\ The\ Superfluous\ Load\ Queue}}
\DoxyCodeLine{00336\ \textcolor{comment}{//\ \ \ [17]\ P0190R1:\ Proposal\ for\ New\ memory\_order\_consume\ Definition}}
\DoxyCodeLine{00337\ \textcolor{comment}{//}}
\DoxyCodeLine{00338\ \textcolor{comment}{//\ \ \ ********\ What\ does\ it\ mean\ to\ be\ Atomic?\ ********}}
\DoxyCodeLine{00339\ \textcolor{comment}{//}}
\DoxyCodeLine{00340\ \textcolor{comment}{//\ \ \ The\ word\ atomic\ has\ been\ overloaded\ and\ can\ mean\ a\ lot\ of\ different\ things\ depending\ on\ the\ context,}}
\DoxyCodeLine{00341\ \textcolor{comment}{//\ \ \ so\ let's\ digest\ it.}}
\DoxyCodeLine{00342\ \textcolor{comment}{//}}
\DoxyCodeLine{00343\ \textcolor{comment}{//\ \ \ The\ first\ attribute\ for\ something\ to\ be\ atomic\ is\ that\ concurrent\ stores\ and\ loads}}
\DoxyCodeLine{00344\ \textcolor{comment}{//\ \ \ must\ not\ tear\ or\ shear.\ This\ means\ if\ two\ threads\ write\ 0x01\ and\ 0x02\ at\ the\ same\ time}}
\DoxyCodeLine{00345\ \textcolor{comment}{//\ \ \ then\ the\ only\ values\ that\ should\ ever\ be\ observed\ is\ 0x01\ or\ 0x02.\ We\ can\ only\ see}}
\DoxyCodeLine{00346\ \textcolor{comment}{//\ \ \ the\ whole\ write\ of\ 0x01\ or\ 0x02,\ not\ 0x03\ as\ an\ example.\ Many\ algorithms\ rely\ on}}
\DoxyCodeLine{00347\ \textcolor{comment}{//\ \ \ this\ property;\ only\ very\ few\ such\ a\ Dekker's\ algorithm\ for\ mutual\ exclusion\ don't.}}
\DoxyCodeLine{00348\ \textcolor{comment}{//\ \ \ Well\ actually\ a\ recent\ paper,\ [1],\ showed\ that\ Dekker's\ isn't\ safe\ without\ atomic}}
\DoxyCodeLine{00349\ \textcolor{comment}{//\ \ \ loads\ and\ stores\ so\ this\ property\ is\ pretty\ fundamental\ and\ also\ hard\ to\ prove\ that}}
\DoxyCodeLine{00350\ \textcolor{comment}{//\ \ \ your\ algorithm\ is\ safe\ without\ this\ property\ on\ loads\ and\ stores.}}
\DoxyCodeLine{00351\ \textcolor{comment}{//}}
\DoxyCodeLine{00352\ \textcolor{comment}{//\ \ \ We\ need\ to\ ensure\ the\ compiler\ emits\ a\ single\ load\ instruction.}}
\DoxyCodeLine{00353\ \textcolor{comment}{//\ \ \ If\ we\ are\ doing\ 64-\/bit\ loads\ on\ a\ 32-\/bit\ platform,\ we\ need\ to\ ensure\ the\ load\ is\ one}}
\DoxyCodeLine{00354\ \textcolor{comment}{//\ \ \ instruction\ instead\ of\ 2\ 32-\/bit\ loads\ into\ two\ registers.}}
\DoxyCodeLine{00355\ \textcolor{comment}{//\ \ \ Another\ example\ is\ if\ we\ have\ this\ struct,\ struct\ \{\ int32\_t\ i;\ int32\_t\ k;\ \},\ even\ on}}
\DoxyCodeLine{00356\ \textcolor{comment}{//\ \ \ a\ 64-\/bit\ system\ we\ have\ to\ ensure\ the\ compiler\ does\ one\ 64-\/bit\ load\ and\ not\ two}}
\DoxyCodeLine{00357\ \textcolor{comment}{//\ \ \ 32-\/bit\ loads\ for\ each\ individual\ member.}}
\DoxyCodeLine{00358\ \textcolor{comment}{//}}
\DoxyCodeLine{00359\ \textcolor{comment}{//\ \ \ We\ also\ need\ to\ ensure\ the\ correct\ instruction\ is\ emitted.\ A\ general\ load\ instruction}}
\DoxyCodeLine{00360\ \textcolor{comment}{//\ \ \ to\ do\ a\ 64-\/bit\ load\ on\ a\ 32-\/bit\ platform\ may\ perform\ a\ 64-\/bit\ load\ but\ it\ may\ not}}
\DoxyCodeLine{00361\ \textcolor{comment}{//\ \ \ be\ atomic,\ it\ may\ be\ turned\ into\ two\ 32-\/bit\ loads\ behind\ the\ scenes\ in\ the\ cpu.}}
\DoxyCodeLine{00362\ \textcolor{comment}{//\ \ \ For\ example\ on\ ARMv7\ we\ would\ have\ to\ use\ ldrexd\ not\ ldrd\ for\ 64-\/bit\ loads}}
\DoxyCodeLine{00363\ \textcolor{comment}{//\ \ \ on\ a\ 32-\/bit\ ARMv7\ core.}}
\DoxyCodeLine{00364\ \textcolor{comment}{//}}
\DoxyCodeLine{00365\ \textcolor{comment}{//\ \ \ An\ operation\ may\ be\ considered\ atomic\ if\ multiple\ sub-\/operations\ are\ done\ as\ one}}
\DoxyCodeLine{00366\ \textcolor{comment}{//\ \ \ transactional\ unit.\ This\ is\ commonly\ known\ as\ a\ Read-\/Modify-\/Write,\ RMW,\ operation.}}
\DoxyCodeLine{00367\ \textcolor{comment}{//\ \ \ Take\ a\ simple\ add\ operation;\ it\ is\ actually\ a\ load\ from\ memory\ into\ a\ register,}}
\DoxyCodeLine{00368\ \textcolor{comment}{//\ \ \ a\ modification\ of\ said\ register\ and\ then\ a\ store\ back\ to\ memory.\ If\ two\ threads}}
\DoxyCodeLine{00369\ \textcolor{comment}{//\ \ \ concurrently\ execute\ this\ add\ operation\ on\ the\ same\ memory\ location;\ any\ interleaving}}
\DoxyCodeLine{00370\ \textcolor{comment}{//\ \ \ of\ the\ 3\ sub-\/operations\ is\ possible.\ It\ is\ possible\ that\ if\ the\ initial\ value\ is\ 0,}}
\DoxyCodeLine{00371\ \textcolor{comment}{//\ \ \ the\ result\ may\ be\ 1\ because\ each\ thread\ executed\ in\ lockstep\ both\ loading\ 0,\ adding\ 1}}
\DoxyCodeLine{00372\ \textcolor{comment}{//\ \ \ and\ then\ storing\ 1.\ A\ RMW\ operation\ may\ be\ considered\ atomic\ if\ the\ whole\ sequence\ of}}
\DoxyCodeLine{00373\ \textcolor{comment}{//\ \ \ sub-\/operations\ are\ serialized\ as\ one\ transactional\ unit.}}
\DoxyCodeLine{00374\ \textcolor{comment}{//}}
\DoxyCodeLine{00375\ \textcolor{comment}{//\ \ \ Atomicity\ may\ also\ refer\ to\ the\ order\ in\ which\ memory\ operations\ are\ observed\ and\ the}}
\DoxyCodeLine{00376\ \textcolor{comment}{//\ \ \ dependencies\ between\ memory\ operations\ to\ different\ memory\ locations.\ As\ a\ quick\ example}}
\DoxyCodeLine{00377\ \textcolor{comment}{//\ \ \ into\ the\ very\ thing\ we\ will\ be\ deep\ diving\ into\ that\ is\ not\ very\ intuitive.\ If\ I\ do,\ [STORE(A,\ 2);\ STORE(B,\ 1);],}}
\DoxyCodeLine{00378\ \textcolor{comment}{//\ \ \ in\ one\ thread\ and\ another\ thread\ does,\ [r0\ =\ LOAD(B);\ r1\ =\ LOAD(A);];\ if\ r0\ ==\ 1,\ thus\ we\ observed}}
\DoxyCodeLine{00379\ \textcolor{comment}{//\ \ \ the\ store\ to\ B,\ will\ we\ observe\ r1\ ==\ 2.\ Our\ intuition\ tells\ us\ that\ well\ A\ was\ stored}}
\DoxyCodeLine{00380\ \textcolor{comment}{//\ \ \ first\ and\ then\ B,\ so\ if\ I\ read\ the\ new\ value\ of\ B\ then\ I\ must\ also\ read\ the\ new\ value}}
\DoxyCodeLine{00381\ \textcolor{comment}{//\ \ \ of\ A\ since\ the\ store\ to\ A\ happened\ before\ B\ so\ if\ I\ can\ see\ B\ then\ I\ must\ be\ able\ to}}
\DoxyCodeLine{00382\ \textcolor{comment}{//\ \ \ see\ everything\ before\ B\ which\ includes\ A.}}
\DoxyCodeLine{00383\ \textcolor{comment}{//\ \ \ This\ highlights\ the\ ordering\ of\ memory\ operations\ and\ why\ memory\ barriers\ and\ memory}}
\DoxyCodeLine{00384\ \textcolor{comment}{//\ \ \ models\ are\ so\ heavily\ attached\ to\ atomic\ operations\ because\ one\ could\ classify\ something}}
\DoxyCodeLine{00385\ \textcolor{comment}{//\ \ \ is\ atomic\ if\ the\ dependency\ highlighted\ in\ the\ above\ example\ is\ allowed\ to\ be\ maintained.}}
\DoxyCodeLine{00386\ \textcolor{comment}{//}}
\DoxyCodeLine{00387\ \textcolor{comment}{//\ \ \ This\ is\ what\ people\ mean\ when\ you\ hear\ that\ volatile\ does\ NOT\ mean\ atomicity\ of\ the\ operation.}}
\DoxyCodeLine{00388\ \textcolor{comment}{//\ \ \ Usually\ people\ imply\ a\ lot\ of\ implicit\ assumptions\ when\ they\ mark\ a\ variable\ as\ volatile.}}
\DoxyCodeLine{00389\ \textcolor{comment}{//\ \ \ All\ volatile\ gives\ us\ is\ the\ ability\ to\ tell\ the\ compiler\ it\ may\ not\ assume\ anything}}
\DoxyCodeLine{00390\ \textcolor{comment}{//\ \ \ about\ the\ state\ of\ that\ memory\ location.\ This\ means\ the\ compiler\ must\ always\ emit\ a\ load}}
\DoxyCodeLine{00391\ \textcolor{comment}{//\ \ \ or\ store\ instruction,\ cannot\ perform\ constant\ folding,\ dead-\/store\ elimination,\ or}}
\DoxyCodeLine{00392\ \textcolor{comment}{//\ \ \ do\ any\ sort\ of\ code\ movement\ on\ volatile\ variables.}}
\DoxyCodeLine{00393\ \textcolor{comment}{//}}
\DoxyCodeLine{00394\ \textcolor{comment}{//\ \ \ ********\ Preliminary\ Basics\ ********}}
\DoxyCodeLine{00395\ \textcolor{comment}{//}}
\DoxyCodeLine{00396\ \textcolor{comment}{//\ \ \ It\ is\ expected\ that\ the\ reader\ understands\ what\ a\ cache\ is,\ how\ it\ is\ organized\ and\ how\ data}}
\DoxyCodeLine{00397\ \textcolor{comment}{//\ \ \ is\ chunked\ into\ cachelines.\ It\ is\ helpful\ if\ the\ reader\ understands\ basic\ cache\ coherency}}
\DoxyCodeLine{00398\ \textcolor{comment}{//\ \ \ protocols\ such\ as\ MSI\ or\ MESI.}}
\DoxyCodeLine{00399\ \textcolor{comment}{//\ \ \ It\ is\ expected\ the\ reader\ understands\ alignment,\ especially\ natural\ alignment}}
\DoxyCodeLine{00400\ \textcolor{comment}{//\ \ \ of\ the\ processor\ and\ why\ alignment\ is\ important\ for\ data\ access.}}
\DoxyCodeLine{00401\ \textcolor{comment}{//\ \ \ The\ reader\ should\ have\ some\ understanding\ of\ how\ a\ processor\ executes\ instructions,}}
\DoxyCodeLine{00402\ \textcolor{comment}{//\ \ \ basics\ of\ what\ Out-\/of-\/Order\ execution\ means\ and\ basics\ of\ what\ speculative\ execution\ means.}}
\DoxyCodeLine{00403\ \textcolor{comment}{//\ \ \ It\ is\ expected\ that\ the\ reader\ has\ an\ understanding\ of\ threading,\ multi-\/threaded\ programming}}
\DoxyCodeLine{00404\ \textcolor{comment}{//\ \ \ and\ the\ use\ of\ concurrency\ primitives\ such\ as\ mutexes.}}
\DoxyCodeLine{00405\ \textcolor{comment}{//\ \ \ Memory\ Barrier,\ Barrier,\ Memory\ Fence\ and\ Fence\ are\ all\ interchangeable\ synonyms.}}
\DoxyCodeLine{00406\ \textcolor{comment}{//}}
\DoxyCodeLine{00407\ \textcolor{comment}{//\ \ \ Independent\ memory\ operations\ can\ be\ performed\ or\ observed,\ depending\ on\ your\ perspective,}}
\DoxyCodeLine{00408\ \textcolor{comment}{//\ \ \ in\ any\ order\ as\ long\ as\ the\ local\ cpu\ thinks\ its\ execution\ is\ happening\ in\ program\ order.}}
\DoxyCodeLine{00409\ \textcolor{comment}{//\ \ \ This\ can\ be\ a\ problem\ for\ inter-\/cpu\ communications\ and\ thus\ we\ need\ some\ way\ to\ enforce}}
\DoxyCodeLine{00410\ \textcolor{comment}{//\ \ \ that\ the\ compiler\ does\ not\ reorder\ instructions\ and\ that\ the\ cpu\ also\ does\ not\ reorder}}
\DoxyCodeLine{00411\ \textcolor{comment}{//\ \ \ instructions.\ This\ is\ what\ a\ barrier\ is,\ it\ is\ an\ enforcement\ of\ ordering\ on\ memory\ instructions,}}
\DoxyCodeLine{00412\ \textcolor{comment}{//\ \ \ so\ as\ the\ name\ suggests\ a\ barrier.\ Barriers\ can\ be\ one-\/sided\ or\ both-\/sided\ which\ means}}
\DoxyCodeLine{00413\ \textcolor{comment}{//\ \ \ the\ barrier\ enforces\ a\ partial\ order\ above\ or\ below\ or\ on\ both\ sides\ of\ said\ barrier.}}
\DoxyCodeLine{00414\ \textcolor{comment}{//}}
\DoxyCodeLine{00415\ \textcolor{comment}{//\ \ \ Processors\ will\ use\ tricks\ such\ as\ out-\/of-\/order\ execution,\ memory\ instruction\ buffering\ and}}
\DoxyCodeLine{00416\ \textcolor{comment}{//\ \ \ combining,\ speculative\ loads\ and\ speculative\ execution,\ branch\ prediction\ and\ many\ types\ of\ caching\ even}}
\DoxyCodeLine{00417\ \textcolor{comment}{//\ \ \ in\ various\ interconnects\ from\ the\ cpu\ to\ the\ memory\ itself.\ One\ key\ thing\ to\ note\ is\ that\ cpus}}
\DoxyCodeLine{00418\ \textcolor{comment}{//\ \ \ do\ not\ physically\ reorder\ the\ instruction\ stream.\ Instructions\ are\ dispatched\ and\ retired}}
\DoxyCodeLine{00419\ \textcolor{comment}{//\ \ \ in-\/order\ but\ executed\ out-\/of-\/order.\ Memory\ barriers\ will\ prevent\ these\ tricks\ from\ happening}}
\DoxyCodeLine{00420\ \textcolor{comment}{//\ \ \ by\ controlling\ the\ interaction\ of\ multiple\ cpus.}}
\DoxyCodeLine{00421\ \textcolor{comment}{//}}
\DoxyCodeLine{00422\ \textcolor{comment}{//\ \ \ Compilers\ will\ morph\ your\ code\ and\ physically\ move\ instructions\ around\ as\ long\ as\ the\ program}}
\DoxyCodeLine{00423\ \textcolor{comment}{//\ \ \ has\ the\ same\ observed\ behaviour.\ This\ is\ becoming\ increasingly\ true\ with\ more\ optimization\ techniques}}
\DoxyCodeLine{00424\ \textcolor{comment}{//\ \ \ such\ as\ Link\ Time\ Optimization\ becoming\ the\ norm\ where\ once\ people\ assumed\ compilers\ couldn't\ assume}}
\DoxyCodeLine{00425\ \textcolor{comment}{//\ \ \ something\ outside\ the\ given\ TU\ and\ now\ because\ they\ have\ the\ whole\ program\ view\ they\ know\ everything.}}
\DoxyCodeLine{00426\ \textcolor{comment}{//\ \ \ This\ means\ the\ compiler\ does\ indeed\ alter\ the\ instruction\ stream}}
\DoxyCodeLine{00427\ \textcolor{comment}{//\ \ \ and\ compiler\ barriers\ are\ a\ way\ to\ tell\ them\ to\ not\ move\ any\ memory\ instructions\ across\ the\ barrier.}}
\DoxyCodeLine{00428\ \textcolor{comment}{//\ \ \ This\ does\ not\ prevent\ a\ compiler\ from\ doing\ optimizations\ such\ as\ constant\ folding,\ merging\ of}}
\DoxyCodeLine{00429\ \textcolor{comment}{//\ \ \ overlapping\ loads,\ or\ even\ dead\ store\ elimination.\ Compiler\ barriers\ are\ also\ very\ cheap\ and}}
\DoxyCodeLine{00430\ \textcolor{comment}{//\ \ \ have\ zero\ impact\ on\ anything\ that\ the\ compiler\ knows\ isn't\ visible\ in\ memory\ such\ as\ local\ variables}}
\DoxyCodeLine{00431\ \textcolor{comment}{//\ \ \ whose\ addresses\ do\ not\ escape\ the\ function\ even\ if\ their\ address\ is\ taken.\ You\ can\ think\ of\ it}}
\DoxyCodeLine{00432\ \textcolor{comment}{//\ \ \ in\ terms\ of\ a\ sequence\ point\ as\ used\ with\ "{}volatile"{}\ qualified\ variables\ to\ denote\ a\ place\ in\ code\ where}}
\DoxyCodeLine{00433\ \textcolor{comment}{//\ \ \ things\ must\ be\ stable\ and\ the\ compiler\ doesn't\ cache\ any\ variables\ in\ registers\ or\ do\ any\ reordering.}}
\DoxyCodeLine{00434\ \textcolor{comment}{//}}
\DoxyCodeLine{00435\ \textcolor{comment}{//\ \ \ Memory\ Barriers\ come\ in\ many\ flavours\ that\ instill\ a\ partial\ or\ full\ ordering\ on\ memory\ operations.}}
\DoxyCodeLine{00436\ \textcolor{comment}{//\ \ \ Some\ memory\ operations\ themselves\ have\ implicit\ ordering\ guarantees\ already,\ for\ example}}
\DoxyCodeLine{00437\ \textcolor{comment}{//\ \ \ Total-\/Store\ Order,\ TSO,\ architectures\ like\ x86\ guarantee\ that\ a\ store\ operation\ cannot\ be\ reordered\ with\ a}}
\DoxyCodeLine{00438\ \textcolor{comment}{//\ \ \ previous\ store\ operation\ thus\ a\ memory\ barrier\ that\ only\ orders\ stores\ is\ not\ needed}}
\DoxyCodeLine{00439\ \textcolor{comment}{//\ \ \ on\ this\ architecture\ other\ than\ ensuring\ the\ compiler\ doesn't\ do\ any\ shenanigans.}}
\DoxyCodeLine{00440\ \textcolor{comment}{//\ \ \ Considering\ we\ have\ 4\ permutations\ of\ memory\ operations;\ a\ common\ way\ to\ describe\ an\ ordering}}
\DoxyCodeLine{00441\ \textcolor{comment}{//\ \ \ is\ via\ Load-\/Load/LDLD,\ Load-\/Store/LDST,\ Store-\/Store/STST\ or\ Store-\/Load/STLD\ notation.\ You\ read\ this}}
\DoxyCodeLine{00442\ \textcolor{comment}{//\ \ \ notation\ as\ follows;\ STLD\ memory\ barrier\ means\ a\ load\ cannot\ be\ reordered\ with\ a\ previous\ store.}}
\DoxyCodeLine{00443\ \textcolor{comment}{//\ \ \ For\ example,\ on\ TSO\ architecture\ we\ can\ say\ all\ stores\ provide\ a\ STST\ memory\ barrier,}}
\DoxyCodeLine{00444\ \textcolor{comment}{//\ \ \ since\ a\ store\ cannot\ be\ reordered\ with\ a\ previous\ store.}}
\DoxyCodeLine{00445\ \textcolor{comment}{//}}
\DoxyCodeLine{00446\ \textcolor{comment}{//\ \ \ Memory\ Barriers\ in\ itself\ are\ not\ a\ magic\ bullet,\ they\ come\ with\ caveats\ that\ must\ be\ known.}}
\DoxyCodeLine{00447\ \textcolor{comment}{//\ \ \ Each\ cpu\ architecture\ also\ has\ its\ own\ flavours\ and\ guarantees\ provided\ by\ said\ memory\ barriers.}}
\DoxyCodeLine{00448\ \textcolor{comment}{//\ \ \ There\ is\ no\ guarantee\ that\ memory\ instructions\ specified\ before\ a\ memory\ barrier\ will\ complete,}}
\DoxyCodeLine{00449\ \textcolor{comment}{//\ \ \ be\ written\ to\ memory\ or\ fully\ propagated\ throughout\ the\ rest\ of\ the\ system,\ when\ the\ memory\ barrier}}
\DoxyCodeLine{00450\ \textcolor{comment}{//\ \ \ instruction\ completes.\ The\ memory\ barrier\ creates\ a\ point\ in\ that\ local\ cpus\ queue\ of\ memory\ instructions}}
\DoxyCodeLine{00451\ \textcolor{comment}{//\ \ \ whereby\ they\ must\ not\ cross.\ There\ is\ no\ guarantee\ that\ using\ a\ memory\ barrier\ on\ one\ cpu\ will\ have}}
\DoxyCodeLine{00452\ \textcolor{comment}{//\ \ \ any\ effect\ at\ all\ on\ another\ remote\ cpu's\ observed\ view\ of\ memory.\ This\ also\ implies\ that\ executing}}
\DoxyCodeLine{00453\ \textcolor{comment}{//\ \ \ a\ memory\ barrier\ does\ not\ hinder,\ incur,\ stall\ or\ enforce\ any\ other\ cpus\ to\ serialize\ with\ each\ other\ cpu.}}
\DoxyCodeLine{00454\ \textcolor{comment}{//\ \ \ In\ order\ for\ a\ remote\ cpu\ to\ observe\ the\ correct\ effects\ it\ must\ also\ use\ a\ matching\ memory\ barrier.}}
\DoxyCodeLine{00455\ \textcolor{comment}{//\ \ \ This\ means\ code\ communicating\ in\ 2\ threads\ through\ memory\ must\ both\ be\ employing\ the\ use\ of\ memory\ barriers.}}
\DoxyCodeLine{00456\ \textcolor{comment}{//\ \ \ For\ example,\ a\ store\ memory\ barrier\ that\ only\ orders\ stores,\ STST,\ in\ one\ thread\ must\ be\ paired\ with\ a\ load\ memory\ barrier}}
\DoxyCodeLine{00457\ \textcolor{comment}{//\ \ \ that\ only\ orders\ loads,\ LDLD,\ in\ the\ other\ thread\ trying\ to\ observe\ those\ stores\ in\ the\ correct\ order.}}
\DoxyCodeLine{00458\ \textcolor{comment}{//}}
\DoxyCodeLine{00459\ \textcolor{comment}{//\ \ \ ********\ Memory\ Types\ \&\&\ Devices\ ********}}
\DoxyCodeLine{00460\ \textcolor{comment}{//}}
\DoxyCodeLine{00461\ \textcolor{comment}{//\ \ \ eastl::atomic<T>\ and\ accompanying\ memory\ barriers\ ONLY\ ORDER\ MEMORY\ to\ cpu-\/to-\/cpu\ communication\ through\ whatever\ the}}
\DoxyCodeLine{00462\ \textcolor{comment}{//\ \ \ processor\ designates\ as\ normal\ cacheable\ memory.\ It\ does\ not\ order\ memory\ to\ devices.\ It\ does\ not\ provide\ any\ DMA\ ordering\ guarantees.}}
\DoxyCodeLine{00463\ \textcolor{comment}{//\ \ \ It\ does\ not\ order\ memory\ with\ other\ memory\ types\ such\ as\ Write\ Combining.\ It\ strictly\ orders\ memory\ only\ to\ shared\ memory\ that\ is\ used}}
\DoxyCodeLine{00464\ \textcolor{comment}{//\ \ \ to\ communicate\ between\ cpus\ only.}}
\DoxyCodeLine{00465\ \textcolor{comment}{//}}
\DoxyCodeLine{00466\ \textcolor{comment}{//\ \ \ ********\ Sequentially\ Consistent\ Machine\ ********}}
\DoxyCodeLine{00467\ \textcolor{comment}{//}}
\DoxyCodeLine{00468\ \textcolor{comment}{//\ \ \ The\ most\ intuitive\ as\ well\ as\ the\ model\ people\ naturally\ expect\ a\ concurrent\ system\ to\ have\ is\ Sequential\ Consistency.}}
\DoxyCodeLine{00469\ \textcolor{comment}{//\ \ \ You\ may\ have\ or\ definitely\ have\ heard\ this\ term\ if\ you\ dealt\ with\ any\ type\ of\ distributed\ system.\ Lamport's\ definition}}
\DoxyCodeLine{00470\ \textcolor{comment}{//\ \ \ articulates\ this\ consistency\ model\ the\ best.}}
\DoxyCodeLine{00471\ \textcolor{comment}{//\ \ \ Leslie\ Lamport:\ "{}the\ result\ of\ any\ execution\ is\ the\ same\ as\ if\ the\ operations\ of\ all\ the\ processors\ were\ executed\ in\ some}}
\DoxyCodeLine{00472\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sequential\ order,\ and\ the\ operations\ of\ each\ individual\ processor\ appear\ in\ this\ sequence\ in\ the\ order}}
\DoxyCodeLine{00473\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ specified\ by\ its\ program"{}.}}
\DoxyCodeLine{00474\ \textcolor{comment}{//}}
\DoxyCodeLine{00475\ \textcolor{comment}{//\ \ \ A\ Sequentially\ Consistent\ machine\ is\ modelled\ as\ follows:}}
\DoxyCodeLine{00476\ \textcolor{comment}{//}}
\DoxyCodeLine{00477\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00478\ \textcolor{comment}{//\ \ \ |\ Thread\ 0\ |\ \ \ \ \ \ ...\ \ \ \ \ \ |\ Thread\ N\ |}}
\DoxyCodeLine{00479\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00480\ \textcolor{comment}{//\ \ \ \ \ \ \ |\ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ |}}
\DoxyCodeLine{00481\ \textcolor{comment}{//\ \ \ \ \ \ \ |\ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ |}}
\DoxyCodeLine{00482\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00483\ \textcolor{comment}{//\ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00484\ \textcolor{comment}{//\ \ \ |\ \ \ \ \ \ \ \ \ \ \ Shared\ Memory\ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00485\ \textcolor{comment}{//\ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00486\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00487\ \textcolor{comment}{//}}
\DoxyCodeLine{00488\ \textcolor{comment}{//\ \ \ This\ is\ a\ sequentially\ consistent\ machine.\ Each\ thread\ is\ executing\ instructions\ in\ program\ order\ which\ does\ loads\ and\ stores}}
\DoxyCodeLine{00489\ \textcolor{comment}{//\ \ \ that\ are\ serialized\ in\ some\ order\ to\ the\ shared\ memory.\ This\ means\ all\ communication\ is\ done\ through\ the\ shared\ memory\ with\ one\ cpu}}
\DoxyCodeLine{00490\ \textcolor{comment}{//\ \ \ doing\ one\ access\ at\ a\ time.\ This\ system\ has\ a\ couple\ key\ properties.}}
\DoxyCodeLine{00491\ \textcolor{comment}{//}}
\DoxyCodeLine{00492\ \textcolor{comment}{//\ \ \ 1.\ There\ is\ no\ local\ cpu\ memory\ reordering.\ Each\ cpu\ executes\ instructions\ in\ program\ order\ and\ all\ loads\ and\ stores\ must\ complete,}}
\DoxyCodeLine{00493\ \textcolor{comment}{//\ \ \ \ \ \ be\ visible\ in\ the\ shared\ memory\ or\ be\ visible\ in\ a\ register\ before\ starting\ the\ next\ instruction.}}
\DoxyCodeLine{00494\ \textcolor{comment}{//\ \ \ 2.\ Each\ memory\ operation\ becomes\ visible\ to\ all\ cpus\ at\ the\ same\ time.\ If\ a\ store\ hits\ the\ shared\ memory,\ then\ all\ subsequent\ loads}}
\DoxyCodeLine{00495\ \textcolor{comment}{//\ \ \ \ \ \ from\ every\ other\ cpu\ will\ always\ see\ the\ latest\ store.}}
\DoxyCodeLine{00496\ \textcolor{comment}{//}}
\DoxyCodeLine{00497\ \textcolor{comment}{//\ \ \ A\ Sequentially\ Consistent\ machine\ has,\ Single-\/Copy\ Store\ Atomicity:\ All\ stores\ must\ become\ visible\ to\ all\ cores\ in\ the\ system\ at\ the\ same\ time.}}
\DoxyCodeLine{00498\ \textcolor{comment}{//}}
\DoxyCodeLine{00499\ \textcolor{comment}{//\ \ \ ********\ Adding\ Caches\ ********}}
\DoxyCodeLine{00500\ \textcolor{comment}{//}}
\DoxyCodeLine{00501\ \textcolor{comment}{//\ \ \ Caches\ by\ nature\ implicitly\ add\ the\ potential\ for\ memory\ reordering.\ A\ centralized\ shared\ snoopy\ bus\ that\ we\ all\ learned\ in\ school}}
\DoxyCodeLine{00502\ \textcolor{comment}{//\ \ \ makes\ it\ easy\ to\ implement\ sequential\ consistency\ with\ caches.\ Writes\ and\ reads\ are\ all\ serialized\ in\ a\ total\ order\ via\ the\ cache\ bus\ transaction}}
\DoxyCodeLine{00503\ \textcolor{comment}{//\ \ \ ordering.\ Every\ modern\ day\ bus\ is\ not\ inorder,\ and\ most\ certainly\ not\ a\ shared\ centralized\ bus.\ Cache\ coherency\ guarantees\ that\ all\ memory\ operations}}
\DoxyCodeLine{00504\ \textcolor{comment}{//\ \ \ will\ be\ propagated\ eventually\ to\ all\ parties,\ but\ it\ doesn't\ guarantee\ in\ what\ order\ or\ in\ what\ time\ frame.\ Once\ you\ add}}
\DoxyCodeLine{00505\ \textcolor{comment}{//\ \ \ caches,\ various\ levels\ of\ caching\ and\ various\ interconnects\ between\ remote\ cpus,\ you\ inevitably\ run\ into\ the\ issue\ where}}
\DoxyCodeLine{00506\ \textcolor{comment}{//\ \ \ some\ cpus\ observe\ the\ effects\ of\ a\ store\ before\ other\ cpus.\ Obviously\ we\ have\ weakly-\/ordered\ and\ strongly-\/ordered\ cpus\ with}}
\DoxyCodeLine{00507\ \textcolor{comment}{//\ \ \ caches\ so\ why\ is\ that?\ The\ short\ answer\ is,\ where\ is\ the\ onus\ put,\ is\ it\ on\ the\ programmer\ or\ the\ hardware.\ Does\ the\ hardware}}
\DoxyCodeLine{00508\ \textcolor{comment}{//\ \ \ have\ dependency\ tracking,\ is\ it\ able\ to\ determine\ when\ a\ memory\ order\ violation\ occurs\ such\ as\ rolling\ back\ its\ speculative\ execution}}
\DoxyCodeLine{00509\ \textcolor{comment}{//\ \ \ and\ also\ how\ far\ along\ the\ chain\ of\ interconnects\ does\ the\ hardware\ wait\ before\ it\ determines\ that\ the\ memory\ operation\ has}}
\DoxyCodeLine{00510\ \textcolor{comment}{//\ \ \ been\ acknowledged\ or\ is\ considered\ to\ satisfy\ its\ memory\ ordering\ guarantees.\ Again\ this\ is\ a\ very\ high\ level\ view\ of\ the\ system}}
\DoxyCodeLine{00511\ \textcolor{comment}{//\ \ \ as\ a\ whole,\ but\ the\ takeaway\ is\ yes;\ caches\ do\ add\ the\ potential\ for\ reordering\ but\ other\ supporting\ hardware\ determines\ whether}}
\DoxyCodeLine{00512\ \textcolor{comment}{//\ \ \ that\ is\ observable\ by\ the\ programmer.\ There\ is\ also\ some\ debate\ whether\ weakly-\/ordered\ processors\ are\ actually\ more\ performant}}
\DoxyCodeLine{00513\ \textcolor{comment}{//\ \ \ than\ strongly-\/ordered\ cpus\ eluding\ to\ the\ fact\ that\ the\ hardware\ has\ a\ better\ picture\ of\ what\ is\ a\ violation\ versus\ the\ programmer}}
\DoxyCodeLine{00514\ \textcolor{comment}{//\ \ \ having\ to\ emit\ far\ more\ barriers\ on\ weakly-\/ordered\ architectures\ in\ multi-\/threaded\ code\ which\ may\ actually\ not\ be\ needed\ because\ the}}
\DoxyCodeLine{00515\ \textcolor{comment}{//\ \ \ hardware\ didn't\ commit\ a\ violation\ but\ it\ may\ have\ and\ we\ as\ the\ programmer\ cannot\ rely\ on\ may\ haves.}}
\DoxyCodeLine{00516\ \textcolor{comment}{//}}
\DoxyCodeLine{00517\ \textcolor{comment}{//\ \ \ ********\ Store\ Buffers\ ********}}
\DoxyCodeLine{00518\ \textcolor{comment}{//}}
\DoxyCodeLine{00519\ \textcolor{comment}{//\ \ \ Obviously\ having\ all\ stores\ serialize\ results\ in\ unnecessary\ stalls.\ Store\ buffers\ alleviate\ this\ issue.}}
\DoxyCodeLine{00520\ \textcolor{comment}{//\ \ \ Store\ buffers\ are\ simple\ fixed\ size\ structures\ that\ sit\ between\ the\ cpu\ and\ the\ memory\ hierarchy.\ This\ allows}}
\DoxyCodeLine{00521\ \textcolor{comment}{//\ \ \ each\ cpu\ to\ record\ its\ write\ in\ the\ store\ buffer\ and\ then\ move\ onto\ the\ next\ instruction.\ The\ store\ buffer\ will}}
\DoxyCodeLine{00522\ \textcolor{comment}{//\ \ \ eventually\ be\ flushed\ to\ the\ resulting\ memory\ hierarchy\ in\ FIFO\ order.\ How\ and\ when\ this\ flushing\ occurs\ is\ irrelevant\ to\ the}}
\DoxyCodeLine{00523\ \textcolor{comment}{//\ \ \ understanding\ of\ a\ store\ buffer.\ A\ read\ from\ an\ address\ will\ grab\ the\ most\ recent\ write\ to\ the\ same\ address\ in\ the\ store\ buffer.}}
\DoxyCodeLine{00524\ \textcolor{comment}{//}}
\DoxyCodeLine{00525\ \textcolor{comment}{//\ \ \ The\ introduction\ of\ a\ store\ buffer\ is\ our\ first\ dive\ into\ weaker\ memory\ consistency.\ The\ addition\ of\ this\ hardware\ turns\ the\ consistency\ model\ weaker,}}
\DoxyCodeLine{00526\ \textcolor{comment}{//\ \ \ into\ one\ that\ is\ commonly\ known\ as\ TSO,\ Total-\/Store\ Order.\ This\ is\ the\ exact\ model\ used\ by\ x86\ cpus\ and\ we\ will\ see\ what\ this\ means}}
\DoxyCodeLine{00527\ \textcolor{comment}{//\ \ \ and\ what\ new\ effects\ are\ observed\ with\ the\ addition\ of\ the\ store\ buffer.\ Below\ is\ a\ diagram\ of\ how\ the\ machine\ may\ now\ look.}}
\DoxyCodeLine{00528\ \textcolor{comment}{//\ \ \ This\ type\ of\ store\ buffer\ is\ known\ as\ a\ FIFO\ store\ buffer,\ FIFO\ write\ buffer,\ or\ Load/Store\ Queue\ in\ some\ literature.\ This\ type\ of}}
\DoxyCodeLine{00529\ \textcolor{comment}{//\ \ \ store\ buffer\ introduces\ STLD\ reordering\ but\ still\ prevents\ STST\ reordering.\ We\ will\ take\ a\ look\ at\ another\ type\ of\ store\ buffer\ later.}}
\DoxyCodeLine{00530\ \textcolor{comment}{//\ \ \ Even\ with\ this\ store\ buffer,\ stores\ to\ the\ same\ address\ can\ still\ be\ merged\ so\ that\ only\ the\ latest\ store\ is\ written\ to\ the\ cache\ assuming}}
\DoxyCodeLine{00531\ \textcolor{comment}{//\ \ \ no\ other\ intermediary\ stores\ happen.\ x86\ cpus\ do\ write\ merging\ even\ for\ consecutive\ stores,\ i.e.\ storing\ to\ A\ and\ A+1\ can\ be\ merged\ into\ one\ two-\/byte\ store.}}
\DoxyCodeLine{00532\ \textcolor{comment}{//}}
\DoxyCodeLine{00533\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00534\ \textcolor{comment}{//\ \ \ |\ Thread\ 0\ |\ \ \ \ \ \ ...\ \ \ \ \ \ |\ Thread\ N\ |}}
\DoxyCodeLine{00535\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00536\ \textcolor{comment}{//\ \ \ \ \ \ \ |\ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ |}}
\DoxyCodeLine{00537\ \textcolor{comment}{//\ \ \ \ \ \ \ |\ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ |}}
\DoxyCodeLine{00538\ \textcolor{comment}{//\ \ \ \ |\ Store\ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Store\ \ |}}
\DoxyCodeLine{00539\ \textcolor{comment}{//\ \ \ \ |\ Buffer\ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Buffer\ |}}
\DoxyCodeLine{00540\ \textcolor{comment}{//\ \ \ \ \ \ \ |\ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ |}}
\DoxyCodeLine{00541\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00542\ \textcolor{comment}{//\ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00543\ \textcolor{comment}{//\ \ \ |\ \ \ \ \ \ \ \ \ \ \ Shared\ Memory\ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00544\ \textcolor{comment}{//\ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{00545\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00546\ \textcolor{comment}{//}}
\DoxyCodeLine{00547\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/\ Store-\/Buffering\ /\ Dekker's\ Example\ -\/-\/-\/-\/}}
\DoxyCodeLine{00548\ \textcolor{comment}{//\ \ \ This\ is\ a\ very\ common\ litmus\ test\ that\ showcases\ the\ introduction\ of\ STLD\ reordering.\ It\ is\ called\ Store-\/Buffering\ example\ because\ it\ is\ the\ only\ weaker}}
\DoxyCodeLine{00549\ \textcolor{comment}{//\ \ \ behaviour\ observed\ under\ TSO\ and\ also\ called\ Dekker's\ Example\ as\ it\ famously\ breaks\ Dekker's\ mutual\ exclusion\ algorithm.}}
\DoxyCodeLine{00550\ \textcolor{comment}{//}}
\DoxyCodeLine{00551\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00552\ \textcolor{comment}{//\ \ \ Initial\ State:}}
\DoxyCodeLine{00553\ \textcolor{comment}{//\ \ \ x\ =\ 0;\ y\ =\ 0;}}
\DoxyCodeLine{00554\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00555\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ |\ \ \ \ Thread\ 1}}
\DoxyCodeLine{00556\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00557\ \textcolor{comment}{//\ \ \ STORE(x,\ 1)\ \ |\ STORE(y,\ 1)}}
\DoxyCodeLine{00558\ \textcolor{comment}{//\ \ \ r0\ =\ LOAD(y)\ |\ r1\ =\ LOAD(x)}}
\DoxyCodeLine{00559\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00560\ \textcolor{comment}{//\ \ \ Observed:\ r0\ =\ 0\ \&\&\ r1\ =\ 0}}
\DoxyCodeLine{00561\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00562\ \textcolor{comment}{//}}
\DoxyCodeLine{00563\ \textcolor{comment}{//\ \ \ We\ would\ normally\ assume\ that\ any\ interleaving\ of\ the\ two\ threads\ cannot\ possibly\ end\ up\ with\ both\ loads\ reading\ 0.\ We\ assume\ that\ the\ observed\ outcome}}
\DoxyCodeLine{00564\ \textcolor{comment}{//\ \ \ of\ r0\ =\ 0\ \&\&\ r1\ =\ 0\ to\ be\ impossible,\ clearly\ that\ is\ not\ the\ case.\ Let's\ start\ by\ understanding\ the\ example\ with\ no\ reordering\ possible.\ Both\ threads}}
\DoxyCodeLine{00565\ \textcolor{comment}{//\ \ \ run\ and\ their\ first\ instruction\ is\ to\ write\ the\ value\ 1\ into\ either\ x\ or\ y,\ the\ next\ instruction\ then\ loads\ from\ the\ opposite\ variable.\ This\ means\ no}}
\DoxyCodeLine{00566\ \textcolor{comment}{//\ \ \ matter\ the\ interleaving,\ one\ of\ the\ loads\ always\ executes\ after\ the\ other\ thread's\ store\ to\ that\ variable.}}
\DoxyCodeLine{00567\ \textcolor{comment}{//\ \ \ We\ could\ observe\ r0\ =\ 1\ \&\&\ r1\ =\ 1\ if\ both\ threads\ execute\ in\ lockstep.}}
\DoxyCodeLine{00568\ \textcolor{comment}{//\ \ \ We\ could\ observe\ r0\ =\ 0\ \&\&\ r1\ =\ 1\ if\ thread\ 0\ executes\ and\ then\ thread\ 1\ executes.}}
\DoxyCodeLine{00569\ \textcolor{comment}{//\ \ \ We\ could\ observe\ r0\ =\ 1\ \&\&\ r1\ =\ 0\ if\ thread\ 1\ executes\ and\ then\ thread\ 0\ executes.}}
\DoxyCodeLine{00570\ \textcolor{comment}{//\ \ \ Since\ the\ stores\ always\ execute\ before\ that\ load\ in\ the\ other\ thread,\ one\ thread\ must\ always\ at\ least\ observe\ a\ store,\ so\ let's\ see\ why\ store\ buffers\ break\ this.}}
\DoxyCodeLine{00571\ \textcolor{comment}{//}}
\DoxyCodeLine{00572\ \textcolor{comment}{//\ \ \ What\ will\ happen\ is\ that\ STORE(x,\ 1)\ is\ stored\ to\ the\ store\ buffer\ but\ not\ made\ globally\ visible\ yet.}}
\DoxyCodeLine{00573\ \textcolor{comment}{//\ \ \ STORE(y,\ 1)\ is\ written\ to\ the\ store\ buffer\ and\ also\ is\ not\ made\ globally\ visible\ yet.}}
\DoxyCodeLine{00574\ \textcolor{comment}{//\ \ \ Both\ loads\ now\ read\ the\ initial\ state\ of\ x\ and\ y\ which\ is\ 0.\ We\ got\ the\ r0\ =\ 0\ \&\&\ r1\ =\ 0\ outcome\ and\ just\ observed\ a\ Store-\/Load\ reordering.}}
\DoxyCodeLine{00575\ \textcolor{comment}{//\ \ \ It\ has\ appeared\ as\ if\ the\ loads\ have\ been\ reordered\ with\ the\ previous\ stores\ and\ thus\ executed\ before\ the\ stores.}}
\DoxyCodeLine{00576\ \textcolor{comment}{//\ \ \ Notice\ even\ if\ we\ execute\ the\ instructions\ in\ order,\ a\ series\ of\ other\ hardware\ side\ effects\ made\ it\ appear\ as\ if\ the\ instructions\ have\ been\ reordered.}}
\DoxyCodeLine{00577\ \textcolor{comment}{//\ \ \ We\ can\ solve\ this\ by\ placing\ a\ Store-\/Load\ barrier\ after\ the\ store\ and\ before\ the\ load\ as\ follows.}}
\DoxyCodeLine{00578\ \textcolor{comment}{//}}
\DoxyCodeLine{00579\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00580\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ |\ \ \ \ Thread\ 1}}
\DoxyCodeLine{00581\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00582\ \textcolor{comment}{//\ \ \ STORE(x,\ 1)\ \ |\ STORE(y,\ 1)}}
\DoxyCodeLine{00583\ \textcolor{comment}{//\ \ \ STLD\ BARRIER\ |\ STLD\ BARRIER}}
\DoxyCodeLine{00584\ \textcolor{comment}{//\ \ \ r0\ =\ LOAD(y)\ |\ r1\ =\ LOAD(x)}}
\DoxyCodeLine{00585\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00586\ \textcolor{comment}{//}}
\DoxyCodeLine{00587\ \textcolor{comment}{//\ \ \ This\ STLD\ barrier\ effectively\ will\ flush\ the\ store\ buffer\ into\ the\ memory\ hierarchy\ ensuring\ all\ stores\ in\ the\ buffer\ are\ visible\ to\ all\ other\ cpus\ at\ the\ same\ time}}
\DoxyCodeLine{00588\ \textcolor{comment}{//\ \ \ before\ executing\ the\ load\ instruction.\ Again\ nothing\ prevents\ a\ potential\ hardware\ from\ speculatively\ executing\ the\ load\ even\ with\ the\ STLD\ barrier,\ the\ hardware\ will\ have\ to\ do}}
\DoxyCodeLine{00589\ \textcolor{comment}{//\ \ \ a\ proper\ rollback\ if\ it\ detected\ a\ memory\ order\ violation\ otherwise\ it\ can\ continue\ on\ with\ its\ speculative\ load.\ The\ barrier\ just\ delimits\ a\ stability\ point.}}
\DoxyCodeLine{00590\ \textcolor{comment}{//}}
\DoxyCodeLine{00591\ \textcolor{comment}{//\ \ \ Most\ hardware\ does\ not\ provide\ granular\ barrier\ semantics\ such\ as\ STLD.\ Most\ provide\ a\ write\ memory\ barrier\ which\ only\ orders\ stores,\ STST,\ a\ read\ memory\ barrier}}
\DoxyCodeLine{00592\ \textcolor{comment}{//\ \ \ which\ only\ orders\ loads,\ LDLD,\ and\ then\ a\ full\ memory\ barrier\ which\ is\ all\ 4\ permutations.\ So\ on\ x86\ we\ will\ have\ to\ use\ the\ mfence,\ memory\ fence,\ instruction}}
\DoxyCodeLine{00593\ \textcolor{comment}{//\ \ \ which\ is\ a\ full\ memory\ barrier\ to\ get\ our\ desired\ STLD\ requirements.}}
\DoxyCodeLine{00594\ \textcolor{comment}{//}}
\DoxyCodeLine{00595\ \textcolor{comment}{//\ \ \ TSO\ also\ has\ the\ property\ that\ we\ call,\ Multi-\/Copy\ Store\ Atomicity.\ This\ means\ a\ cpu\ sees\ its\ own\ stores\ before\ they\ become\ visible\ to\ other\ cpus,}}
\DoxyCodeLine{00596\ \textcolor{comment}{//\ \ \ by\ forwarding\ them\ from\ the\ store\ buffer,\ but\ a\ store\ becomes\ visible\ to\ all\ other\ cpus\ at\ the\ same\ time\ when\ flushed\ from\ the\ store\ buffer.}}
\DoxyCodeLine{00597\ \textcolor{comment}{//}}
\DoxyCodeLine{00598\ \textcolor{comment}{//}}
\DoxyCodeLine{00599\ \textcolor{comment}{//\ \ \ Let's\ look\ at\ a\ non-\/FIFO\ store\ buffer\ now\ as\ seen\ in\ ARM\ cpus\ as\ an\ example\ and\ we\ will\ use\ a\ standard\ Message\ Passing\ example\ to\ see\ how\ it\ manifests\ in\ even\ weaker\ consistency.}}
\DoxyCodeLine{00600\ \textcolor{comment}{//\ \ \ A\ store\ buffer\ on\ ARM\ as\ an\ example\ allows\ write\ merging\ even\ with\ adjacent\ stores,\ is\ not\ a\ FIFO\ queue,\ any\ stores\ in\ the\ small\ hardware\ hash\ table\ may\ be\ ejected\ at\ any\ point}}
\DoxyCodeLine{00601\ \textcolor{comment}{//\ \ \ due\ to\ a\ collision\ eviction\ or\ the\ availability\ of\ cachelines\ in\ the\ cache\ hierarchy\ meaning\ that\ stores\ may\ bypass\ the\ buffer\ entirely\ if\ that\ cacheline\ is\ already\ owned\ by\ that\ cpu.}}
\DoxyCodeLine{00602\ \textcolor{comment}{//\ \ \ There\ is\ no\ guarantee\ that\ stores\ will\ be\ completed\ in\ order\ as\ in\ the\ FIFO\ case.}}
\DoxyCodeLine{00603\ \textcolor{comment}{//}}
\DoxyCodeLine{00604\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00605\ \textcolor{comment}{//\ \ \ Initial\ State:}}
\DoxyCodeLine{00606\ \textcolor{comment}{//\ \ \ x\ =\ 0;\ y\ =\ 0;}}
\DoxyCodeLine{00607\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00608\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ |\ \ \ \ Thread\ 1}}
\DoxyCodeLine{00609\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00610\ \textcolor{comment}{//\ \ \ STORE(x,\ 1)\ \ |\ while(LOAD(y)\ ==\ 0);}}
\DoxyCodeLine{00611\ \textcolor{comment}{//\ \ \ STORE(y,\ 1)\ \ |\ r0\ =\ LOAD(x)}}
\DoxyCodeLine{00612\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00613\ \textcolor{comment}{//\ \ \ Observed:\ r0\ =\ 0}}
\DoxyCodeLine{00614\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00615\ \textcolor{comment}{//}}
\DoxyCodeLine{00616\ \textcolor{comment}{//\ \ \ This\ is\ a\ classic\ Message\ Passing\ example\ that\ is\ very\ commonly\ used\ in\ production\ code.\ We\ store\ some\ values\ and\ then\ set\ a\ flag,\ STORE(y,\ 1)\ in\ this\ case.}}
\DoxyCodeLine{00617\ \textcolor{comment}{//\ \ \ The\ other\ thread\ waits\ until\ the\ flag\ is\ observed\ and\ then\ reads\ the\ value\ out\ of\ x.\ If\ we\ observed\ the\ flag\ then\ we\ should\ obviously\ see\ all\ stores\ before\ the\ flag\ was\ set.}}
\DoxyCodeLine{00618\ \textcolor{comment}{//\ \ \ Given\ our\ familiarity\ with\ TSO\ consistency\ above\ we\ know\ this\ definitely\ works\ on\ TSO\ and\ it\ is\ impossible\ to\ observe\ the\ load\ of\ x\ returning\ 0\ under\ that\ consistency\ model.}}
\DoxyCodeLine{00619\ \textcolor{comment}{//\ \ \ Let's\ see\ how\ this\ breaks\ with\ a\ non-\/FIFO\ store\ buffer.}}
\DoxyCodeLine{00620\ \textcolor{comment}{//}}
\DoxyCodeLine{00621\ \textcolor{comment}{//\ \ \ Thread\ 0\ executes\ the\ STORE(x,\ 1)\ but\ the\ cacheline\ for\ x\ is\ not\ in\ thread\ 0's\ cache\ so\ we\ write\ to\ the\ store\ buffer\ and\ wait\ for\ the\ cacheline.}}
\DoxyCodeLine{00622\ \textcolor{comment}{//\ \ \ Thread\ 1\ executes\ the\ LOAD(y)\ and\ it\ also\ does\ not\ have\ y\ in\ its\ cacheline\ so\ it\ waits\ before\ completing\ the\ load.}}
\DoxyCodeLine{00623\ \textcolor{comment}{//\ \ \ Thread\ 0\ moves\ on\ to\ STORE(y,\ 1).\ It\ owns\ this\ cacheline,\ hypothetically,\ so\ it\ may\ bypass\ the\ store\ buffer\ and\ store\ directly\ to\ the\ cache.}}
\DoxyCodeLine{00624\ \textcolor{comment}{//\ \ \ Thread\ 0\ receives\ a\ message\ that\ Thread\ 1\ needs\ y's\ cacheline,\ so\ it\ transfers\ the\ now\ modified\ cacheline\ to\ Thread\ 1.}}
\DoxyCodeLine{00625\ \textcolor{comment}{//\ \ \ Thread\ 1\ completes\ the\ load\ with\ the\ updated\ value\ of\ y\ =\ 1\ and\ branches\ out\ of\ the\ while\ loop\ since\ we\ saw\ the\ new\ value\ of\ y.}}
\DoxyCodeLine{00626\ \textcolor{comment}{//\ \ \ Thread\ 1\ executes\ LOAD(x)\ which\ will\ return\ 0\ since\ Thread\ 0\ still\ hasn't\ flushed\ its\ store\ buffer\ waiting\ for\ x's\ cacheline.}}
\DoxyCodeLine{00627\ \textcolor{comment}{//\ \ \ Thread\ 0\ receives\ x's\ cacheline\ and\ now\ flushes\ x\ =\ 1\ to\ the\ cache.\ Thread\ 1\ will\ also\ have\ invalidated\ its\ cacheline\ for\ x\ that\ it\ brought\ in\ via\ the\ previous\ load.}}
\DoxyCodeLine{00628\ \textcolor{comment}{//}}
\DoxyCodeLine{00629\ \textcolor{comment}{//\ \ \ We\ have\ now\ fallen\ victim\ to\ STST\ reordering,\ allowing\ Thread\ 1\ to\ observe\ a\ load\ of\ x\ returning\ 0.\ Not\ only\ does\ this\ store\ buffer\ allow\ STLD\ reordering\ due\ to\ the\ nature\ of}}
\DoxyCodeLine{00630\ \textcolor{comment}{//\ \ \ buffering\ stores,\ but\ it\ also\ allows\ another\ reordering;\ that\ of\ Store-\/Store\ reordering.\ It\ was\ observed\ as\ if\ Thread\ 0\ executed\ STORE(y,\ 1)\ before\ STORE(x,\ 1)\ which\ completely}}
\DoxyCodeLine{00631\ \textcolor{comment}{//\ \ \ broke\ our\ simple\ message\ passing\ scenario.}}
\DoxyCodeLine{00632\ \textcolor{comment}{//}}
\DoxyCodeLine{00633\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00634\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ |\ \ \ \ Thread\ 1}}
\DoxyCodeLine{00635\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00636\ \textcolor{comment}{//\ \ \ STORE(x,\ 1)\ \ |\ while(LOAD(y)\ ==\ 0);}}
\DoxyCodeLine{00637\ \textcolor{comment}{//\ \ \ STST\ BARRIER\ |}}
\DoxyCodeLine{00638\ \textcolor{comment}{//\ \ \ STORE(y,\ 1)\ \ |\ r0\ =\ LOAD(x)}}
\DoxyCodeLine{00639\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00640\ \textcolor{comment}{//}}
\DoxyCodeLine{00641\ \textcolor{comment}{//\ \ \ The\ STST\ memory\ barrier\ effectively\ ensures\ that\ the\ cpu\ will\ flush\ its\ store\ buffer\ before\ executing\ any\ subsequent\ stores.\ That\ is\ not\ entirely\ true,\ the\ cpu\ is\ still\ allowed}}
\DoxyCodeLine{00642\ \textcolor{comment}{//\ \ \ to\ continue\ and\ execute\ stores\ to\ the\ store\ buffer\ as\ long\ as\ it\ doesn't\ flush\ them\ to\ the\ cache\ before\ the\ previous\ stores\ are\ flushed\ to\ the\ cache.\ If\ nothing\ becomes}}
\DoxyCodeLine{00643\ \textcolor{comment}{//\ \ \ globally\ visible\ out\ of\ order\ then\ we\ are\ good.}}
\DoxyCodeLine{00644\ \textcolor{comment}{//\ \ \ The\ example\ above\ will\ change\ how\ the\ processor\ executes\ due\ to\ the\ STST\ memory\ barrier.\ Thread\ 0\ will\ execute\ STORE(y,\ 1),\ write\ to\ the\ store\ buffer\ and\ mark\ all\ current\ entries.\ Even\ though\ it\ owns\ the\ cacheline}}
\DoxyCodeLine{00645\ \textcolor{comment}{//\ \ \ it\ cannot\ write\ the\ store\ to\ the\ cache\ until\ all\ marked\ entries,\ which\ are\ all\ the\ previous\ stores,\ are\ flushed\ to\ the\ cache.\ We\ have\ now\ fixed\ the\ message\ passing\ code\ by\ adding}}
\DoxyCodeLine{00646\ \textcolor{comment}{//\ \ \ a\ STST\ or\ write\ memory\ barrier\ and\ thus\ it\ is\ no\ longer\ possible\ to\ observe\ the\ load\ of\ x\ returning\ 0.}}
\DoxyCodeLine{00647\ \textcolor{comment}{//}}
\DoxyCodeLine{00648\ \textcolor{comment}{//\ \ \ ********\ Invalidation\ Queues\ ********}}
\DoxyCodeLine{00649\ \textcolor{comment}{//}}
\DoxyCodeLine{00650\ \textcolor{comment}{//\ \ \ Due\ to\ the\ cache\ coherency\ protocol\ in\ play,\ a\ write\ to\ a\ cacheline\ will\ have\ to\ send\ invalidation\ messages\ to\ all\ other\ cpus\ that\ may\ have\ that\ cacheline\ as\ well.}}
\DoxyCodeLine{00651\ \textcolor{comment}{//\ \ \ Immediately\ executing\ and\ responding\ to\ invalidation\ messages\ can\ cause\ quite\ a\ stall\ especially\ if\ the\ cache\ is\ busy\ at\ the\ moment\ with\ other\ requests.}}
\DoxyCodeLine{00652\ \textcolor{comment}{//\ \ \ The\ longer\ we\ wait\ to\ invalidate\ the\ cacheline,\ the\ longer\ the\ remote\ cpu\ doing\ the\ write\ is\ stalled\ waiting\ on\ us.\ We\ don't\ like\ this\ very\ much.}}
\DoxyCodeLine{00653\ \textcolor{comment}{//\ \ \ Invalidation\ Queues\ are\ just\ that,\ we\ queue\ up\ the\ action\ of\ actually\ invalidating\ the\ cacheline\ but\ immediately\ respond\ to\ the\ request\ saying\ we\ did\ it\ anyway.}}
\DoxyCodeLine{00654\ \textcolor{comment}{//\ \ \ Now\ the\ remote\ cpu\ thinks\ we\ invalidated\ said\ cacheline\ but\ actually\ it\ may\ very\ well\ still\ be\ in\ our\ cache\ ready\ to\ be\ read\ from.\ We\ just\ got\ weaker\ again,\ let's}}
\DoxyCodeLine{00655\ \textcolor{comment}{//\ \ \ see\ how\ this\ manifests\ in\ code\ by\ starting\ from\ the\ end\ of\ our\ previous\ example.}}
\DoxyCodeLine{00656\ \textcolor{comment}{//}}
\DoxyCodeLine{00657\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00658\ \textcolor{comment}{//\ \ \ Initial\ State:}}
\DoxyCodeLine{00659\ \textcolor{comment}{//\ \ \ x\ =\ 0;\ y\ =\ 0;}}
\DoxyCodeLine{00660\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00661\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ |\ \ \ \ Thread\ 1}}
\DoxyCodeLine{00662\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00663\ \textcolor{comment}{//\ \ \ STORE(x,\ 1)\ \ |\ while(LOAD(y)\ ==\ 0);}}
\DoxyCodeLine{00664\ \textcolor{comment}{//\ \ \ STST\ BARRIER\ |}}
\DoxyCodeLine{00665\ \textcolor{comment}{//\ \ \ STORE(y,\ 1)\ \ |\ r0\ =\ LOAD(x)}}
\DoxyCodeLine{00666\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00667\ \textcolor{comment}{//\ \ \ Observed:\ r0\ =\ 0}}
\DoxyCodeLine{00668\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00669\ \textcolor{comment}{//}}
\DoxyCodeLine{00670\ \textcolor{comment}{//\ \ \ Thread\ 1\ receives\ the\ invalidate\ x's\ cacheline\ message\ and\ queues\ it\ because\ it\ is\ busy.}}
\DoxyCodeLine{00671\ \textcolor{comment}{//\ \ \ Thread\ 1\ receives\ the\ invalidate\ y's\ cacheline\ message,\ but\ we\ don't\ have\ that\ cacheline\ so\ acknowledge\ immediately.}}
\DoxyCodeLine{00672\ \textcolor{comment}{//\ \ \ Thread\ 1\ executes\ LOAD(y),\ loads\ in\ y's\ cacheline\ and\ branches\ out\ of\ the\ loop.}}
\DoxyCodeLine{00673\ \textcolor{comment}{//\ \ \ Thread\ 1\ executes\ LOAD(x),\ and\ loads\ from\ the\ cache\ the\ old\ value\ of\ x\ because\ the\ invalidation\ message\ is\ still\ sitting\ in\ the\ invalidation\ queue.}}
\DoxyCodeLine{00674\ \textcolor{comment}{//}}
\DoxyCodeLine{00675\ \textcolor{comment}{//\ \ \ We\ have\ just\ again\ observed\ the\ load\ of\ x\ returning\ 0\ but\ from\ a\ different\ type\ of\ reordering\ now\ on\ the\ reader\ side.}}
\DoxyCodeLine{00676\ \textcolor{comment}{//\ \ \ This\ is\ a\ form\ of\ LDLD,\ Load-\/Load,\ reordering\ as\ it\ appears\ as\ if\ LOAD(x)\ was\ executed\ before\ LOAD(y).\ This\ can\ be\ fixed\ as\ follows.}}
\DoxyCodeLine{00677\ \textcolor{comment}{//}}
\DoxyCodeLine{00678\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00679\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ |\ \ \ \ Thread\ 1}}
\DoxyCodeLine{00680\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00681\ \textcolor{comment}{//\ \ \ STORE(x,\ 1)\ \ |\ while(LOAD(y)\ ==\ 0);}}
\DoxyCodeLine{00682\ \textcolor{comment}{//\ \ \ STST\ BARRIER\ |\ LDLD\ BARRIER}}
\DoxyCodeLine{00683\ \textcolor{comment}{//\ \ \ STORE(y,\ 1)\ \ |\ r0\ =\ LOAD(x)}}
\DoxyCodeLine{00684\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00685\ \textcolor{comment}{//}}
\DoxyCodeLine{00686\ \textcolor{comment}{//\ \ \ The\ LDLD\ memory\ barrier\ essentially\ marks\ all\ entries\ currently\ in\ the\ invalidation\ queue.\ Any\ subsequent\ load\ must\ wait\ until\ all\ the\ marked\ entries\ have\ been}}
\DoxyCodeLine{00687\ \textcolor{comment}{//\ \ \ processed.\ This\ ensures\ once\ we\ observe\ y\ =\ 1,\ we\ process\ all\ entries\ that\ came\ before\ y\ and\ that\ way\ we\ observe\ all\ the\ stores\ that\ happened\ before\ y.}}
\DoxyCodeLine{00688\ \textcolor{comment}{//\ \ \ The\ insertion\ of\ the\ read\ memory\ barrier\ creates\ the\ required\ memory\ barrier\ pairing\ as\ discussed\ above\ and\ ensures\ that\ now\ our\ code\ executes\ as\ expected.}}
\DoxyCodeLine{00689\ \textcolor{comment}{//}}
\DoxyCodeLine{00690\ \textcolor{comment}{//\ \ \ It\ must\ be\ made\ clear\ that\ these\ are\ not\ the\ only\ hardware\ structure\ additions\ or\ ways\ that\ can\ relax\ STST,\ STLD\ and\ LDLD\ orderings.\ These\ are\ merely}}
\DoxyCodeLine{00691\ \textcolor{comment}{//\ \ \ 2\ structures\ that\ are\ common\ and\ ones\ that\ I\ choose\ to\ use\ as\ examples\ of\ how\ hardware\ can\ reduce\ ordering\ guarantees.\ Knowing\ how\ the\ hardware\ does\ this}}
\DoxyCodeLine{00692\ \textcolor{comment}{//\ \ \ isn't\ always\ entirely\ clear\ but\ having\ a\ model\ that\ tells\ us\ what\ operations\ can\ be\ reordered\ is\ all\ we\ need\ to\ be\ able\ to\ reason\ about\ our\ code\ when\ executing\ on\ that\ hardware.}}
\DoxyCodeLine{00693\ \textcolor{comment}{//}}
\DoxyCodeLine{00694\ \textcolor{comment}{//\ \ \ ********\ Load\ Buffering\ ********}}
\DoxyCodeLine{00695\ \textcolor{comment}{//}}
\DoxyCodeLine{00696\ \textcolor{comment}{//\ \ \ The\ analog\ of\ the\ Store\ Buffering\ example,\ this\ litmus\ test\ has\ two\ threads\ read\ from\ two\ different\ locations\ and\ then\ write\ to\ the\ other\ locations.}}
\DoxyCodeLine{00697\ \textcolor{comment}{//\ \ \ The\ outcome\ of\ having\ LDST\ reordering\ is\ allowed\ and\ observable\ on\ many\ processors\ such\ as\ ARM.}}
\DoxyCodeLine{00698\ \textcolor{comment}{//}}
\DoxyCodeLine{00699\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00700\ \textcolor{comment}{//\ \ \ Initial\ State:}}
\DoxyCodeLine{00701\ \textcolor{comment}{//\ \ \ x\ =\ 0;\ y\ =\ 0;}}
\DoxyCodeLine{00702\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00703\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ |\ \ \ \ Thread\ 1}}
\DoxyCodeLine{00704\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00705\ \textcolor{comment}{//\ \ \ r0\ =\ LOAD(x)\ |\ r1\ =\ LOAD(y)}}
\DoxyCodeLine{00706\ \textcolor{comment}{//\ \ \ STORE(y,\ 1)\ \ |\ STORE(x,\ 1)}}
\DoxyCodeLine{00707\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00708\ \textcolor{comment}{//\ \ \ Observed:\ r0\ =\ 1\ \&\&\ r1\ =\ 1}}
\DoxyCodeLine{00709\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00710\ \textcolor{comment}{//}}
\DoxyCodeLine{00711\ \textcolor{comment}{//\ \ \ This\ is\ possible\ because\ the\ processor\ does\ not\ have\ to\ wait\ for\ the\ other\ cpu's\ cacheline\ to\ arrive\ before\ storing\ into\ the\ cache.}}
\DoxyCodeLine{00712\ \textcolor{comment}{//\ \ \ Assume\ Thread\ 0\ owns\ y's\ cacheline\ and\ Thread\ 1\ owns\ x's\ cacheline.}}
\DoxyCodeLine{00713\ \textcolor{comment}{//\ \ \ The\ processor\ may\ execute\ the\ load\ and\ thus\ buffer\ the\ load\ waiting\ for\ the\ cacheline\ to\ arrive.}}
\DoxyCodeLine{00714\ \textcolor{comment}{//\ \ \ The\ processor\ may\ continue\ onto\ the\ store\ and\ since\ each\ cpu\ owns\ their\ respective\ cacheline,\ store\ the\ result\ into\ the\ cache.}}
\DoxyCodeLine{00715\ \textcolor{comment}{//\ \ \ The\ cpus\ now\ receive\ the\ cachelines\ for\ x\ and\ y\ with\ the\ now\ modified\ value.}}
\DoxyCodeLine{00716\ \textcolor{comment}{//\ \ \ We\ have\ just\ observed\ the\ loads\ returning\ 1\ and\ thus\ observed\ LDST\ reordering.}}
\DoxyCodeLine{00717\ \textcolor{comment}{//}}
\DoxyCodeLine{00718\ \textcolor{comment}{//\ \ \ To\ forbid\ such\ outcome\ it\ suffices\ to\ add\ any\ full\ memory\ barrier\ to\ both\ threads\ or\ a\ local\ Read-\/After-\/Write/Read-\/To-\/Write\ dependency\ or\ a\ control\ dependency.}}
\DoxyCodeLine{00719\ \textcolor{comment}{//}}
\DoxyCodeLine{00720\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00721\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ |\ \ \ \ Thread\ 1}}
\DoxyCodeLine{00722\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00723\ \textcolor{comment}{//\ \ \ r0\ =\ LOAD(x)\ \ \ |\ r1\ =\ LOAD(y)}}
\DoxyCodeLine{00724\ \textcolor{comment}{//\ \ \ if\ (r0\ ==\ 1)\ \ \ |\ if\ (r1\ ==\ 1)}}
\DoxyCodeLine{00725\ \textcolor{comment}{//\ \ \ \ \ STORE(y,\ 1)\ \ |\ \ \ STORE(x,\ 1)}}
\DoxyCodeLine{00726\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00727\ \textcolor{comment}{//}}
\DoxyCodeLine{00728\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00729\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ Thread\ 1}}
\DoxyCodeLine{00730\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00731\ \textcolor{comment}{//\ \ \ r0\ =\ LOAD(x)\ \ \ \ \ \ \ \ \ \ \ \ \ |\ r1\ =\ LOAD(y)}}
\DoxyCodeLine{00732\ \textcolor{comment}{//\ \ \ STORE(\&(y\ +\ r0\ -\/\ r1),\ 1)\ |\ STORE(\&(x\ +\ r1\ -\/\ r1),\ 1)}}
\DoxyCodeLine{00733\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00734\ \textcolor{comment}{//}}
\DoxyCodeLine{00735\ \textcolor{comment}{//\ \ \ Both\ fixes\ above\ ensure\ that\ both\ writes\ cannot\ be\ committed,\ made\ globally\ visible,\ until\ their\ program\ source\ code\ order\ preceding\ reads\ have\ been\ fully\ satisfied.}}
\DoxyCodeLine{00736\ \textcolor{comment}{//}}
\DoxyCodeLine{00737\ \textcolor{comment}{//\ \ \ ********\ Compiler\ Barriers\ ********}}
\DoxyCodeLine{00738\ \textcolor{comment}{//}}
\DoxyCodeLine{00739\ \textcolor{comment}{//\ \ \ Compiler\ barriers\ are\ both-\/sided\ barriers\ that\ prevent\ loads\ and\ stores\ from\ moving\ down\ past\ the\ compiler\ barrier\ and}}
\DoxyCodeLine{00740\ \textcolor{comment}{//\ \ \ loads\ and\ stores\ from\ moving\ up\ above\ the\ compiler\ barrier.\ Here\ we\ will\ see\ the\ various\ ways\ our\ code\ may\ be\ subject}}
\DoxyCodeLine{00741\ \textcolor{comment}{//\ \ \ to\ compiler\ optimizations\ and\ why\ compiler\ barriers\ are\ needed.\ Note\ as\ stated\ above,\ compiler\ barriers\ may\ not}}
\DoxyCodeLine{00742\ \textcolor{comment}{//\ \ \ prevent\ all\ compiler\ optimizations\ or\ transformations.\ Compiler\ barriers\ are\ usually\ implemented\ by\ reloading\ all}}
\DoxyCodeLine{00743\ \textcolor{comment}{//\ \ \ variables\ that\ are\ currently\ cached\ in\ registers\ and\ flushing\ all\ stores\ in\ registers\ back\ to\ memory.}}
\DoxyCodeLine{00744\ \textcolor{comment}{//\ \ \ This\ list\ isn't\ exhaustive\ but\ will\ hopefully\ try\ to\ outline\ what\ compiler\ barriers\ protect\ against\ and\ what\ they\ don't.}}
\DoxyCodeLine{00745\ \textcolor{comment}{//}}
\DoxyCodeLine{00746\ \textcolor{comment}{//\ \ \ Compiler\ may\ reorder\ loads.}}
\DoxyCodeLine{00747\ \textcolor{comment}{//\ \ \ LOAD\ A;\ LOAD\ B;\ -\/>\ LOAD\ B;\ LOAD\ A;}}
\DoxyCodeLine{00748\ \textcolor{comment}{//\ \ \ LOAD\ A;\ operation\ on\ A;\ LOAD\ B;\ operation\ on\ B;\ -\/>\ LOAD\ A;\ LOAD\ B;\ operation\ on\ A;\ operation\ on\ B}}
\DoxyCodeLine{00749\ \textcolor{comment}{//}}
\DoxyCodeLine{00750\ \textcolor{comment}{//\ \ \ Insert\ a\ compiler\ barrier\ in\ between\ the\ two\ loads\ to\ guarantee\ that\ they\ are\ kept\ in\ order.}}
\DoxyCodeLine{00751\ \textcolor{comment}{//\ \ \ LOAD\ A;\ COMPILER\_BARRIER;\ LOAD\ B;}}
\DoxyCodeLine{00752\ \textcolor{comment}{//\ \ \ LOAD\ A;\ operation\ on\ A;\ COMPILER\_BARRIER;\ LOAD\ B;\ operation\ on\ B;}}
\DoxyCodeLine{00753\ \textcolor{comment}{//}}
\DoxyCodeLine{00754\ \textcolor{comment}{//\ \ \ The\ same\ with\ stores.}}
\DoxyCodeLine{00755\ \textcolor{comment}{//\ \ \ STORE(A,\ 1);\ STORE(B,\ 1);\ -\/>\ STORE(B,\ 1);\ STORE(A,\ 1);}}
\DoxyCodeLine{00756\ \textcolor{comment}{//\ \ \ operations\ and\ STORE\ result\ into\ A;\ operations\ and\ STORE\ result\ int\ B;\ -\/>\ all\ operations;\ STORE\ result\ into\ B;\ STORE\ result\ into\ A;}}
\DoxyCodeLine{00757\ \textcolor{comment}{//}}
\DoxyCodeLine{00758\ \textcolor{comment}{//\ \ \ Insert\ a\ compiler\ barrier\ in\ between\ the\ two\ stores\ to\ guarantee\ that\ they\ are\ kept\ in\ order.}}
\DoxyCodeLine{00759\ \textcolor{comment}{//\ \ \ It\ is\ not\ required\ that\ the\ multiple\ stores\ to\ A\ before\ the\ barrier\ are\ not\ merged\ into\ one\ final\ store.}}
\DoxyCodeLine{00760\ \textcolor{comment}{//\ \ \ It\ is\ not\ required\ that\ the\ store\ to\ B\ after\ the\ barrier\ be\ written\ to\ memory,\ it\ may\ be\ cached\ in\ a\ register\ for\ some\ indeterminate}}
\DoxyCodeLine{00761\ \textcolor{comment}{//\ \ \ amount\ of\ time\ as\ an\ example.}}
\DoxyCodeLine{00762\ \textcolor{comment}{//\ \ \ STORE(A,\ 1);\ COMPILER\_BARRIER;\ STORE(B,\ 1);}}
\DoxyCodeLine{00763\ \textcolor{comment}{//}}
\DoxyCodeLine{00764\ \textcolor{comment}{//\ \ \ The\ compiler\ is\ allowed\ to\ merge\ overlapping\ loads\ and\ stores.}}
\DoxyCodeLine{00765\ \textcolor{comment}{//\ \ \ Inserting\ a\ compiler\ barrier\ here\ will\ not\ prevent\ the\ compiler\ from\ doing\ this\ optimization\ as\ doing\ one\ wider\ load/store\ is}}
\DoxyCodeLine{00766\ \textcolor{comment}{//\ \ \ technically\ still\ abiding\ by\ the\ guarantee\ that\ the\ loads/stores\ are\ not\ reordered\ with\ each\ other.}}
\DoxyCodeLine{00767\ \textcolor{comment}{//\ \ \ LOAD\ A[0];\ LOAD\ A[1];\ -\/>\ A\ single\ wider\ LOAD\ instruction}}
\DoxyCodeLine{00768\ \textcolor{comment}{//\ \ \ STORE(A[0],\ 1);\ STORE(A[1],\ 2);\ -\/>\ A\ single\ wider\ STORE\ instruction}}
\DoxyCodeLine{00769\ \textcolor{comment}{//}}
\DoxyCodeLine{00770\ \textcolor{comment}{//\ \ \ Compilers\ do\ not\ have\ to\ reload\ the\ values\ pointers\ point\ to.\ This\ is\ especially\ common\ with\ RISC\ architectures\ with\ lots}}
\DoxyCodeLine{00771\ \textcolor{comment}{//\ \ \ of\ general\ purpose\ registers\ or\ even\ compiler\ optimizations\ such\ as\ inlining\ or\ Link-\/Time\ Optimization.}}
\DoxyCodeLine{00772\ \textcolor{comment}{//\ \ \ int\ i\ =\ *ptr;\ Do\ bunch\ of\ operations;\ if\ (*ptr)\ \{\ do\ more;\ \}}}
\DoxyCodeLine{00773\ \textcolor{comment}{//\ \ \ It\ is\ entirely\ possible\ the\ compiler\ may\ remove\ the\ last\ if\ statement\ because\ it\ can\ keep\ the\ *ptr\ in\ a\ register}}
\DoxyCodeLine{00774\ \textcolor{comment}{//\ \ \ and\ it\ may\ infer\ from\ the\ operations\ done\ on\ i\ that\ i\ is\ never\ 0.}}
\DoxyCodeLine{00775\ \textcolor{comment}{//}}
\DoxyCodeLine{00776\ \textcolor{comment}{//\ \ \ int\ i\ =\ *ptr;\ Do\ bunch\ of\ operations;\ COMPILER\_BARRIER;\ if\ (*ptr)\ \{\ do\ more;\ \}}}
\DoxyCodeLine{00777\ \textcolor{comment}{//\ \ \ Inserting\ a\ compiler\ barrier\ at\ that\ location\ will\ cause\ the\ compiler\ to\ have\ reload\ *ptr\ thus\ keeping\ the\ if\ statement\ assuming}}
\DoxyCodeLine{00778\ \textcolor{comment}{//\ \ \ no\ other\ optimizations\ take\ place,\ such\ as\ the\ compiler\ knowing\ that\ *ptr\ is\ always\ greater\ than\ 0.}}
\DoxyCodeLine{00779\ \textcolor{comment}{//}}
\DoxyCodeLine{00780\ \textcolor{comment}{//\ \ \ The\ compiler\ is\ within\ its\ rights\ to\ also\ merge\ and\ reload\ loads\ as\ much\ as\ it\ pleases.}}
\DoxyCodeLine{00781\ \textcolor{comment}{//}}
\DoxyCodeLine{00782\ \textcolor{comment}{//\ \ \ while\ (int\ tmp\ =\ LOAD(A))}}
\DoxyCodeLine{00783\ \textcolor{comment}{//\ \ \ \ \ \ \ \ process\_tmp(tmp)}}
\DoxyCodeLine{00784\ \textcolor{comment}{//}}
\DoxyCodeLine{00785\ \textcolor{comment}{//\ \ \ Will\ be\ merged\ and\ transformed\ to}}
\DoxyCodeLine{00786\ \textcolor{comment}{//}}
\DoxyCodeLine{00787\ \textcolor{comment}{//\ \ \ if\ (int\ tmp\ =\ LOAD(A))}}
\DoxyCodeLine{00788\ \textcolor{comment}{//\ \ \ \ \ \ \ \ for\ (;;)\ process\_tmp(tmp)}}
\DoxyCodeLine{00789\ \textcolor{comment}{//}}
\DoxyCodeLine{00790\ \textcolor{comment}{//\ \ \ Inserting\ a\ compiler\ barrier\ will\ ensure\ that\ LOAD(A)\ is\ always\ reloaded\ and\ thus\ the\ unwanted\ transformation\ is\ avoided.}}
\DoxyCodeLine{00791\ \textcolor{comment}{//}}
\DoxyCodeLine{00792\ \textcolor{comment}{//\ \ \ while\ (int\ tmp\ =\ LOAD(A))}}
\DoxyCodeLine{00793\ \textcolor{comment}{//\ \ \ \{}}
\DoxyCodeLine{00794\ \textcolor{comment}{//\ \ \ \ \ \ \ process\_tmp(tmp)}}
\DoxyCodeLine{00795\ \textcolor{comment}{//\ \ \ \ \ \ \ COMPILER\_BARRIER}}
\DoxyCodeLine{00796\ \textcolor{comment}{//\ \ \ \}}}
\DoxyCodeLine{00797\ \textcolor{comment}{//}}
\DoxyCodeLine{00798\ \textcolor{comment}{//\ \ \ Under\ heavy\ register\ pressure\ scenarios,\ say\ the\ loop\ body\ was\ larger,\ the\ compiler\ may\ reload\ A\ as\ follows.}}
\DoxyCodeLine{00799\ \textcolor{comment}{//\ \ \ Compiler\ barriers\ cannot\ prevent\ this\ from\ happening,\ even\ if\ we\ put\ it\ after\ process\_tmp\ as\ above;}}
\DoxyCodeLine{00800\ \textcolor{comment}{//\ \ \ the\ compiler\ still\ kept\ those\ loads\ above\ the\ barrier\ so\ it\ satisfied\ its\ contract\ even\ though\ it\ reloaded}}
\DoxyCodeLine{00801\ \textcolor{comment}{//\ \ \ from\ A\ more\ than\ once.}}
\DoxyCodeLine{00802\ \textcolor{comment}{//}}
\DoxyCodeLine{00803\ \textcolor{comment}{//\ \ \ while\ (int\ tmp\ =\ LOAD(A))}}
\DoxyCodeLine{00804\ \textcolor{comment}{//\ \ \ \ \ \ \ process\_tmp(LOAD(A))}}
\DoxyCodeLine{00805\ \textcolor{comment}{//}}
\DoxyCodeLine{00806\ \textcolor{comment}{//\ \ \ In\ the\ above\ transformation\ it\ is\ possible\ that\ another\ cpu\ stores\ 0\ into\ A.\ When\ we\ reload\ A\ for\ process\_tmp,\ we\ pass\ 0}}
\DoxyCodeLine{00807\ \textcolor{comment}{//\ \ \ to\ process\_tmp()\ which\ it\ would\ actually\ never\ expect\ to\ observe.\ Because\ if\ we\ observed\ 0,\ the\ while\ loop\ condition}}
\DoxyCodeLine{00808\ \textcolor{comment}{//\ \ \ would\ never\ be\ satisfied.\ If\ the\ compiler\ under\ register\ pressure\ instead\ stored\ and\ loaded\ tmp\ from\ its\ stack\ slot,\ that\ is\ fine}}
\DoxyCodeLine{00809\ \textcolor{comment}{//\ \ \ because\ we\ are\ just\ storing\ and\ loading\ the\ original\ observed\ value\ from\ A.\ Obviously\ that\ is\ slower\ than\ just\ reloading\ from}}
\DoxyCodeLine{00810\ \textcolor{comment}{//\ \ \ A\ again\ so\ an\ optimizing\ compiler\ may\ not\ do\ the\ stack\ slot\ store.\ This\ is\ an\ unwanted\ transformation\ which\ eastl::atomic<T>\ prevents}}
\DoxyCodeLine{00811\ \textcolor{comment}{//\ \ \ even\ on\ relaxed\ loads.}}
\DoxyCodeLine{00812\ \textcolor{comment}{//}}
\DoxyCodeLine{00813\ \textcolor{comment}{//\ \ \ The\ compiler\ is\ allowed\ to\ do\ dead-\/store\ elimination\ if\ it\ knows\ that\ value\ has\ already\ been\ stored,\ or\ that\ only\ the\ last\ store}}
\DoxyCodeLine{00814\ \textcolor{comment}{//\ \ \ needs\ to\ be\ stored.\ The\ compiler\ does\ not\ assume\ or\ know\ that\ these\ variables\ are\ shared\ variables.}}
\DoxyCodeLine{00815\ \textcolor{comment}{//}}
\DoxyCodeLine{00816\ \textcolor{comment}{//\ \ \ STORE(A,\ 1);\ \ \ \ \ \ \ \ \ STORE(A,\ 1);}}
\DoxyCodeLine{00817\ \textcolor{comment}{//\ \ \ OPERATIONS;\ \ \ \ \ -\/>\ \ \ OPERATIONS;}}
\DoxyCodeLine{00818\ \textcolor{comment}{//\ \ \ STORE(A,\ 1);}}
\DoxyCodeLine{00819\ \textcolor{comment}{//}}
\DoxyCodeLine{00820\ \textcolor{comment}{//\ \ \ The\ compiler\ is\ well\ within\ its\ rights\ to\ omit\ the\ second\ store\ to\ A.\ Assuming\ we\ are\ doing\ some\ fancy\ lockfree\ communication}}
\DoxyCodeLine{00821\ \textcolor{comment}{//\ \ \ with\ another\ cpu\ and\ the\ last\ store\ is\ meant\ to\ ensure\ the\ ending\ value\ is\ 1\ even\ if\ another\ cpu\ changed\ A\ in\ between;\ that}}
\DoxyCodeLine{00822\ \textcolor{comment}{//\ \ \ assumption\ will\ not\ be\ satisfied.\ A\ compiler\ barrier\ will\ not\ prevent\ the\ last\ store\ from\ being\ dead-\/store\ removed.}}
\DoxyCodeLine{00823\ \textcolor{comment}{//}}
\DoxyCodeLine{00824\ \textcolor{comment}{//\ \ \ STORE(A,\ 1);}}
\DoxyCodeLine{00825\ \textcolor{comment}{//\ \ \ OPERATIONS;}}
\DoxyCodeLine{00826\ \textcolor{comment}{//\ \ \ STORE(A,\ 2);}}
\DoxyCodeLine{00827\ \textcolor{comment}{//}}
\DoxyCodeLine{00828\ \textcolor{comment}{//\ \ \ Assuming\ these\ stores\ are\ meant\ to\ denote\ some\ state\ changes\ to\ communicate\ with\ a\ remote\ cpu.\ The\ compiler\ is\ allowed\ to}}
\DoxyCodeLine{00829\ \textcolor{comment}{//\ \ \ transform\ this\ as\ follows\ without\ a\ compiler\ barrier.\ Insert\ a\ compiler\ barrier\ between\ the\ two\ stores\ to\ prevent\ the\ transformation.}}
\DoxyCodeLine{00830\ \textcolor{comment}{//\ \ \ Something\ like\ this\ will\ also\ require\ memory\ barriers,\ but\ that\ is\ not\ the\ point\ of\ this\ section.}}
\DoxyCodeLine{00831\ \textcolor{comment}{//}}
\DoxyCodeLine{00832\ \textcolor{comment}{//\ \ \ STORE(A,\ 2);}}
\DoxyCodeLine{00833\ \textcolor{comment}{//\ \ \ OPERATIONS;}}
\DoxyCodeLine{00834\ \textcolor{comment}{//}}
\DoxyCodeLine{00835\ \textcolor{comment}{//\ \ \ The\ compiler\ is\ also\ allowed\ to\ invent\ stores\ as\ it\ may\ please.}}
\DoxyCodeLine{00836\ \textcolor{comment}{//\ \ \ First\ on\ many\ RISC\ architectures\ storing\ an\ immediate\ value\ either\ involves\ loading\ the\ immediate\ from\ the\ .data\ section}}
\DoxyCodeLine{00837\ \textcolor{comment}{//\ \ \ or\ combing\ a\ variety\ of\ load\ upper\ immediate\ and\ add\ or\ or\ immediate\ instructions\ to\ get\ our\ constant\ in\ a\ register\ and\ then}}
\DoxyCodeLine{00838\ \textcolor{comment}{//\ \ \ doing\ a\ single\ 32-\/bit\ store\ instruction\ from\ said\ register.\ Some\ ISAs\ have\ 16-\/bit\ stores\ with\ immediate\ value\ so\ that\ a\ store}}
\DoxyCodeLine{00839\ \textcolor{comment}{//\ \ \ may\ be\ broken\ into\ 2\ 16-\/bit\ store\ immediate\ values\ causing\ shearing.\ To\ reduce\ instruction\ dependencies\ it\ may\ also\ decide}}
\DoxyCodeLine{00840\ \textcolor{comment}{//\ \ \ to\ do\ two\ add\ immediates\ and\ then\ two\ 16-\/bit\ stores\ again\ causing\ shearing.}}
\DoxyCodeLine{00841\ \textcolor{comment}{//}}
\DoxyCodeLine{00842\ \textcolor{comment}{//\ \ \ lui\ \$t0,\ 1\ \ \ \ \ \ \ \#\ t0\ ==\ 0x00010000}}
\DoxyCodeLine{00843\ \textcolor{comment}{//\ \ \ ori\ \$a0,\ \$t0,\ 8\ \ \#\ t0\ ==\ 0x00010008}}
\DoxyCodeLine{00844\ \textcolor{comment}{//\ \ \ strw\ \$t0,\ 0(\$a1)\ \#\ store\ t0\ into\ address\ at\ a1}}
\DoxyCodeLine{00845\ \textcolor{comment}{//\ \ \ -\/>}}
\DoxyCodeLine{00846\ \textcolor{comment}{//\ \ \ ori\ \$a0,\ \$t0,\ 1\ \ \ \#\ t0\ ==\ 0x00000001}}
\DoxyCodeLine{00847\ \textcolor{comment}{//\ \ \ ori\ \$a0,\ \$t1,\ 8\ \ \ \#\ t0\ ==\ 0x00000008}}
\DoxyCodeLine{00848\ \textcolor{comment}{//\ \ \ strhw\ \$t0,\ 0(\$a1)\ \#\ store\ t0\ lower\ half\ at\ a1}}
\DoxyCodeLine{00849\ \textcolor{comment}{//\ \ \ strhw\ \$t1,\ 2(\$a1)\ \#\ store\ t1\ upper\ half\ at\ a1}}
\DoxyCodeLine{00850\ \textcolor{comment}{//}}
\DoxyCodeLine{00851\ \textcolor{comment}{//\ \ \ The\ above\ shows\ a\ potential\ transformation\ that\ a\ compiler\ barrier\ cannot\ solve\ for\ us.}}
\DoxyCodeLine{00852\ \textcolor{comment}{//}}
\DoxyCodeLine{00853\ \textcolor{comment}{//\ \ \ A\ compiler\ may\ also\ introduce\ stores\ to\ save\ on\ branching.\ Let's\ see.}}
\DoxyCodeLine{00854\ \textcolor{comment}{//}}
\DoxyCodeLine{00855\ \textcolor{comment}{//\ \ \ if\ (a)}}
\DoxyCodeLine{00856\ \textcolor{comment}{//\ \ \ \ \ STORE(X,\ 10);}}
\DoxyCodeLine{00857\ \textcolor{comment}{//\ \ \ else}}
\DoxyCodeLine{00858\ \textcolor{comment}{//\ \ \ \ \ STORE(X,\ 20);}}
\DoxyCodeLine{00859\ \textcolor{comment}{//}}
\DoxyCodeLine{00860\ \textcolor{comment}{//\ \ \ STORE(X,\ 20);}}
\DoxyCodeLine{00861\ \textcolor{comment}{//\ \ \ if\ (a)}}
\DoxyCodeLine{00862\ \textcolor{comment}{//\ \ \ \ \ STORE(X,\ 10);}}
\DoxyCodeLine{00863\ \textcolor{comment}{//}}
\DoxyCodeLine{00864\ \textcolor{comment}{//\ \ \ This\ is\ a\ very\ common\ optimization\ as\ it\ saves\ a\ potentially\ more\ expensive\ branch\ instruction\ but\ breaks\ multi-\/threaded\ code.}}
\DoxyCodeLine{00865\ \textcolor{comment}{//\ \ \ This\ is\ also\ another\ case\ where\ a\ compiler\ barrier\ doesn't\ give\ us\ the\ granularity\ we\ need.}}
\DoxyCodeLine{00866\ \textcolor{comment}{//\ \ \ The\ branches\ may\ even\ be\ completely\ removed\ with\ the\ compiler\ instead\ choosing\ to\ use\ conditional\ move\ operations\ which\ would}}
\DoxyCodeLine{00867\ \textcolor{comment}{//\ \ \ actually\ be\ compliant\ since\ there\ would\ be\ one\ store\ only\ done,\ an\ extra\ store\ wouldn't\ have\ been\ added.}}
\DoxyCodeLine{00868\ \textcolor{comment}{//}}
\DoxyCodeLine{00869\ \textcolor{comment}{//\ \ \ You\ are\ now\ probably\ thinking\ that\ compiler\ barriers\ are\ useful\ and\ are\ definitely\ needed\ to\ tell\ the\ compiler\ to\ calm\ down}}
\DoxyCodeLine{00870\ \textcolor{comment}{//\ \ \ and\ guarantee\ our\ hardware\ guarantees\ are\ valid\ because\ the\ code\ we\ wrote\ is\ the\ instructions\ that\ were\ emitted.}}
\DoxyCodeLine{00871\ \textcolor{comment}{//\ \ \ But\ there\ are\ definitely\ lots\ of\ caveats\ where\ compiler\ barriers\ do\ not\ at\ all\ provide\ the\ guarantees\ we\ still\ need.}}
\DoxyCodeLine{00872\ \textcolor{comment}{//\ \ \ This\ where\ eastl::atomic<T>\ comes\ into\ play,\ and\ under\ the\ relaxed\ memory\ ordering\ section\ it\ will\ be\ explained}}
\DoxyCodeLine{00873\ \textcolor{comment}{//\ \ \ what\ the\ standard\ guarantees\ and\ how\ we\ achieve\ those\ guarantees,\ like\ ensuring\ the\ compiler\ never\ does\ dead-\/store\ elimination\ or\ reloads.}}
\DoxyCodeLine{00874\ \textcolor{comment}{//}}
\DoxyCodeLine{00875\ \textcolor{comment}{//\ \ \ ********\ Control\ Dependencies\ ********}}
\DoxyCodeLine{00876\ \textcolor{comment}{//}}
\DoxyCodeLine{00877\ \textcolor{comment}{//\ \ \ Control\ dependencies\ are\ implicit\ local\ cpu\ ordering\ of\ memory\ instructions\ due\ to\ branching\ instructions,\ specifically}}
\DoxyCodeLine{00878\ \textcolor{comment}{//\ \ \ only\ conditional\ branches.\ The\ problem\ is\ compilers\ do\ not\ understand\ control\ dependencies,\ and\ control\ dependencies}}
\DoxyCodeLine{00879\ \textcolor{comment}{//\ \ \ are\ incredibly\ hard\ to\ understand.\ This\ is\ meant\ to\ make\ the\ reader\ aware\ they\ exist\ and\ to\ never\ use\ them}}
\DoxyCodeLine{00880\ \textcolor{comment}{//\ \ \ because\ they\ shouldn't\ be\ needed\ at\ all\ with\ eastl::atomic<T>.\ Also\ control\ dependencies\ are\ categorized\ as\ LDLD\ or\ LDST,}}
\DoxyCodeLine{00881\ \textcolor{comment}{//\ \ \ store\ control\ dependencies\ inherently\ do\ not\ make\ sense\ since\ the\ conditional\ branch\ loads\ and\ compares\ two\ values.}}
\DoxyCodeLine{00882\ \textcolor{comment}{//}}
\DoxyCodeLine{00883\ \textcolor{comment}{//\ \ \ A\ LDLD\ control\ dependency\ is\ an\ anti-\/pattern\ since\ it\ is\ not\ guaranteed\ that\ any\ architecture\ will\ detect\ the\ memory-\/order\ violation.}}
\DoxyCodeLine{00884\ \textcolor{comment}{//\ \ \ r0\ =\ LOAD(A);}}
\DoxyCodeLine{00885\ \textcolor{comment}{//\ \ \ if\ (r0)}}
\DoxyCodeLine{00886\ \textcolor{comment}{//\ \ \ \ \ \ \ r1\ =\ LOAD(B)}}
\DoxyCodeLine{00887\ \textcolor{comment}{//}}
\DoxyCodeLine{00888\ \textcolor{comment}{//\ \ \ Given\ those\ sequence\ of\ instructions,\ it\ is\ entirely\ possible\ that\ a\ cpu\ attempts\ to\ speculatively\ predict\ and\ load\ the\ value\ of\ B}}
\DoxyCodeLine{00889\ \textcolor{comment}{//\ \ \ before\ the\ branch\ instruction\ has\ finished\ executing.\ It\ is\ entirely\ allowed\ that\ the\ cpu\ loads\ from\ B,\ assume\ B\ is\ in\ cache\ and\ A}}
\DoxyCodeLine{00890\ \textcolor{comment}{//\ \ \ is\ not\ in\ cache,\ before\ A.\ It\ is\ allowed,\ that\ even\ if\ the\ cpu\ was\ correct\ in\ it's\ prediction\ that\ it\ doesn't\ reload\ B\ and\ change\ the}}
\DoxyCodeLine{00891\ \textcolor{comment}{//\ \ \ fact\ that\ it\ speculatively\ got\ lucky.}}
\DoxyCodeLine{00892\ \textcolor{comment}{//}}
\DoxyCodeLine{00893\ \textcolor{comment}{//\ \ \ This\ is\ also\ what\ the\ x86\ pause\ instruction\ inserted\ into\ spin\ wait\ loops\ is\ meant\ to\ solve.}}
\DoxyCodeLine{00894\ \textcolor{comment}{//\ \ \ LOOP:}}
\DoxyCodeLine{00895\ \textcolor{comment}{//\ \ \ \ \ \ \ r0\ =\ LOAD(A);}}
\DoxyCodeLine{00896\ \textcolor{comment}{//\ \ \ \ \ \ \ if\ (!r0)\ pause;\ goto\ LOOP;}}
\DoxyCodeLine{00897\ \textcolor{comment}{//}}
\DoxyCodeLine{00898\ \textcolor{comment}{//\ \ \ In\ the\ above\ spin\ loop,\ after\ a\ couple\ of\ iterations\ the\ processor\ will\ fill\ the\ pipeline\ with\ speculated\ cmp\ and\ load\ instructions.}}
\DoxyCodeLine{00899\ \textcolor{comment}{//\ \ \ x86\ will\ catch\ a\ memory\ order\ violation\ if\ it\ sees\ that\ an\ external\ store\ was\ done\ to\ A\ and\ thus\ must\ flush\ the\ entire}}
\DoxyCodeLine{00900\ \textcolor{comment}{//\ \ \ pipeline\ of\ all\ the\ speculated\ load\ A.\ Pause\ instruction\ tells\ the\ cpu\ to\ not\ do\ speculative\ loads\ so\ that\ the\ pipeline\ is\ not}}
\DoxyCodeLine{00901\ \textcolor{comment}{//\ \ \ filled\ with\ all\ said\ speculative\ load\ instructions.\ This\ ensures\ we\ do\ not\ incur\ the\ costly\ pipeline\ flushes\ from\ memory\ order}}
\DoxyCodeLine{00902\ \textcolor{comment}{//\ \ \ violations\ which\ are\ likely\ to\ occur\ in\ tight\ spin\ wait\ loops.\ This\ also\ allows\ other\ threads\ on\ the\ same\ physical\ core\ to\ use\ the}}
\DoxyCodeLine{00903\ \textcolor{comment}{//\ \ \ core's\ resources\ better\ since\ our\ speculative\ nature\ won't\ be\ hogging\ it\ all.}}
\DoxyCodeLine{00904\ \textcolor{comment}{//}}
\DoxyCodeLine{00905\ \textcolor{comment}{//\ \ \ A\ LDST\ control\ dependency\ is\ a\ true\ dependency\ in\ which\ the\ cpu\ cannot\ make\ a\ store\ visible\ to\ the\ system\ and\ other\ cpus\ until\ it}}
\DoxyCodeLine{00906\ \textcolor{comment}{//\ \ \ knows\ its\ prediction\ is\ correct.\ Thus\ a\ LDST\ ordering\ is\ guaranteed\ and\ can\ be\ always\ relied\ upon\ as\ in\ the\ following\ example.}}
\DoxyCodeLine{00907\ \textcolor{comment}{//}}
\DoxyCodeLine{00908\ \textcolor{comment}{//\ \ \ r0\ =\ LOAD(A);}}
\DoxyCodeLine{00909\ \textcolor{comment}{//\ \ \ if\ (r0)}}
\DoxyCodeLine{00910\ \textcolor{comment}{//\ \ \ \ \ \ \ STORE(B,\ 1);}}
\DoxyCodeLine{00911\ \textcolor{comment}{//}}
\DoxyCodeLine{00912\ \textcolor{comment}{//\ \ \ The\ fun\ part\ comes\ in\ with\ how\ does\ the\ compiler\ actually\ break\ all\ of\ this.}}
\DoxyCodeLine{00913\ \textcolor{comment}{//\ \ \ First\ is\ that\ if\ the\ compiler\ can\ ensure\ that\ the\ value\ of\ A\ in\ the\ LDST\ example\ is\ always\ not\ zero,\ then\ it\ is\ always\ within\ its}}
\DoxyCodeLine{00914\ \textcolor{comment}{//\ \ \ rights\ to\ completely\ remove\ the\ if\ statement\ which\ would\ lend\ us\ with\ no\ control\ dependency.}}
\DoxyCodeLine{00915\ \textcolor{comment}{//}}
\DoxyCodeLine{00916\ \textcolor{comment}{//\ \ \ Things\ get\ more\ fun\ when\ we\ deal\ with\ conditionals\ with\ else\ and\ else\ if\ statements\ where\ the\ compiler\ might\ be\ able\ to\ employ}}
\DoxyCodeLine{00917\ \textcolor{comment}{//\ \ \ invariant\ code\ motion\ optimizations.\ Take\ this\ example.}}
\DoxyCodeLine{00918\ \textcolor{comment}{//}}
\DoxyCodeLine{00919\ \textcolor{comment}{//\ \ \ r0\ =\ LOAD(A);}}
\DoxyCodeLine{00920\ \textcolor{comment}{//\ \ \ r1\ =\ LOAD(B);}}
\DoxyCodeLine{00921\ \textcolor{comment}{//\ \ \ if\ (r0)}}
\DoxyCodeLine{00922\ \textcolor{comment}{//\ \ \ \ \ \ \ STORE(B,\ 1);}}
\DoxyCodeLine{00923\ \textcolor{comment}{//\ \ \ \ \ \ \ /*\ MORE\ CODE\ */}}
\DoxyCodeLine{00924\ \textcolor{comment}{//\ \ \ else\ if\ (r1)}}
\DoxyCodeLine{00925\ \textcolor{comment}{//\ \ \ \ \ \ \ STORE(B,\ 1);}}
\DoxyCodeLine{00926\ \textcolor{comment}{//\ \ \ \ \ \ \ /*\ MORE\ CODE\ */}}
\DoxyCodeLine{00927\ \textcolor{comment}{//\ \ \ else}}
\DoxyCodeLine{00928\ \textcolor{comment}{//\ \ \ \ \ \ \ STORE(B,\ 1);}}
\DoxyCodeLine{00929\ \textcolor{comment}{//\ \ \ \ \ \ \ /*\ MORE\ CODE\ */}}
\DoxyCodeLine{00930\ \textcolor{comment}{//}}
\DoxyCodeLine{00931\ \textcolor{comment}{//\ \ \ If\ we\ were\ trying\ to\ be\ smart\ and\ entirely\ rely\ on\ the\ control\ dependency\ to\ ensure\ order,\ ya\ well\ just\ don't\ the\ compiler}}
\DoxyCodeLine{00932\ \textcolor{comment}{//\ \ \ is\ always\ smarter.\ The\ compiler\ is\ well\ within\ its\ rights\ to\ move\ all\ the\ STORE(B,\ 1)\ up\ and\ above\ all\ the\ conditionals\ breaking}}
\DoxyCodeLine{00933\ \textcolor{comment}{//\ \ \ our\ reliance\ on\ the\ LDST\ control\ dependency.}}
\DoxyCodeLine{00934\ \textcolor{comment}{//}}
\DoxyCodeLine{00935\ \textcolor{comment}{//\ \ \ Things\ can\ get\ even\ more\ complicated\ especially\ in\ C++\ when\ values\ may\ come\ from\ constexpr,\ inline,\ inline\ constexpr,\ static\ const,\ etc,}}
\DoxyCodeLine{00936\ \textcolor{comment}{//\ \ \ variables\ and\ thus\ the\ compiler\ will\ do\ all\ sorts\ of\ transformations\ to\ reduce,\ remove,\ augment\ and\ change\ all\ your\ conditional\ code\ since}}
\DoxyCodeLine{00937\ \textcolor{comment}{//\ \ \ it\ knows\ the\ values\ of\ the\ expressions\ or\ even\ parts\ of\ it\ at\ compile\ time.\ Even\ more\ aggressive\ optimizations\ like\ LTO\ might\ break\ code\ that\ was\ being\ cautious.}}
\DoxyCodeLine{00938\ \textcolor{comment}{//\ \ \ Even\ adding\ simple\ short\ circuiting\ logic\ or\ your\ classic\ likely/unlikely\ macros\ can\ alter\ conditionals\ in\ ways\ you\ didn't\ expect.}}
\DoxyCodeLine{00939\ \textcolor{comment}{//\ \ \ In\ short\ know\ enough\ about\ control\ dependencies\ to\ know\ not\ to\ ever\ use\ them.}}
\DoxyCodeLine{00940\ \textcolor{comment}{//}}
\DoxyCodeLine{00941\ \textcolor{comment}{//\ \ \ ********\ Multi-\/Copy\ Store\ Atomicity\ \&\&\ Barrier\ Cumulativity\ ********}}
\DoxyCodeLine{00942\ \textcolor{comment}{//}}
\DoxyCodeLine{00943\ \textcolor{comment}{//\ \ \ Single-\/Copy\ Store\ Atomicity:\ All\ stores\ must\ become\ visible\ to\ all\ cores\ in\ the\ system\ at\ the\ same\ time.}}
\DoxyCodeLine{00944\ \textcolor{comment}{//}}
\DoxyCodeLine{00945\ \textcolor{comment}{//\ \ \ Multi-\/Copy\ Store\ Atomicity\ :\ This\ means\ a\ cpu\ sees\ its\ own\ stores\ before\ they\ become\ visible\ to\ other\ cpus,\ by\ forwarding\ them\ from\ the\ store\ buffer,}}
\DoxyCodeLine{00946\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ but\ a\ store\ becomes\ visible\ to\ all\ other\ cpus\ at\ the\ same\ time\ when\ flushed\ from\ the\ store\ buffer.}}
\DoxyCodeLine{00947\ \textcolor{comment}{//}}
\DoxyCodeLine{00948\ \textcolor{comment}{//\ \ \ Non-\/Atomic\ Store\ Atomicity\ :\ A\ store\ becomes\ visible\ to\ different\ cpus\ at\ different\ times.}}
\DoxyCodeLine{00949\ \textcolor{comment}{//}}
\DoxyCodeLine{00950\ \textcolor{comment}{//\ \ \ Those\ are\ the\ above\ variations\ of\ Store\ Atomicity.\ Most\ processors\ have\ Non-\/Atomic\ Store\ Atomicity\ and\ thus\ you\ must\ program\ to\ that\ lowest\ common\ denominator.}}
\DoxyCodeLine{00951\ \textcolor{comment}{//\ \ \ We\ can\ use\ barriers,\ with\ some\ caveats,\ to\ restore\ Multi-\/Copy\ Store\ Atomicity\ to\ a\ Non-\/Atomic\ system\ though\ we\ need\ to\ define\ a\ new\ granular\ definition\ for}}
\DoxyCodeLine{00952\ \textcolor{comment}{//\ \ \ memory\ barriers\ to\ define\ this\ behaviour.\ Simple\ LDLD/LDST/STST/STLD\ definition\ is\ not\ enough\ to\ categorize\ memory\ barriers\ at\ this\ level.\ Let's\ start\ off}}
\DoxyCodeLine{00953\ \textcolor{comment}{//\ \ \ with\ a\ simple\ example\ that\ breaks\ under\ a\ Non-\/Atomic\ Store\ Atomicity\ system\ and\ what\ potential\ hardware\ features\ allow\ this\ behaviour\ to\ be\ observed.}}
\DoxyCodeLine{00954\ \textcolor{comment}{//}}
\DoxyCodeLine{00955\ \textcolor{comment}{//\ \ \ NOTE:\ For\ all\ the\ below\ examples\ we\ assume\ no\ compile\ reordering\ and\ that\ the\ processor\ also\ executes\ the\ instructions\ with\ no\ local\ reorderings\ to\ make\ the\ examples\ simpler,}}
\DoxyCodeLine{00956\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ to\ only\ show\ off\ the\ effects\ of\ Multi-\/Copy\ Store\ Atomicity.\ This\ is\ why\ we\ don't\ add\ any\ address\ dependencies,\ or\ mark\ explicit\ LDLD/LDST\ memory\ barriers.}}
\DoxyCodeLine{00957\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ Thus\ you\ may\ assume\ all\ LDLD\ and\ LDST\ pairs\ have\ an\ address\ dependency\ between\ them,\ so\ that\ they\ are\ not\ reordered\ by\ the\ compiler\ or\ the\ local\ cpu.}}
\DoxyCodeLine{00958\ \textcolor{comment}{//}}
\DoxyCodeLine{00959\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00960\ \textcolor{comment}{//\ \ \ Write-\/To-\/Read\ Causality,\ WRC,\ Litmus\ Test}}
\DoxyCodeLine{00961\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00962\ \textcolor{comment}{//\ \ \ Initial\ State:}}
\DoxyCodeLine{00963\ \textcolor{comment}{//\ \ \ X\ =\ 0;\ Y\ =\ 0;}}
\DoxyCodeLine{00964\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00965\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 2}}
\DoxyCodeLine{00966\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00967\ \textcolor{comment}{//\ \ \ STORE(X,\ 1)\ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r0\ =\ LOAD(X)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r1\ =\ LOAD(Y)}}
\DoxyCodeLine{00968\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ STORE(Y,\ r0)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r2\ =\ LOAD(X)}}
\DoxyCodeLine{00969\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00970\ \textcolor{comment}{//\ \ \ Observed:\ r0\ =\ 1\ \&\&\ r1\ =\ 1\ \&\&\ r2\ =\ 0}}
\DoxyCodeLine{00971\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00972\ \textcolor{comment}{//}}
\DoxyCodeLine{00973\ \textcolor{comment}{//\ \ \ Let's\ go\ over\ this\ example\ in\ detail\ and\ whether\ the\ outcome\ shown\ above\ can\ be\ observed.\ In\ this\ example\ Thread\ 0\ stores\ 1\ into\ X.\ If\ Thread\ 1\ observes\ the\ write\ to\ X,}}
\DoxyCodeLine{00974\ \textcolor{comment}{//\ \ \ it\ stores\ the\ observed\ value\ into\ Y.\ Thread\ 2\ loads\ from\ Y\ then\ X.\ This\ means\ if\ the\ load\ from\ Y\ returns\ 1,\ then\ we\ intuitively\ know\ the\ global\ store\ order}}
\DoxyCodeLine{00975\ \textcolor{comment}{//\ \ \ was\ 1\ to\ X\ and\ then\ 1\ to\ Y.\ So\ is\ it\ possible\ then\ that\ the\ load\ from\ X\ in\ Thread\ 2\ can\ return\ 0\ in\ that\ case?\ Under\ a\ Multi-\/Copy\ Store\ Atomicity\ system,\ that\ would\ be}}
\DoxyCodeLine{00976\ \textcolor{comment}{//\ \ \ impossible\ because\ once\ 1\ was\ stored\ to\ X\ all\ cpus\ see\ that\ store\ so\ if\ Thread\ 2\ saw\ the\ store\ to\ Y\ which\ can\ only\ happen\ after\ the\ store\ to\ X\ was\ observed,\ then}}
\DoxyCodeLine{00977\ \textcolor{comment}{//\ \ \ Thread\ 2\ must\ also\ have\ observed\ the\ store\ to\ X\ and\ return\ 1.\ As\ you\ may\ well\ have\ figured\ out,\ it\ is\ possible\ under\ a\ Non-\/Atomic\ Store\ Atomicity\ system\ to\ still}}
\DoxyCodeLine{00978\ \textcolor{comment}{//\ \ \ observe\ the\ load\ from\ X\ returning\ 0\ even\ if\ the\ above\ load\ from\ Y\ returned\ 1\ in\ Thread\ 2.\ This\ completely\ breaks\ our\ intuition\ of\ causality.\ Let's\ now\ understand\ what\ hardware\ may\ cause\ this.}}
\DoxyCodeLine{00979\ \textcolor{comment}{//}}
\DoxyCodeLine{00980\ \textcolor{comment}{//\ \ \ This\ is\ possible\ on\ cpus\ that\ have\ Simultaneous\ Multi-\/Threading,\ SMT\ or\ HyperThreading\ in\ Intel\ parlance,\ which\ share\ resources\ such\ as\ store\ buffers\ or\ L1\ cache.}}
\DoxyCodeLine{00981\ \textcolor{comment}{//\ \ \ We\ are\ accustomed\ to\ the\ x86\ way\ of\ SMT\ where\ each\ logical\ core\ shares\ Execution\ Units\ on\ the\ physical\ core\ but\ each\ logical\ core\ has\ their\ own\ statically\ partitioned}}
\DoxyCodeLine{00982\ \textcolor{comment}{//\ \ \ cache\ and\ store\ buffer\ that\ is\ not\ visible\ to\ the\ other\ cpus.\ It\ is\ possible\ on\ cpus\ like\ ARMv7\ or\ POWER,\ POWER9\ supports\ 4\ and\ even\ 8\ threads\ per\ physical\ core,\ so}}
\DoxyCodeLine{00983\ \textcolor{comment}{//\ \ \ to\ save\ on\ die\ space\ though\ yet\ enable\ this\ large\ number\ of\ threads\ per\ physical\ core\ it\ is\ common\ for\ these\ logical\ cores\ to\ all\ use\ the\ same\ store\ buffer\ or\ L1\ cache}}
\DoxyCodeLine{00984\ \textcolor{comment}{//\ \ \ per\ physical\ core\ on\ these\ processors.\ Let's\ take\ the\ above\ example\ and\ rerun\ it\ with\ this\ knowledge\ to\ get\ the\ observed\ behaviour\ outlined\ above.}}
\DoxyCodeLine{00985\ \textcolor{comment}{//}}
\DoxyCodeLine{00986\ \textcolor{comment}{//\ \ \ Assume\ Thread\ 0,\ Thread\ 1,\ and\ Thread\ 2\ run\ on\ cpu\ 0,\ cpu\ 1,\ and\ cpu\ 2\ respectively.\ Assume\ that\ cpu\ 0\ and\ cpu\ 1\ are\ two\ logical\ cores\ on\ the\ same\ physical\ core\ so\ this\ processor}}
\DoxyCodeLine{00987\ \textcolor{comment}{//\ \ \ has\ an\ SMT\ value\ of\ 2.\ Thread\ 0\ will\ store\ 1\ into\ X.\ This\ store\ may\ be\ in\ the\ store\ buffer\ or\ in\ the\ L1\ cache\ that\ cpu\ 1\ also\ shares\ with\ cpu\ 0,\ thus\ cpu\ 1\ has\ early\ access\ to\ cpu\ 0's\ stores.}}
\DoxyCodeLine{00988\ \textcolor{comment}{//\ \ \ Thread\ 1\ loads\ X\ which\ it\ observed\ as\ 1\ early\ and\ then\ stores\ 1\ into\ Y.\ Thread\ 2\ may\ see\ the\ load\ from\ Y\ returning\ 1\ but\ now\ the\ load\ from\ X\ returning\ 0\ all\ because\ cpu\ 1\ got\ early}}
\DoxyCodeLine{00989\ \textcolor{comment}{//\ \ \ access\ to\ cpu\ 0\ store\ due\ to\ sharing\ a\ L1\ cache\ or\ store\ buffer.}}
\DoxyCodeLine{00990\ \textcolor{comment}{//\ \ \ We\ will\ come\ back\ on\ how\ to\ fix\ this\ example\ with\ the\ proper\ memory\ barriers\ for\ the\ Non-\/Atomic\ Store\ Atomicity\ systems,\ but\ we\ need\ to\ detour\ first.}}
\DoxyCodeLine{00991\ \textcolor{comment}{//}}
\DoxyCodeLine{00992\ \textcolor{comment}{//\ \ \ We\ need\ to\ take\ a\ deeper\ dive\ into\ memory\ barriers\ to\ understand\ how\ to\ restore\ Multi-\/Copy\ Store\ Atomicity\ from\ a\ Non-\/Atomic\ Store\ Atomicity\ system.}}
\DoxyCodeLine{00993\ \textcolor{comment}{//\ \ \ Let's\ start\ with\ a\ motivating\ example\ and\ we\ will\ be\ using\ the\ POWER\ architecture\ throughout\ this\ example\ because\ it\ encompasses\ all\ the\ possible\ observable\ behaviour.}}
\DoxyCodeLine{00994\ \textcolor{comment}{//\ \ \ ARMv7\ technically\ allows\ Non-\/Atomic\ Store\ Atomicity\ behaviour\ but\ no\ consumer\ ARMv7\ chip\ actually\ observes\ this\ behaviour.}}
\DoxyCodeLine{00995\ \textcolor{comment}{//\ \ \ ARMv8\ reworked\ its\ model\ to\ specifically\ say\ it\ is\ a\ Multi-\/Copy\ Store\ Atomicity\ system.}}
\DoxyCodeLine{00996\ \textcolor{comment}{//\ \ \ POWER\ is\ one\ of\ the\ last\ few\ popular\ consumer\ architectures\ that\ are\ guaranteed\ to\ have\ Non-\/Atomic\ Store\ Atomicity\ observable\ behaviour,\ thus\ we\ will\ be\ using\ it\ for\ the\ following\ examples.}}
\DoxyCodeLine{00997\ \textcolor{comment}{//}}
\DoxyCodeLine{00998\ \textcolor{comment}{//\ \ \ To\ preface,\ POWER\ has\ two\ types\ of\ memory\ barriers\ called\ lwsync\ and\ sync.\ The\ following\ table\ lists\ the\ guarantees\ provided\ by\ TSO,\ x86,\ and\ the\ lwsync\ instruction.}}
\DoxyCodeLine{00999\ \textcolor{comment}{//\ \ \ The\ table\ gives\ a\ hint\ as\ to\ why\ using\ our\ previous\ definition\ of\ LDLD/LDST/STST/STLD\ isn't\ granular\ enough\ to\ categorize\ memory\ barrier\ instructions.}}
\DoxyCodeLine{01000\ \textcolor{comment}{//}}
\DoxyCodeLine{01001\ \textcolor{comment}{//\ \ \ TSO:\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ POWER\ lwsync\ memory\ barrier:}}
\DoxyCodeLine{01002\ \textcolor{comment}{//\ \ \ \ \ \ \ LDLD\ :\ YES\ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LDLD\ :\ YES}}
\DoxyCodeLine{01003\ \textcolor{comment}{//\ \ \ \ \ \ \ LDST\ :\ YES\ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LDST\ :\ YES}}
\DoxyCodeLine{01004\ \textcolor{comment}{//\ \ \ \ \ \ \ STST\ :\ YES\ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STST\ :\ YES}}
\DoxyCodeLine{01005\ \textcolor{comment}{//\ \ \ \ \ \ \ STLD\ :\ NO\ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STLD\ :\ NO}}
\DoxyCodeLine{01006\ \textcolor{comment}{//\ \ \ A\ cumulative\ :\ YES\ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ A\ cumulative\ :\ YES}}
\DoxyCodeLine{01007\ \textcolor{comment}{//\ \ \ B\ cumulative\ :\ YES\ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ B\ cumulative\ :\ YES}}
\DoxyCodeLine{01008\ \textcolor{comment}{//\ \ \ IRIW\ \ \ \ \ \ \ \ \ :\ YES\ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IRIW\ \ \ \ \ \ \ \ \ :\ NO}}
\DoxyCodeLine{01009\ \textcolor{comment}{//}}
\DoxyCodeLine{01010\ \textcolor{comment}{//\ \ \ The\ TSO\ memory\ model\ provided\ by\ x86\ seems\ to\ be\ exactly\ the\ same\ as\ POWER\ if\ we\ add\ lwsync\ memory\ barrier\ instructions\ in\ between\ each\ of\ the\ memory\ instructions.}}
\DoxyCodeLine{01011\ \textcolor{comment}{//\ \ \ This\ provides\ us\ the\ exact\ same\ ordering\ guarantees\ as\ the\ TSO\ memory\ model.\ If\ we\ just\ looked\ at\ the\ 4\ permutations\ of\ reorderings\ we\ would\ be\ inclined\ to\ assume\ that}}
\DoxyCodeLine{01012\ \textcolor{comment}{//\ \ \ TSO\ has\ the\ exact\ same\ ordering\ as\ sprinkling\ lwsync\ in\ our\ code\ in\ between\ every\ pair\ of\ memory\ instructions.\ That\ is\ not\ the\ case\ because\ memory\ barrier\ causality\ and\ cumulativity\ differ\ in\ subtle\ ways.}}
\DoxyCodeLine{01013\ \textcolor{comment}{//\ \ \ In\ this\ case\ they\ differ\ by\ the\ implicit\ guarantees\ from\ the\ TSO\ memory\ model\ versus\ those\ provided\ by\ the\ POWER\ lwsync\ memory\ barrier.}}
\DoxyCodeLine{01014\ \textcolor{comment}{//\ \ \ So\ the\ lwsync\ memory\ barrier\ prevents\ reordering\ with\ instructions\ that\ have\ causality\ but\ does\ not\ prevent\ reordering\ with\ instructions\ that\ are\ completely\ independent.}}
\DoxyCodeLine{01015\ \textcolor{comment}{//\ \ \ Let's\ dive\ into\ these\ concepts\ a\ bit\ more.}}
\DoxyCodeLine{01016\ \textcolor{comment}{//}}
\DoxyCodeLine{01017\ \textcolor{comment}{//\ \ \ Non-\/Atomic\ Store\ Atomicity\ architectures\ are\ prone\ to\ behaviours\ such\ as\ the\ non-\/causal\ outcome\ of\ the\ WRC\ test\ above.\ Architectures\ such\ as\ POWER\ defines\ memory\ barriers\ to\ enforce}}
\DoxyCodeLine{01018\ \textcolor{comment}{//\ \ \ ordering\ with\ respect\ to\ memory\ accesses\ in\ remote\ cpus\ other\ than\ the\ cpu\ actually\ issuing\ the\ memory\ barrier.\ This\ is\ known\ as\ memory\ barrier\ cumulativity.}}
\DoxyCodeLine{01019\ \textcolor{comment}{//\ \ \ How\ does\ the\ memory\ barrier\ issued\ on\ my\ cpu\ affect\ the\ view\ of\ memory\ accesses\ done\ by\ remote\ cpuss.}}
\DoxyCodeLine{01020\ \textcolor{comment}{//}}
\DoxyCodeLine{01021\ \textcolor{comment}{//\ \ \ Cumulative\ memory\ barriers\ are\ defined\ as\ follows\ -\/\ Take\ your\ time\ this\ part\ is\ very\ non-\/trivial:}}
\DoxyCodeLine{01022\ \textcolor{comment}{//\ \ \ A-\/Cumulative:\ We\ denote\ group\ A\ as\ the\ set\ of\ memory\ instructions\ in\ this\ cpu\ or\ other\ cpus\ that\ are\ ordered\ before\ the\ memory\ barrier\ in\ this\ cpu.}}
\DoxyCodeLine{01023\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ A-\/Cumulativity\ requires\ that\ memory\ instructions\ from\ any\ cpu\ that\ have\ performed\ prior\ to\ a\ memory\ load\ before\ the\ memory\ barrier\ on\ this\ cpu\ are\ also\ members\ of\ group\ A.}}
\DoxyCodeLine{01024\ \textcolor{comment}{//\ \ \ B-\/Cumulative:\ We\ denote\ group\ B\ as\ the\ set\ of\ memory\ instructions\ in\ this\ cpu\ or\ other\ cpus\ that\ are\ ordered\ after\ the\ memory\ barrier\ in\ this\ cpu.}}
\DoxyCodeLine{01025\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ B-\/Cumulativity\ requires\ that\ memory\ instructions\ from\ any\ cpu\ that\ perform\ after\ a\ load\ and\ including\ the\ load\ in\ that\ cpu\ that\ returns\ the\ value\ of\ a\ store\ in\ group\ B\ are}}
\DoxyCodeLine{01026\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ also\ members\ of\ group\ B.}}
\DoxyCodeLine{01027\ \textcolor{comment}{//\ \ \ IRIW\ \ \ \ \ \ \ \ :\ enforces\ a\ global\ ordering\ even\ for\ memory\ instructions\ that\ have\ no\ causality.\ The\ memory\ instructions\ are\ completely\ independent.}}
\DoxyCodeLine{01028\ \textcolor{comment}{//}}
\DoxyCodeLine{01029\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01030\ \textcolor{comment}{//\ \ \ WRC\ Litmus\ Test}}
\DoxyCodeLine{01031\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01032\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 2}}
\DoxyCodeLine{01033\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01034\ \textcolor{comment}{//\ \ \ \{i\}\ :\ STORE(X,\ 1)\ \ \ \ \ \ \ \ |\ \{ii\}\ \ :\ r0\ =\ LOAD(X)\ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \{v\}\ \ :\ r1\ =\ LOAD(Y)}}
\DoxyCodeLine{01035\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \{iii\}\ :\ lwsync\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{01036\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \{iv\}\ \ :\ STORE(Y,\ r0)\ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \{vi\}\ :\ r2\ =\ LOAD(X)}}
\DoxyCodeLine{01037\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01038\ \textcolor{comment}{//\ \ \ Outcome:\ r0\ =\ 1\ \&\&\ r1\ =\ 1\ \&\&\ r2\ =\ 1}}
\DoxyCodeLine{01039\ \textcolor{comment}{//}}
\DoxyCodeLine{01040\ \textcolor{comment}{//\ \ \ Group\ A\ of\ \{iii\}\ :\ \{i\}\ \&\&\ \{ii\}}}
\DoxyCodeLine{01041\ \textcolor{comment}{//}}
\DoxyCodeLine{01042\ \textcolor{comment}{//\ \ \ Group\ B\ of\ \{iii\}\ :\ \{iv\}\ \&\&\ \{v\}\ \&\&\ \{vi\}}}
\DoxyCodeLine{01043\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01044\ \textcolor{comment}{//}}
\DoxyCodeLine{01045\ \textcolor{comment}{//\ \ \ Using\ the\ WRC\ test\ again\ and\ inserting\ a\ POWER\ lwsync,\ don't\ concern\ yourself\ with\ why\ the\ memory\ barrier\ was\ inserted\ at\ that\ spot\ right\ now,\ we\ now\ see\ the\ distinctions\ of\ group\ A\ and\ group\ B.}}
\DoxyCodeLine{01046\ \textcolor{comment}{//\ \ \ It\ demonstrates\ the\ A\ and\ B\ Cumulative\ nature\ of\ the\ lwsync\ instruction,\ \{iii\}.\ First\ group\ A,\ initially\ consists\ of\ \{ii\}\ and\ group\ B\ initially\ consists\ of\ \{iv\}\ from\ the\ local\ cpu\ that\ issued\ the\ lwsync.}}
\DoxyCodeLine{01047\ \textcolor{comment}{//\ \ \ Since\ \{ii\}\ reads\ from\ \{i\}\ and\ assume\ \{i\}\ happens\ before\ \{ii\},\ by\ definition\ of\ A-\/Cumulativity\ \{i\}\ is\ included\ in\ group\ A.}}
\DoxyCodeLine{01048\ \textcolor{comment}{//\ \ \ Similarly\ \{v\}\ reads\ from\ \{iv\}\ and\ assume\ \{iv\}\ happens\ before\ \{v\},\ then\ \{v\}\ is\ included\ in\ group\ B\ by\ definition\ of\ B-\/Cumulativity.}}
\DoxyCodeLine{01049\ \textcolor{comment}{//\ \ \ \{vi\}\ is\ also\ included\ in\ group\ B\ since\ it\ happens\ after\ \{v\}\ by\ definition\ of\ B-\/Cumulativity.}}
\DoxyCodeLine{01050\ \textcolor{comment}{//}}
\DoxyCodeLine{01051\ \textcolor{comment}{//\ \ \ WRC\ litmus\ test\ represents\ a\ scenario\ where\ only\ a\ A-\/Cumulative\ memory\ barrier\ is\ needed.\ The\ lwsync\ not\ only\ provides\ the\ needed\ local\ LDST\ memory\ barrier\ for\ the\ local\ thread\ but\ also\ ensures}}
\DoxyCodeLine{01052\ \textcolor{comment}{//\ \ \ that\ any\ write\ Thread\ 1\ has\ read\ from\ before\ the\ memory\ barrier\ is\ kept\ in\ order\ with\ any\ write\ Thread\ 1\ does\ after\ the\ memory\ barrier\ as\ far\ as\ any\ other\ thread\ observes.}}
\DoxyCodeLine{01053\ \textcolor{comment}{//\ \ \ In\ other\ words\ it\ ensures\ that\ any\ write\ that\ has\ propagated\ to\ Thread\ 1\ before\ the\ memory\ barrier\ is\ propagated\ to\ any\ other\ thread\ before\ the\ second\ store\ after\ the\ memory\ barrier\ in\ Thread\ 1}}
\DoxyCodeLine{01054\ \textcolor{comment}{//\ \ \ can\ propagate\ to\ other\ threads\ in\ the\ system.\ This\ is\ exactly\ the\ definition\ of\ A-\/Cumulativity\ and\ what\ we\ need\ to\ ensure\ that\ causality\ is\ maintained\ in\ the\ WRC\ Litmus\ Test\ example.}}
\DoxyCodeLine{01055\ \textcolor{comment}{//\ \ \ With\ that\ lwsync\ in\ place\ it\ is\ now\ impossible\ to\ observe\ r0\ =\ 1\ \&\&\ r1\ =\ 1\ \&\&\ r2\ =\ 0.\ The\ lwsync\ has\ restored\ causal\ ordering.\ Let's\ look\ at\ an\ example\ that\ requires\ B-\/Cumulativity.}}
\DoxyCodeLine{01056\ \textcolor{comment}{//}}
\DoxyCodeLine{01057\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01058\ \textcolor{comment}{//\ \ \ Example\ 2\ from\ POWER\ manual}}
\DoxyCodeLine{01059\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01060\ \textcolor{comment}{//\ \ \ Initial\ State:}}
\DoxyCodeLine{01061\ \textcolor{comment}{//\ \ \ X\ =\ 0;\ Y\ =\ 0;\ Z\ =\ 0}}
\DoxyCodeLine{01062\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01063\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 2}}
\DoxyCodeLine{01064\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01065\ \textcolor{comment}{//\ \ \ STORE(X,\ 1)\ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r0\ =\ LOAD(Y)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r1\ =\ LOAD(Z)}}
\DoxyCodeLine{01066\ \textcolor{comment}{//\ \ \ STORE(Y,\ 1)\ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ STORE(Z,\ r0)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r2\ =\ LOAD(X)}}
\DoxyCodeLine{01067\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01068\ \textcolor{comment}{//\ \ \ Observed:\ r0\ =\ 1\ \&\&\ r1\ =\ 1\ \&\&\ r2\ =\ 0}}
\DoxyCodeLine{01069\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01070\ \textcolor{comment}{//}}
\DoxyCodeLine{01071\ \textcolor{comment}{//\ \ \ This\ example\ is\ very\ similar\ to\ WRC\ except\ that\ we\ kinda\ extended\ the\ Message\ Passing\ through\ an\ additional\ shared\ variable\ instead.}}
\DoxyCodeLine{01072\ \textcolor{comment}{//\ \ \ Think\ of\ this\ as\ Thread\ 0\ writing\ some\ data\ into\ X,\ setting\ flag\ Y,\ Thread\ 1\ waiting\ for\ flag\ Y\ then\ writing\ flag\ Z,\ and\ finally\ Thread\ 2\ waiting\ for\ flag\ Z\ before\ reading\ the\ data.}}
\DoxyCodeLine{01073\ \textcolor{comment}{//\ \ \ Take\ a\ minute\ to\ digest\ the\ above\ example\ and\ think\ about\ where\ a\ memory\ barrier,\ lwsync,\ should\ be\ placed.\ Don't\ peek\ at\ the\ solution\ below.}}
\DoxyCodeLine{01074\ \textcolor{comment}{//}}
\DoxyCodeLine{01075\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01076\ \textcolor{comment}{//\ \ \ Example\ 2\ from\ POWER\ manual}}
\DoxyCodeLine{01077\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01078\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 2}}
\DoxyCodeLine{01079\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01080\ \textcolor{comment}{//\ \ \ STORE(X,\ 1)\ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r0\ =\ LOAD(Y)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r1\ =\ LOAD(Z)}}
\DoxyCodeLine{01081\ \textcolor{comment}{//\ \ \ lwsync\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{01082\ \textcolor{comment}{//\ \ \ STORE(Y,\ 1)\ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ STORE(Z,\ r0)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r2\ =\ LOAD(X)}}
\DoxyCodeLine{01083\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01084\ \textcolor{comment}{//}}
\DoxyCodeLine{01085\ \textcolor{comment}{//\ \ \ First\ the\ lwsync\ provides\ the\ needed\ local\ STST\ memory\ barrier\ for\ the\ local\ thread,\ thus\ the\ lwsync\ here\ ensures\ that\ the\ store\ to\ X\ propagates\ to\ Thread\ 1\ before\ the\ store\ to\ Y.}}
\DoxyCodeLine{01086\ \textcolor{comment}{//\ \ \ B-\/Cumulativity\ applied\ to\ all\ operations\ after\ the\ memory\ barrier\ ensure\ that\ the\ store\ to\ X\ is}}
\DoxyCodeLine{01087\ \textcolor{comment}{//\ \ \ kept\ in\ order\ with\ respect\ to\ the\ store\ to\ Z\ as\ far\ as\ all\ other\ threads\ participating\ in\ the\ dependency\ chain\ are\ concerned.\ This\ is\ the\ exact\ definition\ of\ B-\/Cumulativity.}}
\DoxyCodeLine{01088\ \textcolor{comment}{//\ \ \ With\ this\ one\ lwsync\ the\ outcome\ outlined\ above\ is\ impossible\ to\ observe.\ If\ r0\ =\ 1\ \&\&\ r1\ =\ 1\ then\ r2\ must\ be\ properly\ observed\ to\ be\ 1.}}
\DoxyCodeLine{01089\ \textcolor{comment}{//}}
\DoxyCodeLine{01090\ \textcolor{comment}{//\ \ \ We\ know\ that\ lwsync\ only\ provides\ A-\/Cumulativity\ and\ B-\/Cumulativity.\ Now\ we\ will\ look\ at\ examples\ that\ have\ no\ causality\ constraints\ thus\ we\ need\ to\ grab\ heavier\ memory\ barriers}}
\DoxyCodeLine{01091\ \textcolor{comment}{//\ \ \ that\ ensures\ in\ short\ we\ will\ say\ makes\ a\ store\ become\ visible\ to\ all\ processors,\ even\ those\ not\ on\ the\ dependency\ chains.\ Let's\ get\ to\ the\ first\ example.}}
\DoxyCodeLine{01092\ \textcolor{comment}{//}}
\DoxyCodeLine{01093\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01094\ \textcolor{comment}{//\ \ \ Independent\ Reads\ of\ Independent\ Writes,\ IRIW,\ coined\ by\ Doug\ Lea}}
\DoxyCodeLine{01095\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01096\ \textcolor{comment}{//\ \ \ Initial\ State:}}
\DoxyCodeLine{01097\ \textcolor{comment}{//\ \ \ X\ =\ 0;\ Y\ =\ 0;}}
\DoxyCodeLine{01098\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01099\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 2\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 3}}
\DoxyCodeLine{01100\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01101\ \textcolor{comment}{//\ \ \ STORE(X,\ 1)\ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r0\ =\ LOAD(X)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ STORE(Y,\ 1)\ \ \ \ \ \ \ \ \ \ \ \ |\ r2\ =\ LOAD(Y)}}
\DoxyCodeLine{01102\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r1\ =\ LOAD(Y)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r3\ =\ LOAD(X)}}
\DoxyCodeLine{01103\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01104\ \textcolor{comment}{//\ \ \ Observed:\ r0\ =\ 1\ \&\&\ r1\ =\ 0\ \&\&\ r2\ =\ 1\ \&\&\ r3\ =\ 0}}
\DoxyCodeLine{01105\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01106\ \textcolor{comment}{//}}
\DoxyCodeLine{01107\ \textcolor{comment}{//\ \ \ The\ IRIW\ example\ above\ clearly\ shows\ that\ writes\ can\ be\ propagated\ to\ different\ cpus\ in\ completely\ different\ orders.}}
\DoxyCodeLine{01108\ \textcolor{comment}{//\ \ \ Thread\ 1\ sees\ the\ store\ to\ X\ but\ not\ the\ store\ to\ Y\ while\ Thread\ 3\ sees\ the\ store\ to\ Y\ but\ not\ the\ store\ to\ X,\ the\ complete\ opposite.}}
\DoxyCodeLine{01109\ \textcolor{comment}{//\ \ \ Also\ to\ the\ keen\ eye\ you\ may\ have\ noticed\ this\ example\ is\ a\ slight\ modification\ of\ the\ Store\ Buffer\ example\ so\ try\ to\ guess\ where\ the\ memory\ barriers\ would\ go.}}
\DoxyCodeLine{01110\ \textcolor{comment}{//}}
\DoxyCodeLine{01111\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01112\ \textcolor{comment}{//\ \ \ Independent\ Reads\ of\ Independent\ Writes,\ IRIW,\ coined\ by\ Doug\ Lea}}
\DoxyCodeLine{01113\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01114\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 2\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 3}}
\DoxyCodeLine{01115\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01116\ \textcolor{comment}{//\ \ \ STORE(X,\ 1)\ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r0\ =\ LOAD(X)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ STORE(Y,\ 1)\ \ \ \ \ \ \ \ \ \ \ \ |\ r2\ =\ LOAD(Y)}}
\DoxyCodeLine{01117\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ sync\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ sync}}
\DoxyCodeLine{01118\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r1\ =\ LOAD(Y)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r3\ =\ LOAD(X)}}
\DoxyCodeLine{01119\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01120\ \textcolor{comment}{//}}
\DoxyCodeLine{01121\ \textcolor{comment}{//\ \ \ To\ ensure\ that\ the\ above\ observation\ is\ forbidden\ we\ need\ to\ add\ a\ full\ sync\ memory\ barrier\ on\ both\ the\ reading\ threads.\ Think\ of\ sync\ as\ restoring\ sequential\ consistency.}}
\DoxyCodeLine{01122\ \textcolor{comment}{//\ \ \ The\ sync\ memory\ barrier\ ensures\ that\ any\ writes\ that\ Thread\ 1\ has\ read\ from\ before\ the\ memory\ barrier\ are\ fully\ propagated\ to\ all\ threads\ before\ the\ reads\ are\ satisfied\ after\ the\ memory\ barrier.}}
\DoxyCodeLine{01123\ \textcolor{comment}{//\ \ \ The\ same\ can\ be\ said\ for\ Thread\ 3.\ This\ is\ why\ the\ sync\ memory\ barrier\ is\ needed\ because\ there\ is\ no\ partial\ causal\ ordering\ here\ or\ anything\ that\ can\ be\ considered\ for\ our\ A\ and\ \ B\ Cumulativity\ definitions.}}
\DoxyCodeLine{01124\ \textcolor{comment}{//\ \ \ We\ must\ ensure\ that\ all\ writes\ have\ been\ propagated\ to\ all\ cpus\ before\ proceeding.\ This\ gives\ way\ to\ the\ difference\ between\ sync\ and\ lwsync\ with\ regards\ to\ visibility\ of\ writes\ and\ cumulativity.}}
\DoxyCodeLine{01125\ \textcolor{comment}{//\ \ \ sync\ guarantees\ that\ all\ program-\/order\ previous\ stores\ must\ have\ been\ propagated\ to\ all\ other\ cpus\ before\ the\ memory\ instructions\ after\ the\ memory\ barrier.}}
\DoxyCodeLine{01126\ \textcolor{comment}{//\ \ \ lwsync\ does\ not\ ensure\ that\ stores\ before\ the\ memory\ barrier\ have\ actually\ propagated\ to\ any\ other\ cpu\ before\ memory\ instructions\ after\ the\ memory\ barrier,\ but\ it\ will\ keep\ stores\ before\ and\ after\ the}}
\DoxyCodeLine{01127\ \textcolor{comment}{//\ \ \ lwsync\ in\ order\ as\ far\ as\ other\ cpus\ are\ concerned\ that\ are\ within\ the\ dependency\ chain.}}
\DoxyCodeLine{01128\ \textcolor{comment}{//}}
\DoxyCodeLine{01129\ \textcolor{comment}{//\ \ \ Fun\ fact\ while\ ARMv7\ claims\ to\ be\ Non-\/Atomic\ Store\ Atomicity\ no\ mainstream\ ARM\ implementation\ that\ I\ have\ seen\ has\ shown\ cases\ of\ Non-\/Atomic\ Store\ Atomicity.}}
\DoxyCodeLine{01130\ \textcolor{comment}{//\ \ \ It's\ allowed\ by\ the\ ARMv7\ memory\ model\ and\ thus\ you\ have\ to\ program\ to\ that.\ ARMv8\ changes\ this\ and\ states\ that\ it\ has\ Multi-\/Copy\ Store\ Atomicity.}}
\DoxyCodeLine{01131\ \textcolor{comment}{//}}
\DoxyCodeLine{01132\ \textcolor{comment}{//\ \ \ ********\ Release-\/Acquire\ Semantics\ ********}}
\DoxyCodeLine{01133\ \textcolor{comment}{//}}
\DoxyCodeLine{01134\ \textcolor{comment}{//\ \ \ The\ most\ useful\ and\ common\ cases\ where\ Release-\/Acquire\ Semantics\ are\ used\ in\ every\ day\ code\ is\ in\ message\ passing\ and\ mutexes.\ Let's\ get\ onto\ some\ examples\ and\ the\ C++\ definition\ of\ Release-\/Acquire.}}
\DoxyCodeLine{01135\ \textcolor{comment}{//}}
\DoxyCodeLine{01136\ \textcolor{comment}{//\ \ \ ACQUIRE:}}
\DoxyCodeLine{01137\ \textcolor{comment}{//\ \ \ An\ Acquire\ operation\ is\ a\ one-\/way\ memory\ barrier\ whereby\ all\ loads\ and\ stores\ after\ the\ acquire\ operation\ cannot\ move\ up\ and\ above\ the\ acquire\ operation.}}
\DoxyCodeLine{01138\ \textcolor{comment}{//\ \ \ Loads\ and\ stores\ before\ the\ acquire\ operation\ can\ move\ down\ past\ the\ acquire\ operation.\ An\ acquire\ operation\ should\ always\ be\ paired\ with\ a\ Release\ operation\ on\ the\ SAME\ atomic\ object.}}
\DoxyCodeLine{01139\ \textcolor{comment}{//}}
\DoxyCodeLine{01140\ \textcolor{comment}{//\ \ \ RELEASE:}}
\DoxyCodeLine{01141\ \textcolor{comment}{//\ \ \ A\ Release\ operation\ is\ a\ one-\/way\ memory\ barrier\ whereby\ all\ loads\ and\ stores\ before\ the\ release\ operation\ cannot\ move\ down\ and\ below\ the\ release\ operation.}}
\DoxyCodeLine{01142\ \textcolor{comment}{//\ \ \ Loads\ and\ stores\ after\ the\ release\ operation\ can\ move\ up\ and\ above\ the\ release\ operation.\ A\ release\ operation\ should\ always\ be\ paired\ with\ an\ Acquire\ operation\ on\ the\ SAME\ atomic\ object.}}
\DoxyCodeLine{01143\ \textcolor{comment}{//}}
\DoxyCodeLine{01144\ \textcolor{comment}{//\ \ \ Release-\/Acquire\ pair\ does\ not\ create\ a\ full\ memory\ barrier\ but\ it\ guarantees\ that\ all\ memory\ instructions\ before\ a\ Release\ operation\ on\ an\ atomic\ object\ M\ are\ visible\ after\ an\ Acquire}}
\DoxyCodeLine{01145\ \textcolor{comment}{//\ \ \ operation\ on\ that\ same\ atomic\ object\ M.\ Thus\ these\ semantics\ usually\ are\ enough\ to\ preclude\ the\ need\ for\ any\ other\ memory\ barriers.}}
\DoxyCodeLine{01146\ \textcolor{comment}{//\ \ \ The\ synchronization\ is\ established\ only\ between\ the\ threads\ Releasing\ and\ Acquiring\ the\ same\ atomic\ object\ M.}}
\DoxyCodeLine{01147\ \textcolor{comment}{//}}
\DoxyCodeLine{01148\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01149\ \textcolor{comment}{//\ \ \ Critical\ Section}}
\DoxyCodeLine{01150\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01151\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1}}
\DoxyCodeLine{01152\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01153\ \textcolor{comment}{//\ \ \ mtx.lock()\ -\/\ Acquire\ \ \ \ \ |\ mtx.lock()\ -\/\ Acquire}}
\DoxyCodeLine{01154\ \textcolor{comment}{//\ \ \ STORE(X,\ 1)\ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r0\ =\ LOAD(X)}}
\DoxyCodeLine{01155\ \textcolor{comment}{//\ \ \ mtx.unlock()\ -\/\ Release\ \ \ |\ mtx.unlock()\ -\/\ Release}}
\DoxyCodeLine{01156\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01157\ \textcolor{comment}{//}}
\DoxyCodeLine{01158\ \textcolor{comment}{//\ \ \ A\ mutex\ only\ requires\ Release-\/Acquire\ semantics\ to\ protect\ the\ critical\ section.\ We\ do\ not\ care\ if\ operations\ above\ the\ lock\ leak\ into\ the\ critical\ section\ or\ that\ operations\ below\ the\ unlock\ leak\ into\ the}}
\DoxyCodeLine{01159\ \textcolor{comment}{//\ \ \ critical\ section\ because\ they\ are\ outside\ the\ protected\ region\ of\ the\ lock()/unlock()\ pair.\ Release-\/Acquire\ semantics\ does\ guarantee\ that\ everything\ inside\ the\ critical\ section\ cannot\ leak\ out.}}
\DoxyCodeLine{01160\ \textcolor{comment}{//\ \ \ Thus\ all\ accesses\ of\ all\ previous\ critical\ sections\ for\ the\ mutex\ are\ guaranteed\ to\ have\ completed\ and\ be\ visible\ when\ the\ mutex\ is\ handed\ off\ to\ the\ next\ party\ due\ to\ the\ Release-\/Acquire\ chaining.}}
\DoxyCodeLine{01161\ \textcolor{comment}{//\ \ \ This\ also\ means\ that\ mutexes\ do\ not\ provide\ or\ restore\ Multi-\/Copy\ Store\ Atomicity\ to\ any\ memory\ instructions\ outside\ the\ mutex,\ like\ the\ IRIW\ example\ since\ it\ does\ not\ emit\ full\ memory\ barriers.}}
\DoxyCodeLine{01162\ \textcolor{comment}{//}}
\DoxyCodeLine{01163\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01164\ \textcolor{comment}{//\ \ \ Message\ Passing}}
\DoxyCodeLine{01165\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01166\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1}}
\DoxyCodeLine{01167\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01168\ \textcolor{comment}{//\ \ \ STORE(DATA,\ 1)\ \ \ \ \ \ \ \ \ \ \ |\ while\ (!LOAD\_ACQUIRE(FLAG))}}
\DoxyCodeLine{01169\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{01170\ \textcolor{comment}{//\ \ \ STORE\_RELEASE(FLAG,\ 1)\ \ \ |\ r0\ =\ LOAD(DATA)}}
\DoxyCodeLine{01171\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01172\ \textcolor{comment}{//}}
\DoxyCodeLine{01173\ \textcolor{comment}{//\ \ \ This\ is\ a\ common\ message\ passing\ idiom\ that\ also\ shows\ the\ use\ of\ Release-\/Acquire\ semantics.\ It\ should\ be\ obvious\ by\ the\ definitions\ outlined\ above\ why\ this\ works.}}
\DoxyCodeLine{01174\ \textcolor{comment}{//\ \ \ An\ Acquire\ operation\ attached\ to\ a\ load\ needs\ to\ provide\ a\ LDLD\ and\ LDST\ memory\ barrier\ according\ to\ our\ definition\ of\ acquire.\ This\ is\ provided\ by\ default\ on\ x86\ TSO\ thus\ no\ memory\ barrier\ is\ emitted.}}
\DoxyCodeLine{01175\ \textcolor{comment}{//\ \ \ A\ Release\ operation\ attached\ to\ a\ store\ needs\ to\ provide\ a\ STST\ and\ LDST\ memory\ barrier\ according\ to\ our\ definition\ of\ release.\ This\ is\ provided\ by\ default\ on\ x86\ TSO\ thus\ no\ memory\ barrier\ is\ emitted.}}
\DoxyCodeLine{01176\ \textcolor{comment}{//}}
\DoxyCodeLine{01177\ \textcolor{comment}{//\ \ \ A\ couple\ of\ things\ of\ note\ here.\ One\ is\ that\ by\ attaching\ the\ semantics\ of\ a\ memory\ model\ directly\ to\ the\ memory\ instruction/operation\ itself\ we\ can\ take\ advantage\ of\ the\ fact\ the\ some\ processors}}
\DoxyCodeLine{01178\ \textcolor{comment}{//\ \ \ already\ provide\ guarantees\ between\ memory\ instructions\ and\ thus\ we\ do\ not\ have\ to\ emit\ memory\ barriers.\ Another\ thing\ of\ note\ is\ that\ the\ memory\ model\ is\ directly\ attached\ to\ the\ operation,}}
\DoxyCodeLine{01179\ \textcolor{comment}{//\ \ \ so\ you\ must\ do\ the\ Release-\/Acquire\ pairing\ on\ the\ SAME\ object\ which\ in\ this\ case\ is\ the\ FLAG\ variable.\ Doing\ an\ Acquire\ or\ Release\ on\ a\ separate\ object\ has\ no\ guarantee\ to\ observe\ an\ Acquire\ or\ Release\ on\ a\ different\ object.}}
\DoxyCodeLine{01180\ \textcolor{comment}{//\ \ \ This\ better\ encapsulates\ the\ meaning\ of\ the\ code\ and\ also\ allows\ the\ processor\ to\ potentially\ do\ more\ optimizations\ since\ a\ stand\ alone\ memory\ barrier\ will\ order\ all\ memory\ instructions\ of\ a\ given\ type\ before\ and\ after\ the\ barrier.}}
\DoxyCodeLine{01181\ \textcolor{comment}{//\ \ \ Where\ as\ the\ memory\ ordering\ attached\ to\ the\ load\ or\ store\ tells\ the\ processor\ that\ it\ only\ has\ to\ order\ memory\ instructions\ in\ relation\ to\ that\ specific\ load\ or\ store\ with\ the\ given\ memory\ order.}}
\DoxyCodeLine{01182\ \textcolor{comment}{//}}
\DoxyCodeLine{01183\ \textcolor{comment}{//}}
\DoxyCodeLine{01184\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01185\ \textcolor{comment}{//\ \ \ Release\ Attached\ to\ a\ Store\ VS.\ Standalone\ Fence}}
\DoxyCodeLine{01186\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01187\ \textcolor{comment}{//\ \ \ STORE(DATA,\ 1)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ STORE(DATA,\ 1)}}
\DoxyCodeLine{01188\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ ATOMIC\_THREAD\_FENCE\_RELEASE()}}
\DoxyCodeLine{01189\ \textcolor{comment}{//\ \ \ STORE\_RELEASE(FLAG,\ 1)\ \ \ \ \ \ \ |\ \ STORE\_RELAXED(FLAG,\ 1)}}
\DoxyCodeLine{01190\ \textcolor{comment}{//\ \ \ STORE\_RELAXED(VAR,\ 2)\ \ \ \ \ \ \ \ |\ \ STORE\_RELAXED(VAR,\ 2)}}
\DoxyCodeLine{01191\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01192\ \textcolor{comment}{//\ \ \ ARMv8\ Assembly}}
\DoxyCodeLine{01193\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01194\ \textcolor{comment}{//\ \ \ str\ 1,\ DATA\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ str\ 1,\ DATA}}
\DoxyCodeLine{01195\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ dmb\ ish}}
\DoxyCodeLine{01196\ \textcolor{comment}{//\ \ \ stlr\ 1,\ FLAG\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ str\ 1,\ FLAG}}
\DoxyCodeLine{01197\ \textcolor{comment}{//\ \ \ str\ 2,\ VAR\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ str\ 2,\ VAR}}
\DoxyCodeLine{01198\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01199\ \textcolor{comment}{//}}
\DoxyCodeLine{01200\ \textcolor{comment}{//\ \ \ In\ the\ above\ example\ the\ release\ is\ attached\ to\ the\ FLAG\ variable,\ thus\ synchronization\ only\ needs\ to\ be\ guaranteed\ for\ that\ atomic\ variable.}}
\DoxyCodeLine{01201\ \textcolor{comment}{//\ \ \ It\ is\ entirely\ possible\ for\ the\ VAR\ relaxed\ store\ to\ be\ reordered\ above\ the\ release\ store.}}
\DoxyCodeLine{01202\ \textcolor{comment}{//\ \ \ In\ the\ fence\ version,\ since\ the\ fence\ is\ standalone,\ there\ is\ no\ notion\ where\ the\ release\ is\ meant\ to\ be\ attached\ to\ thus\ the\ fence\ must\ prevent\ all\ subsequent\ relaxed\ stores}}
\DoxyCodeLine{01203\ \textcolor{comment}{//\ \ \ from\ being\ reordered\ above\ the\ fence.\ The\ fence\ provides\ a\ stronger\ guarantee\ whereby\ now\ the\ VAR\ relaxed\ store\ cannot\ be\ moved\ up\ and\ above\ the\ release\ operation.}}
\DoxyCodeLine{01204\ \textcolor{comment}{//\ \ \ Also\ notice\ the\ ARMv8\ assembly\ is\ different,\ the\ release\ fence\ must\ use\ the\ stronger\ dmb\ ish\ barrier\ instead\ of\ the\ dedicated\ release\ store\ instruction.}}
\DoxyCodeLine{01205\ \textcolor{comment}{//\ \ \ We\ dive\ more\ into\ fences\ provided\ by\ eastl::atomic<T>\ below.}}
\DoxyCodeLine{01206\ \textcolor{comment}{//}}
\DoxyCodeLine{01207\ \textcolor{comment}{//\ \ \ Release-\/Acquire\ semantics\ also\ have\ the\ property\ that\ it\ must\ chain\ through\ multiple\ dependencies\ which\ is\ where\ our\ knowledge\ from\ the\ previous\ section\ comes\ into\ play.}}
\DoxyCodeLine{01208\ \textcolor{comment}{//\ \ \ Everything\ on\ the\ Release-\/Acquire\ dependency\ chain\ must\ be\ visible\ to\ the\ next\ hop\ in\ the\ chain.}}
\DoxyCodeLine{01209\ \textcolor{comment}{//}}
\DoxyCodeLine{01210\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01211\ \textcolor{comment}{//\ \ \ Example\ 2\ from\ POWER\ manual}}
\DoxyCodeLine{01212\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01213\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 2}}
\DoxyCodeLine{01214\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01215\ \textcolor{comment}{//\ \ \ STORE(X,\ 1)\ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r0\ =\ LOAD\_ACQUIRE(Y)\ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r1\ =\ LOAD\_ACQUIRE(Z)}}
\DoxyCodeLine{01216\ \textcolor{comment}{//\ \ \ STORE\_RELEASE(Y,\ 1)\ \ \ \ \ \ |\ STORE\_RELEASE(Z,\ r0)\ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r2\ =\ LOAD(X)}}
\DoxyCodeLine{01217\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01218\ \textcolor{comment}{//}}
\DoxyCodeLine{01219\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01220\ \textcolor{comment}{//\ \ \ Write-\/To-\/Read\ Causality,\ WRC,\ Litmus\ Test}}
\DoxyCodeLine{01221\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01222\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 2}}
\DoxyCodeLine{01223\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01224\ \textcolor{comment}{//\ \ \ STORE(X,\ 1)\ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r0\ =\ LOAD(X)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r1\ =\ LOAD\_ACQUIRE(Y)}}
\DoxyCodeLine{01225\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ STORE\_RELEASE(Y,\ r0)\ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r2\ =\ LOAD(X)}}
\DoxyCodeLine{01226\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01227\ \textcolor{comment}{//}}
\DoxyCodeLine{01228\ \textcolor{comment}{//\ \ \ You\ may\ notice\ both\ of\ these\ examples\ from\ the\ previous\ section.\ We\ replaced\ the\ standalone\ POWER\ memory\ barrier\ instructions\ with\ Release-\/Acquire\ semantics\ attached\ directly\ to\ the\ operations\ where\ we\ want\ causality\ preserved.}}
\DoxyCodeLine{01229\ \textcolor{comment}{//\ \ \ We\ have\ transformed\ those\ examples\ to\ use\ the\ eastl::atomic<T>\ memory\ model.}}
\DoxyCodeLine{01230\ \textcolor{comment}{//\ \ \ Take\ a\ moment\ to\ digest\ these\ examples\ in\ relation\ to\ the\ definition\ of\ Release-\/Acquire\ semantics.}}
\DoxyCodeLine{01231\ \textcolor{comment}{//}}
\DoxyCodeLine{01232\ \textcolor{comment}{//\ \ \ The\ Acquire\ chain\ can\ be\ satisfied\ by\ reading\ the\ value\ from\ the\ store\ release\ or\ any\ later\ stored\ headed\ by\ that\ release\ operation.\ The\ following\ examples\ will\ make\ this\ clearer.}}
\DoxyCodeLine{01233\ \textcolor{comment}{//}}
\DoxyCodeLine{01234\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01235\ \textcolor{comment}{//\ \ \ Release\ Sequence\ Headed}}
\DoxyCodeLine{01236\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01237\ \textcolor{comment}{//\ \ \ Initial\ State:}}
\DoxyCodeLine{01238\ \textcolor{comment}{//\ \ \ DATA\ =\ 0;\ FLAG\ =\ 0;}}
\DoxyCodeLine{01239\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01240\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1}}
\DoxyCodeLine{01241\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01242\ \textcolor{comment}{//\ \ \ STORE(DATA,\ 1)\ \ \ \ \ \ \ \ \ \ \ |\ r0\ =\ LOAD\_ACQUIRE(FLAG)}}
\DoxyCodeLine{01243\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{01244\ \textcolor{comment}{//\ \ \ STORE\_RELEASE(FLAG,\ 1)\ \ \ |\ r1\ =\ LOAD(DATA)}}
\DoxyCodeLine{01245\ \textcolor{comment}{//\ \ \ STORE\_RELAXED(FLAG,\ 3)\ \ \ |}}
\DoxyCodeLine{01246\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01247\ \textcolor{comment}{//\ \ \ Observed:\ r0\ =\ 3\ \&\&\ r1\ =\ 0}}
\DoxyCodeLine{01248\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01249\ \textcolor{comment}{//}}
\DoxyCodeLine{01250\ \textcolor{comment}{//\ \ \ In\ the\ above\ example\ we\ may\ read\ the\ value\ 3\ from\ FLAG\ which\ was\ not\ the\ release\ store,\ but\ it\ was\ headed\ by\ that\ release\ store.\ Thus\ we\ observed\ a\ later\ store\ and\ therefore\ it\ is\ still\ valid\ to\ then\ observe\ r1\ =\ 1.}}
\DoxyCodeLine{01251\ \textcolor{comment}{//\ \ \ The\ stores\ to\ FLAG\ from\ the\ STORE\_RELEASE\ up\ to\ but\ not\ including\ the\ next\ STORE\_RELEASE\ operation\ make\ up\ the\ release\ sequence\ headed\ by\ the\ first\ release\ store\ operation.\ Any\ store\ on\ that\ sequence\ can\ be\ used\ to\ enforce}}
\DoxyCodeLine{01252\ \textcolor{comment}{//\ \ \ causality\ on\ the\ load\ acquire.}}
\DoxyCodeLine{01253\ \textcolor{comment}{//}}
\DoxyCodeLine{01254\ \textcolor{comment}{//\ \ \ ********\ Consume\ is\ currently\ not\ useful\ ********}}
\DoxyCodeLine{01255\ \textcolor{comment}{//}}
\DoxyCodeLine{01256\ \textcolor{comment}{//\ \ \ Consume\ is\ a\ weaker\ form\ of\ an\ acquire\ barrier\ and\ creates\ the\ Release-\/Consume\ barrier\ pairing.}}
\DoxyCodeLine{01257\ \textcolor{comment}{//\ \ \ Consume\ states\ that\ a\ load\ operation\ on\ an\ atomic\ object\ M\ cannot\ allow\ any\ loads\ or\ stores\ dependent\ on\ the\ value\ loaded\ by\ the\ operation\ to\ be\ reordered\ before\ the\ operation.}}
\DoxyCodeLine{01258\ \textcolor{comment}{//\ \ \ To\ understand\ consume\ we\ must\ first\ understand\ dependent\ loads.}}
\DoxyCodeLine{01259\ \textcolor{comment}{//\ \ \ You\ might\ encounter\ this\ being\ called\ a\ data\ dependency\ or\ an\ address\ dependency\ in\ some\ literature.}}
\DoxyCodeLine{01260\ \textcolor{comment}{//}}
\DoxyCodeLine{01261\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01262\ \textcolor{comment}{//\ \ \ Address\ Dependency}}
\DoxyCodeLine{01263\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01264\ \textcolor{comment}{//\ \ \ Initial\ State:}}
\DoxyCodeLine{01265\ \textcolor{comment}{//\ \ \ DATA\ =\ 0;\ PTR\ =\ nullptr;}}
\DoxyCodeLine{01266\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01267\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1}}
\DoxyCodeLine{01268\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01269\ \textcolor{comment}{//\ \ \ STORE(DATA,\ 1)\ \ \ \ \ \ \ \ \ \ \ |\ r0\ =\ LOAD(PTR)\ -\/\ typeof(r0)\ =\ int*}}
\DoxyCodeLine{01270\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{01271\ \textcolor{comment}{//\ \ \ STORE(PTR,\ \&DATA)\ \ \ \ \ \ \ \ |\ r1\ =\ LOAD(r0)\ \ -\/\ typeof(r1)\ =\ int}}
\DoxyCodeLine{01272\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01273\ \textcolor{comment}{//}}
\DoxyCodeLine{01274\ \textcolor{comment}{//\ \ \ There\ is\ a\ clear\ dependency\ here\ where\ we\ cannot\ load\ from\ *int\ until\ we\ actually\ read\ the\ int*\ from\ memory.}}
\DoxyCodeLine{01275\ \textcolor{comment}{//\ \ \ Now\ it\ is\ possible\ for\ Thread\ 1's\ load\ from\ *ptr\ to\ be\ observed\ before\ the\ store\ to\ DATA,\ therefore\ it\ can\ lead\ to\ r0\ =\ \&DATA\ \&\&\ r1\ =\ 0.}}
\DoxyCodeLine{01276\ \textcolor{comment}{//\ \ \ While\ this\ is\ a\ failure\ of\ causality,\ it\ is\ allowed\ by\ some\ cpus\ such\ as\ the\ DEC\ Alpha\ and\ I\ believe\ Blackfin\ as\ well.}}
\DoxyCodeLine{01277\ \textcolor{comment}{//\ \ \ Thus\ a\ data\ dependency\ memory\ barrier\ must\ be\ inserted\ between\ the\ data\ dependent\ loads\ in\ Thread\ 1.\ Note\ that\ this\ would\ equate\ to\ a\ nop\ on\ any\ processor\ other\ than\ the\ DEC\ Alpha.}}
\DoxyCodeLine{01278\ \textcolor{comment}{//}}
\DoxyCodeLine{01279\ \textcolor{comment}{//\ \ \ This\ can\ occur\ for\ a\ variety\ of\ hardware\ reasons.\ We\ learned\ about\ invalidation\ queues.\ It\ is\ possible\ that\ the\ invalidation\ for\ DATA\ gets\ buffered\ in\ Thread\ 1.\ DEC\ Alpha\ allows\ the\ Thread\ 1}}
\DoxyCodeLine{01280\ \textcolor{comment}{//\ \ \ load\ from\ PTR\ to\ continue\ without\ marking\ the\ entries\ in\ its\ invalidation\ queue.\ Thus\ the\ subsequent\ load\ is\ allowed\ to\ return\ the\ old\ cached\ value\ of\ DATA\ instead\ of\ waiting\ for\ the}}
\DoxyCodeLine{01281\ \textcolor{comment}{//\ \ \ marked\ entries\ in\ the\ invalidation\ queue\ to\ be\ processed.\ It\ is\ a\ design\ decision\ of\ the\ processor\ not\ to\ do\ proper\ dependency\ tracking\ here\ and\ instead\ relying\ on\ the\ programmer\ to\ insert\ memory\ barriers.}}
\DoxyCodeLine{01282\ \textcolor{comment}{//}}
\DoxyCodeLine{01283\ \textcolor{comment}{//\ \ \ This\ data\ dependent\ ordering\ guarantee\ is\ useful\ because\ in\ places\ where\ we\ were\ using\ an\ Acquire\ memory\ barrier\ we\ can\ reduce\ it\ to\ this\ Consume\ memory\ barrier\ without\ any\ hardware\ barriers\ actually\ emitted\ on\ every\ modern\ processor.}}
\DoxyCodeLine{01284\ \textcolor{comment}{//\ \ \ Let's\ take\ the\ above\ example,\ translate\ it\ to\ Acquire\ and\ Consume\ memory\ barriers\ and\ then\ translate\ it\ to\ the\ ARMv7\ assembly\ and\ see\ the\ difference.}}
\DoxyCodeLine{01285\ \textcolor{comment}{//}}
\DoxyCodeLine{01286\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01287\ \textcolor{comment}{//\ \ \ Address\ Dependency\ -\/\ Release-\/Acquire\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Address\ Dependency\ -\/\ Release-\/Acquire\ -\/\ ARMv7\ Assembly}}
\DoxyCodeLine{01288\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01289\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1}}
\DoxyCodeLine{01290\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01291\ \textcolor{comment}{//\ \ \ STORE(DATA,\ 1)\ \ \ \ \ \ \ \ \ \ \ \ |\ r0\ =\ LOAD\_ACQUIRE(PTR)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STORE(DATA,\ 1)\ \ \ \ \ \ \ \ \ \ \ \ |\ r0\ =\ LOAD(PTR)}}
\DoxyCodeLine{01292\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dmb\ ish\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ dmb\ ish}}
\DoxyCodeLine{01293\ \textcolor{comment}{//\ \ \ STORE\_RELEASE(PTR,\ \&DATA)\ |\ r1\ =\ LOAD(r0)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STORE(PTR,\ \&DATA)\ \ \ \ \ \ \ \ \ |\ r1\ =\ LOAD(r0)}}
\DoxyCodeLine{01294\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01295\ \textcolor{comment}{//}}
\DoxyCodeLine{01296\ \textcolor{comment}{//\ \ \ To\ get\ Release-\/Acquire\ semantics\ on\ ARMv7\ we\ need\ to\ emit\ dmb\ ish;\ memory\ barriers.}}
\DoxyCodeLine{01297\ \textcolor{comment}{//}}
\DoxyCodeLine{01298\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01299\ \textcolor{comment}{//\ \ \ Address\ Dependency\ -\/\ Release-\/Consume\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Address\ Dependency\ -\/\ Release-\/Consume\ -\/\ ARMv7\ Assembly}}
\DoxyCodeLine{01300\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01301\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1}}
\DoxyCodeLine{01302\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01303\ \textcolor{comment}{//\ \ \ STORE(DATA,\ 1)\ \ \ \ \ \ \ \ \ \ \ \ |\ r0\ =\ LOAD\_CONSUME(PTR)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STORE(DATA,\ 1)\ \ \ \ \ \ \ \ \ \ \ \ |\ r0\ =\ LOAD(PTR)}}
\DoxyCodeLine{01304\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dmb\ ish\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{01305\ \textcolor{comment}{//\ \ \ STORE\_RELEASE(PTR,\ \&DATA)\ |\ r1\ =\ LOAD(r0)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STORE(PTR,\ \&DATA)\ \ \ \ \ \ \ \ \ |\ r1\ =\ LOAD(r0)}}
\DoxyCodeLine{01306\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01307\ \textcolor{comment}{//}}
\DoxyCodeLine{01308\ \textcolor{comment}{//\ \ \ Data\ Dependencies\ can\ not\ only\ be\ created\ by\ read-\/after-\/write/RAW\ on\ registers,\ but\ also\ by\ RAW\ on\ memory\ locations\ too.\ Let's\ look\ at\ some\ more\ elaborate\ examples.}}
\DoxyCodeLine{01309\ \textcolor{comment}{//}}
\DoxyCodeLine{01310\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01311\ \textcolor{comment}{//\ \ \ Address\ Dependency\ on\ Registers\ -\/\ Release-\/Consume\ -\/\ ARMv7\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Address\ Dependency\ on\ Memory\ -\/\ Release-\/Consume\ -\/\ ARMv7}}
\DoxyCodeLine{01312\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01313\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1}}
\DoxyCodeLine{01314\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01315\ \textcolor{comment}{//\ \ \ STORE(DATA,\ 1)\ \ \ \ \ \ \ \ \ \ \ \ |\ r0\ =\ LOAD(PTR)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STORE(DATA,\ 1)\ \ \ \ \ \ \ \ \ \ \ \ |\ r0\ =\ LOAD(PTR)}}
\DoxyCodeLine{01316\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r1\ =\ r0\ +\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ STORE(TEMP,\ r0)}}
\DoxyCodeLine{01317\ \textcolor{comment}{//\ \ \ dmb\ ish\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r2\ =\ r1\ -\/\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dmb\ ish\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r1\ =\ LOAD(TEMP)}}
\DoxyCodeLine{01318\ \textcolor{comment}{//\ \ \ STORE(PTR,\ \&DATA)\ \ \ \ \ \ \ \ \ |\ r3\ =\ LOAD(r2)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ STORE(PTR,\ \&DATA)\ \ \ \ \ \ \ \ \ |\ r2\ =\ LOAD(r1)}}
\DoxyCodeLine{01319\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ \ \ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01320\ \textcolor{comment}{//}}
\DoxyCodeLine{01321\ \textcolor{comment}{//\ \ \ The\ above\ shows\ a\ more\ elaborate\ example\ of\ how\ data\ dependent\ dependencies\ flow\ through\ RAW\ chains\ either\ through\ memory\ or\ through\ registers.}}
\DoxyCodeLine{01322\ \textcolor{comment}{//}}
\DoxyCodeLine{01323\ \textcolor{comment}{//\ \ \ Notice\ by\ identifying\ that\ this\ is\ a\ data\ dependent\ operation\ and\ asking\ for\ a\ consume\ ordering,\ we\ can\ completely\ eliminate\ the\ memory\ barrier\ on\ Thread\ 1\ since\ we\ know\ ARMv7\ does\ not\ reorder\ data\ dependent\ loads.\ Neat.}}
\DoxyCodeLine{01324\ \textcolor{comment}{//\ \ \ Unfortunately\ every\ major\ compiler\ upgrades\ a\ consume\ to\ an\ acquire\ ordering,\ because\ the\ consume\ ordering\ in\ the\ standard\ has\ a\ stronger\ guarantee\ and\ requires\ the\ compiler\ to\ do\ complicated\ dependency\ tracking.}}
\DoxyCodeLine{01325\ \textcolor{comment}{//\ \ \ Dependency\ chains\ in\ source\ code\ must\ be\ mapped\ to\ dependency\ chains\ at\ the\ machine\ instruction\ level\ until\ a\ std::kill\_dependency\ in\ the\ source\ code.}}
\DoxyCodeLine{01326\ \textcolor{comment}{//}}
\DoxyCodeLine{01327\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01328\ \textcolor{comment}{//\ \ \ Non-\/Address\ Dependency\ \&\&\ Multiple\ Chains}}
\DoxyCodeLine{01329\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01330\ \textcolor{comment}{//\ \ \ Initial\ State:}}
\DoxyCodeLine{01331\ \textcolor{comment}{//\ \ \ std::atomic<int>\ FLAG;\ int\ DATA[1]\ =\ 0;}}
\DoxyCodeLine{01332\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01333\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1}}
\DoxyCodeLine{01334\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01335\ \textcolor{comment}{//\ \ \ STORE(DATA[0],\ 1)\ \ \ \ \ \ \ \ \ \ |\ int\ f\ =\ LOAD\_CONSUME(FLAG)}}
\DoxyCodeLine{01336\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ int\ x\ =\ f}}
\DoxyCodeLine{01337\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ if\ (x)\ return\ Func(x);}}
\DoxyCodeLine{01338\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |}}
\DoxyCodeLine{01339\ \textcolor{comment}{//\ \ \ STORE\_RELEASE(FLAG,\ 1)\ \ \ \ \ |\ Func(int\ y)\ return\ DATA[y\ -\/\ y]}}
\DoxyCodeLine{01340\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01341\ \textcolor{comment}{//}}
\DoxyCodeLine{01342\ \textcolor{comment}{//\ \ \ This\ example\ is\ really\ concise\ but\ there\ is\ a\ lot\ going\ on.\ Let's\ digest\ it.}}
\DoxyCodeLine{01343\ \textcolor{comment}{//\ \ \ First\ is\ that\ the\ standard\ allows\ consume\ ordering\ even\ on\ what\ we\ will\ call\ not\ true\ machine\ level\ dependencies\ like\ a\ ptr\ load\ and\ then\ a\ load\ from\ that\ ptr\ as\ shown\ in\ the\ previous\ examples.}}
\DoxyCodeLine{01344\ \textcolor{comment}{//\ \ \ Here\ the\ dependency\ is\ between\ two\ ints,\ and\ the\ dependency\ chain\ on\ Thread\ 1\ is\ as\ follows.\ f\ -\/>\ x\ -\/>\ y\ -\/>\ DATA[y\ -\/\ y].\ The\ standard\ requires\ that\ source\ code\ dependencies\ on\ the\ loaded\ value}}
\DoxyCodeLine{01345\ \textcolor{comment}{//\ \ \ from\ consume\ flow\ thru\ assignments\ and\ even\ thru\ function\ calls.\ Also\ notice\ we\ added\ a\ dependency\ on\ the\ dereference\ of\ DATA\ with\ the\ value\ loaded\ from\ consume\ which\ while\ it\ does\ nothing\ actually\ abides\ by\ the\ standard}}
\DoxyCodeLine{01346\ \textcolor{comment}{//\ \ \ by\ enforcing\ a\ source\ code\ data\ dependent\ load\ on\ the\ consume\ operation.\ You\ may\ see\ this\ referred\ to\ as\ artificial\ data\ dependencies\ in\ other\ texts.}}
\DoxyCodeLine{01347\ \textcolor{comment}{//\ \ \ If\ we\ assume\ the\ compiler\ is\ able\ to\ track\ all\ these\ dependencies,\ the\ question\ is\ how\ do\ we\ enforce\ these\ dependencies\ at\ the\ machine\ instruction\ level.\ Let's\ go\ back\ to\ our\ ptr\ dependent\ load\ example.}}
\DoxyCodeLine{01348\ \textcolor{comment}{//}}
\DoxyCodeLine{01349\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01350\ \textcolor{comment}{//\ \ \ addi\ r0,\ pc,\ offset;}}
\DoxyCodeLine{01351\ \textcolor{comment}{//\ \ \ ldr\ r1,\ 0(r0);}}
\DoxyCodeLine{01352\ \textcolor{comment}{//\ \ \ ldr\ r2,\ 0(r1);}}
\DoxyCodeLine{01353\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01354\ \textcolor{comment}{//}}
\DoxyCodeLine{01355\ \textcolor{comment}{//\ \ \ The\ above\ pseudo\ assembly\ does\ a\ pc\ relative\ calculation\ to\ find\ the\ address\ of\ ptr.\ We\ then\ load\ ptr\ and\ then\ continue\ the\ dependency\ chain\ by\ loading\ the\ int\ from\ the\ loaded\ ptr.}}
\DoxyCodeLine{01356\ \textcolor{comment}{//\ \ \ Thus\ r0\ has\ type\ of\ int**,\ which\ we\ use\ to\ load\ r1\ an\ int*\ which\ we\ use\ to\ load\ our\ final\ value\ of\ r2\ which\ is\ the\ int.}}
\DoxyCodeLine{01357\ \textcolor{comment}{//\ \ \ The\ key\ observation\ here\ is\ that\ most\ instructions\ provided\ by\ most\ architectures\ only\ allow\ moving\ from\ a\ base\ register\ +\ offset\ into\ a\ destination\ register.}}
\DoxyCodeLine{01358\ \textcolor{comment}{//\ \ \ This\ allows\ for\ trivial\ capturing\ of\ data\ dependent\ loads\ through\ pointers.\ But\ how\ do\ we\ capture\ the\ data\ dependency\ of\ DATA[y\ -\/\ y].\ We\ would\ need\ something\ like\ this.}}
\DoxyCodeLine{01359\ \textcolor{comment}{//}}
\DoxyCodeLine{01360\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01361\ \textcolor{comment}{//\ \ \ sub\ r1,\ r0,\ r0;\ //\ Assume\ r0\ holds\ y\ from\ the\ Consume\ Operation}}
\DoxyCodeLine{01362\ \textcolor{comment}{//\ \ \ add\ r3,\ r1,\ r2;\ //\ Assume\ r2\ holds\ the\ address\ of\ DATA[0]}}
\DoxyCodeLine{01363\ \textcolor{comment}{//\ \ \ ldr\ r4,\ 0(r3);}}
\DoxyCodeLine{01364\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01365\ \textcolor{comment}{//}}
\DoxyCodeLine{01366\ \textcolor{comment}{//\ \ \ We\ cannot\ use\ two\ registers\ as\ both\ arguments\ to\ the\ load\ instruction.\ Thus\ to\ accomplish\ this\ you\ noticed\ we\ had\ to\ add\ indirect\ data\ dependencies\ through\ registers\ to\ compute\ the\ final\ address\ from\ the\ consume}}
\DoxyCodeLine{01367\ \textcolor{comment}{//\ \ \ load\ of\ y\ and\ then\ load\ from\ the\ final\ computed\ address.\ The\ compiler\ would\ have\ to\ recognize\ all\ these\ dependencies\ and\ enforce\ that\ they\ be\ maintained\ in\ the\ generated\ assembly.}}
\DoxyCodeLine{01368\ \textcolor{comment}{//\ \ \ The\ compiler\ must\ ensure\ the\ entire\ syntactic,\ source\ code,\ data-\/dependency\ chain\ is\ enforced\ in\ the\ generated\ assembly,\ no\ matter\ how\ long\ such\ chain\ may\ be.}}
\DoxyCodeLine{01369\ \textcolor{comment}{//\ \ \ Because\ of\ this\ and\ other\ issues,\ every\ major\ compiler\ unilaterally\ promotes\ consume\ to\ an\ acquire\ operation\ across\ the\ board.\ Read\ reference\ [15]\ for\ more\ information.}}
\DoxyCodeLine{01370\ \textcolor{comment}{//\ \ \ This\ completely\ removes\ the\ actual\ usefulness\ of\ consume\ for\ the\ pointer\ dependent\ case\ which\ is\ used\ quite\ heavily\ in\ concurrent\ read\ heavy\ data\ structures\ where\ updates\ are\ published\ via\ pointer\ swaps.}}
\DoxyCodeLine{01371\ \textcolor{comment}{//}}
\DoxyCodeLine{01372\ \textcolor{comment}{//\ \ \ ********\ read\_depends\ use\ case\ -\/\ Release-\/ReadDepends\ Semantics\ ********}}
\DoxyCodeLine{01373\ \textcolor{comment}{//}}
\DoxyCodeLine{01374\ \textcolor{comment}{//\ \ \ eastl::atomic<T>\ provides\ a\ weaker\ read\_depends\ operation\ that\ only\ encapsulates\ the\ pointer\ dependency\ case\ above.\ Loading\ from\ a\ pointer\ and\ then\ loading\ the\ value\ from\ the\ loaded\ pointer.}}
\DoxyCodeLine{01375\ \textcolor{comment}{//\ \ \ The\ read\_depends\ operation\ can\ be\ used\ on\ loads\ from\ only\ an\ eastl::atomic<T*>\ type.\ The\ return\ pointer\ of\ the\ load\ must\ and\ can\ only\ be\ used\ to\ then\ further\ load\ values.\ And\ that\ is\ it.}}
\DoxyCodeLine{01376\ \textcolor{comment}{//\ \ \ If\ you\ are\ unsure,\ upgrade\ this\ load\ to\ an\ acquire\ operation.}}
\DoxyCodeLine{01377\ \textcolor{comment}{//}}
\DoxyCodeLine{01378\ \textcolor{comment}{//\ \ \ MyStruct*\ ptr\ =\ gAtomicPtr.load(memory\_order\_read\_depends);}}
\DoxyCodeLine{01379\ \textcolor{comment}{//\ \ \ int\ a\ =\ ptr-\/>a;}}
\DoxyCodeLine{01380\ \textcolor{comment}{//\ \ \ int\ b\ =\ ptr-\/>b;}}
\DoxyCodeLine{01381\ \textcolor{comment}{//\ \ \ return\ a\ +\ b;}}
\DoxyCodeLine{01382\ \textcolor{comment}{//}}
\DoxyCodeLine{01383\ \textcolor{comment}{//\ \ \ The\ loads\ from\ ptr\ after\ the\ gAtomicPtr\ load\ ensure\ that\ the\ correct\ values\ of\ a\ and\ b\ are\ observed.\ This\ pairs\ with\ a\ Release\ operation\ on\ the\ writer\ side\ by\ releasing\ gAtomicPtr.}}
\DoxyCodeLine{01384\ \textcolor{comment}{//}}
\DoxyCodeLine{01385\ \textcolor{comment}{//}}
\DoxyCodeLine{01386\ \textcolor{comment}{//\ \ \ As\ said\ above\ the\ returned\ pointer\ from\ a\ .load(memory\_order\_read\_depends)\ can\ only\ be\ used\ to\ then\ further\ load\ values.}}
\DoxyCodeLine{01387\ \textcolor{comment}{//\ \ \ Dereferencing(*)\ and\ Arrow\ Dereferencing(-\/>)\ are\ valid\ operations\ on\ return\ values\ from\ .load(memory\_order\_read\_depends).}}
\DoxyCodeLine{01388\ \textcolor{comment}{//}}
\DoxyCodeLine{01389\ \textcolor{comment}{//\ \ \ MyStruct*\ ptr\ =\ gAtomicPtr.load(memory\_order\_read\_depends);}}
\DoxyCodeLine{01390\ \textcolor{comment}{//\ \ \ int\ a\ =\ ptr-\/>a;\ \ -\/\ VALID}}
\DoxyCodeLine{01391\ \textcolor{comment}{//\ \ \ int\ a\ =\ *ptr;\ \ \ \ -\/\ VALID}}
\DoxyCodeLine{01392\ \textcolor{comment}{//}}
\DoxyCodeLine{01393\ \textcolor{comment}{//\ \ \ Since\ dereferencing\ is\ just\ indexing\ via\ some\ offset\ from\ some\ base\ address,\ this\ also\ means\ addition\ and\ subtraction\ of\ constants\ is\ ok.}}
\DoxyCodeLine{01394\ \textcolor{comment}{//}}
\DoxyCodeLine{01395\ \textcolor{comment}{//\ \ \ int*\ ptr\ =\ gAtomicPtr.load(memory\_order\_read\_depends);}}
\DoxyCodeLine{01396\ \textcolor{comment}{//\ \ \ int\ a\ =\ *(ptr\ +\ 1)\ \ -\/\ VALID}}
\DoxyCodeLine{01397\ \textcolor{comment}{//\ \ \ int\ a\ =\ *(ptr\ -\/\ 1)\ \ -\/\ VALID}}
\DoxyCodeLine{01398\ \textcolor{comment}{//}}
\DoxyCodeLine{01399\ \textcolor{comment}{//\ \ \ Casts\ also\ work\ correctly\ since\ casting\ is\ just\ offsetting\ a\ pointer\ depending\ on\ the\ inheritance\ hierarchy\ or\ if\ using\ intrusive\ containers.}}
\DoxyCodeLine{01400\ \textcolor{comment}{//}}
\DoxyCodeLine{01401\ \textcolor{comment}{//\ \ \ ReadDependsIntrusive**\ intrusivePtr\ =\ gAtomicPtr.load(memory\_order\_read\_depends);}}
\DoxyCodeLine{01402\ \textcolor{comment}{//\ \ \ ReadDependsIntrusive*\ ptr\ =\ ((ReadDependsIntrusive*)(((char*)intrusivePtr)\ -\/\ offsetof(ReadDependsIntrusive,\ next)));}}
\DoxyCodeLine{01403\ \textcolor{comment}{//}}
\DoxyCodeLine{01404\ \textcolor{comment}{//\ \ \ Base*\ basePtr\ =\ gAtomicPtr.load(memory\_order\_read\_depends);}}
\DoxyCodeLine{01405\ \textcolor{comment}{//\ \ \ Dervied*\ derivedPtr\ =\ static\_cast<Derived*>(basePtr);}}
\DoxyCodeLine{01406\ \textcolor{comment}{//}}
\DoxyCodeLine{01407\ \textcolor{comment}{//\ \ \ Both\ of\ the\ above\ castings\ from\ the\ result\ of\ the\ load\ are\ valid\ for\ this\ memory\ order.}}
\DoxyCodeLine{01408\ \textcolor{comment}{//}}
\DoxyCodeLine{01409\ \textcolor{comment}{//\ \ \ You\ can\ reinterpret\_cast\ the\ returned\ pointer\ value\ to\ a\ uintptr\_t\ to\ set\ bits,\ clear\ bits,\ or\ xor\ bits\ but\ the\ pointer\ must\ be\ casted\ back\ before\ doing\ anything\ else.}}
\DoxyCodeLine{01410\ \textcolor{comment}{//}}
\DoxyCodeLine{01411\ \textcolor{comment}{//\ \ \ int*\ ptr\ =\ gAtomicPtr.load(memory\_order\_read\_depends);}}
\DoxyCodeLine{01412\ \textcolor{comment}{//\ \ \ ptr\ =\ reinterpret\_cast<int*>(reinterpret\_cast<uintptr\_t>(ptr)\ \&\ \string~3);}}
\DoxyCodeLine{01413\ \textcolor{comment}{//}}
\DoxyCodeLine{01414\ \textcolor{comment}{//\ \ \ Do\ not\ use\ any\ equality\ or\ relational\ operator\ (==,\ !=,\ >,\ <,\ >=,\ <=)\ results\ in\ the\ computation\ of\ offsets\ before\ dereferencing.}}
\DoxyCodeLine{01415\ \textcolor{comment}{//\ \ \ As\ we\ learned\ above\ in\ the\ Control\ Dependencies\ section,\ CPUs\ will\ not\ order\ Load-\/Load\ Control\ Dependencies.\ Relational\ and\ equality\ operators\ are\ often\ compiled\ using\ branches.}}
\DoxyCodeLine{01416\ \textcolor{comment}{//\ \ \ It\ doesn't\ have\ to\ be\ compiled\ to\ branched,\ condition\ instructions\ could\ be\ used.\ Or\ some\ architectures\ provide\ comparison\ instructions\ such\ as\ set\ less\ than\ which\ do\ not\ need}}
\DoxyCodeLine{01417\ \textcolor{comment}{//\ \ \ branches\ when\ using\ the\ result\ of\ the\ relational\ operator\ in\ arithmetic\ statements.\ Then\ again\ short\ circuiting\ may\ need\ to\ introduct\ branches\ since\ C++\ guarantees\ the}}
\DoxyCodeLine{01418\ \textcolor{comment}{//\ \ \ rest\ of\ the\ expression\ must\ not\ be\ evaluated.}}
\DoxyCodeLine{01419\ \textcolor{comment}{//\ \ \ The\ following\ odd\ code\ is\ forbidden.}}
\DoxyCodeLine{01420\ \textcolor{comment}{//}}
\DoxyCodeLine{01421\ \textcolor{comment}{//\ \ \ int*\ ptr\ =\ gAtomicPtr.load(memory\_order\_read\_depends);}}
\DoxyCodeLine{01422\ \textcolor{comment}{//\ \ \ int*\ ptr2\ =\ ptr\ +\ (ptr\ >=\ 0);}}
\DoxyCodeLine{01423\ \textcolor{comment}{//\ \ \ int\ a\ =\ *ptr2;}}
\DoxyCodeLine{01424\ \textcolor{comment}{//}}
\DoxyCodeLine{01425\ \textcolor{comment}{//\ \ \ Only\ equality\ comparisons\ against\ nullptr\ are\ allowed.\ This\ is\ becase\ the\ compiler\ cannot\ assume\ that\ the\ address\ of\ the\ loaded\ value\ is\ some\ known\ address\ and\ substitute\ our\ loaded\ value.}}
\DoxyCodeLine{01426\ \textcolor{comment}{//\ \ \ int*\ ptr\ =\ gAtomicPtr.load(memory\_order\_read\_depends);}}
\DoxyCodeLine{01427\ \textcolor{comment}{//\ \ \ if\ (ptr\ ==\ nullptr);\ \ -\/\ VALID}}
\DoxyCodeLine{01428\ \textcolor{comment}{//\ \ \ if\ (ptr\ !=\ nullptr);\ \ -\/\ VALID}}
\DoxyCodeLine{01429\ \textcolor{comment}{//}}
\DoxyCodeLine{01430\ \textcolor{comment}{//\ \ \ Thus\ the\ above\ sentence\ that\ states:}}
\DoxyCodeLine{01431\ \textcolor{comment}{//\ \ \ The\ return\ pointer\ of\ the\ load\ must\ and\ can\ only\ be\ used\ to\ then\ further\ load\ values.\ And\ that\ is\ it.}}
\DoxyCodeLine{01432\ \textcolor{comment}{//\ \ \ must\ be\ respected\ by\ the\ programmer.\ This\ memory\ order\ is\ an\ optimization\ added\ for\ efficient\ read\ heavy\ pointer\ swapping\ data\ structures.\ IF\ you\ are\ unsure,\ use\ memory\_order\_acquire.}}
\DoxyCodeLine{01433\ \textcolor{comment}{//}}
\DoxyCodeLine{01434\ \textcolor{comment}{//\ \ \ ********\ Relaxed\ \&\&\ eastl::atomic<T>\ guarantees\ ********}}
\DoxyCodeLine{01435\ \textcolor{comment}{//}}
\DoxyCodeLine{01436\ \textcolor{comment}{//\ \ \ We\ saw\ various\ ways\ that\ compiler\ barriers\ do\ not\ help\ us\ and\ that\ we\ need\ something\ more\ granular\ to\ make\ sure\ accesses\ are\ not\ mangled\ by\ the\ compiler\ to\ be\ considered\ atomic.}}
\DoxyCodeLine{01437\ \textcolor{comment}{//\ \ \ Ensuring\ these\ guarantees\ like\ preventing\ dead-\/store\ elimination\ or\ the\ splitting\ of\ stores\ into\ smaller\ sub\ stores\ is\ where\ the\ C/C++11}}
\DoxyCodeLine{01438\ \textcolor{comment}{//\ \ \ standard\ comes\ into\ play\ to\ define\ what\ it\ means\ to\ operate\ on\ an\ atomic\ object.}}
\DoxyCodeLine{01439\ \textcolor{comment}{//\ \ \ These\ basic\ guarantees\ are\ provided\ via\ new\ compiler\ intrinsics\ on\ gcc/clang\ that\ provide\ explicit\ indication\ to\ the\ compiler.}}
\DoxyCodeLine{01440\ \textcolor{comment}{//\ \ \ Or\ on\ msvc\ by\ casting\ the\ underlying\ atomic\ T\ to\ a\ volatile\ T*,\ providing\ stronger\ compiler\ guarantees\ than\ the\ standard\ requires.}}
\DoxyCodeLine{01441\ \textcolor{comment}{//\ \ \ Essentially\ volatile\ turns\ off\ all\ possible\ optimizations\ on\ that\ variable\ access\ and\ ensures\ all\ volatile\ variables\ cannot\ be}}
\DoxyCodeLine{01442\ \textcolor{comment}{//\ \ \ reordered\ across\ sequence\ points.\ Again\ we\ are\ not\ using\ volatile\ here\ to\ guarantee\ atomicity,\ we\ are\ using\ it\ in\ its\ very\ intended\ purpose}}
\DoxyCodeLine{01443\ \textcolor{comment}{//\ \ \ to\ tell\ the\ compiler\ it\ cannot\ assume\ anything\ about\ the\ contents\ of\ that\ variable.\ Now\ let's\ dive\ into\ the\ base\ guarantees\ of\ eastl::atomic<T>.}}
\DoxyCodeLine{01444\ \textcolor{comment}{//}}
\DoxyCodeLine{01445\ \textcolor{comment}{//\ \ \ The\ standard\ defines\ the\ following\ for\ all\ operations\ on\ an\ atomic\ object\ M.}}
\DoxyCodeLine{01446\ \textcolor{comment}{//}}
\DoxyCodeLine{01447\ \textcolor{comment}{//\ \ \ Write-\/Write\ Coherence:}}
\DoxyCodeLine{01448\ \textcolor{comment}{//\ \ \ If\ an\ operation\ A\ modifies\ an\ atomic\ object\ M(store),\ happens\ before\ an\ operation\ B\ that\ modifies\ M(store),\ then\ A\ shall\ be\ earlier\ than\ B\ in\ the\ modification\ order\ of\ M.}}
\DoxyCodeLine{01449\ \textcolor{comment}{//}}
\DoxyCodeLine{01450\ \textcolor{comment}{//\ \ \ Read-\/Read\ Coherence:}}
\DoxyCodeLine{01451\ \textcolor{comment}{//\ \ \ If\ a\ value\ computation\ A\ on\ an\ atomic\ object\ M(load),\ happens\ before\ a\ value\ computation\ B\ on\ M(load),\ and\ A\ takes\ its\ value\ from\ a\ side\ effect\ X\ on\ M(from\ a\ previous\ store\ to\ M),\ then\ the\ value}}
\DoxyCodeLine{01452\ \textcolor{comment}{//\ \ \ computed\ by\ B\ shall\ either\ be\ the\ value\ stored\ by\ X\ or\ some\ later\ side\ effect\ Y\ on\ M,\ where\ Y\ follows\ X\ in\ the\ modification\ order\ of\ M.}}
\DoxyCodeLine{01453\ \textcolor{comment}{//}}
\DoxyCodeLine{01454\ \textcolor{comment}{//\ \ \ Read-\/Write\ Coherence:}}
\DoxyCodeLine{01455\ \textcolor{comment}{//\ \ \ If\ a\ value\ computation\ A\ on\ an\ atomic\ object\ M(load),\ happens\ before\ an\ operation\ B\ that\ modifies\ M(store),\ then\ A\ shall\ take\ its\ value\ from\ a\ side\ effect\ X\ on\ M,\ where\ X\ precedes\ B\ in\ the\ modification}}
\DoxyCodeLine{01456\ \textcolor{comment}{//\ \ \ order\ of\ M.}}
\DoxyCodeLine{01457\ \textcolor{comment}{//}}
\DoxyCodeLine{01458\ \textcolor{comment}{//\ \ \ Write-\/Read\ Coherence:}}
\DoxyCodeLine{01459\ \textcolor{comment}{//\ \ \ If\ a\ side\ effect\ X\ on\ an\ atomic\ object\ M(store),\ happens\ before\ a\ value\ computation\ B\ on\ M(load),\ then\ the\ evaluation\ of\ B\ must\ take\ its\ value\ from\ X\ or\ from\ some\ side\ effect\ Y\ that\ follows\ X\ in\ the}}
\DoxyCodeLine{01460\ \textcolor{comment}{//\ \ \ modification\ order\ of\ M.}}
\DoxyCodeLine{01461\ \textcolor{comment}{//}}
\DoxyCodeLine{01462\ \textcolor{comment}{//\ \ \ What\ does\ all\ this\ mean.\ This\ is\ just\ a\ pedantic\ way\ of\ saying\ that\ the\ preceding\ coherence\ requirements\ disallow\ compiler\ reordering\ of\ atomic\ operations\ to\ a\ single\ atomic\ object.}}
\DoxyCodeLine{01463\ \textcolor{comment}{//\ \ \ This\ means\ all\ operations\ must\ be\ emitted\ by\ the\ compiler.\ Stores\ cannot\ be\ dead-\/store\ eliminated\ even\ if\ they\ are\ the\ only\ stores.}}
\DoxyCodeLine{01464\ \textcolor{comment}{//\ \ \ Loads\ cannot\ have\ common\ subexpression\ elimination\ performed\ on\ them\ even\ if\ they\ are\ the\ only\ loads.}}
\DoxyCodeLine{01465\ \textcolor{comment}{//\ \ \ Loads\ and\ Stores\ to\ the\ same\ atomic\ object\ cannot\ be\ reordered\ by\ the\ compiler.}}
\DoxyCodeLine{01466\ \textcolor{comment}{//\ \ \ Compiler\ cannot\ introduce\ extra\ loads\ or\ stores\ to\ the\ atomic\ object.}}
\DoxyCodeLine{01467\ \textcolor{comment}{//\ \ \ Compiler\ also\ cannot\ reload\ from\ an\ atomic\ object,\ it\ must\ save\ and\ store\ to\ a\ stack\ slot.}}
\DoxyCodeLine{01468\ \textcolor{comment}{//\ \ \ Essentially\ this\ provides\ all\ the\ necessary\ guarantees\ needed\ when\ treating\ an\ object\ as\ atomic\ from\ the\ compilers\ point\ of\ view.}}
\DoxyCodeLine{01469\ \textcolor{comment}{//}}
\DoxyCodeLine{01470\ \textcolor{comment}{//\ \ \ ********\ Same\ Address\ LoadLoad\ Reordering\ ********}}
\DoxyCodeLine{01471\ \textcolor{comment}{//}}
\DoxyCodeLine{01472\ \textcolor{comment}{//\ \ \ It\ is\ expected\ that\ same\ address\ operations\ cannot\ and\ are\ not\ reordered\ with\ each\ other.\ It\ is\ expected\ that\ operations\ to\ the\ same\ address\ have\ sequential\ consistency\ because}}
\DoxyCodeLine{01473\ \textcolor{comment}{//\ \ \ they\ are\ to\ the\ same\ address.\ If\ you\ picture\ a\ cpu\ executing\ instructions,\ how\ is\ it\ possible\ to\ reorder\ instructions\ to\ the\ same\ address\ and\ yet\ keep\ program\ behaviour\ the\ same.}}
\DoxyCodeLine{01474\ \textcolor{comment}{//\ \ \ Same\ Address\ LoadLoad\ Reordering\ is\ one\ weakening\ that\ is\ possible\ to\ do\ and\ keep\ observed\ program\ behaviour\ for\ a\ single-\/threaded\ program.}}
\DoxyCodeLine{01475\ \textcolor{comment}{//\ \ \ More\ formally,\ A\ and\ B\ are\ two\ memory\ instructions\ onto\ the\ same\ address\ P,\ where\ A\ is\ program\ ordered\ before\ B.\ If\ A\ and\ B\ are\ both\ loads\ then\ their\ order\ need\ not\ be\ ordered.}}
\DoxyCodeLine{01476\ \textcolor{comment}{//\ \ \ If\ B\ is\ a\ store\ then\ it\ cannot\ retire\ the\ store\ before\ A\ instruction\ completes.\ If\ A\ is\ a\ store\ and\ B\ is\ a\ load,\ then\ B\ must\ get\ its\ value\ forwarded\ from\ the\ store\ buffer\ or\ observe\ a\ later\ store}}
\DoxyCodeLine{01477\ \textcolor{comment}{//\ \ \ from\ the\ cache.\ Thus\ Same\ Address\ LDST,\ STST,\ STLD\ cannot\ be\ reordered\ but\ Same\ Address\ LDLD\ can\ be\ reordered.}}
\DoxyCodeLine{01478\ \textcolor{comment}{//\ \ \ Intel\ Itanium\ and\ SPARC\ RMO\ cpus\ allow\ and\ do\ Same\ Address\ LoadLoad\ Reordering.}}
\DoxyCodeLine{01479\ \textcolor{comment}{//\ \ \ Let's\ look\ at\ an\ example.}}
\DoxyCodeLine{01480\ \textcolor{comment}{//}}
\DoxyCodeLine{01481\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01482\ \textcolor{comment}{//\ \ \ Same\ Address\ LoadLoad}}
\DoxyCodeLine{01483\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01484\ \textcolor{comment}{//\ \ \ Initial\ State:}}
\DoxyCodeLine{01485\ \textcolor{comment}{//\ \ \ x\ =\ 0;}}
\DoxyCodeLine{01486\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01487\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ |\ \ \ \ Thread\ 1}}
\DoxyCodeLine{01488\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01489\ \textcolor{comment}{//\ \ \ STORE(x,\ 1)\ \ |\ r0\ =\ LOAD(x)}}
\DoxyCodeLine{01490\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r1\ =\ LOAD(x)}}
\DoxyCodeLine{01491\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01492\ \textcolor{comment}{//\ \ \ Observed:\ r0\ =\ 1\ \&\&\ r0\ =\ 0}}
\DoxyCodeLine{01493\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01494\ \textcolor{comment}{//}}
\DoxyCodeLine{01495\ \textcolor{comment}{//\ \ \ Notice\ in\ the\ above\ example\ it\ has\ appeared\ as\ if\ the\ two\ loads\ from\ the\ same\ address\ have\ been\ reordered.\ If\ we\ first\ observed\ the\ new\ store\ of\ 1,\ then\ the\ next\ load\ should\ not\ observe\ a\ value\ in\ the\ past.}}
\DoxyCodeLine{01496\ \textcolor{comment}{//\ \ \ Many\ programmers,\ expect\ same\ address\ sequential\ consistency,\ all\ accesses\ to\ a\ single\ address\ appear\ to\ execute\ in\ a\ sequential\ order.}}
\DoxyCodeLine{01497\ \textcolor{comment}{//\ \ \ Notice\ this\ violates\ the\ Read-\/Read\ Coherence\ for\ all\ atomic\ objects\ defined\ by\ the\ std\ and\ thus\ provided\ by\ eastl::atomic<T>.}}
\DoxyCodeLine{01498\ \textcolor{comment}{//}}
\DoxyCodeLine{01499\ \textcolor{comment}{//\ \ \ All\ operations\ on\ eastl::atomic<T>\ irrelevant\ of\ the\ memory\ ordering\ of\ the\ operation\ provides\ Same\ Address\ Sequential\ Consistency\ since\ it\ must\ abide\ by\ the\ coherence\ rules\ above.}}
\DoxyCodeLine{01500\ \textcolor{comment}{//}}
\DoxyCodeLine{01501\ \textcolor{comment}{//\ \ \ ********\ eastl::atomic\_thread\_fence\ ********}}
\DoxyCodeLine{01502\ \textcolor{comment}{//}}
\DoxyCodeLine{01503\ \textcolor{comment}{//\ \ \ eastl::atomic\_thread\_fence(relaxed)\ :\ Provides\ no\ ordering\ guarantees}}
\DoxyCodeLine{01504\ \textcolor{comment}{//\ \ \ eastl::atomic\_thread\_fence(acquire)\ :\ Prevents\ all\ prior\ loads\ from\ being\ reordered\ with\ all\ later\ loads\ and\ stores,\ LDLD\ \&\&\ LDST\ memory\ barrier}}
\DoxyCodeLine{01505\ \textcolor{comment}{//\ \ \ eastl::atomic\_thread\_fence(release)\ :\ Prevents\ all\ prior\ loads\ and\ stores\ from\ being\ reordered\ with\ all\ later\ stores,\ STST\ \&\&\ LDST\ memory\ barrier}}
\DoxyCodeLine{01506\ \textcolor{comment}{//\ \ \ eastl::atomic\_thread\_fence(acq\_rel)\ :\ Union\ of\ acquire\ and\ release,\ LDLD\ \&\&\ STST\ \&\&\ LDST\ memory\ barrier}}
\DoxyCodeLine{01507\ \textcolor{comment}{//\ \ \ eastl::atomic\_thread\_fence(seq\_cst)\ :\ Full\ memory\ barrier\ that\ provides\ a\ single\ total\ order}}
\DoxyCodeLine{01508\ \textcolor{comment}{//}}
\DoxyCodeLine{01509\ \textcolor{comment}{//\ \ \ See\ Reference\ [9]\ and\ Fence-\/Fence,\ Atomic-\/Fence,\ Fence-\/Atomic\ Synchronization,\ Atomics\ Order\ and\ Consistency\ in\ the\ C++\ std.}}
\DoxyCodeLine{01510\ \textcolor{comment}{//}}
\DoxyCodeLine{01511\ \textcolor{comment}{//\ \ \ ********\ Atomic\ \&\&\ Fence\ Synchronization\ ********}}
\DoxyCodeLine{01512\ \textcolor{comment}{//}}
\DoxyCodeLine{01513\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01514\ \textcolor{comment}{//\ \ \ Fence-\/Fence\ Synchronization}}
\DoxyCodeLine{01515\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01516\ \textcolor{comment}{//\ \ \ A\ release\ fence\ A\ synchronizes-\/with\ an\ acquire\ fence\ B\ if\ there\ exist\ operations\ X\ and\ Y\ on\ the\ same\ atomic\ object\ M,\ such\ that\ fence\ A\ is\ sequenced-\/before\ operation\ X\ and\ X\ modifies\ M,}}
\DoxyCodeLine{01517\ \textcolor{comment}{//\ \ \ operation\ Y\ is\ sequenced-\/before\ B\ and\ Y\ reads\ the\ value\ written\ by\ X.}}
\DoxyCodeLine{01518\ \textcolor{comment}{//\ \ \ In\ this\ case\ all\ non-\/atomic\ and\ relaxed\ atomic\ stores\ that\ are\ sequenced-\/before\ fence\ A\ will\ happen-\/before\ all\ non-\/atomic\ and\ relaxed\ atomic\ loads\ after\ fence\ B.}}
\DoxyCodeLine{01519\ \textcolor{comment}{//}}
\DoxyCodeLine{01520\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01521\ \textcolor{comment}{//\ \ \ Atomic-\/Fence\ Synchronization}}
\DoxyCodeLine{01522\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01523\ \textcolor{comment}{//\ \ \ An\ atomic\ release\ operation\ A\ on\ atomic\ object\ M\ synchronizes-\/with\ an\ acquire\ fence\ B\ if\ there\ exists\ some\ atomic\ operation\ X\ on\ atomic\ object\ M,\ such\ that\ X\ is\ sequenced-\/before\ B\ and\ reads}}
\DoxyCodeLine{01524\ \textcolor{comment}{//\ \ \ the\ value\ written\ by\ A.}}
\DoxyCodeLine{01525\ \textcolor{comment}{//\ \ \ In\ this\ case\ all\ non-\/atomic\ and\ relaxed\ atomic\ stores\ that\ are\ sequenced-\/before\ atomic\ release\ operation\ A\ will\ happen-\/before\ all\ non-\/atomic\ and\ relaxed\ atomic\ loads\ after\ fence\ B.}}
\DoxyCodeLine{01526\ \textcolor{comment}{//}}
\DoxyCodeLine{01527\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01528\ \textcolor{comment}{//\ \ \ Fence-\/Atomic\ Synchronization}}
\DoxyCodeLine{01529\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01530\ \textcolor{comment}{//\ \ \ A\ release\ fence\ A\ synchronizes-\/with\ an\ atomic\ acquire\ operation\ B\ on\ an\ atomic\ object\ M\ if\ there\ exists\ an\ atomic\ operation\ X\ such\ that\ A\ is\ sequenced-\/before\ X,\ X\ modifies\ M\ and\ B\ reads\ the}}
\DoxyCodeLine{01531\ \textcolor{comment}{//\ \ \ value\ written\ by\ X.}}
\DoxyCodeLine{01532\ \textcolor{comment}{//\ \ \ In\ this\ case\ all\ non-\/atomic\ and\ relaxed\ atomic\ stores\ that\ are\ sequenced-\/before\ fence\ A\ will\ happen-\/before\ all\ non-\/atomic\ and\ relaxed\ atomic\ loads\ after\ atomic\ acquire\ operation\ B.}}
\DoxyCodeLine{01533\ \textcolor{comment}{//}}
\DoxyCodeLine{01534\ \textcolor{comment}{//\ \ \ This\ can\ be\ used\ to\ add\ synchronization\ to\ a\ series\ of\ several\ relaxed\ atomic\ operations,\ as\ in\ the\ following\ trivial\ example.}}
\DoxyCodeLine{01535\ \textcolor{comment}{//}}
\DoxyCodeLine{01536\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01537\ \textcolor{comment}{//\ \ \ Initial\ State:}}
\DoxyCodeLine{01538\ \textcolor{comment}{//\ \ \ x\ =\ 0;}}
\DoxyCodeLine{01539\ \textcolor{comment}{//\ \ \ eastl::atomic<int>\ y\ =\ 0;}}
\DoxyCodeLine{01540\ \textcolor{comment}{//\ \ \ z\ =\ 0;}}
\DoxyCodeLine{01541\ \textcolor{comment}{//\ \ \ eastl::atomic<int>\ w\ =\ 0;}}
\DoxyCodeLine{01542\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01543\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1}}
\DoxyCodeLine{01544\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01545\ \textcolor{comment}{//\ \ \ x\ =\ 2\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r0\ =\ y.load(memory\_order\_relaxed);}}
\DoxyCodeLine{01546\ \textcolor{comment}{//\ \ \ z\ =\ 2\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r1\ =\ w.load(memory\_order\_relaxed);}}
\DoxyCodeLine{01547\ \textcolor{comment}{//\ \ \ atomic\_thread\_fence(memory\_order\_release);\ |\ atomic\_thread\_fence(memory\_order\_acquire);}}
\DoxyCodeLine{01548\ \textcolor{comment}{//\ \ \ y.store(1,\ memory\_order\_relaxed);\ \ \ \ \ \ \ \ \ \ |\ r2\ =\ x}}
\DoxyCodeLine{01549\ \textcolor{comment}{//\ \ \ w.store(1,\ memory\_order\_relaxed);\ \ \ \ \ \ \ \ \ \ |\ r3\ =\ z}}
\DoxyCodeLine{01550\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01551\ \textcolor{comment}{//\ \ \ Observed:\ r0\ =\ 1\ \&\&\ r1\ =\ 1\ \&\&\ r2\ =\ 0\ \&\&\ r3\ =\ 0}}
\DoxyCodeLine{01552\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01553\ \textcolor{comment}{//}}
\DoxyCodeLine{01554\ \textcolor{comment}{//\ \ \ ********\ Atomic\ vs\ Standalone\ Fence\ ********}}
\DoxyCodeLine{01555\ \textcolor{comment}{//}}
\DoxyCodeLine{01556\ \textcolor{comment}{//\ \ \ A\ sequentially\ consistent\ fence\ is\ stronger\ than\ a\ sequentially\ consistent\ operation\ because\ it\ is\ not\ tied\ to\ a\ specific\ atomic\ object.}}
\DoxyCodeLine{01557\ \textcolor{comment}{//\ \ \ An\ atomic\ fence\ must\ provide\ synchronization\ with\ ANY\ atomic\ object\ whereas\ the\ ordering\ on\ the\ atomic\ object\ itself\ must\ only\ provide}}
\DoxyCodeLine{01558\ \textcolor{comment}{//\ \ \ that\ ordering\ on\ that\ SAME\ atomic\ object.\ Thus\ this\ can\ provide\ cheaper\ guarantees\ on\ architectures\ with\ dependency\ tracking\ hardware.}}
\DoxyCodeLine{01559\ \textcolor{comment}{//\ \ \ Let's\ look\ at\ a\ concrete\ example\ that\ will\ make\ this\ all\ clear.}}
\DoxyCodeLine{01560\ \textcolor{comment}{//}}
\DoxyCodeLine{01561\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01562\ \textcolor{comment}{//\ \ \ Initial\ State:}}
\DoxyCodeLine{01563\ \textcolor{comment}{//\ \ \ eastl::atomic<int>\ y\ =\ 0;}}
\DoxyCodeLine{01564\ \textcolor{comment}{//\ \ \ eastl::atomic<int>\ z\ =\ 0;}}
\DoxyCodeLine{01565\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01566\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1}}
\DoxyCodeLine{01567\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01568\ \textcolor{comment}{//\ \ \ z.store(2,\ memory\_order\_relaxed);\ \ \ \ \ \ \ \ \ \ |\ r0\ =\ y.load(memory\_order\_relaxed);}}
\DoxyCodeLine{01569\ \textcolor{comment}{//\ \ \ atomic\_thread\_fence(memory\_order\_seq\_cst);\ |\ atomic\_thread\_fence(memory\_order\_seq\_cst);}}
\DoxyCodeLine{01570\ \textcolor{comment}{//\ \ \ y.store(1,\ memory\_order\_relaxed);\ \ \ \ \ \ \ \ \ \ |\ r1\ =\ z.load(memory\_order\_relaxed);}}
\DoxyCodeLine{01571\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01572\ \textcolor{comment}{//\ \ \ Observed:\ r0\ =\ 1\ \&\&\ r1\ =\ 0}}
\DoxyCodeLine{01573\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01574\ \textcolor{comment}{//}}
\DoxyCodeLine{01575\ \textcolor{comment}{//\ \ \ Here\ the\ two\ sequentially\ consistent\ fences\ synchronize-\/with\ each\ other\ thus\ ensuring\ that\ if\ we\ observe\ r0\ =\ 1\ then\ we\ also\ observe\ that\ r1\ =\ 2.}}
\DoxyCodeLine{01576\ \textcolor{comment}{//\ \ \ In\ the\ above\ example\ if\ we\ observe\ r0\ =\ 1\ it\ is\ impossible\ to\ observe\ r1\ =\ 0.}}
\DoxyCodeLine{01577\ \textcolor{comment}{//}}
\DoxyCodeLine{01578\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01579\ \textcolor{comment}{//\ \ \ Initial\ State:}}
\DoxyCodeLine{01580\ \textcolor{comment}{//\ \ \ eastl::atomic<int>\ x\ =\ 0;}}
\DoxyCodeLine{01581\ \textcolor{comment}{//\ \ \ eastl::atomic<int>\ y\ =\ 0;}}
\DoxyCodeLine{01582\ \textcolor{comment}{//\ \ \ eastl::atomic<int>\ z\ =\ 0;}}
\DoxyCodeLine{01583\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01584\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1}}
\DoxyCodeLine{01585\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01586\ \textcolor{comment}{//\ \ \ z.store(2,\ memory\_order\_relaxed);\ \ \ \ \ \ \ \ \ \ |\ r0\ =\ y.load(memory\_order\_relaxed);}}
\DoxyCodeLine{01587\ \textcolor{comment}{//\ \ \ x.fetch\_add(1,\ memory\_order\_seq\_cst);\ \ \ \ \ \ |\ x.fetch\_add(1,\ memory\_order\_seq\_cst);}}
\DoxyCodeLine{01588\ \textcolor{comment}{//\ \ \ y.store(1,\ memory\_order\_relaxed);\ \ \ \ \ \ \ \ \ \ |\ r1\ =\ z.load(memory\_order\_relaxed);}}
\DoxyCodeLine{01589\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01590\ \textcolor{comment}{//\ \ \ Observed:\ r0\ =\ 1\ \&\&\ r1\ =\ 0}}
\DoxyCodeLine{01591\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01592\ \textcolor{comment}{//}}
\DoxyCodeLine{01593\ \textcolor{comment}{//\ \ \ Here\ the\ two\ fetch\_add\ sequentially\ consistent\ operations\ on\ x\ synchronize-\/with\ each\ other\ ensuring\ that\ if\ we\ observe\ r0\ =\ 1\ then\ we\ cannot\ observer\ r1\ =\ 0;}}
\DoxyCodeLine{01594\ \textcolor{comment}{//\ \ \ The\ thing\ to\ take\ note\ here\ is\ that\ we\ synchronized\ on\ the\ SAME\ atomic\ object,\ that\ being\ the\ atomic\ object\ x.}}
\DoxyCodeLine{01595\ \textcolor{comment}{//\ \ \ Note\ that\ replacing\ the\ x.fetch\_add()\ in\ Thread\ 1\ with\ a\ sequentially\ consistent\ operation\ on\ another\ atomic\ object\ or\ a\ sequentially\ consistent\ fence\ can\ lead\ to}}
\DoxyCodeLine{01596\ \textcolor{comment}{//\ \ \ observing\ r1\ =\ 0\ even\ if\ we\ observe\ r0\ =\ 1.\ For\ example\ the\ following\ code\ may\ fail.}}
\DoxyCodeLine{01597\ \textcolor{comment}{//}}
\DoxyCodeLine{01598\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01599\ \textcolor{comment}{//\ \ \ Initial\ State:}}
\DoxyCodeLine{01600\ \textcolor{comment}{//\ \ \ eastl::atomic<int>\ x\ =\ 0;}}
\DoxyCodeLine{01601\ \textcolor{comment}{//\ \ \ eastl::atomic<int>\ y\ =\ 0;}}
\DoxyCodeLine{01602\ \textcolor{comment}{//\ \ \ eastl::atomic<int>\ z\ =\ 0;}}
\DoxyCodeLine{01603\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01604\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1}}
\DoxyCodeLine{01605\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01606\ \textcolor{comment}{//\ \ \ z.store(2,\ memory\_order\_relaxed);\ \ \ \ \ \ \ \ \ \ |\ r0\ =\ y.load(memory\_order\_relaxed);}}
\DoxyCodeLine{01607\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ x.fetch\_add(1,\ memory\_order\_seq\_cst);}}
\DoxyCodeLine{01608\ \textcolor{comment}{//\ \ \ y.fetch\_add(1,\ memory\_order\_seq\_cst);\ \ \ \ \ \ |\ r1\ =\ z.load(memory\_order\_relaxed);}}
\DoxyCodeLine{01609\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01610\ \textcolor{comment}{//\ \ \ Observed:\ r0\ =\ 1\ \&\&\ r1\ =\ 0}}
\DoxyCodeLine{01611\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01612\ \textcolor{comment}{//}}
\DoxyCodeLine{01613\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01614\ \textcolor{comment}{//\ \ \ Initial\ State:}}
\DoxyCodeLine{01615\ \textcolor{comment}{//\ \ \ eastl::atomic<int>\ x\ =\ 0;}}
\DoxyCodeLine{01616\ \textcolor{comment}{//\ \ \ eastl::atomic<int>\ y\ =\ 0;}}
\DoxyCodeLine{01617\ \textcolor{comment}{//\ \ \ eastl::atomic<int>\ z\ =\ 0;}}
\DoxyCodeLine{01618\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01619\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1}}
\DoxyCodeLine{01620\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01621\ \textcolor{comment}{//\ \ \ z.store(2,\ memory\_order\_relaxed);\ \ \ \ \ \ \ \ \ \ |\ r0\ =\ y.load(memory\_order\_relaxed);}}
\DoxyCodeLine{01622\ \textcolor{comment}{//\ \ \ x.fetch\_add(1,\ memory\_order\_seq\_cst);\ \ \ \ \ \ |\ atomic\_thread\_fence(memory\_order\_seq\_cst);}}
\DoxyCodeLine{01623\ \textcolor{comment}{//\ \ \ y.store(1,\ memory\_order\_relaxed);\ \ \ \ \ \ \ \ \ \ |\ r1\ =\ z.load(memory\_order\_relaxed);}}
\DoxyCodeLine{01624\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01625\ \textcolor{comment}{//\ \ \ Observed:\ r0\ =\ 1\ \&\&\ r1\ =\ 0}}
\DoxyCodeLine{01626\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01627\ \textcolor{comment}{//}}
\DoxyCodeLine{01628\ \textcolor{comment}{//\ \ \ In\ this\ example\ it\ is\ entirely\ possible\ that\ we\ observe\ r0\ =\ 1\ \&\&\ r1\ =\ 0\ even\ though\ we\ have\ source\ code\ causality\ and\ sequentially\ consistent\ operations.}}
\DoxyCodeLine{01629\ \textcolor{comment}{//\ \ \ Observability\ is\ tied\ to\ the\ atomic\ object\ on\ which\ the\ operation\ was\ performed\ and\ the\ thread\ fence\ doesn't\ synchronize-\/with\ the\ fetch\_add\ because}}
\DoxyCodeLine{01630\ \textcolor{comment}{//\ \ \ there\ is\ no\ load\ above\ the\ fence\ that\ reads\ the\ value\ from\ the\ fetch\_add.}}
\DoxyCodeLine{01631\ \textcolor{comment}{//}}
\DoxyCodeLine{01632\ \textcolor{comment}{//\ \ \ ********\ Sequential\ Consistency\ Semantics\ ********}}
\DoxyCodeLine{01633\ \textcolor{comment}{//}}
\DoxyCodeLine{01634\ \textcolor{comment}{//\ \ \ See\ section,\ Order\ and\ consistency,\ in\ the\ C++\ std\ and\ Reference\ [9].}}
\DoxyCodeLine{01635\ \textcolor{comment}{//}}
\DoxyCodeLine{01636\ \textcolor{comment}{//\ \ \ A\ load\ with\ memory\_order\_seq\_cst\ performs\ an\ acquire\ operation}}
\DoxyCodeLine{01637\ \textcolor{comment}{//\ \ \ A\ store\ with\ memory\_order\_seq\_cst\ performs\ a\ release\ operation}}
\DoxyCodeLine{01638\ \textcolor{comment}{//\ \ \ A\ RMW\ with\ memory\_order\_seq\_cst\ performs\ both\ an\ acquire\ and\ a\ release\ operation}}
\DoxyCodeLine{01639\ \textcolor{comment}{//}}
\DoxyCodeLine{01640\ \textcolor{comment}{//\ \ \ All\ memory\_order\_seq\_cst\ operations\ exhibit\ the\ below\ single\ total\ order\ in\ which\ all\ threads\ observe\ all\ modifications\ in\ the\ same\ order}}
\DoxyCodeLine{01641\ \textcolor{comment}{//}}
\DoxyCodeLine{01642\ \textcolor{comment}{//\ \ \ Paraphrasing,\ there\ is\ a\ single\ total\ order\ on\ all\ memory\_order\_seq\_cst\ operations,\ S,\ such\ that\ each\ sequentially\ consistent\ operation\ B\ that\ loads\ a\ value\ from}}
\DoxyCodeLine{01643\ \textcolor{comment}{//\ \ \ atomic\ object\ M\ observes\ either\ the\ result\ of\ the\ last\ sequentially\ consistent\ modification\ A\ on\ M,\ or\ some\ modification\ on\ M\ that\ isn't\ memory\_order\_seq\_cst.}}
\DoxyCodeLine{01644\ \textcolor{comment}{//\ \ \ For\ atomic\ modifications\ A\ and\ B\ on\ an\ atomic\ object\ M,\ B\ occurs\ after\ A\ in\ the\ total\ order\ of\ M\ if:}}
\DoxyCodeLine{01645\ \textcolor{comment}{//\ \ \ there\ is\ a\ memory\_order\_seq\_cst\ fence\ X\ whereby\ A\ is\ sequenced\ before\ X,\ and\ X\ precedes\ B,}}
\DoxyCodeLine{01646\ \textcolor{comment}{//\ \ \ there\ is\ a\ memory\_order\_seq\_cst\ fence\ Y\ whereby\ Y\ is\ sequenced\ before\ B,\ and\ A\ precedes\ Y,}}
\DoxyCodeLine{01647\ \textcolor{comment}{//\ \ \ there\ are\ memory\_order\_seq\_cst\ fences\ X\ and\ Y\ such\ that\ A\ is\ sequenced\ before\ X,\ Y\ is\ sequenced\ before\ B,\ and\ X\ precedes\ Y.}}
\DoxyCodeLine{01648\ \textcolor{comment}{//}}
\DoxyCodeLine{01649\ \textcolor{comment}{//\ \ \ Let's\ look\ at\ some\ examples\ using\ memory\_order\_seq\_cst.}}
\DoxyCodeLine{01650\ \textcolor{comment}{//}}
\DoxyCodeLine{01651\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01652\ \textcolor{comment}{//\ \ \ Store-\/Buffer}}
\DoxyCodeLine{01653\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01654\ \textcolor{comment}{//\ \ \ Initial\ State:}}
\DoxyCodeLine{01655\ \textcolor{comment}{//\ \ \ x\ =\ 0;\ y\ =\ 0;}}
\DoxyCodeLine{01656\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01657\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ Thread\ 1}}
\DoxyCodeLine{01658\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01659\ \textcolor{comment}{//\ \ \ STORE\_RELAXED(x,\ 1)\ \ \ \ \ \ \ \ \ \ |\ STORE\_RELAXED(y,\ 1)}}
\DoxyCodeLine{01660\ \textcolor{comment}{//\ \ \ ATOMIC\_THREAD\_FENCE(SEQ\_CST)\ |\ ATOMIC\_THREAD\_FENCE(SEQ\_CST)}}
\DoxyCodeLine{01661\ \textcolor{comment}{//\ \ \ r0\ =\ LOAD\_RELAXED(y)\ \ \ \ \ \ \ \ \ |\ r1\ =\ LOAD\_RELAXED(x)}}
\DoxyCodeLine{01662\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01663\ \textcolor{comment}{//\ \ \ Observed:\ r0\ =\ 0\ \&\&\ r1\ =\ 0}}
\DoxyCodeLine{01664\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01665\ \textcolor{comment}{//}}
\DoxyCodeLine{01666\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01667\ \textcolor{comment}{//\ \ \ Store-\/Buffer}}
\DoxyCodeLine{01668\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01669\ \textcolor{comment}{//\ \ \ Initial\ State:}}
\DoxyCodeLine{01670\ \textcolor{comment}{//\ \ \ x\ =\ 0;\ y\ =\ 0;}}
\DoxyCodeLine{01671\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01672\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ Thread\ 1}}
\DoxyCodeLine{01673\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01674\ \textcolor{comment}{//\ \ \ STORE\_SEQ\_CST(x,\ 1)\ \ \ \ \ \ \ \ \ \ |\ STORE\_SEQ\_CST(y,\ 1)}}
\DoxyCodeLine{01675\ \textcolor{comment}{//\ \ \ r0\ =\ LOAD\_SEQ\_CST(y)\ \ \ \ \ \ \ \ \ |\ r1\ =\ LOAD\_SEQ\_CST(x)}}
\DoxyCodeLine{01676\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01677\ \textcolor{comment}{//\ \ \ Observed:\ r0\ =\ 0\ \&\&\ r1\ =\ 0}}
\DoxyCodeLine{01678\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01679\ \textcolor{comment}{//}}
\DoxyCodeLine{01680\ \textcolor{comment}{//\ \ \ Both\ solutions\ above\ are\ correct\ to\ ensure\ that\ the\ end\ results\ cannot\ lead\ to\ both\ r0\ and\ r1\ returning\ 0.\ Notice\ that\ the\ second\ one\ requires\ memory\_order\_seq\_cst\ on\ both}}
\DoxyCodeLine{01681\ \textcolor{comment}{//\ \ \ operations\ to\ ensure\ they\ are\ in\ the\ total\ order,\ S,\ for\ all\ memory\_order\_seq\_cst\ operations.\ The\ other\ example\ uses\ the\ stronger\ guarantee\ provided\ by\ a\ sequentially\ consistent\ fence.}}
\DoxyCodeLine{01682\ \textcolor{comment}{//}}
\DoxyCodeLine{01683\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01684\ \textcolor{comment}{//\ \ \ Read-\/To-\/Write\ Causality}}
\DoxyCodeLine{01685\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01686\ \textcolor{comment}{//\ \ \ Initial\ State:}}
\DoxyCodeLine{01687\ \textcolor{comment}{//\ \ \ x\ =\ 0;\ y\ =\ 0;}}
\DoxyCodeLine{01688\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01689\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ Thread\ 1\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ Thread\ 2}}
\DoxyCodeLine{01690\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01691\ \textcolor{comment}{//\ \ \ STORE\_SEQ\_CST(x,\ 1)\ \ \ \ \ \ \ \ \ \ |\ r0\ =\ LOAD\_RELAXED(x)\ \ \ \ \ \ \ \ \ |\ STORE\_RELAXED(y,\ 1)}}
\DoxyCodeLine{01692\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ ATOMIC\_THREAD\_FENCE(SEQ\_CST)\ |\ ATOMIC\_THREAD\_FENCE(SEQ\_CST)}}
\DoxyCodeLine{01693\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r1\ =\ LOAD\_RELAXED(y)\ \ \ \ \ \ \ \ \ |\ r2\ =\ LOAD\_RELAXED(x)}}
\DoxyCodeLine{01694\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01695\ \textcolor{comment}{//\ \ \ Observed:\ r0\ =\ 1\ \&\&\ r1\ =\ 0\ \&\&\ r2\ =\ 0}}
\DoxyCodeLine{01696\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01697\ \textcolor{comment}{//}}
\DoxyCodeLine{01698\ \textcolor{comment}{//\ \ \ You'll\ notice\ this\ example\ is\ an\ in\ between\ example\ of\ the\ Store-\/Buffer\ and\ IRIW\ examples\ we\ have\ seen\ earlier.\ The\ store\ in\ Thread\ 0\ needs\ to\ be\ sequentially\ consistent\ so\ it\ synchronizes\ with\ the}}
\DoxyCodeLine{01699\ \textcolor{comment}{//\ \ \ thread\ fence\ in\ Thread\ 1.\ C++20\ due\ to\ Reference\ [9],\ increased\ the\ strength\ of\ sequentially\ consistent\ fences\ has\ been\ increased\ to\ allow\ for\ the\ following.}}
\DoxyCodeLine{01700\ \textcolor{comment}{//}}
\DoxyCodeLine{01701\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01702\ \textcolor{comment}{//\ \ \ Read-\/To-\/Write\ Causality\ -\/\ C++20}}
\DoxyCodeLine{01703\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01704\ \textcolor{comment}{//\ \ \ Initial\ State:}}
\DoxyCodeLine{01705\ \textcolor{comment}{//\ \ \ x\ =\ 0;\ y\ =\ 0;}}
\DoxyCodeLine{01706\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01707\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ \ Thread\ 1\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ \ \ Thread\ 2}}
\DoxyCodeLine{01708\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01709\ \textcolor{comment}{//\ \ \ STORE\_RELAXED(x,\ 1)\ \ \ \ \ \ \ \ \ \ |\ r0\ =\ LOAD\_RELAXED(x)\ \ \ \ \ \ \ \ \ |\ STORE\_RELAXED(y,\ 1)}}
\DoxyCodeLine{01710\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ ATOMIC\_THREAD\_FENCE(SEQ\_CST)\ |\ ATOMIC\_THREAD\_FENCE(SEQ\_CST)}}
\DoxyCodeLine{01711\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ r1\ =\ LOAD\_RELAXED(y)\ \ \ \ \ \ \ \ \ |\ r2\ =\ LOAD\_RELAXED(x)}}
\DoxyCodeLine{01712\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01713\ \textcolor{comment}{//\ \ \ Observed:\ r0\ =\ 1\ \&\&\ r1\ =\ 0\ \&\&\ r2\ =\ 0}}
\DoxyCodeLine{01714\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01715\ \textcolor{comment}{//}}
\DoxyCodeLine{01716\ \textcolor{comment}{//\ \ \ Notice\ we\ were\ able\ to\ turn\ the\ store\ in\ Thread\ 0\ into\ a\ relaxed\ store\ and\ still\ properly\ observe\ either\ r1\ or\ r2\ returning\ 1.}}
\DoxyCodeLine{01717\ \textcolor{comment}{//\ \ \ Note\ that\ all\ implementations\ of\ the\ C++11\ standard\ for\ every\ architecture\ even\ now\ allows\ the\ C++20\ behaviour.}}
\DoxyCodeLine{01718\ \textcolor{comment}{//\ \ \ The\ C++20\ standard\ memory\ model\ was\ brought\ up\ to\ recognize\ that\ all\ current\ implementations\ are\ able\ to\ implement\ them\ stronger.}}
\DoxyCodeLine{01719\ \textcolor{comment}{//}}
\DoxyCodeLine{01720\ \textcolor{comment}{//\ \ \ ********\ False\ Sharing\ ********}}
\DoxyCodeLine{01721\ \textcolor{comment}{//}}
\DoxyCodeLine{01722\ \textcolor{comment}{//\ \ \ As\ we\ know\ operations\ work\ on\ the\ granularity\ of\ a\ cacheline.\ A\ RMW\ operation\ obviously\ must\ have\ some\ help\ from\ the\ cache\ to\ ensure\ the\ entire\ operation}}
\DoxyCodeLine{01723\ \textcolor{comment}{//\ \ \ is\ seen\ as\ one\ whole\ unit.\ Conceptually\ we\ can\ think\ of\ this\ as\ the\ cpu's\ cache\ taking\ a\ lock\ on\ the\ cacheline,\ the\ cpu\ doing\ the\ read-\/modify-\/write\ operation\ on\ the}}
\DoxyCodeLine{01724\ \textcolor{comment}{//\ \ \ locked\ cacheline,\ and\ then\ releasing\ the\ lock\ on\ the\ cacheline.\ This\ means\ during\ that\ time\ any\ other\ cpu\ needing\ that\ cacheline\ must\ wait\ for\ the\ lock\ to\ be\ released.}}
\DoxyCodeLine{01725\ \textcolor{comment}{//}}
\DoxyCodeLine{01726\ \textcolor{comment}{//\ \ \ If\ we\ have\ two\ atomic\ objects\ doing\ RMW\ operations\ and\ they\ are\ within\ the\ same\ cacheline,\ they\ are\ unintentionally\ contending\ and\ serializing\ with\ each\ other\ even}}
\DoxyCodeLine{01727\ \textcolor{comment}{//\ \ \ though\ they\ are\ two\ completely\ separate\ objects.\ This\ gives\ us\ the\ common\ name\ to\ this\ phenomona\ called\ false\ sharing.}}
\DoxyCodeLine{01728\ \textcolor{comment}{//\ \ \ You\ can\ cacheline\ align\ your\ structure\ or\ the\ eastl::atomic<T>\ object\ to\ prevent\ false\ sharing.}}
\DoxyCodeLine{01729\ \textcolor{comment}{//}}
\DoxyCodeLine{01730\ \textcolor{comment}{//\ \ \ ********\ union\ of\ eastl::atomic<T>\ ********}}
\DoxyCodeLine{01731\ \textcolor{comment}{//}}
\DoxyCodeLine{01732\ \textcolor{comment}{//\ \ \ union\ \{\ eastl::atomic<uint8\_t>\ atomic8;\ eastl::atomic<uint32\_t>\ atomic32;\ \};}}
\DoxyCodeLine{01733\ \textcolor{comment}{//}}
\DoxyCodeLine{01734\ \textcolor{comment}{//\ \ \ While\ we\ know\ that\ operations\ operate\ at\ the\ granularity\ of\ a\ processor's\ cacheline\ size\ and\ so\ we\ may\ expect\ that\ storing\ and\ loading}}
\DoxyCodeLine{01735\ \textcolor{comment}{//\ \ \ from\ different\ width\ atomic\ variables\ at\ the\ same\ address\ to\ not\ cause\ weird\ observable\ behaviour\ but\ it\ may.}}
\DoxyCodeLine{01736\ \textcolor{comment}{//\ \ \ Store\ Buffers\ allow\ smaller\ stores\ to\ replace\ parts\ of\ larger\ loads\ that\ are\ forwarded\ from\ a\ store\ buffer.}}
\DoxyCodeLine{01737\ \textcolor{comment}{//\ \ \ This\ means\ if\ there\ is\ 2\ bytes\ of\ modified\ data\ in\ the\ store\ buffer\ that\ overlaps\ with\ a\ 4\ byte\ load,\ the\ 2\ bytes\ will\ be\ forwarded}}
\DoxyCodeLine{01738\ \textcolor{comment}{//\ \ \ from\ the\ store\ buffer.\ This\ is\ even\ documented\ behaviour\ of\ the\ x86\ store\ buffer\ in\ the\ x86\ architecture\ manual.}}
\DoxyCodeLine{01739\ \textcolor{comment}{//\ \ \ This\ behaviour\ can\ cause\ processors\ to\ observe\ values\ that\ have\ never\ and\ will\ never\ be\ visible\ on\ the\ bus\ to\ other\ processors.}}
\DoxyCodeLine{01740\ \textcolor{comment}{//\ \ \ The\ use\ of\ a\ union\ with\ eastl::atomic<T>\ is\ not\ wrong\ but\ your\ code\ must\ be\ able\ to\ withstand\ these\ effects.}}
\DoxyCodeLine{01741\ \textcolor{comment}{//}}
\DoxyCodeLine{01742\ \textcolor{comment}{//\ \ \ Assume\ everything\ starts\ out\ initially\ as\ zero.}}
\DoxyCodeLine{01743\ \textcolor{comment}{//}}
\DoxyCodeLine{01744\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01745\ \textcolor{comment}{//\ \ \ Thread\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 1\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ |\ Thread\ 2}}
\DoxyCodeLine{01746\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01747\ \textcolor{comment}{//\ \ \ cmpxchg\ 0\ -\/>\ 0x11111111\ \ |\ cmpxchg\ 0x11111111\ -\/>\ 0x22222222\ \ |\ mov\ byte\ 0x33;\ mov\ 4\ bytes\ into\ register;}}
\DoxyCodeLine{01748\ \textcolor{comment}{//\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01749\ \textcolor{comment}{//}}
\DoxyCodeLine{01750\ \textcolor{comment}{//\ \ \ After\ all\ operations\ complete,\ the\ value\ in\ memory\ at\ that\ location\ is,\ 0x22222233.}}
\DoxyCodeLine{01751\ \textcolor{comment}{//\ \ \ It\ is\ possible\ that\ the\ 4\ byte\ load\ in\ thread\ 2\ actually\ returns\ 0x11111133.}}
\DoxyCodeLine{01752\ \textcolor{comment}{//\ \ \ Now\ 0x11111133\ is\ an\ observed\ value\ that\ no\ other\ cpu\ could\ observe\ because\ it\ was\ never\ globally\ visible\ on\ the\ data\ bus.}}
\DoxyCodeLine{01753\ \textcolor{comment}{//}}
\DoxyCodeLine{01754\ \textcolor{comment}{//\ \ \ If\ the\ value\ in\ memory\ is\ 0x22222233\ then\ the\ first\ cmpxchg\ succeeded,\ then\ the\ second\ cmpxchg\ succeeded\ and\ finally\ our}}
\DoxyCodeLine{01755\ \textcolor{comment}{//\ \ \ byte\ to\ memory\ was\ stored,\ yet\ our\ load\ returned\ 0x11111133.\ This\ is\ because\ store\ buffer\ contents\ can\ be\ forwarded\ to\ overlapping\ loads.}}
\DoxyCodeLine{01756\ \textcolor{comment}{//\ \ \ It\ is\ possible\ that\ the\ byte\ store\ got\ put\ in\ the\ store\ buffer.\ Our\ load\ happened\ after\ the\ first\ cmpxchg\ with\ the\ byte\ forwarded.}}
\DoxyCodeLine{01757\ \textcolor{comment}{//\ \ \ This\ behaviour\ is\ fine\ as\ long\ as\ your\ algorithm\ is\ able\ to\ cope\ with\ this\ kind\ of\ store\ buffer\ forwarding\ effects.}}
\DoxyCodeLine{01758\ \textcolor{comment}{//}}
\DoxyCodeLine{01759\ \textcolor{comment}{//\ \ \ Reference\ [13]\ is\ a\ great\ read\ on\ more\ about\ this\ topic\ of\ mixed-\/size\ concurrency.}}
\DoxyCodeLine{01760\ \textcolor{comment}{//}}
\DoxyCodeLine{01761\ }
\DoxyCodeLine{01762\ }
\DoxyCodeLine{01764\ }
\DoxyCodeLine{01765\ }
\DoxyCodeLine{01766\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{runtime_2_e_a_s_t_l_2include_2_e_a_s_t_l_2internal_2atomic_2atomic_8h}{EASTL/internal/atomic/atomic.h}}>}}
\DoxyCodeLine{01767\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{atomic__standalone_8h}{EASTL/internal/atomic/atomic\_standalone.h}}>}}
\DoxyCodeLine{01768\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{atomic__flag_8h}{EASTL/internal/atomic/atomic\_flag.h}}>}}
\DoxyCodeLine{01769\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{atomic__flag__standalone_8h}{EASTL/internal/atomic/atomic\_flag\_standalone.h}}>}}
\DoxyCodeLine{01770\ }
\DoxyCodeLine{01771\ }
\DoxyCodeLine{01772\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ EASTL\_ATOMIC\_H\ */}\textcolor{preprocessor}{}}

\end{DoxyCode}
