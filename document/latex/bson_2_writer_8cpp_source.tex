\doxysection{Writer.\+cpp}
\hypertarget{bson_2_writer_8cpp_source}{}\label{bson_2_writer_8cpp_source}\index{external/reflect-\/cpp/src/rfl/bson/Writer.cpp@{external/reflect-\/cpp/src/rfl/bson/Writer.cpp}}
\mbox{\hyperlink{bson_2_writer_8cpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bson_2_writer_8hpp}{rfl/bson/Writer.hpp}}"{}}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacerfl_1_1bson}{rfl::bson}}\ \{}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_ac0980cb2ad1fd6565b38d74c60979c9e}{Writer::Writer}}(bson\_t*\ \_doc)\ :\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_aa032ab442cf0ff96b8d6c3dbaf40c9b6}{doc\_}}(\_doc)\ \{\}}
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a50c05fc47766c7d783bff1552112122d}{Writer::\string~Writer}}()\ =\ \textcolor{keywordflow}{default};}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_abad45e780d7d7e790ff1775ad63d5749}{Writer::OutputArrayType}}\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_add5f444ad31d5a49c79c9a1d697a8610}{Writer::array\_as\_root}}(}
\DoxyCodeLine{00010\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \_size)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00011\ \ \ bson\_array\_builder\_t*\ val\ =\ bson\_array\_builder\_new();}
\DoxyCodeLine{00012\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_abad45e780d7d7e790ff1775ad63d5749}{OutputArrayType}}(val,\ \mbox{\hyperlink{structrfl_1_1bson_1_1_writer_1_1_is_root}{IsRoot}}\{\});}
\DoxyCodeLine{00013\ \}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a7759dda89d9d3f9b8b87d675358bb9e5}{Writer::OutputObjectType}}\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a2cfada81b1d7bbb9eb8f968f80c24403}{Writer::object\_as\_root}}(}
\DoxyCodeLine{00016\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \_size)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00017\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a7759dda89d9d3f9b8b87d675358bb9e5}{OutputObjectType}}(\mbox{\hyperlink{classrfl_1_1bson_1_1_writer_aa032ab442cf0ff96b8d6c3dbaf40c9b6}{doc\_}},\ \mbox{\hyperlink{structrfl_1_1bson_1_1_writer_1_1_is_root}{IsRoot}}\{\});}
\DoxyCodeLine{00018\ \}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a3cf819240f1cb3f397a9079b64545870}{Writer::OutputVarType}}\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a716ff2c8b24ddbcd1b0763aa5ce68a39}{Writer::null\_as\_root}}()\ const\ noexcept\ \{}
\DoxyCodeLine{00021\ \ \ \textcolor{comment}{//\ Appears\ to\ be\ unsupported\ by\ the\ BSON\ C\ API.}}
\DoxyCodeLine{00022\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a3cf819240f1cb3f397a9079b64545870}{OutputVarType}}\{\};}
\DoxyCodeLine{00023\ \}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_abad45e780d7d7e790ff1775ad63d5749}{Writer::OutputArrayType}}\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a7ec5a2f79b82184c92c12a2a6bcce212}{Writer::add\_array\_to\_array}}(}
\DoxyCodeLine{00026\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \_size,\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_abad45e780d7d7e790ff1775ad63d5749}{OutputArrayType}}*\ \_parent)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00027\ \ \ bson\_array\_builder\_t*\ val;}
\DoxyCodeLine{00028\ \ \ bson\_array\_builder\_append\_array\_builder\_begin(\_parent-\/>val\_,\ \&val);}
\DoxyCodeLine{00029\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_abad45e780d7d7e790ff1775ad63d5749}{OutputArrayType}}(val,\ \mbox{\hyperlink{structrfl_1_1bson_1_1_writer_1_1_is_array}{IsArray}}\{\_parent-\/>val\_\});}
\DoxyCodeLine{00030\ \}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_abad45e780d7d7e790ff1775ad63d5749}{Writer::OutputArrayType}}\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_af1464f68f685ca08f1334af79535d3d6}{Writer::add\_array\_to\_object}}(}
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{keyword}{const}\ std::string\_view\&\ \_name,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \_size,}
\DoxyCodeLine{00034\ \ \ \ \ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a7759dda89d9d3f9b8b87d675358bb9e5}{OutputObjectType}}*\ \_parent)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00035\ \ \ bson\_array\_builder\_t*\ val;}
\DoxyCodeLine{00036\ \ \ bson\_append\_array\_builder\_begin(\_parent-\/>val\_,\ \_name.data(),}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(\_name.size()),\ \&val);}
\DoxyCodeLine{00038\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_abad45e780d7d7e790ff1775ad63d5749}{OutputArrayType}}(val,\ \mbox{\hyperlink{structrfl_1_1bson_1_1_writer_1_1_is_object}{IsObject}}\{\_parent-\/>val\_\});}
\DoxyCodeLine{00039\ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a7759dda89d9d3f9b8b87d675358bb9e5}{Writer::OutputObjectType}}\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a7fb85a276a8f86b6650fb1ae798961ed}{Writer::add\_object\_to\_array}}(}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \_size,\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_abad45e780d7d7e790ff1775ad63d5749}{OutputArrayType}}*\ \_parent)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00043\ \ \ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_afcf8b06efd601dcad2b511a181e0eff2}{subdocs\_}}-\/>emplace\_back(\mbox{\hyperlink{classrfl_1_1_box}{rfl::Box<BSONType>}}());}
\DoxyCodeLine{00044\ \ \ bson\_array\_builder\_append\_document\_begin(\_parent-\/>val\_,}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&(\mbox{\hyperlink{classrfl_1_1bson_1_1_writer_afcf8b06efd601dcad2b511a181e0eff2}{subdocs\_}}-\/>back()-\/>val\_));}
\DoxyCodeLine{00046\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a7759dda89d9d3f9b8b87d675358bb9e5}{OutputObjectType}}(\&\mbox{\hyperlink{classrfl_1_1bson_1_1_writer_afcf8b06efd601dcad2b511a181e0eff2}{subdocs\_}}-\/>back()-\/>val\_,\ \mbox{\hyperlink{structrfl_1_1bson_1_1_writer_1_1_is_array}{IsArray}}\{\_parent-\/>val\_\});}
\DoxyCodeLine{00047\ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a7759dda89d9d3f9b8b87d675358bb9e5}{Writer::OutputObjectType}}\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a667ef3b3cc2ba91d7c47d92e2575a3f6}{Writer::add\_object\_to\_object}}(}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keyword}{const}\ std::string\_view\&\ \_name,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \_size,}
\DoxyCodeLine{00051\ \ \ \ \ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a7759dda89d9d3f9b8b87d675358bb9e5}{OutputObjectType}}*\ \_parent)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00052\ \ \ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_afcf8b06efd601dcad2b511a181e0eff2}{subdocs\_}}-\/>emplace\_back(\mbox{\hyperlink{classrfl_1_1_box}{rfl::Box<BSONType>}}());}
\DoxyCodeLine{00053\ \ \ bson\_append\_document\_begin(\_parent-\/>val\_,\ \_name.data(),}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(\_name.size()),}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&(\mbox{\hyperlink{classrfl_1_1bson_1_1_writer_afcf8b06efd601dcad2b511a181e0eff2}{subdocs\_}}-\/>back()-\/>val\_));}
\DoxyCodeLine{00056\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a7759dda89d9d3f9b8b87d675358bb9e5}{OutputObjectType}}(\&\mbox{\hyperlink{classrfl_1_1bson_1_1_writer_afcf8b06efd601dcad2b511a181e0eff2}{subdocs\_}}-\/>back()-\/>val\_,\ \mbox{\hyperlink{structrfl_1_1bson_1_1_writer_1_1_is_object}{IsObject}}\{\_parent-\/>val\_\});}
\DoxyCodeLine{00057\ \}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a3cf819240f1cb3f397a9079b64545870}{Writer::OutputVarType}}\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_adf8772758d773be677b69a821fb44fc3}{Writer::add\_null\_to\_array}}(}
\DoxyCodeLine{00060\ \ \ \ \ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_abad45e780d7d7e790ff1775ad63d5749}{OutputArrayType}}*\ \_parent)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00061\ \ \ bson\_array\_builder\_append\_null(\_parent-\/>val\_);}
\DoxyCodeLine{00062\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a3cf819240f1cb3f397a9079b64545870}{OutputVarType}}\{\};}
\DoxyCodeLine{00063\ \}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a3cf819240f1cb3f397a9079b64545870}{Writer::OutputVarType}}\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a56e5fb610661f004439cbefe4a928a9d}{Writer::add\_null\_to\_object}}(}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keyword}{const}\ std::string\_view\&\ \_name,\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a7759dda89d9d3f9b8b87d675358bb9e5}{OutputObjectType}}*\ \_parent)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00067\ \ \ bson\_append\_null(\_parent-\/>val\_,\ \_name.data(),\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(\_name.size()));}
\DoxyCodeLine{00068\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a3cf819240f1cb3f397a9079b64545870}{OutputVarType}}\{\};}
\DoxyCodeLine{00069\ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a3ddce24fa70ec934a949aeb5abacea8f}{Writer::end\_array}}(\mbox{\hyperlink{classrfl_1_1bson_1_1_writer_abad45e780d7d7e790ff1775ad63d5749}{OutputArrayType}}*\ \_arr)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00072\ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ handle\ =\ [\&](\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \_parent)\ \{}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{ir__common_8h_a1ac75f8fee198af783521627f1fecfbc}{Type}}\ =\ std::remove\_cvref\_t<\textcolor{keyword}{decltype}(\_parent)>;}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::is\_same<Type,\ IsArray>())\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \ \ bson\_array\_builder\_append\_array\_builder\_end(\_parent.ptr\_,\ \_arr-\/>val\_);}
\DoxyCodeLine{00076\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::is\_same<Type,\ IsObject>())\ \{}
\DoxyCodeLine{00077\ \ \ \ \ \ \ bson\_append\_array\_builder\_end(\_parent.ptr\_,\ \_arr-\/>val\_);}
\DoxyCodeLine{00078\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::is\_same<Type,\ IsRoot>())\ \{}
\DoxyCodeLine{00079\ \ \ \ \ \ \ bson\_array\_builder\_build(\_arr-\/>val\_,\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_aa032ab442cf0ff96b8d6c3dbaf40c9b6}{doc\_}});}
\DoxyCodeLine{00080\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \textcolor{keyword}{static\_assert}(\mbox{\hyperlink{namespacerfl_a31e80cea0068eae493065be48bba8d04}{rfl::always\_false\_v<Type>}},\ \textcolor{stringliteral}{"{}Unsupported\ type."{}});}
\DoxyCodeLine{00082\ \ \ \ \ \}}
\DoxyCodeLine{00083\ \ \ \};}
\DoxyCodeLine{00084\ \ \ std::visit(handle,\ \_arr-\/>parent\_);}
\DoxyCodeLine{00085\ \}}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a70b35fd8220da91fee717201a342f0e5}{Writer::end\_object}}(\mbox{\hyperlink{classrfl_1_1bson_1_1_writer_a7759dda89d9d3f9b8b87d675358bb9e5}{OutputObjectType}}*\ \_obj)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00088\ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ handle\ =\ [\&](\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \_parent)\ \{}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{ir__common_8h_a1ac75f8fee198af783521627f1fecfbc}{Type}}\ =\ std::remove\_cvref\_t<\textcolor{keyword}{decltype}(\_parent)>;}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::is\_same<Type,\ IsArray>())\ \{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ bson\_array\_builder\_append\_document\_end(\_parent.ptr\_,\ \_obj-\/>val\_);}
\DoxyCodeLine{00092\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::is\_same<Type,\ IsObject>())\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \ \ bson\_append\_document\_end(\_parent.ptr\_,\ \_obj-\/>val\_);}
\DoxyCodeLine{00094\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ \textcolor{keyword}{constexpr}\ (std::is\_same<Type,\ IsRoot>())\ \{}
\DoxyCodeLine{00095\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \textcolor{keyword}{static\_assert}(\mbox{\hyperlink{namespacerfl_a31e80cea0068eae493065be48bba8d04}{rfl::always\_false\_v<Type>}},\ \textcolor{stringliteral}{"{}Unsupported\ type."{}});}
\DoxyCodeLine{00097\ \ \ \ \ \}}
\DoxyCodeLine{00098\ \ \ \};}
\DoxyCodeLine{00099\ \ \ std::visit(handle,\ \_obj-\/>parent\_);}
\DoxyCodeLine{00100\ \}}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \}\ \ \textcolor{comment}{//\ namespace\ rfl::bson}}

\end{DoxyCode}
