\doxysection{stencil\+Reduce\+OCL.\+hpp}
\hypertarget{stencil_reduce_o_c_l_8hpp_source}{}\label{stencil_reduce_o_c_l_8hpp_source}\index{external/taskflow/3rd-\/party/ff/stencilReduceOCL.hpp@{external/taskflow/3rd-\/party/ff/stencilReduceOCL.hpp}}
\mbox{\hyperlink{stencil_reduce_o_c_l_8hpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*\ -\/*-\/\ Mode:\ C++;\ tab-\/width:\ 4;\ c-\/basic-\/offset:\ 4;\ indent-\/tabs-\/mode:\ nil\ -\/*-\/\ */}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{comment}{/*\ ***************************************************************************}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ *\ \ FastFlow\ is\ free\ software;\ you\ can\ redistribute\ it\ and/or\ modify\ it}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ *\ \ under\ the\ terms\ of\ the\ GNU\ Lesser\ General\ Public\ License\ version\ 3\ as}}
\DoxyCodeLine{00015\ \textcolor{comment}{\ *\ \ published\ by\ the\ Free\ Software\ Foundation.}}
\DoxyCodeLine{00016\ \textcolor{comment}{\ *\ \ Starting\ from\ version\ 3.0.1\ FastFlow\ is\ dual\ licensed\ under\ the\ GNU\ LGPLv3}}
\DoxyCodeLine{00017\ \textcolor{comment}{\ *\ \ or\ MIT\ License\ (https://github.com/ParaGroup/WindFlow/blob/vers3.x/LICENSE.MIT)}}
\DoxyCodeLine{00018\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00019\ \textcolor{comment}{\ *\ \ This\ program\ is\ distributed\ in\ the\ hope\ that\ it\ will\ be\ useful,\ but\ WITHOUT}}
\DoxyCodeLine{00020\ \textcolor{comment}{\ *\ \ ANY\ WARRANTY;\ without\ even\ the\ implied\ warranty\ of\ MERCHANTABILITY\ or}}
\DoxyCodeLine{00021\ \textcolor{comment}{\ *\ \ FITNESS\ FOR\ A\ PARTICULAR\ PURPOSE.\ \ See\ the\ GNU\ Lesser\ General\ Public}}
\DoxyCodeLine{00022\ \textcolor{comment}{\ *\ \ License\ for\ more\ details.}}
\DoxyCodeLine{00023\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00024\ \textcolor{comment}{\ *\ \ You\ should\ have\ received\ a\ copy\ of\ the\ GNU\ Lesser\ General\ Public\ License}}
\DoxyCodeLine{00025\ \textcolor{comment}{\ *\ \ along\ with\ this\ program;\ if\ not,\ write\ to\ the\ Free\ Software\ Foundation,}}
\DoxyCodeLine{00026\ \textcolor{comment}{\ *\ \ Inc.,\ 59\ Temple\ Place\ -\/\ Suite\ 330,\ Boston,\ MA\ 02111-\/1307,\ USA.}}
\DoxyCodeLine{00027\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00028\ \textcolor{comment}{\ ****************************************************************************}}
\DoxyCodeLine{00029\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{comment}{/*}}
\DoxyCodeLine{00032\ \textcolor{comment}{\ *\ \ Authors:}}
\DoxyCodeLine{00033\ \textcolor{comment}{\ *\ \ \ \ Maurizio\ Drocco}}
\DoxyCodeLine{00034\ \textcolor{comment}{\ *\ \ \ \ Massimo\ Torquati}}
\DoxyCodeLine{00035\ \textcolor{comment}{\ *\ \ \ \ Marco\ Aldinucci\ }}
\DoxyCodeLine{00036\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00037\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#ifndef\ FF\_STENCILREDUCE\_OCL\_HPP}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\#define\ FF\_STENCILREDUCE\_OCL\_HPP}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\#ifdef\ FF\_OPENCL}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\#include\ <fstream>}}
\DoxyCodeLine{00046\ \textcolor{preprocessor}{\#include\ <tuple>}}
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\#include\ <algorithm>}}
\DoxyCodeLine{00048\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{bitflags_8hpp}{ff/bitflags.hpp}}>}}
\DoxyCodeLine{00049\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{oclnode_8hpp}{ff/oclnode.hpp}}>}}
\DoxyCodeLine{00050\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{node_8hpp}{ff/node.hpp}}>}}
\DoxyCodeLine{00051\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{oclallocator_8hpp}{ff/oclallocator.hpp}}>}}
\DoxyCodeLine{00052\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{stencil_reduce_o_c_l__macros_8hpp}{ff/stencilReduceOCL\_macros.hpp}}>}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceff}{ff}}\ \{}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \textcolor{keyword}{enum}\ reduceMode\ \{\ REDUCE\_INPUT,\ REDUCE\_OUTPUT\ \};}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00062\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ TaskT\_,\ \textcolor{keyword}{typename}\ Tin\_,\ \textcolor{keyword}{typename}\ Tout\_\ =\ Tin\_>}
\DoxyCodeLine{00063\ \textcolor{keyword}{class\ }baseOCLTask\ \{}
\DoxyCodeLine{00064\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keyword}{typedef}\ TaskT\_\ \ TaskT;}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keyword}{typedef}\ Tin\_\ \ \ \ Tin;}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keyword}{typedef}\ Tout\_\ \ \ Tout;}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ baseOCLTask():\ inPtr(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}),outPtr(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}),reduceVar(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}),}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ size\_in(0),size\_out(0),iter(0),}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tuple\_in(std::\mbox{\hyperlink{namespacerfl_ac71a9ec8b4d8fd347719083ec38c00f9}{make\_tuple}}(\mbox{\hyperlink{yyjson_8h_a41f9c5fb8b08eb5dc3edce4dcb37fee7}{true}},\mbox{\hyperlink{yyjson_8h_a65e9886d74aaee76545e83dd09011727}{false}},\mbox{\hyperlink{yyjson_8h_a65e9886d74aaee76545e83dd09011727}{false}})),}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tuple\_out(std::\mbox{\hyperlink{namespacerfl_ac71a9ec8b4d8fd347719083ec38c00f9}{make\_tuple}}(\mbox{\hyperlink{yyjson_8h_a41f9c5fb8b08eb5dc3edce4dcb37fee7}{true}},\mbox{\hyperlink{yyjson_8h_a65e9886d74aaee76545e83dd09011727}{false}},\mbox{\hyperlink{yyjson_8h_a65e9886d74aaee76545e83dd09011727}{false}}))\ \ \ \{\ \}\ \ \ }
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keyword}{virtual}\ \string~baseOCLTask()\ \{\ \}}
\DoxyCodeLine{00074\ \ \ \ \ }
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{comment}{//\ user\ must\ override\ this\ method\ using:}}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{comment}{//\ -\/\ setInPtr\ for\ setting\ the\ host-\/pointer\ to\ the\ input\ array}}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{comment}{//\ -\/\ setOutPtr\ for\ setting\ the\ host-\/pointer\ to\ the\ output\ array}}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{comment}{//\ -\/\ setEnvPtr\ for\ adding\ to\ env-\/list\ the\ host-\/pointer\ to\ a\ read-\/only\ env}}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{comment}{//\ -\/\ other\ methods\ from\ classes\ derived\ from\ baseOCLTask}}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{comment}{//\ NOTE:\ order\ of\ setEnvPtr\ calls\ matters!\ TODO\ refine\ interface?}}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ setTask(TaskT\ *\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}})\ =\ 0;}
\DoxyCodeLine{00082\ \ \ \ \ }
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{comment}{/*\ -\/-\/-\/\ the\ user\ may\ overrider\ these\ methods\ -\/-\/-\/\ */}\ }
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{comment}{//\ called\ at\ the\ end\ of\ the\ stencil-\/reduce\ loop.\ It\ may\ be\ used\ to\ }}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{comment}{//\ perform\ per-\/task\ host\ memory\ cleanup\ (i.e.\ releasing\ the\ host\ memory\ }}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{comment}{//\ previously\ allocated\ in\ the\ setTask\ function)\ or\ to\ execute\ a\ }}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{comment}{//\ post-\/elaboration\ phase}}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \ \ releaseTask(TaskT\ *\mbox{\hyperlink{boing_8c_a87accd1af8e0aff4b818d891374f7cec}{t}})\ \{\}}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{comment}{//\ computes\ the\ loop\ iteration\ condition}}
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ \ \ iterCondition(\textcolor{keyword}{const}\ Tout\&,\ \textcolor{keywordtype}{size\_t})\ \{\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \}\ }
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{comment}{//\ host\ reduce\ function}}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keyword}{virtual}\ Tout\ \ \ combinator(\textcolor{keyword}{const}\ Tout\&,\ \textcolor{keyword}{const}\ Tout\&)\ \ \{\ \textcolor{keywordflow}{return}\ Tout();\ \}}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{comment}{//\ step\ functions}}
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \ \ incIter()\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ ++iter;\ \}}
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{size\_t}\ getIter()\textcolor{keyword}{\ const\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }\{\ \textcolor{keywordflow}{return}\ iter;\ \}}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \ \ resetIter(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ val=0)\ \{\ iter\ =\ val;\ \}\ }
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}\ \ }
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keywordtype}{void}\ resetTask()\ \{}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ envPtr.resize(0);}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ copyEnv.resize(0);}
\DoxyCodeLine{00104\ \ \ \ \ \}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keywordtype}{void}\ setInPtr(Tin*\ \_inPtr,\ \textcolor{keywordtype}{size\_t}\ sizeIn,\ }
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CopyFlags\ \ \ \ \mbox{\hyperlink{level1__impl_8h_a7ffc26122ca6f9bec01f9bc5e64f3006}{copy}}\ \ \ =CopyFlags::COPY,\ }
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ReuseFlags\ \ \ reuse\ \ =ReuseFlags::DONTREUSE,\ }
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ReleaseFlags\ release=ReleaseFlags::DONTRELEASE)\ \ \{\ }
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ inPtr\ \ =\ \_inPtr;\ size\_in\ =\ sizeIn;\ }
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ tuple\_in\ =\ std::make\_tuple(\mbox{\hyperlink{level1__impl_8h_a7ffc26122ca6f9bec01f9bc5e64f3006}{copy}}==CopyFlags::COPY,}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ reuse==ReuseFlags::REUSE,}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ release==ReleaseFlags::RELEASE);}
\DoxyCodeLine{00123\ \ \ \ \ \}}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keywordtype}{void}\ setInPtr(Tin*\ \_inPtr,\ \textcolor{keywordtype}{size\_t}\ sizeIn,\ \textcolor{keyword}{const}\ MemoryFlags\ \&\mbox{\hyperlink{test__split__node_8cpp_afea5520dffc22c33fbcc0eb5f7e3d448}{flags}})\ \{\ }
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ inPtr\ \ =\ \_inPtr;\ size\_in\ =\ sizeIn;\ }
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ tuple\_in\ =\ std::make\_tuple(\mbox{\hyperlink{test__split__node_8cpp_afea5520dffc22c33fbcc0eb5f7e3d448}{flags}}.copy==CopyFlags::COPY,}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__split__node_8cpp_afea5520dffc22c33fbcc0eb5f7e3d448}{flags}}.reuse==ReuseFlags::REUSE,}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__split__node_8cpp_afea5520dffc22c33fbcc0eb5f7e3d448}{flags}}.release==ReleaseFlags::RELEASE);}
\DoxyCodeLine{00135\ \ \ \ \ \}}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{keywordtype}{void}\ setOutPtr(Tout*\ \_outPtr,\ \textcolor{keywordtype}{size\_t}\ sizeOut,\ }
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CopyFlags\ copyback\ \ \ \ =CopyFlags::COPY,\ }
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ReuseFlags\ reuse\ \ \ \ \ \ =ReuseFlags::DONTREUSE,\ }
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ReleaseFlags\ release\ \ =ReleaseFlags::DONTRELEASE)\ \ \{\ }
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ outPtr\ =\ \_outPtr;\ size\_out\ =\ sizeOut;\ }
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ tuple\_out\ =\ std::make\_tuple(copyback==CopyFlags::COPY,}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ reuse==ReuseFlags::REUSE,}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ release==ReleaseFlags::RELEASE);}
\DoxyCodeLine{00150\ \ \ \ \ \}}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{keywordtype}{void}\ setOutPtr(Tout*\ \_outPtr,\ \textcolor{keywordtype}{size\_t}\ sizeOut,\ \textcolor{keyword}{const}\ MemoryFlags\ \&\mbox{\hyperlink{test__split__node_8cpp_afea5520dffc22c33fbcc0eb5f7e3d448}{flags}}\ )\ \{\ }
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ outPtr\ =\ \_outPtr;\ size\_out\ =\ sizeOut;\ }
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ tuple\_out\ =\ std::make\_tuple(\mbox{\hyperlink{test__split__node_8cpp_afea5520dffc22c33fbcc0eb5f7e3d448}{flags}}.copy==CopyFlags::COPY,}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__split__node_8cpp_afea5520dffc22c33fbcc0eb5f7e3d448}{flags}}.reuse==ReuseFlags::REUSE,}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__split__node_8cpp_afea5520dffc22c33fbcc0eb5f7e3d448}{flags}}.release==ReleaseFlags::RELEASE);}
\DoxyCodeLine{00162\ \ \ \ \ \}}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ ptrT>}
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{keywordtype}{void}\ setEnvPtr(\textcolor{keyword}{const}\ ptrT*\ \_envPtr,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}},\ }
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CopyFlags\ \mbox{\hyperlink{level1__impl_8h_a7ffc26122ca6f9bec01f9bc5e64f3006}{copy}}\ \ \ =CopyFlags::COPY,\ }
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ReuseFlags\ reuse\ \ =ReuseFlags::DONTREUSE,\ }
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ReleaseFlags\ release=ReleaseFlags::DONTRELEASE)\ \ \{\ }
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ assert(envPtr.size()\ ==\ copyEnv.size());}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ envPtr.push\_back(std::make\_pair((\textcolor{keywordtype}{void}*)\_envPtr,\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}}*\textcolor{keyword}{sizeof}(ptrT)));}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ copyEnv.push\_back(std::make\_tuple(\textcolor{keyword}{sizeof}(ptrT),\ }
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{level1__impl_8h_a7ffc26122ca6f9bec01f9bc5e64f3006}{copy}}==CopyFlags::COPY,}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ reuse==ReuseFlags::REUSE,}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ release==ReleaseFlags::RELEASE));\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00180\ \ \ \ \ \}}
\DoxyCodeLine{00181\ \ \ \ \ }
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ ptrT>}
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{keywordtype}{void}\ setEnvPtr(\textcolor{keyword}{const}\ ptrT*\ \_envPtr,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}},\ \textcolor{keyword}{const}\ MemoryFlags\ \&\mbox{\hyperlink{test__split__node_8cpp_afea5520dffc22c33fbcc0eb5f7e3d448}{flags}})\ \{\ }
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ assert(envPtr.size()\ ==\ copyEnv.size());}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ envPtr.push\_back(std::make\_pair((\textcolor{keywordtype}{void}*)\_envPtr,\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}}*\textcolor{keyword}{sizeof}(ptrT)));}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ copyEnv.push\_back(std::make\_tuple(\textcolor{keyword}{sizeof}(ptrT),\ }
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__split__node_8cpp_afea5520dffc22c33fbcc0eb5f7e3d448}{flags}}.copy==CopyFlags::COPY,}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__split__node_8cpp_afea5520dffc22c33fbcc0eb5f7e3d448}{flags}}.reuse==ReuseFlags::REUSE,}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__split__node_8cpp_afea5520dffc22c33fbcc0eb5f7e3d448}{flags}}.release==ReleaseFlags::RELEASE));}
\DoxyCodeLine{00195\ \ \ \ \ \}}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \ \ Tin\ *\ \ \ getInPtr()\textcolor{keyword}{\ \ \ \ const\ }\{\ \textcolor{keywordflow}{return}\ inPtr;\ \ \}}
\DoxyCodeLine{00198\ \ \ \ \ Tout\ *\ \ getOutPtr()\textcolor{keyword}{\ \ \ const\ }\{\ \textcolor{keywordflow}{return}\ outPtr;\ \}}
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ ptrT>}
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{keywordtype}{void}\ getEnvPtr(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx,\ ptrT\ *\&\ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}})\textcolor{keyword}{\ \ const\ }\{\ }
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ assert(idx\ <\ envPtr.size());}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{yyjson_8h_a26c622783fa717b24fe0bbd3e060f74a}{ptr}}\ =\ \textcolor{keyword}{reinterpret\_cast<}ptrT*\textcolor{keyword}{>}(envPtr[idx].first);}
\DoxyCodeLine{00203\ \ \ \ \ \}}
\DoxyCodeLine{00204\ \ \ \ \ }
\DoxyCodeLine{00205\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ getEnvNum()\textcolor{keyword}{\ const\ }\{\ }
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ assert(envPtr.size()\ ==\ copyEnv.size());}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ envPtr.size();}
\DoxyCodeLine{00208\ \ \ \ \ \}}
\DoxyCodeLine{00209\ \ \ \ \ }
\DoxyCodeLine{00210\ \ \ \ \ \textcolor{keywordtype}{bool}\ \ getCopyEnv(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx)\textcolor{keyword}{\ const\ }\{\ }
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ assert(idx\ <\ copyEnv.size());}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacestd_aae41d8280b7ccc3f0e0a0be2dab21c8f}{std::get<1>}}(copyEnv[idx]);}
\DoxyCodeLine{00213\ \ \ \ \ \}}
\DoxyCodeLine{00214\ \ \ \ \ \textcolor{keywordtype}{bool}\ \ getReuseEnv(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx)\textcolor{keyword}{\ const\ }\{\ }
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ assert(idx\ <\ copyEnv.size());}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacestd_aae41d8280b7ccc3f0e0a0be2dab21c8f}{std::get<2>}}(copyEnv[idx]);}
\DoxyCodeLine{00217\ \ \ \ \ \}}
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{keywordtype}{bool}\ \ getReleaseEnv(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx)\textcolor{keyword}{\ const\ }\{\ }
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ assert(idx\ <\ copyEnv.size());}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacestd_aae41d8280b7ccc3f0e0a0be2dab21c8f}{std::get<3>}}(copyEnv[idx]);}
\DoxyCodeLine{00221\ \ \ \ \ \}}
\DoxyCodeLine{00222\ \ \ \ \ }
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{keywordtype}{bool}\ getCopyIn()\textcolor{keyword}{\ \ \ \ \ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacestd_aae41d8280b7ccc3f0e0a0be2dab21c8f}{std::get<0>}}(tuple\_in);\ \}}
\DoxyCodeLine{00224\ \ \ \ \ \textcolor{keywordtype}{bool}\ getReuseIn()\textcolor{keyword}{\ \ \ \ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacestd_aae41d8280b7ccc3f0e0a0be2dab21c8f}{std::get<1>}}(tuple\_in);\ \}}
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{keywordtype}{bool}\ getReleaseIn()\textcolor{keyword}{\ \ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacestd_aae41d8280b7ccc3f0e0a0be2dab21c8f}{std::get<2>}}(tuple\_in);\ \}}
\DoxyCodeLine{00226\ }
\DoxyCodeLine{00227\ \ \ \ \ \textcolor{keywordtype}{bool}\ getCopyOut()\textcolor{keyword}{\ \ \ \ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacestd_aae41d8280b7ccc3f0e0a0be2dab21c8f}{std::get<0>}}(tuple\_out);\ \}}
\DoxyCodeLine{00228\ \ \ \ \ \textcolor{keywordtype}{bool}\ getReuseOut()\textcolor{keyword}{\ \ \ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacestd_aae41d8280b7ccc3f0e0a0be2dab21c8f}{std::get<1>}}(tuple\_out);\ \}}
\DoxyCodeLine{00229\ \ \ \ \ \textcolor{keywordtype}{bool}\ getReleaseOut()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacestd_aae41d8280b7ccc3f0e0a0be2dab21c8f}{std::get<2>}}(tuple\_out);\ \}}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ }
\DoxyCodeLine{00232\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ getSizeIn()\textcolor{keyword}{\ \ \ const\ }\{\ \textcolor{keywordflow}{return}\ size\_in;\ \ \ \}}
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ getSizeOut()\textcolor{keyword}{\ \ const\ }\{\ \textcolor{keywordflow}{return}\ (size\_out==0)?size\_in:size\_out;\ \ \}}
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ getSizeEnv(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx)\textcolor{keyword}{\ \ const\ }\{\ }
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ assert(idx\ <\ copyEnv.size());}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacestd_aae41d8280b7ccc3f0e0a0be2dab21c8f}{std::get<0>}}(copyEnv[idx]);}
\DoxyCodeLine{00237\ \ \ \ \ \}}
\DoxyCodeLine{00238\ \ \ \ \ }
\DoxyCodeLine{00239\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ getBytesizeIn()\textcolor{keyword}{\ \ \ \ const\ }\{\ \textcolor{keywordflow}{return}\ getSizeIn()\ *\ \textcolor{keyword}{sizeof}(Tin);\ \}}
\DoxyCodeLine{00240\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ getBytesizeOut()\textcolor{keyword}{\ \ \ const\ }\{\ \textcolor{keywordflow}{return}\ getSizeOut()\ *\ \textcolor{keyword}{sizeof}(Tout);\ \}}
\DoxyCodeLine{00241\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ getBytesizeEnv(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx)\textcolor{keyword}{\ \ const\ }\{\ }
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ assert(idx\ <\ envPtr.size());}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ envPtr[idx].second;}
\DoxyCodeLine{00244\ \ \ \ \ \}}
\DoxyCodeLine{00245\ \ \ \ \ }
\DoxyCodeLine{00246\ \ \ \ \ \textcolor{keywordtype}{void}\ \ setReduceVar(\textcolor{keyword}{const}\ Tout\ *\mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}})\ \{\ reduceVar\ =\ (Tout*)\mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}};\ \ \}\ }
\DoxyCodeLine{00247\ \ \ \ \ Tout\ *getReduceVar()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ reduceVar;\ \ \}}
\DoxyCodeLine{00248\ \ \ \ \ \textcolor{keywordtype}{void}\ \ writeReduceVar(\textcolor{keyword}{const}\ Tout\ \&\mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}})\ \{\ *reduceVar\ =\ \mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}};\ \}\ \ \ \ }
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00250\ \ \ \ \ \textcolor{keywordtype}{void}\ \ setIdentityVal(\textcolor{keyword}{const}\ Tout\ \&\mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}})\ \{\ identityVal\ =\ \mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}};\}\ }
\DoxyCodeLine{00251\ \ \ \ \ Tout\ \ getIdentityVal()\textcolor{keyword}{\ const\ \ \ \ \ \ \ \ }\{\ \textcolor{keywordflow}{return}\ identityVal;\ \}}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ \ \ \ \ \textcolor{keywordtype}{bool}\ \ iterCondition\_aux()\ \{\ }
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ iterCondition(*reduceVar,\ iter);\ \ \ }
\DoxyCodeLine{00255\ \ \ \ \ \}\ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00257\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00258\ \ \ \ \ Tin\ \ \ \ \ *inPtr;}
\DoxyCodeLine{00259\ \ \ \ \ Tout\ \ \ \ *outPtr;}
\DoxyCodeLine{00260\ \ \ \ \ Tout\ \ \ \ *reduceVar,\ identityVal;}
\DoxyCodeLine{00261\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ \ size\_in,\ size\_out,\ iter;}
\DoxyCodeLine{00262\ \ \ \ \ std::tuple<bool,bool,bool>\ tuple\_in;}
\DoxyCodeLine{00263\ \ \ \ \ std::tuple<bool,bool,bool>\ tuple\_out;}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \ \ \ \ std::vector<std::pair<void*,size\_t>\ >\ envPtr;\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ pointer\ and\ byte-\/size}}
\DoxyCodeLine{00266\ \ \ \ \ std::vector<std::tuple<size\_t,bool,bool,bool>\ >\ copyEnv;\ \ \textcolor{comment}{//\ size\ and\ flags}}
\DoxyCodeLine{00267\ \};}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00274\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ TOCL\ =\ T>}
\DoxyCodeLine{00275\ \textcolor{keyword}{class\ }ff\_oclAccelerator\ \{}
\DoxyCodeLine{00276\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00277\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ TOCL::Tin\ \ Tin;}
\DoxyCodeLine{00278\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ TOCL::Tout\ Tout;}
\DoxyCodeLine{00279\ }
\DoxyCodeLine{00280\ \ \ \ \ ff\_oclAccelerator(ff\_oclallocator\ *alloc,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ width\_,\ \textcolor{keyword}{const}\ Tout\ \&identityVal,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ from\_source=\textcolor{keyword}{false})\ :}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ from\_source(from\_source),\ my\_own\_allocator(\mbox{\hyperlink{yyjson_8h_a65e9886d74aaee76545e83dd09011727}{false}}),\ allocator(alloc),\ halo\_half(width\_),\ identityVal(identityVal),\ events\_h2d(16),\ deviceId(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ wgsize\_map\_static\ =\ wgsize\_reduce\_static\ =\ 0;}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ wgsize\_map\_max\ =\ wgsize\_reduce\_max\ =\ 0;}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ inputBuffer\ =\ outputBuffer\ =\ reduceBuffer\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ sizeInput\ =\ sizeInput\_padded\ =\ 0;}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ lenInput\ =\ offset1\_in\ =\ halo\_in\_left\ =\ halo\_in\_right\ =\ lenInput\_global\ =\ 0;}
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ sizeOutput\ =\ sizeOutput\_padded\ =\ 0;}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ lenOutput\ =\ offset1\_out\ =\ halo\_out\_left\ =\ halo\_out\_right\ =\ lenOutput\_global\ =\ 0;}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ nevents\_h2d\ =\ nevents\_map\ =\ 0;}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ event\_d2h\ =\ event\_map\ =\ event\_reduce1\ =\ event\_reduce2\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ wgsize\_map\ =\ nthreads\_map\ =\ 0;}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ wgsize\_reduce\ =\ nthreads\_reduce\ =\ nwg\_reduce\ =\ wg\_red\_mem\ =\ 0;}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ reduceVar\ =\ identityVal;}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ kernel\_map\ =\ kernel\_reduce\ =\ kernel\_init\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ context\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ program\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ cmd\_queue\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ reduce\_mode\ =\ REDUCE\_OUTPUT;}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!allocator)\ \{}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \ \ \ \ my\_own\_allocator\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \ \ \ \ allocator\ =\ \textcolor{keyword}{new}\ ff\_oclallocator;}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \ \ \ \ assert(allocator);}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00309\ \ \ \ \ \}}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ \ \ \ \ \textcolor{keyword}{virtual}\ \string~ff\_oclAccelerator()\ \{}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (my\_own\_allocator)\ \{}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \ \ \ \ allocator-\/>releaseAllBuffers(context);}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ allocator;}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \ \ \ \ allocator\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \ \ \ \ my\_own\_allocator\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00318\ \ \ \ \ \}}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{boing_8c_a2858154e2009b0e6e616f313177762bc}{init}}(cl\_device\_id\ dId,\ reduceMode\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}},\ \textcolor{keyword}{const}\ std::string\ \&kernel\_code,\ \textcolor{keyword}{const}\ std::string\ \&kernel\_name1,}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&kernel\_name2,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ save\_binary,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ reuse\_binary)\ \{}
\DoxyCodeLine{00322\ \textcolor{preprocessor}{\#ifdef\ FF\_OPENCL\_LOG}}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{printf_8h_a9f315126362cae9675de1642105e631e}{fprintf}}(stderr,\ \textcolor{stringliteral}{"{}initializing\ virtual\ accelerator\ @\%p\ mapped\ to\ device:\(\backslash\)n"{}},\ \textcolor{keyword}{this});}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ std::cerr\ <<\ \mbox{\hyperlink{classff_1_1cl_environment_a36e5bae395a1b515fa7f5b5fe8c48390}{ff::clEnvironment::instance}}()-\/>getDeviceInfo(dId)\ <<\ std::endl;}
\DoxyCodeLine{00325\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ reduce\_mode\ =\ \mbox{\hyperlink{_angle_axis__mimic__euler_8cpp_ab3cd915d758008bd19d0f2428fbb354a}{m}};}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \textcolor{comment}{//set\ OCL\ objects}}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ deviceId\ =\ dId;}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ oclParameter\ *\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa18f5f638c58bcb864e367eacbb3380d}{param}}\ =\ clEnvironment::instance()-\/>getParameter(deviceId);}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa18f5f638c58bcb864e367eacbb3380d}{param}});}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ context\ \ \ \ =\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa18f5f638c58bcb864e367eacbb3380d}{param}}-\/>context;}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ cmd\_queue\ \ =\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_aa18f5f638c58bcb864e367eacbb3380d}{param}}-\/>commandQueue;}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \textcolor{comment}{//build\ OCL\ kernels}}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ cl\_int\ status\ =\ buildKernels(kernel\_code,\ kernel\_name1,kernel\_name2,\ from\_source,\ save\_binary,\ reuse\_binary);}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}build\ kernels"{}});}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \textcolor{comment}{//compute\ static\ heuristics\ for\ kernel\ sizing}}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ setSizingHeuristics();}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ status\ ==\ CL\_SUCCESS;}
\DoxyCodeLine{00339\ \ \ \ \ \}}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00341\ \ \ \ \ \textcolor{keywordtype}{void}\ releaseAll()\ \{\ \textcolor{keywordflow}{if}\ (deviceId)\ \{\ svc\_releaseOclObjects();\ deviceId\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};\ \}\}}
\DoxyCodeLine{00342\ \ \ \ \ \textcolor{keywordtype}{void}\ releaseInput(\textcolor{keyword}{const}\ Tin\ *inPtr)\ \ \ \ \ \{\ }
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (allocator-\/>releaseBuffer(inPtr,\ context,\ inputBuffer)\ !=\ CL\_SUCCESS)}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \ \ \ \ checkResult(CL\_INVALID\_MEM\_OBJECT,\ \textcolor{stringliteral}{"{}releaseInput"{}});}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ inputBuffer\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00346\ \ \ \ \ \}}
\DoxyCodeLine{00347\ \ \ \ \ \textcolor{keywordtype}{void}\ releaseOutput(\textcolor{keyword}{const}\ Tout\ *outPtr)\ \ \{}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (allocator-\/>releaseBuffer(outPtr,\ context,\ outputBuffer)\ !=\ CL\_SUCCESS)}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \ \ \ \ checkResult(CL\_INVALID\_MEM\_OBJECT,\ \textcolor{stringliteral}{"{}releaseOutput"{}});}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ outputBuffer\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00351\ \ \ \ \ \}}
\DoxyCodeLine{00352\ \ \ \ \ \textcolor{keywordtype}{void}\ releaseEnv(\textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{void}\ *envPtr)\ \{}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (allocator-\/>releaseBuffer(envPtr,\ context,\ envBuffer[idx].first)\ !=\ CL\_SUCCESS)}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \ \ \ \ checkResult(CL\_INVALID\_MEM\_OBJECT,\ \textcolor{stringliteral}{"{}releaseEnv"{}});}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ envBuffer[idx].first\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ envBuffer[idx].second\ =\ 0;}
\DoxyCodeLine{00356\ \ \ \ \ \}}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00358\ \ \ \ \ \textcolor{keywordtype}{void}\ swapBuffers()\ \{}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ cl\_mem\ \mbox{\hyperlink{namespacegenerate__static__link__cmd__macos_a7c2dcd7f9bee7a5258b5c61341deb157}{tmp}}\ =\ inputBuffer;}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ inputBuffer\ =\ outputBuffer;}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ outputBuffer\ =\ \mbox{\hyperlink{namespacegenerate__static__link__cmd__macos_a7c2dcd7f9bee7a5258b5c61341deb157}{tmp}};}
\DoxyCodeLine{00362\ \ \ \ \ \}}
\DoxyCodeLine{00363\ }
\DoxyCodeLine{00364\ \ \ \ \ \textcolor{keywordtype}{void}\ setSizingHeuristics()\ \{}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ cl\_int\ status;}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \textcolor{comment}{//get\ device-\/dependent\ max\ wg\ size}}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ max\_device\_wgsize;}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ status\ =\ clGetDeviceInfo(deviceId,CL\_DEVICE\_MAX\_WORK\_GROUP\_SIZE,\textcolor{keyword}{sizeof}(max\_device\_wgsize),\&max\_device\_wgsize,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}clGetDeviceInfo\ (map)"{}});}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(kernel\_map)\ \{\ \textcolor{comment}{//map\ kernel}}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//get\ kernel-\/dependent\ max\ wg\ size}}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ max\_kernel\_wgsize;}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \ \ \ \ status\ =\ clGetKernelWorkGroupInfo(kernel\_map,\ deviceId,\ CL\_KERNEL\_WORK\_GROUP\_SIZE,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}),\ \&max\_kernel\_wgsize,\ 0);}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}GetKernelWorkGroupInfo\ (map)"{}});}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \ \ \ \ wgsize\_map\_max\ =\ \mbox{\hyperlink{namespacestd_ac7b9885417769949d76890454b6d072e}{std::min<size\_t>}}(max\_device\_wgsize,max\_kernel\_wgsize);}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//get\ size\ of\ the\ atomic\ scheduling\ unit\ (analogous\ to\ CUDA\ wrap\ size)}}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//typical\ values\ are\ 16\ or\ 32}}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ wg\_multiple;}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \ \ \ \ status\ =\ clGetKernelWorkGroupInfo(kernel\_map,\ deviceId,\ CL\_KERNEL\_PREFERRED\_WORK\_GROUP\_SIZE\_MULTIPLE,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}),\ \&wg\_multiple,\ 0);}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \ \ \ \ wgsize\_map\_static\ =\ std::max<size\_t>(64,\ wg\_multiple\ *\ 4);\ \textcolor{comment}{//64\ or\ 128}}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \ \ \ \ wgsize\_map\_static\ =\ \mbox{\hyperlink{namespacestd_ac7b9885417769949d76890454b6d072e}{std::min<size\_t>}}(wgsize\_map\_static,wgsize\_map\_max);}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(kernel\_reduce)\ \{\ \textcolor{comment}{//reduce\ kernel}}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//get\ kernel-\/dependent\ max\ wg\ size}}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ max\_kernel\_wgsize;}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \ \ \ \ status\ =\ clGetKernelWorkGroupInfo(kernel\_reduce,\ deviceId,\ CL\_KERNEL\_WORK\_GROUP\_SIZE,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}),\ \&max\_kernel\_wgsize,\ 0);}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}GetKernelWorkGroupInfo\ (reduce)"{}});}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \ \ \ \ wgsize\_reduce\_max\ =\ \mbox{\hyperlink{namespacestd_ac7b9885417769949d76890454b6d072e}{std::min<size\_t>}}(max\_device\_wgsize,max\_kernel\_wgsize);}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//get\ size\ of\ the\ atomic\ scheduling\ unit\ (analogous\ to\ CUDA\ wrap\ size)}}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//typical\ values\ are\ 16\ or\ 32}}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ wg\_multiple;}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ \ \ \ \ status\ =\ clGetKernelWorkGroupInfo(kernel\_reduce,\ deviceId,\ CL\_KERNEL\_PREFERRED\_WORK\_GROUP\_SIZE\_MULTIPLE,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t}),\ \&wg\_multiple,\ 0);}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \ \ \ \ wgsize\_reduce\_static\ =\ std::max<size\_t>(64,\ wg\_multiple\ *\ 4);\ \textcolor{comment}{//64\ or\ 128}}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ \ \ \ \ wgsize\_reduce\_static\ =\ \mbox{\hyperlink{namespacestd_ac7b9885417769949d76890454b6d072e}{std::min<size\_t>}}(wgsize\_reduce\_static,wgsize\_reduce\_max);}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00396\ \textcolor{preprocessor}{\#ifdef\ FF\_OPENCL\_LOG}}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ std::cerr\ <<\ \ \textcolor{stringliteral}{"{}[virtual\ accelerator\ @"{}}<<\textcolor{keyword}{this}<<\textcolor{stringliteral}{"{}]\(\backslash\)n"{}};}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ std::cerr\ <<\ \ \textcolor{stringliteral}{"{}+\ static\ heuristics\ for\ kernel\ sizing\ parameters:\(\backslash\)n"{}};}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ std::cerr\ <<\ \ \textcolor{stringliteral}{"{}-\/\ MAP\ workgroup-\/size\ =\ "{}}\ <<wgsize\_map\_static<<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ std::cerr\ <<\ \ \textcolor{stringliteral}{"{}-\/\ MAP\ max\ workgroup-\/size\ =\ "{}}\ <<wgsize\_map\_max<<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ std::cerr\ <<\ \ \textcolor{stringliteral}{"{}-\/\ RED\ workgroup-\/size\ =\ "{}}\ <<wgsize\_reduce\_static<<\ \textcolor{stringliteral}{"{}\ \(\backslash\)n"{}};}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ std::cerr\ <<\ \ \textcolor{stringliteral}{"{}-\/\ RED\ max\ workgroup-\/size\ =\ "{}}\ <<wgsize\_reduce\_max<<\ \textcolor{stringliteral}{"{}\ \(\backslash\)n"{}};}
\DoxyCodeLine{00403\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00404\ \ \ \ \ \}}
\DoxyCodeLine{00405\ }
\DoxyCodeLine{00406\ \ \ \ \ \textcolor{comment}{//see\ comments\ for\ members}}
\DoxyCodeLine{00407\ \ \ \ \ \textcolor{keywordtype}{void}\ adjustInputBufferOffset(\textcolor{keyword}{const}\ Tin\ *newPtr,\ \textcolor{keyword}{const}\ Tin\ *oldPtr,\ std::pair<size\_t,\ size\_t>\ \&P,\ \textcolor{keywordtype}{size\_t}\ len\_global)\ \{}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ offset1\_in\ =\ \mbox{\hyperlink{_direction_wise__hnormalized_8cpp_a98fb883180cbb2e5412955dfd6edb605}{P}}.first;}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ lenInput\ \ \ =\ \mbox{\hyperlink{_direction_wise__hnormalized_8cpp_a98fb883180cbb2e5412955dfd6edb605}{P}}.second;}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ lenInput\_global\ =\ len\_global;}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ halo\_in\_left\ =\ (\mbox{\hyperlink{namespacestd_ac7b9885417769949d76890454b6d072e}{std::min}})(halo\_half,\ offset1\_in);}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ halo\_in\_right\ =\ (\mbox{\hyperlink{namespacestd_ac7b9885417769949d76890454b6d072e}{std::min}})(halo\_half,\ lenInput\_global\ -\/\ lenInput\ -\/\ offset1\_in);}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ sizeInput\ =\ lenInput\ *\ \textcolor{keyword}{sizeof}(Tin);}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ sizeInput\_padded\ =\ sizeInput\ +\ (halo\_in\_left\ +\ halo\_in\_right)\ *\ \textcolor{keyword}{sizeof}(Tin);}
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (oldPtr\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ allocator-\/>updateKey(oldPtr,\ newPtr,\ context);}
\DoxyCodeLine{00417\ \ \ \ \ \}}
\DoxyCodeLine{00418\ }
\DoxyCodeLine{00419\ \ \ \ \ \textcolor{keywordtype}{void}\ relocateInputBuffer(\textcolor{keyword}{const}\ Tin\ *inPtr,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ reuseIn,\ \textcolor{keyword}{const}\ Tout\ *reducePtr)\ \{}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ cl\_int\ status;}
\DoxyCodeLine{00421\ }
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (reuseIn)\ \{}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \ \ \ \ inputBuffer\ =\ allocator-\/>createBufferUnique(inPtr,\ context,}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CL\_MEM\_READ\_WRITE,\ sizeInput\_padded,\ \&status);}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}CreateBuffer(Unique)\ input"{}});}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (inputBuffer)\ \ allocator-\/>releaseBuffer(inPtr,\ context,\ inputBuffer);}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//allocate\ input-\/size\ +\ pre/post-\/windows}}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \ \ \ \ inputBuffer\ =\ allocator-\/>createBuffer(inPtr,\ context,}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CL\_MEM\_READ\_WRITE,\ sizeInput\_padded,\ \&status);}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}CreateBuffer\ input"{}});}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00433\ }
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \textcolor{comment}{//set\ workgroup\ size\ and\ nthreads\ for\ map}}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ MA\ patch\ -\/\ map\ not\ defined\ =>\ workgroup\_size\_map}}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \textcolor{comment}{//size\_t\ wgsize\ =\ wgsize\_map\_static==0?wgsize\_reduce\_static:wgsize\_map\_static;}}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(kernel\_map)\ \{}
\DoxyCodeLine{00438\ }
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ the\ output\ buffer\ is\ bigger\ than\ input\ buffer\ then\ we\ use\ the\ size\ of\ the}}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ output\ buffer\ to\ compute\ the\ number\ of\ threads}}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (lenInput\ <\ lenOutput)\ \{}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ wgsize\_map\ =\ \mbox{\hyperlink{namespacestd_ac7b9885417769949d76890454b6d072e}{std::min<size\_t>}}(lenOutput,\ wgsize\_map\_static);}
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nthreads\_map\ =\ wgsize\_map\ *\ ((lenOutput\ +\ wgsize\_map\ -\/\ 1)\ /\ wgsize\_map);\ \textcolor{comment}{//round\ up}}
\DoxyCodeLine{00444\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ wgsize\_map\ =\ \mbox{\hyperlink{namespacestd_ac7b9885417769949d76890454b6d072e}{std::min<size\_t>}}(lenInput,\ wgsize\_map\_static);}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nthreads\_map\ =\ wgsize\_map\ *\ ((lenInput\ +\ wgsize\_map\ -\/\ 1)\ /\ wgsize\_map);\ \textcolor{comment}{//round\ up}}
\DoxyCodeLine{00448\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00449\ \textcolor{preprocessor}{\#ifdef\ FF\_OPENCL\_LOG}}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \ \ \ \ std::cerr\ <<\ \ \textcolor{stringliteral}{"{}[virtual\ accelerator\ @"{}}<<\textcolor{keyword}{this}<<\textcolor{stringliteral}{"{}]\(\backslash\)n"{}};}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \ \ \ \ std::cerr\ <<\ \textcolor{stringliteral}{"{}+\ computed\ MAP\ kernel\ sizing\ parameters:\(\backslash\)n"{}};}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \ \ \ \ std::cerr\ <<\ \textcolor{stringliteral}{"{}-\/\ MAP\ workgroup-\/size\ =\ "{}}\ <<\ wgsize\_map\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \ \ \ \ \ \ std::cerr\ <<\ \textcolor{stringliteral}{"{}-\/\ MAP\ n.\ threads\ \ \ \ \ =\ "{}}\ <<\ nthreads\_map\ <<\ \textcolor{stringliteral}{"{}\ \(\backslash\)n"{}};}
\DoxyCodeLine{00454\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ \textcolor{comment}{//set\ workgroup\ size\ and\ nthreads\ for\ reduce}}
\DoxyCodeLine{00457\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (kernel\_reduce\ \&\&\ reduce\_mode\ ==\ REDUCE\_INPUT)\ \{}
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ \ \ \ \ resetReduce(lenInput,\ \textcolor{keyword}{sizeof}(Tin),\ (\textcolor{keywordtype}{void}\ *)reducePtr);}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00460\ \ \ \ \ \}}
\DoxyCodeLine{00461\ }
\DoxyCodeLine{00462\ \ \ \ \ \textcolor{keywordtype}{void}\ adjustOutputBufferOffset(\textcolor{keyword}{const}\ Tout\ *newPtr,\ \textcolor{keyword}{const}\ Tout\ *oldPtr,\ std::pair<size\_t,\ size\_t>\ \&P,\ \textcolor{keywordtype}{size\_t}\ len\_global)\ \{}
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ offset1\_out\ =\ \mbox{\hyperlink{_direction_wise__hnormalized_8cpp_a98fb883180cbb2e5412955dfd6edb605}{P}}.first;}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ lenOutput\ \ \ =\ \mbox{\hyperlink{_direction_wise__hnormalized_8cpp_a98fb883180cbb2e5412955dfd6edb605}{P}}.second;}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ lenOutput\_global\ =\ len\_global;}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ halo\_out\_left\ =\ (\mbox{\hyperlink{namespacestd_ac7b9885417769949d76890454b6d072e}{std::min}})(halo\_half,\ offset1\_out);}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ halo\_out\_right\ =\ (\mbox{\hyperlink{namespacestd_ac7b9885417769949d76890454b6d072e}{std::min}})(halo\_half,\ lenOutput\_global\ -\/\ lenOutput\ -\/\ offset1\_out);}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ sizeOutput\ =\ lenOutput\ *\ \textcolor{keyword}{sizeof}(Tout);}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ sizeOutput\_padded\ =\ sizeOutput\ +\ (halo\_out\_left\ +\ halo\_out\_right)\ *\ \textcolor{keyword}{sizeof}(Tout);}
\DoxyCodeLine{00470\ }
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (oldPtr\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ allocator-\/>updateKey(oldPtr,\ newPtr,\ context);}
\DoxyCodeLine{00472\ \ \ \ \ \}}
\DoxyCodeLine{00473\ }
\DoxyCodeLine{00474\ \ \ \ \ \textcolor{keywordtype}{void}\ relocateOutputBuffer(\textcolor{keyword}{const}\ Tout\ \ *outPtr,\ \textcolor{keyword}{const}\ Tout\ *reducePtr)\ \{}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ cl\_int\ status;}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (outputBuffer)\ allocator-\/>releaseBuffer(outPtr,\ context,\ outputBuffer);}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ outputBuffer\ =\ allocator-\/>createBuffer(outPtr,\ context,}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CL\_MEM\_READ\_WRITE,\ sizeOutput\_padded,\&status);}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}CreateBuffer\ output"{}});}
\DoxyCodeLine{00480\ }
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \textcolor{comment}{//set\ workgroup\ size\ and\ nthreads\ for\ reduce}}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (kernel\_reduce\ \&\&\ reduce\_mode\ ==\ REDUCE\_OUTPUT)\ \{}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \ \ \ \ resetReduce(lenOutput,\ \textcolor{keyword}{sizeof}(Tout),\ (\textcolor{keywordtype}{void}\ *)reducePtr);}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00485\ \ \ \ \ \}}
\DoxyCodeLine{00486\ }
\DoxyCodeLine{00487\ \ \ \ \ \textcolor{keywordtype}{void}\ relocateEnvBuffer(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}\ *envptr,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ reuseEnv,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ envbytesize)\ \{}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \ \ cl\_int\ status\ =\ CL\_SUCCESS;}
\DoxyCodeLine{00489\ }
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (idx\ >=\ envBuffer.size())\ \{}
\DoxyCodeLine{00491\ \ \ \ \ \ \ \ \ \ \ \ \ cl\_mem\ envb;}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (reuseEnv)\ }
\DoxyCodeLine{00493\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ envb\ =\ allocator-\/>createBufferUnique(envptr,\ context,}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CL\_MEM\_READ\_WRITE,\ envbytesize,\ \&status);}
\DoxyCodeLine{00495\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ }
\DoxyCodeLine{00496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ envb\ =\ allocator-\/>createBuffer(envptr,\ context,}
\DoxyCodeLine{00497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CL\_MEM\_READ\_WRITE,\ envbytesize,\ \&status);}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (checkResult(status,\ \textcolor{stringliteral}{"{}CreateBuffer\ envBuffer"{}}))}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ envBuffer.push\_back(std::make\_pair(envb,envbytesize));}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ }
\DoxyCodeLine{00501\ }
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (reuseEnv)\ \{}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ envBuffer[idx].first\ =\ allocator-\/>createBufferUnique(envptr,\ context,}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CL\_MEM\_READ\_WRITE,\ envbytesize,\ \&status);}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (checkResult(status,\ \textcolor{stringliteral}{"{}CreateBuffer\ envBuffer"{}}))}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ envBuffer[idx].second\ =\ envbytesize;}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (envBuffer[idx].\mbox{\hyperlink{second___n_o_n_e_8f_ae9f971a8b343bd2fcb85c3b16da97f10}{second}}\ <\ envbytesize)\ \{}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (envBuffer[idx].first)\ allocator-\/>releaseBuffer(envptr,\ context,\ envBuffer[idx].first);}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ envBuffer[idx].first\ =\ allocator-\/>createBuffer(envptr,\ context,}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CL\_MEM\_READ\_WRITE,\ envbytesize,\ \&status);}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (checkResult(status,\ \textcolor{stringliteral}{"{}CreateBuffer\ envBuffer"{}}))}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ envBuffer[idx].second\ =\ envbytesize;}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00517\ \ \ \ \ \}}
\DoxyCodeLine{00518\ \ \ \ \ }
\DoxyCodeLine{00519\ \ \ \ \ \textcolor{keywordtype}{void}\ setInPlace(Tout\ *reducePtr)\ \{}
\DoxyCodeLine{00520\ \ \ \ \ \ \ \ \ outputBuffer\ \ \ \ \ \ =\ inputBuffer;\ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ lenOutput\ \ \ \ \ \ \ \ \ =\ lenInput;}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ lenOutput\_global\ \ =\ lenInput\_global;}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \ \ halo\_out\_left\ \ \ \ \ \ \ \ \ \ =\ halo\_in\_left;}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ halo\_out\_right\ \ \ \ \ \ \ \ \ \ =\ halo\_in\_right;}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \ \ offset1\_out\ \ \ \ \ \ \ =\ offset1\_in;}
\DoxyCodeLine{00526\ \ \ \ \ \ \ \ \ sizeOutput\ \ \ \ \ \ \ \ =\ sizeInput;}
\DoxyCodeLine{00527\ \ \ \ \ \ \ \ \ sizeOutput\_padded\ =\ sizeInput\_padded;}
\DoxyCodeLine{00528\ }
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ \textcolor{comment}{//set\ workgroup\ size\ and\ nthreads\ for\ reduce}}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (kernel\_reduce\ \&\&\ reduce\_mode\ ==\ REDUCE\_OUTPUT)\ \{}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ \ \ \ \ resetReduce(lenOutput,\ \textcolor{keyword}{sizeof}(Tout),\ reducePtr);}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00533\ \ \ \ \ \}}
\DoxyCodeLine{00534\ }
\DoxyCodeLine{00535\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{level1__impl_8h_a2e2212d2e55ad7479d212e08b2eb0345}{swap}}()\ \{}
\DoxyCodeLine{00536\ \ \ \ \ \ \ \ \ cl\_mem\ \mbox{\hyperlink{namespacegenerate__static__link__cmd__macos_a7c2dcd7f9bee7a5258b5c61341deb157}{tmp}}\ =\ inputBuffer;}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ inputBuffer\ =\ outputBuffer;}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ outputBuffer\ =\ \mbox{\hyperlink{namespacegenerate__static__link__cmd__macos_a7c2dcd7f9bee7a5258b5c61341deb157}{tmp}};}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ \textcolor{comment}{//set\ iteration-\/dynamic\ MAP\ kernel\ args}}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ cl\_int\ status\ =\ clSetKernelArg(kernel\_map,\ 0,\ \textcolor{keyword}{sizeof}(cl\_mem),\ \&inputBuffer);}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}setKernelArg\ input"{}});}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ status\ =\ clSetKernelArg(kernel\_map,\ 1,\ \textcolor{keyword}{sizeof}(cl\_mem),\ \&outputBuffer);}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}setKernelArg\ output"{}});}
\DoxyCodeLine{00544\ \ \ \ \ \}}
\DoxyCodeLine{00545\ }
\DoxyCodeLine{00546\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ setMapKernelArgs(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ envSize)\ \{}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ cl\_uint\ idx\ =\ 0;}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ \textcolor{comment}{//set\ iteration-\/dynamic\ MAP\ kernel\ args\ (init)}}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \ \ cl\_int\ status\ =\ clSetKernelArg(kernel\_map,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_mem),\ \&inputBuffer);}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}setKernelArg\ input"{}});}
\DoxyCodeLine{00551\ \ \ \ \ \ \ \ \ status\ =\ clSetKernelArg(kernel\_map,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_mem),\ \&outputBuffer);}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}setKernelArg\ output"{}});}
\DoxyCodeLine{00553\ }
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ \textcolor{comment}{//set\ iteration-\/invariant\ MAP\ kernel\ args}}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ status\ =\ clSetKernelArg(kernel\_map,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_uint),\ (\textcolor{keywordtype}{void}\ *)\ \&lenInput\_global);}
\DoxyCodeLine{00556\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}setKernelArg\ global\ input\ length"{}});}
\DoxyCodeLine{00557\ }
\DoxyCodeLine{00558\ \ \ \ \ \ \ \ \ status\ =\ clSetKernelArg(kernel\_map,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_uint),\ (\textcolor{keywordtype}{void}\ *)\ \&lenOutput);}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}setKernelArg\ local\ input\ length"{}});}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \ \ status\ =\ clSetKernelArg(kernel\_map,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_uint),\ (\textcolor{keywordtype}{void}\ *)\ \&offset1\_in);}
\DoxyCodeLine{00561\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}setKernelArg\ offset"{}});}
\DoxyCodeLine{00562\ \ \ \ \ \ \ \ \ status\ =\ clSetKernelArg(kernel\_map,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_uint),\ (\textcolor{keywordtype}{void}\ *)\ \&halo\_out\_left);\ \textcolor{comment}{//\ CHECK\ !!!}}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}setKernelArg\ pad"{}});}
\DoxyCodeLine{00564\ }
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ k=0;\ k\ <\ envSize;\ ++k)\ \{}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \ \ \ \ \ \ status\ =\ clSetKernelArg(kernel\_map,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_mem),\ \&envBuffer[k].first);}
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}setKernelArg\ env"{}});}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00569\ \ \ \ \ \}}
\DoxyCodeLine{00570\ }
\DoxyCodeLine{00571\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ asyncH2Dinput(Tin\ *\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \{}
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (nevents\_h2d\ >=\ events\_h2d.size())\ events\_h2d.reserve(nevents\_h2d);}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ +=\ offset1\_in\ -\/\ halo\_in\_left;}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ cl\_int\ status\ =\ clEnqueueWriteBuffer(cmd\_queue,\ inputBuffer,\ CL\_FALSE,\ 0,}
\DoxyCodeLine{00575\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sizeInput\_padded,\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \&events\_h2d[nevents\_h2d++]);}
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}copying\ Task\ to\ device\ input-\/buffer"{}});}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ sizeInput\_padded;}
\DoxyCodeLine{00578\ \ \ \ \ \}}
\DoxyCodeLine{00579\ }
\DoxyCodeLine{00580\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ asyncH2Denv(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{char}\ *\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \{}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (nevents\_h2d\ >=\ events\_h2d.size())\ events\_h2d.reserve(nevents\_h2d);}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ cl\_int\ status\ =\ clEnqueueWriteBuffer(cmd\_queue,\ envBuffer[idx].first,\ CL\_FALSE,\ 0,}
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ envBuffer[idx].\mbox{\hyperlink{second___n_o_n_e_8f_ae9f971a8b343bd2fcb85c3b16da97f10}{second}},\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \&events\_h2d[nevents\_h2d++]);\ \ \ \ }
\DoxyCodeLine{00584\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}copying\ Task\ to\ device\ env-\/buffer"{}});}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ envBuffer[idx].second;}
\DoxyCodeLine{00586\ \ \ \ \ \}}
\DoxyCodeLine{00587\ }
\DoxyCodeLine{00588\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \ asyncH2Dborders(Tout\ *\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \{}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (halo\_out\_left)\ \{}
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ \ \ \ \ cl\_int\ status\ =\ clEnqueueWriteBuffer(cmd\_queue,\ outputBuffer,\ CL\_FALSE,\ 0,}
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ halo\_out\_left\ *\ \textcolor{keyword}{sizeof}(Tout),\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ +\ offset1\_out\ -\/\ halo\_out\_left,\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&events\_h2d[nevents\_h2d++]);}
\DoxyCodeLine{00593\ \ \ \ \ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}copying\ left\ border\ to\ device"{}});}
\DoxyCodeLine{00594\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ halo\_out\_left\ *\ \textcolor{keyword}{sizeof}(Tout);}
\DoxyCodeLine{00595\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00596\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (halo\_out\_right)\ \{}
\DoxyCodeLine{00597\ \ \ \ \ \ \ \ \ \ \ \ \ cl\_int\ status\ =\ clEnqueueWriteBuffer(cmd\_queue,\ outputBuffer,\ CL\_FALSE,}
\DoxyCodeLine{00598\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (halo\_out\_left\ +\ lenOutput)\ *\ \textcolor{keyword}{sizeof}(Tout),\ halo\_out\_right\ *\ \textcolor{keyword}{sizeof}(Tout),\ \ \textcolor{comment}{//\ NOTE:\ in\ a\ loop\ Tin\ ==\ Tout\ !!}}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ +\ offset1\_out\ +\ lenOutput,\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \&events\_h2d[nevents\_h2d++]);}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}copying\ right\ border\ to\ device"{}});}
\DoxyCodeLine{00601\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00602\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ halo\_out\_left\ *\ \textcolor{keyword}{sizeof}(Tout);}
\DoxyCodeLine{00603\ \ \ \ \ \}}
\DoxyCodeLine{00604\ }
\DoxyCodeLine{00605\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ asyncD2Houtput(Tout\ *\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \{}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \ \ cl\_int\ status\ =\ clEnqueueReadBuffer(cmd\_queue,\ outputBuffer,\ CL\_FALSE,}
\DoxyCodeLine{00607\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ halo\_out\_left\ *\ \textcolor{keyword}{sizeof}(Tout),\ sizeOutput,\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ +\ offset1\_out,\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \&event\_d2h);}
\DoxyCodeLine{00608\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}copying\ output\ back\ from\ device"{}});}
\DoxyCodeLine{00609\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ sizeOutput;}
\DoxyCodeLine{00610\ \ \ \ \ \}}
\DoxyCodeLine{00611\ }
\DoxyCodeLine{00612\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ asyncD2Hborders(Tout\ *\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \{}
\DoxyCodeLine{00613\ \ \ \ \ \ \ \ \ cl\_int\ status\ =\ clEnqueueReadBuffer(cmd\_queue,\ outputBuffer,\ CL\_FALSE,}
\DoxyCodeLine{00614\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ halo\_out\_left\ *\ \textcolor{keyword}{sizeof}(Tout),\ halo\_half\ *\ \textcolor{keyword}{sizeof}(Tout),\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ +\ offset1\_out,\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},}
\DoxyCodeLine{00615\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&events\_h2d[0]);}
\DoxyCodeLine{00616\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}copying\ border1\ back\ from\ device"{}});}
\DoxyCodeLine{00617\ \ \ \ \ \ \ \ \ ++nevents\_h2d;}
\DoxyCodeLine{00618\ \ \ \ \ \ \ \ \ status\ =\ clEnqueueReadBuffer(cmd\_queue,\ outputBuffer,\ CL\_FALSE,}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (halo\_out\_left\ +\ lenOutput\ -\/\ halo\_half)\ *\ \textcolor{keyword}{sizeof}(Tout),\ halo\_half\ *\ \textcolor{keyword}{sizeof}(Tout),}
\DoxyCodeLine{00620\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ +\ offset1\_out\ +\ lenOutput\ -\/\ halo\_half,\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \&event\_d2h);}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}copying\ border2\ back\ from\ device"{}});}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ halo\_half\ *\ \textcolor{keyword}{sizeof}(Tout);}
\DoxyCodeLine{00623\ \ \ \ \ \}}
\DoxyCodeLine{00624\ }
\DoxyCodeLine{00625\ }
\DoxyCodeLine{00626\ }
\DoxyCodeLine{00627\ \ \ \ \ \textcolor{comment}{//void\ initReduce(const\ Tout\ \&initReduceVal,\ reduceMode\ m\ =\ REDUCE\_OUTPUT)\ \{}}
\DoxyCodeLine{00628\ \ \ \ \ \textcolor{keywordtype}{void}\ initReduce()\ \{}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \ \ \textcolor{comment}{//set\ kernel\ args\ for\ reduce1}}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idx\ =\ 0;}
\DoxyCodeLine{00631\ \ \ \ \ \ \ \ \ cl\_mem\ \mbox{\hyperlink{namespacegenerate__static__link__cmd__macos_a7c2dcd7f9bee7a5258b5c61341deb157}{tmp}}\ =\ (reduce\_mode\ ==\ REDUCE\_OUTPUT)\ ?\ outputBuffer\ :\ inputBuffer;}
\DoxyCodeLine{00632\ \ \ \ \ \ \ \ \ cl\_uint\ \mbox{\hyperlink{yyjson_8h_ac16e956eac9f5c3180afa8e80d4f098c}{len}}\ =\ (reduce\_mode\ ==\ REDUCE\_OUTPUT)\ ?\ lenOutput\ :\ lenInput;}
\DoxyCodeLine{00633\ \ \ \ \ \ \ \ \ cl\_int\ status\ \ =\ clSetKernelArg(kernel\_reduce,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_mem),\ \&tmp);}
\DoxyCodeLine{00634\ \ \ \ \ \ \ \ \ status\ \ \ \ \ \ \ \ |=\ clSetKernelArg(kernel\_reduce,\ idx++,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{sugar_8h_ad46b2ebcd4c426b06cda147ddc1001e7}{uint}}),\ \&halo\_in\_left);}
\DoxyCodeLine{00635\ \ \ \ \ \ \ \ \ status\ \ \ \ \ \ \ \ |=\ clSetKernelArg(kernel\_reduce,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_mem),\ \&reduceBuffer);}
\DoxyCodeLine{00636\ \ \ \ \ \ \ \ \ status\ \ \ \ \ \ \ \ |=\ clSetKernelArg(kernel\_reduce,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_uint),\ \ (\textcolor{keywordtype}{void}\ *)\ \&\mbox{\hyperlink{yyjson_8h_ac16e956eac9f5c3180afa8e80d4f098c}{len}});}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \ \ status\ \ \ \ \ \ \ \ |=\ clSetKernelArg(kernel\_reduce,\ idx++,\ wg\_red\_mem,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00638\ \ \ \ \ \ \ \ \ status\ \ \ \ \ \ \ \ |=\ clSetKernelArg(kernel\_reduce,\ idx++,\ \textcolor{keyword}{sizeof}(Tout),\ (\textcolor{keywordtype}{void}\ *)\ \&identityVal);}
\DoxyCodeLine{00639\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}setKernelArg\ reduce-\/1"{}});}
\DoxyCodeLine{00640\ \ \ \ \ \}}
\DoxyCodeLine{00641\ }
\DoxyCodeLine{00642\ \ \ \ \ \textcolor{keywordtype}{void}\ asyncExecMapKernel()\ \{}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \ \ \textcolor{comment}{//execute\ MAP\ kernel}}
\DoxyCodeLine{00644\ \ \ \ \ \ \ \ \ cl\_int\ status\ =\ clEnqueueNDRangeKernel(cmd\_queue,\ kernel\_map,\ 1,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},}
\DoxyCodeLine{00645\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&nthreads\_map,\ \&wgsize\_map,\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \&event\_map);}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}executing\ map\ kernel"{}});}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \ \ \textcolor{comment}{//std::cerr\ <<\ "{}Exec\ map\ WI\ "{}\ <<\ globalThreadsMap\ <<\ "{}\ localThreadsMap\ "{}\ <<\ localThreadsMap\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \ \ ++nevents\_map;}
\DoxyCodeLine{00649\ \ \ \ \ \}}
\DoxyCodeLine{00650\ }
\DoxyCodeLine{00651\ \ \ \ \ \textcolor{keywordtype}{void}\ asyncExecReduceKernel1()\ \{}
\DoxyCodeLine{00652\ \ \ \ \ \ \ \ \ \textcolor{comment}{//std::cerr\ <<\ "{}Exec\ reduce1 \ WI\ "{}\ <<\ globalThreadsReduce\ <<\ "{}\ localThreadsReduce\ "{}\ <<\ localThreadsReduce\ <<\ \ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{00653\ \ \ \ \ \ \ \ \ cl\_int\ status\ =\ clEnqueueNDRangeKernel(cmd\_queue,\ kernel\_reduce,\ 1,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},}
\DoxyCodeLine{00654\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&nthreads\_reduce,\ \&wgsize\_reduce,\ nevents\_map,}
\DoxyCodeLine{00655\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (nevents\_map==0)?\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}:\&event\_map,}
\DoxyCodeLine{00656\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&event\_reduce1);}
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}exec\ kernel\ reduce-\/1"{}});}
\DoxyCodeLine{00658\ \ \ \ \ \ \ \ \ nevents\_map\ =\ 0;}
\DoxyCodeLine{00659\ \ \ \ \ \}}
\DoxyCodeLine{00660\ }
\DoxyCodeLine{00661\ \ \ \ \ \textcolor{keywordtype}{void}\ asyncExecReduceKernel2()\ \{}
\DoxyCodeLine{00662\ \ \ \ \ \ \ \ \ cl\_uint\ zeropad\ =\ 0;}
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idx\ =\ 0;}
\DoxyCodeLine{00664\ \ \ \ \ \ \ \ \ cl\_int\ status\ \ =\ clSetKernelArg(kernel\_reduce,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_mem),\ \&reduceBuffer);}
\DoxyCodeLine{00665\ \ \ \ \ \ \ \ \ status\ \ \ \ \ \ \ \ |=\ clSetKernelArg(kernel\_reduce,\ idx++,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{sugar_8h_ad46b2ebcd4c426b06cda147ddc1001e7}{uint}}),\ \&zeropad);}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ status\ \ \ \ \ \ \ \ |=\ clSetKernelArg(kernel\_reduce,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_mem),\ \&reduceBuffer);}
\DoxyCodeLine{00667\ \ \ \ \ \ \ \ \ status\ \ \ \ \ \ \ \ |=\ clSetKernelArg(kernel\_reduce,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_uint),(\textcolor{keywordtype}{void}*)\ \&nwg\_reduce);}
\DoxyCodeLine{00668\ \ \ \ \ \ \ \ \ status\ \ \ \ \ \ \ \ |=\ clSetKernelArg(kernel\_reduce,\ idx++,\ wg\_red\_mem,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ \ status\ \ \ \ \ \ \ \ |=\ clSetKernelArg(kernel\_reduce,\ idx++,\ \textcolor{keyword}{sizeof}(Tout),\ (\textcolor{keywordtype}{void}\ *)\ \&identityVal);}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}setKernelArg\ reduce-\/2"{}});}
\DoxyCodeLine{00671\ \ \ \ \ \ \ \ \ \textcolor{comment}{//std::cerr\ <<\ "{}Exec\ reduce2\ WI\ "{}\ <<\ globalThreadsReduce\ <<\ "{}\ localThreadsReduce\ "{}\ <<\ localThreadsReduce\ <<\ \ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{00672\ \ \ \ \ \ \ \ \ status\ =\ clEnqueueNDRangeKernel(cmd\_queue,\ kernel\_reduce,\ 1,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},}
\DoxyCodeLine{00673\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&wgsize\_reduce,\ \&wgsize\_reduce,\ 1,\ \&event\_reduce1,}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&event\_reduce2);}
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}exec\ kernel\ reduce-\/2"{}});}
\DoxyCodeLine{00676\ \ \ \ \ \}}
\DoxyCodeLine{00677\ }
\DoxyCodeLine{00678\ \ \ \ \ Tout\ getReduceVar()\ \{}
\DoxyCodeLine{00679\ \ \ \ \ \ \ \ \ cl\_int\ status\ =\ clEnqueueReadBuffer(cmd\_queue,\ reduceBuffer,\ CL\_TRUE,\ 0,}
\DoxyCodeLine{00680\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(Tout),\ \&reduceVar,\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}d2h\ reduceVar"{}});}
\DoxyCodeLine{00682\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ reduceVar;}
\DoxyCodeLine{00683\ \ \ \ \ \}}
\DoxyCodeLine{00684\ }
\DoxyCodeLine{00685\ \ \ \ \ \textcolor{keywordtype}{void}\ waitforh2d()\ \{}
\DoxyCodeLine{00686\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (nevents\_h2d>0)\ \{}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \ \ \ \ \ \ cl\_int\ status\ =\ clWaitForEvents(nevents\_h2d,\ events\_h2d.data());}
\DoxyCodeLine{00688\ \ \ \ \ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}h2d\ wait\ for"{}});}
\DoxyCodeLine{00689\ \ \ \ \ \ \ \ \ \ \ \ \ nevents\_h2d\ =\ 0;}
\DoxyCodeLine{00690\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00691\ \ \ \ \ \}}
\DoxyCodeLine{00692\ }
\DoxyCodeLine{00693\ \ \ \ \ \textcolor{keywordtype}{void}\ waitford2h()\ \{}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \ \ cl\_int\ status\ =\ clWaitForEvents(1,\ \&event\_d2h);}
\DoxyCodeLine{00695\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}d2h\ wait\ for"{}});}
\DoxyCodeLine{00696\ \ \ \ \ \}}
\DoxyCodeLine{00697\ }
\DoxyCodeLine{00698\ \ \ \ \ \textcolor{keywordtype}{void}\ waitforreduce()\ \{}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ cl\_int\ status\ =\ clWaitForEvents(1,\ \&event\_reduce2);}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}wait\ for\ reduce"{}});}
\DoxyCodeLine{00701\ \ \ \ \ \}}
\DoxyCodeLine{00702\ }
\DoxyCodeLine{00703\ \ \ \ \ \textcolor{keywordtype}{void}\ waitformap()\ \{}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ cl\_int\ status\ =\ clWaitForEvents(nevents\_map,\ \&event\_map);}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \ \ nevents\_map\ =\ 0;}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}wait\ for\ map"{}});}
\DoxyCodeLine{00707\ \ \ \ \ \}}
\DoxyCodeLine{00708\ }
\DoxyCodeLine{00712\ \ \ \ \ \textcolor{keywordtype}{void}\ setHaloHalf(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{ittnotify__static_8h_ae68700d2ebda197674e2fdd0f916f00c}{h}})\ \{}
\DoxyCodeLine{00713\ \ \ \ \ \ \ \ \ halo\_half\ =\ \mbox{\hyperlink{ittnotify__static_8h_ae68700d2ebda197674e2fdd0f916f00c}{h}};}
\DoxyCodeLine{00714\ \ \ \ \ \}}
\DoxyCodeLine{00715\ }
\DoxyCodeLine{00716\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00717\ \ \ \ \ \textcolor{keywordtype}{int}\ buildProgram(cl\_device\_id\ dId)\ \{}
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ cl\_int\ status\ =\ clBuildProgram(program,\ 1,\ \&dId,\ \textcolor{comment}{/*"{}-\/cl-\/fast-\/relaxed-\/math"{}*/}\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}building\ program"{}});}
\DoxyCodeLine{00720\ }
\DoxyCodeLine{00721\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ DEBUGGING\ CODE\ for\ checking\ OCL\ compilation\ errors}}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (status\ !=\ CL\_SUCCESS)\ \{}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{printf_8h_aee3ed3a831f25f07e7be3919fff2203a}{printf}}(\textcolor{stringliteral}{"{}\(\backslash\)nFail\ to\ build\ the\ program\(\backslash\)n"{}});}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{yyjson_8h_ac16e956eac9f5c3180afa8e80d4f098c}{len}};}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \ \ \ \ \ \ clGetProgramBuildInfo(program,\ dId,\ CL\_PROGRAM\_BUILD\_LOG,\ 0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \&\mbox{\hyperlink{yyjson_8h_ac16e956eac9f5c3180afa8e80d4f098c}{len}});}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{printf_8h_aee3ed3a831f25f07e7be3919fff2203a}{printf}}(\textcolor{stringliteral}{"{}LOG\ len\ \%ld\(\backslash\)n"{}},\ \mbox{\hyperlink{yyjson_8h_ac16e956eac9f5c3180afa8e80d4f098c}{len}});}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ *\mbox{\hyperlink{sugar_8h_aaadc06b5dac8070de2c8677210967bdb}{buffer}}\ =\ (\textcolor{keywordtype}{char}*)\ \mbox{\hyperlink{mimalloc-override_8h_a84e191d73dd91ea0a5bd2ec14d7adfaf}{calloc}}(\mbox{\hyperlink{yyjson_8h_ac16e956eac9f5c3180afa8e80d4f098c}{len}},\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}));}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{sugar_8h_aaadc06b5dac8070de2c8677210967bdb}{buffer}});}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \ \ \ \ \ \ clGetProgramBuildInfo(program,\ dId,\ CL\_PROGRAM\_BUILD\_LOG,\ \mbox{\hyperlink{yyjson_8h_ac16e956eac9f5c3180afa8e80d4f098c}{len}}\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}),}
\DoxyCodeLine{00730\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sugar_8h_aaadc06b5dac8070de2c8677210967bdb}{buffer}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00731\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{printf_8h_aee3ed3a831f25f07e7be3919fff2203a}{printf}}(\textcolor{stringliteral}{"{}LOG:\ \%s\(\backslash\)n\(\backslash\)n"{}},\ \mbox{\hyperlink{sugar_8h_aaadc06b5dac8070de2c8677210967bdb}{buffer}});}
\DoxyCodeLine{00732\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00733\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00734\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00735\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00736\ \ \ \ \ \}}
\DoxyCodeLine{00737\ }
\DoxyCodeLine{00738\ \ \ \ \ \textcolor{keywordtype}{int}\ buildKernelCode(\textcolor{keyword}{const}\ std::string\ \&kc,\ cl\_device\_id\ dId)\ \{}
\DoxyCodeLine{00739\ \ \ \ \ \ \ \ \ cl\_int\ status;}
\DoxyCodeLine{00740\ }
\DoxyCodeLine{00741\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ sourceSize\ =\ kc.length();}
\DoxyCodeLine{00742\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ code\ =\ kc.c\_str();}
\DoxyCodeLine{00743\ }
\DoxyCodeLine{00744\ \textcolor{preprocessor}{\#ifdef\ FF\_OPENCL\_LOG}}
\DoxyCodeLine{00745\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{printf_8h_aee3ed3a831f25f07e7be3919fff2203a}{printf}}(\textcolor{stringliteral}{"{}/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */\(\backslash\)n"{}});}
\DoxyCodeLine{00746\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{printf_8h_aee3ed3a831f25f07e7be3919fff2203a}{printf}}(\textcolor{stringliteral}{"{}buildKernelCode:\(\backslash\)n\%s\(\backslash\)n"{}},\ code);}
\DoxyCodeLine{00747\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{printf_8h_aee3ed3a831f25f07e7be3919fff2203a}{printf}}(\textcolor{stringliteral}{"{}/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */\(\backslash\)n"{}});}
\DoxyCodeLine{00748\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00749\ \ \ \ \ \ \ \ \ program\ =\ clCreateProgramWithSource(context,\ 1,\ \&code,\ \&sourceSize,\ \&status);}
\DoxyCodeLine{00750\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!program)\ \{}
\DoxyCodeLine{00751\ \ \ \ \ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}creating\ program\ with\ source"{}});}
\DoxyCodeLine{00752\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00753\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00754\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ buildProgram(dId);}
\DoxyCodeLine{00755\ \ \ \ \ \}}
\DoxyCodeLine{00756\ }
\DoxyCodeLine{00757\ \ \ \ \ \textcolor{comment}{//\ create\ the\ program\ with\ the\ binary\ file\ or\ from\ the\ source\ code}}
\DoxyCodeLine{00758\ \ \ \ \ \textcolor{keywordtype}{int}\ createProgram(\textcolor{keyword}{const}\ std::string\ \&filepath,\ cl\_device\_id\ dId,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ save\_binary,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ reuse\_binary)\ \{}
\DoxyCodeLine{00759\ \ \ \ \ \ \ \ \ cl\_int\ status,\ binaryStatus;}
\DoxyCodeLine{00760\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespacehalf__float_1_1detail_a083e9a0ced4c4a5495ac89dd753dd215}{binary}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00761\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ binpath\ =\ filepath\ +\ \textcolor{stringliteral}{"{}.bin"{}};}
\DoxyCodeLine{00762\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00763\ \ \ \ \ \ \ \ \ std::ifstream\ ifs;}
\DoxyCodeLine{00764\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (reuse\_binary)\ \{}
\DoxyCodeLine{00765\ \ \ \ \ \ \ \ \ \ \ \ \ ifs.open(binpath,\ std::ios::binary\ );}
\DoxyCodeLine{00766\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!ifs.is\_open())\ \{\ \textcolor{comment}{//\ try\ with\ filepath}}
\DoxyCodeLine{00767\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ifs.open(filepath,\ std::ios::binary);}
\DoxyCodeLine{00768\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!ifs.is\_open())\ \{}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacespdlog_ae1d3e9e381047283ac67046df1b6e13c}{error}}(\textcolor{stringliteral}{"{}createProgram:\ cannot\ open\ \%s\ (nor\ \%s)\(\backslash\)n"{}},\ filepath.c\_str(),\ binpath.c\_str());}
\DoxyCodeLine{00770\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00771\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00772\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \mbox{\hyperlink{namespacehalf__float_1_1detail_a083e9a0ced4c4a5495ac89dd753dd215}{binary}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00774\ \ \ \ \ \ \ \ \ \ \ \ \ ifs.open(filepath,\ std::ios::binary);}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!ifs.is\_open())\ \{}
\DoxyCodeLine{00776\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacespdlog_ae1d3e9e381047283ac67046df1b6e13c}{error}}(\textcolor{stringliteral}{"{}createProgram:\ cannot\ open\ source\ file\ \%s\(\backslash\)n"{}},\ filepath.c\_str());}
\DoxyCodeLine{00777\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00778\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00779\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00780\ \ \ \ \ \ \ \ \ std::vector<char>\ buf((std::istreambuf\_iterator<char>(ifs)),}
\DoxyCodeLine{00781\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (std::istreambuf\_iterator<char>()));}
\DoxyCodeLine{00782\ \ \ \ \ \ \ \ \ ifs.close();}
\DoxyCodeLine{00783\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ bufsize\ \ \ \ \ \ =\ buf.size();}
\DoxyCodeLine{00784\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *bufptr\ \ =\ buf.data();}
\DoxyCodeLine{00785\ }
\DoxyCodeLine{00786\ \ \ \ \ \ \ \ \ status\ =\ CL\_INVALID\_BINARY;}
\DoxyCodeLine{00787\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (binary)\ \{}
\DoxyCodeLine{00788\ \ \ \ \ \ \ \ \ \ \ \ \ program\ =\ clCreateProgramWithBinary(context,\ 1,\ \&dId,\ \&bufsize,}
\DoxyCodeLine{00789\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{reinterpret\_cast<}\textcolor{keyword}{const\ }\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ **\textcolor{keyword}{>}(\&bufptr),}
\DoxyCodeLine{00790\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&binaryStatus,\ \&status);}
\DoxyCodeLine{00791\ \ \ \ \ \ \ \ \ \}\ \ \ \ \ \ \ \ }
\DoxyCodeLine{00792\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (status\ !=\ CL\_SUCCESS)\ \{\ \textcolor{comment}{//\ maybe\ is\ not\ a\ binary\ file}}
\DoxyCodeLine{00793\ \ \ \ \ \ \ \ \ \ \ \ \ program\ =\ clCreateProgramWithSource(context,\ 1,\&bufptr,\ \&bufsize,\ \&status);}
\DoxyCodeLine{00794\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!program)\ \{}
\DoxyCodeLine{00795\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}creating\ program\ with\ source"{}});}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;\ \ }
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (buildProgram(dId)<0)\ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (save\_binary)\ \{\ \textcolor{comment}{//\ TODO:\ the\ logical\ deviceId\ has\ to\ be\ attached\ to\ the\ file\ name\ !\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }}
\DoxyCodeLine{00800\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ programBinarySize;}
\DoxyCodeLine{00801\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ status\ =\ clGetProgramInfo(program,\ CL\_PROGRAM\_BINARY\_SIZES,}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{size\_t})\ *\ 1,}
\DoxyCodeLine{00803\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&programBinarySize,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00804\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}createProgram\ clGetProgramInfo\ (binary\ size)"{}});\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00805\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00806\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<char>\ binbuf(programBinarySize);}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *binbufptr\ =\ binbuf.data();}
\DoxyCodeLine{00808\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ status\ =\ clGetProgramInfo(program,\ CL\_PROGRAM\_BINARIES,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}*)\ *\ 1,}
\DoxyCodeLine{00809\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&binbufptr,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00810\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}createProgram\ clGetProgramInfo\ (binary\ data)"{}});\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00811\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00812\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::ofstream\ ofs(binpath,\ std::ios::out\ |\ std::ios::binary);}
\DoxyCodeLine{00813\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ofs.write(binbuf.data(),\ binbuf.size());}
\DoxyCodeLine{00814\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ofs.close();}
\DoxyCodeLine{00815\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00816\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00817\ \ \ \ \ \ \ \ \ \}\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00818\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ buildProgram(dId);}
\DoxyCodeLine{00819\ \ \ \ \ \}}
\DoxyCodeLine{00820\ }
\DoxyCodeLine{00821\ }
\DoxyCodeLine{00822\ \ \ \ \ cl\_int\ buildKernels(\textcolor{keyword}{const}\ std::string\ \&kernel\_code,}
\DoxyCodeLine{00823\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&kernel\_name1,\ \textcolor{keyword}{const}\ std::string\ \&kernel\_name2,}
\DoxyCodeLine{00824\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ from\_source,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ save\_binary,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ reuse\_binary)\ \{}
\DoxyCodeLine{00825\ }
\DoxyCodeLine{00826\ \ \ \ \ \ \ \ \ cl\_int\ status\_\ =\ CL\_SUCCESS;}
\DoxyCodeLine{00827\ }
\DoxyCodeLine{00828\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!from\_source)\ \{\ \textcolor{comment}{//compile\ kernel\ on\ device}}
\DoxyCodeLine{00829\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (buildKernelCode(kernel\_code,\ deviceId)<0)\ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00830\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \ \textcolor{comment}{//\ kernel\_code\ is\ the\ path\ to\ the\ (binary?)\ source}}
\DoxyCodeLine{00831\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (createProgram(kernel\_code,\ deviceId,\ save\_binary,\ reuse\_binary)<0)\ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00832\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00833\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00834\ \ \ \ \ \ \ \ \ \textcolor{comment}{//create\ kernel\ objects}}
\DoxyCodeLine{00835\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (kernel\_name1\ !=\ \textcolor{stringliteral}{"{}"{}})\ \{\ \textcolor{comment}{//map\ kernel}}
\DoxyCodeLine{00836\ \ \ \ \ \ \ \ \ \ \ \ \ cl\_int\ status;}
\DoxyCodeLine{00837\ \ \ \ \ \ \ \ \ \ \ \ \ kernel\_map\ =\ clCreateKernel(program,\ kernel\_name1.c\_str(),\ \&status);}
\DoxyCodeLine{00838\ \ \ \ \ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}CreateKernel\ (map)"{}});}
\DoxyCodeLine{00839\ \ \ \ \ \ \ \ \ \ \ \ \ status\_\ |=\ status;}
\DoxyCodeLine{00840\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00841\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (kernel\_name2\ !=\ \textcolor{stringliteral}{"{}"{}})\ \{\ \textcolor{comment}{//reduce\ kernel}}
\DoxyCodeLine{00842\ \ \ \ \ \ \ \ \ \ \ \ \ cl\_int\ status;}
\DoxyCodeLine{00843\ \ \ \ \ \ \ \ \ \ \ \ \ kernel\_reduce\ =\ clCreateKernel(program,\ kernel\_name2.c\_str(),\ \&status);}
\DoxyCodeLine{00844\ \ \ \ \ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}CreateKernel\ (reduce)"{}});}
\DoxyCodeLine{00845\ \ \ \ \ \ \ \ \ \ \ \ \ status\_\ |=\ status;}
\DoxyCodeLine{00846\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00847\ }
\DoxyCodeLine{00848\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ status\_;}
\DoxyCodeLine{00849\ \ \ \ \ \}}
\DoxyCodeLine{00850\ }
\DoxyCodeLine{00851\ \ \ \ \ \textcolor{keywordtype}{void}\ svc\_releaseOclObjects()\ \{}
\DoxyCodeLine{00852\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (kernel\_map)\ \ \ \ \ clReleaseKernel(kernel\_map);}
\DoxyCodeLine{00853\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (kernel\_reduce)\ \ clReleaseKernel(kernel\_reduce);}
\DoxyCodeLine{00854\ \ \ \ \ \ \ \ \ clReleaseProgram(program);}
\DoxyCodeLine{00855\ }
\DoxyCodeLine{00856\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ (inputBuffer)\ \ \ \ clReleaseMemObject(inputBuffer);}}
\DoxyCodeLine{00857\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for(size\_t\ i=0;\ i\ <\ envBuffer.size();\ ++i)}}
\DoxyCodeLine{00858\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ clReleaseMemObject(envBuffer[i].first);}}
\DoxyCodeLine{00859\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ (outputBuffer\ \&\&\ outputBuffer\ !=\ inputBuffer)}}
\DoxyCodeLine{00860\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ clReleaseMemObject(outputBuffer);}}
\DoxyCodeLine{00861\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ (reduceBuffer)}}
\DoxyCodeLine{00862\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \ clReleaseMemObject(reduceBuffer);}}
\DoxyCodeLine{00863\ \ \ \ \ \ \ \ \ allocator-\/>releaseAllBuffers(context);}
\DoxyCodeLine{00864\ \ \ \ \ \}}
\DoxyCodeLine{00865\ }
\DoxyCodeLine{00866\ \ \ \ \ \textcolor{keywordtype}{void}\ resetReduce(\textcolor{keywordtype}{size\_t}\ lenReduceInput,\ \textcolor{keywordtype}{size\_t}\ elem\_size,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{void}\ *reducePtr)\ \{}
\DoxyCodeLine{00867\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 64\ and\ 256\ are\ the\ max\ number\ of\ blocks\ and\ threads\ we\ want\ to\ use}}
\DoxyCodeLine{00868\ \ \ \ \ \ \ \ \ \textcolor{comment}{//getBlocksAndThreads(lenInput,\ 64,\ 256,\ nwg\_reduce,\ wgsize\_reduce);}}
\DoxyCodeLine{00869\ \ \ \ \ \ \ \ \ \textcolor{comment}{//nthreads\_reduce\ =\ nwg\_reduce\ *\ wgsize\_reduce;}}
\DoxyCodeLine{00870\ \ \ \ \ \ \ \ \ nthreads\_reduce\ =\ lenReduceInput;}
\DoxyCodeLine{00871\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!isPowerOf2(nthreads\_reduce))}
\DoxyCodeLine{00872\ \ \ \ \ \ \ \ \ \ \ \ \ nthreads\_reduce\ =\ nextPowerOf2(nthreads\_reduce);}
\DoxyCodeLine{00873\ \ \ \ \ \ \ \ \ wgsize\_reduce\ =\ \mbox{\hyperlink{namespacestd_ac7b9885417769949d76890454b6d072e}{std::min<size\_t>}}(nthreads\_reduce,\ wgsize\_reduce\_static);}
\DoxyCodeLine{00874\ \ \ \ \ \ \ \ \ nwg\_reduce\ =\ nthreads\_reduce\ /\ wgsize\_reduce;}
\DoxyCodeLine{00875\ }
\DoxyCodeLine{00876\ \ \ \ \ \ \ \ \ \textcolor{comment}{//compute\ size\ of\ per-\/workgroup\ working\ memory}}
\DoxyCodeLine{00877\ \ \ \ \ \ \ \ \ wg\_red\_mem\ =\ (wgsize\_reduce\ *\ elem\_size)}
\DoxyCodeLine{00878\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +\ (wgsize\_reduce\ <=\ 32)\ *\ (wgsize\_reduce\ *\ elem\_size);}
\DoxyCodeLine{00879\ }
\DoxyCodeLine{00880\ \ \ \ \ \ \ \ \ \textcolor{comment}{//compute\ size\ of\ global\ reduce\ working\ memory}}
\DoxyCodeLine{00881\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ global\_red\_mem\ =\ nwg\_reduce\ *\ elem\_size;}
\DoxyCodeLine{00882\ }
\DoxyCodeLine{00883\ \ \ \ \ \ \ \ \ \textcolor{comment}{//allocate\ global\ memory\ for\ storing\ intermediate\ per-\/workgroup\ reduce\ results}}
\DoxyCodeLine{00884\ \ \ \ \ \ \ \ \ cl\_int\ status;}
\DoxyCodeLine{00885\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (reduceBuffer)}
\DoxyCodeLine{00886\ \ \ \ \ \ \ \ \ \ \ \ \ allocator-\/>releaseBuffer(reducePtr,\ context,\ reduceBuffer);}
\DoxyCodeLine{00887\ \ \ \ \ \ \ \ \ reduceBuffer\ =\ allocator-\/>createBuffer(reducePtr,\ context,}
\DoxyCodeLine{00888\ \ \ \ \ \ \ \ \ CL\_MEM\_READ\_WRITE,\ global\_red\_mem,\ \&status);}
\DoxyCodeLine{00889\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}CreateBuffer\ reduce"{}});}
\DoxyCodeLine{00890\ }
\DoxyCodeLine{00891\ \textcolor{preprocessor}{\#ifdef\ FF\_OPENCL\_LOG}}
\DoxyCodeLine{00892\ \ \ \ \ \ \ \ \ std::cerr\ <<\ \textcolor{stringliteral}{"{}[virtual\ accelerator\ @"{}}<<\textcolor{keyword}{this}<<\textcolor{stringliteral}{"{}]\(\backslash\)n"{}};}
\DoxyCodeLine{00893\ \ \ \ \ \ \ \ \ std::cerr\ <<\ \textcolor{stringliteral}{"{}+\ computed\ REDUCE\ kernel\ sizing\ parameters:\(\backslash\)n"{}};}
\DoxyCodeLine{00894\ \ \ \ \ \ \ \ \ std::cerr\ <<\ \textcolor{stringliteral}{"{}-\/\ REDUCE\ workgroup-\/size\ =\ "{}}\ <<wgsize\_reduce<<\ \textcolor{stringliteral}{"{}\ \(\backslash\)n"{}};}
\DoxyCodeLine{00895\ \ \ \ \ \ \ \ \ std::cerr\ <<\ \textcolor{stringliteral}{"{}-\/\ REDUCE\ n.\ threads\ \ \ \ \ =\ "{}}\ <<nthreads\_reduce<<\ \textcolor{stringliteral}{"{}\ \(\backslash\)n"{}};}
\DoxyCodeLine{00896\ \ \ \ \ \ \ \ \ std::cerr\ <<\ \textcolor{stringliteral}{"{}-\/\ REDUCE\ n.\ workgroups\ \ =\ "{}}\ <<nwg\_reduce<<\ \textcolor{stringliteral}{"{}\ \(\backslash\)n"{}};}
\DoxyCodeLine{00897\ \ \ \ \ \ \ \ \ std::cerr\ <<\ \textcolor{stringliteral}{"{}-\/\ REDUCE\ per-\/wg\ memory\ \ =\ "{}}\ <<wg\_red\_mem<<\ \textcolor{stringliteral}{"{}\ \(\backslash\)n"{}};}
\DoxyCodeLine{00898\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00899\ \ \ \ \ \}}
\DoxyCodeLine{00900\ }
\DoxyCodeLine{00904\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ getBlocksAndThreads(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ maxBlocks,}
\DoxyCodeLine{00905\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ maxThreads,\ \textcolor{keywordtype}{size\_t}\ \&\ blocks,\ \textcolor{keywordtype}{size\_t}\ \&threads)\ \{}
\DoxyCodeLine{00906\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{sugar_8h_a143fa055fc894f4591a2715c96eaeb01}{half}}\ =\ (\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}}\ +\ 1)\ /\ 2;}
\DoxyCodeLine{00907\ \ \ \ \ \ \ \ \ threads\ =}
\DoxyCodeLine{00908\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}}\ <\ maxThreads\ *\ 2)\ ?}
\DoxyCodeLine{00909\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (isPowerOf2(\mbox{\hyperlink{sugar_8h_a143fa055fc894f4591a2715c96eaeb01}{half}})\ ?\ nextPowerOf2(\mbox{\hyperlink{sugar_8h_a143fa055fc894f4591a2715c96eaeb01}{half}}\ +\ 1)\ :\ nextPowerOf2(\mbox{\hyperlink{sugar_8h_a143fa055fc894f4591a2715c96eaeb01}{half}}))\ :}
\DoxyCodeLine{00910\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ maxThreads;}
\DoxyCodeLine{00911\ \ \ \ \ \ \ \ \ blocks\ =\ (\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ac42c05b5701aef6bab82675cf3b55fee}{size}}\ +\ (threads\ *\ 2\ -\/\ 1))\ /\ (threads\ *\ 2);}
\DoxyCodeLine{00912\ \ \ \ \ \ \ \ \ blocks\ =\ \mbox{\hyperlink{namespacestd_ac7b9885417769949d76890454b6d072e}{std::min}}(maxBlocks,\ blocks);}
\DoxyCodeLine{00913\ \ \ \ \ \}}
\DoxyCodeLine{00914\ }
\DoxyCodeLine{00915\ \textcolor{keyword}{protected}:\ \ }
\DoxyCodeLine{00916\ \ \ \ \ cl\_context\ context;}
\DoxyCodeLine{00917\ \ \ \ \ cl\_program\ program;}
\DoxyCodeLine{00918\ \ \ \ \ cl\_command\_queue\ cmd\_queue;}
\DoxyCodeLine{00919\ \ \ \ \ cl\_mem\ reduceBuffer;}
\DoxyCodeLine{00920\ \ \ \ \ cl\_kernel\ kernel\_map,\ kernel\_reduce,\ kernel\_init;}
\DoxyCodeLine{00921\ }
\DoxyCodeLine{00922\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00923\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ from\_source;}
\DoxyCodeLine{00924\ \ \ \ \ \textcolor{keywordtype}{bool}\ my\_own\_allocator;\ }
\DoxyCodeLine{00925\ \ \ \ \ ff\_oclallocator\ *allocator;}
\DoxyCodeLine{00926\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ halo\_half;\ \textcolor{comment}{//half-\/size\ of\ the\ 1D\ halo}}
\DoxyCodeLine{00927\ \ \ \ \ \textcolor{keyword}{const}\ Tout\ identityVal;}
\DoxyCodeLine{00928\ \ \ \ \ Tout\ reduceVar;}
\DoxyCodeLine{00929\ }
\DoxyCodeLine{00930\ \ \ \ \ cl\_mem\ inputBuffer,\ outputBuffer;}
\DoxyCodeLine{00931\ \ \ \ \ std::vector<std::pair<cl\_mem,\ size\_t>\ >\ envBuffer;}
\DoxyCodeLine{00932\ }
\DoxyCodeLine{00933\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00934\ \textcolor{comment}{\ \ \ \ \ *\ each\ accelerator\ works\ on\ the\ following\ subset\ of\ the\ input\ array:}}
\DoxyCodeLine{00935\ \textcolor{comment}{\ \ \ \ \ *\ [left-\/border][input-\/portion][right-\/border]}}
\DoxyCodeLine{00936\ \textcolor{comment}{\ \ \ \ \ *\ input\ portion\ is\ accessed\ RW,\ border\ are\ accessed\ read-\/only}}
\DoxyCodeLine{00937\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{00938\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ sizeInput;\ \textcolor{comment}{//byte-\/size\ of\ the\ input-\/portion}}
\DoxyCodeLine{00939\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ sizeInput\_padded;\ \textcolor{comment}{//byte-\/size\ of\ the\ input-\/portion\ plus\ left\ and\ right\ borders}}
\DoxyCodeLine{00940\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ lenInput;\ \textcolor{comment}{//n.\ elements\ in\ the\ input-\/portion}}
\DoxyCodeLine{00941\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ offset1\_in;\ \textcolor{comment}{//left-\/offset\ (begin\ input-\/portion\ wrt\ to\ begin\ input)}}
\DoxyCodeLine{00942\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ halo\_in\_left;\ \textcolor{comment}{//n.\ elements\ in\ the\ left-\/halo}}
\DoxyCodeLine{00943\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ halo\_in\_right;\ \textcolor{comment}{//n.\ elements\ in\ the\ right-\/halo}}
\DoxyCodeLine{00944\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ lenInput\_global;\ \textcolor{comment}{//n.\ elements\ in\ the\ input}}
\DoxyCodeLine{00945\ }
\DoxyCodeLine{00946\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ sizeOutput,\ sizeOutput\_padded;}
\DoxyCodeLine{00947\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ lenOutput,\ offset1\_out,\ halo\_out\_left,\ halo\_out\_right,\ lenOutput\_global;}
\DoxyCodeLine{00948\ }
\DoxyCodeLine{00949\ \ \ \ \ \textcolor{comment}{//static\ input-\/independent\ estimation\ of\ workgroup\ sizing}}
\DoxyCodeLine{00950\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ wgsize\_map\_static,\ wgsize\_reduce\_static;}
\DoxyCodeLine{00951\ \ \ \ \ \textcolor{comment}{//static\ input-\/independent\ upper\ bounds\ for\ workgroup\ sizing}}
\DoxyCodeLine{00952\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ wgsize\_map\_max,\ wgsize\_reduce\_max;}
\DoxyCodeLine{00953\ \ \ \ \ \textcolor{comment}{//input-\/dependent\ workgroup\ sizing}}
\DoxyCodeLine{00954\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ wgsize\_map,\ wgsize\_reduce;}
\DoxyCodeLine{00955\ \ \ \ \ \textcolor{comment}{//input-\/dependent\ number\ of\ threads}}
\DoxyCodeLine{00956\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ nthreads\_map,\ nthreads\_reduce;}
\DoxyCodeLine{00957\ \ \ \ \ \textcolor{comment}{//number\ of\ workgroups\ executing\ first\ on-\/device\ reduce}}
\DoxyCodeLine{00958\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ nwg\_reduce;}
\DoxyCodeLine{00959\ \ \ \ \ \textcolor{comment}{//reduce\ workgroup-\/local\ memory}}
\DoxyCodeLine{00960\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ wg\_red\_mem;}
\DoxyCodeLine{00961\ }
\DoxyCodeLine{00962\ \ \ \ \ \textcolor{comment}{//OCL\ events}}
\DoxyCodeLine{00963\ \ \ \ \ std::vector<cl\_event>\ events\_h2d;}
\DoxyCodeLine{00964\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ nevents\_h2d,\ nevents\_map;}
\DoxyCodeLine{00965\ \ \ \ \ cl\_event\ event\_d2h,\ event\_map,\ event\_reduce1,\ event\_reduce2;}
\DoxyCodeLine{00966\ }
\DoxyCodeLine{00967\ \ \ \ \ \textcolor{comment}{//switch\ for\ the\ input\ of\ the\ reduce}}
\DoxyCodeLine{00968\ \ \ \ \ reduceMode\ reduce\_mode;}
\DoxyCodeLine{00969\ }
\DoxyCodeLine{00970\ \ \ \ \ \textcolor{comment}{//the\ OCL\ Id\ the\ accelerator\ is\ mapped\ to}}
\DoxyCodeLine{00971\ \ \ \ \ cl\_device\_id\ deviceId;}
\DoxyCodeLine{00972\ \};}
\DoxyCodeLine{00973\ }
\DoxyCodeLine{00974\ }
\DoxyCodeLine{00975\ }
\DoxyCodeLine{00984\ \ \ \ \ }
\DoxyCodeLine{00985\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ TOCL\ =\ T,\ \textcolor{keyword}{typename}\ accelerator\_t\ =\ ff\_oclAccelerator<T,\ TOCL>\ >}
\DoxyCodeLine{00986\ \textcolor{keyword}{class\ }ff\_stencilReduceLoopOCL\_1D:\ \textcolor{keyword}{public}\ \mbox{\hyperlink{structff_1_1ff__ocl_node__t}{ff\_oclNode\_t}}<T>\ \{}
\DoxyCodeLine{00987\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00988\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ TOCL::Tin\ \ \ \ \ \ \ \ \ Tin;}
\DoxyCodeLine{00989\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ TOCL::Tout\ \ \ \ \ \ \ \ Tout;}
\DoxyCodeLine{00990\ }
\DoxyCodeLine{00991\ \ \ \ \ \textcolor{comment}{//\ build\ the\ program\ from\ the\ mapf\ and\ reducef\ functions}}
\DoxyCodeLine{00992\ \ \ \ \ ff\_stencilReduceLoopOCL\_1D(\textcolor{keyword}{const}\ std::string\ \&mapf,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//OpenCL\ elemental\ function\ }}
\DoxyCodeLine{00993\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&reducef\ =\ std::string(\textcolor{stringliteral}{"{}"{}}),\ \ \textcolor{comment}{//OpenCL\ combinator\ function}}
\DoxyCodeLine{00994\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Tout\ \&identityVal\ =\ Tout(),\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00995\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *allocator\ =\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{00996\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a4c3bd78046e1e69b575cace337a4a9a3}{width}}\ =\ 1)\ :}
\DoxyCodeLine{00997\ \ \ \ \ \ \ \ \ oneshot(\mbox{\hyperlink{yyjson_8h_a65e9886d74aaee76545e83dd09011727}{false}}),\ saveBinary(\mbox{\hyperlink{yyjson_8h_a65e9886d74aaee76545e83dd09011727}{false}}),\ reuseBinary(\mbox{\hyperlink{yyjson_8h_a65e9886d74aaee76545e83dd09011727}{false}}),\ }
\DoxyCodeLine{00998\ \ \ \ \ \ \ \ \ accelerators(NACCELERATORS),\ acc\_in(NACCELERATORS),\ acc\_out(NACCELERATORS),\ }
\DoxyCodeLine{00999\ \ \ \ \ \ \ \ \ stencil\_width\_half(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a4c3bd78046e1e69b575cace337a4a9a3}{width}}),\ offset\_dev(0),\ old\_inPtr(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}),\ old\_outPtr(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}),}
\DoxyCodeLine{01000\ \ \ \ \ \ \ \ \ oldBytesizeIn(0),\ oldSizeOut(0),\ \ oldSizeReduce(0)\ \ \{}
\DoxyCodeLine{01001\ \ \ \ \ \ \ \ \ setcode(mapf,\ reducef);}
\DoxyCodeLine{01002\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\ NACCELERATORS;\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01003\ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]=\ \textcolor{keyword}{new}\ accelerator\_t(allocator,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a4c3bd78046e1e69b575cace337a4a9a3}{width}},identityVal);}
\DoxyCodeLine{01004\ \textcolor{preprocessor}{\#ifdef\ FF\_OPENCL\_LOG}}
\DoxyCodeLine{01005\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{printf_8h_a9f315126362cae9675de1642105e631e}{fprintf}}(stderr,\textcolor{stringliteral}{"{}[ff\_stencilReduceLoopOCL\_1D\ node\ @\%p]\(\backslash\)n"{}},\textcolor{keyword}{this});}
\DoxyCodeLine{01006\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{printf_8h_a9f315126362cae9675de1642105e631e}{fprintf}}(stderr,\textcolor{stringliteral}{"{}map-\/kernel\ code:\(\backslash\)n\%s\(\backslash\)n"{}},\ mapf.c\_str());}
\DoxyCodeLine{01007\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{printf_8h_a9f315126362cae9675de1642105e631e}{fprintf}}(stderr,\textcolor{stringliteral}{"{}reduce-\/kernel\ code:\(\backslash\)n\%s\(\backslash\)n"{}},\ reducef.c\_str());}
\DoxyCodeLine{01008\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01009\ \ \ \ \ \}}
\DoxyCodeLine{01010\ \ \ \ \ }
\DoxyCodeLine{01011\ \ \ \ \ \textcolor{comment}{//\ build\ the\ program\ from\ source\ code\ file,\ }}
\DoxyCodeLine{01012\ \ \ \ \ \textcolor{comment}{//\ first\ attempts\ to\ load\ a\ cached\ binary\ file\ (kernels\_source\ in\ this\ case\ is\ the\ path\ to\ the\ binary\ file)}}
\DoxyCodeLine{01013\ \ \ \ \ \textcolor{comment}{//\ ff\ that\ file\ is\ not\ available,\ then\ it\ creates\ the\ program\ from\ source\ and\ store\ the\ binary\ for\ future\ use}}
\DoxyCodeLine{01014\ \ \ \ \ \textcolor{comment}{//\ with\ the\ extention\ "{}.bin"{}}}
\DoxyCodeLine{01015\ \ \ \ \ ff\_stencilReduceLoopOCL\_1D(\textcolor{keyword}{const}\ std::string\ \&kernels\_source,\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ OpenCL\ source\ code\ path}}
\DoxyCodeLine{01016\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&mapf\_name,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ name\ of\ the\ map\ function}}
\DoxyCodeLine{01017\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&reducef\_name,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ name\ of\ the\ reduce\ function}}
\DoxyCodeLine{01018\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Tout\ \&identityVal\ =\ Tout(),}
\DoxyCodeLine{01019\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *allocator\ =\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{01020\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a4c3bd78046e1e69b575cace337a4a9a3}{width}}\ =\ 1)\ :}
\DoxyCodeLine{01021\ \ \ \ \ \ \ \ \ oneshot(\mbox{\hyperlink{yyjson_8h_a65e9886d74aaee76545e83dd09011727}{false}}),\ saveBinary(\mbox{\hyperlink{yyjson_8h_a65e9886d74aaee76545e83dd09011727}{false}}),\ reuseBinary(\mbox{\hyperlink{yyjson_8h_a65e9886d74aaee76545e83dd09011727}{false}}),\ }
\DoxyCodeLine{01022\ \ \ \ \ \ \ \ \ accelerators(NACCELERATORS),\ acc\_in(NACCELERATORS),\ acc\_out(NACCELERATORS),\ }
\DoxyCodeLine{01023\ \ \ \ \ \ \ \ \ stencil\_width\_half(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a4c3bd78046e1e69b575cace337a4a9a3}{width}}),\ offset\_dev(0),\ old\_inPtr(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}),\ old\_outPtr(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}),}
\DoxyCodeLine{01024\ \ \ \ \ \ \ \ \ oldBytesizeIn(0),\ oldSizeOut(0),\ \ oldSizeReduce(0)\ \ \{}
\DoxyCodeLine{01025\ \ \ \ \ \ \ \ \ setsourcecode(kernels\_source,\ mapf\_name,\ reducef\_name);}
\DoxyCodeLine{01026\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\ NACCELERATORS;\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01027\ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]=\ \textcolor{keyword}{new}\ accelerator\_t(allocator,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a4c3bd78046e1e69b575cace337a4a9a3}{width}},\ identityVal,\ \textcolor{keyword}{true});}
\DoxyCodeLine{01028\ \ \ \ \ \}}
\DoxyCodeLine{01029\ }
\DoxyCodeLine{01030\ \ \ \ \ \textcolor{comment}{//\ the\ task\ is\ provided\ in\ the\ constructor\ -\/-\/\ one\ shot\ computation}}
\DoxyCodeLine{01031\ \ \ \ \ ff\_stencilReduceLoopOCL\_1D(\textcolor{keyword}{const}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \&\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},\ }
\DoxyCodeLine{01032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&mapf,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&reducef\ =\ std::string(\textcolor{stringliteral}{"{}"{}}),\ \ \ \ }
\DoxyCodeLine{01034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Tout\ \&identityVal\ =\ Tout(),}
\DoxyCodeLine{01035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *allocator\ =\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{01036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a4c3bd78046e1e69b575cace337a4a9a3}{width}}\ =\ 1)\ :}
\DoxyCodeLine{01037\ \ \ \ \ \ \ \ \ oneshot(\mbox{\hyperlink{yyjson_8h_a41f9c5fb8b08eb5dc3edce4dcb37fee7}{true}}),\ saveBinary(\mbox{\hyperlink{yyjson_8h_a65e9886d74aaee76545e83dd09011727}{false}}),\ reuseBinary(\mbox{\hyperlink{yyjson_8h_a65e9886d74aaee76545e83dd09011727}{false}}),\ }
\DoxyCodeLine{01038\ \ \ \ \ \ \ \ \ accelerators(NACCELERATORS),\ acc\_in(NACCELERATORS),\ acc\_out(NACCELERATORS),\ }
\DoxyCodeLine{01039\ \ \ \ \ \ \ \ \ stencil\_width\_half(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a4c3bd78046e1e69b575cace337a4a9a3}{width}}),\ offset\_dev(0),\ old\_inPtr(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}),\ old\_outPtr(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}),}
\DoxyCodeLine{01040\ \ \ \ \ \ \ \ \ oldBytesizeIn(0),\ oldSizeOut(0),\ oldSizeReduce(0)\ \{}
\DoxyCodeLine{01041\ \ \ \ \ \ \ \ \ ff\_node::skipfirstpop(\textcolor{keyword}{true});}
\DoxyCodeLine{01042\ \ \ \ \ \ \ \ \ setcode(mapf,\ reducef);}
\DoxyCodeLine{01043\ \ \ \ \ \ \ \ \ setTask(\textcolor{keyword}{const\_cast<}\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\&\textcolor{keyword}{>}(\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}));}
\DoxyCodeLine{01044\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\ NACCELERATORS;\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01045\ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]=\ \textcolor{keyword}{new}\ accelerator\_t(allocator,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a4c3bd78046e1e69b575cace337a4a9a3}{width}},identityVal);}
\DoxyCodeLine{01046\ \textcolor{preprocessor}{\#ifdef\ FF\_OPENCL\_LOG}}
\DoxyCodeLine{01047\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{printf_8h_a9f315126362cae9675de1642105e631e}{fprintf}}(stderr,\textcolor{stringliteral}{"{}[ff\_stencilReduceLoopOCL\_1D\ node\ @\%p]\(\backslash\)n"{}},\textcolor{keyword}{this});}
\DoxyCodeLine{01048\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{printf_8h_a9f315126362cae9675de1642105e631e}{fprintf}}(stderr,\textcolor{stringliteral}{"{}map-\/kernel\ code:\(\backslash\)n\%s\(\backslash\)n"{}},\ mapf.c\_str());}
\DoxyCodeLine{01049\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{printf_8h_a9f315126362cae9675de1642105e631e}{fprintf}}(stderr,\textcolor{stringliteral}{"{}reduce-\/kernel\ code:\(\backslash\)n\%s\(\backslash\)n"{}},\ reducef.c\_str());}
\DoxyCodeLine{01050\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01051\ \ \ \ \ \}}
\DoxyCodeLine{01052\ }
\DoxyCodeLine{01053\ \ \ \ \ \textcolor{comment}{//\ the\ task\ is\ provided\ in\ the\ constructor\ -\/-\/\ one\ shot\ computation}}
\DoxyCodeLine{01054\ \ \ \ \ ff\_stencilReduceLoopOCL\_1D(\textcolor{keyword}{const}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \&\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},\ }
\DoxyCodeLine{01055\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&kernels\_source,\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ OpenCL\ source\ code\ path}}
\DoxyCodeLine{01056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&mapf\_name,\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ name\ of\ the\ map\ kernel\ function}}
\DoxyCodeLine{01057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&reducef\_name,\ \ \ \ \ \ \ \ \textcolor{comment}{//\ name\ of\ the\ reduce\ kernel\ function}}
\DoxyCodeLine{01058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Tout\ \&identityVal\ =\ Tout(),}
\DoxyCodeLine{01059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *allocator\ =\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{01060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a4c3bd78046e1e69b575cace337a4a9a3}{width}}\ =\ 1)\ :}
\DoxyCodeLine{01061\ \ \ \ \ \ \ \ \ oneshot(\mbox{\hyperlink{yyjson_8h_a41f9c5fb8b08eb5dc3edce4dcb37fee7}{true}}),\ saveBinary(\mbox{\hyperlink{yyjson_8h_a65e9886d74aaee76545e83dd09011727}{false}}),\ reuseBinary(\mbox{\hyperlink{yyjson_8h_a65e9886d74aaee76545e83dd09011727}{false}}),\ }
\DoxyCodeLine{01062\ \ \ \ \ \ \ \ \ accelerators(NACCELERATORS),\ acc\_in(NACCELERATORS),\ acc\_out(NACCELERATORS),\ }
\DoxyCodeLine{01063\ \ \ \ \ \ \ \ \ stencil\_width\_half(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a4c3bd78046e1e69b575cace337a4a9a3}{width}}),\ offset\_dev(0),\ old\_inPtr(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}),\ old\_outPtr(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}),}
\DoxyCodeLine{01064\ \ \ \ \ \ \ \ \ oldBytesizeIn(0),\ oldSizeOut(0),\ \ oldSizeReduce(0)\ \ \{}
\DoxyCodeLine{01065\ \ \ \ \ \ \ \ \ setsourcecode(kernels\_source,\ mapf\_name,\ reducef\_name);}
\DoxyCodeLine{01066\ \ \ \ \ \ \ \ \ setTask(\textcolor{keyword}{const\_cast<}\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\&\textcolor{keyword}{>}(\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}}));}
\DoxyCodeLine{01067\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\ NACCELERATORS;\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01068\ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]=\ \textcolor{keyword}{new}\ accelerator\_t(allocator,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a4c3bd78046e1e69b575cace337a4a9a3}{width}},\ identityVal,\ \textcolor{keyword}{true});}
\DoxyCodeLine{01069\ \ \ \ \ \}}
\DoxyCodeLine{01070\ \ \ \ }
\DoxyCodeLine{01071\ }
\DoxyCodeLine{01072\ \ \ \ \ \textcolor{keyword}{virtual}\ \string~ff\_stencilReduceLoopOCL\_1D()\ \{}
\DoxyCodeLine{01073\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01074\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}])\ \textcolor{keyword}{delete}\ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}];}
\DoxyCodeLine{01075\ \ \ \ \ \}}
\DoxyCodeLine{01076\ }
\DoxyCodeLine{01077\ \ \ \ \ \textcolor{comment}{//\ used\ to\ set\ tasks\ when\ in\ onshot\ mode}}
\DoxyCodeLine{01078\ \ \ \ \ \textcolor{keywordtype}{void}\ setTask(\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \&\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}})\ \{}
\DoxyCodeLine{01079\ \ \ \ \ \ \ \ \ Task.resetTask();}
\DoxyCodeLine{01080\ \ \ \ \ \ \ \ \ Task.setTask(\&\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}});}
\DoxyCodeLine{01081\ \ \ \ \ \}}
\DoxyCodeLine{01082\ }
\DoxyCodeLine{01088\ \ \ \ \ \textcolor{keywordtype}{void}\ setDevices(std::vector<cl\_device\_id>\ \&dev)\ \{}
\DoxyCodeLine{01089\ \textcolor{comment}{//\ \ \ \ \ \ \ \ if\ (dev.size()\ >\ accelerators.size())\ \{}}
\DoxyCodeLine{01090\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ error("{}ff\_stencilReduceLoopOCL\_1D::setDevices:\ Too\ many\ devices\ provided,\ please\ increase\ the\ number\ of\ logical\ accelerators\(\backslash\)n"{});}}
\DoxyCodeLine{01091\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ return\ -\/1;}}
\DoxyCodeLine{01092\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \}}}
\DoxyCodeLine{01093\ \ \ \ \ \ \ \ \ devices\ =\ dev;}
\DoxyCodeLine{01094\ \textcolor{comment}{//\ \ \ \ \ \ \ \ return\ 0;}}
\DoxyCodeLine{01095\ \ \ \ \ \}}
\DoxyCodeLine{01096\ }
\DoxyCodeLine{01097\ \ \ \ \ \textcolor{comment}{//\ force\ execution\ on\ the\ CPU}}
\DoxyCodeLine{01098\ \ \ \ \ \textcolor{keywordtype}{void}\ pickCPU\ ()\ \{}
\DoxyCodeLine{01099\ \ \ \ \ \ \ \ \ ff\_oclNode\_t<T>::setDeviceType(CL\_DEVICE\_TYPE\_CPU);}
\DoxyCodeLine{01100\ \ \ \ \ \}}
\DoxyCodeLine{01101\ \ \ \ \ }
\DoxyCodeLine{01102\ \ \ \ \ \textcolor{comment}{//\ force\ execution\ on\ the\ GPU\ -\/\ as\ many\ as\ requested\ by\ the\ co-\/allocation\ strategy}}
\DoxyCodeLine{01103\ \ \ \ \ \textcolor{keywordtype}{void}\ pickGPU\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ae1b92ae085ddef4b1cdca7d749339fb0}{offset}}=0\ \textcolor{comment}{/*\ referred\ to\ global\ list\ of\ devices\ */})\ \{}
\DoxyCodeLine{01104\ \ \ \ \ \ \ \ \ offset\_dev=\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ae1b92ae085ddef4b1cdca7d749339fb0}{offset}};\ \textcolor{comment}{//TODO\ check\ numbering}}
\DoxyCodeLine{01105\ \ \ \ \ \ \ \ \ ff\_oclNode\_t<T>::setDeviceType(CL\_DEVICE\_TYPE\_GPU);}
\DoxyCodeLine{01106\ \ \ \ \ \}}
\DoxyCodeLine{01107\ }
\DoxyCodeLine{01108\ \ \ \ \ \textcolor{comment}{//\ after\ the\ compilation\ and\ building\ phases,\ the\ OpenCL\ program\ will\ be\ saved\ as\ binary\ file\ }}
\DoxyCodeLine{01109\ \ \ \ \ \textcolor{comment}{//\ this\ action\ takes\ effect\ only\ if\ the\ compilation\ is\ made\ with\ source\ file\ (i.e.\ not\ using\ macroes)}}
\DoxyCodeLine{01110\ \ \ \ \ \textcolor{keywordtype}{void}\ saveBinaryFile()\ \{\ saveBinary\ =\ \textcolor{keyword}{true};\ \}}
\DoxyCodeLine{01111\ }
\DoxyCodeLine{01112\ \ \ \ \ \textcolor{comment}{//\ tells\ the\ run-\/time\ to\ re-\/use\ the\ binary\ file\ available}}
\DoxyCodeLine{01113\ \ \ \ \ \textcolor{keywordtype}{void}\ reuseBinaryFile()\ \{\ reuseBinary\ =\ \textcolor{keyword}{true};\ \}}
\DoxyCodeLine{01114\ \ \ \ \ }
\DoxyCodeLine{01115\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{poisson_8cpp_ae12af222b820baf64e953be588c5bbbe}{run}}(\textcolor{keywordtype}{bool}\ =\ \textcolor{keyword}{false})\ \{}
\DoxyCodeLine{01116\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ff\_node::run();}
\DoxyCodeLine{01117\ \ \ \ \ \}}
\DoxyCodeLine{01118\ }
\DoxyCodeLine{01119\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{int}\ wait()\ \{}
\DoxyCodeLine{01120\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ff\_node::wait();}
\DoxyCodeLine{01121\ \ \ \ \ \}}
\DoxyCodeLine{01122\ }
\DoxyCodeLine{01123\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{int}\ run\_and\_wait\_end()\ \{}
\DoxyCodeLine{01124\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{poisson_8cpp_ae12af222b820baf64e953be588c5bbbe}{run}}()\ <\ 0)}
\DoxyCodeLine{01125\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01126\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (wait()\ <\ 0)}
\DoxyCodeLine{01127\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01128\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01129\ \ \ \ \ \}}
\DoxyCodeLine{01130\ }
\DoxyCodeLine{01131\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{int}\ run\_then\_freeze()\ \{}
\DoxyCodeLine{01132\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ff\_node::isfrozen())\ \{}
\DoxyCodeLine{01133\ \ \ \ \ \ \ \ \ \ \ \ \ ff\_node::thaw(\textcolor{keyword}{true});}
\DoxyCodeLine{01134\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01135\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01136\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ff\_node::freeze\_and\_run();}
\DoxyCodeLine{01137\ \ \ \ \ \}}
\DoxyCodeLine{01138\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{int}\ wait\_freezing()\ \{}
\DoxyCodeLine{01139\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ff\_node::wait\_freezing();}
\DoxyCodeLine{01140\ \ \ \ \ \}}
\DoxyCodeLine{01141\ }
\DoxyCodeLine{01142\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}*\ getTask()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01143\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \&Task;}
\DoxyCodeLine{01144\ \ \ \ \ \}}
\DoxyCodeLine{01145\ }
\DoxyCodeLine{01146\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ getIter()\ \{}
\DoxyCodeLine{01147\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Task.getIter();}
\DoxyCodeLine{01148\ \ \ \ \ \}}
\DoxyCodeLine{01149\ }
\DoxyCodeLine{01150\ \ \ \ \ Tout\ *getReduceVar()\ \{}
\DoxyCodeLine{01151\ \ \ \ \ \ \ \ \ assert(oneshot);}
\DoxyCodeLine{01152\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Task.getReduceVar();}
\DoxyCodeLine{01153\ \ \ \ \ \}}
\DoxyCodeLine{01154\ \ \ \ \ }
\DoxyCodeLine{01161\ \ \ \ \ \textcolor{keywordtype}{int}\ nodeInit()\ \{}
\DoxyCodeLine{01162\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ff\_oclNode\_t<T>::oclId\ <\ 0)\ \{\ \textcolor{comment}{//check\ if\ already\ initialized}}
\DoxyCodeLine{01163\ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclNode\_t<T>::oclId\ =\ clEnvironment::instance()-\/>getOCLID();}
\DoxyCodeLine{01164\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (devices.size()\ ==\ 0)\ \{\ \textcolor{comment}{//\ the\ user\ didn't\ set\ any\ specific\ device}}
\DoxyCodeLine{01165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (ff\_oclNode\_t<T>::getDeviceType())\ \{}
\DoxyCodeLine{01166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ CL\_DEVICE\_TYPE\_ALL:}
\DoxyCodeLine{01167\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ CL\_DEVICE\_TYPE\_GPU:\ \{}
\DoxyCodeLine{01168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Retrive\ multiple\ logical\ GPU\ devices\ (non-\/exclusive\ mode)}}
\DoxyCodeLine{01169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<ssize\_t>\ logdev\ =}
\DoxyCodeLine{01170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ clEnvironment::instance()-\/>coAllocateGPUDeviceRR(accelerators.size(),}
\DoxyCodeLine{01171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (offset\_dev\ ==\ 0)\ ?\ -\/1\ :\ offset\_dev);}
\DoxyCodeLine{01172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (logdev.size()\ ==\ 0)\ \{}
\DoxyCodeLine{01173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//could\ not\ fulfill\ allocation\ request}}
\DoxyCodeLine{01174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(ff\_oclNode\_t<T>::getDeviceType()\ ==\ CL\_DEVICE\_TYPE\_GPU)\ \{}
\DoxyCodeLine{01175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacespdlog_ae1d3e9e381047283ac67046df1b6e13c}{error}}(\textcolor{stringliteral}{"{}not\ enough\ GPUs\ found\ !\(\backslash\)n"{}});}
\DoxyCodeLine{01176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//if\ user\ did\ not\ require\ require\ GPU\ devices,\ fallback\ to\ CPU}}
\DoxyCodeLine{01179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//convert\ retrieved\ logical\ devices\ into\ opencl\ Ids}}
\DoxyCodeLine{01181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ devices.clear();}
\DoxyCodeLine{01182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ logdev.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ devices.push\_back(clEnvironment::instance()-\/>getDevice(logdev[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]));}
\DoxyCodeLine{01184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ devices.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>\mbox{\hyperlink{boing_8c_a2858154e2009b0e6e616f313177762bc}{init}}(devices[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}],\ getReduceMode(),\ kernel\_code,}
\DoxyCodeLine{01186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ kernel\_name1,\ kernel\_name2,\ saveBinary,\ reuseBinary)\ <\ 0)}
\DoxyCodeLine{01187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01191\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ CL\_DEVICE\_TYPE\_CPU:\ \{}
\DoxyCodeLine{01193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (accelerators.size()\ >\ 1)\ \{}
\DoxyCodeLine{01194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacespdlog_ae1d3e9e381047283ac67046df1b6e13c}{error}}(}
\DoxyCodeLine{01195\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Multiple\ (>1)\ virtual\ accelerators\ on\ CPU\ are\ requested.\ Not\ yet\ implemented.\(\backslash\)n"{}});}
\DoxyCodeLine{01196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01198\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Retrieve\ the\ CPU\ device}}
\DoxyCodeLine{01199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ devices.clear();}
\DoxyCodeLine{01200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ devices.push\_back(clEnvironment::instance()-\/>getDevice(\ \textcolor{comment}{//convert\ to\ OpenCL\ Id}}
\DoxyCodeLine{01201\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ clEnvironment::instance()-\/>getCPUDevice()));\ \textcolor{comment}{//retrieve\ logical\ device}}
\DoxyCodeLine{01202\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (accelerators[0]-\/>\mbox{\hyperlink{boing_8c_a2858154e2009b0e6e616f313177762bc}{init}}(devices[0],\ getReduceMode(),\ kernel\_code,}
\DoxyCodeLine{01203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ kernel\_name1,\ kernel\_name2,\ saveBinary,\ reuseBinary)\ <\ 0)}
\DoxyCodeLine{01204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01207\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:\ \{}
\DoxyCodeLine{01209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacespdlog_ae1d3e9e381047283ac67046df1b6e13c}{error}}(}
\DoxyCodeLine{01210\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}stencilReduceOCL::Other\ device.\ Not\ yet\ implemented.\(\backslash\)n"{}});}
\DoxyCodeLine{01211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01213\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{comment}{//end\ switch\ on\ ff\_oclNode\_t<T>::getDeviceType()}}
\DoxyCodeLine{01214\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01215\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//user\ requested\ specific\ OpenCL\ devices}}
\DoxyCodeLine{01216\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (devices.size()\ >\ accelerators.size())\ \{}
\DoxyCodeLine{01217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacespdlog_ae1d3e9e381047283ac67046df1b6e13c}{error}}(}
\DoxyCodeLine{01218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}stencilReduceOCL::nodeInit:\ Too\ many\ devices\ requested,\ increase\ the\ number\ of\ accelerators!\(\backslash\)n"{}});}
\DoxyCodeLine{01219\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01220\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01221\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ NOTE:\ the\ number\ of\ devices\ requested\ can\ be\ lower\ than\ the\ number\ of\ accelerators.}}
\DoxyCodeLine{01222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO\ must\ be\ managed}}
\DoxyCodeLine{01223\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ devices.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>\mbox{\hyperlink{boing_8c_a2858154e2009b0e6e616f313177762bc}{init}}(devices[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}],\ getReduceMode(),\ kernel\_code,\ kernel\_name1,}
\DoxyCodeLine{01225\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ kernel\_name2,\ saveBinary,\ reuseBinary);}
\DoxyCodeLine{01226\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01227\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01228\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01229\ \textcolor{comment}{//\ \ \ \ \ \ \ \ for\ (size\_t\ i\ =\ 0;\ i\ <\ devices.size();\ ++i)}}
\DoxyCodeLine{01230\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ std::cerr\ <<\ "{}Using\ "{}\ <<\ clEnvironment::instance()-\/>getDeviceInfo(devices[i])\ <<\ std::endl;}}
\DoxyCodeLine{01231\ }
\DoxyCodeLine{01232\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01233\ \ \ \ \ \}}
\DoxyCodeLine{01234\ \ \ \ \ }
\DoxyCodeLine{01235\ \ \ \ \ \textcolor{keywordtype}{void}\ nodeEnd()\ \{\}}
\DoxyCodeLine{01236\ }
\DoxyCodeLine{01237\ \textcolor{preprocessor}{\#if\ defined(FF\_REPARA)}\textcolor{preprocessor}{}}
\DoxyCodeLine{01241\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ rpr\_get\_sizeIn()\textcolor{keyword}{\ \ const\ }\{\ \textcolor{keywordflow}{return}\ ff\_node::rpr\_sizeIn;\ \}}
\DoxyCodeLine{01242\ }
\DoxyCodeLine{01246\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ rpr\_get\_sizeOut()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ ff\_node::rpr\_sizeOut;\ \}}
\DoxyCodeLine{01247\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01248\ \ \ \ \ \ }
\DoxyCodeLine{01249\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{01250\ }
\DoxyCodeLine{01251\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ isPureMap()\textcolor{keyword}{\ const\ \ \ \ }\{\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \}}
\DoxyCodeLine{01252\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}\ isPureReduce()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \}}
\DoxyCodeLine{01253\ \ \ \ \ reduceMode\ getReduceMode()\ \{}
\DoxyCodeLine{01254\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ isPureReduce()\ ?\ REDUCE\_INPUT\ :\ REDUCE\_OUTPUT;}
\DoxyCodeLine{01255\ \ \ \ \ \}}
\DoxyCodeLine{01256\ }
\DoxyCodeLine{01257\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{int}\ svc\_init()\ \{\ \textcolor{keywordflow}{return}\ nodeInit();\ \}}
\DoxyCodeLine{01258\ }
\DoxyCodeLine{01259\ \textcolor{preprocessor}{\#if\ 0\ \ \ \ }}
\DoxyCodeLine{01260\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{int}\ svc\_init()\ \{}
\DoxyCodeLine{01261\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ff\_oclNode\_t<T>::oclId\ <\ 0)\ \{}
\DoxyCodeLine{01262\ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclNode\_t<T>::oclId\ =\ clEnvironment::instance()-\/>getOCLID();}
\DoxyCodeLine{01263\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01264\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}(ff\_oclNode\_t<T>::getDeviceType())\ \{}
\DoxyCodeLine{01265\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ CL\_DEVICE\_TYPE\_ALL:}
\DoxyCodeLine{01266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{printf_8h_a9f315126362cae9675de1642105e631e}{fprintf}}(stderr,\textcolor{stringliteral}{"{}STATUS:\ requested\ ALL\(\backslash\)n"{}});}
\DoxyCodeLine{01267\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ CL\_DEVICE\_TYPE\_GPU:\ \{\textcolor{comment}{//\ One\ or\ more\ GPUs}}
\DoxyCodeLine{01268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Not\ exclusive}}
\DoxyCodeLine{01269\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Retrive\ logical\ devices}}
\DoxyCodeLine{01270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<ssize\_t>\ logdev\ =\ clEnvironment::instance()-\/>coAllocateGPUDeviceRR(accelerators.size());}
\DoxyCodeLine{01271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Convert\ into\ opencl\ Ids}}
\DoxyCodeLine{01272\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ devices.clear();}
\DoxyCodeLine{01273\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ logdev.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01274\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ devices.push\_back(clEnvironment::instance()-\/>getDevice(logdev[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]));}
\DoxyCodeLine{01275\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (devices.size()\ ==\ 0)\ \{}
\DoxyCodeLine{01276\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacespdlog_ae1d3e9e381047283ac67046df1b6e13c}{error}}(\textcolor{stringliteral}{"{}stencilReduceOCL::svc\_init:not\ enough\ GPUs\ found\ !\(\backslash\)n"{}});}
\DoxyCodeLine{01277\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01278\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ok}}
\DoxyCodeLine{01280\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ devices.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01281\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>\mbox{\hyperlink{boing_8c_a2858154e2009b0e6e616f313177762bc}{init}}(devices[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}],\ kernel\_code,\ kernel\_name1,kernel\_name2);}
\DoxyCodeLine{01282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01283\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01284\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01285\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ CL\_DEVICE\_TYPE\_CPU:\ \{}
\DoxyCodeLine{01286\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (accelerators.size()>1)\ \{}
\DoxyCodeLine{01287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacespdlog_ae1d3e9e381047283ac67046df1b6e13c}{error}}\ (\textcolor{stringliteral}{"{}Multiple\ (>1)\ virtual\ accelerators\ on\ CPU\ are\ requested.\ Not\ yet\ implemented.\(\backslash\)n"{}});}
\DoxyCodeLine{01288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ok}}
\DoxyCodeLine{01291\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ devices.clear();}
\DoxyCodeLine{01292\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ devices.push\_back(clEnvironment::instance()-\/>getDevice(clEnvironment::instance()-\/>getCPUDevice()));}
\DoxyCodeLine{01293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[0]-\/>init(devices[0],\ kernel\_code,\ kernel\_name1,kernel\_name2);}
\DoxyCodeLine{01294\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01295\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01296\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:\ \{}
\DoxyCodeLine{01297\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacespdlog_ae1d3e9e381047283ac67046df1b6e13c}{error}}(\textcolor{stringliteral}{"{}stencilReduceOCL::Other\ device.\ Not\ yet\ implemented.\(\backslash\)n"{}});}
\DoxyCodeLine{01298\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01299\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01300\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01301\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01302\ \ \ \ \ \}}
\DoxyCodeLine{01303\ \textcolor{preprocessor}{\#endif\ }}
\DoxyCodeLine{01304\ }
\DoxyCodeLine{01305\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ svc\_end()\ \{}
\DoxyCodeLine{01306\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classff_1_1ff__node_ad530addcffd6d545b3c520094136e7bd}{ff::ff\_node::isfrozen}}())\ nodeEnd();}
\DoxyCodeLine{01307\ \ \ \ \ \}}
\DoxyCodeLine{01308\ }
\DoxyCodeLine{01309\ \ \ \ \ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ *svc(\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ *\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}})\ \{}
\DoxyCodeLine{01310\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}})\ setTask(*\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}});}
\DoxyCodeLine{01311\ \ \ \ \ \ \ \ \ Tin\ \ \ *inPtr\ \ \ \ \ =\ Task.getInPtr();}
\DoxyCodeLine{01312\ \ \ \ \ \ \ \ \ Tout\ \ *outPtr\ \ \ \ =\ Task.getOutPtr();}
\DoxyCodeLine{01313\ \ \ \ \ \ \ \ \ Tout\ \ *reducePtr\ =\ Task.getReduceVar();}
\DoxyCodeLine{01314\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ envSize\ =\ Task.getEnvNum();\ \textcolor{comment}{//n.\ added\ environments}}
\DoxyCodeLine{01315\ }
\DoxyCodeLine{01316\ \textcolor{preprocessor}{\#if\ defined(FF\_REPARA)}}
\DoxyCodeLine{01317\ \ \ \ \ \ \ \ \ ff\_node::rpr\_sizeIn\ =\ ff\_node::rpr\_sizeOut\ =\ 0;}
\DoxyCodeLine{01318\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01319\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01320\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ the\ computation\ is\ not\ in-\/place\ then\ we\ start\ from\ the\ output\ }}
\DoxyCodeLine{01321\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((\textcolor{keywordtype}{void}*)inPtr\ !=\ (\textcolor{keywordtype}{void}*)outPtr)\ \{}
\DoxyCodeLine{01322\ }
\DoxyCodeLine{01323\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ adjust\ allocator\ output-\/portions\ and\ relocate\ output\ device\ memory\ if\ needed}}
\DoxyCodeLine{01324\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (oldSizeOut\ !=\ Task.getBytesizeOut())\ \{}
\DoxyCodeLine{01325\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ compute\_accmem(Task.getSizeOut(),\ acc\_out);}
\DoxyCodeLine{01326\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01327\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ memorychange\ =\ (oldSizeOut\ <\ Task.getBytesizeOut());}
\DoxyCodeLine{01328\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01329\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{01330\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>adjustOutputBufferOffset(outPtr,\ (memorychange?old\_outPtr:\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}),\ acc\_out[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}],\ Task.getSizeOut());}
\DoxyCodeLine{01331\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01332\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (memorychange)\ \{}
\DoxyCodeLine{01334\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{01335\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>relocateOutputBuffer(outPtr,\ reducePtr);}
\DoxyCodeLine{01336\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01337\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ oldSizeOut\ =\ Task.getBytesizeOut();}
\DoxyCodeLine{01338\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ old\_outPtr\ =\ outPtr;}
\DoxyCodeLine{01339\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01340\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01341\ \ \ \ \ \ \ \ \ \}\ }
\DoxyCodeLine{01342\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ adjust\ allocator\ input-\/portions\ and\ relocate\ input\ device\ memory\ if\ needed}}
\DoxyCodeLine{01343\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (oldBytesizeIn\ !=\ Task.getBytesizeIn())\ \{}
\DoxyCodeLine{01344\ \ \ \ \ \ \ \ \ \ \ \ \ compute\_accmem(Task.getSizeIn(),\ \ acc\_in);}
\DoxyCodeLine{01345\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ memorychange\ =\ (oldBytesizeIn\ <\ Task.getBytesizeIn());}
\DoxyCodeLine{01346\ \ \ \ \ \ \ \ \ \ \ \ \ adjustInputBufferOffset(memorychange);}
\DoxyCodeLine{01347\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (memorychange)\ \{}
\DoxyCodeLine{01348\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{01349\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>relocateInputBuffer(inPtr,\ Task.getReuseIn(),\ reducePtr);}
\DoxyCodeLine{01350\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01351\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ oldBytesizeIn\ =\ Task.getBytesizeIn();}
\DoxyCodeLine{01352\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ old\_inPtr\ =\ inPtr;}
\DoxyCodeLine{01353\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01354\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01355\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01356\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ in-\/place\ computation\ }}
\DoxyCodeLine{01357\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ adjust\ allocator\ output-\/portions\ and\ relocate\ output\ device\ memory\ if\ needed}}
\DoxyCodeLine{01358\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (((\textcolor{keywordtype}{void}*)inPtr\ ==\ (\textcolor{keywordtype}{void}*)outPtr)\ \&\&\ (\ oldSizeOut\ !=\ Task.getBytesizeOut()))\ \{}
\DoxyCodeLine{01359\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{01360\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>setInPlace(reducePtr);}
\DoxyCodeLine{01361\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01362\ \ \ \ \ \ \ \ \ \}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01363\ }
\DoxyCodeLine{01364\ \ \ \ \ \ \ \ \ \textcolor{comment}{//relocate\ env\ device\ memory}}
\DoxyCodeLine{01365\ \ \ \ \ \ \ \ \ \textcolor{comment}{//TODO\ on-\/demand\ relocate,\ as\ for\ input/output\ memory}}
\DoxyCodeLine{01366\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ NOTE:\ env\ buffer\ are\ replicated\ on\ all\ devices.}}
\DoxyCodeLine{01367\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ \ \ \ \ \ \ It\ would\ be\ nice\ to\ have\ replicated/partitioned\ polices}}
\DoxyCodeLine{01368\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{01369\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01370\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ k=0;\ k\ <\ envSize;\ ++k)\ \{}
\DoxyCodeLine{01371\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ *envptr;}
\DoxyCodeLine{01372\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Task.getEnvPtr(k,\ envptr);}
\DoxyCodeLine{01373\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>relocateEnvBuffer(envptr,\ Task.getReuseEnv(k),\ k,\ Task.getBytesizeEnv(k));}
\DoxyCodeLine{01374\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \ \ \ \ \ \ \ }
\DoxyCodeLine{01375\ }
\DoxyCodeLine{01376\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!isPureReduce())\ \ \textcolor{comment}{//set\ kernel\ args}}
\DoxyCodeLine{01377\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01378\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>setMapKernelArgs(envSize);}
\DoxyCodeLine{01379\ }
\DoxyCodeLine{01380\ \ \ \ \ \ \ \ \ \textcolor{comment}{//(async)\ copy\ input\ and\ environments\ (h2d)}}
\DoxyCodeLine{01381\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{01382\ }
\DoxyCodeLine{01383\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (Task.getCopyIn())\ \{}
\DoxyCodeLine{01384\ \textcolor{preprocessor}{\#if\ defined(FF\_REPARA)}}
\DoxyCodeLine{01385\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_node::rpr\_sizeIn\ +=\ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>asyncH2Dinput(Task.getInPtr());\ \ \textcolor{comment}{//in}}
\DoxyCodeLine{01386\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{01387\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>asyncH2Dinput(Task.getInPtr());\ \ \textcolor{comment}{//in}}
\DoxyCodeLine{01388\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01389\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01390\ }
\DoxyCodeLine{01391\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ k=0;\ k\ <\ envSize;\ ++k)\ \{}
\DoxyCodeLine{01392\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (Task.getCopyEnv(k))\ \{}
\DoxyCodeLine{01393\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ *envptr;}
\DoxyCodeLine{01394\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Task.getEnvPtr(k,\ envptr);\ \ \ \ }
\DoxyCodeLine{01395\ \textcolor{preprocessor}{\#if\ defined(FF\_REPARA)}}
\DoxyCodeLine{01396\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_node::rpr\_sizeIn\ +=\ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>asyncH2Denv(k,\ envptr);}
\DoxyCodeLine{01397\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{01398\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>asyncH2Denv(k,\ envptr);}
\DoxyCodeLine{01399\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01400\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01401\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01402\ \ \ \ \ \ \ \ \ \}\ }
\DoxyCodeLine{01403\ }
\DoxyCodeLine{01404\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isPureReduce())\ \{}
\DoxyCodeLine{01405\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//init\ reduce}}
\DoxyCodeLine{01406\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01407\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>initReduce();}
\DoxyCodeLine{01408\ }
\DoxyCodeLine{01409\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//wait\ for\ cross-\/accelerator\ h2d}}
\DoxyCodeLine{01410\ \ \ \ \ \ \ \ \ \ \ \ \ waitforh2d();}
\DoxyCodeLine{01411\ }
\DoxyCodeLine{01412\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//(async)\ device-\/reduce1}}
\DoxyCodeLine{01413\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01414\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>asyncExecReduceKernel1();}
\DoxyCodeLine{01415\ }
\DoxyCodeLine{01416\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//(async)\ device-\/reduce2}}
\DoxyCodeLine{01417\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01418\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>asyncExecReduceKernel2();}
\DoxyCodeLine{01419\ }
\DoxyCodeLine{01420\ \ \ \ \ \ \ \ \ \ \ \ \ waitforreduce();\ \textcolor{comment}{//wait\ for\ cross-\/accelerator\ reduce}}
\DoxyCodeLine{01421\ }
\DoxyCodeLine{01422\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//host-\/reduce}}
\DoxyCodeLine{01423\ \ \ \ \ \ \ \ \ \ \ \ \ Tout\ redVar\ =\ accelerators[0]-\/>getReduceVar();}
\DoxyCodeLine{01424\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 1;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01425\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ redVar\ =\ Task.combinator(redVar,\ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>getReduceVar());}
\DoxyCodeLine{01426\ \ \ \ \ \ \ \ \ \ \ \ \ Task.writeReduceVar(redVar);}
\DoxyCodeLine{01427\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01428\ \ \ \ \ \ \ \ \ \ \ \ \ Task.resetIter();}
\DoxyCodeLine{01429\ }
\DoxyCodeLine{01430\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isPureMap())\ \{}
\DoxyCodeLine{01431\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//wait\ for\ cross-\/accelerator\ h2d}}
\DoxyCodeLine{01432\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ waitforh2d();}
\DoxyCodeLine{01433\ }
\DoxyCodeLine{01434\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//(async)\ exec\ kernel}}
\DoxyCodeLine{01435\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01436\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>asyncExecMapKernel();}
\DoxyCodeLine{01437\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Task.incIter();}
\DoxyCodeLine{01438\ }
\DoxyCodeLine{01439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ waitformap();\ \textcolor{comment}{//join}}
\DoxyCodeLine{01440\ }
\DoxyCodeLine{01441\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//iterative\ Map-\/Reduce\ (aka\ stencilReduceLoop)}}
\DoxyCodeLine{01442\ }
\DoxyCodeLine{01443\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//invalidate\ first\ swap}}
\DoxyCodeLine{01444\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>\mbox{\hyperlink{level1__impl_8h_a2e2212d2e55ad7479d212e08b2eb0345}{swap}}();}
\DoxyCodeLine{01445\ }
\DoxyCodeLine{01446\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{test__malloc__shutdown__hang_8cpp_aa3ebbaf71a0eaeb5a0baab9ead649b01}{go}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01447\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{01448\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Task.before();}}
\DoxyCodeLine{01449\ }
\DoxyCodeLine{01450\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>\mbox{\hyperlink{level1__impl_8h_a2e2212d2e55ad7479d212e08b2eb0345}{swap}}();}
\DoxyCodeLine{01451\ }
\DoxyCodeLine{01452\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//wait\ for\ cross-\/accelerator\ h2d}}
\DoxyCodeLine{01453\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ waitforh2d();}
\DoxyCodeLine{01454\ }
\DoxyCodeLine{01455\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//(async)\ execute\ MAP\ kernel}}
\DoxyCodeLine{01456\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01457\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>asyncExecMapKernel();}
\DoxyCodeLine{01458\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Task.incIter();}
\DoxyCodeLine{01459\ }
\DoxyCodeLine{01460\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//start\ async-\/interleaved:\ reduce\ +\ borders\ sync}}
\DoxyCodeLine{01461\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//init\ reduce}}
\DoxyCodeLine{01462\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01463\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>initReduce();}
\DoxyCodeLine{01464\ }
\DoxyCodeLine{01465\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//(async)\ device-\/reduce1}}
\DoxyCodeLine{01466\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01467\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>asyncExecReduceKernel1();}
\DoxyCodeLine{01468\ }
\DoxyCodeLine{01469\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//(async)\ device-\/reduce2}}
\DoxyCodeLine{01470\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01471\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>asyncExecReduceKernel2();}
\DoxyCodeLine{01472\ }
\DoxyCodeLine{01473\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//wait\ for\ cross-\/accelerators\ reduce}}
\DoxyCodeLine{01474\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ waitforreduce();}
\DoxyCodeLine{01475\ }
\DoxyCodeLine{01476\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//host-\/reduce}}
\DoxyCodeLine{01477\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Tout\ redVar\ =\ accelerators[0]-\/>getReduceVar();}
\DoxyCodeLine{01478\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 1;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ }
\DoxyCodeLine{01479\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ redVar\ =\ Task.combinator(redVar,\ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>getReduceVar());}
\DoxyCodeLine{01480\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Task.writeReduceVar(redVar);}
\DoxyCodeLine{01481\ }
\DoxyCodeLine{01482\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__malloc__shutdown__hang_8cpp_aa3ebbaf71a0eaeb5a0baab9ead649b01}{go}}\ =\ Task.iterCondition\_aux();}
\DoxyCodeLine{01483\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{test__malloc__shutdown__hang_8cpp_aa3ebbaf71a0eaeb5a0baab9ead649b01}{go}})\ \{}
\DoxyCodeLine{01484\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ assert(outPtr);}
\DoxyCodeLine{01485\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//(async)\ read\ back\ borders\ (d2h)}}
\DoxyCodeLine{01486\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01487\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>asyncD2Hborders(outPtr);}
\DoxyCodeLine{01488\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ waitford2h();\ \textcolor{comment}{//wait\ for\ cross-\/accelerators\ d2h}}
\DoxyCodeLine{01489\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//(async)\ read\ borders\ (h2d)}}
\DoxyCodeLine{01490\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01491\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>asyncH2Dborders(outPtr);}
\DoxyCodeLine{01492\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01493\ }
\DoxyCodeLine{01494\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//Task.after();}}
\DoxyCodeLine{01495\ }
\DoxyCodeLine{01496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{test__malloc__shutdown__hang_8cpp_aa3ebbaf71a0eaeb5a0baab9ead649b01}{go}});}
\DoxyCodeLine{01497\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01498\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{01499\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//(async)read\ back\ output\ (d2h)}}
\DoxyCodeLine{01500\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (outPtr\ \&\&\ Task.getCopyOut())\ \{\ \textcolor{comment}{//\ do\ we\ have\ to\ copy\ back\ the\ output\ result\ ?}}
\DoxyCodeLine{01501\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{01502\ \textcolor{preprocessor}{\#if\ defined(FF\_REPARA)}}
\DoxyCodeLine{01503\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_node::rpr\_sizeOut\ +=\ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>asyncD2Houtput(outPtr);}
\DoxyCodeLine{01504\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{01505\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>asyncD2Houtput(outPtr);}
\DoxyCodeLine{01506\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01507\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01508\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ waitford2h();\ \textcolor{comment}{//wait\ for\ cross-\/accelerators\ d2h}}
\DoxyCodeLine{01509\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01510\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01511\ }
\DoxyCodeLine{01512\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ device\ memory\ cleanup\ phase}}
\DoxyCodeLine{01513\ }
\DoxyCodeLine{01514\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (Task.getReleaseIn()\ \&\&\ (\textcolor{keywordtype}{void}\ *)outPtr\ !=\ (\textcolor{keywordtype}{void}\ *)inPtr)\ \{}
\DoxyCodeLine{01515\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ }
\DoxyCodeLine{01516\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>releaseInput(inPtr);}
\DoxyCodeLine{01517\ \ \ \ \ \ \ \ \ \ \ \ \ oldBytesizeIn\ =\ 0;}
\DoxyCodeLine{01518\ \ \ \ \ \ \ \ \ \ \ \ \ old\_inPtr\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01519\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01520\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ Task.getReleaseOut()\ )\ \{}
\DoxyCodeLine{01521\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ }
\DoxyCodeLine{01522\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>releaseOutput(outPtr);}
\DoxyCodeLine{01523\ \ \ \ \ \ \ \ \ \ \ \ \ oldSizeOut\ =\ 0;}
\DoxyCodeLine{01524\ \ \ \ \ \ \ \ \ \ \ \ \ old\_outPtr\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{01525\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01526\ }
\DoxyCodeLine{01527\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ k=0;\ k\ <\ envSize;\ ++k)\ \{}
\DoxyCodeLine{01528\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (Task.getReleaseEnv(k))\ \{}
\DoxyCodeLine{01529\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ *envptr;}
\DoxyCodeLine{01530\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Task.getEnvPtr(k,\ envptr);}
\DoxyCodeLine{01531\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((\textcolor{keywordtype}{void}*)envptr\ !=\ (\textcolor{keywordtype}{void}*)outPtr)\ \{\ }
\DoxyCodeLine{01532\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{01533\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>releaseEnv(k,envptr);}
\DoxyCodeLine{01534\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01535\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01536\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01537\ }
\DoxyCodeLine{01538\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ management\ of\ oldEnvPtr\ !!}}
\DoxyCodeLine{01539\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ currently\ the\ size\ of\ the\ envbuffer\ should\ be\ always\ the\ same\ !}}
\DoxyCodeLine{01540\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01541\ }
\DoxyCodeLine{01542\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ per\ task\ memory\ cleanup\ phase}}
\DoxyCodeLine{01543\ \ \ \ \ \ \ \ \ Task.releaseTask(\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}});}
\DoxyCodeLine{01544\ }
\DoxyCodeLine{01545\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (oneshot\ ?\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ :\ \mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}});}
\DoxyCodeLine{01546\ \ \ \ \ \}}
\DoxyCodeLine{01547\ }
\DoxyCodeLine{01548\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{01549\ \ \ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ adjustInputBufferOffset(\textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ memorychange)\ \{}
\DoxyCodeLine{01550\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01551\ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>adjustInputBufferOffset(Task.getInPtr(),}
\DoxyCodeLine{01552\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (memorychange\ ?\ old\_inPtr\ :\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}),\ acc\_in[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}],}
\DoxyCodeLine{01553\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Task.getSizeIn());}
\DoxyCodeLine{01554\ \ \ \ \ \}}
\DoxyCodeLine{01555\ }
\DoxyCodeLine{01556\ \ \ \ \ \textcolor{keywordtype}{void}\ setcode(\textcolor{keyword}{const}\ std::string\ \&codestr1,\ \textcolor{keyword}{const}\ std::string\ \&codestr2)\ \{}
\DoxyCodeLine{01557\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ =\ 0;}
\DoxyCodeLine{01558\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (codestr1\ !=\ \textcolor{stringliteral}{"{}"{}})\ \{}
\DoxyCodeLine{01559\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ =\ codestr1.find\_first\_of(\textcolor{stringliteral}{"{}|"{}});}
\DoxyCodeLine{01560\ \ \ \ \ \ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ >\ 0);}
\DoxyCodeLine{01561\ \ \ \ \ \ \ \ \ \ \ \ \ kernel\_name1\ =\ codestr1.substr(0,\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}});}
\DoxyCodeLine{01562\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&tmpstr\ =\ codestr1.substr(\mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ +\ 1);}
\DoxyCodeLine{01563\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ =\ tmpstr.find\_first\_of(\textcolor{stringliteral}{"{}|"{}});}
\DoxyCodeLine{01564\ \ \ \ \ \ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ >\ 0);}
\DoxyCodeLine{01565\ }
\DoxyCodeLine{01566\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ checking\ for\ double\ type}}
\DoxyCodeLine{01567\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tmpstr.substr(0,\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}})\ ==\ \textcolor{stringliteral}{"{}double"{}})\ \{}
\DoxyCodeLine{01568\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ kernel\_code\ =\ \textcolor{stringliteral}{"{}\(\backslash\)n\#pragma\ OPENCL\ EXTENSION\ cl\_khr\_fp64:\ enable\(\backslash\)n\(\backslash\)n"{}}}
\DoxyCodeLine{01569\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +\ tmpstr.substr(\mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ +\ 1);}
\DoxyCodeLine{01570\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01571\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ kernel\_code\ =\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}\ +\ tmpstr.substr(\mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ +\ 1);}
\DoxyCodeLine{01572\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01573\ }
\DoxyCodeLine{01574\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ checking\ for\ extra\ code\ needed\ to\ compile\ the\ kernels}}
\DoxyCodeLine{01575\ \ \ \ \ \ \ \ \ std::ifstream\ ifs(\mbox{\hyperlink{config_8hpp_a5b027877746582f1f753ce974af31ace}{FF\_OPENCL\_DATATYPES\_FILE}});}
\DoxyCodeLine{01576\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ifs.is\_open())}
\DoxyCodeLine{01577\ \ \ \ \ \ \ \ \ \ \ \ \ kernel\_code.insert(kernel\_code.begin(),\ std::istreambuf\_iterator<char>(ifs),}
\DoxyCodeLine{01578\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::istreambuf\_iterator<char>());}
\DoxyCodeLine{01579\ }
\DoxyCodeLine{01580\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (codestr2\ !=\ \textcolor{stringliteral}{"{}"{}})\ \{}
\DoxyCodeLine{01581\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ =\ codestr2.find(\textcolor{stringliteral}{"{}|"{}});}
\DoxyCodeLine{01582\ \ \ \ \ \ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ >\ 0);}
\DoxyCodeLine{01583\ \ \ \ \ \ \ \ \ \ \ \ \ kernel\_name2\ +=\ codestr2.substr(0,\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}});}
\DoxyCodeLine{01584\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&tmpstr\ =\ codestr2.substr(\mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ +\ 1);}
\DoxyCodeLine{01585\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ =\ tmpstr.find(\textcolor{stringliteral}{"{}|"{}});}
\DoxyCodeLine{01586\ \ \ \ \ \ \ \ \ \ \ \ \ assert(\mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ >\ 0);}
\DoxyCodeLine{01587\ }
\DoxyCodeLine{01588\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ checking\ for\ double\ type}}
\DoxyCodeLine{01589\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tmpstr.substr(0,\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}})\ ==\ \textcolor{stringliteral}{"{}double"{}})\ \{}
\DoxyCodeLine{01590\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ kernel\_code\ +=\ \textcolor{stringliteral}{"{}\#pragma\ OPENCL\ EXTENSION\ cl\_khr\_fp64:\ enable\(\backslash\)n"{}}}
\DoxyCodeLine{01591\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +\ tmpstr.substr(\mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ +\ 1);}
\DoxyCodeLine{01592\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01593\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ kernel\_code\ +=\ tmpstr.substr(\mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ +\ 1);}
\DoxyCodeLine{01594\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01595\ \ \ \ \ \}}
\DoxyCodeLine{01596\ }
\DoxyCodeLine{01597\ \ \ \ \ \textcolor{keywordtype}{void}\ setsourcecode(\textcolor{keyword}{const}\ std::string\ \&source,\ \textcolor{keyword}{const}\ std::string\ \&kernel1,\ \textcolor{keyword}{const}\ std::string\ \&kernel2)\ \{\ \ \ \ \ }
\DoxyCodeLine{01598\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (kernel1\ !=\ \textcolor{stringliteral}{"{}"{}})\ kernel\_name1\ =\ \textcolor{stringliteral}{"{}kern\_"{}}+kernel1;}
\DoxyCodeLine{01599\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (kernel2\ !=\ \textcolor{stringliteral}{"{}"{}})\ kernel\_name2\ =\ \textcolor{stringliteral}{"{}kern\_"{}}+kernel2;}
\DoxyCodeLine{01600\ \ \ \ \ \ \ \ \ kernel\_code\ \ =\ source;}
\DoxyCodeLine{01601\ \ \ \ \ \}}
\DoxyCodeLine{01602\ }
\DoxyCodeLine{01603\ \ \ \ \ \textcolor{comment}{//assign\ input\ partition\ to\ accelerators}}
\DoxyCodeLine{01604\ \ \ \ \ \textcolor{comment}{//acc[i]\ =\ (start,\ size)\ where:}}
\DoxyCodeLine{01605\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ -\/\ start\ is\ the\ first\ element\ assigned\ to\ accelerator\ i}}
\DoxyCodeLine{01606\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ -\/\ size\ is\ the\ number\ of\ elements\ assigned\ to\ accelerator\ i}}
\DoxyCodeLine{01607\ \ \ \ \ \textcolor{keywordtype}{void}\ compute\_accmem(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{yyjson_8h_ac16e956eac9f5c3180afa8e80d4f098c}{len}},\ std::vector<std::pair<size\_t,size\_t>\ >\ \&acc)\ \{}
\DoxyCodeLine{01608\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{cpq__pdes_8cpp_a455a4d1d80a69762a133ad026f1cba43}{start}}\ =\ 0,\ \mbox{\hyperlink{namespaceluisa_1_1compute_1_1dsl_a8af85ff0ba544ac84f4b42b0333f5d14}{step}}\ =\ (\mbox{\hyperlink{yyjson_8h_ac16e956eac9f5c3180afa8e80d4f098c}{len}}\ +\ accelerators.size()\ -\/\ 1)\ /\ accelerators.size();}
\DoxyCodeLine{01609\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;}
\DoxyCodeLine{01610\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size()\ -\/\ 1;\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{01611\ \ \ \ \ \ \ \ \ \ \ \ \ acc[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]=std::make\_pair(\mbox{\hyperlink{cpq__pdes_8cpp_a455a4d1d80a69762a133ad026f1cba43}{start}},\ step);}
\DoxyCodeLine{01612\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{cpq__pdes_8cpp_a455a4d1d80a69762a133ad026f1cba43}{start}}\ +=\ \mbox{\hyperlink{namespaceluisa_1_1compute_1_1dsl_a8af85ff0ba544ac84f4b42b0333f5d14}{step}};}
\DoxyCodeLine{01613\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01614\ \ \ \ \ \ \ \ \ acc[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]=std::make\_pair(\mbox{\hyperlink{cpq__pdes_8cpp_a455a4d1d80a69762a133ad026f1cba43}{start}},\ \mbox{\hyperlink{yyjson_8h_ac16e956eac9f5c3180afa8e80d4f098c}{len}}-\/\mbox{\hyperlink{cpq__pdes_8cpp_a455a4d1d80a69762a133ad026f1cba43}{start}});}
\DoxyCodeLine{01615\ \ \ \ \ \}}
\DoxyCodeLine{01616\ }
\DoxyCodeLine{01617\ \ \ \ \ \textcolor{keywordtype}{void}\ waitforh2d()\ \{}
\DoxyCodeLine{01618\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01619\ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>waitforh2d();}
\DoxyCodeLine{01620\ \ \ \ \ \}}
\DoxyCodeLine{01621\ }
\DoxyCodeLine{01622\ \ \ \ \ \textcolor{keywordtype}{void}\ waitford2h()\ \{}
\DoxyCodeLine{01623\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01624\ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>waitford2h();}
\DoxyCodeLine{01625\ \ \ \ \ \}}
\DoxyCodeLine{01626\ }
\DoxyCodeLine{01627\ \ \ \ \ \textcolor{keywordtype}{void}\ waitforreduce()\ \{}
\DoxyCodeLine{01628\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01629\ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>waitforreduce();}
\DoxyCodeLine{01630\ \ \ \ \ \}}
\DoxyCodeLine{01631\ }
\DoxyCodeLine{01632\ \ \ \ \ \textcolor{keywordtype}{void}\ waitformap()\ \{}
\DoxyCodeLine{01633\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})}
\DoxyCodeLine{01634\ \ \ \ \ \ \ \ \ \ \ \ \ accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>waitformap();}
\DoxyCodeLine{01635\ \ \ \ \ \}}
\DoxyCodeLine{01636\ }
\DoxyCodeLine{01637\ \ \ \ \ TOCL\ Task;}
\DoxyCodeLine{01638\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ oneshot;}
\DoxyCodeLine{01639\ \ \ \ \ \textcolor{keywordtype}{bool}\ saveBinary,\ reuseBinary;\ \ \ \ }
\DoxyCodeLine{01640\ \ \ \ \ std::vector<accelerator\_t*>\ accelerators;}
\DoxyCodeLine{01641\ \ \ \ \ std::vector<std::pair<size\_t,\ size\_t>\ >\ acc\_in;}
\DoxyCodeLine{01642\ \ \ \ \ std::vector<std::pair<size\_t,\ size\_t>\ >\ acc\_out;}
\DoxyCodeLine{01643\ \ \ \ \ std::vector<cl\_device\_id>\ devices;}
\DoxyCodeLine{01644\ \ \ \ \ \textcolor{keywordtype}{int}\ stencil\_width\_half;}
\DoxyCodeLine{01645\ \ \ \ \ \textcolor{comment}{//size\_t\ preferred\_dev;}}
\DoxyCodeLine{01646\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ offset\_dev;}
\DoxyCodeLine{01647\ }
\DoxyCodeLine{01648\ \ \ \ \ std::string\ kernel\_code;}
\DoxyCodeLine{01649\ \ \ \ \ std::string\ kernel\_name1;}
\DoxyCodeLine{01650\ \ \ \ \ std::string\ kernel\_name2;}
\DoxyCodeLine{01651\ }
\DoxyCodeLine{01652\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ forced\_cpu;}
\DoxyCodeLine{01653\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ forced\_gpu;}
\DoxyCodeLine{01654\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ forced\_other;}
\DoxyCodeLine{01655\ \ \ \ \ }
\DoxyCodeLine{01656\ \ \ \ \ Tin\ \ \ *old\_inPtr;}
\DoxyCodeLine{01657\ \ \ \ \ Tout\ \ *old\_outPtr;}
\DoxyCodeLine{01658\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ oldBytesizeIn,\ oldSizeOut,\ oldSizeReduce;}
\DoxyCodeLine{01659\ \};}
\DoxyCodeLine{01660\ }
\DoxyCodeLine{01661\ }
\DoxyCodeLine{01662\ }
\DoxyCodeLine{01672\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ TOCL\ =\ T>}
\DoxyCodeLine{01673\ \textcolor{keyword}{class\ }ff\_mapOCL\_1D:\ \textcolor{keyword}{public}\ ff\_stencilReduceLoopOCL\_1D<T,\ TOCL>\ \{}
\DoxyCodeLine{01674\ \textcolor{keyword}{public}:}
\DoxyCodeLine{01675\ \ \ \ \ ff\_mapOCL\_1D(std::string\ mapf,\ ff\_oclallocator\ *alloc=\textcolor{keyword}{nullptr},}
\DoxyCodeLine{01676\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1)\ :}
\DoxyCodeLine{01677\ \ \ \ \ \ \ \ \ ff\_stencilReduceLoopOCL\_1D<\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ TOCL>(mapf,\ \textcolor{stringliteral}{"{}"{}},\ 0,\ alloc,\ NACCELERATORS,\ 0)\ \{}
\DoxyCodeLine{01678\ \ \ \ \ \}}
\DoxyCodeLine{01679\ }
\DoxyCodeLine{01680\ \ \ \ \ ff\_mapOCL\_1D(\textcolor{keyword}{const}\ std::string\ \&kernels\_source,\ \textcolor{keyword}{const}\ std::string\ \&mapf\_name,\ }
\DoxyCodeLine{01681\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *alloc=\textcolor{keyword}{nullptr},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1)\ :}
\DoxyCodeLine{01682\ \ \ \ \ \ \ \ \ ff\_stencilReduceLoopOCL\_1D<\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ TOCL>(kernels\_source,\ mapf\_name,\ \textcolor{stringliteral}{"{}"{}},\ 0,\ alloc,\ NACCELERATORS,\ 0)\ \{}
\DoxyCodeLine{01683\ \ \ \ \ \}}
\DoxyCodeLine{01684\ \ \ \ \ }
\DoxyCodeLine{01685\ }
\DoxyCodeLine{01686\ \ \ \ \ ff\_mapOCL\_1D(\textcolor{keyword}{const}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \&\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},\ std::string\ mapf,\ }
\DoxyCodeLine{01687\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *alloc=\textcolor{keyword}{nullptr},}
\DoxyCodeLine{01688\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1)\ :}
\DoxyCodeLine{01689\ \ \ \ \ \ \ \ \ ff\_stencilReduceLoopOCL\_1D<\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ TOCL>(\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},\ mapf,\ \textcolor{stringliteral}{"{}"{}},\ 0,\ alloc,\ NACCELERATORS,\ 0)\ \{}
\DoxyCodeLine{01690\ \ \ \ \ \}}
\DoxyCodeLine{01691\ \ \ \ \ ff\_mapOCL\_1D(\textcolor{keyword}{const}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \&\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},\ \textcolor{keyword}{const}\ std::string\ \&kernels\_source,\ \textcolor{keyword}{const}\ std::string\ \&mapf\_name,\ }
\DoxyCodeLine{01692\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *alloc=\textcolor{keyword}{nullptr},}
\DoxyCodeLine{01693\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1)\ :}
\DoxyCodeLine{01694\ \ \ \ \ \ \ \ \ ff\_stencilReduceLoopOCL\_1D<\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ TOCL>(\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},\ kernels\_source,\ mapf\_name,\ \textcolor{stringliteral}{"{}"{}},\ 0,\ alloc,\ NACCELERATORS,\ 0)\ \{}
\DoxyCodeLine{01695\ \ \ \ \ \}}
\DoxyCodeLine{01696\ }
\DoxyCodeLine{01697\ \ \ \ \ \textcolor{keywordtype}{bool}\ isPureMap()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};\ \}}
\DoxyCodeLine{01698\ \};}
\DoxyCodeLine{01699\ }
\DoxyCodeLine{01710\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ TOCL\ =\ T>}
\DoxyCodeLine{01711\ \textcolor{keyword}{class\ }ff\_reduceOCL\_1D:\ \textcolor{keyword}{public}\ ff\_stencilReduceLoopOCL\_1D<T,\ TOCL>\ \{}
\DoxyCodeLine{01712\ \textcolor{keyword}{public}:}
\DoxyCodeLine{01713\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ TOCL::Tin\ \ Tin;}
\DoxyCodeLine{01714\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ TOCL::Tout\ Tout;}
\DoxyCodeLine{01715\ }
\DoxyCodeLine{01716\ \ \ \ \ ff\_reduceOCL\_1D(std::string\ reducef,\ \textcolor{keyword}{const}\ Tout\ \&identityVal\ =\ Tout(),}
\DoxyCodeLine{01717\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *alloc=\textcolor{keyword}{nullptr},}
\DoxyCodeLine{01718\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1)\ :}
\DoxyCodeLine{01719\ \ \ \ \ \ \ \ \ ff\_stencilReduceLoopOCL\_1D<\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ TOCL>(\textcolor{stringliteral}{"{}"{}},\ reducef,\ identityVal,\ alloc,\ NACCELERATORS,\ 0)\ \{}
\DoxyCodeLine{01720\ \ \ \ \ \}}
\DoxyCodeLine{01721\ \ \ \ \ ff\_reduceOCL\_1D(\textcolor{keyword}{const}\ std::string\ \&kernels\_source,\ \textcolor{keyword}{const}\ std::string\ \&reducef\_name,\ \textcolor{keyword}{const}\ Tout\ \&identityVal\ =\ Tout(),}
\DoxyCodeLine{01722\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *alloc=\textcolor{keyword}{nullptr},}
\DoxyCodeLine{01723\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1)\ :}
\DoxyCodeLine{01724\ \ \ \ \ \ \ \ \ ff\_stencilReduceLoopOCL\_1D<\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ TOCL>(kernels\_source,\ \textcolor{stringliteral}{"{}"{}},\ reducef\_name,\ identityVal,\ alloc,\ NACCELERATORS,\ 0)\ \{}
\DoxyCodeLine{01725\ \ \ \ \ \}}
\DoxyCodeLine{01726\ }
\DoxyCodeLine{01727\ \ \ \ \ ff\_reduceOCL\_1D(\textcolor{keyword}{const}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \&\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},\ std::string\ reducef,\ \textcolor{keyword}{const}\ Tout\ identityVal\ =\ Tout(),}
\DoxyCodeLine{01728\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *alloc=\textcolor{keyword}{nullptr},}
\DoxyCodeLine{01729\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1)\ :}
\DoxyCodeLine{01730\ \ \ \ \ \ \ \ \ ff\_stencilReduceLoopOCL\_1D<\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ TOCL>(\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},\ \textcolor{stringliteral}{"{}"{}},\ reducef,\ identityVal,\ alloc,\ NACCELERATORS,\ 0)\ \{}
\DoxyCodeLine{01731\ \ \ \ \ \}}
\DoxyCodeLine{01732\ \ \ \ \ ff\_reduceOCL\_1D(\textcolor{keyword}{const}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \&\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},\ \textcolor{keyword}{const}\ std::string\ \&kernels\_source,\textcolor{keyword}{const}\ std::string\ \&reducef\_name,\ }
\DoxyCodeLine{01733\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Tout\ identityVal\ =\ Tout(),}
\DoxyCodeLine{01734\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *alloc=\textcolor{keyword}{nullptr},}
\DoxyCodeLine{01735\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1)\ :}
\DoxyCodeLine{01736\ \ \ \ \ \ \ \ \ ff\_stencilReduceLoopOCL\_1D<\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ TOCL>(\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},\ kernels\_source,\ \textcolor{stringliteral}{"{}"{}},\ reducef\_name,\ identityVal,\ alloc,\ NACCELERATORS,\ 0)\ \{}
\DoxyCodeLine{01737\ \ \ \ \ \}}
\DoxyCodeLine{01738\ \ \ \ \ \textcolor{keywordtype}{bool}\ isPureReduce()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};\ \}}
\DoxyCodeLine{01739\ \};}
\DoxyCodeLine{01740\ }
\DoxyCodeLine{01741\ \textcolor{comment}{/*}}
\DoxyCodeLine{01742\ \textcolor{comment}{\ *\ \(\backslash\)class\ f\_mapReduceOCL\_1D}}
\DoxyCodeLine{01743\ \textcolor{comment}{\ *\ \ \(\backslash\)ingroup\ high\_level\_patterns}}
\DoxyCodeLine{01744\ \textcolor{comment}{\ *}}
\DoxyCodeLine{01745\ \textcolor{comment}{\ *\ \(\backslash\)brief\ The\ mapReduce\ skeleton.}}
\DoxyCodeLine{01746\ \textcolor{comment}{\ *}}
\DoxyCodeLine{01747\ \textcolor{comment}{\ *\ The\ mapReuce\ skeleton\ using\ OpenCL}}
\DoxyCodeLine{01748\ \textcolor{comment}{\ *}}
\DoxyCodeLine{01749\ \textcolor{comment}{\ *\ This\ class\ is\ defined\ in\ \(\backslash\)ref\ map.hpp}}
\DoxyCodeLine{01750\ \textcolor{comment}{\ *}}
\DoxyCodeLine{01751\ \textcolor{comment}{\ */}}
\DoxyCodeLine{01752\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ TOCL\ =\ T>}
\DoxyCodeLine{01753\ \textcolor{keyword}{class\ }ff\_mapReduceOCL\_1D:\ \textcolor{keyword}{public}\ ff\_stencilReduceLoopOCL\_1D<T,\ TOCL>\ \{}
\DoxyCodeLine{01754\ \textcolor{keyword}{public}:}
\DoxyCodeLine{01755\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ TOCL::Tin\ \ Tin;}
\DoxyCodeLine{01756\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ TOCL::Tout\ Tout;}
\DoxyCodeLine{01757\ }
\DoxyCodeLine{01758\ \ \ \ \ ff\_mapReduceOCL\_1D(std::string\ mapf,\ std::string\ reducef,\ \textcolor{keyword}{const}\ Tout\ \&identityVal\ =\ Tout(),}
\DoxyCodeLine{01759\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *alloc=\textcolor{keyword}{nullptr},}
\DoxyCodeLine{01760\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1)\ :}
\DoxyCodeLine{01761\ \ \ \ \ \ \ \ \ ff\_stencilReduceLoopOCL\_1D<\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ TOCL>(mapf,\ reducef,\ identityVal,\ alloc,\ NACCELERATORS,\ 0)\ \{}
\DoxyCodeLine{01762\ \ \ \ \ \}}
\DoxyCodeLine{01763\ }
\DoxyCodeLine{01764\ \ \ \ \ ff\_mapReduceOCL\_1D(\textcolor{keyword}{const}\ std::string\ \&kernels\_code,\ \textcolor{keyword}{const}\ std::string\ \&mapf\_name,\ }
\DoxyCodeLine{01765\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&reducef\_name,\ \textcolor{keyword}{const}\ Tout\ \&identityVal\ =\ Tout(),}
\DoxyCodeLine{01766\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *alloc=\textcolor{keyword}{nullptr},}
\DoxyCodeLine{01767\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1)\ :}
\DoxyCodeLine{01768\ \ \ \ \ \ \ \ \ ff\_stencilReduceLoopOCL\_1D<\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ TOCL>(kernels\_code,\ mapf\_name,\ reducef\_name,\ identityVal,\ alloc,\ NACCELERATORS,\ 0)\ \{}
\DoxyCodeLine{01769\ \ \ \ \ \}}
\DoxyCodeLine{01770\ }
\DoxyCodeLine{01771\ }
\DoxyCodeLine{01772\ \ \ \ \ ff\_mapReduceOCL\_1D(\textcolor{keyword}{const}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \&\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},\ std::string\ mapf,\ std::string\ reducef,}
\DoxyCodeLine{01773\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Tout\ \&identityVal\ =\ Tout(),\ }
\DoxyCodeLine{01774\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *alloc=\textcolor{keyword}{nullptr},}
\DoxyCodeLine{01775\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1)\ :}
\DoxyCodeLine{01776\ \ \ \ \ \ \ \ \ ff\_stencilReduceLoopOCL\_1D<\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ TOCL>(\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},\ mapf,\ reducef,\ identityVal,\ alloc,\ NACCELERATORS,\ 0)\ \{}
\DoxyCodeLine{01777\ \ \ \ \ \}}
\DoxyCodeLine{01778\ \ \ \ \ ff\_mapReduceOCL\_1D(\textcolor{keyword}{const}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \&\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},\ \textcolor{keyword}{const}\ std::string\ \&kernels\_code,\ \textcolor{keyword}{const}\ std::string\ \&mapf\_name,\ }
\DoxyCodeLine{01779\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&reducef\_name,\ \textcolor{keyword}{const}\ Tout\ \&identityVal\ =\ Tout(),\ }
\DoxyCodeLine{01780\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *alloc=\textcolor{keyword}{nullptr},}
\DoxyCodeLine{01781\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1)\ :}
\DoxyCodeLine{01782\ \ \ \ \ \ \ \ \ ff\_stencilReduceLoopOCL\_1D<\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ TOCL>(\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},\ kernels\_code,\ mapf\_name,\ reducef\_name,\ identityVal,\ alloc,\ NACCELERATORS,\ 0)\ \{}
\DoxyCodeLine{01783\ \ \ \ \ \}}
\DoxyCodeLine{01784\ }
\DoxyCodeLine{01785\ \};}
\DoxyCodeLine{01786\ }
\DoxyCodeLine{01787\ }
\DoxyCodeLine{01788\ }
\DoxyCodeLine{01789\ \textcolor{comment}{/***\ 2D\ ***/}}
\DoxyCodeLine{01790\ }
\DoxyCodeLine{01796\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ TaskT\_,\ \textcolor{keyword}{typename}\ Tin\_,\ \textcolor{keyword}{typename}\ Tout\_\ =\ Tin\_>}
\DoxyCodeLine{01797\ \textcolor{keyword}{class\ }baseOCLTask\_2D:\ \textcolor{keyword}{public}\ baseOCLTask<TaskT\_,\ Tin\_,\ Tout\_>\ \{}
\DoxyCodeLine{01798\ \textcolor{keyword}{public}:}
\DoxyCodeLine{01805\ \ \ \ \ \textcolor{keywordtype}{void}\ setHeight(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{ittnotify__static_8h_ae68700d2ebda197674e2fdd0f916f00c}{h}})\ \{}
\DoxyCodeLine{01806\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a31d490b16f4b63c2afa4c7198ef2c31e}{height}}\ =\ \mbox{\hyperlink{ittnotify__static_8h_ae68700d2ebda197674e2fdd0f916f00c}{h}};}
\DoxyCodeLine{01807\ \ \ \ \ \}}
\DoxyCodeLine{01808\ }
\DoxyCodeLine{01815\ \ \ \ \ \textcolor{keywordtype}{void}\ setWidth(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}})\ \{}
\DoxyCodeLine{01816\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a4c3bd78046e1e69b575cace337a4a9a3}{width}}\ =\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}};}
\DoxyCodeLine{01817\ \ \ \ \ \}}
\DoxyCodeLine{01818\ }
\DoxyCodeLine{01819\ \ \ \ \ \textcolor{comment}{//runtime\ getter\ functions}}
\DoxyCodeLine{01820\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ getHeight()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a31d490b16f4b63c2afa4c7198ef2c31e}{height}};\}}
\DoxyCodeLine{01821\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ getWidth()\textcolor{keyword}{\ const\ }\{\textcolor{keywordflow}{return}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a4c3bd78046e1e69b575cace337a4a9a3}{width}};\}}
\DoxyCodeLine{01822\ }
\DoxyCodeLine{01823\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{01824\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a31d490b16f4b63c2afa4c7198ef2c31e}{height}},\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a4c3bd78046e1e69b575cace337a4a9a3}{width}};}
\DoxyCodeLine{01825\ \};}
\DoxyCodeLine{01826\ }
\DoxyCodeLine{01827\ }
\DoxyCodeLine{01828\ }
\DoxyCodeLine{01833\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ TOCL\ =\ T>}
\DoxyCodeLine{01834\ \textcolor{keyword}{class\ }ff\_oclAccelerator\_2D\ :\ \textcolor{keyword}{public}\ ff\_oclAccelerator<T,\ TOCL>\ \{}
\DoxyCodeLine{01835\ \textcolor{keyword}{public}:}
\DoxyCodeLine{01836\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ TOCL::Tin\ \ Tin;}
\DoxyCodeLine{01837\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ TOCL::Tout\ Tout;}
\DoxyCodeLine{01838\ }
\DoxyCodeLine{01839\ \ \ \ \ ff\_oclAccelerator\_2D(ff\_oclallocator\ *alloc,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ halo\_width\_,\ \textcolor{keyword}{const}\ Tout\ \&identityVal,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ from\_source=\textcolor{keyword}{false})\ :}
\DoxyCodeLine{01840\ \ \ \ \ \ \ \ \ ff\_oclAccelerator<\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},TOCL>(alloc,\ halo\_width\_,\ identityVal,\ from\_source)\ \{}
\DoxyCodeLine{01841\ \ \ \ \ \ \ \ \ heightInput\_global\ =\ 0;}
\DoxyCodeLine{01842\ \ \ \ \ \ \ \ \ widthInput\_global\ =\ 0;}
\DoxyCodeLine{01843\ \ \ \ \ \}}
\DoxyCodeLine{01844\ }
\DoxyCodeLine{01845\ \ \ \ \ \textcolor{keywordtype}{void}\ setMapKernelArgs(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ envSize)\ \{}
\DoxyCodeLine{01846\ \ \ \ \ \ \ \ \ cl\_uint\ idx\ =\ 0;}
\DoxyCodeLine{01847\ \ \ \ \ \ \ \ \ \textcolor{comment}{//set\ iteration-\/dynamic\ MAP\ kernel\ args\ (init)}}
\DoxyCodeLine{01848\ \ \ \ \ \ \ \ \ cl\_int\ status\ =\ clSetKernelArg(this-\/>kernel\_map,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_mem),\ \&this-\/>inputBuffer);}
\DoxyCodeLine{01849\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}setKernelArg\ input"{}});}
\DoxyCodeLine{01850\ \ \ \ \ \ \ \ \ status\ =\ clSetKernelArg(this-\/>kernel\_map,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_mem),\ \&this-\/>outputBuffer);}
\DoxyCodeLine{01851\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}setKernelArg\ output"{}});}
\DoxyCodeLine{01852\ }
\DoxyCodeLine{01853\ \ \ \ \ \ \ \ \ \textcolor{comment}{//set\ iteration-\/invariant\ MAP\ kernel\ args}}
\DoxyCodeLine{01854\ \ \ \ \ \ \ \ \ status\ =\ clSetKernelArg(this-\/>kernel\_map,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_uint),\ (\textcolor{keywordtype}{void}\ *)\ \&heightInput\_global);}
\DoxyCodeLine{01855\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}setKernelArg\ global\ input\ height"{}});}
\DoxyCodeLine{01856\ \ \ \ \ \ \ \ \ status\ =\ clSetKernelArg(this-\/>kernel\_map,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_uint),\ (\textcolor{keywordtype}{void}\ *)\ \&widthInput\_global);}
\DoxyCodeLine{01857\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}setKernelArg\ global\ input\ width"{}});}
\DoxyCodeLine{01858\ }
\DoxyCodeLine{01859\ \ \ \ \ \ \ \ \ status\ =\ clSetKernelArg(this-\/>kernel\_map,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_uint),\ (\textcolor{keywordtype}{void}\ *)\ \&this-\/>lenOutput);}
\DoxyCodeLine{01860\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}setKernelArg\ local\ input\ length"{}});}
\DoxyCodeLine{01861\ \ \ \ \ \ \ \ \ status\ =\ clSetKernelArg(this-\/>kernel\_map,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_uint),\ (\textcolor{keywordtype}{void}\ *)\ \&this-\/>offset1\_in);}
\DoxyCodeLine{01862\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}setKernelArg\ offset"{}});}
\DoxyCodeLine{01863\ \ \ \ \ \ \ \ \ status\ =\ clSetKernelArg(this-\/>kernel\_map,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_uint),\ (\textcolor{keywordtype}{void}\ *)\ \&this-\/>halo\_out\_left);}
\DoxyCodeLine{01864\ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}setKernelArg\ halo"{}});}
\DoxyCodeLine{01865\ }
\DoxyCodeLine{01866\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ k=0;\ k\ <\ envSize;\ ++k)\ \{}
\DoxyCodeLine{01867\ \ \ \ \ \ \ \ \ \ \ \ \ status\ =\ clSetKernelArg(this-\/>kernel\_map,\ idx++,\ \textcolor{keyword}{sizeof}(cl\_mem),\ \&(this-\/>envBuffer[k].first));}
\DoxyCodeLine{01868\ \ \ \ \ \ \ \ \ \ \ \ \ checkResult(status,\ \textcolor{stringliteral}{"{}setKernelArg\ env"{}});}
\DoxyCodeLine{01869\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01870\ \ \ \ \ \}}
\DoxyCodeLine{01871\ }
\DoxyCodeLine{01875\ \ \ \ \ \textcolor{keywordtype}{void}\ setHeight(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{ittnotify__static_8h_ae68700d2ebda197674e2fdd0f916f00c}{h}})\ \{}
\DoxyCodeLine{01876\ \ \ \ \ \ \ \ \ heightInput\_global\ =\ \mbox{\hyperlink{ittnotify__static_8h_ae68700d2ebda197674e2fdd0f916f00c}{h}};}
\DoxyCodeLine{01877\ \ \ \ \ \}}
\DoxyCodeLine{01878\ }
\DoxyCodeLine{01879\ \ \ \ \ \textcolor{keywordtype}{void}\ setWidth(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}})\ \{}
\DoxyCodeLine{01880\ \ \ \ \ \ \ \ \ widthInput\_global\ =\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}};}
\DoxyCodeLine{01881\ \ \ \ \ \}}
\DoxyCodeLine{01882\ }
\DoxyCodeLine{01883\ \textcolor{keyword}{private}:}
\DoxyCodeLine{01884\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ heightInput\_global,\ widthInput\_global;}
\DoxyCodeLine{01885\ \};}
\DoxyCodeLine{01886\ }
\DoxyCodeLine{01887\ }
\DoxyCodeLine{01888\ }
\DoxyCodeLine{01892\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ TOCL\ =\ T>}
\DoxyCodeLine{01893\ \textcolor{keyword}{class\ }ff\_stencilReduceLoopOCL\_2D:\ \textcolor{keyword}{public}\ ff\_stencilReduceLoopOCL\_1D<T,TOCL,ff\_oclAccelerator\_2D<T,TOCL>\ >\ \{}
\DoxyCodeLine{01894\ \textcolor{keyword}{private}:}
\DoxyCodeLine{01895\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ TOCL::Tin\ Tin;}
\DoxyCodeLine{01896\ \ \ \ \ \textcolor{keyword}{typedef}\ \textcolor{keyword}{typename}\ TOCL::Tout\ Tout;}
\DoxyCodeLine{01897\ \ \ \ \ \textcolor{keyword}{typedef}\ ff\_oclAccelerator\_2D<T,TOCL>\ accelerator\_t;}
\DoxyCodeLine{01898\ \ \ \ \ \textcolor{keyword}{typedef}\ ff::ff\_stencilReduceLoopOCL\_1D<T,TOCL,accelerator\_t>\ base\_srl\_t;}
\DoxyCodeLine{01899\ }
\DoxyCodeLine{01900\ \textcolor{keyword}{public}:}
\DoxyCodeLine{01901\ \ \ \ \ \textcolor{comment}{//\ build\ the\ program\ from\ the\ mapf\ and\ reducef\ functions}}
\DoxyCodeLine{01902\ \ \ \ \ \ \ \ \ ff\_stencilReduceLoopOCL\_2D(\textcolor{keyword}{const}\ std::string\ \&mapf,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//OpenCL\ elemental\ function}}
\DoxyCodeLine{01903\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&reducef\ =\ std::string(\textcolor{stringliteral}{"{}"{}}),\ \ \textcolor{comment}{//OpenCL\ combinator\ function}}
\DoxyCodeLine{01904\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Tout\ \&identityVal\ =\ Tout(),}
\DoxyCodeLine{01905\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *allocator\ =\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{01906\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1,}
\DoxyCodeLine{01907\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ stencil\_width\_half\_\ =\ 1,}
\DoxyCodeLine{01908\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ stencil\_height\_half\_\ =\ 1)\ :}
\DoxyCodeLine{01909\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//init\ srl\ 1D\ with\ no\ halo\ (1D\ halo\ depends\ on\ 2D\ width)}}
\DoxyCodeLine{01910\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ base\_srl\_t(mapf,\ reducef,\ identityVal,\ allocator,\ NACCELERATORS,\ 0),}
\DoxyCodeLine{01911\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ stencil\_width\_half(stencil\_width\_half\_),\ stencil\_height\_half(stencil\_height\_half\_)\ \{\}}
\DoxyCodeLine{01912\ }
\DoxyCodeLine{01913\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ build\ the\ program\ from\ source\ code\ file,}}
\DoxyCodeLine{01914\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ first\ attempts\ to\ load\ a\ cached\ binary\ file\ (kernels\_source\ in\ this\ case\ is\ the\ path\ to\ the\ binary\ file)}}
\DoxyCodeLine{01915\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ff\ that\ file\ is\ not\ available,\ then\ it\ creates\ the\ program\ from\ source\ and\ store\ the\ binary\ for\ future\ use}}
\DoxyCodeLine{01916\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ with\ the\ extention\ "{}.bin"{}}}
\DoxyCodeLine{01917\ \ \ \ \ \ \ \ \ ff\_stencilReduceLoopOCL\_2D(\textcolor{keyword}{const}\ std::string\ \&kernels\_source,\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ OpenCL\ source\ code\ path}}
\DoxyCodeLine{01918\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&mapf\_name,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ name\ of\ the\ map\ function}}
\DoxyCodeLine{01919\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&reducef\_name,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ name\ of\ the\ reduce\ function}}
\DoxyCodeLine{01920\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Tout\ \&identityVal\ =\ Tout(),}
\DoxyCodeLine{01921\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *allocator\ =\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{01922\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1,}
\DoxyCodeLine{01923\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ stencil\_width\_half\_\ =\ 1,}
\DoxyCodeLine{01924\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ stencil\_height\_half\_\ =\ 1)\ :}
\DoxyCodeLine{01925\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//init\ srl\ 1D\ with\ no\ halo\ (1D\ halo\ depends\ on\ 2D\ width)}}
\DoxyCodeLine{01926\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ base\_srl\_t(kernels\_source,\ mapf\_name,\ reducef\_name,\ identityVal,\ allocator,\ NACCELERATORS,\ 0),}
\DoxyCodeLine{01927\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ stencil\_width\_half(stencil\_width\_half\_),\ stencil\_height\_half(stencil\_height\_half\_)\ \{\}}
\DoxyCodeLine{01928\ }
\DoxyCodeLine{01929\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ task\ is\ provided\ in\ the\ constructor\ -\/-\/\ one\ shot\ computation}}
\DoxyCodeLine{01930\ \ \ \ \ \ \ \ \ ff\_stencilReduceLoopOCL\_2D(\textcolor{keyword}{const}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \&\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},}
\DoxyCodeLine{01931\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&mapf,}
\DoxyCodeLine{01932\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&reducef\ =\ std::string(\textcolor{stringliteral}{"{}"{}}),}
\DoxyCodeLine{01933\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Tout\ \&identityVal\ =\ Tout(),}
\DoxyCodeLine{01934\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *allocator\ =\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{01935\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1,}
\DoxyCodeLine{01936\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ stencil\_width\_half\_\ =\ 1,}
\DoxyCodeLine{01937\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ stencil\_height\_half\_\ =\ 1)\ :}
\DoxyCodeLine{01938\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//init\ srl\ 1D\ with\ no\ halo\ (1D\ halo\ depends\ on\ 2D\ width)}}
\DoxyCodeLine{01939\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ base\_srl\_t(\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},\ mapf,\ reducef,\ identityVal,\ allocator,\ NACCELERATORS,\ 0),}
\DoxyCodeLine{01940\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ stencil\_width\_half(stencil\_width\_half\_),stencil\_height\_half(stencil\_height\_half\_)\ \{\}}
\DoxyCodeLine{01941\ }
\DoxyCodeLine{01942\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ task\ is\ provided\ in\ the\ constructor\ -\/-\/\ one\ shot\ computation}}
\DoxyCodeLine{01943\ \ \ \ \ \ \ \ \ ff\_stencilReduceLoopOCL\_2D(\textcolor{keyword}{const}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \&\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},}
\DoxyCodeLine{01944\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&kernels\_source,\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ OpenCL\ source\ code\ path}}
\DoxyCodeLine{01945\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&mapf\_name,\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ name\ of\ the\ map\ kernel\ function}}
\DoxyCodeLine{01946\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&reducef\_name,\ \ \ \ \ \ \ \ \textcolor{comment}{//\ name\ of\ the\ reduce\ kernel\ function}}
\DoxyCodeLine{01947\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Tout\ \&identityVal\ =\ Tout(),}
\DoxyCodeLine{01948\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *allocator\ =\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{01949\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1,}
\DoxyCodeLine{01950\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ stencil\_width\_half\_\ =\ 1,}
\DoxyCodeLine{01951\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ stencil\_height\_half\_\ =\ 1)\ :}
\DoxyCodeLine{01952\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//init\ srl\ 1D\ with\ no\ halo\ (1D\ halo\ depends\ on\ 2D\ width)}}
\DoxyCodeLine{01953\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ base\_srl\_t(\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},\ kernels\_source,\ mapf\_name,\ reducef\_name,\ identityVal,\ allocator,\ NACCELERATORS,\ 0),}
\DoxyCodeLine{01954\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ stencil\_width\_half(stencil\_width\_half\_),\ stencil\_height\_half(stencil\_height\_half\_)\ \{\}}
\DoxyCodeLine{01955\ }
\DoxyCodeLine{01956\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{01957\ \ \ \ \ \textcolor{keywordtype}{void}\ adjustInputBufferOffset(\textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ memorychange)\ \{}
\DoxyCodeLine{01958\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ this-\/>accelerators.size();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{01959\ \ \ \ \ \ \ \ \ \ \ \ \ this-\/>accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>setWidth(this-\/>Task.getWidth());}
\DoxyCodeLine{01960\ \ \ \ \ \ \ \ \ \ \ \ \ this-\/>accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>setHeight(this-\/>Task.getHeight());}
\DoxyCodeLine{01961\ \ \ \ \ \ \ \ \ \ \ \ \ this-\/>accelerators[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]-\/>setHaloHalf(halo\_half(this-\/>Task.getWidth()));}
\DoxyCodeLine{01962\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01963\ \ \ \ \ \ \ \ \ \textcolor{comment}{//accelerator\ uses\ above\ values\ to\ compute\ actual\ sizing}}
\DoxyCodeLine{01964\ \ \ \ \ \ \ \ \ base\_srl\_t::adjustInputBufferOffset(memorychange);}
\DoxyCodeLine{01965\ \ \ \ \ \}}
\DoxyCodeLine{01966\ \textcolor{keyword}{private}:}
\DoxyCodeLine{01967\ }
\DoxyCodeLine{01968\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ halo\_half(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a4c3bd78046e1e69b575cace337a4a9a3}{width}})\ \{}
\DoxyCodeLine{01969\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ stencil\_height\_half\ *\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a4c3bd78046e1e69b575cace337a4a9a3}{width}}\ +\ stencil\_width\_half;}
\DoxyCodeLine{01970\ \ \ \ \ \}}
\DoxyCodeLine{01971\ }
\DoxyCodeLine{01972\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{01973\ \textcolor{comment}{\ \ \ \ \ *\ 2D\ stencil\ can\ access\ elements\ in\ H\ x\ W\ rectangle\ around\ each\ element,\ where:}}
\DoxyCodeLine{01974\ \textcolor{comment}{\ \ \ \ \ *\ H\ =\ 2\ *\ stencil\_height\_half\ +\ 1}}
\DoxyCodeLine{01975\ \textcolor{comment}{\ \ \ \ \ *\ W\ =\ 2\ *\ stencil\_width\_half\ +\ 1}}
\DoxyCodeLine{01976\ \textcolor{comment}{\ \ \ \ \ */}}
\DoxyCodeLine{01977\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ stencil\_width\_half;}
\DoxyCodeLine{01978\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ stencil\_height\_half;}
\DoxyCodeLine{01979\ \};}
\DoxyCodeLine{01980\ }
\DoxyCodeLine{01981\ }
\DoxyCodeLine{01991\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T,\ \textcolor{keyword}{typename}\ TOCL\ =\ T>}
\DoxyCodeLine{01992\ \textcolor{keyword}{class\ }ff\_mapOCL\_2D:\ \textcolor{keyword}{public}\ ff\_stencilReduceLoopOCL\_2D<T,\ TOCL>\ \{}
\DoxyCodeLine{01993\ \textcolor{keyword}{public}:}
\DoxyCodeLine{01994\ \ \ \ \ ff\_mapOCL\_2D(std::string\ mapf,\ ff\_oclallocator\ *alloc=\textcolor{keyword}{nullptr},}
\DoxyCodeLine{01995\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1)\ :}
\DoxyCodeLine{01996\ \ \ \ \ \ \ \ \ ff\_stencilReduceLoopOCL\_2D<\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ TOCL>(mapf,\ \textcolor{stringliteral}{"{}"{}},\ 0,\ alloc,\ NACCELERATORS)\ \{}
\DoxyCodeLine{01997\ \ \ \ \ \}}
\DoxyCodeLine{01998\ }
\DoxyCodeLine{01999\ \ \ \ \ ff\_mapOCL\_2D(\textcolor{keyword}{const}\ std::string\ \&kernels\_source,\ \textcolor{keyword}{const}\ std::string\ \&mapf\_name,\ }
\DoxyCodeLine{02000\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *alloc=\textcolor{keyword}{nullptr},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1)\ :}
\DoxyCodeLine{02001\ \ \ \ \ \ \ \ \ ff\_stencilReduceLoopOCL\_2D<\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ TOCL>(kernels\_source,\ mapf\_name,\ \textcolor{stringliteral}{"{}"{}},\ 0,\ alloc,\ NACCELERATORS)\ \{}
\DoxyCodeLine{02002\ \ \ \ \ \}}
\DoxyCodeLine{02003\ \ \ \ \ }
\DoxyCodeLine{02004\ }
\DoxyCodeLine{02005\ \ \ \ \ ff\_mapOCL\_2D(\textcolor{keyword}{const}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \&\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},\ std::string\ mapf,\ }
\DoxyCodeLine{02006\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *alloc=\textcolor{keyword}{nullptr},}
\DoxyCodeLine{02007\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1)\ :}
\DoxyCodeLine{02008\ \ \ \ \ \ \ \ \ ff\_stencilReduceLoopOCL\_2D<\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ TOCL>(\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},\ mapf,\ \textcolor{stringliteral}{"{}"{}},\ 0,\ alloc,\ NACCELERATORS)\ \{}
\DoxyCodeLine{02009\ \ \ \ \ \}}
\DoxyCodeLine{02010\ \ \ \ \ ff\_mapOCL\_2D(\textcolor{keyword}{const}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\ \&\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},\ \textcolor{keyword}{const}\ std::string\ \&kernels\_source,\ \textcolor{keyword}{const}\ std::string\ \&mapf\_name,\ }
\DoxyCodeLine{02011\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ff\_oclallocator\ *alloc=\textcolor{keyword}{nullptr},}
\DoxyCodeLine{02012\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ NACCELERATORS\ =\ 1)\ :}
\DoxyCodeLine{02013\ \ \ \ \ \ \ \ \ ff\_stencilReduceLoopOCL\_2D<\mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}},\ TOCL>(\mbox{\hyperlink{test__partitioner__whitebox_8h_a5c4cf3d37a4eee22275de22cb9619863}{task}},\ kernels\_source,\ mapf\_name,\ \textcolor{stringliteral}{"{}"{}},\ 0,\ alloc,\ NACCELERATORS)\ \{}
\DoxyCodeLine{02014\ \ \ \ \ \}}
\DoxyCodeLine{02015\ }
\DoxyCodeLine{02016\ \ \ \ \ \textcolor{keywordtype}{bool}\ isPureMap()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};\ \}}
\DoxyCodeLine{02017\ \};\ \ \ \ }
\DoxyCodeLine{02018\ }
\DoxyCodeLine{02019\ }
\DoxyCodeLine{02020\ }
\DoxyCodeLine{02021\ }
\DoxyCodeLine{02022\ }
\DoxyCodeLine{02023\ \}\textcolor{comment}{//\ namespace\ ff}}
\DoxyCodeLine{02024\ }
\DoxyCodeLine{02025\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ FF\_OCL}}
\DoxyCodeLine{02026\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ FF\_MAP\_OCL\_HPP\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{02027\ }

\end{DoxyCode}
