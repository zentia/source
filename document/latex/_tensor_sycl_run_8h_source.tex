\doxysection{Tensor\+Sycl\+Run.\+h}
\hypertarget{_tensor_sycl_run_8h_source}{}\label{_tensor_sycl_run_8h_source}\index{external/taskflow/3rd-\/party/eigen-\/3.3.7/unsupported/Eigen/CXX11/src/Tensor/TensorSyclRun.h@{external/taskflow/3rd-\/party/eigen-\/3.3.7/unsupported/Eigen/CXX11/src/Tensor/TensorSyclRun.h}}
\mbox{\hyperlink{_tensor_sycl_run_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ This\ file\ is\ part\ of\ Eigen,\ a\ lightweight\ C++\ template\ library}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ for\ linear\ algebra.}}
\DoxyCodeLine{00003\ \textcolor{comment}{//}}
\DoxyCodeLine{00004\ \textcolor{comment}{//\ Mehdi\ Goli\ \ \ \ Codeplay\ Software\ Ltd.}}
\DoxyCodeLine{00005\ \textcolor{comment}{//\ Ralph\ Potter\ \ Codeplay\ Software\ Ltd.}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ Luke\ Iwanski\ \ Codeplay\ Software\ Ltd.}}
\DoxyCodeLine{00007\ \textcolor{comment}{//\ Cummins\ Chris\ PhD\ student\ at\ The\ University\ of\ Edinburgh.}}
\DoxyCodeLine{00008\ \textcolor{comment}{//\ Contact:\ <eigen@codeplay.com>}}
\DoxyCodeLine{00009\ \textcolor{comment}{//}}
\DoxyCodeLine{00010\ \textcolor{comment}{//\ This\ Source\ Code\ Form\ is\ subject\ to\ the\ terms\ of\ the\ Mozilla}}
\DoxyCodeLine{00011\ \textcolor{comment}{//\ Public\ License\ v.\ 2.0.\ If\ a\ copy\ of\ the\ MPL\ was\ not\ distributed}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ with\ this\ file,\ You\ can\ obtain\ one\ at\ http://mozilla.org/MPL/2.0/.}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{comment}{/*****************************************************************}}
\DoxyCodeLine{00015\ \textcolor{comment}{\ *\ TensorSyclRun.h}}
\DoxyCodeLine{00016\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00017\ \textcolor{comment}{\ *\ \(\backslash\)brief:}}
\DoxyCodeLine{00018\ \textcolor{comment}{\ *\ Schedule\_kernel\ invoke\ an\ specialised\ version\ of\ kernel\ struct.\ The}}
\DoxyCodeLine{00019\ \textcolor{comment}{\ *\ specialisation\ is\ based\ on\ the\ data\ dimension\ in\ sycl\ buffer}}
\DoxyCodeLine{00020\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00021\ \textcolor{comment}{*****************************************************************/}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#ifndef\ UNSUPPORTED\_EIGEN\_CXX11\_SRC\_TENSOR\_TENSORSYCL\_SYCLRUN\_HPP}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#define\ UNSUPPORTED\_EIGEN\_CXX11\_SRC\_TENSOR\_TENSORSYCL\_SYCLRUN\_HPP}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespace_eigen}{Eigen}}\ \{}
\DoxyCodeLine{00027\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespace_eigen_1_1_tensor_sycl}{TensorSycl}}\ \{}
\DoxyCodeLine{00032\ \textcolor{keyword}{template}\ <\textcolor{keyword}{typename}\ Expr,\ \textcolor{keyword}{typename}\ Dev>}
\DoxyCodeLine{00033\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespace_eigen_1_1_tensor_sycl_a789ef14500d782279cc4bb95e6ba3dbd}{run}}(Expr\ \&expr,\ Dev\ \&dev)\ \{}
\DoxyCodeLine{00034\ \ \ \mbox{\hyperlink{struct_eigen_1_1_tensor_evaluator}{Eigen::TensorEvaluator<Expr,\ Dev>}}\ evaluator(expr,\ dev);}
\DoxyCodeLine{00035\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ needs\_assign\ =\ evaluator.\mbox{\hyperlink{struct_eigen_1_1_tensor_evaluator_ae188d806978166eb8cbffbd63c944fb3}{evalSubExprsIfNeeded}}(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00036\ \ \ \textcolor{keywordflow}{if}\ (needs\_assign)\ \{}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{keyword}{typedef}\ \ \textcolor{keyword}{typename}\ \mbox{\hyperlink{struct_eigen_1_1_tensor_sycl_1_1internal_1_1create_place_holder_expression_a42d5d1e1cef6caff6033ab33fe59a2ed}{internal::createPlaceHolderExpression<Expr>::Type}}\ PlaceHolderExpr;}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keyword}{auto}\ functors\ =\ \mbox{\hyperlink{namespace_eigen_1_1_tensor_sycl_1_1internal_a525ee07cdeb68d18359b511b1ae9ffc7}{internal::extractFunctors}}(evaluator);}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ tileSize\ =dev.m\_queue.get\_device().\ \textcolor{keyword}{template}\ get\_info<cl::sycl::info::device::max\_work\_group\_size>()/2;}
\DoxyCodeLine{00041\ \ \ \ \ dev.m\_queue.submit([\&](cl::sycl::handler\ \&cgh)\ \{}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \ \ \ \ \textcolor{comment}{//\ create\ a\ tuple\ of\ accessors\ from\ Evaluator}}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ tuple\_of\_accessors\ =\ \mbox{\hyperlink{namespace_eigen_1_1_tensor_sycl_1_1internal_aa93846494e766618619e24bc400b8aaa}{internal::createTupleOfAccessors<decltype(evaluator)>}}(cgh,\ evaluator);}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ range\ =\ utility::tuple::get<0>(tuple\_of\_accessors).get\_range()[0];}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ GRange=range;}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tileSize>GRange)\ tileSize=GRange;}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(GRange>tileSize)\{}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ xMode\ =\ GRange\ \%\ tileSize;}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (xMode\ !=\ 0)\ GRange\ +=\ (tileSize\ -\/\ xMode);}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \textcolor{comment}{//\ run\ the\ kernel}}
\DoxyCodeLine{00053\ \ \ \ \ \ \ cgh.parallel\_for<PlaceHolderExpr>(\ cl::sycl::nd\_range<1>(cl::sycl::range<1>(GRange),\ cl::sycl::range<1>(tileSize)),\ [=](cl::sycl::nd\_item<1>\ itemID)\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \ \textcolor{keyword}{typename}\ \mbox{\hyperlink{struct_eigen_1_1_tensor_sycl_1_1internal_1_1_convert_to_device_expression}{internal::ConvertToDeviceExpression<Expr>::Type}}\ DevExpr;}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ device\_expr\ =\mbox{\hyperlink{namespace_eigen_1_1_tensor_sycl_1_1internal_a2c0852b2e3ab04d62d61608539755c57}{internal::createDeviceExpression<DevExpr,\ PlaceHolderExpr>}}(functors,\ tuple\_of\_accessors);}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ device\_evaluator\ =\ \mbox{\hyperlink{struct_eigen_1_1_tensor_evaluator}{Eigen::TensorEvaluator}}<\textcolor{keyword}{decltype}(device\_expr.expr),\ \mbox{\hyperlink{struct_eigen_1_1_default_device}{Eigen::DefaultDevice}}>(device\_expr.expr,\ \mbox{\hyperlink{struct_eigen_1_1_default_device}{Eigen::DefaultDevice}}());}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (itemID.get\_global\_linear\_id()\ <\ range)\ \{}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ device\_evaluator.evalScalar(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(itemID.get\_global\_linear\_id()));}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \});}
\DoxyCodeLine{00061\ \ \ \ \ \});}
\DoxyCodeLine{00062\ \ \ \ \ dev.m\_queue.throw\_asynchronous();}
\DoxyCodeLine{00063\ \ \ \}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ evaluator.\mbox{\hyperlink{struct_eigen_1_1_tensor_evaluator_a76ec54bcca9523ec104aaa9adaf74983}{cleanup}}();}
\DoxyCodeLine{00066\ \}}
\DoxyCodeLine{00067\ \}\ \ \textcolor{comment}{//\ namespace\ TensorSycl}}
\DoxyCodeLine{00068\ \}\ \ \textcolor{comment}{//\ namespace\ Eigen}}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ UNSUPPORTED\_EIGEN\_CXX11\_SRC\_TENSOR\_TENSORSYCL\_SYCLRUN\_HPP}}

\end{DoxyCode}
