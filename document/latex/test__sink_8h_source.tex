\doxysection{test\+\_\+sink.\+h}
\hypertarget{test__sink_8h_source}{}\label{test__sink_8h_source}\index{runtime/spdlog/tests/test\_sink.h@{runtime/spdlog/tests/test\_sink.h}}
\mbox{\hyperlink{test__sink_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//}}
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Copyright(c)\ 2018\ Gabi\ Melman.}}
\DoxyCodeLine{00003\ \textcolor{comment}{//\ Distributed\ under\ the\ MIT\ License\ (http://opensource.org/licenses/MIT)}}
\DoxyCodeLine{00004\ \textcolor{comment}{//}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{null__mutex_8h}{spdlog/details/null\_mutex.h}}"{}}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{base__sink_8h}{spdlog/sinks/base\_sink.h}}"{}}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{fmt_8h}{spdlog/fmt/fmt.h}}"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <chrono>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <mutex>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <thread>}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacespdlog}{spdlog}}\ \{}
\DoxyCodeLine{00016\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespacespdlog_1_1sinks}{sinks}}\ \{}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ Mutex>}
\DoxyCodeLine{00019\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink}{test\_sink}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classspdlog_1_1sinks_1_1base__sink_a0a4c703dc54edfbd0d3817770e36f3f7}{base\_sink}}<Mutex>\ \{}
\DoxyCodeLine{00020\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_a4bbbbc1b92dcc22c8129f73f9b29adcc}{lines\_to\_save}}\ =\ 100;}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00023\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_adf4f784f427da9237329bee07029d390}{msg\_counter}}()\ \{}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ std::lock\_guard<Mutex>\ lock(\mbox{\hyperlink{classspdlog_1_1sinks_1_1base__sink_a929422554ce18d8bffd9b4d75cc7acf3}{base\_sink<Mutex>::mutex\_}});}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_a55b398b3aa3e23a5fe25f5f2f32e2c70}{msg\_counter\_}};}
\DoxyCodeLine{00026\ \ \ \ \ \}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_a2ff156f1498832ee717659a5e3a8722e}{flush\_counter}}()\ \{}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ std::lock\_guard<Mutex>\ lock(\mbox{\hyperlink{classspdlog_1_1sinks_1_1base__sink_a929422554ce18d8bffd9b4d75cc7acf3}{base\_sink<Mutex>::mutex\_}});}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_a42c01978a07f717f78532d513c520b2b}{flush\_counter\_}};}
\DoxyCodeLine{00031\ \ \ \ \ \}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_af79a499347dcee7096158b392e29e507}{set\_delay}}(std::chrono::milliseconds\ delay)\ \{}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ std::lock\_guard<Mutex>\ lock(\mbox{\hyperlink{classspdlog_1_1sinks_1_1base__sink_a929422554ce18d8bffd9b4d75cc7acf3}{base\_sink<Mutex>::mutex\_}});}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_ab042e8f3b8f72b3e3eed20de15125f9a}{delay\_}}\ =\ delay;}
\DoxyCodeLine{00036\ \ \ \ \ \}}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{comment}{//\ return\ last\ output\ without\ the\ eol}}
\DoxyCodeLine{00039\ \ \ \ \ std::vector<std::string>\ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_a947448ae66d2e90e4bbd6682d0bd6a9c}{lines}}()\ \{}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ std::lock\_guard<Mutex>\ lock(\mbox{\hyperlink{classspdlog_1_1sinks_1_1base__sink_a929422554ce18d8bffd9b4d75cc7acf3}{base\_sink<Mutex>::mutex\_}});}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_af40aeb928f44877edfd5580c454c6f69}{lines\_}};}
\DoxyCodeLine{00042\ \ \ \ \ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_a66f346f1bb916e73b7095295c4e5f0be}{sink\_it\_}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structspdlog_1_1details_1_1log__msg}{details::log\_msg}}\ \&msg)\textcolor{keyword}{\ override\ }\{}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{namespacespdlog_a9ae6875ab28ec95e33921c45ae451633}{memory\_buf\_t}}\ formatted;}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classspdlog_1_1sinks_1_1base__sink_a2db2479b1d1aed70f55c08a9392b5a42}{base\_sink<Mutex>::formatter\_}}-\/>format(msg,\ formatted);}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ save\ the\ line\ without\ the\ eol}}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ eol\_len\ =\ strlen(\mbox{\hyperlink{namespacespdlog_1_1details_1_1os_aa84a047b93ed98c09826ccbd5e5afa46}{details::os::default\_eol}});}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \textcolor{keyword}{using\ }diff\_t\ =\ \textcolor{keyword}{typename}\ std::iterator\_traits<\textcolor{keyword}{decltype}(formatted.end())>::difference\_type;\ }
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_af40aeb928f44877edfd5580c454c6f69}{lines\_}}.size()\ <\ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_a4bbbbc1b92dcc22c8129f73f9b29adcc}{lines\_to\_save}})\ \{}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_af40aeb928f44877edfd5580c454c6f69}{lines\_}}.emplace\_back(formatted.begin(),\ formatted.end()\ -\/\ \textcolor{keyword}{static\_cast<}diff\_t\textcolor{keyword}{>}(eol\_len));}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_a55b398b3aa3e23a5fe25f5f2f32e2c70}{msg\_counter\_}}++;}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ std::this\_thread::sleep\_for(\mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_ab042e8f3b8f72b3e3eed20de15125f9a}{delay\_}});}
\DoxyCodeLine{00056\ \ \ \ \ \}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_a2cf5590b97c6637872c11a7d7a943394}{flush\_}}()\textcolor{keyword}{\ override\ }\{\ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_a42c01978a07f717f78532d513c520b2b}{flush\_counter\_}}++;\ \}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_a55b398b3aa3e23a5fe25f5f2f32e2c70}{msg\_counter\_}}\{0\};}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_a42c01978a07f717f78532d513c520b2b}{flush\_counter\_}}\{0\};}
\DoxyCodeLine{00062\ \ \ \ \ std::chrono::milliseconds\ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_ab042e8f3b8f72b3e3eed20de15125f9a}{delay\_}}\{std::chrono::milliseconds::zero()\};}
\DoxyCodeLine{00063\ \ \ \ \ std::vector<std::string>\ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink_af40aeb928f44877edfd5580c454c6f69}{lines\_}};}
\DoxyCodeLine{00064\ \};}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacespdlog_1_1sinks_ada0dd8fd2338eabdc889d9e6bfa2441d}{test\_sink\_mt}}\ =\ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink}{test\_sink<std::mutex>}};}
\DoxyCodeLine{00067\ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacespdlog_1_1sinks_abaf4c5cd8242ffbc344103de7c8d7cb0}{test\_sink\_st}}\ =\ \mbox{\hyperlink{classspdlog_1_1sinks_1_1test__sink}{test\_sink<details::null\_mutex>}};}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \}\ \ \textcolor{comment}{//\ namespace\ sinks}}
\DoxyCodeLine{00070\ \}\ \ \textcolor{comment}{//\ namespace\ spdlog}}

\end{DoxyCode}
