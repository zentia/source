\doxysection{shared.\+h}
\hypertarget{shared_8h_source}{}\label{shared_8h_source}\index{runtime/dsl/shared.h@{runtime/dsl/shared.h}}
\mbox{\hyperlink{shared_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{expr_8h}{runtime/dsl/expr.h}}>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{dsl_2atomic_8h}{runtime/dsl/atomic.h}}>}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceluisa_1_1compute}{luisa::compute}}\ \{}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00009\ \textcolor{keyword}{class\ }Shared;}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceluisa_1_1compute_1_1detail}{detail}}\ \{}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00014\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structluisa_1_1compute_1_1detail_1_1_shared_as_atomic}{SharedAsAtomic}}\ \{}
\DoxyCodeLine{00015\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ I>}
\DoxyCodeLine{00016\ \ \ \ \ \ \ \ \ \textcolor{keyword}{requires}\ \mbox{\hyperlink{namespaceluisa_1_1compute_a2e4127befb5af9644bdabcf03206d9a0}{is\_integral\_expr\_v<I>}}}
\DoxyCodeLine{00017\ \ \ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{structluisa_1_1compute_1_1detail_1_1_shared_as_atomic_a6810b969e78dedf092b81e45dc8e4357}{atomic}}(I\ \&\&i)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00018\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}}\ =\ \mbox{\hyperlink{namespaceluisa_1_1compute_1_1dsl_ac6894281f79600b83c401fbf77ec3727}{def}}(std::forward<I>(i));}
\DoxyCodeLine{00019\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{sugar_8h_ae0940e50b16abd6b40d3cb35b1913da0}{shared}}\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keyword}{const\ }\mbox{\hyperlink{classluisa_1_1compute_1_1_shared}{Shared<T>}}\ *\textcolor{keyword}{>}(\textcolor{keyword}{this})-\/>expression();}
\DoxyCodeLine{00020\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classluisa_1_1compute_1_1detail_1_1_atomic_ref}{AtomicRef<T>}}\{\mbox{\hyperlink{classluisa_1_1compute_1_1detail_1_1_atomic_ref_node_a86966270ddf4cc0a9c19a59997d907b6}{AtomicRefNode::create}}(\mbox{\hyperlink{sugar_8h_ae0940e50b16abd6b40d3cb35b1913da0}{shared}})}
\DoxyCodeLine{00021\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/>access(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}}.expression())\};}
\DoxyCodeLine{00022\ \ \ \ \ \}}
\DoxyCodeLine{00023\ \};}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{comment}{//\ no-\/op\ for\ non-\/atomic\ types}}
\DoxyCodeLine{00026\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{keyword}{requires}\ \mbox{\hyperlink{namespaceluisa_1_1compute_ac7bd30fc63c519d1d3ad9b3abea9a31b}{is\_custom\_struct\_v<T>}}}
\DoxyCodeLine{00028\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structluisa_1_1compute_1_1detail_1_1_shared_as_atomic}{SharedAsAtomic}}<T>\ \{\};}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \}\textcolor{comment}{//\ namespace\ detail}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00033\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00034\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classluisa_1_1compute_1_1_shared_aaf2efe34be10bfb16298b53256dba8e4}{Shared}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{structluisa_1_1compute_1_1detail_1_1_shared_as_atomic}{detail::SharedAsAtomic}}<T>\ \{}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_ref_expr}{RefExpr}}\ *\mbox{\hyperlink{classluisa_1_1compute_1_1_shared_ae5f9a344f363a9978abe98531d6b1ecf}{\_expression}};}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_shared_a763f0c7a8beee89bd3d6cd4edde5ed66}{\_size}};}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keyword}{explicit}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_shared_aaf2efe34be10bfb16298b53256dba8e4}{Shared}}(\textcolor{keywordtype}{size\_t}\ n)\ noexcept}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{classluisa_1_1compute_1_1_shared_ae5f9a344f363a9978abe98531d6b1ecf}{\_expression}}\{\mbox{\hyperlink{classluisa_1_1compute_1_1detail_1_1_function_builder_a4590ef89abb9497192eb36510caf0384}{detail::FunctionBuilder::current}}()-\/>shared(}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Type::array(Type::of<T>(),\ n))\},}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \_size\{n\}\ \{\}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_shared_a235204fff6a475c6e90da5e5669e6767}{Shared}}(\mbox{\hyperlink{classluisa_1_1compute_1_1_shared_aaf2efe34be10bfb16298b53256dba8e4}{Shared}}\ \&\&)\ noexcept\ =\ \mbox{\hyperlink{sugar_8h_a6face89e97cccad5464dd9bb9c7efd23}{default}};}
\DoxyCodeLine{00048\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_shared_aaf2efe34be10bfb16298b53256dba8e4}{Shared}}(const\ \mbox{\hyperlink{classluisa_1_1compute_1_1_shared_aaf2efe34be10bfb16298b53256dba8e4}{Shared}}\ \&)\ noexcept\ =\ delete;}
\DoxyCodeLine{00049\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_shared_aaf2efe34be10bfb16298b53256dba8e4}{Shared}}\ \&operator=(\mbox{\hyperlink{classluisa_1_1compute_1_1_shared_aaf2efe34be10bfb16298b53256dba8e4}{Shared}}\ \&\&)\ noexcept\ =\ delete;}
\DoxyCodeLine{00050\ \ \ \ \ \mbox{\hyperlink{classluisa_1_1compute_1_1_shared_aaf2efe34be10bfb16298b53256dba8e4}{Shared}}\ \&operator=(const\ \mbox{\hyperlink{classluisa_1_1compute_1_1_shared_aaf2efe34be10bfb16298b53256dba8e4}{Shared}}\ \&)\ noexcept\ =\ delete;}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \ \ [[nodiscard]]\ auto\ \mbox{\hyperlink{classluisa_1_1compute_1_1_shared_a361b2b31cd17ba8f6ccfc7963a8e7d5d}{expression}}()\ const\ noexcept\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_shared_ae5f9a344f363a9978abe98531d6b1ecf}{\_expression}};\ \}}
\DoxyCodeLine{00053\ \ \ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_shared_a4ec09bdb4d3e65dc567cf0721f5a621f}{size}}()\ const\ noexcept\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_shared_a763f0c7a8beee89bd3d6cd4edde5ed66}{\_size}};\ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ U>}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \textcolor{keyword}{requires}\ \mbox{\hyperlink{namespaceluisa_1_1compute_a2e4127befb5af9644bdabcf03206d9a0}{is\_integral\_expr\_v<U>}}}
\DoxyCodeLine{00058\ \ \ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ \&\mbox{\hyperlink{classluisa_1_1compute_1_1_shared_a3f63f1af6def621964777c7470ac9c68}{operator[]}}(U\ \&\&\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}})\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ i\ =\ \mbox{\hyperlink{namespaceluisa_1_1compute_1_1dsl_ac6894281f79600b83c401fbf77ec3727}{def}}(std::forward<U>(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}}));}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ f\ =\ \mbox{\hyperlink{classluisa_1_1compute_1_1detail_1_1_function_builder_a4590ef89abb9497192eb36510caf0384}{detail::FunctionBuilder::current}}();}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ expr\ =\ f-\/>access(}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ Type::of<T>(),\ \mbox{\hyperlink{classluisa_1_1compute_1_1_shared_ae5f9a344f363a9978abe98531d6b1ecf}{\_expression}},\ i.expression());}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *f-\/>create\_temporary<\mbox{\hyperlink{structluisa_1_1compute_1_1_var}{Var<T>}}>(expr);}
\DoxyCodeLine{00064\ \ \ \ \ \}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ I>}
\DoxyCodeLine{00068\ \ \ \ \ [[nodiscard]]\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_shared_ade8bb9c9baeeb3b122a18936aed29b76}{read}}(I\ \&\&\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}})\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (*\textcolor{keyword}{this})[std::forward<I>(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_ab47dd9958bcadea08866b42bf358e95e}{index}})];}
\DoxyCodeLine{00070\ \ \ \ \ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ I,\ \textcolor{keyword}{typename}\ U>}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_shared_aecd8cf245e7af7ff0f1214989e473186}{write}}(I\ \&\&i,\ U\ \&\&u)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ (*this)[std::forward<I>(i)]\ =\ std::forward<U>(u);}
\DoxyCodeLine{00076\ \ \ \ \ \}}
\DoxyCodeLine{00077\ \};}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \}\textcolor{comment}{//\ namespace\ luisa::compute}}
\DoxyCodeLine{00080\ }

\end{DoxyCode}
