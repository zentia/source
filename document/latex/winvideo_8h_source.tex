\doxysection{winvideo.\+h}
\hypertarget{winvideo_8h_source}{}\label{winvideo_8h_source}\index{external/taskflow/3rd-\/party/tbb/examples/common/gui/winvideo.h@{external/taskflow/3rd-\/party/tbb/examples/common/gui/winvideo.h}}
\mbox{\hyperlink{winvideo_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ \ \ \ Copyright\ (c)\ 2005-\/2020\ Intel\ Corporation}}
\DoxyCodeLine{00003\ \textcolor{comment}{}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ \ \ \ Licensed\ under\ the\ Apache\ License,\ Version\ 2.0\ (the\ "{}License"{});}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ \ \ \ you\ may\ not\ use\ this\ file\ except\ in\ compliance\ with\ the\ License.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ \ \ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00007\ \textcolor{comment}{}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ \ \ \ \ \ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00009\ \textcolor{comment}{}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ \ \ \ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,\ software}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ \ \ \ distributed\ under\ the\ License\ is\ distributed\ on\ an\ "{}AS\ IS"{}\ BASIS,}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ \ \ \ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY\ KIND,\ either\ express\ or\ implied.}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ \ \ \ See\ the\ License\ for\ the\ specific\ language\ governing\ permissions\ and}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ \ \ \ limitations\ under\ the\ License.}}
\DoxyCodeLine{00015\ \textcolor{comment}{*/}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#ifndef\ \_\_WINVIDEO\_H\_\_}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#define\ \_\_WINVIDEO\_H\_\_}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#ifndef\ \_CRT\_SECURE\_NO\_DEPRECATE}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#define\ \_CRT\_SECURE\_NO\_DEPRECATE}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00026\ \textcolor{comment}{//\ Check\ that\ the\ target\ Windows\ version\ has\ all\ API\ calls\ required.}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#ifndef\ \_WIN32\_WINNT}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#\ define\ \_WIN32\_WINNT\ 0x0400}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#if\ \_WIN32\_WINNT<0x0400}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#\ define\ YIELD\_TO\_THREAD()\ Sleep(0)}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#\ define\ YIELD\_TO\_THREAD()\ SwitchToThread()}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{3rd-party_2tbb_2examples_2common_2gui_2video_8h}{video.h}}"{}}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ <fcntl.h>}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{_i_o_8h}{io.h}}>}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#include\ <fstream>}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#pragma\ comment(lib,\ "{}gdi32.lib"{})}}
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\#pragma\ comment(lib,\ "{}user32.lib"{})}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \textcolor{comment}{//\ maximum\ number\ of\ lines\ the\ output\ console\ should\ have}}
\DoxyCodeLine{00045\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ WORD\ \mbox{\hyperlink{winvideo_8h_ad76b79e3be6aa387deb3f29c6c829d78}{MAX\_CONSOLE\_LINES}}\ =\ 500;}
\DoxyCodeLine{00046\ \textcolor{keyword}{const}\ COLORREF\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{winvideo_8h_acf335cc857efa2997471176c6810b86f}{RGBKEY}}\ =\ \mbox{\hyperlink{external_2taskflow_2benchmarks_2mandelbrot_2main_8cpp_a0047db92027125c4b01079faf32751fa}{RGB}}(8,\ 8,\ 16);\ \textcolor{comment}{//\ at\ least\ 8\ for\ 16-\/bit\ palette}}
\DoxyCodeLine{00047\ HWND\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{winvideo_8h_ad772de9f056f9356480923aac98a28e6}{g\_hAppWnd}};\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ program's\ window\ handle}}
\DoxyCodeLine{00048\ HANDLE\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{winvideo_8h_a0e4305d458f94047976cb399bb78ab29}{g\_handles}}[2]\ =\ \{0,0\};\textcolor{comment}{//\ thread\ and\ wake\ up\ event}}
\DoxyCodeLine{00049\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ *\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{3rd-party_2tbb_2examples_2common_2gui_2convideo_8cpp_a9ae26019545cb6469324569543f0208e}{g\_pImg}}\ =\ 0;\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ drawing\ memory}}
\DoxyCodeLine{00050\ \textcolor{keywordtype}{int}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{3rd-party_2tbb_2examples_2common_2gui_2convideo_8cpp_ae6ee7234eaf9134004a6884bee71a11e}{g\_sizex}},\ \mbox{\hyperlink{3rd-party_2tbb_2examples_2common_2gui_2convideo_8cpp_ae1b139400b3643b86fa4865ff0dc6bbd}{g\_sizey}};}
\DoxyCodeLine{00051\ \textcolor{keyword}{static}\ \mbox{\hyperlink{classvideo}{video}}\ *\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{3rd-party_2tbb_2examples_2common_2gui_2convideo_8cpp_af99f47d66c19bc49b283046891e45f50}{g\_video}}\ =\ 0;}
\DoxyCodeLine{00052\ WNDPROC\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{winvideo_8h_a670957c12c479c1f07075ffdfdec29a5}{g\_pUserProc}}\ =\ 0;}
\DoxyCodeLine{00053\ HINSTANCE\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ video::win\_hInstance\ =\ 0;}
\DoxyCodeLine{00054\ \textcolor{keywordtype}{int}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ video::win\_iCmdShow\ =\ 0;}
\DoxyCodeLine{00055\ \textcolor{keyword}{static}\ WNDCLASSEX\ *\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{winvideo_8h_aab42e20a47405f21fc9e2ccd9f581738}{gWndClass}}\ =\ 0;}
\DoxyCodeLine{00056\ \textcolor{keyword}{static}\ HACCEL\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{winvideo_8h_ac352790a585fbfc3ef08867389acf864}{hAccelTable}}\ =\ 0;}
\DoxyCodeLine{00057\ \textcolor{keyword}{static}\ \mbox{\hyperlink{test__malloc__compliance_8cpp_ad342ac907eb044443153a22f964bf0af}{DWORD}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{winvideo_8h_a37093cc576dc8c9e6830b5905c76f9bd}{g\_msec}}\ =\ 0;}
\DoxyCodeLine{00058\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{3rd-party_2tbb_2examples_2common_2gui_2convideo_8cpp_ad9fbaad977906df110057e5df840880e}{g\_fps}}\ =\ 0,\ \mbox{\hyperlink{winvideo_8h_ab9c9e5fcf64421de61995d4ce7356279}{g\_updates}}\ =\ 0,\ \mbox{\hyperlink{winvideo_8h_a76518b937a9eb64f21365ad7e39d5112}{g\_skips}}\ =\ 0;}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{winvideo_8h_ae88103cf1c0cc6e464f1e2bb9cfdb463}{DisplayError}}(LPSTR\ lpstrErr,\ HRESULT\ hres\ =\ 0);\ \textcolor{comment}{//\ always\ returns\ false}}
\DoxyCodeLine{00061\ LRESULT\ CALLBACK\ \mbox{\hyperlink{winvideo_8h_a3f48635fc960f765cfe2c110b07d052e}{InternalWndProc}}(HWND\ hwnd,\ \mbox{\hyperlink{test__malloc__compliance_8cpp_a36cb3b01d81ffd844bbbfb54003e06ec}{UINT}}\ iMsg,\ WPARAM\ wParam,\ LPARAM\ lParam);}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00064\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{winvideo_8h_ac895044476afee23478a90a34169aea4}{WinInit}}(HINSTANCE\ hInstance,\ \textcolor{keywordtype}{int}\ nCmdShow,\ WNDCLASSEX\ *uwc,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *title,\ \textcolor{keywordtype}{bool}\ fixedsize)}
\DoxyCodeLine{00065\ \{}
\DoxyCodeLine{00066\ \ \ \ \ WNDCLASSEX\ wndclass;\ \ \textcolor{comment}{//\ Our\ app's\ windows\ class}}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keywordflow}{if}(uwc)\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ memcpy(\&wndclass,\ uwc,\ \textcolor{keyword}{sizeof}(wndclass));}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{winvideo_8h_a670957c12c479c1f07075ffdfdec29a5}{g\_pUserProc}}\ =\ uwc-\/>lpfnWndProc;}
\DoxyCodeLine{00070\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ memset(\&wndclass,\ 0,\ \textcolor{keyword}{sizeof}(wndclass));}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ wndclass.hCursor\ =\ LoadCursor(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ IDC\_ARROW);}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ wndclass.lpszClassName\ =\ title;}
\DoxyCodeLine{00074\ \ \ \ \ \}}
\DoxyCodeLine{00075\ \ \ \ \ wndclass.cbSize\ =\ \textcolor{keyword}{sizeof}(wndclass);}
\DoxyCodeLine{00076\ \ \ \ \ wndclass.hInstance\ =\ hInstance;}
\DoxyCodeLine{00077\ \ \ \ \ wndclass.lpfnWndProc\ =\ \mbox{\hyperlink{d2dvideo_8cpp_a3f48635fc960f765cfe2c110b07d052e}{InternalWndProc}};}
\DoxyCodeLine{00078\ \ \ \ \ wndclass.style\ |=\ CS\_HREDRAW\ |\ CS\_VREDRAW;}
\DoxyCodeLine{00079\ \ \ \ \ wndclass.hbrBackground\ =\ CreateSolidBrush(\mbox{\hyperlink{winvideo_8h_acf335cc857efa2997471176c6810b86f}{RGBKEY}});}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordflow}{if}(\ !RegisterClassExA(\&wndclass)\ )\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordtype}{int}\ xaddend\ =\ GetSystemMetrics(fixedsize?SM\_CXFIXEDFRAME:SM\_CXFRAME)*2;}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keywordtype}{int}\ yaddend\ =\ GetSystemMetrics(fixedsize?SM\_CYFIXEDFRAME:SM\_CYFRAME)*2\ +\ GetSystemMetrics(SM\_CYCAPTION);}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keywordflow}{if}(wndclass.lpszMenuName)\ yaddend\ +=\ GetSystemMetrics(SM\_CYMENU);}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{comment}{//\ Setup\ the\ new\ window's\ physical\ parameters\ -\/\ and\ tell\ Windows\ to\ create\ it}}
\DoxyCodeLine{00087\ \ \ \ \ \mbox{\hyperlink{winvideo_8h_ad772de9f056f9356480923aac98a28e6}{g\_hAppWnd}}\ =\ CreateWindowA(wndclass.lpszClassName,\ \ \textcolor{comment}{//\ Window\ class\ name}}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ title,\ \ \textcolor{comment}{//\ Window\ caption}}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ !fixedsize\ ?\ WS\_OVERLAPPEDWINDOW\ :\ \ \textcolor{comment}{//\ Window\ style}}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ WS\_OVERLAPPED|WS\_CAPTION|WS\_SYSMENU|WS\_MINIMIZEBOX,}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CW\_USEDEFAULT,\ \ \textcolor{comment}{//\ Initial\ x\ pos:\ use\ default\ placement}}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Initial\ y\ pos:\ not\ used\ here}}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{3rd-party_2tbb_2examples_2common_2gui_2convideo_8cpp_ae6ee7234eaf9134004a6884bee71a11e}{g\_sizex}}+xaddend,\textcolor{comment}{//\ Initial\ x\ size}}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{3rd-party_2tbb_2examples_2common_2gui_2convideo_8cpp_ae1b139400b3643b86fa4865ff0dc6bbd}{g\_sizey}}+yaddend,\textcolor{comment}{//\ Initial\ y\ size}}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \ \ \ \ \ \textcolor{comment}{//\ parent\ window\ handle}}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \ \ \ \ \ \textcolor{comment}{//\ window\ menu\ handle}}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ hInstance,\ \textcolor{comment}{//\ program\ instance\ handle}}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});\ \ \ \ \ \textcolor{comment}{//\ Creation\ parameters}}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{winvideo_8h_ad772de9f056f9356480923aac98a28e6}{g\_hAppWnd}}\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00100\ \}}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00103\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{winvideo_8h_ac5d7fe331916bd5198a0d7f6f20cfdc8}{RedirectIOToConsole}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{00104\ \{}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keywordtype}{int}\ hConHandle;\ \textcolor{keywordtype}{size\_t}\ lStdHandle;}
\DoxyCodeLine{00106\ \ \ \ \ CONSOLE\_SCREEN\_BUFFER\_INFO\ coninfo;}
\DoxyCodeLine{00107\ \ \ \ \ FILE\ *fp;}
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{comment}{//\ allocate\ a\ console\ for\ this\ app}}
\DoxyCodeLine{00109\ \ \ \ \ AllocConsole();}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{comment}{//\ set\ the\ screen\ buffer\ to\ be\ big\ enough\ to\ let\ us\ scroll\ text}}
\DoxyCodeLine{00112\ \ \ \ \ GetConsoleScreenBufferInfo(GetStdHandle(STD\_OUTPUT\_HANDLE),\ \&coninfo);}
\DoxyCodeLine{00113\ \ \ \ \ coninfo.dwSize.Y\ =\ \mbox{\hyperlink{winvideo_8h_ad76b79e3be6aa387deb3f29c6c829d78}{MAX\_CONSOLE\_LINES}};}
\DoxyCodeLine{00114\ \ \ \ \ SetConsoleScreenBufferSize(GetStdHandle(STD\_OUTPUT\_HANDLE),\ coninfo.dwSize);}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{comment}{//\ redirect\ unbuffered\ STDOUT\ to\ the\ console}}
\DoxyCodeLine{00117\ \ \ \ \ lStdHandle\ =\ (size\_t)GetStdHandle(STD\_OUTPUT\_HANDLE);}
\DoxyCodeLine{00118\ \ \ \ \ hConHandle\ =\ \_open\_osfhandle(lStdHandle,\ \_O\_TEXT);}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keywordflow}{if}(hConHandle\ <=\ 0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00120\ \ \ \ \ fp\ =\ \_fdopen(\ hConHandle,\ \textcolor{stringliteral}{"{}w"{}}\ );}
\DoxyCodeLine{00121\ \ \ \ \ *stdout\ =\ *fp;}
\DoxyCodeLine{00122\ \ \ \ \ setvbuf(\ stdout,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \_IONBF,\ 0\ );}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{comment}{//\ redirect\ unbuffered\ STDERR\ to\ the\ console}}
\DoxyCodeLine{00125\ \ \ \ \ lStdHandle\ =\ (size\_t)GetStdHandle(STD\_ERROR\_HANDLE);}
\DoxyCodeLine{00126\ \ \ \ \ hConHandle\ =\ \_open\_osfhandle(lStdHandle,\ \_O\_TEXT);}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keywordflow}{if}(hConHandle\ >\ 0)\ \{}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ fp\ =\ \_fdopen(\ hConHandle,\ \textcolor{stringliteral}{"{}w"{}}\ );}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ *stderr\ =\ *fp;}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ setvbuf(\ stderr,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \_IONBF,\ 0\ );}
\DoxyCodeLine{00131\ \ \ \ \ \}}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{comment}{//\ redirect\ unbuffered\ STDIN\ to\ the\ console}}
\DoxyCodeLine{00134\ \ \ \ \ lStdHandle\ =\ (size\_t)GetStdHandle(STD\_INPUT\_HANDLE);}
\DoxyCodeLine{00135\ \ \ \ \ hConHandle\ =\ \_open\_osfhandle(lStdHandle,\ \_O\_TEXT);}
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keywordflow}{if}(hConHandle\ >\ 0)\ \{}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ fp\ =\ \_fdopen(\ hConHandle,\ \textcolor{stringliteral}{"{}r"{}}\ );}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ *stdin\ =\ *fp;}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ setvbuf(\ stdin,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \_IONBF,\ 0\ );}
\DoxyCodeLine{00140\ \ \ \ \ \}}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{comment}{//\ make\ cout,\ wcout,\ cin,\ wcin,\ wcerr,\ cerr,\ wclog\ and\ clog}}
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{comment}{//\ point\ to\ console\ as\ well}}
\DoxyCodeLine{00144\ \ \ \ \ std::ios::sync\_with\_stdio();}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00146\ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \mbox{\hyperlink{classvideo_a6cae9b4ab405e8c97f868c9526c30311}{video::video}}()}
\DoxyCodeLine{00150\ \ \ \ \ :\ \mbox{\hyperlink{namespacesource__module_1_1render_aea82ec9583bfc81911e9f764680fa9c7a12a055bf01a31369fe81ac35d85c7bc1}{depth}}(24),\ red\_shift(16),\ green\_shift(8),\ blue\_shift(0),}
\DoxyCodeLine{00151\ \ \ \ \ \ \ red\_mask(0xff0000),\ green\_mask(0xff00),\ blue\_mask(0xff)}
\DoxyCodeLine{00152\ \{}
\DoxyCodeLine{00153\ \ \ \ \ assert(\mbox{\hyperlink{3rd-party_2tbb_2examples_2common_2gui_2convideo_8cpp_af99f47d66c19bc49b283046891e45f50}{g\_video}}\ ==\ 0);}
\DoxyCodeLine{00154\ \ \ \ \ \mbox{\hyperlink{3rd-party_2tbb_2examples_2common_2gui_2convideo_8cpp_af99f47d66c19bc49b283046891e45f50}{g\_video}}\ =\ \textcolor{keyword}{this};\ title\ =\ \textcolor{stringliteral}{"{}Video"{}};\ \mbox{\hyperlink{empty_8c_af1f449cc09f8d36befcce07bc38c29c0}{running}}\ =\ threaded\ =\ calc\_fps\ =\ \textcolor{keyword}{false};\ updating\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00155\ \}}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00158\ \textcolor{keywordtype}{void}\ video::win\_set\_class(WNDCLASSEX\ \&wcex)}
\DoxyCodeLine{00159\ \{}
\DoxyCodeLine{00160\ \ \ \ \ \mbox{\hyperlink{winvideo_8h_aab42e20a47405f21fc9e2ccd9f581738}{gWndClass}}\ =\ \&wcex;}
\DoxyCodeLine{00161\ \}}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \textcolor{keywordtype}{void}\ video::win\_load\_accelerators(\textcolor{keywordtype}{int}\ idc)}
\DoxyCodeLine{00164\ \{}
\DoxyCodeLine{00165\ \ \ \ \ \mbox{\hyperlink{winvideo_8h_ac352790a585fbfc3ef08867389acf864}{hAccelTable}}\ =\ LoadAccelerators(win\_hInstance,\ MAKEINTRESOURCE(idc));}
\DoxyCodeLine{00166\ \}}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classvideo_adf4c9da52e37d92fec1e34bbe3f6afbd}{video::init\_console}}()}
\DoxyCodeLine{00169\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{winvideo_8h_ac5d7fe331916bd5198a0d7f6f20cfdc8}{RedirectIOToConsole}}())\ \{}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!\mbox{\hyperlink{sandbox_2seismic_2video_8h_a9ae26019545cb6469324569543f0208e}{g\_pImg}}\ \&\&\ \mbox{\hyperlink{sandbox_2seismic_2video_8h_ae6ee7234eaf9134004a6884bee71a11e}{g\_sizex}}\ \&\&\ \mbox{\hyperlink{sandbox_2seismic_2video_8h_ae1b139400b3643b86fa4865ff0dc6bbd}{g\_sizey}})}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{sandbox_2seismic_2video_8h_a9ae26019545cb6469324569543f0208e}{g\_pImg}}\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}[\mbox{\hyperlink{sandbox_2seismic_2video_8h_ae6ee7234eaf9134004a6884bee71a11e}{g\_sizex}}\ *\ \mbox{\hyperlink{sandbox_2seismic_2video_8h_ae1b139400b3643b86fa4865ff0dc6bbd}{g\_sizey}}];}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{sandbox_2seismic_2video_8h_a9ae26019545cb6469324569543f0208e}{g\_pImg}})\ \mbox{\hyperlink{classvideo_a425f3ca7a2d288c84ccae73ebb49f345}{running}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00175\ \ \ \ \ \}}
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00177\ \}}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \mbox{\hyperlink{classvideo_a608d56a8dda3f7c4018cd3688acfb34f}{video::\string~video}}()}
\DoxyCodeLine{00180\ \{}
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{3rd-party_2tbb_2examples_2common_2gui_2convideo_8cpp_af99f47d66c19bc49b283046891e45f50}{g\_video}})\ \mbox{\hyperlink{classvideo_a49fe2b2eefd1118d871120ec787d355a}{terminate}}();}
\DoxyCodeLine{00182\ \}}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \mbox{\hyperlink{test__malloc__compliance_8cpp_ad342ac907eb044443153a22f964bf0af}{DWORD}}\ WINAPI\ \mbox{\hyperlink{winvideo_8h_af1d249d7dd2265d7d39f1c3bd9d26c9b}{thread\_video}}(\mbox{\hyperlink{dllmain_8cpp_acf9c20c2bdffd2b6a2870e833c78e71f}{LPVOID}}\ lpParameter)}
\DoxyCodeLine{00185\ \{}
\DoxyCodeLine{00186\ \ \ \ \ \mbox{\hyperlink{classvideo}{video}}\ *\mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}}\ =\ (\mbox{\hyperlink{classvideo}{video}}*)lpParameter;}
\DoxyCodeLine{00187\ \ \ \ \ \mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}}-\/>on\_process();}
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00189\ \}}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{winvideo_8h_aa4758a3b524a0c3a7f7db5bf9ea711db}{loop\_once}}(\mbox{\hyperlink{classvideo}{video}}\ *\mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}})}
\DoxyCodeLine{00192\ \{}
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{comment}{//\ screen\ update\ notify}}
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{keywordflow}{if}(\textcolor{keywordtype}{int}\ updates\ =\ \mbox{\hyperlink{winvideo_8h_ab9c9e5fcf64421de61995d4ce7356279}{g\_updates}})\ \{}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{winvideo_8h_ab9c9e5fcf64421de61995d4ce7356279}{g\_updates}}\ =\ 0;}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{3rd-party_2tbb_2examples_2common_2gui_2convideo_8cpp_af99f47d66c19bc49b283046891e45f50}{g\_video}}-\/>updating)\ \{\ \mbox{\hyperlink{winvideo_8h_a76518b937a9eb64f21365ad7e39d5112}{g\_skips}}\ +=\ updates-\/1;\ \mbox{\hyperlink{3rd-party_2tbb_2examples_2common_2gui_2convideo_8cpp_ad9fbaad977906df110057e5df840880e}{g\_fps}}++;\ \}}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \mbox{\hyperlink{winvideo_8h_a76518b937a9eb64f21365ad7e39d5112}{g\_skips}}\ +=\ updates;}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ UpdateWindow(\mbox{\hyperlink{winvideo_8h_ad772de9f056f9356480923aac98a28e6}{g\_hAppWnd}});}
\DoxyCodeLine{00199\ \ \ \ \ \}}
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{comment}{//\ update\ fps}}
\DoxyCodeLine{00201\ \ \ \ \ \mbox{\hyperlink{test__malloc__compliance_8cpp_ad342ac907eb044443153a22f964bf0af}{DWORD}}\ msec\ =\ GetTickCount();}
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}}-\/>calc\_fps\ \&\&\ msec\ >=\ \mbox{\hyperlink{winvideo_8h_a37093cc576dc8c9e6830b5905c76f9bd}{g\_msec}}+1000)\ \{}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ sec\ =\ (msec\ -\/\ \mbox{\hyperlink{winvideo_8h_a37093cc576dc8c9e6830b5905c76f9bd}{g\_msec}})/1000.0;}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ \mbox{\hyperlink{sugar_8h_aaadc06b5dac8070de2c8677210967bdb}{buffer}}[256],\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ =\ \_snprintf(\mbox{\hyperlink{sugar_8h_aaadc06b5dac8070de2c8677210967bdb}{buffer}},\ 128,\ \textcolor{stringliteral}{"{}\%s:\ \%d\ fps"{}},\ \mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}}-\/>title,\ \textcolor{keywordtype}{int}(\textcolor{keywordtype}{double}(\mbox{\hyperlink{3rd-party_2tbb_2examples_2common_2gui_2convideo_8cpp_ad9fbaad977906df110057e5df840880e}{g\_fps}}\ +\ \mbox{\hyperlink{winvideo_8h_a76518b937a9eb64f21365ad7e39d5112}{g\_skips}})/sec));}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{winvideo_8h_a76518b937a9eb64f21365ad7e39d5112}{g\_skips}})\ \_snprintf(\mbox{\hyperlink{sugar_8h_aaadc06b5dac8070de2c8677210967bdb}{buffer}}+\mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}},\ 128,\ \textcolor{stringliteral}{"{}\ -\/\ \%d\ skipped\ =\ \%d\ updates"{}},\ \textcolor{keywordtype}{int}(\mbox{\hyperlink{winvideo_8h_a76518b937a9eb64f21365ad7e39d5112}{g\_skips}}/sec),\ \textcolor{keywordtype}{int}(\mbox{\hyperlink{3rd-party_2tbb_2examples_2common_2gui_2convideo_8cpp_ad9fbaad977906df110057e5df840880e}{g\_fps}}/sec));}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ SetWindowTextA(\mbox{\hyperlink{winvideo_8h_ad772de9f056f9356480923aac98a28e6}{g\_hAppWnd}},\ \mbox{\hyperlink{sugar_8h_aaadc06b5dac8070de2c8677210967bdb}{buffer}});}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{winvideo_8h_a37093cc576dc8c9e6830b5905c76f9bd}{g\_msec}}\ =\ msec;\ \mbox{\hyperlink{winvideo_8h_a76518b937a9eb64f21365ad7e39d5112}{g\_skips}}\ =\ \mbox{\hyperlink{3rd-party_2tbb_2examples_2common_2gui_2convideo_8cpp_ad9fbaad977906df110057e5df840880e}{g\_fps}}\ =\ 0;}
\DoxyCodeLine{00208\ \ \ \ \ \}}
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{comment}{//\ event\ processing,\ including\ painting}}
\DoxyCodeLine{00210\ \ \ \ \ MSG\ msg;}
\DoxyCodeLine{00211\ \ \ \ \ \textcolor{keywordflow}{if}(PeekMessage(\&msg,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ 0,\ 0,\ PM\_REMOVE))\{}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ msg.message\ ==\ WM\_QUIT\ )\ \{\ \mbox{\hyperlink{_cwise__arg_8cpp_a49bb5a0db288a22a099643d44c5abbd6}{v}}-\/>running\ =\ \textcolor{keyword}{false};\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \}}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ !\mbox{\hyperlink{winvideo_8h_ac352790a585fbfc3ef08867389acf864}{hAccelTable}}\ ||\ !TranslateAccelerator(msg.hwnd,\ \mbox{\hyperlink{winvideo_8h_ac352790a585fbfc3ef08867389acf864}{hAccelTable}},\ \&msg)\ )\{}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ TranslateMessage(\&msg);}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ DispatchMessage(\&msg);}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};\ \textcolor{comment}{//\ try\ again}}
\DoxyCodeLine{00218\ \ \ \ \ \}}
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00220\ \}}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00223\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classvideo_a664f8ebc86f954bb4435c34b62116611}{video::main\_loop}}()}
\DoxyCodeLine{00224\ \{}
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{comment}{//\ let\ Windows\ draw\ and\ unroll\ the\ window}}
\DoxyCodeLine{00226\ \ \ \ \ InvalidateRect(\mbox{\hyperlink{winvideo_8h_ad772de9f056f9356480923aac98a28e6}{g\_hAppWnd}},\ 0,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00227\ \ \ \ \ \mbox{\hyperlink{winvideo_8h_a37093cc576dc8c9e6830b5905c76f9bd}{g\_msec}}\ =\ GetTickCount();\ \textcolor{comment}{//\ let's\ stay\ for\ 0,5\ sec}}
\DoxyCodeLine{00228\ \ \ \ \ \textcolor{keywordflow}{while}(\mbox{\hyperlink{winvideo_8h_a37093cc576dc8c9e6830b5905c76f9bd}{g\_msec}}\ +\ 500\ >\ GetTickCount())\ \{\ \mbox{\hyperlink{winvideo_8h_aa4758a3b524a0c3a7f7db5bf9ea711db}{loop\_once}}(\textcolor{keyword}{this});\ \mbox{\hyperlink{namespace_harness_a6109bacdcb4cd184d842b933d7fb18a4}{Sleep}}(1);\ \}}
\DoxyCodeLine{00229\ \ \ \ \ \mbox{\hyperlink{winvideo_8h_a37093cc576dc8c9e6830b5905c76f9bd}{g\_msec}}\ =\ GetTickCount();}
\DoxyCodeLine{00230\ \ \ \ \ \textcolor{comment}{//\ now,\ start\ main\ process}}
\DoxyCodeLine{00231\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{classvideo_ac4a3b59a0178b3296aed23fa0950afa3}{threaded}})\ \{}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{winvideo_8h_a0e4305d458f94047976cb399bb78ab29}{g\_handles}}[0]\ =\ CreateThread\ (}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ LPSECURITY\_ATTRIBUTES\ security\_attrs}}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \ \ 0,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ SIZE\_T\ stacksize}}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ \ \ (LPTHREAD\_START\_ROUTINE)\ \mbox{\hyperlink{winvideo_8h_af1d249d7dd2265d7d39f1c3bd9d26c9b}{thread\_video}},}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{this},\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ argument}}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ 0,\ 0);}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(!\mbox{\hyperlink{winvideo_8h_a0e4305d458f94047976cb399bb78ab29}{g\_handles}}[0])\ \{\ \mbox{\hyperlink{d2dvideo_8cpp_a7f79c2d3b461307d16c21c5b5262f1a5}{DisplayError}}(\textcolor{stringliteral}{"{}Can't\ create\ thread"{}});\ \textcolor{keywordflow}{return};\ \}}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{//\ harmless\ race\ is\ possible\ here}}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{winvideo_8h_a0e4305d458f94047976cb399bb78ab29}{g\_handles}}[1]\ =\ \mbox{\hyperlink{namespaceluisa_1_1compute_a7847a34a0e69b26e787bfab2d054d908a76d511491e72fc60d92ae89dcda09930}{CreateEvent}}(\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ \textcolor{keyword}{false},\ \textcolor{keyword}{false},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\mbox{\hyperlink{classvideo_a425f3ca7a2d288c84ccae73ebb49f345}{running}})\ \{}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\mbox{\hyperlink{winvideo_8h_aa4758a3b524a0c3a7f7db5bf9ea711db}{loop\_once}}(\textcolor{keyword}{this}));}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{winvideo_8h_ac4fdeaebb0d73cd4efb68ae51ca69979}{YIELD\_TO\_THREAD}}();\ \textcolor{comment}{//\ give\ time\ for\ processing\ when\ running\ on\ single\ CPU}}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{test__malloc__compliance_8cpp_ad342ac907eb044443153a22f964bf0af}{DWORD}}\ \mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}}\ =\ MsgWaitForMultipleObjects(2,\ \mbox{\hyperlink{winvideo_8h_a0e4305d458f94047976cb399bb78ab29}{g\_handles}},\ \textcolor{keyword}{false},\ INFINITE,\ QS\_ALLINPUT\string^QS\_MOUSEMOVE);}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}}\ ==\ WAIT\_OBJECT\_0)\ \textcolor{keywordflow}{break};\ \textcolor{comment}{//\ thread\ terminated}}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classvideo_a425f3ca7a2d288c84ccae73ebb49f345}{running}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(WaitForSingleObject(\mbox{\hyperlink{winvideo_8h_a0e4305d458f94047976cb399bb78ab29}{g\_handles}}[0],\ 3000)\ ==\ WAIT\_TIMEOUT)\{}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ there\ was\ not\ enough\ time\ for\ graceful\ shutdown,\ killing\ the\ example\ with\ code\ 1.}}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \ \ exit(1);}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{winvideo_8h_a0e4305d458f94047976cb399bb78ab29}{g\_handles}}[0])\ CloseHandle(\mbox{\hyperlink{winvideo_8h_a0e4305d458f94047976cb399bb78ab29}{g\_handles}}[0]);}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{winvideo_8h_a0e4305d458f94047976cb399bb78ab29}{g\_handles}}[1])\ CloseHandle(\mbox{\hyperlink{winvideo_8h_a0e4305d458f94047976cb399bb78ab29}{g\_handles}}[1]);}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{winvideo_8h_a0e4305d458f94047976cb399bb78ab29}{g\_handles}}[0]\ =\ \mbox{\hyperlink{winvideo_8h_a0e4305d458f94047976cb399bb78ab29}{g\_handles}}[1]\ =\ 0;}
\DoxyCodeLine{00255\ \ \ \ \ \}}
\DoxyCodeLine{00256\ \ \ \ \ \textcolor{keywordflow}{else}\ \mbox{\hyperlink{classvideo_a9cd55e23921c925eb2c912e40df96d05}{on\_process}}();}
\DoxyCodeLine{00257\ \}}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00260\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classvideo_a267748c31dee7dd46d47b575373959db}{video::next\_frame}}()}
\DoxyCodeLine{00261\ \{}
\DoxyCodeLine{00262\ \ \ \ \ \textcolor{keywordflow}{if}(!\mbox{\hyperlink{classvideo_a425f3ca7a2d288c84ccae73ebb49f345}{running}})\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00263\ \ \ \ \ \mbox{\hyperlink{winvideo_8h_ab9c9e5fcf64421de61995d4ce7356279}{g\_updates}}++;\ \textcolor{comment}{//\ Fast\ but\ inaccurate\ counter.\ The\ data\ race\ here\ is\ benign.}}
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{keywordflow}{if}(!\mbox{\hyperlink{classvideo_ac4a3b59a0178b3296aed23fa0950afa3}{threaded}})\ \textcolor{keywordflow}{while}(\mbox{\hyperlink{winvideo_8h_aa4758a3b524a0c3a7f7db5bf9ea711db}{loop\_once}}(\textcolor{keyword}{this}));}
\DoxyCodeLine{00265\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\mbox{\hyperlink{winvideo_8h_a0e4305d458f94047976cb399bb78ab29}{g\_handles}}[1])\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ SetEvent(\mbox{\hyperlink{winvideo_8h_a0e4305d458f94047976cb399bb78ab29}{g\_handles}}[1]);}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{winvideo_8h_ac4fdeaebb0d73cd4efb68ae51ca69979}{YIELD\_TO\_THREAD}}();}
\DoxyCodeLine{00268\ \ \ \ \ \}}
\DoxyCodeLine{00269\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00270\ \}}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00273\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classvideo_ad46516b8ba69923d9cd0eb5102addfca}{video::show\_title}}()}
\DoxyCodeLine{00274\ \{}
\DoxyCodeLine{00275\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{winvideo_8h_ad772de9f056f9356480923aac98a28e6}{g\_hAppWnd}})}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ SetWindowTextA(\mbox{\hyperlink{winvideo_8h_ad772de9f056f9356480923aac98a28e6}{g\_hAppWnd}},\ \mbox{\hyperlink{classvideo_a12471420e7efc9a1c3c5e1c8b6571191}{title}});}
\DoxyCodeLine{00277\ \}}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00279\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\_\_WINVIDEO\_H\_\_}}

\end{DoxyCode}
