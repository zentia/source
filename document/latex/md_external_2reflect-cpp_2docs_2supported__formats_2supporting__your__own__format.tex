\chapter{Supporting your own format}
\hypertarget{md_external_2reflect-cpp_2docs_2supported__formats_2supporting__your__own__format}{}\label{md_external_2reflect-cpp_2docs_2supported__formats_2supporting__your__own__format}\index{Supporting your own format@{Supporting your own format}}
\label{md_external_2reflect-cpp_2docs_2supported__formats_2supporting__your__own__format_autotoc_md671}%
\Hypertarget{md_external_2reflect-cpp_2docs_2supported__formats_2supporting__your__own__format_autotoc_md671}%


In order to support your own serialization format, you need to implement a reader and a writer on top of whatever serialization libary you have chosen.

The reader and writer constitute a thin layer between the serialization library of your choice and reflect-\/cpp.

The requirements are laid down in the concepts \href{https://github.com/getml/reflect-cpp/blob/main/include/rfl/parsing/IsReader.hpp}{\texttt{ Is\+Reader}} and \href{https://github.com/getml/reflect-cpp/blob/main/include/rfl/parsing/IsWriter.hpp}{\texttt{ Is\+Writer}} and also documented below.

Using the reader and the writer you can define your parser like this\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{\textcolor{keyword}{using\ }YourParser\ =\ \mbox{\hyperlink{structrfl_1_1parsing_1_1_parser}{rfl::parsing::Parser<YourReader,\ YourWriter,\ T>}};}

\end{DoxyCode}


This can then be used to implement a {\ttfamily read} function and a {\ttfamily write} function\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using\ }\mbox{\hyperlink{namespacerfl_1_1avro_a1b87f8b534d31b79c6cdcb844cc0ff8f}{InputVarType}}\ =\ \textcolor{keyword}{typename}\ YourReader::InputVarType;}
\DoxyCodeLine{\textcolor{keyword}{using\ }OutputVarType\ =\ \textcolor{keyword}{typename}\ YourWriter::OutputVarType;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{\mbox{\hyperlink{classrfl_1_1_result}{rfl::Result<T>}}\ \mbox{\hyperlink{json_2write__and__read_8hpp_a120a0c0f4f8f27e389e841e6f5f6efcd}{read}}(\textcolor{keyword}{const}\ std::string\&\ \_str)\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ This\ should\ be\ supported\ by\ whatever\ library\ you\ are}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ using\ for\ your\ format.}}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{namespacerfl_1_1avro_a1b87f8b534d31b79c6cdcb844cc0ff8f}{InputVarType}}\ \mbox{\hyperlink{namespacempfr_ad838087b4c59a17f714c4da9984aea66}{root}}\ =\ str\_to\_input\_var(\_str);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ You\ can\ pass\ variables\ to\ the\ constructor,\ if\ necessary}}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{const}\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}}\ =\ Reader(...);\ }
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{return}\ YourParser<T>::read(\mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}},\ root);}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{std::string\ \mbox{\hyperlink{json_2write__and__read_8hpp_a8d72d49ed34d37da786334a55f22b909}{write}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\&\ \_obj)\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ You\ can\ pass\ variables\ to\ the\ constructor,\ if\ necessary}}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}}\ =\ Writer(...);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ OutputVarType\ var\ =\ Parser<T>::write(\mbox{\hyperlink{_matrix__resize__int_8cpp_aab236ce080522c9832217fd5f157541b}{w}},\ \_obj);}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ This\ should\ be\ supported\ by\ whatever\ library\ you\ are}}
\DoxyCodeLine{\ \ \ \ \textcolor{comment}{//\ using\ for\ your\ format.}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{return}\ output\_var\_to\_str(var);}
\DoxyCodeLine{\}}

\end{DoxyCode}


In the following two sections, we will provide templates for your {\ttfamily Reader} and {\ttfamily Writer}. You should probably just copy + paste this into your own code and fill in the blanks.

As a reference, you can take a look at how this is done for JSON\+: \href{https://github.com/getml/reflect-cpp/tree/main/include/rfl/json}{\texttt{ https\+://github.\+com/getml/reflect-\/cpp/tree/main/include/rfl/json}}\hypertarget{md_external_2reflect-cpp_2docs_2supported__formats_2supporting__your__own__format_autotoc_md672}{}\doxysection{\texorpdfstring{Implementing your own writer}{Implementing your own writer}}\label{md_external_2reflect-cpp_2docs_2supported__formats_2supporting__your__own__format_autotoc_md672}
Because writers are somewhat simpler, we will start with them.

Any Writer needs to define the following types\+:

1) An {\ttfamily Output\+Array\+Type}, which must be an array-\/like data structure. 2) An {\ttfamily Output\+Object\+Type}, which must contain key-\/value pairs. 3) An {\ttfamily Output\+Var\+Type}, which must be able to represent either {\ttfamily Output\+Array\+Type}, {\ttfamily Output\+Object\+Type} or a basic type (bool, integral, floating point, std\+::string). We hesitate to call these "{}primitive types"{}, because primitive types in C++ are defined as a slightly different group of types.

It also needs to support the following methods\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{struct\ }Writer\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{using\ }OutputArrayType\ =\ ...;}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{using\ }OutputObjectType\ =\ ...;}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{using\ }OutputVarType\ =\ ...;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputArrayType\ array\_as\_root(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \_size)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputObjectType\ object\_as\_root(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \_size)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputVarType\ null\_as\_root()\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ template\ <class\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}>}
\DoxyCodeLine{\ \ OutputVarType\ value\_as\_root(const\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\&\ \_var)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputArrayType\ add\_array\_to\_array(const\ \textcolor{keywordtype}{size\_t}\ \_size,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OutputArrayType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputArrayType\ add\_array\_to\_object(}
\DoxyCodeLine{\ \ \ \ \ \ const\ std::\mbox{\hyperlink{runtime_2spdlog_2include_2spdlog_2fmt_2bundled_2base_8h_a204ca715c2febee035464fa53dfc50c4}{string\_view}}\&\ \_name,\ const\ \textcolor{keywordtype}{size\_t}\ \_size,}
\DoxyCodeLine{\ \ \ \ \ \ OutputObjectType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputObjectType\ add\_object\_to\_array(}
\DoxyCodeLine{\ \ \ \ \ \ const\ \textcolor{keywordtype}{size\_t}\ \_size,\ OutputArrayType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputObjectType\ add\_object\_to\_object(}
\DoxyCodeLine{\ \ \ \ \ \ const\ std::\mbox{\hyperlink{runtime_2spdlog_2include_2spdlog_2fmt_2bundled_2base_8h_a204ca715c2febee035464fa53dfc50c4}{string\_view}}\&\ \_name,\ const\ \textcolor{keywordtype}{size\_t}\ \_size,}
\DoxyCodeLine{\ \ \ \ \ \ OutputObjectType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ template\ <class\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}>}
\DoxyCodeLine{\ \ OutputVarType\ add\_value\_to\_array(const\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\&\ \_var,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OutputArrayType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ template\ <class\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}>}
\DoxyCodeLine{\ \ OutputVarType\ add\_value\_to\_object(const\ std::\mbox{\hyperlink{runtime_2spdlog_2include_2spdlog_2fmt_2bundled_2base_8h_a204ca715c2febee035464fa53dfc50c4}{string\_view}}\&\ \_name,\ const\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\&\ \_var,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OutputObjectType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputVarType\ add\_null\_to\_array(OutputArrayType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputVarType\ add\_null\_to\_object(const\ std::\mbox{\hyperlink{runtime_2spdlog_2include_2spdlog_2fmt_2bundled_2base_8h_a204ca715c2febee035464fa53dfc50c4}{string\_view}}\&\ \_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OutputObjectType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \textcolor{keywordtype}{void}\ end\_array(OutputArrayType*\ \_arr)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \textcolor{keywordtype}{void}\ end\_object(OutputObjectType*\ \_obj)\ const\ noexcept;}
\DoxyCodeLine{\};}

\end{DoxyCode}
\hypertarget{md_external_2reflect-cpp_2docs_2supported__formats_2supporting__your__own__format_autotoc_md673}{}\doxysection{\texorpdfstring{Implementing your own reader}{Implementing your own reader}}\label{md_external_2reflect-cpp_2docs_2supported__formats_2supporting__your__own__format_autotoc_md673}
Any Reader needs to define the following\+:

1) An {\ttfamily Input\+Array\+Type}, which must be an array-\/like data structure. 2) An {\ttfamily Input\+Object\+Type}, which must contain key-\/value pairs. 3) An {\ttfamily Input\+Var\+Type}, which must be able to represent either {\ttfamily Input\+Array\+Type}, {\ttfamily Input\+Object\+Type} or a basic type (bool, integral, floating point, std\+::string). 4) \doxylink{bench__gemm_8cpp_addc86e8508f14411ec98f521c520f875}{A} {\ttfamily static constexpr bool has\+\_\+custom\+\_\+constructor\texorpdfstring{$<$}{<}T\texorpdfstring{$>$}{>}}, that determines whether the class in question as a custom constructor, which might be called something like {\ttfamily from\+\_\+json\+\_\+obj(...)}. If you do not want to support this functionality, just set it to false.

It also needs to support the following methods\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{struct\ }Reader\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{using\ }InputArrayType\ =\ ...;}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacerfl_1_1avro_a912d5818c6c05fc5ea6268fba009a59f}{InputObjectType}}\ =\ ...;}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacerfl_1_1avro_a1b87f8b534d31b79c6cdcb844cc0ff8f}{InputVarType}}\ =\ ...;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{bool}\ has\_custom\_constructor\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ rfl::Result<InputVarType>\ get\_field\_from\_array(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \_idx,\ \textcolor{keyword}{const}\ InputArrayType\ \_arr)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{...\}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ rfl::Result<InputVarType>\ get\_field\_from\_object(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\&\ \_name,\ \textcolor{keyword}{const}\ InputObjectType\&\ \_obj)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{...\}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{namespacerfl_1_1internal_a818161434e9e7892d403a7c92d7268fe}{is\_empty}}(\textcolor{keyword}{const}\ InputVarType\&\ \_var)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{...\}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{\ \ \ \ rfl::Result<T>\ to\_basic\_type(\textcolor{keyword}{const}\ InputVarType\&\ \_var)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{...\}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ rfl::Result<InputArrayType>\ \mbox{\hyperlink{namespaceeastl_1_1internal_ac29f5a76054d5a25956293c4985b259d}{to\_array}}(\textcolor{keyword}{const}\ InputVarType\&\ \_var)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{...\}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ rfl::Result<InputObjectType>\ \mbox{\hyperlink{namespacerfl_ac0e7c689729d0be0bb3538b487224aee}{to\_object}}(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ InputVarType\&\ \_var)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{...\}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ArrayReader>}
\DoxyCodeLine{\ \ \ \ std::optional<Error>\ read\_array(\textcolor{keyword}{const}\ ArrayReader\&\ \_array\_reader,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ InputArrayType\&\ \_arr)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{...\}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ ObjectReader>}
\DoxyCodeLine{\ \ \ \ std::optional<Error>\ read\_object(\textcolor{keyword}{const}\ ObjectReader\&\ \_object\_reader,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ InputObjectType\&\ \_obj)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{...\}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ T>}
\DoxyCodeLine{\ \ \ \ rfl::Result<T>\ use\_custom\_constructor(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ InputVarType\&\ \_var)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ you\ do\ not\ want\ to\ support\ this\ functionality,}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{comment}{//\ just\ return\ this.}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespacerfl_a6625864c6c297dfdc3d3c3ee3181dd8c}{rfl::error}}(\textcolor{stringliteral}{"{}Not\ supported."{}});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\};}

\end{DoxyCode}


Of these methods, {\ttfamily read\+\_\+array} and {\ttfamily read\+\_\+object} probably require further explanation.\hypertarget{md_external_2reflect-cpp_2docs_2supported__formats_2supporting__your__own__format_autotoc_md674}{}\doxysection{\texorpdfstring{{\ttfamily read\+\_\+array}}{{\ttfamily read\+\_\+array}}}\label{md_external_2reflect-cpp_2docs_2supported__formats_2supporting__your__own__format_autotoc_md674}
{\ttfamily read\+\_\+array} expects an {\ttfamily Array\+Reader} class which might come in several forms. But all of these forms have a method with the following signature\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{std::optional<Error>\ \mbox{\hyperlink{json_2write__and__read_8hpp_a120a0c0f4f8f27e389e841e6f5f6efcd}{read}}(\textcolor{keyword}{const}\ InputVarType\&\ \_var)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept};}

\end{DoxyCode}


Within your implementation of {\ttfamily read\+\_\+array}, you must iterate through the array passed to the function and then insert the resulting values into {\ttfamily array\+\_\+reader.\+read}. If {\ttfamily array\+\_\+reader.\+read} returns an error, then you must return that error immediately.\hypertarget{md_external_2reflect-cpp_2docs_2supported__formats_2supporting__your__own__format_autotoc_md675}{}\doxysection{\texorpdfstring{{\ttfamily read\+\_\+object}}{{\ttfamily read\+\_\+object}}}\label{md_external_2reflect-cpp_2docs_2supported__formats_2supporting__your__own__format_autotoc_md675}
{\ttfamily read\+\_\+object} expects an {\ttfamily Object\+Reader} class which might come in several forms. But all of these forms have a method with the following signature\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \mbox{\hyperlink{json_2write__and__read_8hpp_a120a0c0f4f8f27e389e841e6f5f6efcd}{read}}(\textcolor{keyword}{const}\ std::string\_view\&\ \_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ InputVarType\&\ \_var)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept};}

\end{DoxyCode}


Within your implementation of {\ttfamily read\+\_\+object}, you must iterate through the object passed to the function and then insert the resulting key-\/value-\/pairs into {\ttfamily object\+\_\+reader.\+read}.\hypertarget{md_external_2reflect-cpp_2docs_2supported__formats_2supporting__your__own__format_autotoc_md676}{}\doxysection{\texorpdfstring{Additional requirements for schemaful formats}{Additional requirements for schemaful formats}}\label{md_external_2reflect-cpp_2docs_2supported__formats_2supporting__your__own__format_autotoc_md676}
Schemaful formats, like Apache Avro or Cap\textquotesingle{}n \doxylink{ff__network_8hpp_a935ab6746fea268e5bb60a8755bc3c1e}{Proto}, are somewhat more complicated than schemaless ones. There are additional factors to consider which do not apply schemaless formats\+:


\begin{DoxyEnumerate}
\item Schemaful formats needs to differentiate between {\itshape objects}, for which the field names are known at compile time and {\itshape maps}, for which the field names are not known at compile time. In schemaless formats, there is no differentiation.
\item Schemaful formats needs an explicit union types. This also means that many of the problems we have with serializing {\ttfamily std\+::variant} which requires us to develop concepts like {\ttfamily \doxylink{structrfl_1_1_tagged_union}{rfl\+::\+Tagged\+Union}} simply do not apply to schemaful formats -\/ the problem is already solved.
\end{DoxyEnumerate}\hypertarget{md_external_2reflect-cpp_2docs_2supported__formats_2supporting__your__own__format_autotoc_md677}{}\doxysubsection{\texorpdfstring{Additional requirements for schemaful writers}{Additional requirements for schemaful writers}}\label{md_external_2reflect-cpp_2docs_2supported__formats_2supporting__your__own__format_autotoc_md677}
Any schemaful reader additionally needs to define the following\+:

1) An {\ttfamily Output\+Map\+Type}, which must contain key-\/value pairs. 2) An {\ttfamily Output\+Union\+Type}, which represents an explicit union.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{struct\ }Writer\ \{}
\DoxyCodeLine{\ \ \textcolor{keyword}{using\ }OutputArrayType\ =\ ...;}
\DoxyCodeLine{\ \ \textcolor{keyword}{using\ }OutputMapType\ =\ ...;}
\DoxyCodeLine{\ \ \textcolor{keyword}{using\ }OutputObjectType\ =\ ...;}
\DoxyCodeLine{\ \ \textcolor{keyword}{using\ }OutputUnionType\ =\ ...;}
\DoxyCodeLine{\ \ \textcolor{keyword}{using\ }OutputVarType\ =\ ...;}
\DoxyCodeLine{\ \ }
\DoxyCodeLine{\ \ OutputMapType\ map\_as\_root(\textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \_size)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputUnionType\ union\_as\_root()\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputArrayType\ add\_array\_to\_map(const\ std::\mbox{\hyperlink{runtime_2spdlog_2include_2spdlog_2fmt_2bundled_2base_8h_a204ca715c2febee035464fa53dfc50c4}{string\_view}}\&\ \_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ const\ \textcolor{keywordtype}{size\_t}\ \_size,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OutputMapType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputArrayType\ add\_array\_to\_union(const\ \textcolor{keywordtype}{size\_t}\ \_index,\ const\ \textcolor{keywordtype}{size\_t}\ \_size,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OutputUnionType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputMapType\ add\_map\_to\_array(const\ \textcolor{keywordtype}{size\_t}\ \_size,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OutputArrayType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputMapType\ add\_map\_to\_map(const\ std::\mbox{\hyperlink{runtime_2spdlog_2include_2spdlog_2fmt_2bundled_2base_8h_a204ca715c2febee035464fa53dfc50c4}{string\_view}}\&\ \_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ const\ \textcolor{keywordtype}{size\_t}\ \_size,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OutputMapType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputMapType\ add\_map\_to\_object(const\ std::\mbox{\hyperlink{runtime_2spdlog_2include_2spdlog_2fmt_2bundled_2base_8h_a204ca715c2febee035464fa53dfc50c4}{string\_view}}\&\ \_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ const\ \textcolor{keywordtype}{size\_t}\ \_size,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OutputObjectType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputMapType\ add\_map\_to\_union(const\ \textcolor{keywordtype}{size\_t}\ \_index,\ const\ \textcolor{keywordtype}{size\_t}\ \_size,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OutputUnionType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputObjectType\ add\_object\_to\_map(const\ std::\mbox{\hyperlink{runtime_2spdlog_2include_2spdlog_2fmt_2bundled_2base_8h_a204ca715c2febee035464fa53dfc50c4}{string\_view}}\&\ \_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ const\ \textcolor{keywordtype}{size\_t}\ \_size,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OutputMapType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputObjectType\ add\_object\_to\_union(const\ \textcolor{keywordtype}{size\_t}\ \_index,\ const\ \textcolor{keywordtype}{size\_t}\ \_size,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OutputUnionType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputUnionType\ add\_union\_to\_array(OutputArrayType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputUnionType\ add\_union\_to\_map(const\ std::\mbox{\hyperlink{runtime_2spdlog_2include_2spdlog_2fmt_2bundled_2base_8h_a204ca715c2febee035464fa53dfc50c4}{string\_view}}\&\ \_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OutputMapType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputUnionType\ add\_union\_to\_object(const\ std::\mbox{\hyperlink{runtime_2spdlog_2include_2spdlog_2fmt_2bundled_2base_8h_a204ca715c2febee035464fa53dfc50c4}{string\_view}}\&\ \_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OutputObjectType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputUnionType\ add\_union\_to\_union(const\ \textcolor{keywordtype}{size\_t}\ \_index,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OutputUnionType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputVarType\ add\_null\_to\_map(const\ std::\mbox{\hyperlink{runtime_2spdlog_2include_2spdlog_2fmt_2bundled_2base_8h_a204ca715c2febee035464fa53dfc50c4}{string\_view}}\&\ \_name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OutputMapType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ OutputVarType\ add\_null\_to\_union(const\ \textcolor{keywordtype}{size\_t}\ \_index,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OutputUnionType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ template\ <class\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}>}
\DoxyCodeLine{\ \ OutputVarType\ add\_value\_to\_map(const\ std::\mbox{\hyperlink{runtime_2spdlog_2include_2spdlog_2fmt_2bundled_2base_8h_a204ca715c2febee035464fa53dfc50c4}{string\_view}}\&\ \_name,\ const\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\&\ \_var,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OutputMapType*\ \_parent)\ const\ noexcept;\ }
\DoxyCodeLine{}
\DoxyCodeLine{\ \ template\ <class\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}>}
\DoxyCodeLine{\ \ OutputVarType\ add\_value\_to\_union(const\ \textcolor{keywordtype}{size\_t}\ \_index,\ const\ \mbox{\hyperlink{test__overwrite__node_8cpp_a0acb682b8260ab1c60b918599864e2e5}{T}}\&\ \_var,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ OutputUnionType*\ \_parent)\ const\ noexcept;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \textcolor{keywordtype}{void}\ end\_map(OutputMapType*\ \_obj)\ const\ noexcept;\ }
\DoxyCodeLine{}
\DoxyCodeLine{\};}

\end{DoxyCode}
\hypertarget{md_external_2reflect-cpp_2docs_2supported__formats_2supporting__your__own__format_autotoc_md678}{}\doxysubsection{\texorpdfstring{Additional requirements for schemaful readers}{Additional requirements for schemaful readers}}\label{md_external_2reflect-cpp_2docs_2supported__formats_2supporting__your__own__format_autotoc_md678}
Any schemaful reader additionally needs to define the following\+:

1) An {\ttfamily Input\+Map\+Type}, which must contain key-\/value pairs. 2) An {\ttfamily Input\+Union\+Type}, which represents an explicit union.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{struct\ }Reader\ \{}
\DoxyCodeLine{\ \ \textcolor{keyword}{using\ }InputArrayType\ =\ ...;}
\DoxyCodeLine{\ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacerfl_1_1avro_a912d5818c6c05fc5ea6268fba009a59f}{InputObjectType}}\ =\ ...;}
\DoxyCodeLine{\ \ \textcolor{keyword}{using\ }InputMapType\ =\ ...;}
\DoxyCodeLine{\ \ \textcolor{keyword}{using\ }InputUnionType\ =\ ...;}
\DoxyCodeLine{\ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{namespacerfl_1_1avro_a1b87f8b534d31b79c6cdcb844cc0ff8f}{InputVarType}}\ =\ ...;}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ rfl::Result<InputMapType>\ to\_map(\textcolor{keyword}{const}\ InputVarType\&\ \_var)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ MapReader>}
\DoxyCodeLine{\ \ std::optional<Error>\ read\_map(\textcolor{keyword}{const}\ MapReader\&\ \_map\_reader,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ InputMapType\&\ \_map)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ rfl::Result<InputUnionType>\ to\_union(\textcolor{keyword}{const}\ InputVarType\&\ \_var)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \textcolor{keyword}{template}\ <\textcolor{keyword}{class}\ VariantType,\ \textcolor{keyword}{class}\ UnionReaderType>}
\DoxyCodeLine{\ \ rfl::Result<VariantType>\ read\_union(}
\DoxyCodeLine{\ \ \ \ \ \ \textcolor{keyword}{const}\ InputUnionType\&\ \_union)\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept};}
\DoxyCodeLine{\};}

\end{DoxyCode}
 