\doxysection{allocator\+\_\+malloc.\+h}
\hypertarget{allocator__malloc_8h_source}{}\label{allocator__malloc_8h_source}\index{runtime/EASTL/include/EASTL/allocator\_malloc.h@{runtime/EASTL/include/EASTL/allocator\_malloc.h}}
\mbox{\hyperlink{allocator__malloc_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00002\ \textcolor{comment}{//\ Copyright\ (c)\ Electronic\ Arts\ Inc.\ All\ rights\ reserved.}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#ifndef\ EASTL\_ALLOCATOR\_MALLOC\_H}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#define\ EASTL\_ALLOCATOR\_MALLOC\_H}}
\DoxyCodeLine{00008\ }
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{eahave_8h}{EABase/eahave.h}}>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{allocator_8h}{EASTL/allocator.h}}>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <stddef.h>}}
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{comment}{//\ EASTL\_ALIGNED\_MALLOC\_AVAILABLE}}
\DoxyCodeLine{00016\ \textcolor{comment}{//}}
\DoxyCodeLine{00017\ \textcolor{comment}{//\ Identifies\ if\ the\ standard\ library\ provides\ a\ built-\/in\ aligned\ version\ of\ malloc.}}
\DoxyCodeLine{00018\ \textcolor{comment}{//\ Defined\ as\ 0\ or\ 1,\ depending\ on\ the\ standard\ library\ or\ platform\ availability.}}
\DoxyCodeLine{00019\ \textcolor{comment}{//\ None\ of\ the\ viable\ C\ functions\ provides\ for\ an\ aligned\ malloc\ with\ offset,\ so\ we\ }}
\DoxyCodeLine{00020\ \textcolor{comment}{//\ don't\ consider\ that\ supported\ in\ any\ case.}}
\DoxyCodeLine{00021\ \textcolor{comment}{//}}
\DoxyCodeLine{00022\ \textcolor{comment}{//\ Options\ for\ aligned\ allocations:}}
\DoxyCodeLine{00023\ \textcolor{comment}{//\ C11\ \ \ aligned\_alloc\ \ \ http://linux.die.net/man/3/aligned\_alloc}}
\DoxyCodeLine{00024\ \textcolor{comment}{//\ glibc\ memalign\ \ \ \ \ \ \ \ http://linux.die.net/man/3/posix\_memalign}}
\DoxyCodeLine{00025\ \textcolor{comment}{//\ Posix\ posix\_memalign\ \ http://pubs.opengroup.org/onlinepubs/000095399/functions/posix\_memalign.html}}
\DoxyCodeLine{00026\ \textcolor{comment}{//\ VC++\ \_aligned\_malloc\ \ http://msdn.microsoft.com/en-\/us/library/8z34s9c6\%28VS.80\%29.aspx\ This\ is\ not\ suitable,\ since\ it\ has\ a\ limitation\ that\ you\ need\ to\ free\ via\ \_aligned\_free.}}
\DoxyCodeLine{00027\ \textcolor{comment}{//}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#if\ !defined\ EASTL\_ALIGNED\_MALLOC\_AVAILABLE}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\ \ \ \ \#if\ defined(EA\_PLATFORM\_POSIX)\ \&\&\ !defined(EA\_PLATFORM\_APPLE)}}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ memalign\ is\ more\ consistently\ available\ than\ posix\_memalign,\ though\ its\ location\ isn't\ consistent\ across\ }}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ platforms\ and\ compiler\ libraries.\ Typically\ it's\ declared\ in\ one\ of\ three\ headers:\ stdlib.h,\ malloc.h,\ or\ malloc/malloc.h}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#include\ <stdlib.h>}\ \textcolor{comment}{//\ memalign,\ posix\_memalign.\ }}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#define\ EASTL\_ALIGNED\_MALLOC\_AVAILABLE\ 1}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#if\ EA\_HAS\_INCLUDE\_AVAILABLE}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \#if\ EA\_HAS\_INCLUDE(<malloc/malloc.h>)}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#include\ <malloc/malloc.h>}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \#elif\ EA\_HAS\_INCLUDE(<malloc.h>)}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#include\ <malloc.h>}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#elif\ defined(EA\_PLATFORM\_BSD)}}
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \#include\ <malloc/malloc.h>}}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#elif\ defined(\_\_clang\_\_)}}
\DoxyCodeLine{00044\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \#if\ \_\_has\_include(<malloc/malloc.h>)}}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#include\ <malloc/malloc.h>}}
\DoxyCodeLine{00046\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \#elif\ \_\_has\_include(<malloc.h>)}}
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \#include\ <malloc.h>}}
\DoxyCodeLine{00048\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00049\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#else}}
\DoxyCodeLine{00050\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \#include\ <malloc.h>}}
\DoxyCodeLine{00051\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00052\ \textcolor{preprocessor}{\ \ \ \ \#else}}
\DoxyCodeLine{00053\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#define\ EASTL\_ALIGNED\_MALLOC\_AVAILABLE\ 0}}
\DoxyCodeLine{00054\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{00055\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceeastl}{eastl}}}
\DoxyCodeLine{00059\ \{}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{comment}{//\ allocator\_malloc}}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{comment}{//\ Implements\ an\ EASTL\ allocator\ that\ uses\ malloc/free\ as\ opposed\ to\ }}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{comment}{//\ new/delete\ or\ PPMalloc\ Malloc/Free.\ }}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{comment}{//\ Example\ usage:}}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ vector<int,\ allocator\_malloc>\ intVector;}}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{comment}{//\ }}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classeastl_1_1allocator__malloc_a920b8f16418759f7ca043953bc670351}{allocator\_malloc}}}
\DoxyCodeLine{00071\ \ \ \ \ \{}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classeastl_1_1allocator__malloc_a920b8f16418759f7ca043953bc670351}{allocator\_malloc}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ =\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \}}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classeastl_1_1allocator__malloc_a209edd0ce63b93585d7a2c728518ecf1}{allocator\_malloc}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classeastl_1_1allocator__malloc_a920b8f16418759f7ca043953bc670351}{allocator\_malloc}}\&)}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classeastl_1_1allocator__malloc_aa96785e24f890b32bf4acb4ee97cb658}{allocator\_malloc}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classeastl_1_1allocator__malloc_a920b8f16418759f7ca043953bc670351}{allocator\_malloc}}\&,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*)}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classeastl_1_1allocator__malloc_a920b8f16418759f7ca043953bc670351}{allocator\_malloc}}\&\ \mbox{\hyperlink{classeastl_1_1allocator__malloc_a70dd0d17fdaef65133a3d5d73f3eeb3f}{operator=}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classeastl_1_1allocator__malloc_a920b8f16418759f7ca043953bc670351}{allocator\_malloc}}\&)}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};\ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classeastl_1_1allocator__malloc_ad380af9d0dac6c9388f48e1cd655a3c5}{operator==}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classeastl_1_1allocator__malloc_a920b8f16418759f7ca043953bc670351}{allocator\_malloc}}\&)}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};\ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classeastl_1_1allocator__malloc_a853f19092b0ce32f476a7631f5b123d9}{operator!=}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classeastl_1_1allocator__malloc_a920b8f16418759f7ca043953bc670351}{allocator\_malloc}}\&)}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{classeastl_1_1allocator__malloc_a84ea47e6ca9ab1bfa24dc32706d497dd}{allocate}}(\textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{int}\ \textcolor{comment}{/*flags*/}\ =\ 0)}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mimalloc-override_8h_a99aa8fd9f4831e1b0fa9e1cdcde3e249}{malloc}}(n);\ \}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{classeastl_1_1allocator__malloc_acf5da52d13040b9372be32b962370bfa}{allocate}}(\textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{size\_t}\ alignment,\ \textcolor{keywordtype}{size\_t}\ alignmentOffset,\ \textcolor{keywordtype}{int}\ \textcolor{comment}{/*flags*/}\ =\ 0)}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \{\ }
\DoxyCodeLine{00096\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \#if\ EASTL\_ALIGNED\_MALLOC\_AVAILABLE}}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}((alignmentOffset\ \%\ alignment)\ ==\ 0)\ \textcolor{comment}{//\ We\ check\ for\ (offset\ \%\ alignmnent\ ==\ 0)\ instead\ of\ (offset\ ==\ 0)\ because\ any\ block\ which\ is\ aligned\ on\ e.g.\ 64\ also\ is\ aligned\ at\ an\ offset\ of\ 64\ by\ definition.\ }}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mimalloc-override_8h_a7807c4983b459d524a01d6ea678a3477}{memalign}}(alignment,\ n);\ \textcolor{comment}{//\ memalign\ is\ more\ consistently\ available\ than\ posix\_memalign.}}
\DoxyCodeLine{00099\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \#else}}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}((alignment\ <=\ \mbox{\hyperlink{config_8h_ab10b3c3e317b29d5a371a4954db38b61}{EASTL\_SYSTEM\_ALLOCATOR\_MIN\_ALIGNMENT}})\ \&\&\ ((alignmentOffset\ \%\ alignment)\ ==\ 0))}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mimalloc-override_8h_a99aa8fd9f4831e1b0fa9e1cdcde3e249}{malloc}}(n);}
\DoxyCodeLine{00102\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classeastl_1_1allocator__malloc_a922b7b55c6ac67d0f8765a16d1792a53}{deallocate}}(\textcolor{keywordtype}{void}*\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ \textcolor{keywordtype}{size\_t}\ \textcolor{comment}{/*n*/})}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \mbox{\hyperlink{mimalloc-override_8h_a9d4b5df3530d1bc733070a4669ba6ebc}{free}}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});\ \}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classeastl_1_1allocator__malloc_a82df032d19babb953fba18bbb0fc2f66}{get\_name}}()\textcolor{keyword}{\ const}}
\DoxyCodeLine{00110\ \textcolor{keyword}{\ \ \ \ \ \ \ \ \ \ \ \ }\{\ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}allocator\_malloc"{}};\ \}}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classeastl_1_1allocator__malloc_a870077bdbe98ccb5a097cc81862c83c8}{set\_name}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*)}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \}}
\DoxyCodeLine{00114\ \ \ \ \ \};}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \}\ \textcolor{comment}{//\ namespace\ eastl}}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ Header\ include\ guard}}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ }

\end{DoxyCode}
