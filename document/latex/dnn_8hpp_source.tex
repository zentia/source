\doxysection{dnn.\+hpp}
\hypertarget{dnn_8hpp_source}{}\label{dnn_8hpp_source}\index{external/taskflow/benchmarks/mnist/dnn.hpp@{external/taskflow/benchmarks/mnist/dnn.hpp}}
\mbox{\hyperlink{dnn_8hpp}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ }
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <experimental/filesystem>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <fstream>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <random>}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#define\ EIGEN\_DONT\_PARALLELIZE\ 1}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <Eigen/Dense>}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{comment}{//\ Function:\ read\_mnist\_label}}
\DoxyCodeLine{00013\ \textcolor{keyword}{inline}\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{dnn_8hpp_a7fefa15db0fce1a8dd02c12babdf5d78}{read\_mnist\_label}}(\textcolor{keyword}{const}\ std::experimental::filesystem::path\&\ \mbox{\hyperlink{ittnotify__static_8h_a7016119bc831a22d1a351d56128518ed}{path}})\ \{}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \ \ \textcolor{comment}{//\ Helper\ lambda.}}
\DoxyCodeLine{00016\ \ \ \textcolor{keyword}{auto}\ reverse\_int\ =\ [](\textcolor{keywordtype}{int}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{00017\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ c1,\ c2,\ c3,\ c4;}
\DoxyCodeLine{00018\ \ \ \ \ c1\ =\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ \ \ \ \ \ \ \ \ \&\ 255;}
\DoxyCodeLine{00019\ \ \ \ \ c2\ =\ (\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ >>\ 8)\ \ \&\ 255;}
\DoxyCodeLine{00020\ \ \ \ \ c3\ =\ (\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ >>\ 16)\ \&\ 255;}
\DoxyCodeLine{00021\ \ \ \ \ c4\ =\ (\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ >>\ 24)\ \&\ 255;}
\DoxyCodeLine{00022\ \ \ \ \ \textcolor{keywordflow}{return}\ ((\textcolor{keywordtype}{int})c1\ <<\ 24)\ +\ ((\mbox{\hyperlink{sugar_8h_ae4f82344f573c70aa1066a2394bba345}{int}})c2\ <<\ 16)\ +\ ((\textcolor{keywordtype}{int})c3\ <<\ 8)\ +\ c4;}
\DoxyCodeLine{00023\ \ \ \};}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \ \ \textcolor{comment}{//\ Read\ the\ image.}}
\DoxyCodeLine{00026\ \ \ std::ifstream\ ifs(\mbox{\hyperlink{ittnotify__static_8h_a7016119bc831a22d1a351d56128518ed}{path}},\ std::ios::binary);}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \ \ \textcolor{keywordflow}{if}(!ifs)\ \{}
\DoxyCodeLine{00029\ \ \ \ \ assert(\textcolor{keyword}{false});}
\DoxyCodeLine{00030\ \ \ \}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \ \ \textcolor{keywordtype}{int}\ magic\_number\ =\ 0;}
\DoxyCodeLine{00033\ \ \ \textcolor{keywordtype}{int}\ num\_imgs\ =\ 0;}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \ \ ifs.read((\textcolor{keywordtype}{char}*)\&magic\_number,\ \textcolor{keyword}{sizeof}(magic\_number));}
\DoxyCodeLine{00036\ \ \ magic\_number\ =\ reverse\_int(magic\_number);}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \ \ ifs.read((\textcolor{keywordtype}{char}*)\&num\_imgs,\ \textcolor{keyword}{sizeof}(num\_imgs));}
\DoxyCodeLine{00039\ \ \ num\_imgs\ =\ reverse\_int(num\_imgs);}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ Eigen::VectorXi\ \mbox{\hyperlink{dense__solvers_8cpp_ae36f022db5477c6bcc5198e48a239e09}{labels}}(num\_imgs);}
\DoxyCodeLine{00042\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<num\_imgs;\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ temp\ =\ 0;\ \ \textcolor{comment}{//\ must\ use\ unsigned}}
\DoxyCodeLine{00044\ \ \ \ \ ifs.read((\textcolor{keywordtype}{char}*)\&temp,\ \textcolor{keyword}{sizeof}(temp));}
\DoxyCodeLine{00045\ \ \ \ \ \mbox{\hyperlink{dense__solvers_8cpp_ae36f022db5477c6bcc5198e48a239e09}{labels}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(temp);}
\DoxyCodeLine{00046\ \ \ \}}
\DoxyCodeLine{00047\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{dense__solvers_8cpp_ae36f022db5477c6bcc5198e48a239e09}{labels}};}
\DoxyCodeLine{00048\ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \textcolor{keyword}{inline}\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{dnn_8hpp_a0ca92b8e2cc917d296f2631eb3a4d974}{read\_mnist\_image}}(\textcolor{keyword}{const}\ std::experimental::filesystem::path\&\ \mbox{\hyperlink{ittnotify__static_8h_a7016119bc831a22d1a351d56128518ed}{path}})\ \{}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \textcolor{comment}{//\ Helper\ lambda.}}
\DoxyCodeLine{00054\ \ \ \textcolor{keyword}{auto}\ reverse\_int\ =\ []\ (\textcolor{keywordtype}{int}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ c1,\ c2,\ c3,\ c4;}
\DoxyCodeLine{00056\ \ \ \ \ c1\ =\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ \ \ \ \ \ \ \ \ \&\ 255;}
\DoxyCodeLine{00057\ \ \ \ \ c2\ =\ (\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ >>\ 8)\ \ \&\ 255;}
\DoxyCodeLine{00058\ \ \ \ \ c3\ =\ (\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ >>\ 16)\ \&\ 255;}
\DoxyCodeLine{00059\ \ \ \ \ c4\ =\ (\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ >>\ 24)\ \&\ 255;}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordflow}{return}\ ((\textcolor{keywordtype}{int})c1\ <<\ 24)\ +\ ((\mbox{\hyperlink{sugar_8h_ae4f82344f573c70aa1066a2394bba345}{int}})c2\ <<\ 16)\ +\ ((\textcolor{keywordtype}{int})c3\ <<\ 8)\ +\ c4;}
\DoxyCodeLine{00061\ \ \ \};}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \textcolor{comment}{//\ Read\ the\ image.}}
\DoxyCodeLine{00064\ \ \ std::ifstream\ ifs(\mbox{\hyperlink{ittnotify__static_8h_a7016119bc831a22d1a351d56128518ed}{path}},\ std::ios::binary);}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \textcolor{keywordflow}{if}(!ifs)\ \{}
\DoxyCodeLine{00067\ \ \ \ \ assert(\textcolor{keyword}{false});}
\DoxyCodeLine{00068\ \ \ \}}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \textcolor{keywordtype}{int}\ magic\_number\ =\ 0;}
\DoxyCodeLine{00071\ \ \ \textcolor{keywordtype}{int}\ num\_imgs\ =\ 0;}
\DoxyCodeLine{00072\ \ \ \textcolor{keywordtype}{int}\ num\_rows\ =\ 0;}
\DoxyCodeLine{00073\ \ \ \textcolor{keywordtype}{int}\ num\_cols\ =\ 0;}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ ifs.read((\textcolor{keywordtype}{char}*)\&magic\_number,\ \textcolor{keyword}{sizeof}(magic\_number));}
\DoxyCodeLine{00076\ \ \ magic\_number\ =\ reverse\_int(magic\_number);}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ ifs.read((\textcolor{keywordtype}{char}*)\&num\_imgs,\ \textcolor{keyword}{sizeof}(num\_imgs));}
\DoxyCodeLine{00079\ \ \ num\_imgs\ =\ reverse\_int(num\_imgs);}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ ifs.read((\textcolor{keywordtype}{char}*)\&num\_rows,\ \textcolor{keyword}{sizeof}(num\_rows));}
\DoxyCodeLine{00082\ \ \ num\_rows\ =\ reverse\_int(num\_rows);}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ ifs.read((\textcolor{keywordtype}{char}*)\&num\_cols,\ \textcolor{keyword}{sizeof}(num\_cols));}
\DoxyCodeLine{00085\ \ \ num\_cols\ =\ reverse\_int(num\_cols);}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ Eigen::MatrixXf\ images(num\_imgs,\ num\_rows*num\_cols);}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ =\ 0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ <\ num\_imgs;\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ \mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}}\ =\ 0;\ \mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}}\ <\ num\_rows;\ ++\mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}})\ \{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ \mbox{\hyperlink{bench_vec_add_8cpp_a41689956983587b085f9da3e48f31d99}{c}}\ =\ 0;\ \mbox{\hyperlink{bench_vec_add_8cpp_a41689956983587b085f9da3e48f31d99}{c}}\ <\ num\_cols;\ ++\mbox{\hyperlink{bench_vec_add_8cpp_a41689956983587b085f9da3e48f31d99}{c}})\ \{}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ 0;\ \ \textcolor{comment}{//\ must\ use\ unsigned}}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ ifs.read((\textcolor{keywordtype}{char}*)\&\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}));}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ images(\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}},\ \mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}}*num\_cols\ +\ \mbox{\hyperlink{bench_vec_add_8cpp_a41689956983587b085f9da3e48f31d99}{c}})\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}});}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00096\ \ \ \ \ \}}
\DoxyCodeLine{00097\ \ \ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<images.rows();\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}++)\ \{}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}=0;\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}<images.cols();\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}++)\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \ \ images(\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}},\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}})\ /=\ 255.0;}
\DoxyCodeLine{00102\ \ \ \ \ \}}
\DoxyCodeLine{00103\ \ \ \}}
\DoxyCodeLine{00104\ \ \ \textcolor{keywordflow}{return}\ images;}
\DoxyCodeLine{00105\ \}}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \textcolor{keyword}{inline}\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{dnn_8hpp_a342bdddec949e302ca4dcb57f1e0c045}{time\_diff}}(}
\DoxyCodeLine{00108\ \ \ std::chrono::time\_point<std::chrono::high\_resolution\_clock>\ \&t1,}
\DoxyCodeLine{00109\ \ \ std::chrono::time\_point<std::chrono::high\_resolution\_clock>\ \&t2}
\DoxyCodeLine{00110\ )\ \{}
\DoxyCodeLine{00111\ \ \ \textcolor{keywordflow}{return}\ std::chrono::duration\_cast<std::chrono::milliseconds>(t2\ -\/\ t1).count();}
\DoxyCodeLine{00112\ \}}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \textcolor{keyword}{enum\ class}\ Activation\ \{}
\DoxyCodeLine{00120\ \ \ \mbox{\hyperlink{dnn_8hpp_a83689fe2ddb97d5e71cfdbaa2523e0cdab50339a10e1de285ac99d4c3990b8693}{NONE}},}
\DoxyCodeLine{00121\ \ \ \mbox{\hyperlink{dnn_8hpp_a83689fe2ddb97d5e71cfdbaa2523e0cdad346bb4679d29be241279f15d7795c1c}{RELU}},}
\DoxyCodeLine{00122\ \ \ \mbox{\hyperlink{dnn_8hpp_a83689fe2ddb97d5e71cfdbaa2523e0cdab299f45b5de2a8f7c45192590290742b}{SIGMOID}}}
\DoxyCodeLine{00123\ \};}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \textcolor{comment}{//\ Procedure:\ sigmoid}}
\DoxyCodeLine{00126\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{dnn_8hpp_a0106442994c57f241c878b4d5f06e815}{sigmoid}}(Eigen::MatrixXf\&\ \mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}})\ \{}
\DoxyCodeLine{00127\ \ \ \mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}}\ =\ ((1.0f\ +\ (-\/\mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}}).array().\mbox{\hyperlink{_array_cwise_unary_ops_8h_a2500b5d4f377a445cb98d3f1facfa1cf}{exp}}()).\mbox{\hyperlink{_array_cwise_unary_ops_8h_ab3df1b08b9c073db2a7e61a9b06bb295}{inverse}}()).matrix();}
\DoxyCodeLine{00128\ \}}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \textcolor{comment}{//\ Procedure:\ relu}}
\DoxyCodeLine{00131\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{dnn_8hpp_ab4c45afedbd25bf5d73642dcd4362856}{relu}}(Eigen::MatrixXf\&\ \mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}})\ \{}
\DoxyCodeLine{00132\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}=0;\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}<\mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}}.cols();\ ++\mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}})\ \{}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}}.rows();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}}(\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}},\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}})\ <=\ 0.0f)\ \{}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}}(\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}},\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}})\ =\ 0.0f;}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00137\ \ \ \ \ \}}
\DoxyCodeLine{00138\ \ \ \}}
\DoxyCodeLine{00139\ \}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{dnn_8hpp_a620d9b304d08246455f1726a958903a8}{activate}}(Eigen::MatrixXf\&\ \mbox{\hyperlink{_tutorial___advanced_initialization___comma_temporary_8cpp_a5d2ded7a4c8830608d7b218f5f27c0a0}{mat}},\ Activation\ act)\ \{}
\DoxyCodeLine{00142\ \ \ \textcolor{keywordflow}{switch}(act)\ \{}
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{keywordflow}{case}\ Activation::NONE:\ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{keywordflow}{case}\ Activation::SIGMOID:\ \mbox{\hyperlink{dnn_8hpp_a0106442994c57f241c878b4d5f06e815}{sigmoid}}(\mbox{\hyperlink{_tutorial___advanced_initialization___comma_temporary_8cpp_a5d2ded7a4c8830608d7b218f5f27c0a0}{mat}});\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordflow}{case}\ Activation::RELU:\ \mbox{\hyperlink{dnn_8hpp_ab4c45afedbd25bf5d73642dcd4362856}{relu}}(\mbox{\hyperlink{_tutorial___advanced_initialization___comma_temporary_8cpp_a5d2ded7a4c8830608d7b218f5f27c0a0}{mat}});\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00146\ \ \ \};}
\DoxyCodeLine{00147\ \}}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \textcolor{comment}{//\ Function:\ drelu}}
\DoxyCodeLine{00151\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{dnn_8hpp_adaf29d1ed47eb1a47cf4fce7a2f4ec31}{drelu}}(Eigen::MatrixXf\&\ \mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}})\ \{}
\DoxyCodeLine{00152\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}=0;\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}<\mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}}.cols();\ ++\mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}})\ \{}
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}}.rows();\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}})\ \{}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}}(\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}},\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}})\ =\ \mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}}(\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}},\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}})\ >\ 0.0f\ ?\ 1.0f\ :\ 0.0f;}
\DoxyCodeLine{00155\ \ \ \ \ \}}
\DoxyCodeLine{00156\ \ \ \}}
\DoxyCodeLine{00157\ \}}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \textcolor{comment}{//\ Function:\ dsigmoid}}
\DoxyCodeLine{00160\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{dnn_8hpp_a4c90081c763859174ca793699b2ec16c}{dsigmoid}}(Eigen::MatrixXf\&\ \mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}})\ \{}
\DoxyCodeLine{00161\ \ \ \mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}}\ =\ \mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}}.array()\ *\ (1\ -\/\ \mbox{\hyperlink{offscreen_8c_a5fd331c99e778f04762be6d8173eb4d2}{x}}.array());}
\DoxyCodeLine{00162\ \}}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{dnn_8hpp_adac433802e74e41811c45899c798fbc1}{deactivate}}(Eigen::MatrixXf\&\ \mbox{\hyperlink{_tutorial___advanced_initialization___comma_temporary_8cpp_a5d2ded7a4c8830608d7b218f5f27c0a0}{mat}},\ Activation\ act)\ \{}
\DoxyCodeLine{00165\ \ \ \textcolor{keywordflow}{switch}(act)\ \{}
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{keywordflow}{case}\ Activation::NONE:\ \ \ \ \mbox{\hyperlink{_tutorial___advanced_initialization___comma_temporary_8cpp_a5d2ded7a4c8830608d7b218f5f27c0a0}{mat}}\ =\ Eigen::MatrixXf::Ones(\mbox{\hyperlink{_tutorial___advanced_initialization___comma_temporary_8cpp_a5d2ded7a4c8830608d7b218f5f27c0a0}{mat}}.rows(),\ \mbox{\hyperlink{_tutorial___advanced_initialization___comma_temporary_8cpp_a5d2ded7a4c8830608d7b218f5f27c0a0}{mat}}.cols());\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{keywordflow}{case}\ Activation::SIGMOID:\ \mbox{\hyperlink{dnn_8hpp_a4c90081c763859174ca793699b2ec16c}{dsigmoid}}(\mbox{\hyperlink{_tutorial___advanced_initialization___comma_temporary_8cpp_a5d2ded7a4c8830608d7b218f5f27c0a0}{mat}});\ \mbox{\hyperlink{sugar_8h_a6b8c693f1c0454a1128432b746966c17}{return}}\ ;}
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{keywordflow}{case}\ Activation::RELU:\ \ \ \ \mbox{\hyperlink{dnn_8hpp_adaf29d1ed47eb1a47cf4fce7a2f4ec31}{drelu}}(\mbox{\hyperlink{_tutorial___advanced_initialization___comma_temporary_8cpp_a5d2ded7a4c8830608d7b218f5f27c0a0}{mat}});\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00169\ \ \ \};}
\DoxyCodeLine{00170\ \}}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{struct_m_n_i_s_t_ab41b8a7a01a03e98b7df9e4cf7b48a36}{MNIST}}\ \{}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \textcolor{comment}{//\ Ctor}}
\DoxyCodeLine{00175\ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_ab41b8a7a01a03e98b7df9e4cf7b48a36}{MNIST}}()\ \{}
\DoxyCodeLine{00176\ \ \ \ \ std::string\ \mbox{\hyperlink{ittnotify__static_8h_a7016119bc831a22d1a351d56128518ed}{path}}\ =\ std::experimental::filesystem::current\_path();}
\DoxyCodeLine{00177\ \ \ \ \ \mbox{\hyperlink{ittnotify__static_8h_a7016119bc831a22d1a351d56128518ed}{path}}\ =\ \mbox{\hyperlink{ittnotify__static_8h_a7016119bc831a22d1a351d56128518ed}{path}}.substr(0,\ \mbox{\hyperlink{ittnotify__static_8h_a7016119bc831a22d1a351d56128518ed}{path}}.rfind(\textcolor{stringliteral}{"{}taskflow"{}})\ +\ 8);}
\DoxyCodeLine{00178\ \ \ \ \ \mbox{\hyperlink{ittnotify__static_8h_a7016119bc831a22d1a351d56128518ed}{path}}\ +=\ \textcolor{stringliteral}{"{}/benchmarks/mnist/"{}};}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a8b2cb8849eddad2e6f9ad1eb29d96db5}{images}}\ =\ \mbox{\hyperlink{dnn_8hpp_a0ca92b8e2cc917d296f2631eb3a4d974}{read\_mnist\_image}}(\mbox{\hyperlink{ittnotify__static_8h_a7016119bc831a22d1a351d56128518ed}{path}}\ +\ \textcolor{stringliteral}{"{}./train-\/images.data"{}});}
\DoxyCodeLine{00181\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a340eb9288e7c28babe0d2de7ddc3faed}{labels}}\ =\ \mbox{\hyperlink{dnn_8hpp_a7fefa15db0fce1a8dd02c12babdf5d78}{read\_mnist\_label}}(\mbox{\hyperlink{ittnotify__static_8h_a7016119bc831a22d1a351d56128518ed}{path}}\ +\ \textcolor{stringliteral}{"{}./train-\/labels.data"{}});}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a7418da82eb3156a4185ae0a15f655f7f}{test\_images}}\ =\ \mbox{\hyperlink{dnn_8hpp_a0ca92b8e2cc917d296f2631eb3a4d974}{read\_mnist\_image}}(\mbox{\hyperlink{ittnotify__static_8h_a7016119bc831a22d1a351d56128518ed}{path}}\ +\ \textcolor{stringliteral}{"{}./t10k-\/images-\/idx3-\/ubyte"{}});}
\DoxyCodeLine{00184\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a3e4a5673165b37aa54bfc46647f94845}{test\_labels}}\ =\ \mbox{\hyperlink{dnn_8hpp_a7fefa15db0fce1a8dd02c12babdf5d78}{read\_mnist\_label}}(\mbox{\hyperlink{ittnotify__static_8h_a7016119bc831a22d1a351d56128518ed}{path}}\ +\ \textcolor{stringliteral}{"{}./t10k-\/labels-\/idx1-\/ubyte"{}});}
\DoxyCodeLine{00185\ \ \ \}}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_m_n_i_s_t_a604cd1568aae308bf022addf152b6e38}{add\_layer}}(\textcolor{keywordtype}{size\_t}\ in\_degree,\ \textcolor{keywordtype}{size\_t}\ out\_degree,\ \mbox{\hyperlink{dnn_8hpp_a83689fe2ddb97d5e71cfdbaa2523e0cd}{Activation}}\ act)\ \{}
\DoxyCodeLine{00188\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_aa069a42c7bfc154b6629a90299e5b4c5}{acts}}.emplace\_back(act);}
\DoxyCodeLine{00189\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a4887a9372ffba81324578a9777bf7e40}{Ys}}.emplace\_back();}
\DoxyCodeLine{00190\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a4887a9372ffba81324578a9777bf7e40}{Ys}}.back().resize(\mbox{\hyperlink{struct_m_n_i_s_t_a695a9f689e6897ef0c2579442fe9637a}{batch\_size}},\ out\_degree);}
\DoxyCodeLine{00191\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a07d3eb64725c1d4a9c4db3747a3e11ac}{Ws}}.push\_back(Eigen::MatrixXf::Random(in\_degree,\ out\_degree));}
\DoxyCodeLine{00192\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a01d6b9d141d3651a561fda34fd7a5ec5}{Bs}}.push\_back(Eigen::MatrixXf::Random(1,\ out\_degree));}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_adf7292bd41162241e112c5f66d7454d8}{dW}}.emplace\_back();}
\DoxyCodeLine{00195\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_adf7292bd41162241e112c5f66d7454d8}{dW}}.back().resize(in\_degree,\ out\_degree);}
\DoxyCodeLine{00196\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a927e96143aa7bd9ffdb08c463303f4be}{dB}}.emplace\_back();}
\DoxyCodeLine{00197\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a927e96143aa7bd9ffdb08c463303f4be}{dB}}.back().resize(1,\ out\_degree);}
\DoxyCodeLine{00198\ \ \ \}}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_m_n_i_s_t_ac7b591e11b681a75def48706e1751223}{forward}}(\textcolor{keywordtype}{size\_t}\ layer,\ \textcolor{keyword}{const}\ Eigen::MatrixXf\&\ \mbox{\hyperlink{_tutorial___advanced_initialization___comma_temporary_8cpp_a5d2ded7a4c8830608d7b218f5f27c0a0}{mat}})\ \{}
\DoxyCodeLine{00201\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a4887a9372ffba81324578a9777bf7e40}{Ys}}[layer]\ =\ \mbox{\hyperlink{_tutorial___advanced_initialization___comma_temporary_8cpp_a5d2ded7a4c8830608d7b218f5f27c0a0}{mat}}\ *\ \mbox{\hyperlink{struct_m_n_i_s_t_a07d3eb64725c1d4a9c4db3747a3e11ac}{Ws}}[layer]\ +\ \mbox{\hyperlink{struct_m_n_i_s_t_a01d6b9d141d3651a561fda34fd7a5ec5}{Bs}}[layer].replicate(\mbox{\hyperlink{_tutorial___advanced_initialization___comma_temporary_8cpp_a5d2ded7a4c8830608d7b218f5f27c0a0}{mat}}.rows(),\ 1);}
\DoxyCodeLine{00202\ \ \ \ \ \mbox{\hyperlink{dnn_8hpp_a620d9b304d08246455f1726a958903a8}{activate}}(\mbox{\hyperlink{struct_m_n_i_s_t_a4887a9372ffba81324578a9777bf7e40}{Ys}}[layer],\ \mbox{\hyperlink{struct_m_n_i_s_t_aa069a42c7bfc154b6629a90299e5b4c5}{acts}}[layer]);}
\DoxyCodeLine{00203\ \ \ \}}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_m_n_i_s_t_aa45fb0ccd8ac66a46bcb769c9d16a5d9}{loss}}(\textcolor{keyword}{const}\ Eigen::VectorXi\&\ \mbox{\hyperlink{struct_m_n_i_s_t_a340eb9288e7c28babe0d2de7ddc3faed}{labels}})\ \{}
\DoxyCodeLine{00206\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a4211ee8f528c287bb27b739914a7e168}{delta}}\ =\ \mbox{\hyperlink{struct_m_n_i_s_t_a4887a9372ffba81324578a9777bf7e40}{Ys}}.back();}
\DoxyCodeLine{00207\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a4211ee8f528c287bb27b739914a7e168}{delta}}\ =\ (\mbox{\hyperlink{struct_m_n_i_s_t_a4211ee8f528c287bb27b739914a7e168}{delta}}\ -\/\ \mbox{\hyperlink{struct_m_n_i_s_t_a4211ee8f528c287bb27b739914a7e168}{delta}}.rowwise().maxCoeff().\mbox{\hyperlink{array__replicate_8cpp_ae5c42a5b3544325a1f936c973c834660}{replicate}}(1,\ \mbox{\hyperlink{struct_m_n_i_s_t_a4211ee8f528c287bb27b739914a7e168}{delta}}.cols())).array().exp().matrix();}
\DoxyCodeLine{00208\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a4211ee8f528c287bb27b739914a7e168}{delta}}\ =\ \mbox{\hyperlink{struct_m_n_i_s_t_a4211ee8f528c287bb27b739914a7e168}{delta}}.cwiseQuotient(\mbox{\hyperlink{struct_m_n_i_s_t_a4211ee8f528c287bb27b739914a7e168}{delta}}.rowwise().sum().replicate(1,\ \mbox{\hyperlink{struct_m_n_i_s_t_a4211ee8f528c287bb27b739914a7e168}{delta}}.cols()));}
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=\mbox{\hyperlink{struct_m_n_i_s_t_ac806171682f92f717834f634ea021bbb}{beg\_row}},\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}=0;\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}<\mbox{\hyperlink{struct_m_n_i_s_t_a695a9f689e6897ef0c2579442fe9637a}{batch\_size}};\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}++,\ \mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}}++)\ \{}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a4211ee8f528c287bb27b739914a7e168}{delta}}(\mbox{\hyperlink{tut__arithmetic__redux__minmax_8cpp_a39513f0f8d942bf9ef17b2e87ac6d34e}{j}},\ \mbox{\hyperlink{struct_m_n_i_s_t_a340eb9288e7c28babe0d2de7ddc3faed}{labels}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}])\ -\/=\ 1.0;}
\DoxyCodeLine{00211\ \ \ \ \ \}}
\DoxyCodeLine{00212\ \ \ \}}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_m_n_i_s_t_abeb050a4e104baa4f27950a5e8ef6b4a}{backward}}(\textcolor{keywordtype}{size\_t}\ layer,\ \textcolor{keyword}{const}\ Eigen::MatrixXf\&\ Xin)\ \{}
\DoxyCodeLine{00215\ \ \ \ \ \mbox{\hyperlink{dnn_8hpp_adac433802e74e41811c45899c798fbc1}{deactivate}}(\mbox{\hyperlink{struct_m_n_i_s_t_a4887a9372ffba81324578a9777bf7e40}{Ys}}[layer],\ \mbox{\hyperlink{struct_m_n_i_s_t_aa069a42c7bfc154b6629a90299e5b4c5}{acts}}[layer]);}
\DoxyCodeLine{00216\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a4211ee8f528c287bb27b739914a7e168}{delta}}\ =\ \mbox{\hyperlink{struct_m_n_i_s_t_a4211ee8f528c287bb27b739914a7e168}{delta}}.cwiseProduct(\mbox{\hyperlink{struct_m_n_i_s_t_a4887a9372ffba81324578a9777bf7e40}{Ys}}[layer]);}
\DoxyCodeLine{00217\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a927e96143aa7bd9ffdb08c463303f4be}{dB}}[layer]\ =\ \mbox{\hyperlink{struct_m_n_i_s_t_a4211ee8f528c287bb27b739914a7e168}{delta}}.colwise().sum();}
\DoxyCodeLine{00218\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_adf7292bd41162241e112c5f66d7454d8}{dW}}[layer]\ =\ Xin\ *\ \mbox{\hyperlink{struct_m_n_i_s_t_a4211ee8f528c287bb27b739914a7e168}{delta}};}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{keywordflow}{if}(layer\ >\ 0)\ \{}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a4211ee8f528c287bb27b739914a7e168}{delta}}\ =\ \mbox{\hyperlink{struct_m_n_i_s_t_a4211ee8f528c287bb27b739914a7e168}{delta}}\ *\ \mbox{\hyperlink{struct_m_n_i_s_t_a07d3eb64725c1d4a9c4db3747a3e11ac}{Ws}}[layer].transpose();}
\DoxyCodeLine{00222\ \ \ \ \ \}}
\DoxyCodeLine{00223\ \ \ \}}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_m_n_i_s_t_a6c95ca43043d2e25d096c393a534839a}{update}}(\textcolor{keywordtype}{size\_t}\ layer)\ \{}
\DoxyCodeLine{00226\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a07d3eb64725c1d4a9c4db3747a3e11ac}{Ws}}[layer]\ -\/=\ \mbox{\hyperlink{struct_m_n_i_s_t_a6e9fc5116e916f48bb607acac55bdf86}{lrate}}*(\mbox{\hyperlink{struct_m_n_i_s_t_adf7292bd41162241e112c5f66d7454d8}{dW}}[layer]\ +\ \mbox{\hyperlink{struct_m_n_i_s_t_aff04e6d9a59d095ecc874a735ae3a27f}{decay}}*\mbox{\hyperlink{struct_m_n_i_s_t_a07d3eb64725c1d4a9c4db3747a3e11ac}{Ws}}[layer]);}
\DoxyCodeLine{00227\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a01d6b9d141d3651a561fda34fd7a5ec5}{Bs}}[layer]\ -\/=\ \mbox{\hyperlink{struct_m_n_i_s_t_a6e9fc5116e916f48bb607acac55bdf86}{lrate}}*(\mbox{\hyperlink{struct_m_n_i_s_t_a927e96143aa7bd9ffdb08c463303f4be}{dB}}[layer]\ +\ \mbox{\hyperlink{struct_m_n_i_s_t_aff04e6d9a59d095ecc874a735ae3a27f}{decay}}*\mbox{\hyperlink{struct_m_n_i_s_t_a01d6b9d141d3651a561fda34fd7a5ec5}{Bs}}[layer]);}
\DoxyCodeLine{00228\ \ \ \}}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_m_n_i_s_t_a437408522b85e5a6de892672fd0c0f33}{shuffle}}(Eigen::MatrixXf\&\ \mbox{\hyperlink{_tutorial___advanced_initialization___comma_temporary_8cpp_a5d2ded7a4c8830608d7b218f5f27c0a0}{mat}},\ Eigen::VectorXi\&\ \mbox{\hyperlink{benchmarks_2for__each_2for__each_8hpp_ad86cbaae2e3f21959301250e9f7c2701}{vec}},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ row\_num)\ \{}
\DoxyCodeLine{00231\ }
\DoxyCodeLine{00232\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{thread\_local}\ std::mt19937\ gen(0);}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \ \ \mbox{\hyperlink{class_eigen_1_1_permutation_matrix}{Eigen::PermutationMatrix<Eigen::Dynamic,\ Eigen::Dynamic>}}\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}(row\_num);}
\DoxyCodeLine{00235\ \ \ \ \ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}.setIdentity();}
\DoxyCodeLine{00236\ \ \ \ \ std::shuffle(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}.indices().data(),\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}.indices().data()\ +\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}.indices().size(),\ gen);}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \ \ \ \ \mbox{\hyperlink{_tutorial___advanced_initialization___comma_temporary_8cpp_a5d2ded7a4c8830608d7b218f5f27c0a0}{mat}}\ =\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ *\ \mbox{\hyperlink{_tutorial___advanced_initialization___comma_temporary_8cpp_a5d2ded7a4c8830608d7b218f5f27c0a0}{mat}};}
\DoxyCodeLine{00239\ \ \ \ \ \mbox{\hyperlink{benchmarks_2for__each_2for__each_8hpp_ad86cbaae2e3f21959301250e9f7c2701}{vec}}\ =\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ *\ \mbox{\hyperlink{benchmarks_2for__each_2for__each_8hpp_ad86cbaae2e3f21959301250e9f7c2701}{vec}};}
\DoxyCodeLine{00240\ \ \ \}}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{struct_m_n_i_s_t_a8f3a25b54164054af233c2cc5c81eed8}{validate}}()\ \{}
\DoxyCodeLine{00243\ \ \ \ \ Eigen::MatrixXf\ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}\ =\ \mbox{\hyperlink{struct_m_n_i_s_t_a7418da82eb3156a4185ae0a15f655f7f}{test\_images}};}
\DoxyCodeLine{00244\ \ \ \ \ \textcolor{keyword}{auto}\ t1\ =\ std::chrono::high\_resolution\_clock::now();}
\DoxyCodeLine{00245\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{struct_m_n_i_s_t_aa069a42c7bfc154b6629a90299e5b4c5}{acts}}.size();\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}++)\ \{}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}\ =\ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}\ *\ \mbox{\hyperlink{struct_m_n_i_s_t_a07d3eb64725c1d4a9c4db3747a3e11ac}{Ws}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]\ +\ \mbox{\hyperlink{struct_m_n_i_s_t_a01d6b9d141d3651a561fda34fd7a5ec5}{Bs}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}].replicate(\mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}.rows(),\ 1);}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{struct_m_n_i_s_t_aa069a42c7bfc154b6629a90299e5b4c5}{acts}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]\ ==\ Activation::RELU)\ \{}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{dnn_8hpp_ab4c45afedbd25bf5d73642dcd4362856}{relu}}(\mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}});}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\mbox{\hyperlink{struct_m_n_i_s_t_aa069a42c7bfc154b6629a90299e5b4c5}{acts}}[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}]\ ==\ Activation::SIGMOID)\ \{}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{dnn_8hpp_a0106442994c57f241c878b4d5f06e815}{sigmoid}}(\mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}});}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00253\ \ \ \ \ \}}
\DoxyCodeLine{00254\ \ \ \ \ \textcolor{keyword}{auto}\ t2\ =\ std::chrono::high\_resolution\_clock::now();}
\DoxyCodeLine{00255\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Infer\ runtime:\ "{}}\ <<\ \mbox{\hyperlink{dnn_8hpp_a342bdddec949e302ca4dcb57f1e0c045}{time\_diff}}(t1,\ t2)\ <<\ \textcolor{stringliteral}{"{}\ ms\(\backslash\)n"{}};}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00257\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ correct\_num\ \{0\};}
\DoxyCodeLine{00258\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ k=0;\ k<\mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}.rows();\ k++)\ \{}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ pred\ ;}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}.row(k).maxCoeff(\&pred);}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \textcolor{keywordflow}{if}(pred\ ==\ \mbox{\hyperlink{struct_m_n_i_s_t_a3e4a5673165b37aa54bfc46647f94845}{test\_labels}}[k])\ \{}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ correct\_num\ ++;}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00264\ \ \ \ \ \}}
\DoxyCodeLine{00265\ \ \ \ \ std::cout\ <<\ \textcolor{stringliteral}{"{}Accuracy:\ "{}}\ <<\ correct\_num\ <<\ \textcolor{charliteral}{'/'}\ <<\ \mbox{\hyperlink{_partial_redux__count_8cpp_acbe60897559b79afc28b79b0687b5f29}{res}}.rows()\ <<\ \textcolor{charliteral}{'\(\backslash\)n'};}
\DoxyCodeLine{00266\ \ \ \}}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \ \ \textcolor{comment}{//\ Parameter\ functions\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00270\ \ \ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{struct_m_n_i_s_t_a6b98bfa2eb2b48766029de185b65ae0f}{epoch\_num}}(\textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}})\ \{}
\DoxyCodeLine{00271\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a7d04011b56455a64ae594a56c3113919}{epoch}}\ =\ \mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}};}
\DoxyCodeLine{00272\ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00273\ \ \ \}}
\DoxyCodeLine{00274\ \ \ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{struct_m_n_i_s_t_a3bef907f0521f15af51855fcf2305724}{batch}}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}})\ \{}
\DoxyCodeLine{00275\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a695a9f689e6897ef0c2579442fe9637a}{batch\_size}}\ =\ \mbox{\hyperlink{offscreen_8c_a846c9667e34d56c560bb7f0ac6e173f6}{b}};}
\DoxyCodeLine{00276\ \ \ \ \ assert(\mbox{\hyperlink{struct_m_n_i_s_t_a8b2cb8849eddad2e6f9ad1eb29d96db5}{images}}.rows()\%\mbox{\hyperlink{struct_m_n_i_s_t_a695a9f689e6897ef0c2579442fe9637a}{batch\_size}}\ ==\ 0);}
\DoxyCodeLine{00277\ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00278\ \ \ \}}
\DoxyCodeLine{00279\ \ \ \textcolor{keyword}{auto}\&\ \mbox{\hyperlink{struct_m_n_i_s_t_a3491f9590a76665fe99b5f2bbac4ad6c}{learning\_rate}}(\textcolor{keywordtype}{float}\ l)\ \{}
\DoxyCodeLine{00280\ \ \ \ \ \mbox{\hyperlink{struct_m_n_i_s_t_a6e9fc5116e916f48bb607acac55bdf86}{lrate}}\ =\ l;}
\DoxyCodeLine{00281\ \ \ \ \ \textcolor{keywordflow}{return}\ *\textcolor{keyword}{this};}
\DoxyCodeLine{00282\ \ \ \}}
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00284\ \ \ std::vector<Eigen::MatrixXf>\ \mbox{\hyperlink{struct_m_n_i_s_t_a4887a9372ffba81324578a9777bf7e40}{Ys}};}
\DoxyCodeLine{00285\ \ \ std::vector<Eigen::MatrixXf>\ \mbox{\hyperlink{struct_m_n_i_s_t_a07d3eb64725c1d4a9c4db3747a3e11ac}{Ws}};}
\DoxyCodeLine{00286\ \ \ std::vector<Eigen::MatrixXf>\ \mbox{\hyperlink{struct_m_n_i_s_t_a01d6b9d141d3651a561fda34fd7a5ec5}{Bs}};}
\DoxyCodeLine{00287\ \ \ std::vector<Eigen::MatrixXf>\ \mbox{\hyperlink{struct_m_n_i_s_t_adf7292bd41162241e112c5f66d7454d8}{dW}};}
\DoxyCodeLine{00288\ \ \ std::vector<Eigen::MatrixXf>\ \mbox{\hyperlink{struct_m_n_i_s_t_a927e96143aa7bd9ffdb08c463303f4be}{dB}};}
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00290\ \ \ std::vector<Activation>\ \mbox{\hyperlink{struct_m_n_i_s_t_aa069a42c7bfc154b6629a90299e5b4c5}{acts}};}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \ \ \textcolor{comment}{//\ Training\ images\ \#\ =\ 60000\ x\ 784\ (28\ x\ 28)}}
\DoxyCodeLine{00293\ \ \ Eigen::MatrixXf\ \mbox{\hyperlink{struct_m_n_i_s_t_a8b2cb8849eddad2e6f9ad1eb29d96db5}{images}};}
\DoxyCodeLine{00294\ \ \ Eigen::VectorXi\ \mbox{\hyperlink{struct_m_n_i_s_t_a340eb9288e7c28babe0d2de7ddc3faed}{labels}};}
\DoxyCodeLine{00295\ \ \ Eigen::MatrixXf\ \mbox{\hyperlink{struct_m_n_i_s_t_a4211ee8f528c287bb27b739914a7e168}{delta}};}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ \ \ \textcolor{comment}{//\ Testing\ images\ \#\ =\ 10000\ x\ 784\ (28\ x\ 28)}}
\DoxyCodeLine{00298\ \ \ Eigen::MatrixXf\ \mbox{\hyperlink{struct_m_n_i_s_t_a7418da82eb3156a4185ae0a15f655f7f}{test\_images}};}
\DoxyCodeLine{00299\ \ \ Eigen::VectorXi\ \mbox{\hyperlink{struct_m_n_i_s_t_a3e4a5673165b37aa54bfc46647f94845}{test\_labels}};}
\DoxyCodeLine{00300\ }
\DoxyCodeLine{00301\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{struct_m_n_i_s_t_ac806171682f92f717834f634ea021bbb}{beg\_row}}\ \{0\};}
\DoxyCodeLine{00302\ }
\DoxyCodeLine{00303\ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{struct_m_n_i_s_t_a6e9fc5116e916f48bb607acac55bdf86}{lrate}}\ \{0.01f\};}
\DoxyCodeLine{00304\ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{struct_m_n_i_s_t_aff04e6d9a59d095ecc874a735ae3a27f}{decay}}\ \{0.01f\};}
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00306\ \ \ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{struct_m_n_i_s_t_a7d04011b56455a64ae594a56c3113919}{epoch}}\ \{0\};}
\DoxyCodeLine{00307\ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{struct_m_n_i_s_t_a695a9f689e6897ef0c2579442fe9637a}{batch\_size}}\ \{1\};}
\DoxyCodeLine{00308\ \};}
\DoxyCodeLine{00309\ }
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{dnn_8hpp_a4c1769053ed9550ba8bf53cac0158b62}{forward\_task}}(\mbox{\hyperlink{struct_m_n_i_s_t}{MNIST}}\&\ \mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}},\ \textcolor{keywordtype}{size\_t}\ iter,\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}},}
\DoxyCodeLine{00312\ \ \ std::vector<Eigen::MatrixXf>\&\ mats,}
\DoxyCodeLine{00313\ \ \ std::vector<Eigen::VectorXi>\&\ vecs)\ \{}
\DoxyCodeLine{00314\ \ \ \textcolor{keywordflow}{if}(iter\ !=\ 0)\ \{}
\DoxyCodeLine{00315\ \ \ \ \ \mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}.beg\_row\ +=\ \mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}.batch\_size;}
\DoxyCodeLine{00316\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}.beg\_row\ >=\ \mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}.images.rows())\ \{}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}.beg\_row\ =\ 0;}
\DoxyCodeLine{00318\ \ \ \ \ \}}
\DoxyCodeLine{00319\ \ \ \}}
\DoxyCodeLine{00320\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}=0;\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}<\mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}.acts.size();\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}++)\ \{}
\DoxyCodeLine{00321\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ ==\ 0)\{}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}.forward(\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}},\ mats[\mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}}].\mbox{\hyperlink{_block_methods_8h_aaf22622670d61ade936e9c4cd4f5e7d0}{middleRows}}(\mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}.beg\_row,\ \mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}.batch\_size));}
\DoxyCodeLine{00323\ \ \ \ \ \}}
\DoxyCodeLine{00324\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}.forward(\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}},\ \mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}.Ys[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}-\/1]);}
\DoxyCodeLine{00326\ \ \ \ \ \}}
\DoxyCodeLine{00327\ \ \ \}}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00329\ \ \ \mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}.loss(vecs[\mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}}]);}
\DoxyCodeLine{00330\ \}}
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00332\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{dnn_8hpp_a53b789af3ccd06f7445d37a0f41d2f25}{backward\_task}}(\mbox{\hyperlink{struct_m_n_i_s_t}{MNIST}}\&\ \mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}},\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}},\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}},\ std::vector<Eigen::MatrixXf>\&\ mats)\ \{}
\DoxyCodeLine{00333\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}\ >\ 0)\ \{}
\DoxyCodeLine{00334\ \ \ \ \ \mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}.backward(\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}},\ \mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}.Ys[\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}}-\/1].transpose());}
\DoxyCodeLine{00335\ \ \ \}}
\DoxyCodeLine{00336\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00337\ \ \ \ \ \mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}.backward(\mbox{\hyperlink{_bi_c_g_s_t_a_b__step__by__step_8cpp_acb559820d9ca11295b4500f179ef6392}{i}},\ mats[\mbox{\hyperlink{_cwise__array__power__array_8cpp_a9cb86ff854760bf91a154f2724a9101d}{e}}].\mbox{\hyperlink{_block_methods_8h_aaf22622670d61ade936e9c4cd4f5e7d0}{middleRows}}(\mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}.beg\_row,\ \mbox{\hyperlink{_eigen_solver___eigen_solver___matrix_type_8cpp_a925331f9b6e4844293d36a8df2256d38}{D}}.batch\_size).transpose());}
\DoxyCodeLine{00338\ \ \ \}}
\DoxyCodeLine{00339\ \}}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00342\ \textcolor{keyword}{inline}\ \textcolor{keyword}{auto}\ \mbox{\hyperlink{dnn_8hpp_ae21da4a996eb9657c8da8e9807411ffb}{build\_dnn}}(\textcolor{keywordtype}{unsigned}\ epoch)\ \{}
\DoxyCodeLine{00343\ \ \ \mbox{\hyperlink{struct_m_n_i_s_t}{MNIST}}\ dnn;}
\DoxyCodeLine{00344\ \ \ dnn.\mbox{\hyperlink{struct_m_n_i_s_t_a6b98bfa2eb2b48766029de185b65ae0f}{epoch\_num}}(epoch).batch(100).learning\_rate(0.001);}
\DoxyCodeLine{00345\ \ \ dnn.\mbox{\hyperlink{struct_m_n_i_s_t_a604cd1568aae308bf022addf152b6e38}{add\_layer}}(784,\ 64,\ Activation::RELU);}
\DoxyCodeLine{00346\ \ \ dnn.\mbox{\hyperlink{struct_m_n_i_s_t_a604cd1568aae308bf022addf152b6e38}{add\_layer}}(64,\ 32,\ Activation::RELU);}
\DoxyCodeLine{00347\ \ \ dnn.\mbox{\hyperlink{struct_m_n_i_s_t_a604cd1568aae308bf022addf152b6e38}{add\_layer}}(32,\ 16,\ Activation::RELU);}
\DoxyCodeLine{00348\ \ \ dnn.\mbox{\hyperlink{struct_m_n_i_s_t_a604cd1568aae308bf022addf152b6e38}{add\_layer}}(16,\ 8,\ Activation::RELU);}
\DoxyCodeLine{00349\ \ \ dnn.\mbox{\hyperlink{struct_m_n_i_s_t_a604cd1568aae308bf022addf152b6e38}{add\_layer}}(8,\ 10,\ Activation::NONE);}
\DoxyCodeLine{00350\ \ \ \textcolor{keywordflow}{return}\ dnn;}
\DoxyCodeLine{00351\ \}}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{dnn_8hpp_a1f835bfbb1231ef8b3c0dc87bcc9f7e8}{run\_tbb}}(\mbox{\hyperlink{struct_m_n_i_s_t}{MNIST}}\&,\ \textcolor{keywordtype}{unsigned});}
\DoxyCodeLine{00354\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{dnn_8hpp_a64ca061cc3bb32323e5d16a90e6a51cf}{run\_taskflow}}(\mbox{\hyperlink{struct_m_n_i_s_t}{MNIST}}\&,\ \textcolor{keywordtype}{unsigned});}
\DoxyCodeLine{00355\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{dnn_8hpp_ad8cdf12804cba944ed230de76d23b277}{run\_omp}}(\mbox{\hyperlink{struct_m_n_i_s_t}{MNIST}}\&,\ \textcolor{keywordtype}{unsigned});}
\DoxyCodeLine{00356\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{dnn_8hpp_adb78541933fd75335ac759ac1c2f83ec}{run\_sequential}}(\mbox{\hyperlink{struct_m_n_i_s_t}{MNIST}}\&,\ \textcolor{keywordtype}{unsigned});}
\DoxyCodeLine{00357\ }
\DoxyCodeLine{00358\ }
\DoxyCodeLine{00359\ }

\end{DoxyCode}
