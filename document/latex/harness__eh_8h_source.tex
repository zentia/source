\doxysection{harness\+\_\+eh.\+h}
\hypertarget{harness__eh_8h_source}{}\label{harness__eh_8h_source}\index{external/taskflow/3rd-\/party/tbb/src/test/harness\_eh.h@{external/taskflow/3rd-\/party/tbb/src/test/harness\_eh.h}}
\mbox{\hyperlink{harness__eh_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{\ \ \ \ Copyright\ (c)\ 2005-\/2020\ Intel\ Corporation}}
\DoxyCodeLine{00003\ \textcolor{comment}{}}
\DoxyCodeLine{00004\ \textcolor{comment}{\ \ \ \ Licensed\ under\ the\ Apache\ License,\ Version\ 2.0\ (the\ "{}License"{});}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ \ \ \ you\ may\ not\ use\ this\ file\ except\ in\ compliance\ with\ the\ License.}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ \ \ \ You\ may\ obtain\ a\ copy\ of\ the\ License\ at}}
\DoxyCodeLine{00007\ \textcolor{comment}{}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ \ \ \ \ \ \ \ http://www.apache.org/licenses/LICENSE-\/2.0}}
\DoxyCodeLine{00009\ \textcolor{comment}{}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ \ \ \ Unless\ required\ by\ applicable\ law\ or\ agreed\ to\ in\ writing,\ software}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ \ \ \ distributed\ under\ the\ License\ is\ distributed\ on\ an\ "{}AS\ IS"{}\ BASIS,}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ \ \ \ WITHOUT\ WARRANTIES\ OR\ CONDITIONS\ OF\ ANY\ KIND,\ either\ express\ or\ implied.}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ \ \ \ See\ the\ License\ for\ the\ specific\ language\ governing\ permissions\ and}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ \ \ \ limitations\ under\ the\ License.}}
\DoxyCodeLine{00015\ \textcolor{comment}{*/}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ <typeinfo>}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{tbb__exception_8h}{tbb/tbb\_exception.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{external_2taskflow_23rd-party_2tbb_2include_2tbb_2atomic_8h}{tbb/atomic.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#if\ USE\_TASK\_SCHEDULER\_OBSERVER}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{task__scheduler__observer_8h}{tbb/task\_scheduler\_observer.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{harness_8h}{harness.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{harness__concurrency__tracker_8h}{harness\_concurrency\_tracker.h}}"{}}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{harness__eh_8h_a8380060025b96692562cb7b669f5fe75}{g\_NumThreads}}\ =\ 0;}
\DoxyCodeLine{00027\ \mbox{\hyperlink{namespace_harness_a8dcaafd107ad9fba52286ab3fabe68b6}{Harness::tid\_t}}\ \ \mbox{\hyperlink{harness__eh_8h_ae6c54084c4e8f473497382f5742d4b97}{g\_Master}}\ =\ 0;}
\DoxyCodeLine{00028\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\ \mbox{\hyperlink{harness__eh_8h_a46df26f710c223ec9c87fb47f53af35e}{g\_Orig\_Wakeup\_Msg}}\ =\ \textcolor{stringliteral}{"{}Missed\ wakeup\ or\ machine\ is\ overloaded?"{}};}
\DoxyCodeLine{00029\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\ \mbox{\hyperlink{harness__eh_8h_ac698233e0c6aa63215ae5581f2f59151}{g\_Wakeup\_Msg}}\ =\ \mbox{\hyperlink{harness__eh_8h_a46df26f710c223ec9c87fb47f53af35e}{g\_Orig\_Wakeup\_Msg}};}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ tbb::atomic<intptr\_t>\ \mbox{\hyperlink{harness__eh_8h_a329f1666d5abe8a7738af5ecb2aabcc6}{g\_CurExecuted}},}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a971870d580d052580ae2069033129479}{g\_ExecutedAtLastCatch}},}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a4bd9f4db233557023f74907de588a68f}{g\_ExecutedAtFirstCatch}},}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a011011264d1aeb79199e56a1b952ac00}{g\_ExceptionsThrown}},}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a13a685ace588de73913702e8daa55f72}{g\_MasterExecutedThrow}},\ \ \ \ \ \textcolor{comment}{//\ number\ of\ times\ master\ entered\ exception\ code}}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a7be720bb270c54aa39d5fc8590299a8a}{g\_NonMasterExecutedThrow}},\ \ \textcolor{comment}{//\ number\ of\ times\ nonmaster\ entered\ exception\ code}}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a7750f56dd05392080d665aa88c848097}{g\_PipelinesStarted}};}
\DoxyCodeLine{00038\ \textcolor{keyword}{volatile}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{harness__eh_8h_a626d1ec72053cdf0b9538bcdcb32a15f}{g\_ExceptionCaught}}\ =\ \textcolor{keyword}{false},}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a90543a576b035c82c7f4c9ae82b4eaf1}{g\_UnknownException}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#if\ USE\_TASK\_SCHEDULER\_OBSERVER}}
\DoxyCodeLine{00042\ tbb::atomic<intptr\_t>\ g\_ActualMaxThreads;}
\DoxyCodeLine{00043\ tbb::atomic<intptr\_t>\ g\_ActualCurrentThreads;}
\DoxyCodeLine{00044\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \textcolor{keyword}{volatile}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{harness__eh_8h_ab6fdf831af4a63e59b7bc369b64b03cf}{g\_ThrowException}}\ =\ \textcolor{keyword}{true},}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ g\_Flog\ is\ true\ for\ nested\ construct\ tests\ with\ catches\ (exceptions\ are\ not\ allowed\ to}}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ propagate\ to\ the\ TBB\ construct\ itself.)}}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a40842dca6817cc6cb5179a13c877ae65}{g\_Flog}}\ =\ \textcolor{keyword}{false},}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a60fd56abc404d9257787beba60b25253}{g\_MasterExecuted}}\ =\ \textcolor{keyword}{false},}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a0019b0f0e3da42773017a62b11009761}{g\_NonMasterExecuted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \textcolor{keywordtype}{bool}\ \ \ \ \mbox{\hyperlink{harness__eh_8h_a320cc3156910c4f881e2f22eb85da94c}{g\_ExceptionInMaster}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00054\ \textcolor{keywordtype}{bool}\ \ \ \ \mbox{\hyperlink{harness__eh_8h_ac80ea2e0fd140998b87c076b6aaa0250}{g\_SolitaryException}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00055\ \textcolor{keywordtype}{bool}\ \ \ \ \mbox{\hyperlink{harness__eh_8h_a14b422db28b3cd031d3e6fbbb04ad7b0}{g\_NestedPipelines}}\ \ \ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00058\ tbb::atomic<intptr\_t>\ \mbox{\hyperlink{harness__eh_8h_a405fc3fb1a9e005cc57641d40b3e644f}{g\_NumExceptionsCaught}};}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \textcolor{preprocessor}{\#if\ USE\_TASK\_SCHEDULER\_OBSERVER}}
\DoxyCodeLine{00063\ \textcolor{keyword}{class\ }eh\_test\_observer\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classtbb_1_1interface6_1_1task__scheduler__observer}{tbb::task\_scheduler\_observer}}\ \{}
\DoxyCodeLine{00064\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_af4282a27725fbe86052bb785bdd9c5d3}{on\_scheduler\_entry}}(\textcolor{keywordtype}{bool}\ is\_worker)\ \_\_TBB\_override\ \{}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(is\_worker)\ \{\ \ \textcolor{comment}{//\ we've\ already\ counted\ the\ master}}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}}\ =\ ++g\_ActualCurrentThreads;}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{som__graph_8cpp_ae900b2add8deca663438fb20de69acce}{q}}\ =\ g\_ActualMaxThreads;}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\mbox{\hyperlink{som__graph_8cpp_ae900b2add8deca663438fb20de69acce}{q}}\ <\ \mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}})\ \{}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{som__graph_8cpp_ae900b2add8deca663438fb20de69acce}{q}}\ =\ g\_ActualMaxThreads.compare\_and\_swap(\mbox{\hyperlink{main-override_8cpp_a117104b82864d3b23ec174af6d392709}{p}},\mbox{\hyperlink{som__graph_8cpp_ae900b2add8deca663438fb20de69acce}{q}});}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ size\_t\ q\ =\ g\_ActualMaxThreads;}}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00076\ \ \ \ \ \}}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classtbb_1_1internal_1_1task__scheduler__observer__v3_a657e90f833568e217b807d0122fa7668}{on\_scheduler\_exit}}(\textcolor{keywordtype}{bool}\ is\_worker)\ \_\_TBB\_override\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(is\_worker)\ \{}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/g\_ActualCurrentThreads;}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00081\ \ \ \ \ \}}
\DoxyCodeLine{00082\ \};}
\DoxyCodeLine{00083\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00084\ \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{harness__eh_8h_a24badc0bbf9bba916dc3297bd6db5999}{ResetEhGlobals}}\ (\ \textcolor{keywordtype}{bool}\ throwException\ =\ \textcolor{keyword}{true},\ \textcolor{keywordtype}{bool}\ flog\ =\ \textcolor{keyword}{false}\ )\ \{}
\DoxyCodeLine{00087\ \ \ \ \ \mbox{\hyperlink{class_harness_1_1_concurrency_tracker_a246884e98e5a47fe34ec60da871fb43b}{Harness::ConcurrencyTracker::Reset}}();}
\DoxyCodeLine{00088\ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a329f1666d5abe8a7738af5ecb2aabcc6}{g\_CurExecuted}}\ =\ \mbox{\hyperlink{harness__eh_8h_a971870d580d052580ae2069033129479}{g\_ExecutedAtLastCatch}}\ =\ \mbox{\hyperlink{harness__eh_8h_a4bd9f4db233557023f74907de588a68f}{g\_ExecutedAtFirstCatch}}\ =\ 0;}
\DoxyCodeLine{00089\ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a626d1ec72053cdf0b9538bcdcb32a15f}{g\_ExceptionCaught}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00090\ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a90543a576b035c82c7f4c9ae82b4eaf1}{g\_UnknownException}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00091\ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a14b422db28b3cd031d3e6fbbb04ad7b0}{g\_NestedPipelines}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00092\ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_ab6fdf831af4a63e59b7bc369b64b03cf}{g\_ThrowException}}\ =\ throwException;}
\DoxyCodeLine{00093\ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a13a685ace588de73913702e8daa55f72}{g\_MasterExecutedThrow}}\ =\ 0;}
\DoxyCodeLine{00094\ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a7be720bb270c54aa39d5fc8590299a8a}{g\_NonMasterExecutedThrow}}\ =\ 0;}
\DoxyCodeLine{00095\ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a40842dca6817cc6cb5179a13c877ae65}{g\_Flog}}\ =\ flog;}
\DoxyCodeLine{00096\ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a60fd56abc404d9257787beba60b25253}{g\_MasterExecuted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00097\ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a0019b0f0e3da42773017a62b11009761}{g\_NonMasterExecuted}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00098\ \textcolor{preprocessor}{\#if\ USE\_TASK\_SCHEDULER\_OBSERVER}}
\DoxyCodeLine{00099\ \ \ \ \ g\_ActualMaxThreads\ =\ 1;\ \ \textcolor{comment}{//\ count\ master}}
\DoxyCodeLine{00100\ \ \ \ \ g\_ActualCurrentThreads\ =\ 1;\ \ \textcolor{comment}{//\ count\ master}}
\DoxyCodeLine{00101\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00102\ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a011011264d1aeb79199e56a1b952ac00}{g\_ExceptionsThrown}}\ =\ \mbox{\hyperlink{harness__eh_8h_a405fc3fb1a9e005cc57641d40b3e644f}{g\_NumExceptionsCaught}}\ =\ \mbox{\hyperlink{harness__eh_8h_a7750f56dd05392080d665aa88c848097}{g\_PipelinesStarted}}\ =\ 0;}
\DoxyCodeLine{00103\ \}}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \textcolor{preprocessor}{\#if\ TBB\_USE\_EXCEPTIONS}}
\DoxyCodeLine{00106\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtest__exception}{test\_exception}}\ :\ \textcolor{keyword}{public}\ std::exception\ \{}
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ my\_description;}
\DoxyCodeLine{00108\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00109\ \ \ \ \ \mbox{\hyperlink{classtest__exception_a57f5f8822ad69004637ea2d44573152e}{test\_exception}}\ (\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ description\ )\ :\ my\_description(description)\ \{\}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ \mbox{\hyperlink{classtest__exception_ab63f11de14a9c239d5dcd39e8d436849}{what}}()\ \textcolor{keyword}{const}\ throw()\ \_\_TBB\_override\ \{\ \textcolor{keywordflow}{return}\ my\_description;\ \}}
\DoxyCodeLine{00112\ \};}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \textcolor{keyword}{class\ }solitary\_test\_exception\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classtest__exception}{test\_exception}}\ \{}
\DoxyCodeLine{00115\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00116\ \ \ \ \ solitary\_test\_exception\ (\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ description\ )\ :\ test\_exception(description)\ \{\}}
\DoxyCodeLine{00117\ \};}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \textcolor{preprocessor}{\#if\ TBB\_USE\_CAPTURED\_EXCEPTION}}
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classtbb_1_1captured__exception}{tbb::captured\_exception}}\ PropagatedException;}
\DoxyCodeLine{00121\ \textcolor{preprocessor}{\ \ \ \ \#define\ EXCEPTION\_NAME(e)\ e.name()}}
\DoxyCodeLine{00122\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classtest__exception}{test\_exception}}\ PropagatedException;}
\DoxyCodeLine{00124\ \textcolor{preprocessor}{\ \ \ \ \#define\ EXCEPTION\_NAME(e)\ typeid(e).name()}}
\DoxyCodeLine{00125\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \textcolor{preprocessor}{\#define\ EXCEPTION\_DESCR\ "{}Test\ exception"{}}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \textcolor{preprocessor}{\#if\ HARNESS\_EH\_SIMPLE\_MODE}}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{harness__eh_8h_a48b342c18bf13d0e803d3a9c38faf3dd}{ThrowTestException}}\ ()\ \{}
\DoxyCodeLine{00132\ \ \ \ \ ++\mbox{\hyperlink{harness__eh_8h_a011011264d1aeb79199e56a1b952ac00}{g\_ExceptionsThrown}};}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{classtest__exception}{test\_exception}}(EXCEPTION\_DESCR);}
\DoxyCodeLine{00134\ \}}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \textcolor{preprocessor}{\#else\ }\textcolor{comment}{/*\ !HARNESS\_EH\_SIMPLE\_MODE\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{harness__eh_8h_a48b342c18bf13d0e803d3a9c38faf3dd}{ThrowTestException}}\ (\ intptr\_t\ threshold\ )\ \{}
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keywordtype}{bool}\ inMaster\ =\ (\mbox{\hyperlink{namespace_harness_a3592f6148257145315e054c1e36cea9e}{Harness::CurrentTid}}()\ ==\ \mbox{\hyperlink{harness__eh_8h_ae6c54084c4e8f473497382f5742d4b97}{g\_Master}});}
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\mbox{\hyperlink{harness__eh_8h_ab6fdf831af4a63e59b7bc369b64b03cf}{g\_ThrowException}}\ ||\ \ \ \textcolor{comment}{//\ if\ we're\ not\ supposed\ to\ throw}}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ (!\mbox{\hyperlink{harness__eh_8h_a40842dca6817cc6cb5179a13c877ae65}{g\_Flog}}\ \&\&\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ we're\ not\ catching\ throw\ in\ bodies\ and}}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ (\mbox{\hyperlink{harness__eh_8h_a320cc3156910c4f881e2f22eb85da94c}{g\_ExceptionInMaster}}\ \string^\ inMaster))\ )\ \{\ \textcolor{comment}{//\ we're\ the\ master\ and\ not\ expected\ to\ throw}}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ or\ are\ the\ master\ and\ the\ master\ is\ not\ the\ one\ to\ throw\ (??)}}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00145\ \ \ \ \ \}}
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{keywordflow}{while}\ (\ Existed()\ <\ threshold\ )}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ibm__aix51_8h_a2b17e6e4504bddf60a920f609fc46ea6}{\_\_TBB\_Yield}}();}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\mbox{\hyperlink{harness__eh_8h_ac80ea2e0fd140998b87c076b6aaa0250}{g\_SolitaryException}}\ )\ \{}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ ++\mbox{\hyperlink{harness__eh_8h_a011011264d1aeb79199e56a1b952ac00}{g\_ExceptionsThrown}};}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(inMaster)\ ++\mbox{\hyperlink{harness__eh_8h_a13a685ace588de73913702e8daa55f72}{g\_MasterExecutedThrow}};\ \textcolor{keywordflow}{else}\ ++\mbox{\hyperlink{harness__eh_8h_a7be720bb270c54aa39d5fc8590299a8a}{g\_NonMasterExecutedThrow}};}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \mbox{\hyperlink{classtest__exception}{test\_exception}}(EXCEPTION\_DESCR);}
\DoxyCodeLine{00152\ \ \ \ \ \}}
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{comment}{//\ g\_SolitaryException\ ==\ true}}
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{harness__eh_8h_a14b422db28b3cd031d3e6fbbb04ad7b0}{g\_NestedPipelines}})\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ only\ throw\ exception\ if\ we\ have\ started\ at\ least\ two\ inner\ pipelines}}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ else\ return}}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{harness__eh_8h_a7750f56dd05392080d665aa88c848097}{g\_PipelinesStarted}}\ >=\ 3)\ \{}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{harness__eh_8h_a011011264d1aeb79199e56a1b952ac00}{g\_ExceptionsThrown}}.compare\_and\_swap(1,\ 0)\ ==\ 0\ )\ \ \{}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(inMaster)\ ++\mbox{\hyperlink{harness__eh_8h_a13a685ace588de73913702e8daa55f72}{g\_MasterExecutedThrow}};\ \textcolor{keywordflow}{else}\ ++\mbox{\hyperlink{harness__eh_8h_a7be720bb270c54aa39d5fc8590299a8a}{g\_NonMasterExecutedThrow}};}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ solitary\_test\_exception(EXCEPTION\_DESCR);}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00163\ \ \ \ \ \}}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{harness__eh_8h_a011011264d1aeb79199e56a1b952ac00}{g\_ExceptionsThrown}}.compare\_and\_swap(1,\ 0)\ ==\ 0\ )\ \ \{}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(inMaster)\ ++\mbox{\hyperlink{harness__eh_8h_a13a685ace588de73913702e8daa55f72}{g\_MasterExecutedThrow}};\ \textcolor{keywordflow}{else}\ ++\mbox{\hyperlink{harness__eh_8h_a7be720bb270c54aa39d5fc8590299a8a}{g\_NonMasterExecutedThrow}};}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ solitary\_test\_exception(EXCEPTION\_DESCR);}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00169\ \ \ \ \ \}}
\DoxyCodeLine{00170\ \}}
\DoxyCodeLine{00171\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ !HARNESS\_EH\_SIMPLE\_MODE\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \textcolor{preprocessor}{\#define\ UPDATE\_COUNTS()\ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00174\ \textcolor{preprocessor}{\ \ \ \ \{\ \(\backslash\)}}
\DoxyCodeLine{00175\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ ++g\_CurExecuted;\ \(\backslash\)}}
\DoxyCodeLine{00176\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ if(g\_Master\ ==\ Harness::CurrentTid())\ g\_MasterExecuted\ =\ true;\ \(\backslash\)}}
\DoxyCodeLine{00177\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ else\ g\_NonMasterExecuted\ =\ true;\ \(\backslash\)}}
\DoxyCodeLine{00178\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ if(\ tbb::task::self().is\_cancelled()\ )\ ++g\_TGCCancelled;\ \(\backslash\)}}
\DoxyCodeLine{00179\ \textcolor{preprocessor}{\ \ \ \ \}}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \textcolor{preprocessor}{\#define\ CATCH()\ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00182\ \textcolor{preprocessor}{\ \ \ \ \}\ catch\ (\ PropagatedException\&\ e\ )\ \{\ \(\backslash\)}}
\DoxyCodeLine{00183\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ g\_ExecutedAtFirstCatch.compare\_and\_swap(g\_CurExecuted,0);\ \(\backslash\)}}
\DoxyCodeLine{00184\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ g\_ExecutedAtLastCatch\ =\ g\_CurExecuted;\ \(\backslash\)}}
\DoxyCodeLine{00185\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ ASSERT(\ e.what(),\ "{}Empty\ what()\ string"{}\ );\ \ \(\backslash\)}}
\DoxyCodeLine{00186\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ ASSERT\ (\_\_TBB\_EXCEPTION\_TYPE\_INFO\_BROKEN\ ||\ strcmp(EXCEPTION\_NAME(e),\ (g\_SolitaryException\ ?\ typeid(solitary\_test\_exception)\ :\ typeid(test\_exception)).name()\ )\ ==\ 0,\ "{}Unexpected\ original\ exception\ name"{});\ \(\backslash\)}}
\DoxyCodeLine{00187\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ ASSERT\ (\_\_TBB\_EXCEPTION\_TYPE\_INFO\_BROKEN\ ||\ strcmp(e.what(),\ EXCEPTION\_DESCR)\ ==\ 0,\ "{}Unexpected\ original\ exception\ info"{});\ \(\backslash\)}}
\DoxyCodeLine{00188\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ g\_ExceptionCaught\ =\ l\_ExceptionCaughtAtCurrentLevel\ =\ true;\ \(\backslash\)}}
\DoxyCodeLine{00189\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ ++g\_NumExceptionsCaught;\ \(\backslash\)}}
\DoxyCodeLine{00190\ \textcolor{preprocessor}{\ \ \ \ \}\ catch\ (\ tbb::tbb\_exception\&\ e\ )\ \{\ \(\backslash\)}}
\DoxyCodeLine{00191\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ REPORT("{}Unexpected\ \%s\(\backslash\)n"{},\ e.name());\ \(\backslash\)}}
\DoxyCodeLine{00192\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ ASSERT\ (g\_UnknownException\ \&\&\ !g\_UnknownException,\ "{}Unexpected\ tbb::tbb\_exception"{}\ );\ \(\backslash\)}}
\DoxyCodeLine{00193\ \textcolor{preprocessor}{\ \ \ \ \}\ catch\ (\ std::exception\&\ e\ )\ \{\ \(\backslash\)}}
\DoxyCodeLine{00194\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ REPORT("{}Unexpected\ \%s\(\backslash\)n"{},\ typeid(e).name());\ \(\backslash\)}}
\DoxyCodeLine{00195\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ ASSERT\ (g\_UnknownException\ \&\&\ !g\_UnknownException,\ "{}Unexpected\ std::exception"{}\ );\ \(\backslash\)}}
\DoxyCodeLine{00196\ \textcolor{preprocessor}{\ \ \ \ \}\ catch\ (\ ...\ )\ \{\ \(\backslash\)}}
\DoxyCodeLine{00197\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ g\_ExceptionCaught\ =\ l\_ExceptionCaughtAtCurrentLevel\ =\ true;\ \(\backslash\)}}
\DoxyCodeLine{00198\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ g\_UnknownException\ =\ unknownException\ =\ true;\ \(\backslash\)}}
\DoxyCodeLine{00199\ \textcolor{preprocessor}{\ \ \ \ \}\ \(\backslash\)}}
\DoxyCodeLine{00200\ \textcolor{preprocessor}{\ \ \ \ if\ (\ !g\_SolitaryException\ )\ \(\backslash\)}}
\DoxyCodeLine{00201\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ REMARK\_ONCE\ ("{}Multiple\ exceptions\ mode:\ \%d\ throws"{},\ (intptr\_t)g\_ExceptionsThrown);}}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \textcolor{preprocessor}{\#define\ ASSERT\_EXCEPTION()\ \(\backslash\)}}
\DoxyCodeLine{00204\ \textcolor{preprocessor}{\ \ \ \ \{\ \(\backslash\)}}
\DoxyCodeLine{00205\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ ASSERT\ (!g\_ExceptionsThrown\ ||\ g\_ExceptionCaught,\ "{}throw\ without\ catch"{});\ \(\backslash\)}}
\DoxyCodeLine{00206\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ ASSERT\ (!g\_ExceptionCaught\ ||\ g\_ExceptionsThrown,\ "{}catch\ without\ throw"{});\ \(\backslash\)}}
\DoxyCodeLine{00207\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ ASSERT\ (g\_ExceptionCaught\ ||\ (g\_ExceptionInMaster\ \&\&\ !g\_MasterExecutedThrow)\ ||\ (!g\_ExceptionInMaster\ \&\&\ !g\_NonMasterExecutedThrow),\ "{}no\ exception\ occurred"{});\ \(\backslash\)}}
\DoxyCodeLine{00208\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ ASSERT\ (\_\_TBB\_EXCEPTION\_TYPE\_INFO\_BROKEN\ ||\ !g\_UnknownException,\ "{}unknown\ exception\ was\ caught"{});\ \(\backslash\)}}
\DoxyCodeLine{00209\ \textcolor{preprocessor}{\ \ \ \ \}}}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \textcolor{preprocessor}{\#define\ CATCH\_AND\_ASSERT()\ \(\backslash\)}}
\DoxyCodeLine{00212\ \textcolor{preprocessor}{\ \ \ \ CATCH()\ \(\backslash\)}}
\DoxyCodeLine{00213\ \textcolor{preprocessor}{\ \ \ \ ASSERT\_EXCEPTION()}}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \textcolor{preprocessor}{\#else\ }\textcolor{comment}{/*\ !TBB\_USE\_EXCEPTIONS\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00217\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{harness__eh_8h_a48b342c18bf13d0e803d3a9c38faf3dd}{ThrowTestException}}\ (\ intptr\_t\ )\ \{\}}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*\ !TBB\_USE\_EXCEPTIONS\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \textcolor{preprocessor}{\#define\ TRY()\ \ \ \(\backslash\)}}
\DoxyCodeLine{00222\ \textcolor{preprocessor}{\ \ \ \ bool\ l\_ExceptionCaughtAtCurrentLevel\ =\ false,\ unknownException\ =\ false;\ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00223\ \textcolor{preprocessor}{\ \ \ \ \_\_TBB\_TRY\ \{}}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \textcolor{comment}{//\ "{}l\_ExceptionCaughtAtCurrentLevel\ ||\ unknownException"{}\ is\ used\ only\ to\ "{}touch"{}\ otherwise\ unused\ local\ variables}}
\DoxyCodeLine{00226\ \textcolor{preprocessor}{\#define\ CATCH\_AND\_FAIL()\ \}\ \_\_TBB\_CATCH(...)\ \{\ \(\backslash\)}}
\DoxyCodeLine{00227\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ ASSERT\ (false,\ "{}Cancelling\ tasks\ must\ not\ cause\ any\ exceptions"{});\ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00228\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ (void)(l\_ExceptionCaughtAtCurrentLevel\ \&\&\ unknownException);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00229\ \textcolor{preprocessor}{\ \ \ \ \}}}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{harness__eh_8h_a5b53be6f57e3c32551b29a4413ea9bc3}{c\_Timeout}}\ =\ 1000000;}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{harness__eh_8h_ad15390f89567f1448120d8a74e62bdc4}{WaitUntilConcurrencyPeaks}}\ (\ \textcolor{keywordtype}{int}\ expected\_peak\ )\ \{}
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{harness__eh_8h_a40842dca6817cc6cb5179a13c877ae65}{g\_Flog}}\ )}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ =\ 0;}
\DoxyCodeLine{00237\ retry:}
\DoxyCodeLine{00238\ \ \ \ \ \textcolor{keywordflow}{while}\ (\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ <\ \mbox{\hyperlink{harness__eh_8h_a5b53be6f57e3c32551b29a4413ea9bc3}{c\_Timeout}}\ \&\&\ (\textcolor{keywordtype}{int})\mbox{\hyperlink{class_harness_1_1_concurrency_tracker_ab30286b932e0856c8329a059b3875b38}{Harness::ConcurrencyTracker::PeakParallelism}}()\ <\ expected\_peak\ )}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ibm__aix51_8h_a2b17e6e4504bddf60a920f609fc46ea6}{\_\_TBB\_Yield}}();}
\DoxyCodeLine{00240\ \textcolor{preprocessor}{\#if\ USE\_TASK\_SCHEDULER\_OBSERVER}}
\DoxyCodeLine{00241\ \ \ \ \ \mbox{\hyperlink{harness__assert_8h_a8779f2ab0d9b52cc015cefe27e01db68}{ASSERT\_WARNING}}(\ \mbox{\hyperlink{harness__eh_8h_a8380060025b96692562cb7b669f5fe75}{g\_NumThreads}}\ ==\ g\_ActualMaxThreads,\ \textcolor{stringliteral}{"{}Library\ did\ not\ provide\ sufficient\ threads"{}});}
\DoxyCodeLine{00242\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00243\ \ \ \ \ \mbox{\hyperlink{harness__assert_8h_a8779f2ab0d9b52cc015cefe27e01db68}{ASSERT\_WARNING}}(\mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ <\ \mbox{\hyperlink{harness__eh_8h_a5b53be6f57e3c32551b29a4413ea9bc3}{c\_Timeout}},\mbox{\hyperlink{harness__eh_8h_ac698233e0c6aa63215ae5581f2f59151}{g\_Wakeup\_Msg}});}
\DoxyCodeLine{00244\ \ \ \ \ \textcolor{comment}{//\ Workaround\ in\ case\ a\ missed\ wakeup\ takes\ place}}
\DoxyCodeLine{00245\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ ==\ \mbox{\hyperlink{harness__eh_8h_a5b53be6f57e3c32551b29a4413ea9bc3}{c\_Timeout}}\ )\ \{}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ tbb::task\ \&\mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}}\ =\ *\textcolor{keyword}{new}(\ tbb::task::allocate\_root()\ )\ tbb::empty\_task();}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}}.spawn(\mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}});}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ =\ 0;}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{goto}\ retry;}
\DoxyCodeLine{00250\ \ \ \ \ \}}
\DoxyCodeLine{00251\ \}}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{harness__eh_8h_ad15390f89567f1448120d8a74e62bdc4}{WaitUntilConcurrencyPeaks}}\ ()\ \{\ \mbox{\hyperlink{harness__eh_8h_ad15390f89567f1448120d8a74e62bdc4}{WaitUntilConcurrencyPeaks}}(\mbox{\hyperlink{harness__eh_8h_a8380060025b96692562cb7b669f5fe75}{g\_NumThreads}});\ \}}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{harness__eh_8h_a7cc2f44672b34385d014a196b3c88b49}{IsMaster}}()\ \{}
\DoxyCodeLine{00256\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{namespace_harness_a3592f6148257145315e054c1e36cea9e}{Harness::CurrentTid}}()\ ==\ \mbox{\hyperlink{harness__eh_8h_ae6c54084c4e8f473497382f5742d4b97}{g\_Master}};}
\DoxyCodeLine{00257\ \}}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{harness__eh_8h_a29582d1b669f0cc12ec4dd3af307c191}{IsThrowingThread}}()\ \{}
\DoxyCodeLine{00260\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{harness__eh_8h_a320cc3156910c4f881e2f22eb85da94c}{g\_ExceptionInMaster}}\ \string^\ \mbox{\hyperlink{harness__eh_8h_a7cc2f44672b34385d014a196b3c88b49}{IsMaster}}()\ ?\ \mbox{\hyperlink{yyjson_8h_a41f9c5fb8b08eb5dc3edce4dcb37fee7}{true}}\ :\ \textcolor{keyword}{false};}
\DoxyCodeLine{00261\ \}}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00263\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_cancellator_task_a19cb8723ae861386c32dbee92cf8d355}{CancellatorTask}}\ :\ \textcolor{keyword}{public}\ tbb::task\ \{}
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{volatile}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_cancellator_task_ab993742c817a52b3baaee4f30fcc729b}{s\_Ready}};}
\DoxyCodeLine{00265\ \ \ \ \ tbb::task\_group\_context\ \&\mbox{\hyperlink{class_cancellator_task_ac74ec035b8e64afa0de984a5db49b758}{m\_groupToCancel}};}
\DoxyCodeLine{00266\ \ \ \ \ intptr\_t\ \mbox{\hyperlink{class_cancellator_task_a8db194cab431e421a272efe262794e10}{m\_cancellationThreshold}};}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \ \ tbb::task*\ \mbox{\hyperlink{class_cancellator_task_abb4bcc6168bad14b8bd9ae4ae56543a2}{execute}}\ ()\ \_\_TBB\_override\ \{}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_harness_1_1_concurrency_tracker}{Harness::ConcurrencyTracker}}\ ct;}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_cancellator_task_ab993742c817a52b3baaee4f30fcc729b}{s\_Ready}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\ \mbox{\hyperlink{harness__eh_8h_a329f1666d5abe8a7738af5ecb2aabcc6}{g\_CurExecuted}}\ <\ \mbox{\hyperlink{class_cancellator_task_a8db194cab431e421a272efe262794e10}{m\_cancellationThreshold}}\ )}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ibm__aix51_8h_a2b17e6e4504bddf60a920f609fc46ea6}{\_\_TBB\_Yield}}();}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_cancellator_task_ac74ec035b8e64afa0de984a5db49b758}{m\_groupToCancel}}.cancel\_group\_execution();}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a971870d580d052580ae2069033129479}{g\_ExecutedAtLastCatch}}\ =\ \mbox{\hyperlink{harness__eh_8h_a329f1666d5abe8a7738af5ecb2aabcc6}{g\_CurExecuted}};}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}};}
\DoxyCodeLine{00276\ \ \ \ \ \}}
\DoxyCodeLine{00277\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00278\ \ \ \ \ \mbox{\hyperlink{class_cancellator_task_a19cb8723ae861386c32dbee92cf8d355}{CancellatorTask}}\ (\ tbb::task\_group\_context\&\ ctx,\ intptr\_t\ threshold\ )}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{class_cancellator_task_ac74ec035b8e64afa0de984a5db49b758}{m\_groupToCancel}}(ctx),\ \mbox{\hyperlink{class_cancellator_task_a8db194cab431e421a272efe262794e10}{m\_cancellationThreshold}}(threshold)}
\DoxyCodeLine{00280\ \ \ \ \ \{}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_cancellator_task_ab993742c817a52b3baaee4f30fcc729b}{s\_Ready}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00282\ \ \ \ \ \}}
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00284\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_cancellator_task_afbbb7abef90e882b1c79541acbcb5294}{Reset}}\ ()\ \{\ \mbox{\hyperlink{class_cancellator_task_ab993742c817a52b3baaee4f30fcc729b}{s\_Ready}}\ =\ \textcolor{keyword}{false};\ \}}
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00286\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_cancellator_task_ab124ffed1349f34310870a3fdf77004e}{WaitUntilReady}}\ ()\ \{}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ intptr\_t\ limit\ =\ 10000000;}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ intptr\_t\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ =\ 0;}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ibm__aix51_8h_a2b17e6e4504bddf60a920f609fc46ea6}{\_\_TBB\_Yield}}();}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}(\ !\mbox{\hyperlink{class_cancellator_task_ab993742c817a52b3baaee4f30fcc729b}{s\_Ready}}\ \&\&\ ++\mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ <\ limit\ );}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ should\ yield\ once,\ then\ continue\ if\ Cancellator\ is\ ready.}}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_mini_cpp_unit_8hxx_a092bd7bb2cb7fd9f483b6995cee61bc0}{ASSERT}}(\ \mbox{\hyperlink{class_cancellator_task_ab993742c817a52b3baaee4f30fcc729b}{s\_Ready}}\ ||\ \mbox{\hyperlink{_bi_c_g_s_t_a_b__simple_8cpp_a5150192f625f4d7970d61169b9567f39}{n}}\ ==\ limit,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}\ );}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_cancellator_task_ab993742c817a52b3baaee4f30fcc729b}{s\_Ready}};}
\DoxyCodeLine{00295\ \ \ \ \ \}}
\DoxyCodeLine{00296\ \};}
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00298\ \textcolor{keyword}{volatile}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_cancellator_task_ab993742c817a52b3baaee4f30fcc729b}{CancellatorTask::s\_Ready}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00300\ \textcolor{keyword}{template}<\textcolor{keyword}{class}\ LauncherTaskT,\ \textcolor{keyword}{class}\ CancellatorTaskT>}
\DoxyCodeLine{00301\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{harness__eh_8h_a8fcd00b14fcb1fb72fb16b043179a2d9}{RunCancellationTest}}\ (\ intptr\_t\ threshold\ =\ 1\ )}
\DoxyCodeLine{00302\ \{}
\DoxyCodeLine{00303\ \ \ \ \ tbb::task\_group\_context\ \ ctx;}
\DoxyCodeLine{00304\ \ \ \ \ tbb::empty\_task\ \&\mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}}\ =\ *\textcolor{keyword}{new}(\ tbb::task::allocate\_root(ctx)\ )\ tbb::empty\_task;}
\DoxyCodeLine{00305\ \ \ \ \ \mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}}.set\_ref\_count(3);}
\DoxyCodeLine{00306\ \ \ \ \ \mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}}.spawn(\ *\textcolor{keyword}{new}(\ \mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}}.allocate\_child()\ )\ CancellatorTaskT(ctx,\ threshold)\ );}
\DoxyCodeLine{00307\ \ \ \ \ \mbox{\hyperlink{ibm__aix51_8h_a2b17e6e4504bddf60a920f609fc46ea6}{\_\_TBB\_Yield}}();}
\DoxyCodeLine{00308\ \ \ \ \ \mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}}.spawn(\ *\textcolor{keyword}{new}(\ \mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}}.allocate\_child()\ )\ LauncherTaskT(ctx)\ );}
\DoxyCodeLine{00309\ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_ae671493057440f296b6180da61b17e10}{TRY}}();}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}}.wait\_for\_all();}
\DoxyCodeLine{00311\ \ \ \ \ \mbox{\hyperlink{harness__eh_8h_a0a0fbb1906d353ca0001fce2cd06a921}{CATCH\_AND\_FAIL}}();}
\DoxyCodeLine{00312\ \ \ \ \ \mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}}.destroy(\mbox{\hyperlink{offscreen_8c_a4788d82c901b9367dd5c0daff8a7616b}{r}});}
\DoxyCodeLine{00313\ \}}

\end{DoxyCode}
