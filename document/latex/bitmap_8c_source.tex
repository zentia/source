\doxysection{bitmap.\+c}
\hypertarget{bitmap_8c_source}{}\label{bitmap_8c_source}\index{runtime/EASTL/packages/mimalloc/src/bitmap.c@{runtime/EASTL/packages/mimalloc/src/bitmap.c}}
\mbox{\hyperlink{bitmap_8c}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00002\ \textcolor{comment}{Copyright\ (c)\ 2019-\/2024\ Microsoft\ Research,\ Daan\ Leijen}}
\DoxyCodeLine{00003\ \textcolor{comment}{This\ is\ free\ software;\ you\ can\ redistribute\ it\ and/or\ modify\ it\ under\ the}}
\DoxyCodeLine{00004\ \textcolor{comment}{terms\ of\ the\ MIT\ license.\ A\ copy\ of\ the\ license\ can\ be\ found\ in\ the\ file}}
\DoxyCodeLine{00005\ \textcolor{comment}{"{}LICENSE"{}\ at\ the\ root\ of\ this\ distribution.}}
\DoxyCodeLine{00006\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{00007\ }
\DoxyCodeLine{00008\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00009\ \textcolor{comment}{Concurrent\ bitmap\ that\ can\ set/reset\ sequences\ of\ bits\ atomically}}
\DoxyCodeLine{00010\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{00011\ }
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mimalloc_8h}{mimalloc.h}}"{}}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h}{mimalloc/internal.h}}"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bits_8h}{mimalloc/bits.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bitmap_8h}{bitmap.h}}"{}}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#ifndef\ MI\_OPT\_SIMD}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#define\ MI\_OPT\_SIMD\ \ \ 0}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00022\ \textcolor{comment}{\ \ bfields}}
\DoxyCodeLine{00023\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{bitmap_8c_a5fb9332916a3ebbc622036d3979f035d}{mi\_bfield\_ctz}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}})\ \{}
\DoxyCodeLine{00026\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bits_8h_a8eb514b948438b609030d3d13c0d1c6d}{mi\_ctz}}(\mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}});}
\DoxyCodeLine{00027\ \}}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{bitmap_8c_a3a2008cf0050b5dd55ec336f8d72988f}{mi\_bfield\_clz}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}})\ \{}
\DoxyCodeLine{00030\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bits_8h_af432eec4ac40df0b60ba04ea09a103fb}{mi\_clz}}(\mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}});}
\DoxyCodeLine{00031\ \}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{bitmap_8c_abefd27aa9e4c7a51d85c63a2b2374928}{mi\_bfield\_popcount}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}})\ \{}
\DoxyCodeLine{00034\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bits_8h_ac2a9854186003f70eb01135c9aca3529}{mi\_popcount}}(\mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}});}
\DoxyCodeLine{00035\ \}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{bitmap_8c_a40409a72e24e98bc81e113ae3af78972}{mi\_bfield\_clear\_least\_bit}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}})\ \{}
\DoxyCodeLine{00038\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}}\ \&\ (\mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}}-\/1));}
\DoxyCodeLine{00039\ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \textcolor{comment}{//\ find\ the\ least\ significant\ bit\ that\ is\ set\ (i.e.\ count\ trailing\ zero's)}}
\DoxyCodeLine{00042\ \textcolor{comment}{//\ return\ false\ if\ \`{}x==0`\ (with\ \`{}*idx`\ undefined)\ and\ true\ otherwise,}}
\DoxyCodeLine{00043\ \textcolor{comment}{//\ with\ the\ \`{}idx`\ is\ set\ to\ the\ bit\ index\ (`0\ <=\ *idx\ <\ MI\_BFIELD\_BITS`).}}
\DoxyCodeLine{00044\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a81530e7b3d5b00380e17776d6bf7def6}{mi\_bfield\_find\_least\_bit}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}},\ \textcolor{keywordtype}{size\_t}*\ idx)\ \{}
\DoxyCodeLine{00045\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bits_8h_a9a725eee7a716d863140f201d6a970f5}{mi\_bsf}}(\mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}},idx);}
\DoxyCodeLine{00046\ \}}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \textcolor{comment}{//\ find\ the\ most\ significant\ bit\ that\ is\ set.}}
\DoxyCodeLine{00049\ \textcolor{comment}{//\ return\ false\ if\ \`{}x==0`\ (with\ \`{}*idx`\ undefined)\ and\ true\ otherwise,}}
\DoxyCodeLine{00050\ \textcolor{comment}{//\ with\ the\ \`{}idx`\ is\ set\ to\ the\ bit\ index\ (`0\ <=\ *idx\ <\ MI\_BFIELD\_BITS`).}}
\DoxyCodeLine{00051\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a9c990615f58f32afbd36307e2610599d}{mi\_bfield\_find\_highest\_bit}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}},\ \textcolor{keywordtype}{size\_t}*\ idx)\ \{}
\DoxyCodeLine{00052\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bits_8h_ae1a375404b8024ab419cfc537db20741}{mi\_bsr}}(\mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}},\ idx);}
\DoxyCodeLine{00053\ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \textcolor{comment}{//\ find\ each\ set\ bit\ in\ a\ bit\ field\ \`{}x`\ and\ clear\ it,\ until\ it\ becomes\ zero.}}
\DoxyCodeLine{00058\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a23792b2780ff4daafc8ca3c8f61832d4}{mi\_bfield\_foreach\_bit}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}*\ \mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}},\ \textcolor{keywordtype}{size\_t}*\ idx)\ \{}
\DoxyCodeLine{00059\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ found\ =\ \mbox{\hyperlink{bitmap_8c_a81530e7b3d5b00380e17776d6bf7def6}{mi\_bfield\_find\_least\_bit}}(*\mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}},\ idx);}
\DoxyCodeLine{00060\ \ \ *\mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}}\ =\ \mbox{\hyperlink{bitmap_8c_a40409a72e24e98bc81e113ae3af78972}{mi\_bfield\_clear\_least\_bit}}(*\mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}});}
\DoxyCodeLine{00061\ \ \ \textcolor{keywordflow}{return}\ found;}
\DoxyCodeLine{00062\ \}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{bitmap_8c_af1cc8ec480c8e4cfe52d00584338c8d8}{mi\_bfield\_zero}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00065\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00066\ \}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{bitmap_8c_a8e898496b41e387ca00e77eff2cc364d}{mi\_bfield\_one}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00069\ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00070\ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{bitmap_8c_a68733ed030dc38eabe23102bf17fa86d}{mi\_bfield\_all\_set}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00073\ \ \ \textcolor{keywordflow}{return}\ \string~((\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})0);}
\DoxyCodeLine{00074\ \}}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \textcolor{comment}{//\ mask\ of\ \`{}bit\_count`\ bits\ set\ shifted\ to\ the\ left\ by\ \`{}shiftl`}}
\DoxyCodeLine{00077\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(\textcolor{keywordtype}{size\_t}\ bit\_count,\ \textcolor{keywordtype}{size\_t}\ shiftl)\ \{}
\DoxyCodeLine{00078\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(bit\_count\ >\ 0);}
\DoxyCodeLine{00079\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(bit\_count\ +\ shiftl\ <=\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{00080\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ mask0\ =\ (bit\_count\ <\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}}\ ?\ (\mbox{\hyperlink{bitmap_8c_a8e898496b41e387ca00e77eff2cc364d}{mi\_bfield\_one}}()\ <<\ bit\_count)-\/1\ :\ \mbox{\hyperlink{bitmap_8c_a68733ed030dc38eabe23102bf17fa86d}{mi\_bfield\_all\_set}}());}
\DoxyCodeLine{00081\ \ \ \textcolor{keywordflow}{return}\ (mask0\ <<\ shiftl);}
\DoxyCodeLine{00082\ \}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/\ mi\_bfield\_atomic\_set\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00086\ \textcolor{comment}{//\ the\ \`{}\_set`\ functions\ return\ also\ the\ count\ of\ bits\ that\ were\ already\ set\ (for\ commit\ statistics)}}
\DoxyCodeLine{00087\ \textcolor{comment}{//\ the\ \`{}\_clear`\ functions\ return\ also\ whether\ the\ new\ bfield\ is\ all\ clear\ or\ not\ (for\ the\ chunk\_map)}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \textcolor{comment}{//\ Set\ a\ bit\ atomically.\ Returns\ \`{}true`\ if\ the\ bit\ transitioned\ from\ 0\ to\ 1}}
\DoxyCodeLine{00090\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_adc19e319ae9cc70bef6264077249f89b}{mi\_bfield\_atomic\_set}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})*\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \textcolor{keywordtype}{size\_t}\ idx)\ \{}
\DoxyCodeLine{00091\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(idx\ <\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{00092\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ mask\ =\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(1,\ idx);;}
\DoxyCodeLine{00093\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ old\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a604b95458b4428f32710468937360be9}{mi\_atomic\_or\_acq\_rel}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ mask);}
\DoxyCodeLine{00094\ \ \ \textcolor{keywordflow}{return}\ ((old\&mask)\ ==\ 0);}
\DoxyCodeLine{00095\ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \textcolor{comment}{//\ Clear\ a\ bit\ atomically.\ Returns\ \`{}true`\ if\ the\ bit\ transitioned\ from\ 1\ to\ 0.}}
\DoxyCodeLine{00098\ \textcolor{comment}{//\ \`{}all\_clear`\ is\ set\ if\ the\ new\ bfield\ is\ zero.}}
\DoxyCodeLine{00099\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a19352c87837362ef0ffc2f00152ca428}{mi\_bfield\_atomic\_clear}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})*\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{bool}*\ all\_clear)\ \{}
\DoxyCodeLine{00100\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(idx\ <\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{00101\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ mask\ =\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(1,\ idx);;}
\DoxyCodeLine{00102\ \ \ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ old\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_aedff6636fce005ebfca8b30ee7200124}{mi\_atomic\_and\_acq\_rel}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \string~mask);}
\DoxyCodeLine{00103\ \ \ \textcolor{keywordflow}{if}\ (all\_clear\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\ *all\_clear\ =\ ((old\&\string~mask)==0);\ \}}
\DoxyCodeLine{00104\ \ \ \textcolor{keywordflow}{return}\ ((old\&mask)\ ==\ mask);}
\DoxyCodeLine{00105\ \}}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \textcolor{comment}{//\ Clear\ a\ bit\ but\ only\ when/once\ it\ is\ set.\ This\ is\ used\ by\ concurrent\ free's\ while}}
\DoxyCodeLine{00108\ \textcolor{comment}{//\ the\ page\ is\ abandoned\ and\ mapped.\ This\ can\ incure\ a\ busy\ wait\ :-\/(\ but\ it\ should}}
\DoxyCodeLine{00109\ \textcolor{comment}{//\ happen\ almost\ never\ (and\ is\ accounted\ for\ in\ the\ stats)}}
\DoxyCodeLine{00110\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bitmap_8c_ad0e2ee366d0b3430130b667af1e6dfa1}{mi\_bfield\_atomic\_clear\_once\_set}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})*\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \textcolor{keywordtype}{size\_t}\ idx)\ \{}
\DoxyCodeLine{00111\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(idx\ <\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{00112\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ mask\ =\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(1,\ idx);;}
\DoxyCodeLine{00113\ \ \ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ old\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}});}
\DoxyCodeLine{00114\ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}((old\&mask)\ ==\ 0)\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ old\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_afd6e6e0fbd3a1be232115b5617ca2f65}{mi\_atomic\_load\_acquire}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}});}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((old\&mask)==0)\ \{}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{types_8h_a87d5e84a6b7566eb31e59ac97bf862db}{mi\_subproc\_stat\_counter\_increase}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ad7ba0b811f08490a3e64e9a7b3a03486}{\_mi\_subproc}}(),\ pages\_unabandon\_busy\_wait,\ 1);}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ ((old\&mask)==0)\ \{\ \textcolor{comment}{//\ busy\ wait}}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a57724164dc8624d59014d8503ee07a6b}{mi\_atomic\_yield}}();}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ old\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_afd6e6e0fbd3a1be232115b5617ca2f65}{mi\_atomic\_load\_acquire}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}});}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00124\ \ \ \ \ \}}
\DoxyCodeLine{00125\ \ \ \}\ \textcolor{keywordflow}{while}\ (!\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a04332d02087d9b0e7ad9197c34358177}{mi\_atomic\_cas\_weak\_acq\_rel}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\&old,\ (old\&\string~mask)));}
\DoxyCodeLine{00126\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}((old\&mask)==mask);\ \ \textcolor{comment}{//\ we\ should\ only\ clear\ when\ it\ was\ set}}
\DoxyCodeLine{00127\ \}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \textcolor{comment}{//\ Set\ a\ mask\ set\ of\ bits\ atomically,\ and\ return\ true\ of\ the\ mask\ bits\ transitioned\ from\ all\ 0's\ to\ 1's.}}
\DoxyCodeLine{00130\ \textcolor{comment}{//\ \`{}already\_set`\ contains\ the\ count\ of\ bits\ that\ were\ already\ set\ (used\ when\ committing\ ranges\ to\ account}}
\DoxyCodeLine{00131\ \textcolor{comment}{//\ statistics\ correctly).}}
\DoxyCodeLine{00132\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a3aa02a150aa2df9d5d92fac60d1f39ee}{mi\_bfield\_atomic\_set\_mask}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})*\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ mask,\ \textcolor{keywordtype}{size\_t}*\ already\_set)\ \{}
\DoxyCodeLine{00133\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(mask\ !=\ 0);}
\DoxyCodeLine{00134\ \ \ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ old\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}});}
\DoxyCodeLine{00135\ \ \ \textcolor{keywordflow}{while}\ (!\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a04332d02087d9b0e7ad9197c34358177}{mi\_atomic\_cas\_weak\_acq\_rel}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \&old,\ old|mask))\ \{\};\ \ \textcolor{comment}{//\ try\ to\ atomically\ set\ the\ mask\ bits\ until\ success}}
\DoxyCodeLine{00136\ \ \ \textcolor{keywordflow}{if}\ (already\_set!=\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\ *already\_set\ =\ \mbox{\hyperlink{bitmap_8c_abefd27aa9e4c7a51d85c63a2b2374928}{mi\_bfield\_popcount}}(old\&mask);\ \}}
\DoxyCodeLine{00137\ \ \ \textcolor{keywordflow}{return}\ ((old\&mask)\ ==\ 0);}
\DoxyCodeLine{00138\ \}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \textcolor{comment}{//\ Clear\ a\ mask\ set\ of\ bits\ atomically,\ and\ return\ true\ of\ the\ mask\ bits\ transitioned\ from\ all\ 1's\ to\ 0's}}
\DoxyCodeLine{00141\ \textcolor{comment}{//\ \`{}all\_clear`\ is\ set\ to\ \`{}true`\ if\ the\ new\ bfield\ became\ zero.}}
\DoxyCodeLine{00142\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a157e547da9e74cdee38d34ee1f8b787b}{mi\_bfield\_atomic\_clear\_mask}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})*\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ mask,\ \textcolor{keywordtype}{bool}*\ all\_clear)\ \{}
\DoxyCodeLine{00143\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(mask\ !=\ 0);}
\DoxyCodeLine{00144\ \ \ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ old\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}});}
\DoxyCodeLine{00145\ \ \ \textcolor{keywordflow}{while}\ (!\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a04332d02087d9b0e7ad9197c34358177}{mi\_atomic\_cas\_weak\_acq\_rel}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \&old,\ old\&\string~mask))\ \{\};\ \ \textcolor{comment}{//\ try\ to\ atomically\ clear\ the\ mask\ bits\ until\ success}}
\DoxyCodeLine{00146\ \ \ \textcolor{keywordflow}{if}\ (all\_clear\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\ *all\_clear\ =\ ((old\&\string~mask)==0);\ \}}
\DoxyCodeLine{00147\ \ \ \textcolor{keywordflow}{return}\ ((old\&mask)\ ==\ mask);}
\DoxyCodeLine{00148\ \}}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_acd4bea7cbcae1dd085632ef21d1362a8}{mi\_bfield\_atomic\_setX}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})*\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \textcolor{keywordtype}{size\_t}*\ already\_set)\ \{}
\DoxyCodeLine{00151\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ old\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a2f32fbfcec74ee1d89da0b98dff70618}{mi\_atomic\_exchange\_release}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \mbox{\hyperlink{bitmap_8c_a68733ed030dc38eabe23102bf17fa86d}{mi\_bfield\_all\_set}}());}
\DoxyCodeLine{00152\ \ \ \textcolor{keywordflow}{if}\ (already\_set!=\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\ *already\_set\ =\ \mbox{\hyperlink{bitmap_8c_abefd27aa9e4c7a51d85c63a2b2374928}{mi\_bfield\_popcount}}(old);\ \}}
\DoxyCodeLine{00153\ \ \ \textcolor{keywordflow}{return}\ (old==0);}
\DoxyCodeLine{00154\ \}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \textcolor{comment}{//\ static\ inline\ bool\ mi\_bfield\_atomic\_clearX(\_Atomic(mi\_bfield\_t)*b,\ bool*\ all\_clear)\ \{}}
\DoxyCodeLine{00157\ \textcolor{comment}{//\ \ \ const\ mi\_bfield\_t\ old\ =\ mi\_atomic\_exchange\_release(b,\ mi\_bfield\_zero());}}
\DoxyCodeLine{00158\ \textcolor{comment}{//\ \ \ if\ (all\_clear!=NULL)\ \{\ *all\_clear\ =\ true;\ \}}}
\DoxyCodeLine{00159\ \textcolor{comment}{//\ \ \ return\ (\string~old==0);}}
\DoxyCodeLine{00160\ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/\ mi\_bfield\_atomic\_try\_clear\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \textcolor{comment}{//\ Tries\ to\ clear\ a\ mask\ atomically,\ and\ returns\ true\ if\ the\ mask\ bits\ atomically\ transitioned\ from\ mask\ to\ 0}}
\DoxyCodeLine{00166\ \textcolor{comment}{//\ and\ false\ otherwise\ (leaving\ the\ bit\ field\ as\ is).}}
\DoxyCodeLine{00167\ \textcolor{comment}{//\ \`{}all\_clear`\ is\ set\ to\ \`{}true`\ if\ the\ new\ bfield\ became\ zero.}}
\DoxyCodeLine{00168\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a73c19c3d1d7503123b9c606a25234113}{mi\_bfield\_atomic\_try\_clear\_mask\_of}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})*\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ mask,\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ expect,\ \textcolor{keywordtype}{bool}*\ all\_clear)\ \{}
\DoxyCodeLine{00169\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(mask\ !=\ 0);}
\DoxyCodeLine{00170\ \ \ \textcolor{comment}{//\ try\ to\ atomically\ clear\ the\ mask\ bits}}
\DoxyCodeLine{00171\ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{keywordflow}{if}\ ((expect\ \&\ mask)\ !=\ mask)\ \{\ \ \textcolor{comment}{//\ are\ all\ bits\ still\ set?}}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (all\_clear\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\ *all\_clear\ =\ (expect\ ==\ 0);\ \}}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00175\ \ \ \ \ \}}
\DoxyCodeLine{00176\ \ \ \}\ \textcolor{keywordflow}{while}\ (!\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a04332d02087d9b0e7ad9197c34358177}{mi\_atomic\_cas\_weak\_acq\_rel}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \&expect,\ expect\ \&\ \string~mask));}
\DoxyCodeLine{00177\ \ \ \textcolor{keywordflow}{if}\ (all\_clear\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\ *all\_clear\ =\ ((expect\ \&\ \string~mask)\ ==\ 0);\ \ \}}
\DoxyCodeLine{00178\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00179\ \}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a61e9d10624c9c89874ed34d17995570a}{mi\_bfield\_atomic\_try\_clear\_mask}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})*\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ mask,\ \textcolor{keywordtype}{bool}*\ all\_clear)\ \{}
\DoxyCodeLine{00182\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(mask\ !=\ 0);}
\DoxyCodeLine{00183\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ expect\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}});}
\DoxyCodeLine{00184\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_a73c19c3d1d7503123b9c606a25234113}{mi\_bfield\_atomic\_try\_clear\_mask\_of}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ mask,\ expect,\ all\_clear);}
\DoxyCodeLine{00185\ \}}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \textcolor{comment}{//\ Tries\ to\ clear\ a\ bit\ atomically.\ Returns\ \`{}true`\ if\ the\ bit\ transitioned\ from\ 1\ to\ 0}}
\DoxyCodeLine{00188\ \textcolor{comment}{//\ and\ \`{}false`\ otherwise\ leaving\ the\ bfield\ \`{}b`\ as-\/is.}}
\DoxyCodeLine{00189\ \textcolor{comment}{//\ \`{}all\_clear`\ is\ set\ to\ true\ if\ the\ new\ bfield\ became\ zero\ (and\ false\ otherwise)}}
\DoxyCodeLine{00190\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa2e7eeec6a3536c3ff2427ba328a16cd}{mi\_decl\_maybe\_unused}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_aa9283bf438be537787dcf9da59858571}{mi\_bfield\_atomic\_try\_clear}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})*\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{bool}*\ all\_clear)\ \{}
\DoxyCodeLine{00191\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(idx\ <\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{00192\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ mask\ =\ \mbox{\hyperlink{bitmap_8c_a8e898496b41e387ca00e77eff2cc364d}{mi\_bfield\_one}}()<<idx;}
\DoxyCodeLine{00193\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_a61e9d10624c9c89874ed34d17995570a}{mi\_bfield\_atomic\_try\_clear\_mask}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ mask,\ all\_clear);}
\DoxyCodeLine{00194\ \}}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \textcolor{comment}{//\ Tries\ to\ clear\ a\ byte\ atomically,\ and\ returns\ true\ if\ the\ byte\ atomically\ transitioned\ from\ 0xFF\ to\ 0}}
\DoxyCodeLine{00197\ \textcolor{comment}{//\ \`{}all\_clear`\ is\ set\ to\ true\ if\ the\ new\ bfield\ became\ zero\ (and\ false\ otherwise)}}
\DoxyCodeLine{00198\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa2e7eeec6a3536c3ff2427ba328a16cd}{mi\_decl\_maybe\_unused}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a18993911f3a35530d8d14df7f25155f8}{mi\_bfield\_atomic\_try\_clear8}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})*\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{bool}*\ all\_clear)\ \{}
\DoxyCodeLine{00199\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(idx\ <\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{00200\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}((idx\%8)==0);}
\DoxyCodeLine{00201\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ mask\ =\ ((\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})0xFF)<<idx;}
\DoxyCodeLine{00202\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_a61e9d10624c9c89874ed34d17995570a}{mi\_bfield\_atomic\_try\_clear\_mask}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ mask,\ all\_clear);}
\DoxyCodeLine{00203\ \}}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \textcolor{comment}{//\ Try\ to\ clear\ a\ full\ field\ of\ bits\ atomically,\ and\ return\ true\ all\ bits\ transitioned\ from\ all\ 1's\ to\ 0's.}}
\DoxyCodeLine{00206\ \textcolor{comment}{//\ and\ false\ otherwise\ leaving\ the\ bit\ field\ as-\/is.}}
\DoxyCodeLine{00207\ \textcolor{comment}{//\ \`{}all\_clear`\ is\ set\ to\ true\ if\ the\ new\ bfield\ became\ zero\ (which\ is\ always\ the\ case\ if\ successful).}}
\DoxyCodeLine{00208\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a0ac46edc1d0f39431ac8f67031d9b560}{mi\_bfield\_atomic\_try\_clearX}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})*\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \textcolor{keywordtype}{bool}*\ all\_clear)\ \{}
\DoxyCodeLine{00209\ \ \ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ old\ =\ \mbox{\hyperlink{bitmap_8c_a68733ed030dc38eabe23102bf17fa86d}{mi\_bfield\_all\_set}}();}
\DoxyCodeLine{00210\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad2b681b3847687b6c6ce801d1673f81b}{mi\_atomic\_cas\_strong\_acq\_rel}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \&old,\ \mbox{\hyperlink{bitmap_8c_af1cc8ec480c8e4cfe52d00584338c8d8}{mi\_bfield\_zero}}()))\ \{}
\DoxyCodeLine{00211\ \ \ \ \ \textcolor{keywordflow}{if}\ (all\_clear\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\ *all\_clear\ =\ \textcolor{keyword}{true};\ \}}
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00213\ \ \ \}}
\DoxyCodeLine{00214\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00215\ \}}
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/\ mi\_bfield\_atomic\_is\_set\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \textcolor{comment}{//\ Check\ if\ a\ bit\ is\ set}}
\DoxyCodeLine{00221\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_aba621efc222669e8ec2e92937b5c7312}{mi\_bfield\_atomic\_is\_set}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})*\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx)\ \{}
\DoxyCodeLine{00222\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}}\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}});}
\DoxyCodeLine{00223\ \ \ \textcolor{keywordflow}{return}\ ((\mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}}\ \&\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(1,idx))\ !=\ 0);}
\DoxyCodeLine{00224\ \}}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \textcolor{comment}{//\ Check\ if\ a\ bit\ is\ clear}}
\DoxyCodeLine{00227\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a3390b1df276fa17aac13dcefae49f949}{mi\_bfield\_atomic\_is\_clear}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})*\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx)\ \{}
\DoxyCodeLine{00228\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}}\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}});}
\DoxyCodeLine{00229\ \ \ \textcolor{keywordflow}{return}\ ((\mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}}\ \&\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(1,\ idx))\ ==\ 0);}
\DoxyCodeLine{00230\ \}}
\DoxyCodeLine{00231\ }
\DoxyCodeLine{00232\ \textcolor{comment}{//\ Check\ if\ a\ bit\ is\ xset}}
\DoxyCodeLine{00233\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a707f03eca576cefd148997912dc4759a}{mi\_bfield\_atomic\_is\_xset}}(\mbox{\hyperlink{bitmap_8h_a67332e1b1063739efba1c809b15eeb36}{mi\_xset\_t}}\ \mbox{\hyperlink{bundled_2ranges_8h_a080be1238e6ee3bd4b9f193b4181cf4dacdaeeeba9b4a4c5ebf042c0215a7bb0e}{set}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})*\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx)\ \{}
\DoxyCodeLine{00234\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bundled_2ranges_8h_a080be1238e6ee3bd4b9f193b4181cf4dacdaeeeba9b4a4c5ebf042c0215a7bb0e}{set}})\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_aba621efc222669e8ec2e92937b5c7312}{mi\_bfield\_atomic\_is\_set}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ idx);}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_a3390b1df276fa17aac13dcefae49f949}{mi\_bfield\_atomic\_is\_clear}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ idx);}
\DoxyCodeLine{00236\ \}}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \textcolor{comment}{//\ Check\ if\ all\ bits\ corresponding\ to\ a\ mask\ are\ set.}}
\DoxyCodeLine{00239\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_af01dc0a9a59e0bc965a9c660b3b128ff}{mi\_bfield\_atomic\_is\_set\_mask}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})*\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ mask)\ \{}
\DoxyCodeLine{00240\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(mask\ !=\ 0);}
\DoxyCodeLine{00241\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}}\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}});}
\DoxyCodeLine{00242\ \ \ \textcolor{keywordflow}{return}\ ((\mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}}\ \&\ mask)\ ==\ mask);}
\DoxyCodeLine{00243\ \}}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \textcolor{comment}{//\ Check\ if\ all\ bits\ corresponding\ to\ a\ mask\ are\ clear.}}
\DoxyCodeLine{00246\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a9aecee19df069ccd6d48714a369514c5}{mi\_bfield\_atomic\_is\_clear\_mask}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})*\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ mask)\ \{}
\DoxyCodeLine{00247\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(mask\ !=\ 0);}
\DoxyCodeLine{00248\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}}\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}});}
\DoxyCodeLine{00249\ \ \ \textcolor{keywordflow}{return}\ ((\mbox{\hyperlink{offscreen_8c_ad0da36b2558901e21e7a30f6c227a45e}{x}}\ \&\ mask)\ ==\ 0);}
\DoxyCodeLine{00250\ \}}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00252\ \textcolor{comment}{//\ Check\ if\ all\ bits\ corresponding\ to\ a\ mask\ are\ set/cleared.}}
\DoxyCodeLine{00253\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_ac5d99a264e3b1e53dcb8303da5b75507}{mi\_bfield\_atomic\_is\_xset\_mask}}(\mbox{\hyperlink{bitmap_8h_a67332e1b1063739efba1c809b15eeb36}{mi\_xset\_t}}\ \mbox{\hyperlink{bundled_2ranges_8h_a080be1238e6ee3bd4b9f193b4181cf4dacdaeeeba9b4a4c5ebf042c0215a7bb0e}{set}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ad0b719b7389c8c7c8bb0df7aca86b628}{\_Atomic}}(\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})*\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ mask)\ \{}
\DoxyCodeLine{00254\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(mask\ !=\ 0);}
\DoxyCodeLine{00255\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bundled_2ranges_8h_a080be1238e6ee3bd4b9f193b4181cf4dacdaeeeba9b4a4c5ebf042c0215a7bb0e}{set}})\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_af01dc0a9a59e0bc965a9c660b3b128ff}{mi\_bfield\_atomic\_is\_set\_mask}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ mask);}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_a9aecee19df069ccd6d48714a369514c5}{mi\_bfield\_atomic\_is\_clear\_mask}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ mask);}
\DoxyCodeLine{00257\ \}}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00262\ \textcolor{comment}{\ bitmap\ chunks}}
\DoxyCodeLine{00263\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/\ mi\_bchunk\_set\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \textcolor{comment}{//\ Set\ a\ single\ bit}}
\DoxyCodeLine{00268\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_ab346ba3b2da689a30e5cc0bf7348e552}{mi\_bchunk\_set}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}\ cidx,\ \textcolor{keywordtype}{size\_t}*\ already\_set)\ \{}
\DoxyCodeLine{00269\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(cidx\ <\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00270\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ i\ =\ cidx\ /\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}};}
\DoxyCodeLine{00271\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx\ =\ cidx\ \%\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}};}
\DoxyCodeLine{00272\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ was\_clear\ =\ \mbox{\hyperlink{bitmap_8c_adc19e319ae9cc70bef6264077249f89b}{mi\_bfield\_atomic\_set}}(\&chunk-\/>bfields[i],\ idx);}
\DoxyCodeLine{00273\ \ \ \textcolor{keywordflow}{if}\ (already\_set\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\ *already\_set\ =\ (was\_clear\ ?\ 0\ :\ 1);\ \}}
\DoxyCodeLine{00274\ \ \ \textcolor{keywordflow}{return}\ was\_clear;}
\DoxyCodeLine{00275\ \}}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00277\ \textcolor{comment}{//\ Set\ \`{}0\ <\ n\ <=\ MI\_BFIELD\_BITS`,\ and\ return\ true\ of\ the\ mask\ bits\ transitioned\ from\ all\ 0's\ to\ 1's.}}
\DoxyCodeLine{00278\ \textcolor{comment}{//\ \`{}already\_set`\ contains\ the\ count\ of\ bits\ that\ were\ already\ set\ (used\ when\ committing\ ranges\ to\ account}}
\DoxyCodeLine{00279\ \textcolor{comment}{//\ statistics\ correctly).}}
\DoxyCodeLine{00280\ \textcolor{comment}{//\ Can\ cross\ over\ two\ bfields.}}
\DoxyCodeLine{00281\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_acd5910ee7615a9c560d6d110350691d7}{mi\_bchunk\_setNX}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}\ cidx,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{size\_t}*\ already\_set)\ \{}
\DoxyCodeLine{00282\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(cidx\ <\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00283\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n\ >\ 0\ \&\&\ n\ <=\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{00284\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ i\ =\ cidx\ /\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}};}
\DoxyCodeLine{00285\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx\ =\ cidx\ \%\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}};}
\DoxyCodeLine{00286\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a7b29eabf31d4ddb28a16267045384e03}{mi\_likely}}(idx\ +\ n\ <=\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}})\ \{}
\DoxyCodeLine{00287\ \ \ \ \ \textcolor{comment}{//\ within\ one\ field}}
\DoxyCodeLine{00288\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_a3aa02a150aa2df9d5d92fac60d1f39ee}{mi\_bfield\_atomic\_set\_mask}}(\&chunk-\/>bfields[i],\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(n,idx),\ already\_set);}
\DoxyCodeLine{00289\ \ \ \}}
\DoxyCodeLine{00290\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00291\ \ \ \ \ \textcolor{comment}{//\ spanning\ two\ fields}}
\DoxyCodeLine{00292\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ m\ =\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}}\ -\/\ idx;\ \ \textcolor{comment}{//\ bits\ to\ clear\ in\ the\ first\ field}}
\DoxyCodeLine{00293\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(m\ <\ n);}
\DoxyCodeLine{00294\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(i\ <\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}}\ -\/\ 1);}
\DoxyCodeLine{00295\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(idx\ +\ m\ <=\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{00296\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ already\_set1;}
\DoxyCodeLine{00297\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ all\_set1\ =\ \mbox{\hyperlink{bitmap_8c_a3aa02a150aa2df9d5d92fac60d1f39ee}{mi\_bfield\_atomic\_set\_mask}}(\&chunk-\/>bfields[i],\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(m,\ idx),\ \&already\_set1);}
\DoxyCodeLine{00298\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n\ -\/\ m\ >\ 0);}
\DoxyCodeLine{00299\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n\ -\/\ m\ <\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{00300\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ already\_set2;}
\DoxyCodeLine{00301\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ all\_set2\ =\ \mbox{\hyperlink{bitmap_8c_a3aa02a150aa2df9d5d92fac60d1f39ee}{mi\_bfield\_atomic\_set\_mask}}(\&chunk-\/>bfields[i+1],\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(n\ -\/\ m,\ 0),\ \&already\_set2);}
\DoxyCodeLine{00302\ \ \ \ \ \textcolor{keywordflow}{if}\ (already\_set\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\ *already\_set\ =\ already\_set1\ +\ already\_set2;\ \}}
\DoxyCodeLine{00303\ \ \ \ \ \textcolor{keywordflow}{return}\ (all\_set1\ \&\&\ all\_set2);}
\DoxyCodeLine{00304\ \ \ \}}
\DoxyCodeLine{00305\ \}}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ \textcolor{comment}{//\ Set\ a\ sequence\ of\ \`{}n`\ bits\ within\ a\ chunk.}}
\DoxyCodeLine{00308\ \textcolor{comment}{//\ Returns\ true\ if\ all\ bits\ transitioned\ from\ 0\ to\ 1\ (or\ 1\ to\ 0).}}
\DoxyCodeLine{00309\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a0a63ad6116421ea60eb43806f8881a3b}{mi\_decl\_noinline}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a389dbd44ba9433ec98be6f3222776f46}{mi\_bchunk\_xsetN\_}}(\mbox{\hyperlink{bitmap_8h_a67332e1b1063739efba1c809b15eeb36}{mi\_xset\_t}}\ \mbox{\hyperlink{bundled_2ranges_8h_a080be1238e6ee3bd4b9f193b4181cf4dacdaeeeba9b4a4c5ebf042c0215a7bb0e}{set}},\ \mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}\ cidx,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{size\_t}*\ palready\_set,\ \textcolor{keywordtype}{bool}*\ pmaybe\_all\_clear)\ \{}
\DoxyCodeLine{00310\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(cidx\ +\ n\ <=\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00311\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n>0);}
\DoxyCodeLine{00312\ \ \ \textcolor{keywordtype}{bool}\ all\_transition\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00313\ \ \ \textcolor{keywordtype}{bool}\ maybe\_all\_clear\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00314\ \ \ \textcolor{keywordtype}{size\_t}\ total\_already\_set\ =\ 0;}
\DoxyCodeLine{00315\ \ \ \textcolor{keywordtype}{size\_t}\ idx\ \ \ =\ cidx\ \%\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}};}
\DoxyCodeLine{00316\ \ \ \textcolor{keywordtype}{size\_t}\ field\ =\ cidx\ /\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}};}
\DoxyCodeLine{00317\ \ \ \textcolor{keywordflow}{while}\ (n\ >\ 0)\ \{}
\DoxyCodeLine{00318\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ m\ =\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}}\ -\/\ idx;\ \ \ \textcolor{comment}{//\ m\ is\ the\ bits\ to\ xset\ in\ this\ field}}
\DoxyCodeLine{00319\ \ \ \ \ \textcolor{keywordflow}{if}\ (m\ >\ n)\ \{\ m\ =\ n;\ \}}
\DoxyCodeLine{00320\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(idx\ +\ m\ <=\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{00321\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(field\ <\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}});}
\DoxyCodeLine{00322\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ mask\ =\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(m,\ idx);}
\DoxyCodeLine{00323\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ already\_set\ =\ 0;}
\DoxyCodeLine{00324\ \ \ \ \ \textcolor{keywordtype}{bool}\ all\_clear\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00325\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ transition\ =\ (\mbox{\hyperlink{bundled_2ranges_8h_a080be1238e6ee3bd4b9f193b4181cf4dacdaeeeba9b4a4c5ebf042c0215a7bb0e}{set}}\ ?\ \mbox{\hyperlink{bitmap_8c_a3aa02a150aa2df9d5d92fac60d1f39ee}{mi\_bfield\_atomic\_set\_mask}}(\&chunk-\/>bfields[field],\ mask,\ \&already\_set)}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ :\ \mbox{\hyperlink{bitmap_8c_a157e547da9e74cdee38d34ee1f8b787b}{mi\_bfield\_atomic\_clear\_mask}}(\&chunk-\/>bfields[field],\ mask,\ \&all\_clear));}
\DoxyCodeLine{00327\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}((transition\ \&\&\ already\_set\ ==\ 0)\ ||\ (!transition\ \&\&\ already\_set\ >\ 0));}
\DoxyCodeLine{00328\ \ \ \ \ all\_transition\ =\ all\_transition\ \&\&\ transition;}
\DoxyCodeLine{00329\ \ \ \ \ total\_already\_set\ +=\ already\_set;}
\DoxyCodeLine{00330\ \ \ \ \ maybe\_all\_clear\ =\ maybe\_all\_clear\ \&\&\ all\_clear;}
\DoxyCodeLine{00331\ \ \ \ \ \textcolor{comment}{//\ next\ field}}
\DoxyCodeLine{00332\ \ \ \ \ field++;}
\DoxyCodeLine{00333\ \ \ \ \ idx\ =\ 0;}
\DoxyCodeLine{00334\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(m\ <=\ n);}
\DoxyCodeLine{00335\ \ \ \ \ n\ -\/=\ m;}
\DoxyCodeLine{00336\ \ \ \}}
\DoxyCodeLine{00337\ \ \ \textcolor{keywordflow}{if}\ (palready\_set!=\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\ *palready\_set\ =\ total\_already\_set;\ \}}
\DoxyCodeLine{00338\ \ \ \textcolor{keywordflow}{if}\ (pmaybe\_all\_clear!=\mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\ *pmaybe\_all\_clear\ =\ maybe\_all\_clear;\ \}}
\DoxyCodeLine{00339\ \ \ \textcolor{keywordflow}{return}\ all\_transition;}
\DoxyCodeLine{00340\ \}}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00342\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a931ab182d5a458c9811743a39c0637df}{mi\_bchunk\_setN}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}\ cidx,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{size\_t}*\ already\_set)\ \{}
\DoxyCodeLine{00343\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n>0\ \&\&\ n\ <=\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00344\ \ \ \textcolor{keywordflow}{if}\ (n==1)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_ab346ba3b2da689a30e5cc0bf7348e552}{mi\_bchunk\_set}}(chunk,\ cidx,\ already\_set);}
\DoxyCodeLine{00345\ \ \ \textcolor{comment}{//\ if\ (n==8\ \&\&\ (cidx\%8)\ ==\ 0)\ return\ mi\_bchunk\_set8(chunk,\ cidx,\ already\_set);}}
\DoxyCodeLine{00346\ \ \ \textcolor{comment}{//\ if\ (n==MI\_BFIELD\_BITS)\ return\ mi\_bchunk\_setX(chunk,\ cidx,\ already\_set);}}
\DoxyCodeLine{00347\ \ \ \textcolor{keywordflow}{if}\ (n<=\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}})\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_acd5910ee7615a9c560d6d110350691d7}{mi\_bchunk\_setNX}}(chunk,\ cidx,\ n,\ already\_set);}
\DoxyCodeLine{00348\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_a389dbd44ba9433ec98be6f3222776f46}{mi\_bchunk\_xsetN\_}}(\mbox{\hyperlink{bitmap_8h_a5dbfb222b02d9b5694b56930ec5af3e5}{MI\_BIT\_SET}},\ chunk,\ cidx,\ n,\ already\_set,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00349\ \}}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/\ mi\_bchunk\_clear\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a9dfbfc8fe0b5d49b9cb05fb4a16ce60c}{mi\_bchunk\_clear}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}\ cidx,\ \textcolor{keywordtype}{bool}*\ all\_clear)\ \{}
\DoxyCodeLine{00354\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(cidx\ <\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00355\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ i\ =\ cidx\ /\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}};}
\DoxyCodeLine{00356\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx\ =\ cidx\ \%\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}};}
\DoxyCodeLine{00357\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_a19352c87837362ef0ffc2f00152ca428}{mi\_bfield\_atomic\_clear}}(\&chunk-\/>bfields[i],\ idx,\ all\_clear);}
\DoxyCodeLine{00358\ \}}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_ad965785a3292db948723392a2db65539}{mi\_bchunk\_clearN}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}\ cidx,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{bool}*\ maybe\_all\_clear)\ \{}
\DoxyCodeLine{00361\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n>0\ \&\&\ n\ <=\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00362\ \ \ \textcolor{keywordflow}{if}\ (n==1)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_a9dfbfc8fe0b5d49b9cb05fb4a16ce60c}{mi\_bchunk\_clear}}(chunk,\ cidx,\ maybe\_all\_clear);}
\DoxyCodeLine{00363\ \ \ \textcolor{comment}{//\ if\ (n==8)\ return\ mi\_bchunk\_clear8(chunk,\ cidx,\ maybe\_all\_clear);}}
\DoxyCodeLine{00364\ \ \ \textcolor{comment}{//\ if\ (n==MI\_BFIELD\_BITS)\ return\ mi\_bchunk\_clearX(chunk,\ cidx,\ maybe\_all\_clear);}}
\DoxyCodeLine{00365\ \ \ \textcolor{comment}{//\ TODO:\ implement\ mi\_bchunk\_xsetNX\ instead\ of\ setNX}}
\DoxyCodeLine{00366\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_a389dbd44ba9433ec98be6f3222776f46}{mi\_bchunk\_xsetN\_}}(\mbox{\hyperlink{bitmap_8h_a726b00f7dbd3dc51249355e79845011b}{MI\_BIT\_CLEAR}},\ chunk,\ cidx,\ n,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}},\ maybe\_all\_clear);}
\DoxyCodeLine{00367\ \}}
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/\ mi\_bchunk\_is\_xset\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00371\ }
\DoxyCodeLine{00372\ \textcolor{comment}{//\ Check\ if\ a\ sequence\ of\ \`{}n`\ bits\ within\ a\ chunk\ are\ all\ set/cleared.}}
\DoxyCodeLine{00373\ \textcolor{comment}{//\ This\ can\ cross\ bfield's}}
\DoxyCodeLine{00374\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a0a63ad6116421ea60eb43806f8881a3b}{mi\_decl\_noinline}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a07385ebbb69ea290eefe819da4e74d3f}{mi\_bchunk\_is\_xsetN\_}}(\mbox{\hyperlink{bitmap_8h_a67332e1b1063739efba1c809b15eeb36}{mi\_xset\_t}}\ \mbox{\hyperlink{bundled_2ranges_8h_a080be1238e6ee3bd4b9f193b4181cf4dacdaeeeba9b4a4c5ebf042c0215a7bb0e}{set}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}\ field\_idx,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n)\ \{}
\DoxyCodeLine{00375\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}((field\_idx*\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}})\ +\ idx\ +\ n\ <=\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00376\ \ \ \textcolor{keywordflow}{while}\ (n\ >\ 0)\ \{}
\DoxyCodeLine{00377\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ m\ =\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}}\ -\/\ idx;\ \ \ \textcolor{comment}{//\ m\ is\ the\ bits\ to\ xset\ in\ this\ field}}
\DoxyCodeLine{00378\ \ \ \ \ \textcolor{keywordflow}{if}\ (m\ >\ n)\ \{\ m\ =\ n;\ \}}
\DoxyCodeLine{00379\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(idx\ +\ m\ <=\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{00380\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(field\_idx\ <\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}});}
\DoxyCodeLine{00381\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ mask\ =\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(m,\ idx);}
\DoxyCodeLine{00382\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{bitmap_8c_ac5d99a264e3b1e53dcb8303da5b75507}{mi\_bfield\_atomic\_is\_xset\_mask}}(\mbox{\hyperlink{bundled_2ranges_8h_a080be1238e6ee3bd4b9f193b4181cf4dacdaeeeba9b4a4c5ebf042c0215a7bb0e}{set}},\ \&chunk-\/>bfields[field\_idx],\ mask))\ \{}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00384\ \ \ \ \ \}}
\DoxyCodeLine{00385\ \ \ \ \ \textcolor{comment}{//\ next\ field}}
\DoxyCodeLine{00386\ \ \ \ \ field\_idx++;}
\DoxyCodeLine{00387\ \ \ \ \ idx\ =\ 0;}
\DoxyCodeLine{00388\ \ \ \ \ n\ -\/=\ m;}
\DoxyCodeLine{00389\ \ \ \}}
\DoxyCodeLine{00390\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00391\ \}}
\DoxyCodeLine{00392\ }
\DoxyCodeLine{00393\ \textcolor{comment}{//\ Check\ if\ a\ sequence\ of\ \`{}n`\ bits\ within\ a\ chunk\ are\ all\ set/cleared.}}
\DoxyCodeLine{00394\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_ab0d208390523d5afdb78b6f0be816b2f}{mi\_bchunk\_is\_xsetN}}(\mbox{\hyperlink{bitmap_8h_a67332e1b1063739efba1c809b15eeb36}{mi\_xset\_t}}\ \mbox{\hyperlink{bundled_2ranges_8h_a080be1238e6ee3bd4b9f193b4181cf4dacdaeeeba9b4a4c5ebf042c0215a7bb0e}{set}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}\ cidx,\ \textcolor{keywordtype}{size\_t}\ n)\ \{}
\DoxyCodeLine{00395\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(cidx\ +\ n\ <=\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00396\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n>0);}
\DoxyCodeLine{00397\ \ \ \textcolor{keywordflow}{if}\ (n==0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00398\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ i\ =\ cidx\ /\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}};}
\DoxyCodeLine{00399\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx\ =\ cidx\ \%\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}};}
\DoxyCodeLine{00400\ \ \ \textcolor{keywordflow}{if}\ (n==1)\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_a707f03eca576cefd148997912dc4759a}{mi\_bfield\_atomic\_is\_xset}}(\mbox{\hyperlink{bundled_2ranges_8h_a080be1238e6ee3bd4b9f193b4181cf4dacdaeeeba9b4a4c5ebf042c0215a7bb0e}{set}},\ \&chunk-\/>bfields[i],\ idx);\ \}}
\DoxyCodeLine{00401\ \ \ \textcolor{keywordflow}{if}\ (idx\ +\ n\ <=\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_ac5d99a264e3b1e53dcb8303da5b75507}{mi\_bfield\_atomic\_is\_xset\_mask}}(\mbox{\hyperlink{bundled_2ranges_8h_a080be1238e6ee3bd4b9f193b4181cf4dacdaeeeba9b4a4c5ebf042c0215a7bb0e}{set}},\ \&chunk-\/>bfields[i],\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(n,\ idx));\ \}}
\DoxyCodeLine{00402\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_a07385ebbb69ea290eefe819da4e74d3f}{mi\_bchunk\_is\_xsetN\_}}(\mbox{\hyperlink{bundled_2ranges_8h_a080be1238e6ee3bd4b9f193b4181cf4dacdaeeeba9b4a4c5ebf042c0215a7bb0e}{set}},\ chunk,\ i,\ idx,\ n);}
\DoxyCodeLine{00403\ \}}
\DoxyCodeLine{00404\ }
\DoxyCodeLine{00405\ }
\DoxyCodeLine{00406\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/\ mi\_bchunk\_try\_clear\ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00407\ }
\DoxyCodeLine{00408\ \textcolor{comment}{//\ Clear\ \`{}0\ <\ n\ <=\ MI\_BITFIELD\_BITS`.\ Can\ cross\ over\ a\ bfield\ boundary.}}
\DoxyCodeLine{00409\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_ac1f1eaa500cd758892ff36af257c1b0b}{mi\_bchunk\_try\_clearNX}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}\ cidx,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{bool}*\ pmaybe\_all\_clear)\ \{}
\DoxyCodeLine{00410\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(cidx\ <\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00411\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n\ <=\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{00412\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ i\ =\ cidx\ /\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}};}
\DoxyCodeLine{00413\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx\ =\ cidx\ \%\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}};}
\DoxyCodeLine{00414\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a7b29eabf31d4ddb28a16267045384e03}{mi\_likely}}(idx\ +\ n\ <=\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}})\ \{}
\DoxyCodeLine{00415\ \ \ \ \ \textcolor{comment}{//\ within\ one\ field}}
\DoxyCodeLine{00416\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_a61e9d10624c9c89874ed34d17995570a}{mi\_bfield\_atomic\_try\_clear\_mask}}(\&chunk-\/>bfields[i],\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(n,\ idx),\ pmaybe\_all\_clear);}
\DoxyCodeLine{00417\ \ \ \}}
\DoxyCodeLine{00418\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00419\ \ \ \ \ \textcolor{comment}{//\ spanning\ two\ fields\ (todo:\ use\ double-\/word\ atomic\ ops?)}}
\DoxyCodeLine{00420\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ m\ =\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}}\ -\/\ idx;\ \ \textcolor{comment}{//\ bits\ to\ clear\ in\ the\ first\ field}}
\DoxyCodeLine{00421\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(m\ <\ n);}
\DoxyCodeLine{00422\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(i\ <\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}}\ -\/\ 1);}
\DoxyCodeLine{00423\ \ \ \ \ \textcolor{keywordtype}{bool}\ field1\_is\_clear;}
\DoxyCodeLine{00424\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{bitmap_8c_a61e9d10624c9c89874ed34d17995570a}{mi\_bfield\_atomic\_try\_clear\_mask}}(\&chunk-\/>bfields[i],\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(m,\ idx),\ \&field1\_is\_clear))\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00425\ \ \ \ \ \textcolor{comment}{//\ try\ the\ second\ field\ as\ well}}
\DoxyCodeLine{00426\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n\ -\/\ m\ >\ 0);}
\DoxyCodeLine{00427\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n\ -\/\ m\ <\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{00428\ \ \ \ \ \textcolor{keywordtype}{bool}\ field2\_is\_clear;}
\DoxyCodeLine{00429\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{bitmap_8c_a61e9d10624c9c89874ed34d17995570a}{mi\_bfield\_atomic\_try\_clear\_mask}}(\&chunk-\/>bfields[i+1],\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(n\ -\/\ m,\ 0),\ \&field2\_is\_clear))\ \{}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \textcolor{comment}{//\ we\ failed\ to\ clear\ the\ second\ field,\ restore\ the\ first\ one}}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \mbox{\hyperlink{bitmap_8c_a3aa02a150aa2df9d5d92fac60d1f39ee}{mi\_bfield\_atomic\_set\_mask}}(\&chunk-\/>bfields[i],\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(m,\ idx),\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00433\ \ \ \ \ \}}
\DoxyCodeLine{00434\ \ \ \ \ \textcolor{keywordflow}{if}\ (pmaybe\_all\_clear\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\ *pmaybe\_all\_clear\ =\ field1\_is\_clear\ \&\&\ field2\_is\_clear;\ \ \}}
\DoxyCodeLine{00435\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00436\ \ \ \}}
\DoxyCodeLine{00437\ \}}
\DoxyCodeLine{00438\ }
\DoxyCodeLine{00439\ \textcolor{comment}{//\ Clear\ a\ full\ aligned\ bfield.}}
\DoxyCodeLine{00440\ \textcolor{comment}{//\ static\ inline\ bool\ mi\_bchunk\_try\_clearX(mi\_bchunk\_t*\ chunk,\ size\_t\ cidx,\ bool*\ pmaybe\_all\_clear)\ \{}}
\DoxyCodeLine{00441\ \textcolor{comment}{//\ \ \ mi\_assert\_internal(cidx\ <\ MI\_BCHUNK\_BITS);}}
\DoxyCodeLine{00442\ \textcolor{comment}{//\ \ \ mi\_assert\_internal((cidx\%MI\_BFIELD\_BITS)\ ==\ 0);}}
\DoxyCodeLine{00443\ \textcolor{comment}{//\ \ \ const\ size\_t\ i\ =\ cidx\ /\ MI\_BFIELD\_BITS;}}
\DoxyCodeLine{00444\ \textcolor{comment}{//\ \ \ return\ mi\_bfield\_atomic\_try\_clearX(\&chunk-\/>bfields[i],\ pmaybe\_all\_clear);}}
\DoxyCodeLine{00445\ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{00446\ }
\DoxyCodeLine{00447\ \textcolor{comment}{//\ Try\ to\ atomically\ clear\ a\ sequence\ of\ \`{}n`\ bits\ within\ a\ chunk.}}
\DoxyCodeLine{00448\ \textcolor{comment}{//\ Returns\ true\ if\ all\ bits\ transitioned\ from\ 1\ to\ 0,}}
\DoxyCodeLine{00449\ \textcolor{comment}{//\ and\ false\ otherwise\ leaving\ all\ bit\ fields\ as\ is.}}
\DoxyCodeLine{00450\ \textcolor{comment}{//\ Note:\ this\ is\ the\ complex\ one\ as\ we\ need\ to\ unwind\ partial\ atomic\ operations\ if\ we\ fail\ halfway..}}
\DoxyCodeLine{00451\ \textcolor{comment}{//\ \`{}maybe\_all\_clear`\ is\ set\ to\ \`{}true`\ if\ all\ the\ bfields\ involved\ become\ zero.}}
\DoxyCodeLine{00452\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a0a63ad6116421ea60eb43806f8881a3b}{mi\_decl\_noinline}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_ac0ab2ad91f214e09480dfbe321fd3db4}{mi\_bchunk\_try\_clearN\_}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}\ cidx,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{bool}*\ pmaybe\_all\_clear)\ \{}
\DoxyCodeLine{00453\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(cidx\ +\ n\ <=\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00454\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n>0);}
\DoxyCodeLine{00455\ \ \ \textcolor{keywordflow}{if}\ (pmaybe\_all\_clear\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\ *pmaybe\_all\_clear\ =\ \textcolor{keyword}{true};\ \}}
\DoxyCodeLine{00456\ \ \ \textcolor{keywordflow}{if}\ (n==0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ \ \ \textcolor{comment}{//\ first\ field}}
\DoxyCodeLine{00459\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ start\_idx\ =\ cidx\ \%\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}};}
\DoxyCodeLine{00460\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ start\_field\ =\ cidx\ /\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}};}
\DoxyCodeLine{00461\ \ \ \textcolor{keywordtype}{size\_t}\ field\ =\ start\_field;}
\DoxyCodeLine{00462\ \ \ \textcolor{keywordtype}{size\_t}\ m\ =\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}}\ -\/\ start\_idx;\ \ \ \textcolor{comment}{//\ m\ are\ the\ bits\ to\ clear\ in\ this\ field}}
\DoxyCodeLine{00463\ \ \ \textcolor{keywordflow}{if}\ (m\ >\ n)\ \{\ m\ =\ n;\ \}}
\DoxyCodeLine{00464\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(start\_idx\ +\ m\ <=\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{00465\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(start\_field\ <\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}});}
\DoxyCodeLine{00466\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ mask\_start\ =\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(m,\ start\_idx);}
\DoxyCodeLine{00467\ \ \ \textcolor{keywordtype}{bool}\ maybe\_all\_clear;}
\DoxyCodeLine{00468\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{bitmap_8c_a61e9d10624c9c89874ed34d17995570a}{mi\_bfield\_atomic\_try\_clear\_mask}}(\&chunk-\/>bfields[field],\ mask\_start,\ \&maybe\_all\_clear))\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00469\ }
\DoxyCodeLine{00470\ \ \ \textcolor{comment}{//\ done?}}
\DoxyCodeLine{00471\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(m\ <=\ n);}
\DoxyCodeLine{00472\ \ \ n\ -\/=\ m;}
\DoxyCodeLine{00473\ }
\DoxyCodeLine{00474\ \ \ \textcolor{comment}{//\ continue\ with\ mid\ fields\ and\ last\ field:\ if\ these\ fail\ we\ need\ to\ recover\ by\ unsetting\ previous\ fields}}
\DoxyCodeLine{00475\ \ \ \textcolor{comment}{//\ mid\ fields?}}
\DoxyCodeLine{00476\ \ \ \textcolor{keywordflow}{while}\ (n\ >=\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}})\ \{}
\DoxyCodeLine{00477\ \ \ \ \ field++;}
\DoxyCodeLine{00478\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(field\ <\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}});}
\DoxyCodeLine{00479\ \ \ \ \ \textcolor{keywordtype}{bool}\ field\_is\_clear;}
\DoxyCodeLine{00480\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{bitmap_8c_a0ac46edc1d0f39431ac8f67031d9b560}{mi\_bfield\_atomic\_try\_clearX}}(\&chunk-\/>bfields[field],\ \&field\_is\_clear))\ \textcolor{keywordflow}{goto}\ restore;}
\DoxyCodeLine{00481\ \ \ \ \ maybe\_all\_clear\ =\ maybe\_all\_clear\ \&\&\ field\_is\_clear;}
\DoxyCodeLine{00482\ \ \ \ \ n\ -\/=\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}};}
\DoxyCodeLine{00483\ \ \ \}}
\DoxyCodeLine{00484\ }
\DoxyCodeLine{00485\ \ \ \textcolor{comment}{//\ last\ field?}}
\DoxyCodeLine{00486\ \ \ \textcolor{keywordflow}{if}\ (n\ >\ 0)\ \{}
\DoxyCodeLine{00487\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n\ <\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{00488\ \ \ \ \ field++;}
\DoxyCodeLine{00489\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(field\ <\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}});}
\DoxyCodeLine{00490\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ mask\_end\ =\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(n,\ 0);}
\DoxyCodeLine{00491\ \ \ \ \ \textcolor{keywordtype}{bool}\ field\_is\_clear;}
\DoxyCodeLine{00492\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{bitmap_8c_a61e9d10624c9c89874ed34d17995570a}{mi\_bfield\_atomic\_try\_clear\_mask}}(\&chunk-\/>bfields[field],\ mask\_end,\ \&field\_is\_clear))\ \textcolor{keywordflow}{goto}\ restore;}
\DoxyCodeLine{00493\ \ \ \ \ maybe\_all\_clear\ =\ maybe\_all\_clear\ \&\&\ field\_is\_clear;}
\DoxyCodeLine{00494\ \ \ \}}
\DoxyCodeLine{00495\ }
\DoxyCodeLine{00496\ \ \ \textcolor{keywordflow}{if}\ (pmaybe\_all\_clear\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\ *pmaybe\_all\_clear\ =\ maybe\_all\_clear;\ \}}
\DoxyCodeLine{00497\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00498\ }
\DoxyCodeLine{00499\ restore:}
\DoxyCodeLine{00500\ \ \ \textcolor{comment}{//\ \`{}field`\ is\ the\ index\ of\ the\ field\ that\ failed\ to\ set\ atomically;\ we\ need\ to\ restore\ all\ previous\ fields}}
\DoxyCodeLine{00501\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(field\ >\ start\_field);}
\DoxyCodeLine{00502\ \ \ \textcolor{keywordflow}{while}(\ field\ >\ start\_field)\ \{}
\DoxyCodeLine{00503\ \ \ \ \ field-\/-\/;}
\DoxyCodeLine{00504\ \ \ \ \ \textcolor{keywordflow}{if}\ (field\ ==\ start\_field)\ \{}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \mbox{\hyperlink{bitmap_8c_a3aa02a150aa2df9d5d92fac60d1f39ee}{mi\_bfield\_atomic\_set\_mask}}(\&chunk-\/>bfields[field],\ mask\_start,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00506\ \ \ \ \ \}}
\DoxyCodeLine{00507\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \mbox{\hyperlink{bitmap_8c_acd4bea7cbcae1dd085632ef21d1362a8}{mi\_bfield\_atomic\_setX}}(\&chunk-\/>bfields[field],\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});\ \ \textcolor{comment}{//\ mid-\/field:\ set\ all\ bits\ again}}
\DoxyCodeLine{00509\ \ \ \ \ \}}
\DoxyCodeLine{00510\ \ \ \}}
\DoxyCodeLine{00511\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00512\ \}}
\DoxyCodeLine{00513\ }
\DoxyCodeLine{00514\ }
\DoxyCodeLine{00515\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a034ce9fb6d195e2ed4bf55e92d5d4b20}{mi\_bchunk\_try\_clearN}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}\ cidx,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{bool}*\ maybe\_all\_clear)\ \{}
\DoxyCodeLine{00516\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n>0);}
\DoxyCodeLine{00517\ \ \ \textcolor{comment}{//\ if\ (n==MI\_BFIELD\_BITS)\ return\ mi\_bchunk\_try\_clearX(chunk,\ cidx,\ maybe\_all\_clear);}}
\DoxyCodeLine{00518\ \ \ \textcolor{keywordflow}{if}\ (n<=\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}})\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_ac1f1eaa500cd758892ff36af257c1b0b}{mi\_bchunk\_try\_clearNX}}(chunk,\ cidx,\ n,\ maybe\_all\_clear);}
\DoxyCodeLine{00519\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_ac0ab2ad91f214e09480dfbe321fd3db4}{mi\_bchunk\_try\_clearN\_}}(chunk,\ cidx,\ n,\ maybe\_all\_clear);}
\DoxyCodeLine{00520\ \}}
\DoxyCodeLine{00521\ }
\DoxyCodeLine{00522\ }
\DoxyCodeLine{00523\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/\ mi\_bchunk\_try\_find\_and\_clear\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00524\ }
\DoxyCodeLine{00525\ \textcolor{preprocessor}{\#if\ MI\_OPT\_SIMD\ \&\&\ defined(\_\_AVX2\_\_)}}
\DoxyCodeLine{00526\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa2e7eeec6a3536c3ff2427ba328a16cd}{mi\_decl\_maybe\_unused}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \_\_m256i\ mi\_mm256\_zero(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00527\ \ \ \textcolor{keywordflow}{return}\ \_mm256\_setzero\_si256();}
\DoxyCodeLine{00528\ \}}
\DoxyCodeLine{00529\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa2e7eeec6a3536c3ff2427ba328a16cd}{mi\_decl\_maybe\_unused}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \_\_m256i\ mi\_mm256\_ones(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00530\ \ \ \textcolor{keywordflow}{return}\ \_mm256\_set1\_epi64x(\string~0);}
\DoxyCodeLine{00531\ \}}
\DoxyCodeLine{00532\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa2e7eeec6a3536c3ff2427ba328a16cd}{mi\_decl\_maybe\_unused}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ mi\_mm256\_is\_ones(\_\_m256i\ vec)\ \{}
\DoxyCodeLine{00533\ \ \ \textcolor{keywordflow}{return}\ \_mm256\_testc\_si256(vec,\ \_mm256\_cmpeq\_epi32(vec,\ vec));}
\DoxyCodeLine{00534\ \}}
\DoxyCodeLine{00535\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa2e7eeec6a3536c3ff2427ba328a16cd}{mi\_decl\_maybe\_unused}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ mi\_mm256\_is\_zero(\ \_\_m256i\ vec)\ \{}
\DoxyCodeLine{00536\ \ \ \textcolor{keywordflow}{return}\ \_mm256\_testz\_si256(vec,vec);}
\DoxyCodeLine{00537\ \}}
\DoxyCodeLine{00538\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00539\ }
\DoxyCodeLine{00540\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_ac6424593eb39a2437e8226638ebd8051}{mi\_bchunk\_try\_find\_and\_clear\_at}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}\ chunk\_idx,\ \textcolor{keywordtype}{size\_t}*\ pidx)\ \{}
\DoxyCodeLine{00541\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(chunk\_idx\ <\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}});}
\DoxyCodeLine{00542\ \ \ \textcolor{comment}{//\ note:\ this\ must\ be\ acquire\ (and\ not\ relaxed),\ or\ otherwise\ the\ AVX\ code\ below\ can\ loop\ forever}}
\DoxyCodeLine{00543\ \ \ \textcolor{comment}{//\ as\ the\ compiler\ won't\ reload\ the\ registers\ vec1\ and\ vec2\ from\ memory\ again.}}
\DoxyCodeLine{00544\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_afd6e6e0fbd3a1be232115b5617ca2f65}{mi\_atomic\_load\_acquire}}(\&chunk-\/>bfields[chunk\_idx]);}
\DoxyCodeLine{00545\ \ \ \textcolor{keywordtype}{size\_t}\ idx;}
\DoxyCodeLine{00546\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bitmap_8c_a81530e7b3d5b00380e17776d6bf7def6}{mi\_bfield\_find\_least\_bit}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \&idx))\ \{\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ find\ the\ least\ bit}}
\DoxyCodeLine{00547\ \ \ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a7b29eabf31d4ddb28a16267045384e03}{mi\_likely}}(\mbox{\hyperlink{bitmap_8c_a73c19c3d1d7503123b9c606a25234113}{mi\_bfield\_atomic\_try\_clear\_mask\_of}}(\&chunk-\/>bfields[chunk\_idx],\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(1,idx),\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}))\ \{\ \ \textcolor{comment}{//\ clear\ it\ atomically}}
\DoxyCodeLine{00548\ \ \ \ \ \ \ *pidx\ =\ (chunk\_idx*\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}})\ +\ idx;}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(*pidx\ <\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00551\ \ \ \ \ \}}
\DoxyCodeLine{00552\ \ \ \}}
\DoxyCodeLine{00553\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00554\ \}}
\DoxyCodeLine{00555\ }
\DoxyCodeLine{00556\ \textcolor{comment}{//\ Find\ least\ 1-\/bit\ in\ a\ chunk\ and\ try\ to\ clear\ it\ atomically}}
\DoxyCodeLine{00557\ \textcolor{comment}{//\ set\ \`{}*pidx`\ to\ the\ bit\ index\ (0\ <=\ *pidx\ <\ MI\_BCHUNK\_BITS)\ on\ success.}}
\DoxyCodeLine{00558\ \textcolor{comment}{//\ This\ is\ used\ to\ find\ free\ slices\ and\ abandoned\ pages\ and\ should\ be\ efficient.}}
\DoxyCodeLine{00559\ \textcolor{comment}{//\ todo:\ try\ neon\ version}}
\DoxyCodeLine{00560\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_aa11557a706a7a264cc1f73f1300e17eb}{mi\_bchunk\_try\_find\_and\_clear}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}*\ pidx)\ \{}
\DoxyCodeLine{00561\ \textcolor{preprocessor}{\ \ \#if\ MI\_OPT\_SIMD\ \&\&\ defined(\_\_AVX2\_\_)\ \&\&\ (MI\_BCHUNK\_BITS==256)}}
\DoxyCodeLine{00562\ \ \ \textcolor{keywordflow}{while}\ (\textcolor{keyword}{true})\ \{}
\DoxyCodeLine{00563\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m256i\ vec\ =\ \_mm256\_load\_si256((\textcolor{keyword}{const}\ \_\_m256i*)chunk-\/>bfields);}
\DoxyCodeLine{00564\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m256i\ vcmp\ =\ \_mm256\_cmpeq\_epi64(vec,\ mi\_mm256\_zero());\ \textcolor{comment}{//\ (elem64\ ==\ 0\ ?\ 0xFF\ \ :\ 0)}}
\DoxyCodeLine{00565\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ mask\ =\ \string~\_mm256\_movemask\_epi8(vcmp);\ \ \textcolor{comment}{//\ mask\ of\ most\ significant\ bit\ of\ each\ byte\ (so\ each\ 8\ bits\ are\ all\ set\ or\ clear)}}
\DoxyCodeLine{00566\ \ \ \ \ \textcolor{comment}{//\ mask\ is\ inverted,\ so\ each\ 8-\/bits\ is\ 0xFF\ iff\ the\ corresponding\ elem64\ has\ a\ bit\ set\ (and\ thus\ can\ be\ cleared)}}
\DoxyCodeLine{00567\ \ \ \ \ \textcolor{keywordflow}{if}\ (mask==0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00568\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}((\_tzcnt\_u32(mask)\%8)\ ==\ 0);\ \textcolor{comment}{//\ tzcnt\ ==\ 0,\ 8,\ 16,\ or\ 24}}
\DoxyCodeLine{00569\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunk\_idx\ =\ \_tzcnt\_u32(mask)\ /\ 8;}
\DoxyCodeLine{00570\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bitmap_8c_ac6424593eb39a2437e8226638ebd8051}{mi\_bchunk\_try\_find\_and\_clear\_at}}(chunk,\ chunk\_idx,\ pidx))\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00571\ \ \ \ \ \textcolor{comment}{//\ try\ again}}
\DoxyCodeLine{00572\ \ \ \ \ \textcolor{comment}{//\ note:\ there\ must\ be\ an\ atomic\ release/acquire\ in\ between\ or\ otherwise\ the\ registers\ may\ not\ be\ reloaded}}
\DoxyCodeLine{00573\ \ \ \}}
\DoxyCodeLine{00574\ \textcolor{preprocessor}{\ \ \#elif\ MI\_OPT\_SIMD\ \&\&\ defined(\_\_AVX2\_\_)\ \&\&\ (MI\_BCHUNK\_BITS==512)}}
\DoxyCodeLine{00575\ \ \ \textcolor{keywordflow}{while}\ (\textcolor{keyword}{true})\ \{}
\DoxyCodeLine{00576\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ chunk\_idx\ =\ 0;}
\DoxyCodeLine{00577\ \textcolor{preprocessor}{\ \ \ \ \#if\ 0}}
\DoxyCodeLine{00578\ \ \ \ \ \textcolor{comment}{//\ one\ vector\ at\ a\ time}}
\DoxyCodeLine{00579\ \ \ \ \ \_\_m256i\ vec\ =\ \_mm256\_load\_si256((\textcolor{keyword}{const}\ \_\_m256i*)chunk-\/>bfields);}
\DoxyCodeLine{00580\ \ \ \ \ \textcolor{keywordflow}{if}\ (mi\_mm256\_is\_zero(vec))\ \{}
\DoxyCodeLine{00581\ \ \ \ \ \ \ chunk\_idx\ +=\ 4;}
\DoxyCodeLine{00582\ \ \ \ \ \ \ vec\ =\ \_mm256\_load\_si256(((\textcolor{keyword}{const}\ \_\_m256i*)chunk-\/>bfields)\ +\ 1);}
\DoxyCodeLine{00583\ \ \ \ \ \}}
\DoxyCodeLine{00584\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m256i\ vcmp\ =\ \_mm256\_cmpeq\_epi64(vec,\ mi\_mm256\_zero());\ \textcolor{comment}{//\ (elem64\ ==\ 0\ ?\ 0xFF\ \ :\ 0)}}
\DoxyCodeLine{00585\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ mask\ =\ \string~\_mm256\_movemask\_epi8(vcmp);\ \ \textcolor{comment}{//\ mask\ of\ most\ significant\ bit\ of\ each\ byte\ (so\ each\ 8\ bits\ are\ all\ set\ or\ clear)}}
\DoxyCodeLine{00586\ \ \ \ \ \textcolor{comment}{//\ mask\ is\ inverted,\ so\ each\ 8-\/bits\ is\ 0xFF\ iff\ the\ corresponding\ elem64\ has\ a\ bit\ set\ (and\ thus\ can\ be\ cleared)}}
\DoxyCodeLine{00587\ \ \ \ \ \textcolor{keywordflow}{if}\ (mask==0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00588\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}((\_tzcnt\_u32(mask)\%8)\ ==\ 0);\ \textcolor{comment}{//\ tzcnt\ ==\ 0,\ 8,\ 16,\ or\ 24}}
\DoxyCodeLine{00589\ \ \ \ \ chunk\_idx\ +=\ \_tzcnt\_u32(mask)\ /\ 8;}
\DoxyCodeLine{00590\ \textcolor{preprocessor}{\ \ \ \ \#else}}
\DoxyCodeLine{00591\ \ \ \ \ \textcolor{comment}{//\ a\ cache\ line\ is\ 64b\ so\ we\ can\ just\ as\ well\ load\ all\ at\ the\ same\ time}}
\DoxyCodeLine{00592\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m256i\ vec1\ \ =\ \_mm256\_load\_si256((\textcolor{keyword}{const}\ \_\_m256i*)chunk-\/>bfields);}
\DoxyCodeLine{00593\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m256i\ vec2\ \ =\ \_mm256\_load\_si256(((\textcolor{keyword}{const}\ \_\_m256i*)chunk-\/>bfields)+1);}
\DoxyCodeLine{00594\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m256i\ cmpv\ \ =\ mi\_mm256\_zero();}
\DoxyCodeLine{00595\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m256i\ vcmp1\ =\ \_mm256\_cmpeq\_epi64(vec1,\ cmpv);\ \textcolor{comment}{//\ (elem64\ ==\ 0\ ?\ 0xFF\ \ :\ 0)}}
\DoxyCodeLine{00596\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m256i\ vcmp2\ =\ \_mm256\_cmpeq\_epi64(vec2,\ cmpv);\ \textcolor{comment}{//\ (elem64\ ==\ 0\ ?\ 0xFF\ \ :\ 0)}}
\DoxyCodeLine{00597\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ mask1\ =\ \string~\_mm256\_movemask\_epi8(vcmp1);\ \ \textcolor{comment}{//\ mask\ of\ most\ significant\ bit\ of\ each\ byte\ (so\ each\ 8\ bits\ are\ all\ set\ or\ clear)}}
\DoxyCodeLine{00598\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ mask2\ =\ \string~\_mm256\_movemask\_epi8(vcmp2);\ \ \textcolor{comment}{//\ mask\ of\ most\ significant\ bit\ of\ each\ byte\ (so\ each\ 8\ bits\ are\ all\ set\ or\ clear)}}
\DoxyCodeLine{00599\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ mask\ =\ ((\mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}})mask2\ <<\ 32)\ |\ mask1;}
\DoxyCodeLine{00600\ \ \ \ \ \textcolor{comment}{//\ mask\ is\ inverted,\ so\ each\ 8-\/bits\ is\ 0xFF\ iff\ the\ corresponding\ elem64\ has\ a\ bit\ set\ (and\ thus\ can\ be\ cleared)}}
\DoxyCodeLine{00601\ \ \ \ \ \textcolor{keywordflow}{if}\ (mask==0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00602\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}((\_tzcnt\_u64(mask)\%8)\ ==\ 0);\ \textcolor{comment}{//\ tzcnt\ ==\ 0,\ 8,\ 16,\ 24\ ,\ ..}}
\DoxyCodeLine{00603\ \ \ \ \ chunk\_idx\ =\ \mbox{\hyperlink{bits_8h_a8eb514b948438b609030d3d13c0d1c6d}{mi\_ctz}}(mask)\ /\ 8;}
\DoxyCodeLine{00604\ \textcolor{preprocessor}{\ \ \ \ \#endif}}
\DoxyCodeLine{00605\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bitmap_8c_ac6424593eb39a2437e8226638ebd8051}{mi\_bchunk\_try\_find\_and\_clear\_at}}(chunk,\ chunk\_idx,\ pidx))\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00606\ \ \ \ \ \textcolor{comment}{//\ try\ again}}
\DoxyCodeLine{00607\ \ \ \ \ \textcolor{comment}{//\ note:\ there\ must\ be\ an\ atomic\ release/acquire\ in\ between\ or\ otherwise\ the\ registers\ may\ not\ be\ reloaded}}
\DoxyCodeLine{00608\ \ \ \}}
\DoxyCodeLine{00609\ \textcolor{preprocessor}{\ \ \#elif\ MI\_OPT\_SIMD\ \&\&\ (MI\_BCHUNK\_BITS==512)\ \&\&\ MI\_ARCH\_ARM64}}
\DoxyCodeLine{00610\ \ \ \textcolor{keywordflow}{while}(\textcolor{keyword}{true})\ \{}
\DoxyCodeLine{00611\ \ \ \ \ \textcolor{comment}{//\ a\ cache\ line\ is\ 64b\ so\ we\ can\ just\ as\ well\ load\ all\ at\ the\ same\ time\ (?)}}
\DoxyCodeLine{00612\ \ \ \ \ \textcolor{keyword}{const}\ uint64x2\_t\ vzero1\_lo\ =\ vceqzq\_u64(vld1q\_u64((\mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}*)chunk-\/>bfields));\ \ \ \ \ \ \ \ \textcolor{comment}{//\ 2x64\ bit\ is\_zero}}
\DoxyCodeLine{00613\ \ \ \ \ \textcolor{keyword}{const}\ uint64x2\_t\ vzero1\_hi\ =\ vceqzq\_u64(vld1q\_u64((\mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}*)chunk-\/>bfields\ +\ 2));\ \ \ \ \textcolor{comment}{//\ 2x64\ bit\ is\_zero}}
\DoxyCodeLine{00614\ \ \ \ \ \textcolor{keyword}{const}\ uint64x2\_t\ vzero2\_lo\ =\ vceqzq\_u64(vld1q\_u64((\mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}*)chunk-\/>bfields\ +\ 4));\ \ \ \ \textcolor{comment}{//\ 2x64\ bit\ is\_zero}}
\DoxyCodeLine{00615\ \ \ \ \ \textcolor{keyword}{const}\ uint64x2\_t\ vzero2\_hi\ =\ vceqzq\_u64(vld1q\_u64((\mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}*)chunk-\/>bfields\ +\ 6));\ \ \ \ \textcolor{comment}{//\ 2x64\ bit\ is\_zero}}
\DoxyCodeLine{00616\ \ \ \ \ \textcolor{keyword}{const}\ uint32x4\_t\ vzero1\ \ \ \ =\ vuzp1q\_u32(vreinterpretq\_u32\_u64(vzero1\_lo),vreinterpretq\_u32\_u64(vzero1\_hi));\ \textcolor{comment}{//\ unzip\ even\ elements:\ narrow\ to\ 4x32\ bit\ is\_zero\ ()}}
\DoxyCodeLine{00617\ \ \ \ \ \textcolor{keyword}{const}\ uint32x4\_t\ vzero2\ \ \ \ =\ vuzp1q\_u32(vreinterpretq\_u32\_u64(vzero2\_lo),vreinterpretq\_u32\_u64(vzero2\_hi));\ \textcolor{comment}{//\ unzip\ even\ elements:\ narrow\ to\ 4x32\ bit\ is\_zero\ ()}}
\DoxyCodeLine{00618\ \ \ \ \ \textcolor{keyword}{const}\ uint32x4\_t\ vzero1x\ \ \ =\ vreinterpretq\_u32\_u64(vshrq\_n\_u64(vreinterpretq\_u64\_u32(vzero1),\ 24));\ \ \ \ \ \ \ \ \textcolor{comment}{//\ shift-\/right\ 2x32bit\ elem\ by\ 24:\ lo\ 16\ bits\ contain\ the\ 2\ lo\ bytes}}
\DoxyCodeLine{00619\ \ \ \ \ \textcolor{keyword}{const}\ uint32x4\_t\ vzero2x\ \ \ =\ vreinterpretq\_u32\_u64(vshrq\_n\_u64(vreinterpretq\_u64\_u32(vzero2),\ 24));}
\DoxyCodeLine{00620\ \ \ \ \ \textcolor{keyword}{const}\ uint16x8\_t\ vzero12\ \ \ =\ vreinterpretq\_u16\_u32(vuzp1q\_u32(vzero1x,vzero2x));\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ unzip\ even\ 32-\/bit\ elements\ into\ one\ vector}}
\DoxyCodeLine{00621\ \ \ \ \ \textcolor{keyword}{const}\ uint8x8\_t\ \ vzero\ \ \ \ \ =\ vmovn\_u32(vzero12);\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ narrow\ the\ bottom\ 16-\/bits}}
\DoxyCodeLine{00622\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ mask\ =\ \string~vget\_lane\_u64(vreinterpret\_u64\_u8(vzero),\ 0);\ \ \textcolor{comment}{//\ 1\ byte\ for\ each\ bfield\ (0xFF\ =>\ bfield\ has\ a\ bit\ set)}}
\DoxyCodeLine{00623\ \ \ \ \ \textcolor{keywordflow}{if}\ (mask==0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00624\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}((\mbox{\hyperlink{bits_8h_a8eb514b948438b609030d3d13c0d1c6d}{mi\_ctz}}(mask)\%8)\ ==\ 0);\ \textcolor{comment}{//\ tzcnt\ ==\ 0,\ 8,\ 16,\ 24\ ,\ ..}}
\DoxyCodeLine{00625\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunk\_idx\ =\ \mbox{\hyperlink{bits_8h_a8eb514b948438b609030d3d13c0d1c6d}{mi\_ctz}}(mask)\ /\ 8;}
\DoxyCodeLine{00626\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bitmap_8c_ac6424593eb39a2437e8226638ebd8051}{mi\_bchunk\_try\_find\_and\_clear\_at}}(chunk,\ chunk\_idx,\ pidx))\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00627\ \ \ \ \ \textcolor{comment}{//\ try\ again}}
\DoxyCodeLine{00628\ \ \ \ \ \textcolor{comment}{//\ note:\ there\ must\ be\ an\ atomic\ release/acquire\ in\ between\ or\ otherwise\ the\ registers\ may\ not\ be\ reloaded}}
\DoxyCodeLine{00629\ \ \ \}}
\DoxyCodeLine{00630\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00631\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}};\ i++)\ \{}
\DoxyCodeLine{00632\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bitmap_8c_ac6424593eb39a2437e8226638ebd8051}{mi\_bchunk\_try\_find\_and\_clear\_at}}(chunk,\ i,\ pidx))\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00633\ \ \ \}}
\DoxyCodeLine{00634\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00635\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00636\ \}}
\DoxyCodeLine{00637\ }
\DoxyCodeLine{00638\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_afd07f823dfe1b3c245c75d2f7b859fe3}{mi\_bchunk\_try\_find\_and\_clear\_1}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{size\_t}*\ pidx)\ \{}
\DoxyCodeLine{00639\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n==1);\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(n);}
\DoxyCodeLine{00640\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_aa11557a706a7a264cc1f73f1300e17eb}{mi\_bchunk\_try\_find\_and\_clear}}(chunk,\ pidx);}
\DoxyCodeLine{00641\ \}}
\DoxyCodeLine{00642\ }
\DoxyCodeLine{00643\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa2e7eeec6a3536c3ff2427ba328a16cd}{mi\_decl\_maybe\_unused}}\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_aea6bc0532e861f86ed19c5e7de5757d0}{mi\_bchunk\_try\_find\_and\_clear8\_at}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}\ chunk\_idx,\ \textcolor{keywordtype}{size\_t}*\ pidx)\ \{}
\DoxyCodeLine{00644\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&chunk-\/>bfields[chunk\_idx]);}
\DoxyCodeLine{00645\ \ \ \textcolor{comment}{//\ has\_set8\ has\ low\ bit\ in\ each\ byte\ set\ if\ the\ byte\ in\ x\ ==\ 0xFF}}
\DoxyCodeLine{00646\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ has\_set8\ =}
\DoxyCodeLine{00647\ \ \ \ \ ((\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{\string~b}}\ -\/\ \mbox{\hyperlink{bitmap_8h_a2e1962a52d48112709997c199809d3ca}{MI\_BFIELD\_LO\_BIT8}})\ \&\ \ \ \ \ \ \textcolor{comment}{//\ high\ bit\ set\ if\ byte\ in\ x\ is\ 0xFF\ or\ <\ 0x7F}}
\DoxyCodeLine{00648\ \ \ \ \ \ (\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \ \&\ \mbox{\hyperlink{bitmap_8h_a75c7a609190b768cf359c5269e378c63}{MI\_BFIELD\_HI\_BIT8}}))\ \ \ \ \ \ \ \textcolor{comment}{//\ high\ bit\ set\ if\ byte\ in\ x\ is\ >=\ 0x80}}
\DoxyCodeLine{00649\ \ \ \ \ \ >>\ 7;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ shift\ high\ bit\ to\ low\ bit}}
\DoxyCodeLine{00650\ \ \ \textcolor{keywordtype}{size\_t}\ idx;}
\DoxyCodeLine{00651\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bitmap_8c_a81530e7b3d5b00380e17776d6bf7def6}{mi\_bfield\_find\_least\_bit}}(has\_set8,\ \&idx))\ \{\ \textcolor{comment}{//\ find\ least\ 1-\/bit}}
\DoxyCodeLine{00652\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(idx\ <=\ (\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}}\ -\/\ 8));}
\DoxyCodeLine{00653\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}((idx\%8)==0);}
\DoxyCodeLine{00654\ \ \ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a7b29eabf31d4ddb28a16267045384e03}{mi\_likely}}(\mbox{\hyperlink{bitmap_8c_a73c19c3d1d7503123b9c606a25234113}{mi\_bfield\_atomic\_try\_clear\_mask\_of}}(\&chunk-\/>bfields[chunk\_idx],\ (\mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}})0xFF\ <<\ idx,\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}))\ \{\ \ \textcolor{comment}{//\ unset\ the\ byte\ atomically}}
\DoxyCodeLine{00655\ \ \ \ \ \ \ *pidx\ =\ (chunk\_idx*\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}})\ +\ idx;}
\DoxyCodeLine{00656\ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(*pidx\ +\ 8\ <=\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00657\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00658\ \ \ \ \ \}}
\DoxyCodeLine{00659\ \ \ \}}
\DoxyCodeLine{00660\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00661\ \}}
\DoxyCodeLine{00662\ }
\DoxyCodeLine{00663\ \textcolor{comment}{//\ find\ least\ aligned\ byte\ in\ a\ chunk\ with\ all\ bits\ set,\ and\ try\ unset\ it\ atomically}}
\DoxyCodeLine{00664\ \textcolor{comment}{//\ set\ \`{}*pidx`\ to\ its\ bit\ index\ (0\ <=\ *pidx\ <\ MI\_BCHUNK\_BITS)\ on\ success.}}
\DoxyCodeLine{00665\ \textcolor{comment}{//\ Used\ to\ find\ medium\ size\ pages\ in\ the\ free\ blocks.}}
\DoxyCodeLine{00666\ \textcolor{comment}{//\ todo:\ try\ neon\ version}}
\DoxyCodeLine{00667\ \textcolor{keyword}{static}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a0a63ad6116421ea60eb43806f8881a3b}{mi\_decl\_noinline}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a7e26c5fc311176efcc776514576e56fc}{mi\_bchunk\_try\_find\_and\_clear8}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}*\ pidx)\ \{}
\DoxyCodeLine{00668\ \textcolor{preprocessor}{\ \ \#if\ MI\_OPT\_SIMD\ \&\&\ defined(\_\_AVX2\_\_)\ \&\&\ (MI\_BCHUNK\_BITS==512)}}
\DoxyCodeLine{00669\ \ \ \textcolor{keywordflow}{while}\ (\textcolor{keyword}{true})\ \{}
\DoxyCodeLine{00670\ \ \ \ \ \textcolor{comment}{//\ since\ a\ cache-\/line\ is\ 64b,\ load\ all\ at\ once}}
\DoxyCodeLine{00671\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m256i\ vec1\ =\ \_mm256\_load\_si256((\textcolor{keyword}{const}\ \_\_m256i*)chunk-\/>bfields);}
\DoxyCodeLine{00672\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m256i\ vec2\ =\ \_mm256\_load\_si256((\textcolor{keyword}{const}\ \_\_m256i*)chunk-\/>bfields+1);}
\DoxyCodeLine{00673\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m256i\ cmpv\ =\ mi\_mm256\_ones();}
\DoxyCodeLine{00674\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m256i\ vcmp1\ =\ \_mm256\_cmpeq\_epi8(vec1,\ cmpv);\ \textcolor{comment}{//\ (byte\ ==\ \string~0\ ?\ 0xFF\ :\ 0)}}
\DoxyCodeLine{00675\ \ \ \ \ \textcolor{keyword}{const}\ \_\_m256i\ vcmp2\ =\ \_mm256\_cmpeq\_epi8(vec2,\ cmpv);\ \textcolor{comment}{//\ (byte\ ==\ \string~0\ ?\ 0xFF\ :\ 0)}}
\DoxyCodeLine{00676\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ mask1\ =\ \_mm256\_movemask\_epi8(vcmp1);\ \ \ \ \textcolor{comment}{//\ mask\ of\ most\ significant\ bit\ of\ each\ byte}}
\DoxyCodeLine{00677\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t}}\ mask2\ =\ \_mm256\_movemask\_epi8(vcmp2);\ \ \ \ \textcolor{comment}{//\ mask\ of\ most\ significant\ bit\ of\ each\ byte}}
\DoxyCodeLine{00678\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}\ mask\ =\ ((\mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}})mask2\ <<\ 32)\ |\ mask1;}
\DoxyCodeLine{00679\ \ \ \ \ \textcolor{comment}{//\ mask\ is\ inverted,\ so\ each\ bit\ is\ 0xFF\ iff\ the\ corresponding\ byte\ has\ a\ bit\ set\ (and\ thus\ can\ be\ cleared)}}
\DoxyCodeLine{00680\ \ \ \ \ \textcolor{keywordflow}{if}\ (mask==0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00681\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ bidx\ =\ \_tzcnt\_u64(mask);\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ byte-\/idx\ of\ the\ byte\ in\ the\ chunk}}
\DoxyCodeLine{00682\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunk\_idx\ =\ bidx\ /\ 8;}
\DoxyCodeLine{00683\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx\ =\ (bidx\ \%\ 8)*8;}
\DoxyCodeLine{00684\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(chunk\_idx\ <\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}});}
\DoxyCodeLine{00685\ \ \ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a7b29eabf31d4ddb28a16267045384e03}{mi\_likely}}(\mbox{\hyperlink{bitmap_8c_a18993911f3a35530d8d14df7f25155f8}{mi\_bfield\_atomic\_try\_clear8}}(\&chunk-\/>bfields[chunk\_idx],\ idx,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}))\ \{\ \ \textcolor{comment}{//\ clear\ it\ atomically}}
\DoxyCodeLine{00686\ \ \ \ \ \ \ *pidx\ =\ (chunk\_idx*\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}})\ +\ idx;}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(*pidx\ +\ 8\ <=\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00688\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00689\ \ \ \ \ \}}
\DoxyCodeLine{00690\ \ \ \ \ \textcolor{comment}{//\ try\ again}}
\DoxyCodeLine{00691\ \ \ \ \ \textcolor{comment}{//\ note:\ there\ must\ be\ an\ atomic\ release/acquire\ in\ between\ or\ otherwise\ the\ registers\ may\ not\ be\ reloaded\ \ \}}}
\DoxyCodeLine{00692\ \ \ \}}
\DoxyCodeLine{00693\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00694\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}};\ i++)\ \{}
\DoxyCodeLine{00695\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bitmap_8c_aea6bc0532e861f86ed19c5e7de5757d0}{mi\_bchunk\_try\_find\_and\_clear8\_at}}(chunk,\ i,\ pidx))\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00696\ \ \ \ \ \}}
\DoxyCodeLine{00697\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00698\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00699\ \}}
\DoxyCodeLine{00700\ }
\DoxyCodeLine{00701\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a7b85ce925452dbe5a7821a461e3e8deb}{mi\_bchunk\_try\_find\_and\_clear\_8}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{size\_t}*\ pidx)\ \{}
\DoxyCodeLine{00702\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n==8);\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(n);}
\DoxyCodeLine{00703\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_a7e26c5fc311176efcc776514576e56fc}{mi\_bchunk\_try\_find\_and\_clear8}}(chunk,\ pidx);}
\DoxyCodeLine{00704\ \}}
\DoxyCodeLine{00705\ }
\DoxyCodeLine{00706\ }
\DoxyCodeLine{00707\ \textcolor{comment}{//\ find\ least\ aligned\ bfield\ in\ a\ chunk\ with\ all\ bits\ set,\ and\ try\ unset\ it\ atomically}}
\DoxyCodeLine{00708\ \textcolor{comment}{//\ set\ \`{}*pidx`\ to\ its\ bit\ index\ (0\ <=\ *pidx\ <\ MI\_BCHUNK\_BITS)\ on\ success.}}
\DoxyCodeLine{00709\ \textcolor{comment}{//\ Used\ to\ find\ large\ size\ pages\ in\ the\ free\ blocks.}}
\DoxyCodeLine{00710\ \textcolor{comment}{//\ todo:\ try\ neon\ version}}
\DoxyCodeLine{00711\ \textcolor{comment}{/*}}
\DoxyCodeLine{00712\ \textcolor{comment}{static\ mi\_decl\_noinline\ \ bool\ mi\_bchunk\_try\_find\_and\_clearX(mi\_bchunk\_t*\ chunk,\ size\_t*\ pidx)\ \{}}
\DoxyCodeLine{00713\ \textcolor{comment}{\ \ \#if\ MI\_OPT\_SIMD\ \&\&\ defined(\_\_AVX2\_\_)\ \&\&\ (MI\_BCHUNK\_BITS==512)}}
\DoxyCodeLine{00714\ \textcolor{comment}{\ \ while\ (true)\ \{}}
\DoxyCodeLine{00715\ \textcolor{comment}{\ \ \ \ //\ since\ a\ cache-\/line\ is\ 64b,\ load\ all\ at\ once}}
\DoxyCodeLine{00716\ \textcolor{comment}{\ \ \ \ const\ \_\_m256i\ vec1\ =\ \_mm256\_load\_si256((const\ \_\_m256i*)chunk-\/>bfields);}}
\DoxyCodeLine{00717\ \textcolor{comment}{\ \ \ \ const\ \_\_m256i\ vec2\ =\ \_mm256\_load\_si256((const\ \_\_m256i*)chunk-\/>bfields+1);}}
\DoxyCodeLine{00718\ \textcolor{comment}{\ \ \ \ const\ \_\_m256i\ cmpv\ =\ mi\_mm256\_ones();}}
\DoxyCodeLine{00719\ \textcolor{comment}{\ \ \ \ const\ \_\_m256i\ vcmp1\ =\ \_mm256\_cmpeq\_epi64(vec1,\ cmpv);\ //\ (bfield\ ==\ \string~0\ ?\ -\/1\ :\ 0)}}
\DoxyCodeLine{00720\ \textcolor{comment}{\ \ \ \ const\ \_\_m256i\ vcmp2\ =\ \_mm256\_cmpeq\_epi64(vec2,\ cmpv);\ //\ (bfield\ ==\ \string~0\ ?\ -\/1\ :\ 0)}}
\DoxyCodeLine{00721\ \textcolor{comment}{\ \ \ \ const\ uint32\_t\ mask1\ =\ \_mm256\_movemask\_epi8(vcmp1);\ \ \ \ //\ mask\ of\ most\ significant\ bit\ of\ each\ byte}}
\DoxyCodeLine{00722\ \textcolor{comment}{\ \ \ \ const\ uint32\_t\ mask2\ =\ \_mm256\_movemask\_epi8(vcmp2);\ \ \ \ //\ mask\ of\ most\ significant\ bit\ of\ each\ byte}}
\DoxyCodeLine{00723\ \textcolor{comment}{\ \ \ \ const\ uint64\_t\ mask\ =\ ((uint64\_t)mask2\ <<\ 32)\ |\ mask1;}}
\DoxyCodeLine{00724\ \textcolor{comment}{\ \ \ \ //\ mask\ is\ inverted,\ so\ each\ 8-\/bits\ are\ set\ iff\ the\ corresponding\ elem64\ has\ all\ bits\ set\ (and\ thus\ can\ be\ cleared)}}
\DoxyCodeLine{00725\ \textcolor{comment}{\ \ \ \ if\ (mask==0)\ return\ false;}}
\DoxyCodeLine{00726\ \textcolor{comment}{\ \ \ \ mi\_assert\_internal((\_tzcnt\_u64(mask)\%8)\ ==\ 0);\ //\ tzcnt\ ==\ 0,\ 8,\ 16,\ 24\ ,\ ..}}
\DoxyCodeLine{00727\ \textcolor{comment}{\ \ \ \ const\ size\_t\ chunk\_idx\ =\ \_tzcnt\_u64(mask)\ /\ 8;}}
\DoxyCodeLine{00728\ \textcolor{comment}{\ \ \ \ mi\_assert\_internal(chunk\_idx\ <\ MI\_BCHUNK\_FIELDS);}}
\DoxyCodeLine{00729\ \textcolor{comment}{\ \ \ \ if\ mi\_likely(mi\_bfield\_atomic\_try\_clearX(\&chunk-\/>bfields[chunk\_idx],NULL))\ \{}}
\DoxyCodeLine{00730\ \textcolor{comment}{\ \ \ \ \ \ *pidx\ =\ chunk\_idx*MI\_BFIELD\_BITS;}}
\DoxyCodeLine{00731\ \textcolor{comment}{\ \ \ \ \ \ mi\_assert\_internal(*pidx\ +\ MI\_BFIELD\_BITS\ <=\ MI\_BCHUNK\_BITS);}}
\DoxyCodeLine{00732\ \textcolor{comment}{\ \ \ \ \ \ return\ true;}}
\DoxyCodeLine{00733\ \textcolor{comment}{\ \ \ \ \}}}
\DoxyCodeLine{00734\ \textcolor{comment}{\ \ \ \ //\ try\ again}}
\DoxyCodeLine{00735\ \textcolor{comment}{\ \ \ \ //\ note:\ there\ must\ be\ an\ atomic\ release/acquire\ in\ between\ or\ otherwise\ the\ registers\ may\ not\ be\ reloaded}}
\DoxyCodeLine{00736\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{00737\ \textcolor{comment}{\#else}}
\DoxyCodeLine{00738\ \textcolor{comment}{\ \ for\ (int\ i\ =\ 0;\ i\ <\ MI\_BCHUNK\_FIELDS;\ i++)\ \{}}
\DoxyCodeLine{00739\ \textcolor{comment}{\ \ \ \ const\ mi\_bfield\_t\ b\ =\ mi\_atomic\_load\_relaxed(\&chunk-\/>bfields[i]);}}
\DoxyCodeLine{00740\ \textcolor{comment}{\ \ \ \ if\ (\string~b==0\ \&\&\ mi\_bfield\_atomic\_try\_clearX(\&chunk-\/>bfields[i],\ NULL))\ \{}}
\DoxyCodeLine{00741\ \textcolor{comment}{\ \ \ \ \ \ *pidx\ =\ i*MI\_BFIELD\_BITS;}}
\DoxyCodeLine{00742\ \textcolor{comment}{\ \ \ \ \ \ mi\_assert\_internal(*pidx\ +\ MI\_BFIELD\_BITS\ <=\ MI\_BCHUNK\_BITS);}}
\DoxyCodeLine{00743\ \textcolor{comment}{\ \ \ \ \ \ return\ true;}}
\DoxyCodeLine{00744\ \textcolor{comment}{\ \ \ \ \}}}
\DoxyCodeLine{00745\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{00746\ \textcolor{comment}{\ \ return\ false;}}
\DoxyCodeLine{00747\ \textcolor{comment}{\#endif}}
\DoxyCodeLine{00748\ \textcolor{comment}{\}}}
\DoxyCodeLine{00749\ \textcolor{comment}{}}
\DoxyCodeLine{00750\ \textcolor{comment}{static\ inline\ bool\ mi\_bchunk\_try\_find\_and\_clear\_X(mi\_bchunk\_t*\ chunk,\ size\_t\ n,\ size\_t*\ pidx)\ \{}}
\DoxyCodeLine{00751\ \textcolor{comment}{\ \ mi\_assert\_internal(n==MI\_BFIELD\_BITS);\ MI\_UNUSED(n);}}
\DoxyCodeLine{00752\ \textcolor{comment}{\ \ return\ mi\_bchunk\_try\_find\_and\_clearX(chunk,\ pidx);}}
\DoxyCodeLine{00753\ \textcolor{comment}{\}}}
\DoxyCodeLine{00754\ \textcolor{comment}{*/}}
\DoxyCodeLine{00755\ }
\DoxyCodeLine{00756\ \textcolor{comment}{//\ find\ a\ sequence\ of\ \`{}n`\ bits\ in\ a\ chunk\ with\ \`{}0\ <\ n\ <=\ MI\_BFIELD\_BITS`\ with\ all\ bits\ set,}}
\DoxyCodeLine{00757\ \textcolor{comment}{//\ and\ try\ to\ clear\ them\ atomically.}}
\DoxyCodeLine{00758\ \textcolor{comment}{//\ set\ \`{}*pidx`\ to\ its\ bit\ index\ (0\ <=\ *pidx\ <=\ MI\_BCHUNK\_BITS\ -\/\ n)\ on\ success.}}
\DoxyCodeLine{00759\ \textcolor{comment}{//\ will\ cross\ bfield\ boundaries.}}
\DoxyCodeLine{00760\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a0a63ad6116421ea60eb43806f8881a3b}{mi\_decl\_noinline}}\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a42150c51b3d6ffaeacbb26995bf8dbd7}{mi\_bchunk\_try\_find\_and\_clearNX}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{size\_t}*\ pidx)\ \{}
\DoxyCodeLine{00761\ \ \ \textcolor{keywordflow}{if}\ (n\ ==\ 0\ ||\ n\ >\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}})\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00762\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ mask\ =\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(n,\ 0);}
\DoxyCodeLine{00763\ \ \ \textcolor{comment}{//\ for\ all\ fields\ in\ the\ chunk}}
\DoxyCodeLine{00764\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}};\ i++)\ \{}
\DoxyCodeLine{00765\ \ \ \ \ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ b0\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&chunk-\/>bfields[i]);}
\DoxyCodeLine{00766\ \ \ \ \ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ =\ b0;}
\DoxyCodeLine{00767\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ idx;}
\DoxyCodeLine{00768\ }
\DoxyCodeLine{00769\ \ \ \ \ \textcolor{comment}{//\ is\ there\ a\ range\ inside\ the\ field?}}
\DoxyCodeLine{00770\ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{bitmap_8c_a81530e7b3d5b00380e17776d6bf7def6}{mi\_bfield\_find\_least\_bit}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \&idx))\ \{\ \textcolor{comment}{//\ find\ least\ 1-\/bit}}
\DoxyCodeLine{00771\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (idx\ +\ n\ >\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}})\ \textcolor{keywordflow}{break};\ \textcolor{comment}{//\ too\ short:\ maybe\ cross\ over,\ or\ continue\ with\ the\ next\ field}}
\DoxyCodeLine{00772\ }
\DoxyCodeLine{00773\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ bmask\ =\ mask<<idx;}
\DoxyCodeLine{00774\ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(bmask>>idx\ ==\ mask);}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\&bmask)\ ==\ bmask)\ \{\ \textcolor{comment}{//\ found\ a\ match\ with\ all\ bits\ set,\ try\ clearing\ atomically}}
\DoxyCodeLine{00776\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a7b29eabf31d4ddb28a16267045384e03}{mi\_likely}}(\mbox{\hyperlink{bitmap_8c_a73c19c3d1d7503123b9c606a25234113}{mi\_bfield\_atomic\_try\_clear\_mask\_of}}(\&chunk-\/>bfields[i],\ bmask,\ b0,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}))\ \{}
\DoxyCodeLine{00777\ \ \ \ \ \ \ \ \ \ \ *pidx\ =\ (i*\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}})\ +\ idx;}
\DoxyCodeLine{00778\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(*pidx\ <\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00779\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(*pidx\ +\ n\ <=\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00780\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00781\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00782\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00783\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ we\ failed\ to\ atomically\ commit,\ reload\ b\ and\ try\ again\ from\ the\ start}}
\DoxyCodeLine{00784\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ =\ b0\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_afd6e6e0fbd3a1be232115b5617ca2f65}{mi\_atomic\_load\_acquire}}(\&chunk-\/>bfields[i]);}
\DoxyCodeLine{00785\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00786\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00787\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00788\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ advance\ by\ clearing\ the\ least\ run\ of\ ones,\ for\ example,\ with\ n>=4,\ idx=2:}}
\DoxyCodeLine{00789\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ b\ \ \ \ \ \ \ \ \ \ \ \ \ =\ 1111\ 1101\ 1010\ 1100}}
\DoxyCodeLine{00790\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ..\ +\ (1<<idx)\ =\ 1111\ 1101\ 1011\ 0000}}
\DoxyCodeLine{00791\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ..\ \&\ b\ \ \ \ \ \ \ \ =\ 1111\ 1101\ 1010\ 0000}}
\DoxyCodeLine{00792\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ =\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \&\ (\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ +\ (\mbox{\hyperlink{bitmap_8c_a8e898496b41e387ca00e77eff2cc364d}{mi\_bfield\_one}}()\ <<\ idx));}
\DoxyCodeLine{00793\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00794\ \ \ \ \ \}}
\DoxyCodeLine{00795\ }
\DoxyCodeLine{00796\ \ \ \ \ \textcolor{comment}{//\ check\ if\ we\ can\ cross\ into\ the\ next\ bfield}}
\DoxyCodeLine{00797\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}!=0\ \&\&\ i\ <\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}}-\/1)\ \{}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ post\ =\ \mbox{\hyperlink{bitmap_8c_a3a2008cf0050b5dd55ec336f8d72988f}{mi\_bfield\_clz}}(\string~\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}});}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (post\ >\ 0)\ \{}
\DoxyCodeLine{00800\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ pre\ =\ \mbox{\hyperlink{bitmap_8c_a5fb9332916a3ebbc622036d3979f035d}{mi\_bfield\_ctz}}(\string~\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&chunk-\/>bfields[i+1]));}
\DoxyCodeLine{00801\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (post\ +\ pre\ >=\ n)\ \{}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ it\ fits\ -\/-\/\ try\ to\ claim\ it\ atomically}}
\DoxyCodeLine{00803\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ cidx\ =\ (i*\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}})\ +\ (\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}}\ -\/\ post);}
\DoxyCodeLine{00804\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bitmap_8c_ac1f1eaa500cd758892ff36af257c1b0b}{mi\_bchunk\_try\_clearNX}}(chunk,\ cidx,\ n,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}))\ \{}
\DoxyCodeLine{00805\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ we\ cleared\ all\ atomically}}
\DoxyCodeLine{00806\ \ \ \ \ \ \ \ \ \ \ \ \ *pidx\ =\ cidx;}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(*pidx\ <\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00808\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(*pidx\ +\ n\ <=\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00809\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00810\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00811\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00812\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00813\ \ \ \ \ \}}
\DoxyCodeLine{00814\ \ \ \}}
\DoxyCodeLine{00815\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00816\ \}}
\DoxyCodeLine{00817\ }
\DoxyCodeLine{00818\ \textcolor{comment}{//\ find\ a\ sequence\ of\ \`{}n`\ bits\ in\ a\ chunk\ with\ \`{}n\ <\ MI\_BCHUNK\_BITS`\ with\ all\ bits\ set,}}
\DoxyCodeLine{00819\ \textcolor{comment}{//\ and\ try\ to\ clear\ them\ atomically.}}
\DoxyCodeLine{00820\ \textcolor{comment}{//\ set\ \`{}*pidx`\ to\ its\ bit\ index\ (0\ <=\ *pidx\ <=\ MI\_BCHUNK\_BITS\ -\/\ n)\ on\ success.}}
\DoxyCodeLine{00821\ \textcolor{comment}{//\ This\ can\ cross\ bfield\ boundaries.}}
\DoxyCodeLine{00822\ \textcolor{keyword}{static}\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a0a63ad6116421ea60eb43806f8881a3b}{mi\_decl\_noinline}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_aaf7fe9fdfa57a3dc4b6de1b16c76d065}{mi\_bchunk\_try\_find\_and\_clearN\_}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{size\_t}*\ pidx)\ \{}
\DoxyCodeLine{00823\ \ \ \textcolor{keywordflow}{if}\ (n\ ==\ 0\ ||\ n\ >\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}})\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \ \textcolor{comment}{//\ cannot\ be\ more\ than\ a\ chunk}}
\DoxyCodeLine{00824\ }
\DoxyCodeLine{00825\ \ \ \textcolor{comment}{//\ we\ first\ scan\ ahead\ to\ see\ if\ there\ is\ a\ range\ of\ \`{}n`\ set\ bits,\ and\ only\ then\ try\ to\ clear\ atomically}}
\DoxyCodeLine{00826\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n>0);}
\DoxyCodeLine{00827\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ skip\_count\ =\ (n-\/1)/\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}};}
\DoxyCodeLine{00828\ \ \ \textcolor{keywordtype}{size\_t}\ cidx;}
\DoxyCodeLine{00829\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}}\ -\/\ skip\_count;\ i++)}
\DoxyCodeLine{00830\ \ \ \{}
\DoxyCodeLine{00831\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ m\ =\ n;\ \ \ \textcolor{comment}{//\ bits\ to\ go}}
\DoxyCodeLine{00832\ }
\DoxyCodeLine{00833\ \ \ \ \ \textcolor{comment}{//\ first\ field}}
\DoxyCodeLine{00834\ \ \ \ \ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&chunk-\/>bfields[i]);}
\DoxyCodeLine{00835\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ ones\ =\ \mbox{\hyperlink{bitmap_8c_a3a2008cf0050b5dd55ec336f8d72988f}{mi\_bfield\_clz}}(\string~\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}});}
\DoxyCodeLine{00836\ \ \ \ \ cidx\ =\ (i*\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}})\ +\ (\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}}\ -\/\ ones);\ \ \textcolor{comment}{//\ start\ index}}
\DoxyCodeLine{00837\ \ \ \ \ \textcolor{keywordflow}{if}\ (ones\ >=\ m)\ \{}
\DoxyCodeLine{00838\ \ \ \ \ \ \ \textcolor{comment}{//\ we\ found\ enough\ bits!}}
\DoxyCodeLine{00839\ \ \ \ \ \ \ m\ =\ 0;}
\DoxyCodeLine{00840\ \ \ \ \ \}}
\DoxyCodeLine{00841\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00842\ \ \ \ \ \ \ m\ -\/=\ ones;}
\DoxyCodeLine{00843\ }
\DoxyCodeLine{00844\ \ \ \ \ \ \ \textcolor{comment}{//\ keep\ scanning\ further\ fields?}}
\DoxyCodeLine{00845\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ j\ =\ 1;\ \ \ \textcolor{comment}{//\ field\ count\ from\ i}}
\DoxyCodeLine{00846\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (i+j\ <\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}})\ \{}
\DoxyCodeLine{00847\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(m\ >\ 0);}
\DoxyCodeLine{00848\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&chunk-\/>bfields[i+j]);}
\DoxyCodeLine{00849\ \ \ \ \ \ \ \ \ ones\ =\ \mbox{\hyperlink{bitmap_8c_a5fb9332916a3ebbc622036d3979f035d}{mi\_bfield\_ctz}}(\string~\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}});}
\DoxyCodeLine{00850\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ones\ >=\ m)\ \{}
\DoxyCodeLine{00851\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ we\ found\ enough\ bits}}
\DoxyCodeLine{00852\ \ \ \ \ \ \ \ \ \ \ m\ =\ 0;}
\DoxyCodeLine{00853\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00854\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00855\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (ones\ ==\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}})\ \{}
\DoxyCodeLine{00856\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ not\ enough\ yet,\ proceed\ to\ the\ next\ field}}
\DoxyCodeLine{00857\ \ \ \ \ \ \ \ \ \ \ j++;}
\DoxyCodeLine{00858\ \ \ \ \ \ \ \ \ \ \ m\ -\/=\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}};}
\DoxyCodeLine{00859\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00860\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00861\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ range\ was\ not\ enough,\ start\ from\ scratch}}
\DoxyCodeLine{00862\ \ \ \ \ \ \ \ \ \ \ i\ =\ i\ +\ j\ -\/\ 1;\ \ \textcolor{comment}{//\ no\ need\ to\ re-\/scan\ previous\ fields,\ except\ the\ last\ one\ (with\ clz\ this\ time)}}
\DoxyCodeLine{00863\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(m>0);}
\DoxyCodeLine{00864\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00865\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00866\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00867\ \ \ \ \ \}}
\DoxyCodeLine{00868\ }
\DoxyCodeLine{00869\ \ \ \ \ \textcolor{comment}{//\ did\ we\ find\ a\ range?}}
\DoxyCodeLine{00870\ \ \ \ \ \textcolor{keywordflow}{if}\ (m==0)\ \{}
\DoxyCodeLine{00871\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bitmap_8c_a034ce9fb6d195e2ed4bf55e92d5d4b20}{mi\_bchunk\_try\_clearN}}(chunk,\ cidx,\ n,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}}))\ \{}
\DoxyCodeLine{00872\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ we\ cleared\ all\ atomically}}
\DoxyCodeLine{00873\ \ \ \ \ \ \ \ \ *pidx\ =\ cidx;}
\DoxyCodeLine{00874\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(*pidx\ <\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00875\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(*pidx\ +\ n\ <=\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00876\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00877\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00878\ \ \ \ \ \ \ \textcolor{comment}{//\ note:\ if\ we\ fail\ for\ a\ small\ \`{}n`\ on\ the\ first\ field,\ we\ don't\ rescan\ that\ field\ (as\ \`{}i`\ is\ incremented)}}
\DoxyCodeLine{00879\ \ \ \ \ \}}
\DoxyCodeLine{00880\ \ \ \ \ \textcolor{comment}{//\ otherwise\ continue\ searching}}
\DoxyCodeLine{00881\ \ \ \}}
\DoxyCodeLine{00882\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00883\ \}}
\DoxyCodeLine{00884\ }
\DoxyCodeLine{00885\ }
\DoxyCodeLine{00886\ }
\DoxyCodeLine{00887\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/\ mi\_bchunk\_clear\_once\_set\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00888\ }
\DoxyCodeLine{00889\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bitmap_8c_a585940fb5c029aa8d9e10216f29a7888}{mi\_bchunk\_clear\_once\_set}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}\ cidx)\ \{}
\DoxyCodeLine{00890\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(cidx\ <\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00891\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ i\ =\ cidx\ /\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}};}
\DoxyCodeLine{00892\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx\ =\ cidx\ \%\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}};}
\DoxyCodeLine{00893\ \ \ \mbox{\hyperlink{bitmap_8c_ad0e2ee366d0b3430130b667af1e6dfa1}{mi\_bfield\_atomic\_clear\_once\_set}}(\&chunk-\/>bfields[i],\ idx);}
\DoxyCodeLine{00894\ \}}
\DoxyCodeLine{00895\ }
\DoxyCodeLine{00896\ }
\DoxyCodeLine{00897\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/\ mi\_bitmap\_all\_are\_clear\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00898\ }
\DoxyCodeLine{00899\ }
\DoxyCodeLine{00900\ \textcolor{comment}{//\ are\ all\ bits\ in\ a\ bitmap\ chunk\ clear?}}
\DoxyCodeLine{00901\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a88902555fe05fa9a9b3d747b230f45b2}{mi\_bchunk\_all\_are\_clear\_relaxed}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk)\ \{}
\DoxyCodeLine{00902\ \textcolor{preprocessor}{\ \ \#if\ MI\_OPT\_SIMD\ \&\&\ defined(\_\_AVX2\_\_)\ \&\&\ (MI\_BCHUNK\_BITS==256)}}
\DoxyCodeLine{00903\ \ \ \textcolor{keyword}{const}\ \_\_m256i\ vec\ =\ \_mm256\_load\_si256((\textcolor{keyword}{const}\ \_\_m256i*)chunk-\/>bfields);}
\DoxyCodeLine{00904\ \ \ \textcolor{keywordflow}{return}\ mi\_mm256\_is\_zero(vec);}
\DoxyCodeLine{00905\ \textcolor{preprocessor}{\ \ \#elif\ MI\_OPT\_SIMD\ \&\&\ \ defined(\_\_AVX2\_\_)\ \&\&\ (MI\_BCHUNK\_BITS==512)}}
\DoxyCodeLine{00906\ \ \ \textcolor{comment}{//\ a\ 64b\ cache-\/line\ contains\ the\ entire\ chunk\ anyway\ so\ load\ both\ at\ once}}
\DoxyCodeLine{00907\ \ \ \textcolor{keyword}{const}\ \_\_m256i\ vec1\ =\ \_mm256\_load\_si256((\textcolor{keyword}{const}\ \_\_m256i*)chunk-\/>bfields);}
\DoxyCodeLine{00908\ \ \ \textcolor{keyword}{const}\ \_\_m256i\ vec2\ =\ \_mm256\_load\_si256(((\textcolor{keyword}{const}\ \_\_m256i*)chunk-\/>bfields)+1);}
\DoxyCodeLine{00909\ \ \ \textcolor{keywordflow}{return}\ (mi\_mm256\_is\_zero(\_mm256\_or\_si256(vec1,vec2)));}
\DoxyCodeLine{00910\ \textcolor{preprocessor}{\ \ \#elif\ MI\_OPT\_SIMD\ \&\&\ (MI\_BCHUNK\_BITS==512)\ \&\&\ MI\_ARCH\_ARM64}}
\DoxyCodeLine{00911\ \ \ \textcolor{keyword}{const}\ uint64x2\_t\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a8f5597b6002609ead33af221dcf29790}{v0}}\ =\ vld1q\_u64((\mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}*)chunk-\/>bfields);}
\DoxyCodeLine{00912\ \ \ \textcolor{keyword}{const}\ uint64x2\_t\ v1\ =\ vld1q\_u64((\mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}*)chunk-\/>bfields\ +\ 2);}
\DoxyCodeLine{00913\ \ \ \textcolor{keyword}{const}\ uint64x2\_t\ v2\ =\ vld1q\_u64((\mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}*)chunk-\/>bfields\ +\ 4);}
\DoxyCodeLine{00914\ \ \ \textcolor{keyword}{const}\ uint64x2\_t\ v3\ =\ vld1q\_u64((\mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}*)chunk-\/>bfields\ +\ 6);}
\DoxyCodeLine{00915\ \ \ \textcolor{keyword}{const}\ uint64x2\_t\ v\ \ =\ vorrq\_u64(vorrq\_u64(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a8f5597b6002609ead33af221dcf29790}{v0}},v1),vorrq\_u64(v2,v3));}
\DoxyCodeLine{00916\ \ \ \textcolor{keywordflow}{return}\ (vmaxvq\_u32(vreinterpretq\_u32\_u64(v))\ ==\ 0);}
\DoxyCodeLine{00917\ \textcolor{preprocessor}{\ \ \#else}}
\DoxyCodeLine{00918\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}};\ i++)\ \{}
\DoxyCodeLine{00919\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&chunk-\/>bfields[i])\ !=\ 0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00920\ \ \ \}}
\DoxyCodeLine{00921\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00922\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00923\ \}}
\DoxyCodeLine{00924\ }
\DoxyCodeLine{00925\ \textcolor{comment}{//\ are\ all\ bits\ in\ a\ bitmap\ chunk\ set?}}
\DoxyCodeLine{00926\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a7879ec0a2a72c95ff4d0037eb61580d6}{mi\_bchunk\_all\_are\_set\_relaxed}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk)\ \{}
\DoxyCodeLine{00927\ \textcolor{preprocessor}{\#if\ MI\_OPT\_SIMD\ \&\&\ defined(\_\_AVX2\_\_)\ \&\&\ (MI\_BCHUNK\_BITS==256)}}
\DoxyCodeLine{00928\ \ \ \textcolor{keyword}{const}\ \_\_m256i\ vec\ =\ \_mm256\_load\_si256((\textcolor{keyword}{const}\ \_\_m256i*)chunk-\/>bfields);}
\DoxyCodeLine{00929\ \ \ \textcolor{keywordflow}{return}\ mi\_mm256\_is\_ones(vec);}
\DoxyCodeLine{00930\ \textcolor{preprocessor}{\#elif\ MI\_OPT\_SIMD\ \&\&\ \ defined(\_\_AVX2\_\_)\ \&\&\ (MI\_BCHUNK\_BITS==512)}}
\DoxyCodeLine{00931\ \ \ \textcolor{comment}{//\ a\ 64b\ cache-\/line\ contains\ the\ entire\ chunk\ anyway\ so\ load\ both\ at\ once}}
\DoxyCodeLine{00932\ \ \ \textcolor{keyword}{const}\ \_\_m256i\ vec1\ =\ \_mm256\_load\_si256((\textcolor{keyword}{const}\ \_\_m256i*)chunk-\/>bfields);}
\DoxyCodeLine{00933\ \ \ \textcolor{keyword}{const}\ \_\_m256i\ vec2\ =\ \_mm256\_load\_si256(((\textcolor{keyword}{const}\ \_\_m256i*)chunk-\/>bfields)+1);}
\DoxyCodeLine{00934\ \ \ \textcolor{keywordflow}{return}\ (mi\_mm256\_is\_ones(\_mm256\_and\_si256(vec1,\ vec2)));}
\DoxyCodeLine{00935\ \textcolor{preprocessor}{\#elif\ MI\_OPT\_SIMD\ \&\&\ (MI\_BCHUNK\_BITS==512)\ \&\&\ MI\_ARCH\_ARM64}}
\DoxyCodeLine{00936\ \ \ \textcolor{keyword}{const}\ uint64x2\_t\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a8f5597b6002609ead33af221dcf29790}{v0}}\ =\ vld1q\_u64((\mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}*)chunk-\/>bfields);}
\DoxyCodeLine{00937\ \ \ \textcolor{keyword}{const}\ uint64x2\_t\ v1\ =\ vld1q\_u64((\mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}*)chunk-\/>bfields\ +\ 2);}
\DoxyCodeLine{00938\ \ \ \textcolor{keyword}{const}\ uint64x2\_t\ v2\ =\ vld1q\_u64((\mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}*)chunk-\/>bfields\ +\ 4);}
\DoxyCodeLine{00939\ \ \ \textcolor{keyword}{const}\ uint64x2\_t\ v3\ =\ vld1q\_u64((\mbox{\hyperlink{eabase_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\_t}}*)chunk-\/>bfields\ +\ 6);}
\DoxyCodeLine{00940\ \ \ \textcolor{keyword}{const}\ uint64x2\_t\ v\ \ =\ vandq\_u64(vandq\_u64(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a8f5597b6002609ead33af221dcf29790}{v0}},v1),vandq\_u64(v2,v3));}
\DoxyCodeLine{00941\ \ \ \textcolor{keywordflow}{return}\ (vminvq\_u32(vreinterpretq\_u32\_u64(v))\ ==\ 0xFFFFFFFFUL);}
\DoxyCodeLine{00942\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00943\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}};\ i++)\ \{}
\DoxyCodeLine{00944\ \ \ \ \ \textcolor{keywordflow}{if}\ (\string~\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&chunk-\/>bfields[i])\ !=\ 0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00945\ \ \ \}}
\DoxyCodeLine{00946\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00947\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00948\ \}}
\DoxyCodeLine{00949\ }
\DoxyCodeLine{00950\ }
\DoxyCodeLine{00951\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a642c642fcc877806a6dce9e8878f3004}{mi\_bchunk\_bsr}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}*\ pidx)\ \{}
\DoxyCodeLine{00952\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}};\ i\ >\ 0;\ )\ \{}
\DoxyCodeLine{00953\ \ \ \ \ i-\/-\/;}
\DoxyCodeLine{00954\ \ \ \ \ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&chunk-\/>bfields[i]);}
\DoxyCodeLine{00955\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ idx;}
\DoxyCodeLine{00956\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bits_8h_ae1a375404b8024ab419cfc537db20741}{mi\_bsr}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \&idx))\ \{}
\DoxyCodeLine{00957\ \ \ \ \ \ \ *pidx\ =\ (i*\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}})\ +\ idx;}
\DoxyCodeLine{00958\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00959\ \ \ \ \ \}}
\DoxyCodeLine{00960\ \ \ \}}
\DoxyCodeLine{00961\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00962\ \}}
\DoxyCodeLine{00963\ }
\DoxyCodeLine{00964\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00965\ \textcolor{comment}{\ bitmap\ chunkmap}}
\DoxyCodeLine{00966\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{00967\ }
\DoxyCodeLine{00968\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bitmap_8c_ae28d6cc04a3cf604bc16fd933973412a}{mi\_bitmap\_chunkmap\_set}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ chunk\_idx)\ \{}
\DoxyCodeLine{00969\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_af04c7a87bc1c69ef3e763a580f47a418}{mi\_assert}}(chunk\_idx\ <\ \mbox{\hyperlink{bitmap_8h_adbc04bcdad6dd6f18993c5ed4b92f2a4}{mi\_bitmap\_chunk\_count}}(bitmap));}
\DoxyCodeLine{00970\ \ \ \mbox{\hyperlink{bitmap_8c_ab346ba3b2da689a30e5cc0bf7348e552}{mi\_bchunk\_set}}(\&bitmap-\/>chunkmap,\ chunk\_idx,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00971\ \}}
\DoxyCodeLine{00972\ }
\DoxyCodeLine{00973\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a5bb0c3e1e081c87726fb5e091123673e}{mi\_bitmap\_chunkmap\_try\_clear}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ chunk\_idx)\ \{}
\DoxyCodeLine{00974\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_af04c7a87bc1c69ef3e763a580f47a418}{mi\_assert}}(chunk\_idx\ <\ \mbox{\hyperlink{bitmap_8h_adbc04bcdad6dd6f18993c5ed4b92f2a4}{mi\_bitmap\_chunk\_count}}(bitmap));}
\DoxyCodeLine{00975\ \ \ \textcolor{comment}{//\ check\ if\ the\ corresponding\ chunk\ is\ all\ clear}}
\DoxyCodeLine{00976\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{bitmap_8c_a88902555fe05fa9a9b3d747b230f45b2}{mi\_bchunk\_all\_are\_clear\_relaxed}}(\&bitmap-\/>chunks[chunk\_idx]))\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00977\ \ \ \textcolor{comment}{//\ clear\ the\ chunkmap\ bit}}
\DoxyCodeLine{00978\ \ \ \mbox{\hyperlink{bitmap_8c_a9dfbfc8fe0b5d49b9cb05fb4a16ce60c}{mi\_bchunk\_clear}}(\&bitmap-\/>chunkmap,\ chunk\_idx,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00979\ \ \ \textcolor{comment}{//\ ..\ but\ a\ concurrent\ set\ may\ have\ happened\ in\ between\ our\ all-\/clear\ test\ and\ the\ clearing\ of\ the}}
\DoxyCodeLine{00980\ \ \ \textcolor{comment}{//\ bit\ in\ the\ mask.\ We\ check\ again\ to\ catch\ this\ situation.}}
\DoxyCodeLine{00981\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{bitmap_8c_a88902555fe05fa9a9b3d747b230f45b2}{mi\_bchunk\_all\_are\_clear\_relaxed}}(\&bitmap-\/>chunks[chunk\_idx]))\ \{}
\DoxyCodeLine{00982\ \ \ \ \ \mbox{\hyperlink{bitmap_8c_ab346ba3b2da689a30e5cc0bf7348e552}{mi\_bchunk\_set}}(\&bitmap-\/>chunkmap,\ chunk\_idx,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{00983\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00984\ \ \ \}}
\DoxyCodeLine{00985\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00986\ \}}
\DoxyCodeLine{00987\ }
\DoxyCodeLine{00988\ }
\DoxyCodeLine{00989\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00990\ \textcolor{comment}{\ \ bitmap}}
\DoxyCodeLine{00991\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{00992\ }
\DoxyCodeLine{00993\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{bitmap_8c_ae5c77a2da37b33891902c131fbe5fac2}{mi\_bitmap\_size}}(\textcolor{keywordtype}{size\_t}\ bit\_count,\ \textcolor{keywordtype}{size\_t}*\ pchunk\_count)\ \{}
\DoxyCodeLine{00994\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}((bit\_count\ \%\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}})\ ==\ 0);}
\DoxyCodeLine{00995\ \ \ bit\_count\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a7f35944d44d8a16365072023dd19e0da}{\_mi\_align\_up}}(bit\_count,\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{00996\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(bit\_count\ <=\ \mbox{\hyperlink{bitmap_8h_a808f414039b881e12f71af69c97b7bf0}{MI\_BITMAP\_MAX\_BIT\_COUNT}});}
\DoxyCodeLine{00997\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(bit\_count\ >\ 0);}
\DoxyCodeLine{00998\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunk\_count\ =\ bit\_count\ /\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}};}
\DoxyCodeLine{00999\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(chunk\_count\ >=\ 1);}
\DoxyCodeLine{01000\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}}\ =\ offsetof(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}},chunks)\ +\ (chunk\_count\ *\ \mbox{\hyperlink{bitmap_8h_a19d45f49ea2bf72626dd09fc4a8e6b60}{MI\_BCHUNK\_SIZE}});}
\DoxyCodeLine{01001\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\ (\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}}\%\mbox{\hyperlink{bitmap_8h_a19d45f49ea2bf72626dd09fc4a8e6b60}{MI\_BCHUNK\_SIZE}})\ ==\ 0\ );}
\DoxyCodeLine{01002\ \ \ \textcolor{keywordflow}{if}\ (pchunk\_count\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\ *pchunk\_count\ =\ chunk\_count;\ \ \}}
\DoxyCodeLine{01003\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}};}
\DoxyCodeLine{01004\ \}}
\DoxyCodeLine{01005\ }
\DoxyCodeLine{01006\ }
\DoxyCodeLine{01007\ \textcolor{comment}{//\ initialize\ a\ bitmap\ to\ all\ unset;\ avoid\ a\ mem\_zero\ if\ \`{}already\_zero`\ is\ true}}
\DoxyCodeLine{01008\ \textcolor{comment}{//\ returns\ the\ size\ of\ the\ bitmap}}
\DoxyCodeLine{01009\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{bitmap_8c_aed0bd8f290f3f1cc162df7b7ef95c35d}{mi\_bitmap\_init}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ bit\_count,\ \textcolor{keywordtype}{bool}\ already\_zero)\ \{}
\DoxyCodeLine{01010\ \ \ \textcolor{keywordtype}{size\_t}\ chunk\_count;}
\DoxyCodeLine{01011\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}}\ =\ \mbox{\hyperlink{bitmap_8c_ae5c77a2da37b33891902c131fbe5fac2}{mi\_bitmap\_size}}(bit\_count,\ \&chunk\_count);}
\DoxyCodeLine{01012\ \ \ \textcolor{keywordflow}{if}\ (!already\_zero)\ \{}
\DoxyCodeLine{01013\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa1d3beee9d492fc175ac2584e50fd8ea}{\_mi\_memzero\_aligned}}(bitmap,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}});}
\DoxyCodeLine{01014\ \ \ \}}
\DoxyCodeLine{01015\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a1ee5baaa0004b9c737a03d48d77a0194}{mi\_atomic\_store\_release}}(\&bitmap-\/>chunk\_count,\ chunk\_count);}
\DoxyCodeLine{01016\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&bitmap-\/>chunk\_count)\ <=\ \mbox{\hyperlink{bitmap_8h_a409ffdb586e43fd59782941d4a8e94d6}{MI\_BITMAP\_MAX\_CHUNK\_COUNT}});}
\DoxyCodeLine{01017\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}};}
\DoxyCodeLine{01018\ \}}
\DoxyCodeLine{01019\ }
\DoxyCodeLine{01020\ }
\DoxyCodeLine{01021\ \textcolor{comment}{//\ Set\ a\ sequence\ of\ \`{}n`\ bits\ in\ the\ bitmap\ (and\ can\ cross\ chunks).\ Not\ atomic\ so\ only\ use\ if\ local\ to\ a\ thread.}}
\DoxyCodeLine{01022\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bitmap_8c_ac5230afb96c7e26d8df04caa0dd10729}{mi\_bchunks\_unsafe\_setN}}(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunks,\ \mbox{\hyperlink{bitmap_8h_a0b4ba3cd3091fc6ed215a6e670bcda8f}{mi\_bchunkmap\_t}}*\ cmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n)\ \{}
\DoxyCodeLine{01023\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n>0);}
\DoxyCodeLine{01024\ }
\DoxyCodeLine{01025\ \ \ \textcolor{comment}{//\ start\ chunk\ and\ index}}
\DoxyCodeLine{01026\ \ \ \textcolor{keywordtype}{size\_t}\ chunk\_idx\ =\ idx\ /\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}};}
\DoxyCodeLine{01027\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ cidx\ =\ idx\ \%\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}};}
\DoxyCodeLine{01028\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ ccount\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a693e5b64e9a4644c716974dda2395edc}{\_mi\_divide\_up}}(n,\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{01029\ }
\DoxyCodeLine{01030\ \ \ \textcolor{comment}{//\ first\ update\ the\ chunkmap}}
\DoxyCodeLine{01031\ \ \ \mbox{\hyperlink{bitmap_8c_a931ab182d5a458c9811743a39c0637df}{mi\_bchunk\_setN}}(cmap,\ chunk\_idx,\ ccount,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{01032\ }
\DoxyCodeLine{01033\ \ \ \textcolor{comment}{//\ first\ chunk}}
\DoxyCodeLine{01034\ \ \ \textcolor{keywordtype}{size\_t}\ m\ =\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}}\ -\/\ cidx;}
\DoxyCodeLine{01035\ \ \ \textcolor{keywordflow}{if}\ (m\ >\ n)\ \{\ m\ =\ n;\ \}}
\DoxyCodeLine{01036\ \ \ \mbox{\hyperlink{bitmap_8c_a931ab182d5a458c9811743a39c0637df}{mi\_bchunk\_setN}}(\&chunks[chunk\_idx],\ cidx,\ m,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{01037\ }
\DoxyCodeLine{01038\ \ \ \textcolor{comment}{//\ n\ can\ be\ large\ so\ use\ memset\ for\ efficiency\ for\ all\ in-\/between\ chunks}}
\DoxyCodeLine{01039\ \ \ chunk\_idx++;}
\DoxyCodeLine{01040\ \ \ n\ -\/=\ m;}
\DoxyCodeLine{01041\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ mid\_chunks\ =\ n\ /\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}};}
\DoxyCodeLine{01042\ \ \ \textcolor{keywordflow}{if}\ (mid\_chunks\ >\ 0)\ \{}
\DoxyCodeLine{01043\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ae042f084f894809035813d45e3c43561}{\_mi\_memset}}(\&chunks[chunk\_idx],\ \string~0,\ mid\_chunks\ *\ \mbox{\hyperlink{bitmap_8h_a19d45f49ea2bf72626dd09fc4a8e6b60}{MI\_BCHUNK\_SIZE}});}
\DoxyCodeLine{01044\ \ \ \ \ chunk\_idx\ +=\ mid\_chunks;}
\DoxyCodeLine{01045\ \ \ \ \ n\ -\/=\ (mid\_chunks\ *\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{01046\ \ \ \}}
\DoxyCodeLine{01047\ }
\DoxyCodeLine{01048\ \ \ \textcolor{comment}{//\ last\ chunk}}
\DoxyCodeLine{01049\ \ \ \textcolor{keywordflow}{if}\ (n\ >\ 0)\ \{}
\DoxyCodeLine{01050\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n\ <\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{01051\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(chunk\_idx\ <\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}});}
\DoxyCodeLine{01052\ \ \ \ \ \mbox{\hyperlink{bitmap_8c_a931ab182d5a458c9811743a39c0637df}{mi\_bchunk\_setN}}(\&chunks[chunk\_idx],\ 0,\ n,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{01053\ \ \ \}}
\DoxyCodeLine{01054\ \}}
\DoxyCodeLine{01055\ }
\DoxyCodeLine{01056\ \textcolor{comment}{//\ Set\ a\ sequence\ of\ \`{}n`\ bits\ in\ the\ bitmap\ (and\ can\ cross\ chunks).\ Not\ atomic\ so\ only\ use\ if\ local\ to\ a\ thread.}}
\DoxyCodeLine{01057\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bitmap_8c_a563a4de12743448216d8b9763ce0fcbf}{mi\_bitmap\_unsafe\_setN}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n)\ \{}
\DoxyCodeLine{01058\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n>0);}
\DoxyCodeLine{01059\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(idx\ +\ n\ <=\ \mbox{\hyperlink{bitmap_8h_ac65c5f63cedfbd7ef9c6dcbdf9d37a0f}{mi\_bitmap\_max\_bits}}(bitmap));}
\DoxyCodeLine{01060\ \ \ \mbox{\hyperlink{bitmap_8c_ac5230afb96c7e26d8df04caa0dd10729}{mi\_bchunks\_unsafe\_setN}}(\&bitmap-\/>chunks[0],\ \&bitmap-\/>chunkmap,\ idx,\ n);}
\DoxyCodeLine{01061\ \}}
\DoxyCodeLine{01062\ }
\DoxyCodeLine{01063\ }
\DoxyCodeLine{01064\ }
\DoxyCodeLine{01065\ }
\DoxyCodeLine{01066\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/\ mi\_bitmap\_xset\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01067\ }
\DoxyCodeLine{01068\ \textcolor{comment}{//\ Set\ a\ sequence\ of\ \`{}n`\ bits\ in\ the\ bitmap;\ returns\ \`{}true`\ if\ atomically\ transitioned\ from\ 0's\ to\ 1's\ (or\ 1's\ to\ 0's).}}
\DoxyCodeLine{01069\ \textcolor{comment}{//\ \`{}n`\ cannot\ cross\ chunk\ boundaries\ (and\ \`{}n\ <=\ MI\_BCHUNK\_BITS`)!}}
\DoxyCodeLine{01070\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a8b50ea67e216213718b39a8bdc71c089}{mi\_bitmap\_setN}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{size\_t}*\ already\_set)\ \{}
\DoxyCodeLine{01071\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n>0);}
\DoxyCodeLine{01072\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n<=\mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{01073\ }
\DoxyCodeLine{01074\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunk\_idx\ =\ idx\ /\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}};}
\DoxyCodeLine{01075\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ cidx\ =\ idx\ \%\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}};}
\DoxyCodeLine{01076\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(cidx\ +\ n\ <=\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});\ \ \textcolor{comment}{//\ don't\ cross\ chunks\ (for\ now)}}
\DoxyCodeLine{01077\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(chunk\_idx\ <\ \mbox{\hyperlink{bitmap_8h_adbc04bcdad6dd6f18993c5ed4b92f2a4}{mi\_bitmap\_chunk\_count}}(bitmap));}
\DoxyCodeLine{01078\ \ \ \textcolor{keywordflow}{if}\ (cidx\ +\ n\ >\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}})\ \{\ n\ =\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}}\ -\/\ cidx;\ \}\ \ \textcolor{comment}{//\ paranoia}}
\DoxyCodeLine{01079\ }
\DoxyCodeLine{01080\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ were\_allclear\ =\ \mbox{\hyperlink{bitmap_8c_a931ab182d5a458c9811743a39c0637df}{mi\_bchunk\_setN}}(\&bitmap-\/>chunks[chunk\_idx],\ cidx,\ n,\ already\_set);}
\DoxyCodeLine{01081\ \ \ \mbox{\hyperlink{bitmap_8c_ae28d6cc04a3cf604bc16fd933973412a}{mi\_bitmap\_chunkmap\_set}}(bitmap,\ chunk\_idx);\ \ \ \textcolor{comment}{//\ set\ afterwards}}
\DoxyCodeLine{01082\ \ \ \textcolor{keywordflow}{return}\ were\_allclear;}
\DoxyCodeLine{01083\ \}}
\DoxyCodeLine{01084\ }
\DoxyCodeLine{01085\ \textcolor{comment}{//\ Clear\ a\ sequence\ of\ \`{}n`\ bits\ in\ the\ bitmap;\ returns\ \`{}true`\ if\ atomically\ transitioned\ from\ 1's\ to\ 0's.}}
\DoxyCodeLine{01086\ \textcolor{comment}{//\ \`{}n`\ cannot\ cross\ chunk\ boundaries\ (and\ \`{}n\ <=\ MI\_BCHUNK\_BITS`)!}}
\DoxyCodeLine{01087\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_aa8d5d77b9137fac58dba2415da230b4b}{mi\_bitmap\_clearN}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n)\ \{}
\DoxyCodeLine{01088\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n>0);}
\DoxyCodeLine{01089\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n<=\mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{01090\ }
\DoxyCodeLine{01091\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunk\_idx\ =\ idx\ /\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}};}
\DoxyCodeLine{01092\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ cidx\ =\ idx\ \%\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}};}
\DoxyCodeLine{01093\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(cidx\ +\ n\ <=\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});\ \ \textcolor{comment}{//\ don't\ cross\ chunks\ (for\ now)}}
\DoxyCodeLine{01094\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(chunk\_idx\ <\ \mbox{\hyperlink{bitmap_8h_adbc04bcdad6dd6f18993c5ed4b92f2a4}{mi\_bitmap\_chunk\_count}}(bitmap));}
\DoxyCodeLine{01095\ \ \ \textcolor{keywordflow}{if}\ (cidx\ +\ n\ >\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}})\ \{\ n\ =\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}}\ -\/\ cidx;\ \}\ \ \textcolor{comment}{//\ paranoia}}
\DoxyCodeLine{01096\ }
\DoxyCodeLine{01097\ \ \ \textcolor{keywordtype}{bool}\ maybe\_all\_clear;}
\DoxyCodeLine{01098\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ were\_allset\ =\ \mbox{\hyperlink{bitmap_8c_ad965785a3292db948723392a2db65539}{mi\_bchunk\_clearN}}(\&bitmap-\/>chunks[chunk\_idx],\ cidx,\ n,\ \&maybe\_all\_clear);}
\DoxyCodeLine{01099\ \ \ \textcolor{keywordflow}{if}\ (maybe\_all\_clear)\ \{\ \mbox{\hyperlink{bitmap_8c_a5bb0c3e1e081c87726fb5e091123673e}{mi\_bitmap\_chunkmap\_try\_clear}}(bitmap,\ chunk\_idx);\ \}}
\DoxyCodeLine{01100\ \ \ \textcolor{keywordflow}{return}\ were\_allset;}
\DoxyCodeLine{01101\ \}}
\DoxyCodeLine{01102\ }
\DoxyCodeLine{01103\ }
\DoxyCodeLine{01104\ \textcolor{comment}{//\ Set/clear\ a\ bit\ in\ the\ bitmap;\ returns\ \`{}true`\ if\ atomically\ transitioned\ from\ 0\ to\ 1\ (or\ 1\ to\ 0)}}
\DoxyCodeLine{01105\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a929cc4a78e5271092ab20f25c10ba956}{mi\_bitmap\_set}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ idx)\ \{}
\DoxyCodeLine{01106\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_a8b50ea67e216213718b39a8bdc71c089}{mi\_bitmap\_setN}}(bitmap,\ idx,\ 1,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{01107\ \}}
\DoxyCodeLine{01108\ }
\DoxyCodeLine{01109\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a8307caae564be5c0c96d17562ce1291b}{mi\_bitmap\_clear}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ idx)\ \{}
\DoxyCodeLine{01110\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_aa8d5d77b9137fac58dba2415da230b4b}{mi\_bitmap\_clearN}}(bitmap,\ idx,\ 1);}
\DoxyCodeLine{01111\ \}}
\DoxyCodeLine{01112\ }
\DoxyCodeLine{01113\ }
\DoxyCodeLine{01114\ }
\DoxyCodeLine{01115\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/\ mi\_bitmap\_is\_xset\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01116\ }
\DoxyCodeLine{01117\ \textcolor{comment}{//\ Is\ a\ sequence\ of\ n\ bits\ already\ all\ set/cleared?}}
\DoxyCodeLine{01118\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_adb22535bc9bc502a2e9f4f41e64972b2}{mi\_bitmap\_is\_xsetN}}(\mbox{\hyperlink{bitmap_8h_a67332e1b1063739efba1c809b15eeb36}{mi\_xset\_t}}\ \mbox{\hyperlink{bundled_2ranges_8h_a080be1238e6ee3bd4b9f193b4181cf4dacdaeeeba9b4a4c5ebf042c0215a7bb0e}{set}},\ \mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n)\ \{}
\DoxyCodeLine{01119\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n>0);}
\DoxyCodeLine{01120\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n<=\mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{01121\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(idx\ +\ n\ <=\ \mbox{\hyperlink{bitmap_8h_ac65c5f63cedfbd7ef9c6dcbdf9d37a0f}{mi\_bitmap\_max\_bits}}(bitmap));}
\DoxyCodeLine{01122\ }
\DoxyCodeLine{01123\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunk\_idx\ =\ idx\ /\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}};}
\DoxyCodeLine{01124\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ cidx\ =\ idx\ \%\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}};}
\DoxyCodeLine{01125\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(cidx\ +\ n\ <=\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});\ \ \textcolor{comment}{//\ don't\ cross\ chunks\ (for\ now)}}
\DoxyCodeLine{01126\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(chunk\_idx\ <\ \mbox{\hyperlink{bitmap_8h_adbc04bcdad6dd6f18993c5ed4b92f2a4}{mi\_bitmap\_chunk\_count}}(bitmap));}
\DoxyCodeLine{01127\ \ \ \textcolor{keywordflow}{if}\ (cidx\ +\ n\ >\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}})\ \{\ n\ =\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}}\ -\/\ cidx;\ \}\ \ \textcolor{comment}{//\ paranoia}}
\DoxyCodeLine{01128\ }
\DoxyCodeLine{01129\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_ab0d208390523d5afdb78b6f0be816b2f}{mi\_bchunk\_is\_xsetN}}(\mbox{\hyperlink{bundled_2ranges_8h_a080be1238e6ee3bd4b9f193b4181cf4dacdaeeeba9b4a4c5ebf042c0215a7bb0e}{set}},\ \&bitmap-\/>chunks[chunk\_idx],\ cidx,\ n);}
\DoxyCodeLine{01130\ \}}
\DoxyCodeLine{01131\ }
\DoxyCodeLine{01132\ }
\DoxyCodeLine{01133\ }
\DoxyCodeLine{01134\ }
\DoxyCodeLine{01135\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01136\ \textcolor{comment}{\ \ Iterate\ through\ a\ bfield}}
\DoxyCodeLine{01137\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{01138\ }
\DoxyCodeLine{01139\ \textcolor{comment}{//\ Cycle\ iteration\ through\ a\ bitfield.\ This\ is\ used\ to\ space\ out\ threads}}
\DoxyCodeLine{01140\ \textcolor{comment}{//\ so\ there\ is\ less\ chance\ of\ contention.\ When\ searching\ for\ a\ free\ page\ we}}
\DoxyCodeLine{01141\ \textcolor{comment}{//\ like\ to\ first\ search\ only\ the\ accessed\ part\ (so\ we\ reuse\ better).\ This}}
\DoxyCodeLine{01142\ \textcolor{comment}{//\ high\ point\ is\ called\ the\ \`{}cycle`.}}
\DoxyCodeLine{01143\ \textcolor{comment}{//}}
\DoxyCodeLine{01144\ \textcolor{comment}{//\ We\ then\ iterate\ through\ the\ bitfield\ as:}}
\DoxyCodeLine{01145\ \textcolor{comment}{//\ first:\ [start,\ cycle>}}
\DoxyCodeLine{01146\ \textcolor{comment}{//\ then\ :\ [0,\ start>}}
\DoxyCodeLine{01147\ \textcolor{comment}{//\ then\ :\ [cycle,\ MI\_BFIELD\_BITS>}}
\DoxyCodeLine{01148\ \textcolor{comment}{//}}
\DoxyCodeLine{01149\ \textcolor{comment}{//\ The\ start\ is\ determined\ usually\ as\ \`{}tseq\ \%\ cycle`\ to\ have\ each\ thread}}
\DoxyCodeLine{01150\ \textcolor{comment}{//\ start\ at\ a\ different\ spot.}}
\DoxyCodeLine{01151\ \textcolor{comment}{//\ -\/\ We\ use\ \`{}popcount`\ to\ improve\ branch\ prediction\ (maybe\ not\ needed?\ can\ we\ simplify?)}}
\DoxyCodeLine{01152\ \textcolor{comment}{//\ -\/\ The\ \`{}cycle\_mask`\ is\ the\ part\ \`{}[start,\ cycle>`.}}
\DoxyCodeLine{01153\ \textcolor{preprocessor}{\#define\ mi\_bfield\_iterate(bfield,start,cycle,name\_idx,SUF)\ \{\ \(\backslash\)}}
\DoxyCodeLine{01154\ \textcolor{preprocessor}{\ \ mi\_assert\_internal(start\ <=\ cycle);\ \(\backslash\)}}
\DoxyCodeLine{01155\ \textcolor{preprocessor}{\ \ mi\_assert\_internal(start\ <\ MI\_BFIELD\_BITS);\ \(\backslash\)}}
\DoxyCodeLine{01156\ \textcolor{preprocessor}{\ \ mi\_assert\_internal(cycle\ <=\ MI\_BFIELD\_BITS);\ \(\backslash\)}}
\DoxyCodeLine{01157\ \textcolor{preprocessor}{\ \ mi\_bfield\_t\ \_cycle\_mask\#\#SUF\ =\ mi\_bfield\_mask(cycle\ -\/\ start,\ start);\ \(\backslash\)}}
\DoxyCodeLine{01158\ \textcolor{preprocessor}{\ \ size\_t\ \_bcount\#\#SUF\ =\ mi\_bfield\_popcount(bfield);\ \(\backslash\)}}
\DoxyCodeLine{01159\ \textcolor{preprocessor}{\ \ mi\_bfield\_t\ \_b\#\#SUF\ =\ bfield\ \&\ \_cycle\_mask\#\#SUF;\ }\textcolor{comment}{/*\ process\ [start,\ cycle>\ first*/}\textcolor{preprocessor}{\(\backslash\)}}
\DoxyCodeLine{01160\ \textcolor{preprocessor}{\ \ while(\_bcount\#\#SUF\ >\ 0)\ \{\ \(\backslash\)}}
\DoxyCodeLine{01161\ \textcolor{preprocessor}{\ \ \ \ \_bcount\#\#SUF-\/-\/;\(\backslash\)}}
\DoxyCodeLine{01162\ \textcolor{preprocessor}{\ \ \ \ if\ (\_b\#\#SUF==0)\ \{\ \_b\#\#SUF\ =\ bfield\ \&\ \string~\_cycle\_mask\#\#SUF;\ \}\ }\textcolor{comment}{/*\ process\ [0,start>\ +\ [cycle,\ MI\_BFIELD\_BITS>\ next\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{01163\ \textcolor{preprocessor}{\ \ \ \ }\textcolor{comment}{/*\ size\_t\ name\_idx;\ */}\textcolor{preprocessor}{\ \(\backslash\)}}
\DoxyCodeLine{01164\ \textcolor{preprocessor}{\ \ \ \ bool\ \_found\#\#SUF\ =\ mi\_bfield\_find\_least\_bit(\_b\#\#SUF,\&name\_idx);\ \(\backslash\)}}
\DoxyCodeLine{01165\ \textcolor{preprocessor}{\ \ \ \ mi\_assert\_internal(\_found\#\#SUF);\ MI\_UNUSED(\_found\#\#SUF);\ \(\backslash\)}}
\DoxyCodeLine{01166\ \textcolor{preprocessor}{\ \ \ \ \{\ \(\backslash\)}}
\DoxyCodeLine{01167\ \textcolor{preprocessor}{}}
\DoxyCodeLine{01168\ \textcolor{preprocessor}{\#define\ mi\_bfield\_iterate\_end(SUF)\ \(\backslash\)}}
\DoxyCodeLine{01169\ \textcolor{preprocessor}{\ \ \ \ \}\ \(\backslash\)}}
\DoxyCodeLine{01170\ \textcolor{preprocessor}{\ \ \ \ \_b\#\#SUF\ =\ mi\_bfield\_clear\_least\_bit(\_b\#\#SUF);\ \(\backslash\)}}
\DoxyCodeLine{01171\ \textcolor{preprocessor}{\ \ \}\ \(\backslash\)}}
\DoxyCodeLine{01172\ \textcolor{preprocessor}{\}}}
\DoxyCodeLine{01173\ }
\DoxyCodeLine{01174\ \textcolor{preprocessor}{\#define\ mi\_bfield\_cycle\_iterate(bfield,tseq,cycle,name\_idx,SUF)\ \{\ \(\backslash\)}}
\DoxyCodeLine{01175\ \textcolor{preprocessor}{\ \ const\ size\_t\ \_start\#\#SUF\ =\ (uint32\_t)(tseq)\ \%\ (uint32\_t)(cycle);\ }\textcolor{comment}{/*\ or:\ 0\ to\ always\ search\ from\ the\ start?\ */}\textcolor{preprocessor}{\(\backslash\)}}
\DoxyCodeLine{01176\ \textcolor{preprocessor}{\ \ mi\_bfield\_iterate(bfield,\_start\#\#SUF,cycle,name\_idx,SUF)}}
\DoxyCodeLine{01177\ }
\DoxyCodeLine{01178\ \textcolor{preprocessor}{\#define\ mi\_bfield\_cycle\_iterate\_end(SUF)\ \(\backslash\)}}
\DoxyCodeLine{01179\ \textcolor{preprocessor}{\ \ mi\_bfield\_iterate\_end(SUF);\ \}}}
\DoxyCodeLine{01180\ }
\DoxyCodeLine{01181\ }
\DoxyCodeLine{01182\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01183\ \textcolor{comment}{\ \ mi\_bitmap\_find}}
\DoxyCodeLine{01184\ \textcolor{comment}{\ \ (used\ to\ find\ free\ pages)}}
\DoxyCodeLine{01185\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{01186\ }
\DoxyCodeLine{01187\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{sugar_8h_abb452686968e48b67397da5f97445f5b}{bool}}\ (\mbox{\hyperlink{bitmap_8c_a17751a15a71efebefca957755f278e8f}{mi\_bitmap\_visit\_fun\_t}})(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ chunk\_idx,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{size\_t}*\ idx,\ \textcolor{keywordtype}{void}*\ arg1,\ \textcolor{keywordtype}{void}*\ arg2);}
\DoxyCodeLine{01188\ }
\DoxyCodeLine{01189\ \textcolor{comment}{//\ Go\ through\ the\ bitmap\ and\ for\ every\ sequence\ of\ \`{}n`\ set\ bits,\ call\ the\ visitor\ function.}}
\DoxyCodeLine{01190\ \textcolor{comment}{//\ If\ it\ returns\ \`{}true`\ stop\ the\ search.}}
\DoxyCodeLine{01191\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a49d7c4a9f9227981d3aa02da28e7176a}{mi\_bitmap\_find}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ tseq,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{size\_t}*\ pidx,\ \mbox{\hyperlink{bitmap_8c_a17751a15a71efebefca957755f278e8f}{mi\_bitmap\_visit\_fun\_t}}*\ on\_find,\ \textcolor{keywordtype}{void}*\ arg1,\ \textcolor{keywordtype}{void}*\ arg2)}
\DoxyCodeLine{01192\ \{}
\DoxyCodeLine{01193\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunkmap\_max\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a693e5b64e9a4644c716974dda2395edc}{\_mi\_divide\_up}}(\mbox{\hyperlink{bitmap_8h_adbc04bcdad6dd6f18993c5ed4b92f2a4}{mi\_bitmap\_chunk\_count}}(bitmap),\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{01194\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ chunkmap\_max;\ i++)\ \{}
\DoxyCodeLine{01195\ \ \ \ \ \textcolor{comment}{//\ and\ for\ each\ chunkmap\ entry\ we\ iterate\ over\ its\ bits\ to\ find\ the\ chunks}}
\DoxyCodeLine{01196\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ cmap\_entry\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&bitmap-\/>chunkmap.bfields[i]);}
\DoxyCodeLine{01197\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ hi;}
\DoxyCodeLine{01198\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bitmap_8c_a9c990615f58f32afbd36307e2610599d}{mi\_bfield\_find\_highest\_bit}}(cmap\_entry,\ \&hi))\ \{}
\DoxyCodeLine{01199\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ eidx\ =\ 0;}
\DoxyCodeLine{01200\ \ \ \ \ \ \ \mbox{\hyperlink{bitmap_8c_a88d496215c839717834f3924ece9dd95}{mi\_bfield\_cycle\_iterate}}(cmap\_entry,\ tseq\%8,\ hi+1,\ eidx,\ Y)\ \textcolor{comment}{//\ reduce\ the\ tseq\ to\ 8\ bins\ to\ reduce\ using\ extra\ memory\ (see\ \`{}mstress`)}}
\DoxyCodeLine{01201\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01202\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(eidx\ <=\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{01203\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunk\_idx\ =\ i*\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}}\ +\ eidx;}
\DoxyCodeLine{01204\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(chunk\_idx\ <\ \mbox{\hyperlink{bitmap_8h_adbc04bcdad6dd6f18993c5ed4b92f2a4}{mi\_bitmap\_chunk\_count}}(bitmap));}
\DoxyCodeLine{01205\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*on\_find)(bitmap,\ chunk\_idx,\ n,\ pidx,\ arg1,\ arg2))\ \{}
\DoxyCodeLine{01206\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01207\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01208\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01209\ \ \ \ \ \ \ \mbox{\hyperlink{bitmap_8c_a704d70bca29f1b05f2e856167e0e8e78}{mi\_bfield\_cycle\_iterate\_end}}(Y);}
\DoxyCodeLine{01210\ \ \ \ \ \}}
\DoxyCodeLine{01211\ \ \ \}}
\DoxyCodeLine{01212\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01213\ \}}
\DoxyCodeLine{01214\ }
\DoxyCodeLine{01215\ }
\DoxyCodeLine{01216\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01217\ \textcolor{comment}{\ \ Bitmap:\ try\_find\_and\_claim\ \ -\/-\/\ used\ to\ allocate\ abandoned\ pages}}
\DoxyCodeLine{01218\ \textcolor{comment}{\ \ note:\ the\ compiler\ will\ fully\ inline\ the\ indirect\ function\ call}}
\DoxyCodeLine{01219\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{01220\ }
\DoxyCodeLine{01221\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structmi__claim__fun__data__s}{mi\_claim\_fun\_data\_s}}\ \{}
\DoxyCodeLine{01222\ \ \ \mbox{\hyperlink{types_8h_a4187c38d7fe26f37558a31eb935dfe2d}{mi\_arena\_t}}*\ \ \ \mbox{\hyperlink{structmi__claim__fun__data__s_a1f2dbe519d4a92f619f2bec5e73b242f}{arena}};}
\DoxyCodeLine{01223\ \ \ \mbox{\hyperlink{types_8h_a4e05bcab5a6832b213e85e7186bd24bd}{mi\_heaptag\_t}}\ \ \mbox{\hyperlink{structmi__claim__fun__data__s_a0c699d031461c4c83fc25b27c6f668d5}{heap\_tag}};}
\DoxyCodeLine{01224\ \}\ \mbox{\hyperlink{bitmap_8c_a3a6e19b0f7ef434bae6ea89ef8a3c904}{mi\_claim\_fun\_data\_t}};}
\DoxyCodeLine{01225\ }
\DoxyCodeLine{01226\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a4bf08849d33497f770c720ebaf7034c9}{mi\_bitmap\_try\_find\_and\_claim\_visit}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ chunk\_idx,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{size\_t}*\ pidx,\ \textcolor{keywordtype}{void}*\ arg1,\ \textcolor{keywordtype}{void}*\ arg2)}
\DoxyCodeLine{01227\ \{}
\DoxyCodeLine{01228\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n==1);\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(n);}
\DoxyCodeLine{01229\ \ \ \mbox{\hyperlink{bitmap_8h_a20baea921bde52c3d1b2626d03d409aa}{mi\_claim\_fun\_t}}*\ claim\_fun\ =\ (\mbox{\hyperlink{bitmap_8h_a20baea921bde52c3d1b2626d03d409aa}{mi\_claim\_fun\_t}}*)arg1;}
\DoxyCodeLine{01230\ \ \ \mbox{\hyperlink{bitmap_8c_a3a6e19b0f7ef434bae6ea89ef8a3c904}{mi\_claim\_fun\_data\_t}}*\ claim\_data\ =\ (\mbox{\hyperlink{bitmap_8c_a3a6e19b0f7ef434bae6ea89ef8a3c904}{mi\_claim\_fun\_data\_t}}*)arg2;}
\DoxyCodeLine{01231\ \ \ \textcolor{keywordtype}{size\_t}\ cidx;}
\DoxyCodeLine{01232\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a7b29eabf31d4ddb28a16267045384e03}{mi\_likely}}(\mbox{\hyperlink{bitmap_8c_aa11557a706a7a264cc1f73f1300e17eb}{mi\_bchunk\_try\_find\_and\_clear}}(\&bitmap-\/>chunks[chunk\_idx],\ \&cidx))\ \{}
\DoxyCodeLine{01233\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ slice\_index\ =\ (chunk\_idx\ *\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}})\ +\ cidx;}
\DoxyCodeLine{01234\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(slice\_index\ <\ \mbox{\hyperlink{bitmap_8h_ac65c5f63cedfbd7ef9c6dcbdf9d37a0f}{mi\_bitmap\_max\_bits}}(bitmap));}
\DoxyCodeLine{01235\ \ \ \ \ \textcolor{keywordtype}{bool}\ keep\_set\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01236\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*claim\_fun)(slice\_index,\ claim\_data-\/>\mbox{\hyperlink{structmi__claim__fun__data__s_a1f2dbe519d4a92f619f2bec5e73b242f}{arena}},\ claim\_data-\/>\mbox{\hyperlink{structmi__claim__fun__data__s_a0c699d031461c4c83fc25b27c6f668d5}{heap\_tag}},\ \&keep\_set))\ \{}
\DoxyCodeLine{01237\ \ \ \ \ \ \ \textcolor{comment}{//\ success!}}
\DoxyCodeLine{01238\ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(!keep\_set);}
\DoxyCodeLine{01239\ \ \ \ \ \ \ *pidx\ =\ slice\_index;}
\DoxyCodeLine{01240\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01241\ \ \ \ \ \}}
\DoxyCodeLine{01242\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01243\ \ \ \ \ \ \ \textcolor{comment}{//\ failed\ to\ claim\ it,\ set\ abandoned\ mapping\ again\ (unless\ the\ page\ was\ freed)}}
\DoxyCodeLine{01244\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (keep\_set)\ \{}
\DoxyCodeLine{01245\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ wasclear\ =\ \mbox{\hyperlink{bitmap_8c_ab346ba3b2da689a30e5cc0bf7348e552}{mi\_bchunk\_set}}(\&bitmap-\/>chunks[chunk\_idx],\ cidx,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{01246\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(wasclear);\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ab7467946e27cd6bb4af911805cc5db26}{MI\_UNUSED}}(wasclear);}
\DoxyCodeLine{01247\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01248\ \ \ \ \ \}}
\DoxyCodeLine{01249\ \ \ \}}
\DoxyCodeLine{01250\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01251\ \ \ \ \ \textcolor{comment}{//\ we\ may\ find\ that\ all\ are\ cleared\ only\ on\ a\ second\ iteration\ but\ that\ is\ ok\ as}}
\DoxyCodeLine{01252\ \ \ \ \ \textcolor{comment}{//\ the\ chunkmap\ is\ a\ conservative\ approximation.}}
\DoxyCodeLine{01253\ \ \ \ \ \mbox{\hyperlink{bitmap_8c_a5bb0c3e1e081c87726fb5e091123673e}{mi\_bitmap\_chunkmap\_try\_clear}}(bitmap,\ chunk\_idx);}
\DoxyCodeLine{01254\ \ \ \}}
\DoxyCodeLine{01255\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01256\ \}}
\DoxyCodeLine{01257\ }
\DoxyCodeLine{01258\ \textcolor{comment}{//\ Find\ a\ set\ bit\ in\ the\ bitmap\ and\ try\ to\ atomically\ clear\ it\ and\ claim\ it.}}
\DoxyCodeLine{01259\ \textcolor{comment}{//\ (Used\ to\ find\ pages\ in\ the\ pages\_abandoned\ bitmaps.)}}
\DoxyCodeLine{01260\ \mbox{\hyperlink{mimalloc_8h_acbaf5f4132fcfb51f0bf40e3b50f0981}{mi\_decl\_nodiscard}}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_ad3abd3ec821fcd51ee18dd26221eee99}{mi\_bitmap\_try\_find\_and\_claim}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ tseq,\ \textcolor{keywordtype}{size\_t}*\ pidx,}
\DoxyCodeLine{01261\ \ \ \mbox{\hyperlink{bitmap_8h_a20baea921bde52c3d1b2626d03d409aa}{mi\_claim\_fun\_t}}*\ claim,\ \mbox{\hyperlink{types_8h_a4187c38d7fe26f37558a31eb935dfe2d}{mi\_arena\_t}}*\ arena,\ \mbox{\hyperlink{types_8h_a4e05bcab5a6832b213e85e7186bd24bd}{mi\_heaptag\_t}}\ heap\_tag)}
\DoxyCodeLine{01262\ \{}
\DoxyCodeLine{01263\ \ \ \mbox{\hyperlink{bitmap_8c_a3a6e19b0f7ef434bae6ea89ef8a3c904}{mi\_claim\_fun\_data\_t}}\ claim\_data\ =\ \{\ arena,\ heap\_tag\ \};}
\DoxyCodeLine{01264\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_a49d7c4a9f9227981d3aa02da28e7176a}{mi\_bitmap\_find}}(bitmap,\ tseq,\ 1,\ pidx,\ \&\mbox{\hyperlink{bitmap_8c_a4bf08849d33497f770c720ebaf7034c9}{mi\_bitmap\_try\_find\_and\_claim\_visit}},\ (\textcolor{keywordtype}{void}*)claim,\ \&claim\_data);}
\DoxyCodeLine{01265\ \}}
\DoxyCodeLine{01266\ }
\DoxyCodeLine{01267\ }
\DoxyCodeLine{01268\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_ae16f179c5be39c21cbad41f9f07b4d53}{mi\_bitmap\_bsr}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}*\ idx)\ \{}
\DoxyCodeLine{01269\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunkmap\_max\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a693e5b64e9a4644c716974dda2395edc}{\_mi\_divide\_up}}(\mbox{\hyperlink{bitmap_8h_adbc04bcdad6dd6f18993c5ed4b92f2a4}{mi\_bitmap\_chunk\_count}}(bitmap),\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{01270\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ chunkmap\_max;\ i\ >\ 0;\ )\ \{}
\DoxyCodeLine{01271\ \ \ \ \ i-\/-\/;}
\DoxyCodeLine{01272\ \ \ \ \ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ cmap\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&bitmap-\/>chunkmap.bfields[i]);}
\DoxyCodeLine{01273\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ cmap\_idx;}
\DoxyCodeLine{01274\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bits_8h_ae1a375404b8024ab419cfc537db20741}{mi\_bsr}}(cmap,\&cmap\_idx))\ \{}
\DoxyCodeLine{01275\ \ \ \ \ \ \ \textcolor{comment}{//\ highest\ chunk}}
\DoxyCodeLine{01276\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunk\_idx\ =\ i*\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}}\ +\ cmap\_idx;}
\DoxyCodeLine{01277\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ cidx;}
\DoxyCodeLine{01278\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bitmap_8c_a642c642fcc877806a6dce9e8878f3004}{mi\_bchunk\_bsr}}(\&bitmap-\/>chunks[chunk\_idx],\ \&cidx))\ \{}
\DoxyCodeLine{01279\ \ \ \ \ \ \ \ \ *idx\ =\ (chunk\_idx\ *\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}})\ +\ cidx;}
\DoxyCodeLine{01280\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01281\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01282\ \ \ \ \ \}}
\DoxyCodeLine{01283\ \ \ \}}
\DoxyCodeLine{01284\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01285\ \}}
\DoxyCodeLine{01286\ }
\DoxyCodeLine{01287\ }
\DoxyCodeLine{01288\ \textcolor{comment}{//\ Clear\ a\ bit\ once\ it\ is\ set.}}
\DoxyCodeLine{01289\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bitmap_8c_a5d33d5a4632e5bea06e41cd8a8f1179d}{mi\_bitmap\_clear\_once\_set}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \textcolor{keywordtype}{size\_t}\ idx)\ \{}
\DoxyCodeLine{01290\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(idx\ <\ \mbox{\hyperlink{bitmap_8h_ac65c5f63cedfbd7ef9c6dcbdf9d37a0f}{mi\_bitmap\_max\_bits}}(bitmap));}
\DoxyCodeLine{01291\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunk\_idx\ =\ idx\ /\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}};}
\DoxyCodeLine{01292\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ cidx\ =\ idx\ \%\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}};}
\DoxyCodeLine{01293\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(chunk\_idx\ <\ \mbox{\hyperlink{bitmap_8h_adbc04bcdad6dd6f18993c5ed4b92f2a4}{mi\_bitmap\_chunk\_count}}(bitmap));}
\DoxyCodeLine{01294\ \ \ \mbox{\hyperlink{bitmap_8c_a585940fb5c029aa8d9e10216f29a7888}{mi\_bchunk\_clear\_once\_set}}(\&bitmap-\/>chunks[chunk\_idx],\ cidx);}
\DoxyCodeLine{01295\ \}}
\DoxyCodeLine{01296\ }
\DoxyCodeLine{01297\ }
\DoxyCodeLine{01298\ \textcolor{comment}{//\ Visit\ all\ set\ bits\ in\ a\ bitmap.}}
\DoxyCodeLine{01299\ \textcolor{comment}{//\ todo:\ optimize\ further?\ maybe\ use\ avx512\ to\ directly\ get\ all\ indices\ using\ a\ mask\_compressstore?}}
\DoxyCodeLine{01300\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a7e9c291ee2f088455bc48a714d09e49a}{\_mi\_bitmap\_forall\_set}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \mbox{\hyperlink{bitmap_8h_a04d7717532d9d613467ba190bca61188}{mi\_forall\_set\_fun\_t}}*\ visit,\ \mbox{\hyperlink{types_8h_a4187c38d7fe26f37558a31eb935dfe2d}{mi\_arena\_t}}*\ arena,\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}})\ \{}
\DoxyCodeLine{01301\ \ \ \textcolor{comment}{//\ for\ all\ chunkmap\ entries}}
\DoxyCodeLine{01302\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunkmap\_max\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a693e5b64e9a4644c716974dda2395edc}{\_mi\_divide\_up}}(\mbox{\hyperlink{bitmap_8h_adbc04bcdad6dd6f18993c5ed4b92f2a4}{mi\_bitmap\_chunk\_count}}(bitmap),\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{01303\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ chunkmap\_max;\ i++)\ \{}
\DoxyCodeLine{01304\ \ \ \ \ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ cmap\_entry\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&bitmap-\/>chunkmap.bfields[i]);}
\DoxyCodeLine{01305\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ cmap\_idx;}
\DoxyCodeLine{01306\ \ \ \ \ \textcolor{comment}{//\ for\ each\ chunk\ (corresponding\ to\ a\ set\ bit\ in\ a\ chunkmap\ entry)}}
\DoxyCodeLine{01307\ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{bitmap_8c_a23792b2780ff4daafc8ca3c8f61832d4}{mi\_bfield\_foreach\_bit}}(\&cmap\_entry,\ \&cmap\_idx))\ \{}
\DoxyCodeLine{01308\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunk\_idx\ =\ i*\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}}\ +\ cmap\_idx;}
\DoxyCodeLine{01309\ \ \ \ \ \ \ \textcolor{comment}{//\ for\ each\ chunk\ field}}
\DoxyCodeLine{01310\ \ \ \ \ \ \ \mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ \textcolor{keyword}{const}\ chunk\ =\ \&bitmap-\/>chunks[chunk\_idx];}
\DoxyCodeLine{01311\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ j\ =\ 0;\ j\ <\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}};\ j++)\ \{}
\DoxyCodeLine{01312\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ base\_idx\ =\ (chunk\_idx*\mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}})\ +\ (j*\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{01313\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&chunk-\/>bfields[j]);}
\DoxyCodeLine{01314\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ bidx;}
\DoxyCodeLine{01315\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{bitmap_8c_a23792b2780ff4daafc8ca3c8f61832d4}{mi\_bfield\_foreach\_bit}}(\&\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \&bidx))\ \{}
\DoxyCodeLine{01316\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx\ =\ base\_idx\ +\ bidx;}
\DoxyCodeLine{01317\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!visit(idx,\ 1,\ arena,\ \mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}}))\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01318\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01319\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01320\ \ \ \ \ \}}
\DoxyCodeLine{01321\ \ \ \}}
\DoxyCodeLine{01322\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01323\ \}}
\DoxyCodeLine{01324\ }
\DoxyCodeLine{01325\ \textcolor{comment}{//\ Visit\ all\ set\ bits\ in\ a\ bitmap\ but\ try\ to\ return\ ranges\ (within\ bfields)\ if\ possible.}}
\DoxyCodeLine{01326\ \textcolor{comment}{//\ Also\ clear\ those\ ranges\ atomically.}}
\DoxyCodeLine{01327\ \textcolor{comment}{//\ Used\ by\ purging\ to\ purge\ larger\ ranges\ when\ possible}}
\DoxyCodeLine{01328\ \textcolor{comment}{//\ todo:\ optimize\ further?\ maybe\ use\ avx512\ to\ directly\ get\ all\ indices\ using\ a\ mask\_compressstore?}}
\DoxyCodeLine{01329\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a48ab4eea9d7b3ac453303f475d57d279}{\_mi\_bitmap\_forall\_setc\_ranges}}(\mbox{\hyperlink{bitmap_8h_a50e7ecdf4522e74e8d14956139276478}{mi\_bitmap\_t}}*\ bitmap,\ \mbox{\hyperlink{bitmap_8h_a04d7717532d9d613467ba190bca61188}{mi\_forall\_set\_fun\_t}}*\ visit,\ \mbox{\hyperlink{types_8h_a4187c38d7fe26f37558a31eb935dfe2d}{mi\_arena\_t}}*\ arena,\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}})\ \{}
\DoxyCodeLine{01330\ \ \ \textcolor{comment}{//\ for\ all\ chunkmap\ entries}}
\DoxyCodeLine{01331\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunkmap\_max\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a693e5b64e9a4644c716974dda2395edc}{\_mi\_divide\_up}}(\mbox{\hyperlink{bitmap_8h_adbc04bcdad6dd6f18993c5ed4b92f2a4}{mi\_bitmap\_chunk\_count}}(bitmap),\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{01332\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ chunkmap\_max;\ i++)\ \{}
\DoxyCodeLine{01333\ \ \ \ \ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ cmap\_entry\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&bitmap-\/>chunkmap.bfields[i]);}
\DoxyCodeLine{01334\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ cmap\_idx;}
\DoxyCodeLine{01335\ \ \ \ \ \textcolor{comment}{//\ for\ each\ chunk\ (corresponding\ to\ a\ set\ bit\ in\ a\ chunkmap\ entry)}}
\DoxyCodeLine{01336\ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{bitmap_8c_a23792b2780ff4daafc8ca3c8f61832d4}{mi\_bfield\_foreach\_bit}}(\&cmap\_entry,\ \&cmap\_idx))\ \{}
\DoxyCodeLine{01337\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunk\_idx\ =\ i*\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}}\ +\ cmap\_idx;}
\DoxyCodeLine{01338\ \ \ \ \ \ \ \textcolor{comment}{//\ for\ each\ chunk\ field}}
\DoxyCodeLine{01339\ \ \ \ \ \ \ \mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ \textcolor{keyword}{const}\ chunk\ =\ \&bitmap-\/>chunks[chunk\_idx];}
\DoxyCodeLine{01340\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ j\ =\ 0;\ j\ <\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}};\ j++)\ \{}
\DoxyCodeLine{01341\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ base\_idx\ =\ (chunk\_idx*\mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}})\ +\ (j*\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{01342\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a6e07b8a8b699b708ec2c24f2bd86de1c}{mi\_atomic\_exchange\_acq\_rel}}(\&chunk-\/>bfields[j],\ 0);\ \textcolor{comment}{//\ can\ be\ relaxed?}}
\DoxyCodeLine{01343\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#if\ MI\_DEBUG\ >\ 1}}
\DoxyCodeLine{01344\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ bpopcount\ =\ \mbox{\hyperlink{bits_8h_ac2a9854186003f70eb01135c9aca3529}{mi\_popcount}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}});}
\DoxyCodeLine{01345\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ rngcount\ =\ 0;}
\DoxyCodeLine{01346\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#endif}}
\DoxyCodeLine{01347\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ bidx;}
\DoxyCodeLine{01348\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{bitmap_8c_a81530e7b3d5b00380e17776d6bf7def6}{mi\_bfield\_find\_least\_bit}}(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}},\ \&bidx))\ \{}
\DoxyCodeLine{01349\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ rng\ =\ \mbox{\hyperlink{bits_8h_a8eb514b948438b609030d3d13c0d1c6d}{mi\_ctz}}(\string~(\mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}>>bidx));\ \textcolor{comment}{//\ all\ the\ set\ bits\ from\ bidx}}
\DoxyCodeLine{01350\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \#if\ MI\_DEBUG\ >\ 1}}
\DoxyCodeLine{01351\ \ \ \ \ \ \ \ \ \ \ rngcount\ +=\ rng;}
\DoxyCodeLine{01352\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \#endif}}
\DoxyCodeLine{01353\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(rng>=1\ \&\&\ rng<=\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{01354\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ idx\ =\ base\_idx\ +\ bidx;}
\DoxyCodeLine{01355\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}((idx\ \%\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}})\ +\ rng\ <=\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{01356\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}((idx\ /\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}})\ <\ \mbox{\hyperlink{bitmap_8h_adbc04bcdad6dd6f18993c5ed4b92f2a4}{mi\_bitmap\_chunk\_count}}(bitmap));}
\DoxyCodeLine{01357\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!visit(idx,\ rng,\ arena,\ \mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}}))\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01358\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ clear\ rng\ bits\ in\ b}}
\DoxyCodeLine{01359\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ =\ \mbox{\hyperlink{offscreen_8c_a83fc1af92e29717b4513d121b0c72c7d}{b}}\ \&\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{\string~mi\_bfield\_mask}}(rng,\ bidx);}
\DoxyCodeLine{01360\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01361\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(rngcount\ ==\ bpopcount);}
\DoxyCodeLine{01362\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01363\ \ \ \ \ \}}
\DoxyCodeLine{01364\ \ \ \}}
\DoxyCodeLine{01365\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01366\ \}}
\DoxyCodeLine{01367\ }
\DoxyCodeLine{01368\ }
\DoxyCodeLine{01369\ }
\DoxyCodeLine{01370\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01371\ \textcolor{comment}{\ \ binned\ bitmap's}}
\DoxyCodeLine{01372\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{01373\ }
\DoxyCodeLine{01374\ }
\DoxyCodeLine{01375\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{bitmap_8c_a065d698438c0e7f252b96706e9ed3f8e}{mi\_bbitmap\_size}}(\textcolor{keywordtype}{size\_t}\ bit\_count,\ \textcolor{keywordtype}{size\_t}*\ pchunk\_count)\ \{}
\DoxyCodeLine{01376\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}((bit\_count\ \%\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}})\ ==\ 0);}
\DoxyCodeLine{01377\ \ \ bit\_count\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a7f35944d44d8a16365072023dd19e0da}{\_mi\_align\_up}}(bit\_count,\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{01378\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(bit\_count\ <=\ \mbox{\hyperlink{bitmap_8h_a808f414039b881e12f71af69c97b7bf0}{MI\_BITMAP\_MAX\_BIT\_COUNT}});}
\DoxyCodeLine{01379\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(bit\_count\ >\ 0);}
\DoxyCodeLine{01380\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunk\_count\ =\ bit\_count\ /\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}};}
\DoxyCodeLine{01381\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(chunk\_count\ >=\ 1);}
\DoxyCodeLine{01382\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}}\ =\ offsetof(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}},chunks)\ +\ (chunk\_count\ *\ \mbox{\hyperlink{bitmap_8h_a19d45f49ea2bf72626dd09fc4a8e6b60}{MI\_BCHUNK\_SIZE}});}
\DoxyCodeLine{01383\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\ (\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}}\%\mbox{\hyperlink{bitmap_8h_a19d45f49ea2bf72626dd09fc4a8e6b60}{MI\_BCHUNK\_SIZE}})\ ==\ 0\ );}
\DoxyCodeLine{01384\ \ \ \textcolor{keywordflow}{if}\ (pchunk\_count\ !=\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}})\ \{\ *pchunk\_count\ =\ chunk\_count;\ \ \}}
\DoxyCodeLine{01385\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}};}
\DoxyCodeLine{01386\ \}}
\DoxyCodeLine{01387\ }
\DoxyCodeLine{01388\ \textcolor{comment}{//\ initialize\ a\ bitmap\ to\ all\ unset;\ avoid\ a\ mem\_zero\ if\ \`{}already\_zero`\ is\ true}}
\DoxyCodeLine{01389\ \textcolor{comment}{//\ returns\ the\ size\ of\ the\ bitmap}}
\DoxyCodeLine{01390\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{bitmap_8c_a4bd0f59fd39f7ef532ecf6379640103a}{mi\_bbitmap\_init}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ bit\_count,\ \textcolor{keywordtype}{bool}\ already\_zero)\ \{}
\DoxyCodeLine{01391\ \ \ \textcolor{keywordtype}{size\_t}\ chunk\_count;}
\DoxyCodeLine{01392\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}}\ =\ \mbox{\hyperlink{bitmap_8c_a065d698438c0e7f252b96706e9ed3f8e}{mi\_bbitmap\_size}}(bit\_count,\ \&chunk\_count);}
\DoxyCodeLine{01393\ \ \ \textcolor{keywordflow}{if}\ (!already\_zero)\ \{}
\DoxyCodeLine{01394\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_aa1d3beee9d492fc175ac2584e50fd8ea}{\_mi\_memzero\_aligned}}(bbitmap,\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}});}
\DoxyCodeLine{01395\ \ \ \}}
\DoxyCodeLine{01396\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a1ee5baaa0004b9c737a03d48d77a0194}{mi\_atomic\_store\_release}}(\&bbitmap-\/>chunk\_count,\ chunk\_count);}
\DoxyCodeLine{01397\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&bbitmap-\/>chunk\_count)\ <=\ \mbox{\hyperlink{bitmap_8h_a409ffdb586e43fd59782941d4a8e94d6}{MI\_BITMAP\_MAX\_CHUNK\_COUNT}});}
\DoxyCodeLine{01398\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a3d1e3edfcf61ca2d831883e1afbad89e}{size}};}
\DoxyCodeLine{01399\ \}}
\DoxyCodeLine{01400\ }
\DoxyCodeLine{01401\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bitmap_8c_a370a9392dc0bbcf78d5ff77ca2a9e15b}{mi\_bbitmap\_unsafe\_setN}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n)\ \{}
\DoxyCodeLine{01402\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n>0);}
\DoxyCodeLine{01403\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(idx\ +\ n\ <=\ \mbox{\hyperlink{bitmap_8h_afb1f816c002677982471bf19521ac6ee}{mi\_bbitmap\_max\_bits}}(bbitmap));}
\DoxyCodeLine{01404\ \ \ \mbox{\hyperlink{bitmap_8c_ac5230afb96c7e26d8df04caa0dd10729}{mi\_bchunks\_unsafe\_setN}}(\&bbitmap-\/>chunks[0],\ \&bbitmap-\/>chunkmap,\ idx,\ n);}
\DoxyCodeLine{01405\ \}}
\DoxyCodeLine{01406\ }
\DoxyCodeLine{01407\ }
\DoxyCodeLine{01408\ }
\DoxyCodeLine{01409\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01410\ \textcolor{comment}{\ binned\ bitmap\ used\ to\ track\ free\ slices}}
\DoxyCodeLine{01411\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{01412\ }
\DoxyCodeLine{01413\ \textcolor{comment}{//\ Assign\ a\ specific\ size\ bin\ to\ a\ chunk}}
\DoxyCodeLine{01414\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bitmap_8c_ade3837b1ccb66e3adb45a8a6fdb71a77}{mi\_bbitmap\_set\_chunk\_bin}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ chunk\_idx,\ \mbox{\hyperlink{bitmap_8h_adc852dbc4ef60361c7f31529a9e43927}{mi\_bbin\_t}}\ \mbox{\hyperlink{base_8h_adfa139c9a1902753b3696794759b2c48ac1111bd512b29e821b120b86446026b8}{bin}})\ \{}
\DoxyCodeLine{01415\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(chunk\_idx\ <\ \mbox{\hyperlink{bitmap_8h_a61d4c39827af9a9dbeb574d28856ba90}{mi\_bbitmap\_chunk\_count}}(bbitmap));}
\DoxyCodeLine{01416\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{bitmap_8h_adc852dbc4ef60361c7f31529a9e43927}{mi\_bbin\_t}}\ ibin\ =\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2afac9ed2fe80193aef5e155bc142057d5}{MI\_BBIN\_SMALL}};\ ibin\ <\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2a85f2a45d1680076d7df3955c93e7e794}{MI\_BBIN\_NONE}};\ ibin\ =\ \mbox{\hyperlink{bitmap_8h_a3ac44ca2692e75b2a9bc1ab1ed9f5a84}{mi\_bbin\_inc}}(ibin))\ \{}
\DoxyCodeLine{01417\ \ \ \ \ \textcolor{keywordflow}{if}\ (ibin\ ==\ \mbox{\hyperlink{base_8h_adfa139c9a1902753b3696794759b2c48ac1111bd512b29e821b120b86446026b8}{bin}})\ \{}
\DoxyCodeLine{01418\ \ \ \ \ \ \ \mbox{\hyperlink{bitmap_8c_ab346ba3b2da689a30e5cc0bf7348e552}{mi\_bchunk\_set}}(\&\ bbitmap-\/>chunkmap\_bins[ibin],\ chunk\_idx,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{01419\ \ \ \ \ \}}
\DoxyCodeLine{01420\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01421\ \ \ \ \ \ \ \mbox{\hyperlink{bitmap_8c_a9dfbfc8fe0b5d49b9cb05fb4a16ce60c}{mi\_bchunk\_clear}}(\&bbitmap-\/>chunkmap\_bins[ibin],\ chunk\_idx,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{01422\ \ \ \ \ \}}
\DoxyCodeLine{01423\ \ \ \}\ \ }
\DoxyCodeLine{01424\ \}}
\DoxyCodeLine{01425\ }
\DoxyCodeLine{01426\ \mbox{\hyperlink{bitmap_8h_adc852dbc4ef60361c7f31529a9e43927}{mi\_bbin\_t}}\ \mbox{\hyperlink{bitmap_8c_aea80872c733e332f7026d27533dc41b5}{mi\_bbitmap\_debug\_get\_bin}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_a0b4ba3cd3091fc6ed215a6e670bcda8f}{mi\_bchunkmap\_t}}*\ chunkmap\_bins,\ \textcolor{keywordtype}{size\_t}\ chunk\_idx)\ \{}
\DoxyCodeLine{01427\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{bitmap_8h_adc852dbc4ef60361c7f31529a9e43927}{mi\_bbin\_t}}\ ibin\ =\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2afac9ed2fe80193aef5e155bc142057d5}{MI\_BBIN\_SMALL}};\ ibin\ <\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2a85f2a45d1680076d7df3955c93e7e794}{MI\_BBIN\_NONE}};\ ibin\ =\ \mbox{\hyperlink{bitmap_8h_a3ac44ca2692e75b2a9bc1ab1ed9f5a84}{mi\_bbin\_inc}}(ibin))\ \{}
\DoxyCodeLine{01428\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bitmap_8c_ab0d208390523d5afdb78b6f0be816b2f}{mi\_bchunk\_is\_xsetN}}(\mbox{\hyperlink{bitmap_8h_a5dbfb222b02d9b5694b56930ec5af3e5}{MI\_BIT\_SET}},\ \&chunkmap\_bins[ibin],\ chunk\_idx,\ 1))\ \{}
\DoxyCodeLine{01429\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ ibin;}
\DoxyCodeLine{01430\ \ \ \ \ \}}
\DoxyCodeLine{01431\ \ \ \}}
\DoxyCodeLine{01432\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2a85f2a45d1680076d7df3955c93e7e794}{MI\_BBIN\_NONE}};}
\DoxyCodeLine{01433\ \}}
\DoxyCodeLine{01434\ }
\DoxyCodeLine{01435\ \textcolor{comment}{//\ Track\ the\ index\ of\ the\ highest\ chunk\ that\ is\ accessed.}}
\DoxyCodeLine{01436\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bitmap_8c_a841d1e310df48c7f00345ba145298635}{mi\_bbitmap\_chunkmap\_set\_max}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ chunk\_idx)\ \{}
\DoxyCodeLine{01437\ \ \ \textcolor{keywordtype}{size\_t}\ oldmax\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&bbitmap-\/>chunk\_max\_accessed);}
\DoxyCodeLine{01438\ \ \ \textcolor{keywordflow}{if}\ \mbox{\hyperlink{bits_8h_a13767b1803a4c31c40d896e9c08bc8a3}{mi\_unlikely}}(chunk\_idx\ >\ oldmax)\ \{}
\DoxyCodeLine{01439\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_a1296de76e5c92febeff3fe07d248631f}{mi\_atomic\_cas\_strong\_relaxed}}(\&bbitmap-\/>chunk\_max\_accessed,\ \&oldmax,\ chunk\_idx);}
\DoxyCodeLine{01440\ \ \ \}}
\DoxyCodeLine{01441\ \}}
\DoxyCodeLine{01442\ }
\DoxyCodeLine{01443\ \textcolor{comment}{//\ Set\ a\ bit\ in\ the\ chunkmap}}
\DoxyCodeLine{01444\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{bitmap_8c_a5e83447278a21fe0e1881471aed3723f}{mi\_bbitmap\_chunkmap\_set}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ chunk\_idx,\ \textcolor{keywordtype}{bool}\ check\_all\_set)\ \{}
\DoxyCodeLine{01445\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_af04c7a87bc1c69ef3e763a580f47a418}{mi\_assert}}(chunk\_idx\ <\ \mbox{\hyperlink{bitmap_8h_a61d4c39827af9a9dbeb574d28856ba90}{mi\_bbitmap\_chunk\_count}}(bbitmap));}
\DoxyCodeLine{01446\ \ \ \textcolor{keywordflow}{if}\ (check\_all\_set)\ \{}
\DoxyCodeLine{01447\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{bitmap_8c_a7879ec0a2a72c95ff4d0037eb61580d6}{mi\_bchunk\_all\_are\_set\_relaxed}}(\&bbitmap-\/>chunks[chunk\_idx]))\ \{}
\DoxyCodeLine{01448\ \ \ \ \ \ \ \textcolor{comment}{//\ all\ slices\ are\ free\ in\ this\ chunk:\ return\ back\ to\ the\ NONE\ bin}}
\DoxyCodeLine{01449\ \ \ \ \ \ \ \mbox{\hyperlink{bitmap_8c_ade3837b1ccb66e3adb45a8a6fdb71a77}{mi\_bbitmap\_set\_chunk\_bin}}(bbitmap,\ chunk\_idx,\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2a85f2a45d1680076d7df3955c93e7e794}{MI\_BBIN\_NONE}});}
\DoxyCodeLine{01450\ \ \ \ \ \}}
\DoxyCodeLine{01451\ \ \ \}}
\DoxyCodeLine{01452\ \ \ \mbox{\hyperlink{bitmap_8c_ab346ba3b2da689a30e5cc0bf7348e552}{mi\_bchunk\_set}}(\&bbitmap-\/>chunkmap,\ chunk\_idx,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{01453\ \ \ \mbox{\hyperlink{bitmap_8c_a841d1e310df48c7f00345ba145298635}{mi\_bbitmap\_chunkmap\_set\_max}}(bbitmap,\ chunk\_idx);}
\DoxyCodeLine{01454\ \}}
\DoxyCodeLine{01455\ }
\DoxyCodeLine{01456\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a0d4eacebd0a3822984c96967db54af70}{mi\_bbitmap\_chunkmap\_try\_clear}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ chunk\_idx)\ \{}
\DoxyCodeLine{01457\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_af04c7a87bc1c69ef3e763a580f47a418}{mi\_assert}}(chunk\_idx\ <\ \mbox{\hyperlink{bitmap_8h_a61d4c39827af9a9dbeb574d28856ba90}{mi\_bbitmap\_chunk\_count}}(bbitmap));}
\DoxyCodeLine{01458\ \ \ \textcolor{comment}{//\ check\ if\ the\ corresponding\ chunk\ is\ all\ clear}}
\DoxyCodeLine{01459\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{bitmap_8c_a88902555fe05fa9a9b3d747b230f45b2}{mi\_bchunk\_all\_are\_clear\_relaxed}}(\&bbitmap-\/>chunks[chunk\_idx]))\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01460\ \ \ \textcolor{comment}{//\ clear\ the\ chunkmap\ bit}}
\DoxyCodeLine{01461\ \ \ \mbox{\hyperlink{bitmap_8c_a9dfbfc8fe0b5d49b9cb05fb4a16ce60c}{mi\_bchunk\_clear}}(\&bbitmap-\/>chunkmap,\ chunk\_idx,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{01462\ \ \ \textcolor{comment}{//\ ..\ but\ a\ concurrent\ set\ may\ have\ happened\ in\ between\ our\ all-\/clear\ test\ and\ the\ clearing\ of\ the}}
\DoxyCodeLine{01463\ \ \ \textcolor{comment}{//\ bit\ in\ the\ mask.\ We\ check\ again\ to\ catch\ this\ situation.\ (note:\ mi\_bchunk\_clear\ must\ be\ acq-\/rel)}}
\DoxyCodeLine{01464\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{bitmap_8c_a88902555fe05fa9a9b3d747b230f45b2}{mi\_bchunk\_all\_are\_clear\_relaxed}}(\&bbitmap-\/>chunks[chunk\_idx]))\ \{}
\DoxyCodeLine{01465\ \ \ \ \ \mbox{\hyperlink{bitmap_8c_ab346ba3b2da689a30e5cc0bf7348e552}{mi\_bchunk\_set}}(\&bbitmap-\/>chunkmap,\ chunk\_idx,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{01466\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01467\ \ \ \}}
\DoxyCodeLine{01468\ \ \ \mbox{\hyperlink{bitmap_8c_a841d1e310df48c7f00345ba145298635}{mi\_bbitmap\_chunkmap\_set\_max}}(bbitmap,\ chunk\_idx);}
\DoxyCodeLine{01469\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01470\ \}}
\DoxyCodeLine{01471\ }
\DoxyCodeLine{01472\ }
\DoxyCodeLine{01473\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01474\ \textcolor{comment}{\ \ mi\_bbitmap\_setN,\ try\_clearN,\ and\ is\_xsetN}}
\DoxyCodeLine{01475\ \textcolor{comment}{\ \ (used\ to\ find\ free\ pages)}}
\DoxyCodeLine{01476\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{01477\ }
\DoxyCodeLine{01478\ \textcolor{comment}{//\ Set\ a\ sequence\ of\ \`{}n`\ bits\ in\ the\ bitmap;\ returns\ \`{}true`\ if\ atomically\ transitioned\ from\ 0's\ to\ 1's\ (or\ 1's\ to\ 0's).}}
\DoxyCodeLine{01479\ \textcolor{comment}{//\ \`{}n`\ cannot\ cross\ chunk\ boundaries\ (and\ \`{}n\ <=\ MI\_BCHUNK\_BITS`)!}}
\DoxyCodeLine{01480\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_ad8105936ebee14e0c6cadb2e8c37b024}{mi\_bbitmap\_setN}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n)\ \{}
\DoxyCodeLine{01481\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n>0);}
\DoxyCodeLine{01482\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n<=\mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{01483\ }
\DoxyCodeLine{01484\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunk\_idx\ =\ idx\ /\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}};}
\DoxyCodeLine{01485\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ cidx\ =\ idx\ \%\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}};}
\DoxyCodeLine{01486\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(cidx\ +\ n\ <=\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});\ \ \textcolor{comment}{//\ don't\ cross\ chunks\ (for\ now)}}
\DoxyCodeLine{01487\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(chunk\_idx\ <\ \mbox{\hyperlink{bitmap_8h_a61d4c39827af9a9dbeb574d28856ba90}{mi\_bbitmap\_chunk\_count}}(bbitmap));}
\DoxyCodeLine{01488\ \ \ \textcolor{keywordflow}{if}\ (cidx\ +\ n\ >\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}})\ \{\ n\ =\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}}\ -\/\ cidx;\ \}\ \ \textcolor{comment}{//\ paranoia}}
\DoxyCodeLine{01489\ }
\DoxyCodeLine{01490\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ were\_allclear\ =\ \mbox{\hyperlink{bitmap_8c_a931ab182d5a458c9811743a39c0637df}{mi\_bchunk\_setN}}(\&bbitmap-\/>chunks[chunk\_idx],\ cidx,\ n,\ \mbox{\hyperlink{eabase_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}});}
\DoxyCodeLine{01491\ \ \ \mbox{\hyperlink{bitmap_8c_a5e83447278a21fe0e1881471aed3723f}{mi\_bbitmap\_chunkmap\_set}}(bbitmap,\ chunk\_idx,\ \textcolor{keyword}{true});\ \ \ \textcolor{comment}{//\ set\ after}}
\DoxyCodeLine{01492\ \ \ \textcolor{keywordflow}{return}\ were\_allclear;}
\DoxyCodeLine{01493\ \}}
\DoxyCodeLine{01494\ }
\DoxyCodeLine{01495\ }
\DoxyCodeLine{01496\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/\ mi\_bbitmap\_try\_clearN\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01497\ }
\DoxyCodeLine{01498\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a1462519a63f8d0b1454a5cbe8d7cafa1}{mi\_bbitmap\_try\_clearN}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n)\ \{}
\DoxyCodeLine{01499\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n>0);}
\DoxyCodeLine{01500\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n<=\mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{01501\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(idx\ +\ n\ <=\ \mbox{\hyperlink{bitmap_8h_afb1f816c002677982471bf19521ac6ee}{mi\_bbitmap\_max\_bits}}(bbitmap));}
\DoxyCodeLine{01502\ }
\DoxyCodeLine{01503\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunk\_idx\ =\ idx\ /\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}};}
\DoxyCodeLine{01504\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ cidx\ =\ idx\ \%\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}};}
\DoxyCodeLine{01505\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(cidx\ +\ n\ <=\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});\ \ \textcolor{comment}{//\ don't\ cross\ chunks\ (for\ now)}}
\DoxyCodeLine{01506\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(chunk\_idx\ <\ \mbox{\hyperlink{bitmap_8h_a61d4c39827af9a9dbeb574d28856ba90}{mi\_bbitmap\_chunk\_count}}(bbitmap));}
\DoxyCodeLine{01507\ \ \ \textcolor{keywordflow}{if}\ (cidx\ +\ n\ >\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}})\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01508\ \ \ \textcolor{keywordtype}{bool}\ maybe\_all\_clear;}
\DoxyCodeLine{01509\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ cleared\ =\ \mbox{\hyperlink{bitmap_8c_a034ce9fb6d195e2ed4bf55e92d5d4b20}{mi\_bchunk\_try\_clearN}}(\&bbitmap-\/>chunks[chunk\_idx],\ cidx,\ n,\ \&maybe\_all\_clear);}
\DoxyCodeLine{01510\ \ \ \textcolor{keywordflow}{if}\ (cleared\ \&\&\ maybe\_all\_clear)\ \{\ \mbox{\hyperlink{bitmap_8c_a0d4eacebd0a3822984c96967db54af70}{mi\_bbitmap\_chunkmap\_try\_clear}}(bbitmap,\ chunk\_idx);\ \}}
\DoxyCodeLine{01511\ \ \ \textcolor{comment}{//\ note:\ we\ don't\ set\ the\ size\ class\ for\ an\ explicit\ try\_clearN\ (only\ used\ by\ purging)}}
\DoxyCodeLine{01512\ \ \ \textcolor{keywordflow}{return}\ cleared;}
\DoxyCodeLine{01513\ \}}
\DoxyCodeLine{01514\ }
\DoxyCodeLine{01515\ }
\DoxyCodeLine{01516\ \textcolor{comment}{//\ -\/-\/-\/-\/-\/-\/-\/\ mi\_bbitmap\_is\_xset\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01517\ }
\DoxyCodeLine{01518\ \textcolor{comment}{//\ Is\ a\ sequence\ of\ n\ bits\ already\ all\ set/cleared?}}
\DoxyCodeLine{01519\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a143c1ab4aaff95bc9a5642f45e2fc52f}{mi\_bbitmap\_is\_xsetN}}(\mbox{\hyperlink{bitmap_8h_a67332e1b1063739efba1c809b15eeb36}{mi\_xset\_t}}\ \mbox{\hyperlink{bundled_2ranges_8h_a080be1238e6ee3bd4b9f193b4181cf4dacdaeeeba9b4a4c5ebf042c0215a7bb0e}{set}},\ \mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ idx,\ \textcolor{keywordtype}{size\_t}\ n)\ \{}
\DoxyCodeLine{01520\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n>0);}
\DoxyCodeLine{01521\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n<=\mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{01522\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(idx\ +\ n\ <=\ \mbox{\hyperlink{bitmap_8h_afb1f816c002677982471bf19521ac6ee}{mi\_bbitmap\_max\_bits}}(bbitmap));}
\DoxyCodeLine{01523\ }
\DoxyCodeLine{01524\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunk\_idx\ =\ idx\ /\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}};}
\DoxyCodeLine{01525\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ cidx\ =\ idx\ \%\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}};}
\DoxyCodeLine{01526\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(cidx\ +\ n\ <=\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});\ \ \textcolor{comment}{//\ don't\ cross\ chunks\ (for\ now)}}
\DoxyCodeLine{01527\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(chunk\_idx\ <\ \mbox{\hyperlink{bitmap_8h_a61d4c39827af9a9dbeb574d28856ba90}{mi\_bbitmap\_chunk\_count}}(bbitmap));}
\DoxyCodeLine{01528\ \ \ \textcolor{keywordflow}{if}\ (cidx\ +\ n\ >\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}})\ \{\ n\ =\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}}\ -\/\ cidx;\ \}\ \ \textcolor{comment}{//\ paranoia}}
\DoxyCodeLine{01529\ }
\DoxyCodeLine{01530\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_ab0d208390523d5afdb78b6f0be816b2f}{mi\_bchunk\_is\_xsetN}}(\mbox{\hyperlink{bundled_2ranges_8h_a080be1238e6ee3bd4b9f193b4181cf4dacdaeeeba9b4a4c5ebf042c0215a7bb0e}{set}},\ \&bbitmap-\/>chunks[chunk\_idx],\ cidx,\ n);}
\DoxyCodeLine{01531\ \}}
\DoxyCodeLine{01532\ }
\DoxyCodeLine{01533\ }
\DoxyCodeLine{01534\ }
\DoxyCodeLine{01535\ }
\DoxyCodeLine{01536\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01537\ \textcolor{comment}{\ \ mi\_bbitmap\_find}}
\DoxyCodeLine{01538\ \textcolor{comment}{\ \ (used\ to\ find\ free\ pages)}}
\DoxyCodeLine{01539\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{01540\ }
\DoxyCodeLine{01541\ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{sugar_8h_abb452686968e48b67397da5f97445f5b}{bool}}\ (\mbox{\hyperlink{bitmap_8c_a026558b7b7a6eff45c09c2fd22eb0056}{mi\_bchunk\_try\_find\_and\_clear\_fun\_t}})(\mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{size\_t}*\ idx);}
\DoxyCodeLine{01542\ }
\DoxyCodeLine{01543\ \textcolor{comment}{//\ Go\ through\ the\ bbitmap\ and\ for\ every\ sequence\ of\ \`{}n`\ set\ bits,\ call\ the\ visitor\ function.}}
\DoxyCodeLine{01544\ \textcolor{comment}{//\ If\ it\ returns\ \`{}true`\ stop\ the\ search.}}
\DoxyCodeLine{01545\ \textcolor{comment}{//}}
\DoxyCodeLine{01546\ \textcolor{comment}{//\ This\ is\ used\ for\ finding\ free\ blocks\ and\ it\ is\ important\ to\ be\ efficient\ (with\ 2-\/level\ bitscan)}}
\DoxyCodeLine{01547\ \textcolor{comment}{//\ but\ also\ reduce\ fragmentation\ (through\ size\ bins).}}
\DoxyCodeLine{01548\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a5b5cc8e21e44f0a6ef8022fbd7ee2eb7}{mi\_bbitmap\_try\_find\_and\_clear\_generic}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ tseq,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{size\_t}*\ pidx,\ \mbox{\hyperlink{bitmap_8c_a026558b7b7a6eff45c09c2fd22eb0056}{mi\_bchunk\_try\_find\_and\_clear\_fun\_t}}*\ on\_find)}
\DoxyCodeLine{01549\ \{}
\DoxyCodeLine{01550\ \ \ \textcolor{comment}{//\ we\ space\ out\ threads\ to\ reduce\ contention}}
\DoxyCodeLine{01551\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ cmap\_max\_count\ \ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_a693e5b64e9a4644c716974dda2395edc}{\_mi\_divide\_up}}(\mbox{\hyperlink{bitmap_8h_a61d4c39827af9a9dbeb574d28856ba90}{mi\_bbitmap\_chunk\_count}}(bbitmap),\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{01552\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunk\_acc\ \ \ \ \ \ \ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&bbitmap-\/>chunk\_max\_accessed);}
\DoxyCodeLine{01553\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ cmap\_acc\ \ \ \ \ \ \ \ =\ chunk\_acc\ /\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}};}
\DoxyCodeLine{01554\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ cmap\_acc\_bits\ \ \ =\ 1\ +\ (chunk\_acc\ \%\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{01555\ }
\DoxyCodeLine{01556\ \ \ \textcolor{comment}{//\ create\ a\ mask\ over\ the\ chunkmap\ entries\ to\ iterate\ over\ them\ efficiently}}
\DoxyCodeLine{01557\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}}\ >=\ \mbox{\hyperlink{bitmap_8h_a3f37be99eaf94edf5771794e7f3ed3ff}{MI\_BCHUNK\_FIELDS}});}
\DoxyCodeLine{01558\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ cmap\_mask\ \ =\ \mbox{\hyperlink{bitmap_8c_aa4d08980dc8daf4bb8b950a4d4a687ef}{mi\_bfield\_mask}}(cmap\_max\_count,0);}
\DoxyCodeLine{01559\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ cmap\_cycle\ \ \ \ \ \ =\ cmap\_acc+1;}
\DoxyCodeLine{01560\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_adc852dbc4ef60361c7f31529a9e43927}{mi\_bbin\_t}}\ bbin\ =\ \mbox{\hyperlink{bitmap_8h_a2b2a3c07810f9ec7680d37f24113c16c}{mi\_bbin\_of}}(n);\ }
\DoxyCodeLine{01561\ \ \ \textcolor{comment}{//\ visit\ each\ cmap\ entry}}
\DoxyCodeLine{01562\ \ \ \textcolor{keywordtype}{size\_t}\ cmap\_idx\ =\ 0;}
\DoxyCodeLine{01563\ \ \ \mbox{\hyperlink{bitmap_8c_a88d496215c839717834f3924ece9dd95}{mi\_bfield\_cycle\_iterate}}(cmap\_mask,\ tseq,\ cmap\_cycle,\ cmap\_idx,\ X)}
\DoxyCodeLine{01564\ \ \ \{}
\DoxyCodeLine{01565\ \ \ \ \ \textcolor{comment}{//\ and\ for\ each\ chunkmap\ entry\ we\ iterate\ over\ its\ bits\ to\ find\ the\ chunks}}
\DoxyCodeLine{01566\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ cmap\_entry\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&bbitmap-\/>chunkmap.bfields[cmap\_idx]);}
\DoxyCodeLine{01567\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ cmap\_entry\_cycle\ =\ (cmap\_idx\ !=\ cmap\_acc\ ?\ \mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}}\ :\ cmap\_acc\_bits);}
\DoxyCodeLine{01568\ \ \ \ \ \textcolor{keywordflow}{if}\ (cmap\_entry\ ==\ 0)\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01569\ }
\DoxyCodeLine{01570\ \ \ \ \ \textcolor{comment}{//\ get\ size\ bin\ masks}}
\DoxyCodeLine{01571\ \ \ \ \ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ cmap\_bins[\mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2a64558e9ce6219950529e130d68029e5a}{MI\_BBIN\_COUNT}}]\ =\ \{\ 0\ \};}
\DoxyCodeLine{01572\ \ \ \ \ cmap\_bins[\mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2a85f2a45d1680076d7df3955c93e7e794}{MI\_BBIN\_NONE}}]\ =\ cmap\_entry;}
\DoxyCodeLine{01573\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{bitmap_8h_adc852dbc4ef60361c7f31529a9e43927}{mi\_bbin\_t}}\ ibin\ =\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2afac9ed2fe80193aef5e155bc142057d5}{MI\_BBIN\_SMALL}};\ ibin\ <\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2a85f2a45d1680076d7df3955c93e7e794}{MI\_BBIN\_NONE}};\ ibin\ =\ \mbox{\hyperlink{bitmap_8h_a3ac44ca2692e75b2a9bc1ab1ed9f5a84}{mi\_bbin\_inc}}(ibin))\ \{}
\DoxyCodeLine{01574\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ cmap\_bin\ =\ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2atomic_8h_ae060cc1d6be8764ac2170e1a0d91dd5e}{mi\_atomic\_load\_relaxed}}(\&bbitmap-\/>chunkmap\_bins[ibin].bfields[cmap\_idx]);}
\DoxyCodeLine{01575\ \ \ \ \ \ \ cmap\_bins[ibin]\ =\ cmap\_bin\ \&\ cmap\_entry;}
\DoxyCodeLine{01576\ \ \ \ \ \ \ cmap\_bins[\mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2a85f2a45d1680076d7df3955c93e7e794}{MI\_BBIN\_NONE}}]\ \&=\ \string~cmap\_bin;\ \ \ \ \ \ \textcolor{comment}{//\ clear\ bits\ that\ are\ in\ an\ assigned\ size\ bin}}
\DoxyCodeLine{01577\ \ \ \ \ \}}
\DoxyCodeLine{01578\ }
\DoxyCodeLine{01579\ \ \ \ \ \textcolor{comment}{//\ consider\ only\ chunks\ for\ a\ particular\ size\ bin\ at\ a\ time\ \ \ \ }}
\DoxyCodeLine{01580\ \ \ \ \ \textcolor{comment}{//\ this\ picks\ the\ best\ bin\ only\ within\ a\ cmap\ entry\ (\string~\ 1GiB\ address\ space),\ but\ avoids\ multiple}}
\DoxyCodeLine{01581\ \ \ \ \ \textcolor{comment}{//\ iterations\ through\ all\ entries.}}
\DoxyCodeLine{01582\ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(bbin\ <\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2a85f2a45d1680076d7df3955c93e7e794}{MI\_BBIN\_NONE}});}
\DoxyCodeLine{01583\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{bitmap_8h_adc852dbc4ef60361c7f31529a9e43927}{mi\_bbin\_t}}\ ibin\ =\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2afac9ed2fe80193aef5e155bc142057d5}{MI\_BBIN\_SMALL}};\ ibin\ <=\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2a85f2a45d1680076d7df3955c93e7e794}{MI\_BBIN\_NONE}};}
\DoxyCodeLine{01584\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ skip\ from\ bbin\ to\ NONE\ (so,\ say,\ a\ SMALL\ will\ never\ be\ placed\ in\ a\ OTHER,\ MEDIUM,\ or\ LARGE\ chunk\ to\ reduce\ fragmentation)}}
\DoxyCodeLine{01585\ \ \ \ \ \ \ \ \ \ \ ibin\ =\ (ibin\ ==\ bbin\ ?\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2a85f2a45d1680076d7df3955c93e7e794}{MI\_BBIN\_NONE}}\ :\ \mbox{\hyperlink{bitmap_8h_a3ac44ca2692e75b2a9bc1ab1ed9f5a84}{mi\_bbin\_inc}}(ibin)))}
\DoxyCodeLine{01586\ \ \ \ \ \{}
\DoxyCodeLine{01587\ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(ibin\ <\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2a64558e9ce6219950529e130d68029e5a}{MI\_BBIN\_COUNT}});}
\DoxyCodeLine{01588\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{bitmap_8h_ae5b0da1e4ae496d591f35a1c6894d42c}{mi\_bfield\_t}}\ cmap\_bin\ =\ cmap\_bins[ibin];\ \ \ \ \ \ }
\DoxyCodeLine{01589\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ eidx\ =\ 0;}
\DoxyCodeLine{01590\ \ \ \ \ \ \ \mbox{\hyperlink{bitmap_8c_a88d496215c839717834f3924ece9dd95}{mi\_bfield\_cycle\_iterate}}(cmap\_bin,\ tseq,\ cmap\_entry\_cycle,\ eidx,\ Y)\ \ }
\DoxyCodeLine{01591\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01592\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ assertion\ doesn't\ quite\ hold\ as\ the\ max\_accessed\ may\ be\ out-\/of-\/date}}
\DoxyCodeLine{01593\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ mi\_assert\_internal(cmap\_entry\_cycle\ >\ eidx\ ||\ ibin\ ==\ MI\_BBIN\_NONE);}}
\DoxyCodeLine{01594\ }
\DoxyCodeLine{01595\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ get\ the\ chunk\ }}
\DoxyCodeLine{01596\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ chunk\_idx\ =\ cmap\_idx*\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}}\ +\ eidx;}
\DoxyCodeLine{01597\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bitmap_8h_a54425c7e25f46f660927967e6dfed390}{mi\_bchunk\_t}}*\ chunk\ =\ \&bbitmap-\/>chunks[chunk\_idx];}
\DoxyCodeLine{01598\ }
\DoxyCodeLine{01599\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ cidx;}
\DoxyCodeLine{01600\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*on\_find)(chunk,\ n,\ \&cidx))\ \{}
\DoxyCodeLine{01601\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cidx==0\ \&\&\ ibin\ ==\ \mbox{\hyperlink{bitmap_8h_af619ce447c0ec8505af7ece6ba8032c2a85f2a45d1680076d7df3955c93e7e794}{MI\_BBIN\_NONE}})\ \{\ \textcolor{comment}{//\ only\ the\ first\ block\ determines\ the\ size\ bin}}
\DoxyCodeLine{01602\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ this\ chunk\ is\ now\ reserved\ for\ the\ \`{}bbin`\ size\ class}}
\DoxyCodeLine{01603\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bitmap_8c_ade3837b1ccb66e3adb45a8a6fdb71a77}{mi\_bbitmap\_set\_chunk\_bin}}(bbitmap,\ chunk\_idx,\ bbin);}
\DoxyCodeLine{01604\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01605\ \ \ \ \ \ \ \ \ \ \ *pidx\ =\ (chunk\_idx\ *\ \mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}})\ +\ cidx;}
\DoxyCodeLine{01606\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(*pidx\ +\ n\ <=\ \mbox{\hyperlink{bitmap_8h_afb1f816c002677982471bf19521ac6ee}{mi\_bbitmap\_max\_bits}}(bbitmap));}
\DoxyCodeLine{01607\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01608\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01609\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01610\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ todo:\ should\ \_on\_find\_\ return\ a\ boolen\ if\ there\ is\ a\ chance\ all\ are\ clear\ to\ avoid\ calling\ \`{}try\_clear?`}}
\DoxyCodeLine{01611\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ we\ may\ find\ that\ all\ are\ cleared\ only\ on\ a\ second\ iteration\ but\ that\ is\ ok\ as\ the\ chunkmap\ is\ a\ conservative\ approximation.}}
\DoxyCodeLine{01612\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bitmap_8c_a0d4eacebd0a3822984c96967db54af70}{mi\_bbitmap\_chunkmap\_try\_clear}}(bbitmap,\ chunk\_idx);}
\DoxyCodeLine{01613\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01614\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01615\ \ \ \ \ \ \ \mbox{\hyperlink{bitmap_8c_a704d70bca29f1b05f2e856167e0e8e78}{mi\_bfield\_cycle\_iterate\_end}}(Y);}
\DoxyCodeLine{01616\ \ \ \ \ \}}
\DoxyCodeLine{01617\ \ \ \}}
\DoxyCodeLine{01618\ \ \ \mbox{\hyperlink{bitmap_8c_a704d70bca29f1b05f2e856167e0e8e78}{mi\_bfield\_cycle\_iterate\_end}}(X);}
\DoxyCodeLine{01619\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01620\ \}}
\DoxyCodeLine{01621\ }
\DoxyCodeLine{01622\ }
\DoxyCodeLine{01623\ \textcolor{comment}{/*\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{01624\ \textcolor{comment}{\ \ mi\_bbitmap\_try\_find\_and\_clear\ -\/-\/\ used\ to\ find\ free\ pages}}
\DoxyCodeLine{01625\ \textcolor{comment}{\ \ note:\ the\ compiler\ will\ fully\ inline\ the\ indirect\ function\ calls}}
\DoxyCodeLine{01626\ \textcolor{comment}{-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/\ */}}
\DoxyCodeLine{01627\ }
\DoxyCodeLine{01628\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_af4021b82102a0099956ce78b094ef754}{mi\_bbitmap\_try\_find\_and\_clear}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ tseq,\ \textcolor{keywordtype}{size\_t}*\ pidx)\ \{}
\DoxyCodeLine{01629\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_a5b5cc8e21e44f0a6ef8022fbd7ee2eb7}{mi\_bbitmap\_try\_find\_and\_clear\_generic}}(bbitmap,\ tseq,\ 1,\ pidx,\ \&\mbox{\hyperlink{bitmap_8c_afd07f823dfe1b3c245c75d2f7b859fe3}{mi\_bchunk\_try\_find\_and\_clear\_1}});}
\DoxyCodeLine{01630\ \}}
\DoxyCodeLine{01631\ }
\DoxyCodeLine{01632\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a1cea740ac26cb096d1af87f0ccf155e6}{mi\_bbitmap\_try\_find\_and\_clear8}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ tseq,\ \textcolor{keywordtype}{size\_t}*\ pidx)\ \{}
\DoxyCodeLine{01633\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_a5b5cc8e21e44f0a6ef8022fbd7ee2eb7}{mi\_bbitmap\_try\_find\_and\_clear\_generic}}(bbitmap,\ tseq,\ 8,\ pidx,\ \&\mbox{\hyperlink{bitmap_8c_a7b85ce925452dbe5a7821a461e3e8deb}{mi\_bchunk\_try\_find\_and\_clear\_8}});}
\DoxyCodeLine{01634\ \}}
\DoxyCodeLine{01635\ }
\DoxyCodeLine{01636\ \textcolor{comment}{//\ bool\ mi\_bbitmap\_try\_find\_and\_clearX(mi\_bbitmap\_t*\ bbitmap,\ size\_t\ tseq,\ size\_t*\ pidx)\ \{}}
\DoxyCodeLine{01637\ \textcolor{comment}{//\ \ \ return\ mi\_bbitmap\_try\_find\_and\_clear\_generic(bbitmap,\ tseq,\ MI\_BFIELD\_BITS,\ pidx,\ \&mi\_bchunk\_try\_find\_and\_clear\_X);}}
\DoxyCodeLine{01638\ \textcolor{comment}{//\ \}}}
\DoxyCodeLine{01639\ }
\DoxyCodeLine{01640\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a39dd151902e207638aac95877e04e7b3}{mi\_bbitmap\_try\_find\_and\_clearNX}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ tseq,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{size\_t}*\ pidx)\ \{}
\DoxyCodeLine{01641\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n<=\mbox{\hyperlink{bitmap_8h_a5408aec84a0a6e013b4e415757cf5054}{MI\_BFIELD\_BITS}});}
\DoxyCodeLine{01642\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_a5b5cc8e21e44f0a6ef8022fbd7ee2eb7}{mi\_bbitmap\_try\_find\_and\_clear\_generic}}(bbitmap,\ tseq,\ n,\ pidx,\ \&\mbox{\hyperlink{bitmap_8c_a42150c51b3d6ffaeacbb26995bf8dbd7}{mi\_bchunk\_try\_find\_and\_clearNX}});}
\DoxyCodeLine{01643\ \}}
\DoxyCodeLine{01644\ }
\DoxyCodeLine{01645\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{bitmap_8c_a5a1cbdadcced2fcfd0c3bc12e797fdd3}{mi\_bbitmap\_try\_find\_and\_clearN\_}}(\mbox{\hyperlink{bitmap_8h_ae56ff3312bc123ce9c127764b9c5d42a}{mi\_bbitmap\_t}}*\ bbitmap,\ \textcolor{keywordtype}{size\_t}\ tseq,\ \textcolor{keywordtype}{size\_t}\ n,\ \textcolor{keywordtype}{size\_t}*\ pidx)\ \{}
\DoxyCodeLine{01646\ \ \ \mbox{\hyperlink{_e_a_s_t_l_2packages_2mimalloc_2include_2mimalloc_2internal_8h_ac4a5dfa05acddb18f9bcc3d1505a5906}{mi\_assert\_internal}}(n<=\mbox{\hyperlink{types_8h_ad378bca0757a405376f6d869666ed19c}{MI\_BCHUNK\_BITS}});}
\DoxyCodeLine{01647\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{bitmap_8c_a5b5cc8e21e44f0a6ef8022fbd7ee2eb7}{mi\_bbitmap\_try\_find\_and\_clear\_generic}}(bbitmap,\ tseq,\ n,\ pidx,\ \&\mbox{\hyperlink{bitmap_8c_aaf7fe9fdfa57a3dc4b6de1b16c76d065}{mi\_bchunk\_try\_find\_and\_clearN\_}});}
\DoxyCodeLine{01648\ \}}

\end{DoxyCode}
