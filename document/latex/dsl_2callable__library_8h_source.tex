\doxysection{callable\+\_\+library.\+h}
\hypertarget{dsl_2callable__library_8h_source}{}\label{dsl_2callable__library_8h_source}\index{runtime/dsl/callable\_library.h@{runtime/dsl/callable\_library.h}}
\mbox{\hyperlink{dsl_2callable__library_8h}{浏览该文件的文档.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{ast_2callable__library_8h}{runtime/ast/callable\_library.h}}>}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{logging_8h}{runtime/core/logging.h}}>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{func_8h}{runtime/dsl/func.h}}>}}
\DoxyCodeLine{00005\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceluisa_1_1compute}{luisa::compute}}\ \{}
\DoxyCodeLine{00006\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespaceluisa_1_1compute_1_1detail}{detail}}\ \{}
\DoxyCodeLine{00007\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00008\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structluisa_1_1compute_1_1detail_1_1_callable_type_checker}{CallableTypeChecker}};}
\DoxyCodeLine{00009\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ Ret,\ \textcolor{keyword}{typename}...\ Args>}
\DoxyCodeLine{00010\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structluisa_1_1compute_1_1detail_1_1_callable_type_checker}{CallableTypeChecker}}<Ret(Args...)>\ \{}
\DoxyCodeLine{00011\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{structluisa_1_1compute_1_1detail_1_1_callable_type_checker_3_01_ret_07_args_8_8_8_08_4_ae6bf713f9a3fdb92bff9764bbcfdb517}{check}}(\mbox{\hyperlink{classluisa_1_1compute_1_1_type}{Type}}\ \textcolor{keyword}{const}\ *ret\_type,\ luisa::span<const\ Variable>\ args)\ \{}
\DoxyCodeLine{00012\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ret\_type\ !=\ Type::of<Ret>())\ [[unlikely]]\ \{}
\DoxyCodeLine{00013\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logging_8h_ac7615a6198a641dc412fadf93661742f}{LUISA\_ERROR}}(\textcolor{stringliteral}{"{}Return\ type\ not\ match."{}});}
\DoxyCodeLine{00014\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00015\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ types\ =\ \{Type::of<Args>()...\};}
\DoxyCodeLine{00016\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ arg\_count\ =\ 0;}
\DoxyCodeLine{00017\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\ \&\&i\ :\ args)\ \{}
\DoxyCodeLine{00018\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!i.is\_shared()\ \&\&\ !i.is\_builtin())\ \{}
\DoxyCodeLine{00019\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ arg\_count\ +=\ 1;}
\DoxyCodeLine{00020\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00021\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00022\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (types.size()\ !=\ arg\_count)\ [[unlikely]]\ \{}
\DoxyCodeLine{00023\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logging_8h_ac7615a6198a641dc412fadf93661742f}{LUISA\_ERROR}}(\textcolor{stringliteral}{"{}Argument\ size\ not\ match,\ required:\ \{\},\ contained:\ \{\}"{}},\ types.size(),\ args.\mbox{\hyperlink{classluisa_1_1span_a0f7437e043b6e7c6628206dccda8f44c}{size}}());}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \textcolor{keyword}{auto}\ \mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}}\ =\ args.\mbox{\hyperlink{classluisa_1_1span_ad0c186d2f091d78e148a6a8d156bfc4b}{begin}}();}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ types.size();\ ++i)\ \{}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}}-\/>is\_shared()\ ||\ \mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}}-\/>is\_builtin())\ \{}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}}++;}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00030\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (types.begin()[i]\ !=\ \mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}}-\/>type())\ [[unlikely]]\ \{}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logging_8h_ac7615a6198a641dc412fadf93661742f}{LUISA\_ERROR}}(\textcolor{stringliteral}{"{}Argument\ \{\}\ type\ mismatch,\ required:\ \{\},\ contained:\ \{\}"{}},\ i,\ types.begin()[i]-\/>description(),\ \mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}}-\/>type()-\/>description());}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mimalloc_8h_ac9ca0390aa991912667416f6baf99e51}{arg}}++;}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00035\ \ \ \ \ \}}
\DoxyCodeLine{00036\ \};}
\DoxyCodeLine{00037\ \}\textcolor{comment}{//\ namespace\ detail}}
\DoxyCodeLine{00038\ \textcolor{keyword}{template}<\textcolor{keyword}{typename}\ T>}
\DoxyCodeLine{00039\ \mbox{\hyperlink{classluisa_1_1compute_1_1_callable}{Callable<T>}}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_callable_library_a3f875659bd709edcbfc5ea7a830dad4a}{CallableLibrary::get\_callable}}(luisa::string\_view\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a5c4947d4516dd7cfa3505ce3a648a4ef}{name}})\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keyword}{auto}\ iter\ =\ \mbox{\hyperlink{classluisa_1_1compute_1_1_callable_library_a7f14ede87a287d3631198eb5091f6e08}{\_callables}}.find(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a5c4947d4516dd7cfa3505ce3a648a4ef}{name}});}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordflow}{if}\ (iter\ ==\ \mbox{\hyperlink{classluisa_1_1compute_1_1_callable_library_a7f14ede87a287d3631198eb5091f6e08}{\_callables}}.end())\ [[unlikely]]\ \{}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logging_8h_ac7615a6198a641dc412fadf93661742f}{LUISA\_ERROR}}(\textcolor{stringliteral}{"{}Callable\ \{\}\ not\ found"{}},\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a5c4947d4516dd7cfa3505ce3a648a4ef}{name}});}
\DoxyCodeLine{00043\ \ \ \ \ \}}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keyword}{auto}\ \&func\ =\ iter-\/>second;}
\DoxyCodeLine{00045\ \ \ \ \ \mbox{\hyperlink{structluisa_1_1compute_1_1detail_1_1_callable_type_checker}{detail::CallableTypeChecker<T>::check}}(func-\/>return\_type(),\ func-\/>arguments());}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_callable}{Callable<T>}}\{func\};}
\DoxyCodeLine{00047\ \}}
\DoxyCodeLine{00048\ \textcolor{keyword}{template}<\textcolor{keywordtype}{size\_t}\ dim,\ \textcolor{keyword}{typename}...\ T>}
\DoxyCodeLine{00049\ \mbox{\hyperlink{classluisa_1_1compute_1_1_kernel}{Kernel}}<dim,\ T...>\ \mbox{\hyperlink{classluisa_1_1compute_1_1_callable_library_a8bbf0598a66e814186ecb0f1124b8c81}{CallableLibrary::get\_kernel}}(luisa::string\_view\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a5c4947d4516dd7cfa3505ce3a648a4ef}{name}})\ \textcolor{keyword}{const}\ \textcolor{keyword}{noexcept}\ \{}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keyword}{auto}\ iter\ =\ \mbox{\hyperlink{classluisa_1_1compute_1_1_callable_library_a7f14ede87a287d3631198eb5091f6e08}{\_callables}}.find(\mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a5c4947d4516dd7cfa3505ce3a648a4ef}{name}});}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keywordflow}{if}\ (iter\ ==\ \mbox{\hyperlink{classluisa_1_1compute_1_1_callable_library_a7f14ede87a287d3631198eb5091f6e08}{\_callables}}.end())\ [[unlikely]]\ \{}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logging_8h_ac7615a6198a641dc412fadf93661742f}{LUISA\_ERROR}}(\textcolor{stringliteral}{"{}Callable\ \{\}\ not\ found"{}},\ \mbox{\hyperlink{imgui__impl__opengl3__loader_8h_a5c4947d4516dd7cfa3505ce3a648a4ef}{name}});}
\DoxyCodeLine{00053\ \ \ \ \ \}}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keyword}{auto}\ \&func\ =\ iter-\/>second;}
\DoxyCodeLine{00055\ \ \ \ \ \mbox{\hyperlink{structluisa_1_1compute_1_1detail_1_1_callable_type_checker}{detail::CallableTypeChecker}}<\mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}}(T...)>::check(func-\/>return\_type(),\ func-\/>arguments());}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classluisa_1_1compute_1_1_kernel}{Kernel}}<dim,\ T...>\{func\};}
\DoxyCodeLine{00057\ \}}
\DoxyCodeLine{00058\ \}\textcolor{comment}{//\ namespace\ luisa::compute}}

\end{DoxyCode}
