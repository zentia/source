\doxysection{runtime/xx\+Hash/tests/collisions/pool.c 文件参考}
\hypertarget{pool_8c}{}\label{pool_8c}\index{runtime/xxHash/tests/collisions/pool.c@{runtime/xxHash/tests/collisions/pool.c}}
{\ttfamily \#include $<$stddef.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$assert.\+h$>$}\newline
{\ttfamily \#include "{}pool.\+h"{}}\newline
{\ttfamily \#include "{}threading.\+h"{}}\newline
pool.\+c 的引用(Include)关系图\+:
% FIG 0
\doxysubsubsection*{类}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{struct_p_o_o_l__job__s}{POOL\+\_\+job\+\_\+s}}
\item 
struct \mbox{\hyperlink{struct_p_o_o_l__ctx__s}{POOL\+\_\+ctx\+\_\+s}}
\end{DoxyCompactItemize}
\doxysubsubsection*{宏定义}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{pool_8c_afab701147f34e287ba11c5328c28ac00}{POOL\+\_\+\+MT}}~1
\end{DoxyCompactItemize}
\doxysubsubsection*{类型定义}
\begin{DoxyCompactItemize}
\item 
typedef struct \mbox{\hyperlink{struct_p_o_o_l__job__s}{POOL\+\_\+job\+\_\+s}} \mbox{\hyperlink{pool_8c_a868cc70e4adeb1c157cbc40f6e44a584}{POOL\+\_\+job}}
\end{DoxyCompactItemize}
\doxysubsubsection*{函数}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{pool_8c_ae2681a7916e1926c5c035a066c17ac7d}{POOL\+\_\+thread}} (\mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}} \texorpdfstring{$\ast$}{*}opaque)
\item 
\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{pool_8c_a05016dd101d21fdc429f76c78cdbb236}{POOL\+\_\+create}} (size\+\_\+t num\+Threads, size\+\_\+t queue\+Size)
\item 
static \mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}} \mbox{\hyperlink{pool_8c_a5b3a356b676a5cdf0869b8bd86e7a15d}{POOL\+\_\+join}} (\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx}} \texorpdfstring{$\ast$}{*}ctx)
\item 
\mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}} \mbox{\hyperlink{pool_8c_aa4303d0084a4b529708500c2eb4ed341}{POOL\+\_\+free}} (\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx}} \texorpdfstring{$\ast$}{*}ctx)
\item 
size\+\_\+t \mbox{\hyperlink{pool_8c_ab114a81745c71f639573a46542256e87}{POOL\+\_\+sizeof}} (\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx}} \texorpdfstring{$\ast$}{*}ctx)
\item 
static \mbox{\hyperlink{sugar_8h_ae88a82478e3818cade3f598c25437904}{int}} \mbox{\hyperlink{pool_8c_a7b90a1cc32c84e246f4f30e1a2eb7d7b}{POOL\+\_\+resize\+\_\+internal}} (\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx}} \texorpdfstring{$\ast$}{*}ctx, size\+\_\+t num\+Threads)
\item 
\mbox{\hyperlink{sugar_8h_ae88a82478e3818cade3f598c25437904}{int}} \mbox{\hyperlink{pool_8c_a39fdba7fe95ecb80063409162667b017}{POOL\+\_\+resize}} (\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx}} \texorpdfstring{$\ast$}{*}ctx, size\+\_\+t num\+Threads)
\item 
static \mbox{\hyperlink{sugar_8h_ae88a82478e3818cade3f598c25437904}{int}} \mbox{\hyperlink{pool_8c_a48909548adfd63a96acfaa81a1c949a0}{is\+Queue\+Full}} (\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx}} const \texorpdfstring{$\ast$}{*}ctx)
\item 
static \mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}} \mbox{\hyperlink{pool_8c_ad109e3ea38b363574879f63792c17f8f}{POOL\+\_\+add\+\_\+internal}} (\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx}} \texorpdfstring{$\ast$}{*}ctx, \mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_a657f7753ec82fce04c212f38d9c58e61}{POOL\+\_\+function}} function, \mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}} \texorpdfstring{$\ast$}{*}opaque)
\item 
\mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}} \mbox{\hyperlink{pool_8c_a9e76d52639b0b67a406728d425ba32d8}{POOL\+\_\+add}} (\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx}} \texorpdfstring{$\ast$}{*}ctx, \mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_a657f7753ec82fce04c212f38d9c58e61}{POOL\+\_\+function}} function, \mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}} \texorpdfstring{$\ast$}{*}opaque)
\item 
\mbox{\hyperlink{sugar_8h_ae88a82478e3818cade3f598c25437904}{int}} \mbox{\hyperlink{pool_8c_afcee4187d26bc6387494caf7fb3b59cd}{POOL\+\_\+try\+Add}} (\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx}} \texorpdfstring{$\ast$}{*}ctx, \mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_a657f7753ec82fce04c212f38d9c58e61}{POOL\+\_\+function}} function, \mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}} \texorpdfstring{$\ast$}{*}opaque)
\end{DoxyCompactItemize}


\doxysubsection{宏定义说明}
\Hypertarget{pool_8c_afab701147f34e287ba11c5328c28ac00}\index{pool.c@{pool.c}!POOL\_MT@{POOL\_MT}}
\index{POOL\_MT@{POOL\_MT}!pool.c@{pool.c}}
\doxysubsubsection{\texorpdfstring{POOL\_MT}{POOL\_MT}}
{\footnotesize\ttfamily \label{pool_8c_afab701147f34e287ba11c5328c28ac00} 
\#define POOL\+\_\+\+MT~1}



\doxysubsection{类型定义说明}
\Hypertarget{pool_8c_a868cc70e4adeb1c157cbc40f6e44a584}\index{pool.c@{pool.c}!POOL\_job@{POOL\_job}}
\index{POOL\_job@{POOL\_job}!pool.c@{pool.c}}
\doxysubsubsection{\texorpdfstring{POOL\_job}{POOL\_job}}
{\footnotesize\ttfamily \label{pool_8c_a868cc70e4adeb1c157cbc40f6e44a584} 
typedef struct \mbox{\hyperlink{struct_p_o_o_l__job__s}{POOL\+\_\+job\+\_\+s}} \mbox{\hyperlink{pool_8c_a868cc70e4adeb1c157cbc40f6e44a584}{POOL\+\_\+job}}}



\doxysubsection{函数说明}
\Hypertarget{pool_8c_a48909548adfd63a96acfaa81a1c949a0}\index{pool.c@{pool.c}!isQueueFull@{isQueueFull}}
\index{isQueueFull@{isQueueFull}!pool.c@{pool.c}}
\doxysubsubsection{\texorpdfstring{isQueueFull()}{isQueueFull()}}
{\footnotesize\ttfamily \label{pool_8c_a48909548adfd63a96acfaa81a1c949a0} 
static \mbox{\hyperlink{sugar_8h_ae88a82478e3818cade3f598c25437904}{int}} is\+Queue\+Full (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx}} const \texorpdfstring{$\ast$}{*}}]{ctx}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

Returns 1 if the queue is full and 0 otherwise.

When queue\+Size is 1 (pool was created with an intended queue\+Size of 0), then a queue is empty if there is a thread free {\itshape and} no job is waiting. \Hypertarget{pool_8c_a9e76d52639b0b67a406728d425ba32d8}\index{pool.c@{pool.c}!POOL\_add@{POOL\_add}}
\index{POOL\_add@{POOL\_add}!pool.c@{pool.c}}
\doxysubsubsection{\texorpdfstring{POOL\_add()}{POOL\_add()}}
{\footnotesize\ttfamily \label{pool_8c_a9e76d52639b0b67a406728d425ba32d8} 
\mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}} POOL\+\_\+add (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx}} \texorpdfstring{$\ast$}{*}}]{ctx}{, }\item[{\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_a657f7753ec82fce04c212f38d9c58e61}{POOL\+\_\+function}}}]{function}{, }\item[{\mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}} \texorpdfstring{$\ast$}{*}}]{opaque}{}\end{DoxyParamCaption})}

\doxylink{xx_hash_2tests_2collisions_2pool_8h_a9e76d52639b0b67a406728d425ba32d8}{POOL\+\_\+add()} \+: Add the job {\ttfamily function(opaque)} to the thread pool. {\ttfamily ctx} must be valid. Possibly blocks until there is room in the queue. Note \+: The function may be executed asynchronously, therefore, {\ttfamily opaque} must live until function has been completed. 函数调用图\+:
% FIG 1
\Hypertarget{pool_8c_ad109e3ea38b363574879f63792c17f8f}\index{pool.c@{pool.c}!POOL\_add\_internal@{POOL\_add\_internal}}
\index{POOL\_add\_internal@{POOL\_add\_internal}!pool.c@{pool.c}}
\doxysubsubsection{\texorpdfstring{POOL\_add\_internal()}{POOL\_add\_internal()}}
{\footnotesize\ttfamily \label{pool_8c_ad109e3ea38b363574879f63792c17f8f} 
static \mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}} POOL\+\_\+add\+\_\+internal (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx}} \texorpdfstring{$\ast$}{*}}]{ctx}{, }\item[{\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_a657f7753ec82fce04c212f38d9c58e61}{POOL\+\_\+function}}}]{function}{, }\item[{\mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}} \texorpdfstring{$\ast$}{*}}]{opaque}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\Hypertarget{pool_8c_a05016dd101d21fdc429f76c78cdbb236}\index{pool.c@{pool.c}!POOL\_create@{POOL\_create}}
\index{POOL\_create@{POOL\_create}!pool.c@{pool.c}}
\doxysubsubsection{\texorpdfstring{POOL\_create()}{POOL\_create()}}
{\footnotesize\ttfamily \label{pool_8c_a05016dd101d21fdc429f76c78cdbb236} 
\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx}} \texorpdfstring{$\ast$}{*} POOL\+\_\+create (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{num\+Threads}{, }\item[{size\+\_\+t}]{queue\+Size}{}\end{DoxyParamCaption})}

\doxylink{xx_hash_2tests_2collisions_2pool_8h_a05016dd101d21fdc429f76c78cdbb236}{POOL\+\_\+create()} \+: Create a thread pool with at most {\ttfamily num\+Threads} threads. {\ttfamily num\+Threads} must be at least 1. The maximum number of queued jobs before blocking is {\ttfamily queue\+Size}. \begin{DoxyReturn}{返回}
\+: \doxylink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx} pointer on success, else NULL. 
\end{DoxyReturn}
函数调用图\+:
% FIG 2
\Hypertarget{pool_8c_aa4303d0084a4b529708500c2eb4ed341}\index{pool.c@{pool.c}!POOL\_free@{POOL\_free}}
\index{POOL\_free@{POOL\_free}!pool.c@{pool.c}}
\doxysubsubsection{\texorpdfstring{POOL\_free()}{POOL\_free()}}
{\footnotesize\ttfamily \label{pool_8c_aa4303d0084a4b529708500c2eb4ed341} 
\mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}} POOL\+\_\+free (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx}} \texorpdfstring{$\ast$}{*}}]{ctx}{}\end{DoxyParamCaption})}

\doxylink{xx_hash_2tests_2collisions_2pool_8h_aa4303d0084a4b529708500c2eb4ed341}{POOL\+\_\+free()} \+: Free a thread pool returned by \doxylink{xx_hash_2tests_2collisions_2pool_8h_a05016dd101d21fdc429f76c78cdbb236}{POOL\+\_\+create()}. 函数调用图\+:
% FIG 3
\Hypertarget{pool_8c_a5b3a356b676a5cdf0869b8bd86e7a15d}\index{pool.c@{pool.c}!POOL\_join@{POOL\_join}}
\index{POOL\_join@{POOL\_join}!pool.c@{pool.c}}
\doxysubsubsection{\texorpdfstring{POOL\_join()}{POOL\_join()}}
{\footnotesize\ttfamily \label{pool_8c_a5b3a356b676a5cdf0869b8bd86e7a15d} 
static \mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}} POOL\+\_\+join (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx}} \texorpdfstring{$\ast$}{*}}]{ctx}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\doxylink{pool_8c_a5b3a356b676a5cdf0869b8bd86e7a15d}{POOL\+\_\+join()} \+: Shutdown the queue, wake any sleeping threads, and join all of the threads. \Hypertarget{pool_8c_a39fdba7fe95ecb80063409162667b017}\index{pool.c@{pool.c}!POOL\_resize@{POOL\_resize}}
\index{POOL\_resize@{POOL\_resize}!pool.c@{pool.c}}
\doxysubsubsection{\texorpdfstring{POOL\_resize()}{POOL\_resize()}}
{\footnotesize\ttfamily \label{pool_8c_a39fdba7fe95ecb80063409162667b017} 
\mbox{\hyperlink{sugar_8h_ae88a82478e3818cade3f598c25437904}{int}} POOL\+\_\+resize (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx}} \texorpdfstring{$\ast$}{*}}]{ctx}{, }\item[{size\+\_\+t}]{num\+Threads}{}\end{DoxyParamCaption})}

\doxylink{xx_hash_2tests_2collisions_2pool_8h_a39fdba7fe95ecb80063409162667b017}{POOL\+\_\+resize()} \+: Expands or shrinks pool\textquotesingle{}s number of threads. This is more efficient than releasing + creating a new context, since it tries to preserve and re-\/use existing threads. {\ttfamily num\+Threads} must be at least 1. \begin{DoxyReturn}{返回}
\+: 0 when resize was successful, !0 (typically 1) if there is an error. note \+: only num\+Threads can be resized, queue\+Size remains unchanged. 
\end{DoxyReturn}
函数调用图\+:
% FIG 4
\Hypertarget{pool_8c_a7b90a1cc32c84e246f4f30e1a2eb7d7b}\index{pool.c@{pool.c}!POOL\_resize\_internal@{POOL\_resize\_internal}}
\index{POOL\_resize\_internal@{POOL\_resize\_internal}!pool.c@{pool.c}}
\doxysubsubsection{\texorpdfstring{POOL\_resize\_internal()}{POOL\_resize\_internal()}}
{\footnotesize\ttfamily \label{pool_8c_a7b90a1cc32c84e246f4f30e1a2eb7d7b} 
static \mbox{\hyperlink{sugar_8h_ae88a82478e3818cade3f598c25437904}{int}} POOL\+\_\+resize\+\_\+internal (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx}} \texorpdfstring{$\ast$}{*}}]{ctx}{, }\item[{size\+\_\+t}]{num\+Threads}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

函数调用图\+:
% FIG 5
\Hypertarget{pool_8c_ab114a81745c71f639573a46542256e87}\index{pool.c@{pool.c}!POOL\_sizeof@{POOL\_sizeof}}
\index{POOL\_sizeof@{POOL\_sizeof}!pool.c@{pool.c}}
\doxysubsubsection{\texorpdfstring{POOL\_sizeof()}{POOL\_sizeof()}}
{\footnotesize\ttfamily \label{pool_8c_ab114a81745c71f639573a46542256e87} 
size\+\_\+t POOL\+\_\+sizeof (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx}} \texorpdfstring{$\ast$}{*}}]{ctx}{}\end{DoxyParamCaption})}

\doxylink{xx_hash_2tests_2collisions_2pool_8h_ab114a81745c71f639573a46542256e87}{POOL\+\_\+sizeof()} \+: \begin{DoxyReturn}{返回}
threadpool memory usage note \+: compatible with NULL (returns 0 in this case) 
\end{DoxyReturn}
\Hypertarget{pool_8c_ae2681a7916e1926c5c035a066c17ac7d}\index{pool.c@{pool.c}!POOL\_thread@{POOL\_thread}}
\index{POOL\_thread@{POOL\_thread}!pool.c@{pool.c}}
\doxysubsubsection{\texorpdfstring{POOL\_thread()}{POOL\_thread()}}
{\footnotesize\ttfamily \label{pool_8c_ae2681a7916e1926c5c035a066c17ac7d} 
static \mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}} \texorpdfstring{$\ast$}{*} POOL\+\_\+thread (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}} \texorpdfstring{$\ast$}{*}}]{opaque}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

\Hypertarget{pool_8c_afcee4187d26bc6387494caf7fb3b59cd}\index{pool.c@{pool.c}!POOL\_tryAdd@{POOL\_tryAdd}}
\index{POOL\_tryAdd@{POOL\_tryAdd}!pool.c@{pool.c}}
\doxysubsubsection{\texorpdfstring{POOL\_tryAdd()}{POOL\_tryAdd()}}
{\footnotesize\ttfamily \label{pool_8c_afcee4187d26bc6387494caf7fb3b59cd} 
\mbox{\hyperlink{sugar_8h_ae88a82478e3818cade3f598c25437904}{int}} POOL\+\_\+try\+Add (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_ace842ea9500966baa959147860dc24f2}{POOL\+\_\+ctx}} \texorpdfstring{$\ast$}{*}}]{ctx}{, }\item[{\mbox{\hyperlink{xx_hash_2tests_2collisions_2pool_8h_a657f7753ec82fce04c212f38d9c58e61}{POOL\+\_\+function}}}]{function}{, }\item[{\mbox{\hyperlink{mimalloc_8h_a9d6d8aef94ac19034a5f163606f84830}{void}} \texorpdfstring{$\ast$}{*}}]{opaque}{}\end{DoxyParamCaption})}

\doxylink{xx_hash_2tests_2collisions_2pool_8h_afcee4187d26bc6387494caf7fb3b59cd}{POOL\+\_\+try\+Add()} \+: Add the job {\ttfamily function(opaque)} to thread pool {\itshape if} a worker is available. Returns immediately even if not (does not block). \begin{DoxyReturn}{返回}
\+: 1 if successful, 0 if not. 
\end{DoxyReturn}
函数调用图\+:
% FIG 6
